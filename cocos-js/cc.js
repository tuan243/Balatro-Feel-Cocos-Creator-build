System.register([],(function(t,i){"use strict";return{execute:function(){function n(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,w(e.key),e)}}function e(t,i,e){return i&&n(t.prototype,i),e&&n(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(){return r=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},r.apply(this,arguments)}function s(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,u(t,i)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function u(t,i){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},u(t,i)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function a(t,i,n){return a=o()?Reflect.construct.bind():function(t,i,n){var e=[null];e.push.apply(e,i);var r=new(Function.bind.apply(t,e));return n&&u(r,n.prototype),r},a.apply(null,arguments)}function c(t){var i="function"==typeof Map?new Map:void 0;return c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,e)}function e(){return a(t,arguments,h(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)},c(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,i){if(t){if("string"==typeof t)return l(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,i):void 0}}function l(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function d(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=v(t))||i){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,i){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var e=n.call(t,i);if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function w(t){var i=g(t,"string");return"symbol"==typeof i?i:String(i)}function _(t,i,n,e){n&&Object.defineProperty(t,i,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(e):void 0})}function m(t,i,n,e,r){var s={};return Object.keys(e).forEach((function(t){s[t]=e[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce((function(n,e){return e(t,i,n)||n}),s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,i,s),s=null),s}function p(t,i){const n="undefined"==typeof window?global:window;return void 0===n[t]?n[t]=i:n[t]}t({BitMask:Ri,CCClass:Un,Enum:Ni,Eventify:Su,WorldNode3DToLocalNodeUI:Qu,WorldNode3DToWorldNodeUI:Zu,__checkObsoleteInNamespace__:function(t){return Et||(Et="undefined"==typeof Proxy?{}:new Proxy(t,{get:function(t,i,n){return Ot(i),Reflect.get(t,i,n)}})),Et},__checkObsolete__:function(t){for(var i,n=d(t);!(i=n()).done;)Ot(i.value)},_resetDebugSetting:Q,absMax:we,absMaxComponent:ge,applyMixins:function(t,i){i.forEach((function(i){Object.getOwnPropertyNames(i.prototype).forEach((function(n){"constructor"!==n&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(i.prototype,n))}))}))},approx:Zn,assert:K,assertID:at,assertIsNonNullable:function(){},assertIsTrue:function(){},assertsArrayIndex:Ii,bezier:Rf,bezierByTime:Wf,binarySearch:function(t,i){return Lo(t,i,0)},binarySearchBy:function(t,i,n){for(var e=0,r=t.length-1,s=r>>>1;e<=r;s=e+r>>>1){var h=t[s];if(n(h,i)<0)r=s-1;else{if(!(n(h,i)>0))return s;e=s+1}}return~e},binarySearchEpsilon:Lo,ccenum:Fi,clamp:Jn,clamp01:te,color:fr,computeRatioByType:AZ,createDefaultPipeline:Ylt,debug:q,debugID:et,deprecateModuleExportedName:St,deserialize:om,enumerableProps:_e,equals:Qn,error:Y,errorID:ut,find:LN,flattenCodeArray:qv,floatToHalf:Ae,formerlySerializedAs:aa,fragmentText:TP,getBaselineOffset:rP,getEnglishWordPartAtFirst:EP,getEnglishWordPartAtLast:kP,getError:ft,getPathFromRoot:function(t,i){for(var n=t,e="";null!==n&&n!==i;)e=n.name+"/"+e,n=n.parent;return e.slice(0,-1)},getSerializationMetadata:function(t){return t[ua]},getSymbolAt:mP,getSymbolCodeAt:pP,getSymbolLength:_P,getWorldTransformUntilRoot:QX,halfToFloat:Ee,instantiate:r1,inverseLerp:de,isCCClassOrFastDefined:xn,isCCObject:_u,isDisplayStats:vt,isEnglishWordPartAtFirst:function(t){return lP.test(t)},isEnglishWordPartAtLast:function(t){return vP.test(t)},isUnicodeCJK:dP,isUnicodeSpace:gP,isValid:mu,lerp:ie,log:z,logID:it,mat4:Zr,murmurhash2_32_gc:Wv,nextPow2:fe,pingPong:le,pseudoRandom:oe,pseudoRandomRange:ae,pseudoRandomRangeInt:ce,quat:Gr,random:re,randomRange:he,randomRangeInt:ue,rect:ys,repeat:ve,safeMeasureText:wP,sampleAnimationCurve:bZ,setDefaultLogTimes:function(t){t>0&&(yt=t)},setDisplayStats:lt,setPropertyEnumType:kn,setPropertyEnumTypeOnAttrs:Tn,setRandGenerator:se,shift:function(t,i,n){if(Ii(t,i),Ii(t,n),i===n)return t;var e=t[i];if(i<n)for(var r=i+1;r<=n;++r)t[r-1]=t[r];else for(var s=i;s!==n;--s)t[s]=t[s-1];return t[n]=e,t},size:ws,toDegree:ee,toRadian:ne,tween:Rrt,tweenUtil:Irt,v2:ds,v3:nr,v4:Ue,warn:X,warnID:st}),p("CC_WECHAT",!1),p("CC_XIAOMI",!1),p("CC_ALIPAY",!1),p("CC_BYTEDANCE",!1),p("CC_OPPO",!1),p("CC_VIVO",!1),p("CC_HUAWEI",!1),p("CC_MIGU",!1),p("CC_HONOR",!1),p("CC_COCOS_RUNTIME",!1);const y=!1;p("CC_EDITOR",!1);const b=!1;p("CC_PREVIEW",!1),p("CC_BUILD",!0),p("CC_TEST",!1),p("CC_DEBUG",!1),p("CC_DEV",!1),p("CC_MINIGAME",!1),p("CC_RUNTIME_BASED",!1),p("CC_SUPPORT_JIT",!0),p("CC_JSB",!1);const A=!1;var E="undefined"==typeof window?global:window,k=t("cclegacy",{_global:E}),T=k;k.internal={};var S=t("VERSION","3.8.6");E.CocosEngine=T.ENGINE_VERSION=S,E.cc=T;var O=void 0!==globalThis.jsb&&void 0!==jsb.window?jsb.window:globalThis;E.ccwindow=O;var R=2147483647;function I(t){return(t>0)-(t<0)}function M(t,i){return t^(t^i)&-(t<i)}function N(t){var i,n;return i=(t>65535)<<4,i|=n=((t>>>=i)>255)<<3,i|=n=((t>>>=n)>15)<<2,(i|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function C(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function L(t){var i=32;return(t&=-t)&&i--,65535&t&&(i-=16),16711935&t&&(i-=8),252645135&t&&(i-=4),858993459&t&&(i-=2),1431655765&t&&(i-=1),i}function F(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}var P=new Array(256);!function(t){for(var i=0;i<256;++i){var n=i,e=i,r=7;for(n>>>=1;n;n>>>=1)e<<=1,e|=1&n,--r;t[i]=e<<r&255}}(P);var B=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:R,INT_MIN:-1<<31,abs:function(t){var i=t>>31;return(t^i)-i},countTrailingZeros:L,deinterleave2:function(t,i){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>i&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},deinterleave3:function(t,i){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>i&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},interleave2:function(t,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},interleave3:function(t,i,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},isPow2:function(t){return!(t&t-1||!t)},log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},log2:N,max:M,min:function(t,i){return i^(t^i)&-(t<i)},nextCombination:function(t){var i=t|t-1;return i+1|(~i&-~i)-1>>>L(t)+1},nextPow2:F,parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},popCount:C,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},reverse:function(t){return P[255&t]<<24|P[t>>>8&255]<<16|P[t>>>16&255]<<8|P[t>>>24&255]},sign:I});t("bits",B);var D=O.document,U="https://github.com/cocos/cocos-engine/blob/"+S+"/EngineErrorMap.md",x=null,G=console.log.bind(console),j=G,H=G,V=function(t,i){if(!t){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];console.log("ASSERT: "+W.apply(void 0,[i].concat(e)))}},$=G;function W(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return T.js.formatStr.apply(null,i)}function z(){return G.apply(void 0,arguments)}function X(){return j.apply(void 0,arguments)}function Y(){return H.apply(void 0,arguments)}function K(t,i){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];return V.apply(void 0,[t,i].concat(e))}function q(){return $.apply(void 0,arguments)}function Q(t){if(G=j=H=V=$=function(){},0!==t){if(t>4){var i=function(t){if(T.game.canvas){if(!x){var i=D.createElement("Div");i.setAttribute("id","logInfoDiv"),i.setAttribute("width","200");var n=T.game.canvas.height;i.setAttribute("height",""+n);var e=i.style;e.zIndex="99999",e.position="absolute",e.top=e.left="0",(x=D.createElement("textarea")).setAttribute("rows","20"),x.setAttribute("cols","30"),x.setAttribute("disabled","true");var r=x.style;r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderTopWidth=r.borderLeftWidth=r.borderRightWidth="0px",r.borderTopStyle=r.borderLeftStyle=r.borderRightStyle="none",r.padding="0px",r.margin="0px",i.appendChild(x),T.game.canvas.parentNode.appendChild(i)}x.value=x.value+t+"\r\n",x.scrollTop=x.scrollHeight}};H=function(){i("ERROR :  "+W.apply(void 0,arguments))},V=function(t,n){if(!t){for(var e=arguments.length,r=new Array(e>2?e-2:0),s=2;s<e;s++)r[s-2]=arguments[s];i("ASSERT: "+W.apply(void 0,[n].concat(r)))}},7!==t&&(j=function(){i("WARN :  "+W.apply(void 0,arguments))}),5===t&&(G=function(){i(W.apply(void 0,arguments))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),H=console.error.bind?console.error.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.error.apply(console,i)},V=function(t,i){if(!t){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];var s=W.apply(void 0,[i].concat(e));throw new Error(s)}});if(4!==t&&(j=console.warn.bind?console.warn.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.warn.apply(console,i)}),t<=2&&(G=console.log.bind?console.log.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.log.apply(console,i)}),t<=1&&"function"==typeof console.debug){var n=console.debug.bind(console);$=function(){return n.apply(void 0,arguments)}}}}function Z(t){Y(t.stack||t)}function J(t){return function(i){for(var n=t+" "+i+", please go to "+U+"#"+i+" to see details.",e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var tt=J("Log");function it(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];z(tt.apply(void 0,[t].concat(n)))}var nt=J("Debug");function et(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];q(nt.apply(void 0,[t].concat(n)))}var rt=J("Warning");function st(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];X(rt.apply(void 0,[t].concat(n)))}var ht=J("Error");function ut(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];Y(ht.apply(void 0,[t].concat(n)))}var ot=J("Assert");function at(t,i){if(!t){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];K(!1,ot.apply(void 0,[i].concat(e)))}}var ct=t("DebugMode",{NONE:0,VERBOSE:1,INFO:2,WARN:3,ERROR:4,INFO_FOR_WEB_PAGE:5,WARN_FOR_WEB_PAGE:6,ERROR_FOR_WEB_PAGE:7});function ft(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];return ht.apply(void 0,[t].concat(n))}function vt(){return!!T.profiler&&T.profiler.isShowingStats()}function lt(t){T.profiler&&(t?T.profiler.showStats():T.profiler.hideStats())}var dt,gt,wt,_t,mt,pt=Object.freeze({__proto__:null,DebugMode:ct,_resetDebugSetting:Q,_throw:Z,assert:K,assertID:at,debug:q,debugID:et,error:Y,errorID:ut,getError:ft,isDisplayStats:vt,log:z,logID:it,setDisplayStats:lt,warn:X,warnID:st}),yt=10;t("replaceProperty",dt),t("removeProperty",gt),t("markAsWarning",wt);var bt=0,At=new Map;_t=function(t,i,n,e,r,s,h){var u=At.get(s);u&&u.logTimes>u.count&&(r("'%s' is deprecated, please use '%s' instead. "+h,t+"."+i,n+"."+e),u.count++)},t("replaceProperty",dt=function(t,i,n){null!=t&&n.forEach((function(n){var e=bt++;At.set(e,{id:e,count:0,logTimes:void 0!==n.logTimes?n.logTimes:yt});var r=null!=n.target?n.target:t,s=null!=n.newName?n.newName:n.name,h=null!=n.targetName?n.targetName:i,u=r===t,o=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)t[n.name]=function(){var t;return _t(i,n.name,h,s,X,e,o),(t=n.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var a=null!=n.customSetter,c=null!=n.customGetter;a&&c?Object.defineProperty(t,n.name,{get:function(){return _t(i,n.name,h,s,X,e,o),n.customGetter.call(this)},set:function(t){_t(i,n.name,h,s,X,e,o),n.customSetter.call(this,t)},enumerable:!1}):a?Object.defineProperty(t,n.name,{set:function(t){_t(i,n.name,h,s,X,e,o),n.customSetter.call(this,t)},enumerable:!1}):c&&Object.defineProperty(t,n.name,{get:function(){return _t(i,n.name,h,s,X,e,o),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,n.name,{get:function(){return _t(i,n.name,h,s,X,e,o),u?this[s]:r[s]},set:function(t){_t(i,n.name,h,s,X,e,o),u?this[s]=t:r[s]=t},enumerable:!1})}))}),mt=function(t,i,n,e,r){var s=At.get(e);s&&s.logTimes>s.count&&(n("'%s' has been removed. "+r,t+"."+i),s.count++)},t("removeProperty",gt=function(t,i,n){null!=t&&n.forEach((function(n){var e=bt++;At.set(e,{id:e,count:0,logTimes:void 0!==n.logTimes?n.logTimes:yt});var r=n.suggest?"("+n.suggest+")":"";Object.defineProperty(t,n.name,{get:function(){return mt(i,n.name,Y,e,r)},set:function(){mt(i,n.name,Y,e,r)},enumerable:!1})}))}),t("markAsWarning",wt=function(){});var Et,kt,Tt={};function St(t){for(var i in t){var n=t[i];Tt[i]=n}}function Ot(t){var i=Tt[t];if(i){var n=i.newName,e=i.since;i.removed?n?ut(16003,t,e,n):ut(16002,t,e):n?st(16001,t,e,n):st(16e3,t,e)}}var Rt=function(){function t(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+(++this.id).toString()},t}();kt=Rt,Rt.global=new kt("global");var It=new Rt("TmpCId."),Mt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),Nt="__classname__",Ct="__cid__";function Lt(t){return"number"==typeof t||t instanceof Number}function Ft(t){return"string"==typeof t||t instanceof String}function Pt(t){for(var i in t)return!1;return!0}var Bt,Dt=(Bt={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,i,n,e,r){Bt.value=n,Bt.writable=e,Bt.enumerable=r,Object.defineProperty(t,i,Bt),Bt.value=void 0}),Ut=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(i,n,e,r,s,h){void 0===s&&(s=!1),void 0===h&&(h=!1),"boolean"==typeof r&&(it(1031),s=r,r=void 0),t.get=e,t.set=r,t.enumerable=s,t.configurable=h,Object.defineProperty(i,n,t),t.get=void 0,t.set=void 0}}(),xt=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(i,n,e,r,s){t.get=e,t.enumerable=r,t.configurable=s,Object.defineProperty(i,n,t),t.get=void 0}}(),Gt=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(i,n,e,r,s){t.set=e,t.enumerable=r,t.configurable=s,Object.defineProperty(i,n,t),t.set=void 0}}();function jt(t){var i=Object.create(null);return t&&(i["."]=1,i["/"]=1,delete i["."],delete i["/"]),i}function Ht(t){if("function"==typeof t){var i=t.prototype;if(i&&i.hasOwnProperty(Nt)&&i[Nt])return i[Nt];var n="";if(t.name)n=t.name;else if(t.toString){var e,r=t.toString();(e="["===r.charAt(0)?/\[\w+\s*(\w+)\]/.exec(r):/^function\s*(\w+)/.exec(r))&&2===e.length&&(n=e[1])}return"Object"!==n?n:""}return t&&t.constructor?Ht(t.constructor):""}function Vt(t,i,n,e){var r=/([^.]+)$/,s=r.exec(i)[0],h=r.exec(n)[0];function u(){return this[h]}e?Ut(t,s,u,(function(t){this[h]=t})):xt(t,s,u)}function $t(t,i,n,e){for(var r in n)Vt(t,i+"."+r,n[r],e)}var Wt=/(%d)|(%s)/,zt=/%s/;function Xt(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];if(0===arguments.length)return"";if(0===n.length)return""+t;if("string"==typeof t&&Wt.test(t))for(var r,s=d(n);!(r=s()).done;){var h=r.value,u="number"==typeof h?Wt:zt;if(u.test(t)){var o=""+h;t=t.replace(u,o)}else t+=" "+h}else for(var a,c=d(n);!(a=c()).done;)t+=" "+a.value;return t}function Yt(){for(var t=arguments.length-1,i=new Array(t),n=0;n<t;++n)i[n]=arguments[n+1];return i}function Kt(t,i){for(;t;){var n=Object.getOwnPropertyDescriptor(t,i);if(n)return n;t=Object.getPrototypeOf(t)}return null}function qt(t,i,n){var e=Kt(i,t);e&&Object.defineProperty(n,t,e)}function Qt(t){t=t||{};for(var i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var n=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(n){if("object"!=typeof n){ut(5402,n);continue}for(var e in n)e in t||qt(e,n,t)}}return t}function Zt(t){t=t||{};for(var i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var n=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(n){if("object"!=typeof n){ut(5403,n);continue}for(var e in n)qt(e,n,t)}}return t}function Jt(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t.prototype=Object.create(i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function ti(t){var i=t.prototype,n=i&&Object.getPrototypeOf(i);return n&&n.constructor}function ii(t,i){if(t&&i){if("function"!=typeof t)return!1;if("function"!=typeof i)return!1;if(t===i)return!0;for(;;){if(!(t=ti(t)))return!1;if(t===i)return!0}}return!1}function ni(t){for(var i=0,n=Object.keys(t);i<n.length;i++)delete t[n[i]]}var ei=jt(!0),ri=jt(!0);function si(t,i,n){return function(e,r){if(r.prototype.hasOwnProperty(t)&&delete i[r.prototype[t]],Dt(r.prototype,t,e),e){var s=i[e];!n&&s&&s!==r?ut(16334,t,e,""):i[e]=r}}}var hi=si("__cid__",ei,!1),ui=si("__classname__",ri,!0);function oi(t,i){if(ui(t,i),!i.prototype.hasOwnProperty(Ct)){var n=t||It.getNewId();n&&hi(n,i)}}function ai(t,i){var n=ri[i],e=ei[i],r=!0;if(n&&n!==t&&(ut(16335,i),r=!1),e&&e!==t&&(ut(16336,i),r=!1),r){var s=t[Mt];s||(s=[],t[Mt]=s),s.push(i),ri[i]=t,ei[i]=t}}function ci(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var e=0,r=i;e<r.length;e++){var s=r[e].prototype,h=s[Ct];h&&delete ei[h];var u=s[Nt];u&&delete ri[u];var o=s[Mt];if(o)for(var a=0;a<o.length;++a){var c=o[a];delete ri[c],delete ei[c]}}}function fi(t){return vi(t)}function vi(t){return ei[t]}function li(t){return ri[t]}function di(t){return gi(t)}function gi(t){if("function"==typeof t&&t.prototype.hasOwnProperty(Ct))return t.prototype[Ct];if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty(Ct))return t[Ct]}return""}var wi=function(){var t=i.prototype;function i(t,i){this.count=0;var n=void 0===i?t:i,e=void 0===i?null:t;this._=new Array(n),this.T=e}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._[this.count];return this._[this.count]=null,t}return null},t.put=function(t){var i=this._;if(this.count<i.length){if(this.T&&!1===this.T(t))return;i[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._.length=t,this.count>t&&(this.count=t))},i}(),_i=function(){function t(t){this.i=0,this.array=t}var i=t.prototype;return i.remove=function(t){var i=this.array.indexOf(t);i>=0&&this.removeAt(i)},i.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},i.fastRemove=function(t){var i=this.array.indexOf(t);i>=0&&this.fastRemoveAt(i)},i.fastRemoveAt=function(t){var i=this.array;i[t]=i[i.length-1],--i.length,t<=this.i&&--this.i},i.push=function(t){this.array.push(t)},e(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function mi(t,i){t.splice(i,1)}function pi(t,i){var n=t.length;i<0||i>=n||(t[i]=t[n-1],t.length=n-1)}function yi(t,i){var n=t.indexOf(i);return n>=0&&(mi(t,n),!0)}function bi(t,i){var n=t.indexOf(i);n>=0&&(t[n]=t[t.length-1],--t.length)}function Ai(t,i){var n=t.findIndex(i);if(n>=0){var e=t[n];return mi(t,n),e}}function Ei(t,i){return t.indexOf(i)>=0}function ki(t){for(var i=0,n=arguments.length<=1?0:arguments.length-1;i<n;++i)t[i]=i+1<1||arguments.length<=i+1?void 0:arguments[i+1]}var Ti=Object.freeze({__proto__:null,MutableForwardIterator:_i,appendObjectsAt:function(t,i,n){return t.splice.apply(t,[n,0].concat(i)),t},contains:Ei,copy:function(t){for(var i=t.length,n=new Array(i),e=0;e<i;e+=1)n[e]=t[e];return n},fastRemove:bi,fastRemoveAt:pi,fillItems:ki,remove:yi,removeArray:function(t,i){for(var n=0,e=i.length;n<e;n++)yi(t,i[n])},removeAt:mi,removeIf:Ai,verifyType:function(t,i){if(t&&t.length>0)for(var n,e=d(t);!(n=e()).done;)if(!(n.value instanceof i))return it(1300),!1;return!0}}),Si={IDGenerator:Rt,Pool:wi,array:Ti,isNumber:Lt,isString:Ft,isEmptyObject:Pt,getPropertyDescriptor:Kt,addon:Qt,mixin:Zt,extend:Jt,getSuper:ti,isChildClassOf:ii,clear:ni,value:Dt,getset:Ut,get:xt,set:Gt,unregisterClass:ci,getClassName:Ht,setClassName:oi,setClassAlias:ai,getClassByName:li,getClassById:vi,get _registeredClassNames(){return r({},ri)},set _registeredClassNames(t){ni(ri),Object.assign(ri,t)},get _registeredClassIds(){return r({},ei)},set _registeredClassIds(t){ni(ei),Object.assign(ei,t)},_getClassId:di,getClassId:gi,_setClassId:hi,_getClassById:fi,obsolete:Vt,obsoletes:$t,formatStr:Xt,shiftArguments:Yt,createMap:jt};T.js=Si;var Oi=Object.freeze({__proto__:null,IDGenerator:Rt,Pool:wi,_getClassById:fi,_getClassId:di,_idToClass:ei,_nameToClass:ri,_setClassId:hi,addon:Qt,array:Ti,clear:ni,copyAllProperties:function(t,i,n){for(var e=Object.getOwnPropertyNames(t),r=0,s=e.length;r<s;++r){var h=e[r];-1===n.indexOf(h)&&qt(h,t,i)}},createMap:jt,extend:Jt,formatStr:Xt,get:xt,getClassById:vi,getClassByName:li,getClassId:gi,getClassName:Ht,getPropertyDescriptor:Kt,getSuper:ti,getset:Ut,isChildClassOf:ii,isEmptyObject:Pt,isNumber:Lt,isString:Ft,js:Si,mixin:Zt,obsolete:Vt,obsoletes:$t,set:Gt,setClassAlias:ai,setClassName:oi,shiftArguments:Yt,unregisterClass:ci,value:Dt});function Ri(t){if("__bitmask__"in t)return t;Dt(t,"__bitmask__",null,!0);for(var i=-1,n=Object.keys(t),e=0;e<n.length;e++){var r=n[e],s=t[r];if(-1===s)s=++i,t[r]=s;else if("number"==typeof s)i=s;else if("string"==typeof s&&Number.isInteger(parseFloat(r)))continue;var h=""+s;r!==h&&Dt(t,h,r)}return t}function Ii(t,i){i>=0&&t.length,t.length}t("js",Oi),Ri.isBitMask=function(t){return t&&Object.prototype.hasOwnProperty.call(t,"__bitmask__")},Ri.getList=function(t){return t.__bitmask__?t.__bitmask__:Ri.update(t)},Ri.update=function(t){Array.isArray(t.__bitmask__)||(t.__bitmask__=[]);var i=t.__bitmask__;for(var n in i.length=0,t){var e=t[n];Number.isInteger(e)&&i.push({name:n,value:e})}return i.sort((function(t,i){return t.value-i.value})),i},T.BitMask=Ri;var Mi=Object.prototype.hasOwnProperty;function Ni(t){return"__enums__"in t?t:(Dt(t,"__enums__",null,!0),Ni.update(t))}function Ci(t){Mi.call(t,"__enums__")}function Li(t){Ci(t);var i=t.__enums__||[];i.length=0;var n=!0;for(var e in t){var r=t[e],s=Number.isInteger(r);s||(n=!1),(s||"string"==typeof r&&t[r]!==Number.parseInt(e))&&i.push({name:e,value:r})}return n&&i.sort((function(t,i){return t.value-i.value})),t.__enums__=i,i}function Fi(t){"__enums__"in t||Dt(t,"__enums__",null,!0)}Ni.update=function(t){for(var i=-1,n=Object.keys(t),e=0;e<n.length;e++){var r=n[e],s=t[r];if(-1===s)s=++i,t[r]=s;else if("number"==typeof s)i=s;else if("string"==typeof s&&Number.isInteger(parseFloat(r)))continue;var h=""+s;r!==h&&Dt(t,h,r)}return Array.isArray(t.__enums__)&&Li(t),t},Ni.isEnum=function(t){return t&&Mi.call(t,"__enums__")},Ni.getList=function(t){return Ci(t),t.__enums__?t.__enums__:Li(t)},Ni.sortList=function(t,i){Ci(t),Array.isArray(t.__enums__)&&t.__enums__.sort(i)},T.Enum=Ni;var Pi=t("ValueType",function(){function t(){}var i=t.prototype;return i.clone=function(){return ut(100,Ht(this)+".clone"),this},i.equals=function(){return!1},i.set=function(){ut(100,Ht(this)+".set")},i.toString=function(){return""},t}());oi("cc.ValueType",Pi),T.ValueType=Pi;var Bi=t("SettingsCategory",{PATH:"path",ENGINE:"engine",ASSETS:"assets",SCRIPTING:"scripting",PHYSICS:"physics",RENDERING:"rendering",LAUNCH:"launch",SCREEN:"screen",SPLASH_SCREEN:"splashScreen",ANIMATION:"animation",PROFILING:"profiling",PLUGINS:"plugins",XR:"xr"}),Di=t("Settings",function(){function t(){this.S={},this.O={}}var i=t.prototype;return i.init=function(t,i){var n=this;for(var e in void 0===t&&(t=""),void 0===i&&(i={}),i){var r=i[e];if(r)for(var s in r)this.overrideSettings(e,s,r[s])}return t?new Promise((function(i,e){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="text",r.onload=function(){n.S=JSON.parse(r.response),i()},r.onerror=function(){e(new Error("request settings failed!"))},r.send(null)})):Promise.resolve()},i.overrideSettings=function(t,i,n){t in this.O||(this.O[t]={}),this.O[t][i]=n},i.querySettings=function(t,i){if(t in this.O){var n=this.O[t];if(n&&i in n)return n[i]}if(t in this.S){var e=this.S[t];if(e&&i in e)return e[i]}return null},t}());Di.Category=Bi;var Ui,xi=t("settings",new Di);T.settings=xi,function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(Ui||(Ui={}));var Gi=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:Ui.PORTRAIT,ORIENTATION_PORTRAIT_UPSIDE_DOWN:Ui.PORTRAIT_UPSIDE_DOWN,ORIENTATION_LANDSCAPE:Ui.LANDSCAPE,ORIENTATION_LANDSCAPE_LEFT:Ui.LANDSCAPE_LEFT,ORIENTATION_LANDSCAPE_RIGHT:Ui.LANDSCAPE_RIGHT,ORIENTATION_AUTO:Ui.AUTO,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_FLOAT_OUTPUT:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144,CUSTOM_PIPELINE_NAME:"Builtin",init:function(){var t=xi.querySettings("engine","macros");if(t)for(var i in t)Gi[i]=t[i]}});function ji(t,i){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];var s=performance.now(),h=requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;return void 0===h?setTimeout.apply(void 0,[t,i].concat(e)):h((function n(){performance.now()-s<i?h(n):t.apply(void 0,e)}))}T.macro=Gi;for(var Hi=/^(?:cc|dragonBones|sp|ccsg)\..+/,Vi=new Array(123),$i=0;$i<123;++$i)Vi[$i]=64;for(var Wi=0;Wi<64;++Wi)Vi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Wi)]=Wi;var zi=Vi;function Xi(t,i,n){function e(t,i,n,e){var r=Object.getOwnPropertyDescriptor(t,i);if(r)r.get&&n&&(t[n]=r.get),r.set&&e&&(t[e]=r.set);else{var s=t[n];Ut(t,i,s,t[e])}}for(var r,s=t.prototype,h=0,u=i.length;h<u;++h){var o=(r=i[h])[0].toUpperCase()+r.slice(1);e(s,r,"get"+o,"set"+o)}for(r in n){var a=n[r];e(s,r,a[0],a[1])}}function Yi(t,i,n,e){var r=t[i];r?Array.isArray(r)?e?(r.push(r[0]),r[0]=n):r.push(n):t[i]=e?[n,r]:[r,n]:t[i]=n}function Ki(t,i){if("function"==typeof t.contains)return t.contains(i);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));var n=i.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1}function qi(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:!!t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function Qi(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];t&&ji((function(){t.apply(void 0,n)}),0)}function Zi(t){return!(!t||t.constructor!==Object)&&Pt(t)}function Ji(t,i,n){if(i>n){var e=i;i=n,n=e}return t<i?i:t<n?t:n}function tn(t){return t*Gi.RAD}function nn(t){return t*Gi.DEG}T.misc={BUILTIN_CLASSID_RE:Hi,BASE64_VALUES:zi,propertyDefine:Xi,pushToMap:Yi,contains:Ki,isDomNode:qi,callInNextTick:Qi,isPlainEmptyObj_DEV:Zi,clampf:Ji,degreesToRadians:tn,radiansToDegrees:nn},t("misc",Object.freeze({__proto__:null,BASE64_VALUES:zi,BUILTIN_CLASSID_RE:Hi,callInNextTick:Qi,clampf:Ji,contains:Ki,degreesToRadians:tn,isDomNode:qi,isPlainEmptyObj_DEV:Zi,propertyDefine:Xi,pushToMap:Yi,radiansToDegrees:nn,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")}}));var en="$_$";function rn(t,i){var n=i?Object.create(i):{};return Dt(t,"__attrs__",n),n}function sn(t){if("function"!=typeof t)return rn(t,un(t.constructor));for(var i,n=T.Class.getInheritanceChain(t),e=n.length-1;e>=0;e--){var r=n[e];r.hasOwnProperty("__attrs__")&&r.__attrs__||rn(r,(i=n[e+1])&&i.__attrs__)}return rn(t,(i=n[0])&&i.__attrs__),t.__attrs__}function hn(t,i){var n=un(t),e=i+en,r={};for(var s in n)s.startsWith(e)&&(r[s.slice(e.length)]=n[s]);return r}function un(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||sn(t)}function on(t,i,n,e){un(t)[i+en+n]=e}var an=function(){function t(t,i){this.name=t,this.default=i}return t.prototype.toString=function(){return this.name},t}(),cn=t("CCInteger",new an("Integer",0));T.Integer=cn,T.CCInteger=cn;var fn=t("CCFloat",new an("Float",0));T.Float=fn,T.CCFloat=fn;var vn=t("CCBoolean",new an("Boolean",!1));T.Boolean=vn,T.CCBoolean=vn;var ln=t("CCString",new an("String",""));function dn(t,i){return function(n,e){var r='"'+Ht(n)+"."+e+'"',s=hn(n,e),h=s.type;if(h===cn||h===fn?h="Number":h!==ln&&h!==vn||(h=""+h),h===t){if(s.hasOwnProperty("default")){var u=s.default;if(void 0!==u&&!Array.isArray(u)&&!Zi(u)){var o=typeof u,a=t.toLowerCase();if(o===a)if("object"===a){if(!u||u instanceof s.ctor)return;st(3605,r,Ht(s.ctor))}else"Number"!==t&&st(3606,i,r,t);else{if("function"===o)return;t===ln.default&&null==u?st(3607,r):st(3611,i,r,o)}delete s.type}}}else st(3604,r)}}T.String=ln,T.CCString=ln;var gn=Object.freeze({__proto__:null,CCBoolean:vn,CCFloat:fn,CCInteger:cn,CCString:ln,DELIMETER:en,PrimitiveType:an,attr:hn,createAttrs:sn,createAttrsSingle:rn,getClassAttrs:un,getObjTypeChecker_ET:function(t){return function(i,n){dn("Object","type")(i,n);var e=un(i)[n+en+"default"],r=T.Class.getDefault(e);if(!Array.isArray(r)&&ii(t,T.ValueType)){var s=Ht(t),h=Xt('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Ht(i),n,s);e?z(h):st(3612,h,s,Ht(i),n,s)}}},getTypeChecker_ET:dn,setClassAttr:on}),wn={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function _n(t,i,n,e){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+i;t.get=function(){return this[r]},t.set=function(t){var i=this[r];this[r]=t,n.call(this,i)};var s={};for(var h in e[r]=s,wn){var u=wn[h];t.hasOwnProperty(h)&&(s[h]=t[h],u.canUsedInGet||delete t[h])}}}function mn(t,i,n,e){if(Array.isArray(i)){if(!(i.length>0))return ut(5508,n,e);t.type=i=i[0]}"function"==typeof i&&(i===String?t.type=T.String:i===Boolean?t.type=T.Boolean:i===Number&&(t.type=T.Float))}function pn(t,i,n){var e=t||void 0===i?{_short:!0}:{_short:!0,default:i};return n&&(e.type=n),e}function yn(t,i){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return pn(i,[],t);if("function"==typeof t){var n=t;return pn(i,ii(n,T.ValueType)?new n:null,n)}return t instanceof an?pn(i,void 0,t):pn(i,t)}return null}function bn(t,i){for(var n in t){var e=t[n],r=yn(e,!1);if(r&&(e=t[n]=r),e){var s=e.notify;s&&_n(e,n,s,t),"type"in e&&mn(e,e.type,i,n)}}}var An=[];function En(){return An[An.length-1]}function kn(t,i,n){Tn(un(t),i,n)}function Tn(t,i,n){t[""+i+en+"type"]="Enum",t[""+i+en+"enumList"]=Ni.getList(n)}T._RF={push:function(t,i,n,e){void 0===n&&(n=i,i=""),An.push({uuid:i,script:n,module:t,exports:t.exports,beh:null,importMeta:e})},pop:function(){var t=An.pop(),i=t.module,n=i.exports;if(n===t.exports){for(var e in n)return;i.exports=n=t.cls}},peek:En};var Sn=en,On="__ctors__",Rn=t("ENUM_TAG","Enum"),In=t("BITMASK_TAG","BitMask");function Mn(t,i){t.indexOf(i)<0&&t.push(i)}function Nn(t,i){Mn(t.__props__,i)}function Cn(t,i,n,e){Nn(t,n),jn(t,e,i,n)}function Ln(t,i,n,e){var r=e.get;e.set,r&&(jn(t,e,i,n),on(t,n,"serializable",!1))}function Fn(t){return"function"==typeof t?t():t}function Pn(t,i,n){var e=n.ctor;return Dt(e,On,!0,!0),e.prototype,i&&(e.$super=i),oi(t,e),e}function Bn(t,i,n){var e=T.Component,r=En();if(r&&ii(i,e)){if(ii(r.cls,e))return ut(3615),null;t=t||r.script}var s=Pn(t,i,n);if(r)if(ii(i,e)){var h=r.uuid;h&&hi(h,s),r.cls=s}else ii(r.cls,e)||(r.cls=s);return s}function Dn(t,i,n,e){if(t.__props__=[],e&&e.__props__&&(t.__props__=e.__props__.slice()),n)for(var r in bn(n,i),n){var s=n[r];s.get||s.set?Ln(t,i,r,s):Cn(t,i,r,s)}var h=un(t);t.__values__=t.__props__.filter((function(t){return!1!==h[""+t+Sn+"serializable"]}))}function Un(t){var i=t.name,n=t.extends,e=Bn(i,n,t);i||(i=T.js.getClassName(e)),e._sealed=!0,n&&(n._sealed=!1),Dn(e,i,t.properties,n);var r=t.editor;return r&&ii(n,T.Component)&&T.Component._registerEditorProps(e,r),e}function xn(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty("__values__")}Un._isCCClass=function(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty(On)},Un.fastDefine=function(t,i,n){oi(t,i);for(var e=i.__props__=i.__values__=Object.keys(n),r=un(i),s=0;s<e.length;s++){var h=e[s];r[h+Sn+"visible"]=!1,r[h+Sn+"default"]=n[h]}},Un.Attr=gn,Un.attr=hn,Un.isCCClassOrFastDefined=xn,Un.getInheritanceChain=function(t){for(var i=[];t=ti(t);)t!==Object&&i.push(t);return i};var Gn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function jn(t,i,n,e){var r=null,s="";function h(){return s=e+Sn,r=un(t)}"type"in i&&void 0===i.type&&st(3660,e,n);var u=i.type;u&&(Gn[u]?(r||h())[s+"type"]=u:"Object"===u||("object"==typeof u?Ni.isEnum(u)?Tn(r||h(),e,u):Ri.isBitMask(u)&&((r||h())[s+"type"]=In,r[s+"bitmaskList"]=Ri.getList(u)):"function"==typeof u&&((r||h())[s+"type"]="Object",r[s+"ctor"]=u))),"default"in i&&((r||h())[s+"default"]=i.default);var o,a=function(t,n){if(t in i){var e=i[t];typeof e===n&&((r||h())[s+t]=e)}};i.editorOnly&&((r||h())[s+"editorOnly"]=!0),1&i.__internalFlags?o=!0===i.serializable||!!(4&i.__internalFlags):!1===i.serializable&&(o=!1),void 0!==o&&((r||h())[s+"serializable"]=o),a("formerlySerializedAs","string");var c=i.range;c&&Array.isArray(c)&&c.length>=2&&((r||h())[s+"min"]=c[0],r[s+"max"]=c[1],c.length>2&&(r[s+"step"]=c[2])),a("step","number"),a("userData","object")}Un.isArray=function(t){return t=Fn(t),Array.isArray(t)},Un.getDefault=Fn,Un.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Un.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Un.getNewValueTypeCode=function(t){for(var i=Ht(t),n=t.constructor,e="new "+i+"(",r=0;r<n.__props__.length;r++)e+=t[n.__props__[r]],r<n.__props__.length-1&&(e+=",");return e+")"},T.Class=Un;var Hn=Math.abs,Vn=Math.floor,$n=Math.PI,Wn=$n/180,zn=180/$n,Xn=Math.random,Yn=t("HALF_PI",.5*$n),Kn=t("TWO_PI",2*$n),qn=t("EPSILON",1e-6);function Qn(t,i){return Hn(t-i)<=qn*Math.max(1,Hn(t),Hn(i))}function Zn(t,i,n){return n=n||qn,Hn(t-i)<=n}function Jn(t,i,n){if(i>n){var e=i;i=n,n=e}return t<i?i:t>n?n:t}function te(t){return t<0?0:t>1?1:t}function ie(t,i,n){return t+(i-t)*n}function ne(t){return t*Wn}function ee(t){return t*zn}function re(){return Xn()}function se(t){Xn=t}function he(t,i){return re()*(i-t)+t}function ue(t,i){return Vn(he(t,i))}function oe(t){return(t=(9301*t+49297)%233280)/233280}function ae(t,i,n){return oe(t)*(n-i)+i}function ce(t,i,n){return Vn(ae(t,i,n))}function fe(t){return F(t)}function ve(t,i){return t-Vn(t/i)*i}function le(t,i){return t=ve(t,2*i),i-Hn(t-i)}function de(t,i,n){return(n-t)/(i-t)}function ge(t){return Hn(t.x)>Hn(t.y)?Hn(t.x)>Hn(t.z)?t.x:t.z:Hn(t.y)>Hn(t.z)?t.y:t.z}function we(t,i){return Hn(t)>Hn(i)?t:i}function _e(t,i){i.forEach((function(i){Object.defineProperty(t,i,{enumerable:!0})}))}var me,pe,ye=(me=new Float32Array(1),pe=new Int32Array(me.buffer),function(t){me[0]=t;var i=pe[0],n=i>>16&32768,e=2147483647&i,r=e-(112<<23)+4096>>13;return r=e<113<<23?0:r,r=e>=143<<23?31744:r,r=e>255<<23?32256:r,pe[0]=n|r,pe[0]}),be=function(){var t=new Float32Array(1),i=new Int32Array(t.buffer);return function(n){var e,r=32767&n,s=r<<13;return 31744!==s?(s+=112<<23,0===r?s=(1048575&s)>>1:32767===r&&(s=2147483647)):s=2139095040,e=(n>>15&1)<<31|s,i[0]=e,t[0]}}();function Ae(t){return ye(t)}function Ee(t){return be(t)}var ke=Math.abs,Te=Math.max,Se=Math.min,Oe=Math.PI,Re=Math.sin,Ie=Math.cos,Me=Math.atan2,Ne=Math.sqrt,Ce=Math.ceil,Le=Math.floor,Fe=Math.round;function Pe(t,i,n,e){return Object.freeze(new De(t,i,n,e))}var Be,De=t("Vec4",function(t){function i(i,n,e,r){var s;return s=t.call(this)||this,"object"==typeof i?(s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w):(s.x=i||0,s.y=n||0,s.z=e||0,s.w=r||0),s}s(i,t),i.clone=function(t){return new i(t.x,t.y,t.z,t.w)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=i.w,t},i.set=function(t,i,n,e,r){return t.x=i,t.y=n,t.z=e,t.w=r,t},i.fromColor=function(t,i){return t.x=i.r,t.y=i.g,t.z=i.b,t.w=i.a,t},i.angle=function(t,i){var n=t.y*i.z-t.z*i.y,e=t.z*i.x-t.x*i.z,r=t.x*i.y-t.y*i.x,s=t.x*i.x+t.y*i.y+t.z*i.z;return Me(Ne(n*n+e*e+r*r),s)},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t.z=i.z+n.z,t.w=i.w+n.w,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t.z=i.z-n.z,t.w=i.w-n.w,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t.z=i.z*n.z,t.w=i.w*n.w,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t.z=i.z/n.z,t.w=i.w/n.w,t},i.ceil=function(t,i){return t.x=Ce(i.x),t.y=Ce(i.y),t.z=Ce(i.z),t.w=Ce(i.w),t},i.floor=function(t,i){return t.x=Le(i.x),t.y=Le(i.y),t.z=Le(i.z),t.w=Le(i.w),t},i.min=function(t,i,n){return t.x=Se(i.x,n.x),t.y=Se(i.y,n.y),t.z=Se(i.z,n.z),t.w=Se(i.w,n.w),t},i.max=function(t,i,n){return t.x=Te(i.x,n.x),t.y=Te(i.y,n.y),t.z=Te(i.z,n.z),t.w=Te(i.w,n.w),t},i.round=function(t,i){return t.x=Fe(i.x),t.y=Fe(i.y),t.z=Fe(i.z),t.w=Fe(i.w),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.scaleAndAdd=function(t,i,n,e){return t.x=i.x+n.x*e,t.y=i.y+n.y*e,t.z=i.z+n.z*e,t.w=i.w+n.w*e,t},i.distance=function(t,i){var n=i.x-t.x,e=i.y-t.y,r=i.z-t.z,s=i.w-t.w;return Ne(n*n+e*e+r*r+s*s)},i.squaredDistance=function(t,i){var n=i.x-t.x,e=i.y-t.y,r=i.z-t.z,s=i.w-t.w;return n*n+e*e+r*r+s*s},i.len=function(t){var i=t.x,n=t.y,e=t.z,r=t.w;return Ne(i*i+n*n+e*e+r*r)},i.lengthSqr=function(t){var i=t.x,n=t.y,e=t.z,r=t.w;return i*i+n*n+e*e+r*r},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t.w=-i.w,t},i.inverse=function(t,i){return t.x=1/i.x,t.y=1/i.y,t.z=1/i.z,t.w=1/i.w,t},i.inverseSafe=function(t,i){var n=i.x,e=i.y,r=i.z,s=i.w;return ke(n)<qn?t.x=0:t.x=1/n,ke(e)<qn?t.y=0:t.y=1/e,ke(r)<qn?t.z=0:t.z=1/r,ke(s)<qn?t.w=0:t.w=1/s,t},i.normalize=function(t,i){var n=i.x,e=i.y,r=i.z,s=i.w,h=n*n+e*e+r*r+s*s;return h>0?(h=1/Ne(h),t.x=n*h,t.y=e*h,t.z=r*h,t.w=s*h):(t.x=0,t.y=0,t.z=0,t.w=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w},i.lerp=function(t,i,n,e){return t.x=i.x+e*(n.x-i.x),t.y=i.y+e*(n.y-i.y),t.z=i.z+e*(n.z-i.z),t.w=i.w+e*(n.w-i.w),t},i.scale=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.random=function(t,i){i=i||1;var n=2*re()*Oe,e=2*re()-1,r=Ne(1-e*e);return t.x=r*Ie(n)*i,t.y=r*Re(n)*i,t.z=e*i,t.w=0,t},i.transformMat4=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=i.w;return t.x=n.m00*e+n.m04*r+n.m08*s+n.m12*h,t.y=n.m01*e+n.m05*r+n.m09*s+n.m13*h,t.z=n.m02*e+n.m06*r+n.m10*s+n.m14*h,t.w=n.m03*e+n.m07*r+n.m11*s+n.m15*h,t},i.transformAffine=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=i.w;return t.x=n.m00*e+n.m04*r+n.m08*s+n.m12*h,t.y=n.m01*e+n.m05*r+n.m09*s+n.m13*h,t.z=n.m02*e+n.m06*r+n.m10*s+n.m14*h,t.w=i.w,t},i.transformQuat=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=n.x,u=n.y,o=n.z,a=n.w,c=a*e+u*s-o*r,f=a*r+o*e-h*s,v=a*s+h*r-u*e,l=-h*e-u*r-o*s;return t.x=c*a+l*-h+f*-o-v*-u,t.y=f*a+l*-u+v*-h-c*-o,t.z=v*a+l*-o+c*-u-f*-h,t.w=i.w,t},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=i.w,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.w=i[n+3],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z&&t.w===i.w},i.equals=function(t,i,n){void 0===n&&(n=qn);var e=1/0;return!(ke(t.x)===e||ke(t.y)===e||ke(t.z)===e||ke(t.w)===e||ke(i.x)===e||ke(i.y)===e||ke(i.z)===e||ke(i.w)===e)&&ke(t.x-i.x)<=n*Te(1,ke(t.x),ke(i.x))&&ke(t.y-i.y)<=n*Te(1,ke(t.y),ke(i.y))&&ke(t.z-i.z)<=n*Te(1,ke(t.z),ke(i.z))&&ke(t.w-i.w)<=n*Te(1,ke(t.w),ke(i.w))};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z,this.w)},n.set=function(t,i,n,e){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=n||0,this.w=e||0),this},n.equals=function(t,i){void 0===i&&(i=qn);var n=this;return ke(n.x-t.x)<=i*Te(1,ke(n.x),ke(t.x))&&ke(n.y-t.y)<=i*Te(1,ke(n.y),ke(t.y))&&ke(n.z-t.z)<=i*Te(1,ke(n.z),ke(t.z))&&ke(n.w-t.w)<=i*Te(1,ke(n.w),ke(t.w))},n.equals4f=function(t,i,n,e,r){void 0===r&&(r=qn);var s=this;return ke(s.x-t)<=r*Te(1,ke(s.x),ke(t))&&ke(s.y-i)<=r*Te(1,ke(s.y),ke(i))&&ke(s.z-n)<=r*Te(1,ke(s.z),ke(n))&&ke(s.w-e)<=r*Te(1,ke(s.w),ke(e))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.strictEquals4f=function(t,i,n,e){return this.x===t&&this.y===i&&this.z===n&&this.w===e},n.lerp=function(t,i){var n=this,e=n.x,r=n.y,s=n.z,h=n.w;return n.x=e+i*(t.x-e),n.y=r+i*(t.y-r),n.z=s+i*(t.z-s),n.w=h+i*(t.w-h),n},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},n.clampf=function(t,i){var n=this;return n.x=Jn(n.x,t.x,i.x),n.y=Jn(n.y,t.y,i.y),n.z=Jn(n.z,t.z,i.z),n.w=Jn(n.w,t.w,i.w),n},n.add=function(t){var i=this;return i.x+=t.x,i.y+=t.y,i.z+=t.z,i.w+=t.w,i},n.add4f=function(t,i,n,e){var r=this;return r.x+=t,r.y+=i,r.z+=n,r.w+=e,r},n.subtract=function(t){var i=this;return i.x-=t.x,i.y-=t.y,i.z-=t.z,i.w-=t.w,i},n.subtract4f=function(t,i,n,e){var r=this;return r.x-=t,r.y-=i,r.z-=n,r.w-=e,r},n.multiplyScalar=function(t){var i=this;return i.x*=t,i.y*=t,i.z*=t,i.w*=t,i},n.multiply=function(t){var i=this;return i.x*=t.x,i.y*=t.y,i.z*=t.z,i.w*=t.w,i},n.multiply4f=function(t,i,n,e){var r=this;return r.x*=t,r.y*=i,r.z*=n,r.w*=e,r},n.divide=function(t){var i=this;return i.x/=t.x,i.y/=t.y,i.z/=t.z,i.w/=t.w,i},n.divide4f=function(t,i,n,e){var r=this;return r.x/=t,r.y/=i,r.z/=n,r.w/=e,r},n.negative=function(){var t=this;return t.x=-t.x,t.y=-t.y,t.z=-t.z,t.w=-t.w,t},n.dot=function(t){var i=this;return i.x*t.x+i.y*t.y+i.z*t.z+i.w*t.w},n.cross=function(t){var i=this,n=i.x,e=i.y,r=i.z,s=t.x,h=t.y,u=t.z;return i.x=e*u-r*h,i.y=r*s-n*u,i.z=n*h-e*s,i},n.length=function(){var t=this,i=t.x,n=t.y,e=t.z,r=t.w;return Ne(i*i+n*n+e*e+r*r)},n.lengthSqr=function(){var t=this,i=t.x,n=t.y,e=t.z,r=t.w;return i*i+n*n+e*e+r*r},n.normalize=function(){var t=this,i=t.x,n=t.y,e=t.z,r=t.w,s=i*i+n*n+e*e+r*r;return s>0&&(s=1/Ne(s),t.x=i*s,t.y=n*s,t.z=e*s,t.w=r*s),t},n.scale=function(t){var i=this;return i.x*=t,i.y*=t,i.z*=t,i.w*=t,i},n.transformMat4=function(t){var i=this,n=i.x,e=i.y,r=i.z,s=i.w;return i.x=t.m00*n+t.m04*e+t.m08*r+t.m12*s,i.y=t.m01*n+t.m05*e+t.m09*r+t.m13*s,i.z=t.m02*n+t.m06*e+t.m10*r+t.m14*s,i.w=t.m03*n+t.m07*e+t.m11*r+t.m15*s,i},i}(Pi));function Ue(t,i,n,e){return new De(t,i,n,e)}De.ZERO=Pe(0,0,0,0),De.ONE=Pe(1,1,1,1),De.NEG_ONE=Pe(-1,-1,-1,-1),De.UNIT_X=Pe(1,0,0,0),De.UNIT_Y=Pe(0,1,0,0),De.UNIT_Z=Pe(0,0,1,0),De.UNIT_W=Pe(0,0,0,1),Un.fastDefine("cc.Vec4",De,{x:0,y:0,z:0,w:0}),T.Vec4=De,T.v4=Ue;var xe=Math.abs,Ge=Math.max,je=Math.min,He=Math.PI,Ve=Math.acos,$e=Math.sin,We=Math.cos,ze=Math.sqrt,Xe=Math.ceil,Ye=Math.floor,Ke=Math.round;function qe(t,i,n){return Object.freeze(new ir(t,i,n))}var Qe,Ze,Je,tr,ir=t("Vec3",function(t){function i(i,n,e){var r;return r=t.call(this)||this,"object"==typeof i?(r.x=i.x,r.y=i.y,r.z=i.z):(r.x=i||0,r.y=n||0,r.z=e||0),r}s(i,t),i.zero=function(t){return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return new i(t.x,t.y,t.z)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t},i.set=function(t,i,n,e){return t.x=i,t.y=n,t.z=e,t},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t.z=i.z+n.z,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t.z=i.z-n.z,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t.z=i.z*n.z,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t.z=i.z/n.z,t},i.ceil=function(t,i){return t.x=Xe(i.x),t.y=Xe(i.y),t.z=Xe(i.z),t},i.floor=function(t,i){return t.x=Ye(i.x),t.y=Ye(i.y),t.z=Ye(i.z),t},i.min=function(t,i,n){return t.x=je(i.x,n.x),t.y=je(i.y,n.y),t.z=je(i.z,n.z),t},i.max=function(t,i,n){return t.x=Ge(i.x,n.x),t.y=Ge(i.y,n.y),t.z=Ge(i.z,n.z),t},i.round=function(t,i){return t.x=Ke(i.x),t.y=Ke(i.y),t.z=Ke(i.z),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t},i.scaleAndAdd=function(t,i,n,e){return t.x=i.x+n.x*e,t.y=i.y+n.y*e,t.z=i.z+n.z*e,t},i.distance=function(t,i){var n=i.x-t.x,e=i.y-t.y,r=i.z-t.z;return ze(n*n+e*e+r*r)},i.squaredDistance=function(t,i){var n=i.x-t.x,e=i.y-t.y,r=i.z-t.z;return n*n+e*e+r*r},i.len=function(t){var i=t.x,n=t.y,e=t.z;return ze(i*i+n*n+e*e)},i.lengthSqr=function(t){var i=t.x,n=t.y,e=t.z;return i*i+n*n+e*e},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t},i.invert=function(t,i){return t.x=1/i.x,t.y=1/i.y,t.z=1/i.z,t},i.invertSafe=function(t,i){var n=i.x,e=i.y,r=i.z;return xe(n)<qn?t.x=0:t.x=1/n,xe(e)<qn?t.y=0:t.y=1/e,xe(r)<qn?t.z=0:t.z=1/r,t},i.normalize=function(t,i){var n=i.x,e=i.y,r=i.z,s=n*n+e*e+r*r;return s>0?(s=1/ze(s),t.x=n*s,t.y=e*s,t.z=r*s):(t.x=0,t.y=0,t.z=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.cross=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=n.x,u=n.y,o=n.z;return t.x=r*o-s*u,t.y=s*h-e*o,t.z=e*u-r*h,t},i.lerp=function(t,i,n,e){return t.x=i.x+e*(n.x-i.x),t.y=i.y+e*(n.y-i.y),t.z=i.z+e*(n.z-i.z),t},i.random=function(t,i){i=i||1;var n=2*re()*He,e=2*re()-1,r=ze(1-e*e);return t.x=r*We(n)*i,t.y=r*$e(n)*i,t.z=e*i,t},i.transformMat4=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=n.m03*e+n.m07*r+n.m11*s+n.m15;return h=h?1/h:1,t.x=(n.m00*e+n.m04*r+n.m08*s+n.m12)*h,t.y=(n.m01*e+n.m05*r+n.m09*s+n.m13)*h,t.z=(n.m02*e+n.m06*r+n.m10*s+n.m14)*h,t},i.transformMat4Normal=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=n.m03*e+n.m07*r+n.m11*s;return h=h?1/h:1,t.x=(n.m00*e+n.m04*r+n.m08*s)*h,t.y=(n.m01*e+n.m05*r+n.m09*s)*h,t.z=(n.m02*e+n.m06*r+n.m10*s)*h,t},i.transformMat3=function(t,i,n){var e=i.x,r=i.y,s=i.z;return t.x=e*n.m00+r*n.m03+s*n.m06,t.y=e*n.m01+r*n.m04+s*n.m07,t.z=e*n.m02+r*n.m05+s*n.m08,t},i.transformAffine=function(t,i,n){var e=i.x,r=i.y,s=i.z;return t.x=n.m00*e+n.m04*r+n.m08*s+n.m12,t.y=n.m01*e+n.m05*r+n.m09*s+n.m13,t.z=n.m02*e+n.m06*r+n.m10*s+n.m14,t},i.transformQuat=function(t,i,n){var e=n.w*i.x+n.y*i.z-n.z*i.y,r=n.w*i.y+n.z*i.x-n.x*i.z,s=n.w*i.z+n.x*i.y-n.y*i.x,h=-n.x*i.x-n.y*i.y-n.z*i.z;return t.x=e*n.w+h*-n.x+r*-n.z-s*-n.y,t.y=r*n.w+h*-n.y+s*-n.x-e*-n.z,t.z=s*n.w+h*-n.z+e*-n.y-r*-n.x,t},i.transformRTS=function(t,i,n,e,r){var s=i.x*r.x,h=i.y*r.y,u=i.z*r.z,o=n.w*s+n.y*u-n.z*h,a=n.w*h+n.z*s-n.x*u,c=n.w*u+n.x*h-n.y*s,f=-n.x*s-n.y*h-n.z*u;return t.x=o*n.w+f*-n.x+a*-n.z-c*-n.y+e.x,t.y=a*n.w+f*-n.y+c*-n.x-o*-n.z+e.y,t.z=c*n.w+f*-n.z+o*-n.y-a*-n.x+e.z,t},i.transformInverseRTS=function(t,i,n,e,r){var s=i.x-e.x,h=i.y-e.y,u=i.z-e.z,o=n.w*s-n.y*u+n.z*h,a=n.w*h-n.z*s+n.x*u,c=n.w*u-n.x*h+n.y*s,f=n.x*s+n.y*h+n.z*u;return t.x=(o*n.w+f*n.x+a*n.z-c*n.y)/r.x,t.y=(a*n.w+f*n.y+c*n.x-o*n.z)/r.y,t.z=(c*n.w+f*n.z+o*n.y-a*n.x)/r.z,t},i.rotateX=function(t,i,n,e){var r=i.x-n.x,s=i.y-n.y,h=i.z-n.z,u=We(e),o=$e(e),a=r,c=s*u-h*o,f=s*o+h*u;return t.x=a+n.x,t.y=c+n.y,t.z=f+n.z,t},i.rotateY=function(t,i,n,e){var r=i.x-n.x,s=i.y-n.y,h=i.z-n.z,u=We(e),o=$e(e),a=h*o+r*u,c=s,f=h*u-r*o;return t.x=a+n.x,t.y=c+n.y,t.z=f+n.z,t},i.rotateZ=function(t,i,n,e){var r=i.x-n.x,s=i.y-n.y,h=i.z-n.z,u=We(e),o=$e(e),a=r*u-s*o,c=r*o+s*u,f=h;return t.x=a+n.x,t.y=c+n.y,t.z=f+n.z,t},i.rotateN=function(t,i,n,e,r){var s=i.x-n.x,h=i.y-n.y,u=i.z-n.z,o=e.x,a=e.y,c=e.z,f=We(r),v=$e(r),l=s*(o*o*(1-f)+f)+h*(o*a*(1-f)-c*v)+u*(o*c*(1-f)+a*v),d=s*(o*a*(1-f)+c*v)+h*(a*a*(1-f)+f)+u*(a*c*(1-f)-o*v),g=s*(o*c*(1-f)-a*v)+h*(a*c*(1-f)+o*v)+u*(c*c*(1-f)+f);return t.x=l+n.x,t.y=d+n.y,t.z=g+n.z,t},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z},i.equals=function(t,i,n){void 0===n&&(n=qn);var e=t.x,r=t.y,s=t.z,h=i.x,u=i.y,o=i.z;return xe(e-h)<=n*Ge(1,xe(e),xe(h))&&xe(r-u)<=n*Ge(1,xe(r),xe(u))&&xe(s-o)<=n*Ge(1,xe(s),xe(o))},i.angle=function(t,i){var n=t.x*t.x+t.y*t.y+t.z*t.z,e=i.x*i.x+i.y*i.y+i.z*i.z;if(0===n||0===e)return 0;var r=(t.x*i.x+t.y*i.y+t.z*i.z)/ze(n*e);return r=Jn(r,-1,1),Ve(r)},i.projectOnPlane=function(t,n,e){return i.subtract(t,n,i.project(t,n,e))},i.project=function(t,n,e){var r=i.lengthSqr(e);return r<1e-6?i.set(t,0,0,0):i.multiplyScalar(t,e,i.dot(n,e)/r)},i.moveTowards=function(t,i,n,e){var r=n.x-i.x,s=n.y-i.y,h=n.z-i.z,u=r*r+s*s+h*h;if(0===u||e>=0&&u<e*e)return t.x=n.x,t.y=n.y,t.z=n.z,t;var o=e/ze(u);return t.x=i.x+r*o,t.y=i.y+s*o,t.z=i.z+h*o,t},i.generateOrthogonal=function(t,n){var e=n.x,r=n.y,s=n.z,h=xe(e),u=xe(r),o=xe(s);return h<u&&h<o?i.set(t,0,s,-r):u<o?i.set(t,s,0,-e):i.set(t,r,-e,0),i.normalize(t,t)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z)},n.set=function(t,i,n){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=i||0,this.z=n||0),this},n.equals=function(t,i){return void 0===i&&(i=qn),xe(this.x-t.x)<=i&&xe(this.y-t.y)<=i&&xe(this.z-t.z)<=i},n.equals3f=function(t,i,n,e){return void 0===e&&(e=qn),xe(this.x-t)<=e&&xe(this.y-i)<=e&&xe(this.z-n)<=e},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},n.strictEquals3f=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},n.lerp=function(t,i){return this.x+=i*(t.x-this.x),this.y+=i*(t.y-this.y),this.z+=i*(t.z-this.z),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add3f=function(t,i,n){return this.x+=t,this.y+=i,this.z+=n,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.subtract3f=function(t,i,n){return this.x-=t,this.y-=i,this.z-=n,this},n.multiplyScalar=function(t){return"object"==typeof t&&st(16357),this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return"object"!=typeof t&&st(16358),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.multiply3f=function(t,i,n){return this.x*=t,this.y*=i,this.z*=n,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},n.divide3f=function(t,i,n){return this.x/=t,this.y/=i,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(t,i){return this.x=Jn(this.x,t.x,i.x),this.y=Jn(this.y,t.y,i.y),this.z=Jn(this.z,t.z,i.z),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t){var i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,h=t.z;return this.x=n*h-e*s,this.y=e*r-i*h,this.z=i*s-n*r,this},n.length=function(){var t=this;return ze(t.x*t.x+t.y*t.y+t.z*t.z)},n.lengthSqr=function(){var t=this;return t.x*t.x+t.y*t.y+t.z*t.z},n.normalize=function(){var t=this,i=t.x,n=t.y,e=t.z,r=i*i+n*n+e*e;return r>0&&(r=1/ze(r),t.x=i*r,t.y=n*r,t.z=e*r),t},n.transformMat4=function(t){var i=this,n=i.x,e=i.y,r=i.z,s=t.m03*n+t.m07*e+t.m11*r+t.m15;return s=s?1/s:1,i.x=(t.m00*n+t.m04*e+t.m08*r+t.m12)*s,i.y=(t.m01*n+t.m05*e+t.m09*r+t.m13)*s,i.z=(t.m02*n+t.m06*e+t.m10*r+t.m14)*s,i},n.toVec2=function(){return new T.Vec2(this.x,this.y)},i}(Pi));function nr(t,i,n){return new ir(t,i,n)}Be=ir,ir.UNIT_X=qe(1,0,0),ir.UNIT_Y=qe(0,1,0),ir.UNIT_Z=qe(0,0,1),ir.RIGHT=qe(1,0,0),ir.UP=qe(0,1,0),ir.FORWARD=qe(0,0,-1),ir.ZERO=qe(0,0,0),ir.ONE=qe(1,1,1),ir.NEG_ONE=qe(-1,-1,-1),ir.slerp=(Qe=new Be,Ze=new Be,Je=new Be,function(t,i,n,e){var r=1e-5,s=Be.len(i),h=Be.len(n);if(s<r||h<r)return Be.lerp(t,i,n,e);var u=ie(s,h,e),o=Be.dot(i,n)/(s*h);if(o>.99999)return Be.lerp(t,i,n,e);if(o<-.99999){var a=Be.multiplyScalar(Qe,i,1/s),c=Be.generateOrthogonal(Ze,a);return rr(Je,a,c,He*e),Be.multiplyScalar(t,Je,u),t}var f=o,v=Ve(f)*e,l=Be.multiplyScalar(Qe,i,1/s),d=Be.multiplyScalar(Ze,n,1/h);return Be.scaleAndAdd(Je,d,l,-f),Be.normalize(Je,Je),Be.multiplyScalar(Je,Je,$e(v)),Be.scaleAndAdd(Je,Je,l,We(v)),Be.multiplyScalar(t,Je,u),t}),ir.signedAngle=(tr=new Be,function(t,i,n){var e=Be.angle(t,i),r=Be.cross(tr,t,i);return Be.dot(r,n)<0?-e:e}),Un.fastDefine("cc.Vec3",ir,{x:0,y:0,z:0}),T.Vec3=ir;var er,rr=(er={x:0,y:0,z:0,w:0},function(t,i,n,e){var r=.5*e,s=$e(r);return er.x=s*n.x,er.y=s*n.y,er.z=s*n.z,er.w=We(r),ir.transformQuat(t,i,er),t});T.v3=nr;var sr=1/255,hr=Math.abs,ur=Math.max;function or(t,i,n,e){return Object.freeze(new cr(t,i,n,e))}var ar,cr=t("Color",function(t){function i(i,n,e,r){var s;return(s=t.call(this)||this).I=new Uint8ClampedArray(4),"string"==typeof i?s.fromHEX(i):void 0!==n?s.set(i,n,e,r):s.set(i),s}s(i,t),i.clone=function(t){var n=new i;return n.r=t.r,n.g=t.g,n.b=t.b,n.a=t.a,n},i.copy=function(t,i){return t.r=i.r,t.g=i.g,t.b=i.b,t.a=i.a,t},i.set=function(t,i,n,e,r){return t.r=i,t.g=n,t.b=e,t.a=r,t},i.toVec4=function(t,i){var n=t.I;return(i=void 0!==i?i:new De).x=n[0]*sr,i.y=n[1]*sr,i.z=n[2]*sr,i.w=n[3]*sr,i},i.fromVec4=function(t,n){var e=(n=void 0===n?new i:n).I;return e[0]=t.x/sr,e[1]=t.y/sr,e[2]=t.z/sr,e[3]=t.w/sr,n},i.fromHEX=function(t,i){var n;return"string"==typeof i?(6===(i="#"===i[0]?i.substring(1):i).length?i+="FF":3===i.length?i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]+"FF":4===i.length&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]+i[3]+i[3]),n=Number("0x"+i)):(i<16777216&&(i=255+(i<<8)),n=i),t.r=n>>>24,t.g=(16711680&n)>>>16,t.b=(65280&n)>>>8,t.a=255&n,t},i.add=function(t,i,n){return t.r=i.r+n.r,t.g=i.g+n.g,t.b=i.b+n.b,t.a=i.a+n.a,t},i.subtract=function(t,i,n){return t.r=i.r-n.r,t.g=i.g-n.g,t.b=i.b-n.b,t.a=i.a-n.a,t},i.multiply=function(t,i,n){return t.r=i.r*n.r,t.g=i.g*n.g,t.b=i.b*n.b,t.a=i.a*n.a,t},i.divide=function(t,i,n){return t.r=i.r/n.r,t.g=i.g/n.g,t.b=i.b/n.b,t.a=i.a/n.a,t},i.scale=function(t,i,n){return t.r=i.r*n,t.g=i.g*n,t.b=i.b*n,t.a=i.a*n,t},i.lerp=function(t,i,n,e){var r=i.r,s=i.g,h=i.b,u=i.a;return t.r=r+(n.r-r)*e,t.g=s+(n.g-s)*e,t.b=h+(n.b-h)*e,t.a=u+(n.a-u)*e,t},i.toArray=function(t,n,e){void 0===e&&(e=0);var r=n instanceof i||n.a>1?1/255:1;return t[e+0]=n.r*r,t[e+1]=n.g*r,t[e+2]=n.b*r,t[e+3]=n.a*r,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),i.r=255*t[n+0],i.g=255*t[n+1],i.b=255*t[n+2],i.a=255*t[n+3],i},i.fromUint32=function(t,i){return i>>>=0,t.r=255&i,t.g=i>>8&255,t.b=i>>16&255,t.a=i>>24&255,t},i.toUint32=function(t){return(t.a<<24|t.b<<16|t.g<<8|t.r)>>>0},i.strictEquals=function(t,i){return t.r===i.r&&t.g===i.g&&t.b===i.b&&t.a===i.a},i.equals=function(t,i,n){return void 0===n&&(n=qn),!(hr(t.r)===1/0||hr(t.g)===1/0||hr(t.b)===1/0||hr(t.a)===1/0)&&hr(t.r-i.r)<=n*ur(1,hr(t.r),hr(i.r))&&hr(t.g-i.g)<=n*ur(1,hr(t.g),hr(i.g))&&hr(t.b-i.b)<=n*ur(1,hr(t.b),hr(i.b))&&hr(t.a-i.a)<=n*ur(1,hr(t.a),hr(i.a))},i.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0};var n=i.prototype;return n.clone=function(){var t=new i;return t.I.set(this.I),t},n.equals=function(t){var i=t,n=this.I;return t&&n[0]===i.r&&n[1]===i.g&&n[2]===i.b&&n[3]===i.a},n.lerp=function(t,n){return i.lerp(this,this,t,n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*sr).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},n.fromHEX=function(t){var i;return"string"==typeof t?(6===(t="#"===t[0]?t.substring(1):t).length?t+="FF":3===t.length?t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+"FF":4===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),i=Number("0x"+t)):(t<16777216&&(t=255+(t<<8)),i=t),this.r=i>>>24,this.g=(16711680&i)>>>16,this.b=(65280&i)>>>8,this.a=255&i,this},n.toHEX=function(t){void 0===t&&(t="#rrggbb");var i=this.I,n="0",e=[(i[0]<16?n:"")+i[0].toString(16),(i[1]<16?n:"")+i[1].toString(16),(i[2]<16?n:"")+i[2].toString(16)];return"#rgb"===t?(e[0]=e[0][0],e[1]=e[1][0],e[2]=e[2][0]):"#rrggbbaa"===t&&e.push((i[3]<16?n:"")+i[3].toString(16)),e.join("")},n.toRGBValue=function(){return this.I[2]<<16|this.I[1]<<8|this.I[0]},n.fromHSV=function(t,i,n){var e=0,r=0,s=0;if(0===i)e=r=s=n;else if(0===n)e=r=s=0;else{1===t&&(t=0),t*=6;var h=Math.floor(t),u=t-h,o=n*(1-i),a=n*(1-i*u),c=n*(1-i*(1-u));switch(h){default:case 0:e=n,r=c,s=o;break;case 1:e=a,r=n,s=o;break;case 2:e=o,r=n,s=c;break;case 3:e=o,r=a,s=n;break;case 4:e=c,r=o,s=n;break;case 5:e=n,r=o,s=a}}var f=this.I;return f[0]=255*e,f[1]=255*r,f[2]=255*s,this},n.toHSV=function(){var t=this.I[0]*sr,i=this.I[1]*sr,n=this.I[2]*sr,e={h:0,s:0,v:0},r=Math.max(t,i,n),s=Math.min(t,i,n),h=0;return e.v=r,e.s=r?(r-s)/r:0,e.s?(h=r-s,e.h=t===r?(i-n)/h:i===r?2+(n-t)/h:4+(t-i)/h,e.h/=6,e.h<0&&(e.h+=1)):e.h=0,e},n.set=function(t,i,n,e){var r=this.I;if("object"==typeof t){var s,h,u,o,a=t;a.I?r.set(a.I):(r[0]=null!==(s=a.r)&&void 0!==s?s:0,r[1]=null!==(h=a.g)&&void 0!==h?h:0,r[2]=null!==(u=a.b)&&void 0!==u?u:0,r[3]=null!==(o=a.a)&&void 0!==o?o:255)}else r[0]=null!=t?t:0,r[1]=null!=i?i:0,r[2]=null!=n?n:0,r[3]=null!=e?e:255;return this},n.multiply=function(t){var i=this.I;return i[0]*=t.r/255,i[1]*=t.g/255,i[2]*=t.b/255,i[3]*=t.a/255,this},n.getModifiableProperties=function(){return["r","g","b","a"]},e(i,[{key:"r",get:function(){return this.I[0]},set:function(t){this.I[0]=t}},{key:"g",get:function(){return this.I[1]},set:function(t){this.I[1]=t}},{key:"b",get:function(){return this.I[2]},set:function(t){this.I[2]=t}},{key:"a",get:function(){return this.I[3]},set:function(t){this.I[3]=t}},{key:"x",get:function(){return this.I[0]*sr},set:function(t){this.I[0]=255*t}},{key:"y",get:function(){return this.I[1]*sr},set:function(t){this.I[1]=255*t}},{key:"z",get:function(){return this.I[2]*sr},set:function(t){this.I[2]=255*t}},{key:"w",get:function(){return this.I[3]*sr},set:function(t){this.I[3]=255*t}}]),i}(Pi));function fr(t,i,n,e){return new cr(t,i,n,e)}function vr(t,i,n){if(i>n){var e=i;i=n,n=e}return t<i?i:t>n?n:t}function lr(t){var i=t.clone();return i.x=Math.floor(t.x),i.y=Math.floor(t.y),i.z=Math.floor(t.z),i}function dr(t){var i=Math.max(Math.max(t.x,t.y),t.z),n=128;i>1e-4&&(n=Math.log(i)/Math.log(1.1),n=Jn((n=Math.ceil(n))+128,0,255));var e=1/Math.pow(1.1,n-128),r=vr(t.multiplyScalar(e),new ir(0,0,0),new ir(1,1,1));r.multiplyScalar(255);var s,h,u=lr(r).add((s=r.subtract(lr(r)))<(h=new ir(.5,.5,.5))?h:s);return new De(u.x/255,u.y/255,u.z/255,n/255)}cr.WHITE=or(255,255,255,255),cr.GRAY=or(127,127,127,255),cr.BLACK=or(0,0,0,255),cr.TRANSPARENT=or(0,0,0,0),cr.RED=or(255,0,0,255),cr.GREEN=or(0,255,0,255),cr.BLUE=or(0,0,255,255),cr.CYAN=or(0,255,255,255),cr.MAGENTA=or(255,0,255,255),cr.YELLOW=or(255,255,0,255),Un.fastDefine("cc.Color",cr,{r:0,g:0,b:0,a:255}),T.Color=cr,T.color=fr;var gr=Math.abs,wr=Math.max,_r=t("Mat3",function(t){function i(i,n,e,r,s,h,u,o,a){var c;void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=1);var v=f(c=t.call(this)||this);return"object"==typeof i?(v.m00=i.m00,v.m01=i.m01,v.m02=i.m02,v.m03=i.m03,v.m04=i.m04,v.m05=i.m05,v.m06=i.m06,v.m07=i.m07,v.m08=i.m08):(v.m00=i,v.m01=n,v.m02=e,v.m03=r,v.m04=s,v.m05=h,v.m06=u,v.m07=o,v.m08=a),c}s(i,t),i.clone=function(t){return new i(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},i.copy=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t},i.set=function(t,i,n,e,r,s,h,u,o,a){return t.m00=i,t.m01=n,t.m02=e,t.m03=r,t.m04=s,t.m05=h,t.m06=u,t.m07=o,t.m08=a,t},i.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.transpose=function(t,i){if(t===i){var n=i.m01,e=i.m02,r=i.m05;t.m01=i.m03,t.m02=i.m06,t.m03=n,t.m05=i.m07,t.m06=e,t.m07=r}else t.m00=i.m00,t.m01=i.m03,t.m02=i.m06,t.m03=i.m01,t.m04=i.m04,t.m05=i.m07,t.m06=i.m02,t.m07=i.m05,t.m08=i.m08;return t},i.invert=function(t,n){var e=n.m00,r=n.m01,s=n.m02,h=n.m03,u=n.m04,o=n.m05,a=n.m06,c=n.m07,f=n.m08,v=f*u-o*c,l=-f*h+o*a,d=c*h-u*a,g=e*v+r*l+s*d;return 0===g?(i.set(t,0,0,0,0,0,0,0,0,0),t):(g=1/g,t.m00=v*g,t.m01=(-f*r+s*c)*g,t.m02=(o*r-s*u)*g,t.m03=l*g,t.m04=(f*e-s*a)*g,t.m05=(-o*e+s*h)*g,t.m06=d*g,t.m07=(-c*e+r*a)*g,t.m08=(u*e-r*h)*g,t)},i.determinant=function(t){var i=t.m00,n=t.m01,e=t.m02,r=t.m03,s=t.m04,h=t.m05,u=t.m06,o=t.m07,a=t.m08;return i*(a*s-h*o)+n*(-a*r+h*u)+e*(o*r-s*u)},i.multiply=function(t,i,n){var e=i.m00,r=i.m01,s=i.m02,h=i.m03,u=i.m04,o=i.m05,a=i.m06,c=i.m07,f=i.m08,v=n.m00,l=n.m01,d=n.m02,g=n.m03,w=n.m04,_=n.m05,m=n.m06,p=n.m07,y=n.m08;return t.m00=v*e+l*h+d*a,t.m01=v*r+l*u+d*c,t.m02=v*s+l*o+d*f,t.m03=g*e+w*h+_*a,t.m04=g*r+w*u+_*c,t.m05=g*s+w*o+_*f,t.m06=m*e+p*h+y*a,t.m07=m*r+p*u+y*c,t.m08=m*s+p*o+y*f,t},i.multiplyMat4=function(t,i,n){var e=i.m00,r=i.m01,s=i.m02,h=i.m03,u=i.m04,o=i.m05,a=i.m06,c=i.m07,f=i.m08,v=n.m00,l=n.m01,d=n.m02,g=n.m04,w=n.m05,_=n.m06,m=n.m08,p=n.m09,y=n.m10;return t.m00=v*e+l*h+d*a,t.m01=v*r+l*u+d*c,t.m02=v*s+l*o+d*f,t.m03=g*e+w*h+_*a,t.m04=g*r+w*u+_*c,t.m05=g*s+w*o+_*f,t.m06=m*e+p*h+y*a,t.m07=m*r+p*u+y*c,t.m08=m*s+p*o+y*f,t},i.transform=function(t,i,n){this.translate(t,i,n)},i.translate=function(t,i,n){var e=i.m00,r=i.m01,s=i.m02,h=i.m03,u=i.m04,o=i.m05,a=i.m06,c=i.m07,f=i.m08,v=n.x,l=n.y;return t.m00=e,t.m01=r,t.m02=s,t.m03=h,t.m04=u,t.m05=o,t.m06=v*e+l*h+a,t.m07=v*r+l*u+c,t.m08=v*s+l*o+f,t},i.scale=function(t,i,n){var e=n.x,r=n.y;return t.m00=e*i.m00,t.m01=e*i.m01,t.m02=e*i.m02,t.m03=r*i.m03,t.m04=r*i.m04,t.m05=r*i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t},i.rotate=function(t,i,n){var e=i.m00,r=i.m01,s=i.m02,h=i.m03,u=i.m04,o=i.m05,a=i.m06,c=i.m07,f=i.m08,v=Math.sin(n),l=Math.cos(n);return t.m00=l*e+v*h,t.m01=l*r+v*u,t.m02=l*s+v*o,t.m03=l*h-v*e,t.m04=l*u-v*r,t.m05=l*o-v*s,t.m06=a,t.m07=c,t.m08=f,t},i.fromMat4=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m04,t.m04=i.m05,t.m05=i.m06,t.m06=i.m08,t.m07=i.m09,t.m08=i.m10,t},i.fromViewUp=function(t,n,e){return ir.lengthSqr(n)<qn*qn?(i.identity(t),t):(e=e||ir.UNIT_Y,ir.normalize(pr,ir.cross(pr,e,n)),ir.lengthSqr(pr)<qn*qn?(i.identity(t),t):(ir.cross(yr,n,pr),i.set(t,pr.x,pr.y,pr.z,yr.x,yr.y,yr.z,n.x,n.y,n.z),t))},i.fromTranslation=function(t,i){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=i.x,t.m07=i.y,t.m08=1,t},i.fromScaling=function(t,i){return t.m00=i.x,t.m01=0,t.m02=0,t.m03=0,t.m04=i.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.fromRotation=function(t,i){var n=Math.sin(i),e=Math.cos(i);return t.m00=e,t.m01=n,t.m02=0,t.m03=-n,t.m04=e,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.fromQuat=function(t,i){var n=i.x,e=i.y,r=i.z,s=i.w,h=n+n,u=e+e,o=r+r,a=n*h,c=e*h,f=e*u,v=r*h,l=r*u,d=r*o,g=s*h,w=s*u,_=s*o;return t.m00=1-f-d,t.m03=c-_,t.m06=v+w,t.m01=c+_,t.m04=1-a-d,t.m07=l-g,t.m02=v-w,t.m05=l+g,t.m08=1-a-f,t},i.inverseTransposeMat4=function(t,i){var n=i.m00,e=i.m01,r=i.m02,s=i.m03,h=i.m04,u=i.m05,o=i.m06,a=i.m07,c=i.m08,f=i.m09,v=i.m10,l=i.m11,d=i.m12,g=i.m13,w=i.m14,_=i.m15,m=n*u-e*h,p=n*o-r*h,y=n*a-s*h,b=e*o-r*u,A=e*a-s*u,E=r*a-s*o,k=c*g-f*d,T=c*w-v*d,S=c*_-l*d,O=f*w-v*g,R=f*_-l*g,I=v*_-l*w,M=m*I-p*R+y*O+b*S-A*T+E*k;return M?(M=1/M,t.m00=(u*I-o*R+a*O)*M,t.m01=(o*S-h*I-a*T)*M,t.m02=(h*R-u*S+a*k)*M,t.m03=(r*R-e*I-s*O)*M,t.m04=(n*I-r*S+s*T)*M,t.m05=(e*S-n*R-s*k)*M,t.m06=(g*E-w*A+_*b)*M,t.m07=(w*y-d*E-_*p)*M,t.m08=(d*A-g*y+_*m)*M,t):null},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.m00,t[n+1]=i.m01,t[n+2]=i.m02,t[n+3]=i.m03,t[n+4]=i.m04,t[n+5]=i.m05,t[n+6]=i.m06,t[n+7]=i.m07,t[n+8]=i.m08,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.m00=i[n+0],t.m01=i[n+1],t.m02=i[n+2],t.m03=i[n+3],t.m04=i[n+4],t.m05=i[n+5],t.m06=i[n+6],t.m07=i[n+7],t.m08=i[n+8],t},i.add=function(t,i,n){return t.m00=i.m00+n.m00,t.m01=i.m01+n.m01,t.m02=i.m02+n.m02,t.m03=i.m03+n.m03,t.m04=i.m04+n.m04,t.m05=i.m05+n.m05,t.m06=i.m06+n.m06,t.m07=i.m07+n.m07,t.m08=i.m08+n.m08,t},i.subtract=function(t,i,n){return t.m00=i.m00-n.m00,t.m01=i.m01-n.m01,t.m02=i.m02-n.m02,t.m03=i.m03-n.m03,t.m04=i.m04-n.m04,t.m05=i.m05-n.m05,t.m06=i.m06-n.m06,t.m07=i.m07-n.m07,t.m08=i.m08-n.m08,t},i.multiplyScalar=function(t,i,n){return t.m00=i.m00*n,t.m01=i.m01*n,t.m02=i.m02*n,t.m03=i.m03*n,t.m04=i.m04*n,t.m05=i.m05*n,t.m06=i.m06*n,t.m07=i.m07*n,t.m08=i.m08*n,t},i.multiplyScalarAndAdd=function(t,i,n,e){return t.m00=n.m00*e+i.m00,t.m01=n.m01*e+i.m01,t.m02=n.m02*e+i.m02,t.m03=n.m03*e+i.m03,t.m04=n.m04*e+i.m04,t.m05=n.m05*e+i.m05,t.m06=n.m06*e+i.m06,t.m07=n.m07*e+i.m07,t.m08=n.m08*e+i.m08,t},i.strictEquals=function(t,i){return t.m00===i.m00&&t.m01===i.m01&&t.m02===i.m02&&t.m03===i.m03&&t.m04===i.m04&&t.m05===i.m05&&t.m06===i.m06&&t.m07===i.m07&&t.m08===i.m08},i.equals=function(t,i,n){return void 0===n&&(n=qn),gr(t.m00-i.m00)<=n*wr(1,gr(t.m00),gr(i.m00))&&gr(t.m01-i.m01)<=n*wr(1,gr(t.m01),gr(i.m01))&&gr(t.m02-i.m02)<=n*wr(1,gr(t.m02),gr(i.m02))&&gr(t.m03-i.m03)<=n*wr(1,gr(t.m03),gr(i.m03))&&gr(t.m04-i.m04)<=n*wr(1,gr(t.m04),gr(i.m04))&&gr(t.m05-i.m05)<=n*wr(1,gr(t.m05),gr(i.m05))&&gr(t.m06-i.m06)<=n*wr(1,gr(t.m06),gr(i.m06))&&gr(t.m07-i.m07)<=n*wr(1,gr(t.m07),gr(i.m07))&&gr(t.m08-i.m08)<=n*wr(1,gr(t.m08),gr(i.m08))},i.toEuler=function(t,i){var n=t.m00,e=t.m01;t.m02;var r=t.m03,s=t.m04;t.m05;var h=t.m06,u=t.m07,o=t.m08;return u<.999?u>-.999?(i.x=Math.asin(-u),i.y=Math.atan2(h,o),i.z=Math.atan2(e,s),!0):(i.x=Yn,i.y=Math.atan2(r,n),i.z=0,!1):(i.x=-Yn,i.y=Math.atan2(-r,n),i.z=0,!1)};var n=i.prototype;return n.clone=function(){return new i(this)},n.set=function(t,i,n,e,r,s,h,u,o){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=1);var a=this;return"object"==typeof t?(a.m00=t.m00,a.m01=t.m01,a.m02=t.m02,a.m03=t.m03,a.m04=t.m04,a.m05=t.m05,a.m06=t.m06,a.m07=t.m07,a.m08=t.m08):(a.m00=t,a.m01=i,a.m02=n,a.m03=e,a.m04=r,a.m05=s,a.m06=h,a.m07=u,a.m08=o),a},n.equals=function(t,n){return void 0===n&&(n=qn),i.equals(this,t,n)},n.strictEquals=function(t){return i.strictEquals(this,t)},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+", "+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+", "+t.m08+"\n]"},n.identity=function(){return i.identity(this)},n.transpose=function(){var t=this,i=t.m01,n=t.m02,e=t.m05;return t.m01=t.m03,t.m02=t.m06,t.m03=i,t.m05=t.m07,t.m06=n,t.m07=e,t},n.invert=function(){return i.invert(this,this)},n.determinant=function(){return i.determinant(this)},n.add=function(t){var i=this;return i.m00+=t.m00,i.m01+=t.m01,i.m02+=t.m02,i.m03+=t.m03,i.m04+=t.m04,i.m05+=t.m05,i.m06+=t.m06,i.m07+=t.m07,i.m08+=t.m08,i},n.subtract=function(t){var i=this;return i.m00-=t.m00,i.m01-=t.m01,i.m02-=t.m02,i.m03-=t.m03,i.m04-=t.m04,i.m05-=t.m05,i.m06-=t.m06,i.m07-=t.m07,i.m08-=t.m08,i},n.multiply=function(t){return i.multiply(this,this,t)},n.multiplyScalar=function(t){var i=this;return i.m00*=t,i.m01*=t,i.m02*=t,i.m03*=t,i.m04*=t,i.m05*=t,i.m06*=t,i.m07*=t,i.m08*=t,i},n.scale=function(t){var i=t.x,n=t.y,e=this;return e.m00*=i,e.m01*=i,e.m02*=i,e.m03*=n,e.m04*=n,e.m05*=n,e},n.rotate=function(t){var i=this,n=i.m00,e=i.m01,r=i.m02,s=i.m03,h=i.m04,u=i.m05,o=i.m06,a=i.m07,c=i.m08,f=Math.sin(t),v=Math.cos(t);return i.m00=v*n+f*s,i.m01=v*e+f*h,i.m02=v*r+f*u,i.m03=v*s-f*n,i.m04=v*h-f*e,i.m05=v*u-f*r,i.m06=o,i.m07=a,i.m08=c,i},n.fromQuat=function(t){var i=t.x,n=t.y,e=t.z,r=t.w,s=i+i,h=n+n,u=e+e,o=i*s,a=n*s,c=n*h,f=e*s,v=e*h,l=e*u,d=r*s,g=r*h,w=r*u,_=this;return _.m00=1-c-l,_.m03=a-w,_.m06=f+g,_.m01=a+w,_.m04=1-o-l,_.m07=v-d,_.m02=f-g,_.m05=v+d,_.m08=1-o-c,_},i}(Pi));ar=_r,_r.IDENTITY=Object.freeze(new ar);var mr,pr=new ir,yr=new ir;Un.fastDefine("cc.Mat3",_r,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),T.Mat3=_r;var br=Math.abs,Ar=Math.max,Er=Math.min,kr=Math.PI,Tr=Math.acos,Sr=Math.sin,Or=Math.cos,Rr=Math.sqrt,Ir=Math.atan2,Mr=Math.asin,Nr=Math.sign,Cr=t("Quat",function(t){function i(i,n,e,r){var s;return s=t.call(this)||this,"object"==typeof i?(s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w):(s.x=i||0,s.y=n||0,s.z=e||0,s.w=null!=r?r:1),s}s(i,t),i.clone=function(t){return new i(t.x,t.y,t.z,t.w)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=i.w,t},i.set=function(t,i,n,e,r){return t.x=i,t.y=n,t.z=e,t.w=r,t},i.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},i.rotationTo=function(t,n,e){var r=ir.dot(n,e);return r<-.999999?(ir.cross(Br,ir.UNIT_X,n),Br.length()<1e-6&&ir.cross(Br,ir.UNIT_Y,n),ir.normalize(Br,Br),i.fromAxisAngle(t,Br,kr),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(ir.cross(Br,n,e),t.x=Br.x,t.y=Br.y,t.z=Br.z,t.w=1+r,i.normalize(t,t))},i.getAxisAngle=function(t,i){var n=2*Tr(i.w),e=Sr(n/2);return 0!==e?(t.x=i.x/e,t.y=i.y/e,t.z=i.z/e):(t.x=1,t.y=0,t.z=0),n},i.multiply=function(t,i,n){var e=i.x*n.w+i.w*n.x+i.y*n.z-i.z*n.y,r=i.y*n.w+i.w*n.y+i.z*n.x-i.x*n.z,s=i.z*n.w+i.w*n.z+i.x*n.y-i.y*n.x,h=i.w*n.w-i.x*n.x-i.y*n.y-i.z*n.z;return t.x=e,t.y=r,t.z=s,t.w=h,t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.scaleAndAdd=function(t,i,n,e){return t.x=i.x+n.x*e,t.y=i.y+n.y*e,t.z=i.z+n.z*e,t.w=i.w+n.w*e,t},i.rotateX=function(t,i,n){var e=Sr(n*=.5),r=Or(n),s=i.x,h=i.y,u=i.z,o=i.w;return t.x=s*r+o*e,t.y=h*r+u*e,t.z=u*r-h*e,t.w=o*r-s*e,t},i.rotateY=function(t,i,n){var e=Sr(n*=.5),r=Or(n),s=i.x,h=i.y,u=i.z,o=i.w;return t.x=s*r-u*e,t.y=h*r+o*e,t.z=u*r+s*e,t.w=o*r-h*e,t},i.rotateZ=function(t,i,n){var e=Sr(n*=.5),r=Or(n),s=i.x,h=i.y,u=i.z,o=i.w;return t.x=s*r+h*e,t.y=h*r-s*e,t.z=u*r+o*e,t.w=o*r-u*e,t},i.rotateAround=function(t,n,e,r){return i.invert(Fr,n),ir.transformQuat(Br,e,Fr),i.fromAxisAngle(Fr,Br,r),i.multiply(t,n,Fr),t},i.rotateAroundLocal=function(t,n,e,r){return i.fromAxisAngle(Fr,e,r),i.multiply(t,n,Fr),t},i.calculateW=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=Rr(br(1-i.x*i.x-i.y*i.y-i.z*i.z)),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w},i.lerp=function(t,i,n,e){return t.x=i.x+e*(n.x-i.x),t.y=i.y+e*(n.y-i.y),t.z=i.z+e*(n.z-i.z),t.w=i.w+e*(n.w-i.w),t},i.slerp=function(t,i,n,e){var r=0,s=0,h=n.x,u=n.y,o=n.z,a=n.w,c=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w;if(c<0&&(c=-c,h=-h,u=-u,o=-o,a=-a),1-c>1e-6){var f=Tr(c),v=Sr(f);r=Sr((1-e)*f)/v,s=Sr(e*f)/v}else r=1-e,s=e;return t.x=r*i.x+s*h,t.y=r*i.y+s*u,t.z=r*i.z+s*o,t.w=r*i.w+s*a,t},i.sqlerp=function(t,n,e,r,s,h){return i.slerp(Fr,n,s,h),i.slerp(Pr,e,r,h),i.slerp(t,Fr,Pr,2*h*(1-h)),t},i.invert=function(t,i){var n=i.x*i.x+i.y*i.y+i.z*i.z+i.w*i.w,e=n?1/n:0;return t.x=-i.x*e,t.y=-i.y*e,t.z=-i.z*e,t.w=i.w*e,t},i.conjugate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t.w=i.w,t},i.len=function(t){return Rr(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},i.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},i.normalize=function(t,i){var n=i.x*i.x+i.y*i.y+i.z*i.z+i.w*i.w;return n>0?(n=1/Rr(n),t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n):(t.x=0,t.y=0,t.z=0,t.w=0),t},i.fromAxes=function(t,n,e,r){return _r.set(Dr,n.x,n.y,n.z,e.x,e.y,e.z,r.x,r.y,r.z),i.normalize(t,i.fromMat3(t,Dr))},i.fromViewUp=function(t,n,e){return _r.fromViewUp(Dr,n,e),i.normalize(t,i.fromMat3(t,Dr))},i.fromAxisAngle=function(t,i,n){var e=Sr(n*=.5);return t.x=e*i.x,t.y=e*i.y,t.z=e*i.z,t.w=Or(n),t},i.fromMat3=function(t,i){var n=i.m00,e=i.m01,r=i.m02,s=i.m03,h=i.m04,u=i.m05,o=i.m06,a=i.m07,c=i.m08,f=n-h-c,v=h-n-c,l=c-n-h,d=0,g=n+h+c;f>g&&(g=f,d=1),v>g&&(g=v,d=2),l>g&&(g=l,d=3);var w=.5*Rr(g+1),_=.25/w;switch(d){case 0:t.w=w,t.x=(u-a)*_,t.y=(o-r)*_,t.z=(e-s)*_;break;case 1:t.w=(u-a)*_,t.x=w,t.y=(e+s)*_,t.z=(o+r)*_;break;case 2:t.w=(o-r)*_,t.x=(e+s)*_,t.y=w,t.z=(u+a)*_;break;case 3:t.w=(e-s)*_,t.x=(o+r)*_,t.y=(u+a)*_,t.z=w;break;default:t.w=1,t.x=0,t.y=0,t.z=0}return t},i.fromEuler=function(t,i,n,e){n*=Ur,e*=Ur;var r=Sr(i*=Ur),s=Or(i),h=Sr(n),u=Or(n),o=Sr(e),a=Or(e);return t.x=r*u*a+s*h*o,t.y=s*h*a+r*u*o,t.z=s*u*o-r*h*a,t.w=s*u*a-r*h*o,t},i.fromAngleZ=function(t,i){return i*=Ur,t.x=t.y=0,t.z=Sr(i),t.w=Or(i),t},i.toAxisX=function(t,i){var n=2*i.y,e=2*i.z;return t.x=1-n*i.y-e*i.z,t.y=n*i.x+e*i.w,t.z=e*i.x-n*i.w,t},i.toAxisY=function(t,i){var n=2*i.x,e=2*i.y,r=2*i.z;return t.x=e*i.x-r*i.w,t.y=1-n*i.x-r*i.z,t.z=r*i.y+n*i.w,t},i.toAxisZ=function(t,i){var n=2*i.x,e=2*i.y,r=2*i.z;return t.x=r*i.x+e*i.w,t.y=r*i.y-n*i.w,t.z=1-n*i.x-e*i.y,t},i.toEuler=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=i.w,u=0,o=0,a=0,c=e*r+s*h;if(c>.499999)u=0,o=ee(2*Ir(e,h)),a=90;else if(c<-.499999)u=0,o=-ee(2*Ir(e,h)),a=-90;else{var f=r*r,v=s*s;u=ee(Ir(2*e*h-2*r*s,1-e*e*2-2*v)),o=ee(Ir(2*r*h-2*e*s,1-2*f-2*v)),a=ee(Mr(2*c)),n&&(u=-180*Nr(u+1e-6)+u,o=-180*Nr(o+1e-6)+o,a=180*Nr(a+1e-6)-a)}return t.x=u,t.y=o,t.z=a,t},i.toEulerInYXZOrder=function(t,i){_r.fromQuat(Dr,i),_r.toEuler(Dr,t),t.x=ee(t.x),t.y=ee(t.y),t.z=ee(t.z)},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=i.w,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.w=i[n+3],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z&&t.w===i.w},i.equals=function(t,i,n){return void 0===n&&(n=qn),br(t.x-i.x)<=n*Ar(1,br(t.x),br(i.x))&&br(t.y-i.y)<=n*Ar(1,br(t.y),br(i.y))&&br(t.z-i.z)<=n*Ar(1,br(t.z),br(i.z))&&br(t.w-i.w)<=n*Ar(1,br(t.w),br(i.w))},i.angle=function(t,n){var e=Er(br(i.dot(t,n)),1);return 2*Tr(e)},i.rotateTowards=function(t,n,e,r){var s=i.angle(n,e);if(0===s)return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t;var h=Er(r/ee(s),1);return i.slerp(t,n,e,h)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z,this.w)},n.set=function(t,i,n,e){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=n||0,this.w=null!=e?e:1),this},n.equals=function(t,n){return void 0===n&&(n=qn),i.equals(this,t,n)},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.getEulerAngles=function(t){return i.toEuler(t,this)},n.lerp=function(t,i){var n=this;return n.x+=i*(t.x-n.x),n.y+=i*(t.y-n.y),n.z+=i*(t.z-n.z),n.w+=i*(t.w-n.w),n},n.slerp=function(t,n){return i.slerp(this,this,t,n)},n.length=function(){var t=this,i=t.x,n=t.y,e=t.z,r=t.w;return Rr(i*i+n*n+e*e+r*r)},n.lengthSqr=function(){var t=this,i=t.x,n=t.y,e=t.z,r=t.w;return i*i+n*n+e*e+r*r},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},i}(Pi));mr=Cr,Cr.IDENTITY=Object.freeze(new mr);var Lr,Fr=new Cr,Pr=new Cr,Br=new ir,Dr=new _r,Ur=.5*kr/180;function Gr(t,i,n,e){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),new Cr(t,i,n,e)}Un.fastDefine("cc.Quat",Cr,{x:0,y:0,z:0,w:1}),T.Quat=Cr,T.quat=Gr;var jr=Object.freeze,Hr=t("preTransforms",jr([jr([1,0,0,1]),jr([0,1,-1,0]),jr([-1,0,0,-1]),jr([0,-1,1,0])])),Vr=Math.abs,$r=Math.max,Wr=Math.sqrt,zr=Math.sin,Xr=Math.cos,Yr=Math.tan,Kr=t("Mat4",function(t){function i(i,n,e,r,s,h,u,o,a,c,v,l,d,g,w,_){var m;void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===v&&(v=1),void 0===l&&(l=0),void 0===d&&(d=0),void 0===g&&(g=0),void 0===w&&(w=0),void 0===_&&(_=1);var p=f(m=t.call(this)||this);return"object"==typeof i?(p.m00=i.m00,m.m01=i.m01,m.m02=i.m02,m.m03=i.m03,p.m04=i.m04,m.m05=i.m05,m.m06=i.m06,m.m07=i.m07,p.m08=i.m08,m.m09=i.m09,m.m10=i.m10,m.m11=i.m11,p.m12=i.m12,m.m13=i.m13,m.m14=i.m14,m.m15=i.m15):(p.m00=i,m.m01=n,m.m02=e,m.m03=r,p.m04=s,m.m05=h,m.m06=u,m.m07=o,p.m08=a,m.m09=c,m.m10=v,m.m11=l,p.m12=d,m.m13=g,m.m14=w,m.m15=_),m}s(i,t),i.clone=function(t){return new i(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},i.copy=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15,t},i.set=function(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g,w){return t.m00=i,t.m01=n,t.m02=e,t.m03=r,t.m04=s,t.m05=h,t.m06=u,t.m07=o,t.m08=a,t.m09=c,t.m10=f,t.m11=v,t.m12=l,t.m13=d,t.m14=g,t.m15=w,t},i.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.zero=function(t){return t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t},i.transpose=function(t,i){if(t===i){var n=i.m01,e=i.m02,r=i.m03,s=i.m06,h=i.m07,u=i.m11;t.m01=i.m04,t.m02=i.m08,t.m03=i.m12,t.m04=n,t.m06=i.m09,t.m07=i.m13,t.m08=e,t.m09=s,t.m11=i.m14,t.m12=r,t.m13=h,t.m14=u}else t.m00=i.m00,t.m01=i.m04,t.m02=i.m08,t.m03=i.m12,t.m04=i.m01,t.m05=i.m05,t.m06=i.m09,t.m07=i.m13,t.m08=i.m02,t.m09=i.m06,t.m10=i.m10,t.m11=i.m14,t.m12=i.m03,t.m13=i.m07,t.m14=i.m11,t.m15=i.m15;return t},i.invert=function(t,n){var e=n.m00,r=n.m01,s=n.m02,h=n.m03,u=n.m04,o=n.m05,a=n.m06,c=n.m07,f=n.m08,v=n.m09,l=n.m10,d=n.m11,g=n.m12,w=n.m13,_=n.m14,m=n.m15,p=e*o-r*u,y=e*a-s*u,b=e*c-h*u,A=r*a-s*o,E=r*c-h*o,k=s*c-h*a,T=f*w-v*g,S=f*_-l*g,O=f*m-d*g,R=v*_-l*w,I=v*m-d*w,M=l*m-d*_,N=p*M-y*I+b*R+A*O-E*S+k*T;return 0===N?i.zero(t):(N=1/N,t.m00=(o*M-a*I+c*R)*N,t.m01=(s*I-r*M-h*R)*N,t.m02=(w*k-_*E+m*A)*N,t.m03=(l*E-v*k-d*A)*N,t.m04=(a*O-u*M-c*S)*N,t.m05=(e*M-s*O+h*S)*N,t.m06=(_*b-g*k-m*y)*N,t.m07=(f*k-l*b+d*y)*N,t.m08=(u*I-o*O+c*T)*N,t.m09=(r*O-e*I-h*T)*N,t.m10=(g*E-w*b+m*p)*N,t.m11=(v*b-f*E-d*p)*N,t.m12=(o*S-u*R-a*T)*N,t.m13=(e*R-r*S+s*T)*N,t.m14=(w*y-g*A-_*p)*N,t.m15=(f*A-v*y+l*p)*N,t)},i.determinant=function(t){var i=t.m00,n=t.m01,e=t.m02,r=t.m03,s=t.m04,h=t.m05,u=t.m06,o=t.m07,a=t.m08,c=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,g=t.m14,w=t.m15;return(i*h-n*s)*(f*w-v*g)-(i*u-e*s)*(c*w-v*d)+(i*o-r*s)*(c*g-f*d)+(n*u-e*h)*(a*w-v*l)-(n*o-r*h)*(a*g-f*l)+(e*o-r*u)*(a*d-c*l)},i.multiply=function(t,i,n){var e=i.m00,r=i.m01,s=i.m02,h=i.m03,u=i.m04,o=i.m05,a=i.m06,c=i.m07,f=i.m08,v=i.m09,l=i.m10,d=i.m11,g=i.m12,w=i.m13,_=i.m14,m=i.m15,p=n.m00,y=n.m01,b=n.m02,A=n.m03;return t.m00=p*e+y*u+b*f+A*g,t.m01=p*r+y*o+b*v+A*w,t.m02=p*s+y*a+b*l+A*_,t.m03=p*h+y*c+b*d+A*m,p=n.m04,y=n.m05,b=n.m06,A=n.m07,t.m04=p*e+y*u+b*f+A*g,t.m05=p*r+y*o+b*v+A*w,t.m06=p*s+y*a+b*l+A*_,t.m07=p*h+y*c+b*d+A*m,p=n.m08,y=n.m09,b=n.m10,A=n.m11,t.m08=p*e+y*u+b*f+A*g,t.m09=p*r+y*o+b*v+A*w,t.m10=p*s+y*a+b*l+A*_,t.m11=p*h+y*c+b*d+A*m,p=n.m12,y=n.m13,b=n.m14,A=n.m15,t.m12=p*e+y*u+b*f+A*g,t.m13=p*r+y*o+b*v+A*w,t.m14=p*s+y*a+b*l+A*_,t.m15=p*h+y*c+b*d+A*m,t},i.transform=function(t,i,n){var e=n.x,r=n.y,s=n.z;if(i===t)t.m12=i.m00*e+i.m04*r+i.m08*s+i.m12,t.m13=i.m01*e+i.m05*r+i.m09*s+i.m13,t.m14=i.m02*e+i.m06*r+i.m10*s+i.m14,t.m15=i.m03*e+i.m07*r+i.m11*s+i.m15;else{var h=i.m00,u=i.m01,o=i.m02,a=i.m03,c=i.m04,f=i.m05,v=i.m06,l=i.m07,d=i.m08,g=i.m09,w=i.m10,_=i.m11;t.m00=h,t.m01=u,t.m02=o,t.m03=a,t.m04=c,t.m05=f,t.m06=v,t.m07=l,t.m08=d,t.m09=g,t.m10=w,t.m11=_,t.m12=h*e+c*r+d*s+i.m12,t.m13=u*e+f*r+g*s+i.m13,t.m14=o*e+v*r+w*s+i.m14,t.m15=a*e+l*r+_*s+i.m15}return t},i.translate=function(t,i,n){return i===t?(t.m12+=n.x,t.m13+=n.y,t.m14+=n.z):(t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12+n.x,t.m13=i.m13+n.y,t.m14=i.m14+n.z,t.m15=i.m15),t},i.scale=function(t,i,n){var e=n.x,r=n.y,s=n.z;return t.m00=i.m00*e,t.m01=i.m01*e,t.m02=i.m02*e,t.m03=i.m03*e,t.m04=i.m04*r,t.m05=i.m05*r,t.m06=i.m06*r,t.m07=i.m07*r,t.m08=i.m08*s,t.m09=i.m09*s,t.m10=i.m10*s,t.m11=i.m11*s,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15,t},i.rotate=function(t,i,n,e){var r=e.x,s=e.y,h=e.z,u=Wr(r*r+s*s+h*h);if(Vr(u)<qn)return null;r*=u=1/u,s*=u,h*=u;var o=zr(n),a=Xr(n),c=1-a,f=i.m00,v=i.m01,l=i.m02,d=i.m03,g=i.m04,w=i.m05,_=i.m06,m=i.m07,p=i.m08,y=i.m09,b=i.m10,A=i.m11,E=r*r*c+a,k=s*r*c+h*o,T=h*r*c-s*o,S=r*s*c-h*o,O=s*s*c+a,R=h*s*c+r*o,I=r*h*c+s*o,M=s*h*c-r*o,N=h*h*c+a;return t.m00=f*E+g*k+p*T,t.m01=v*E+w*k+y*T,t.m02=l*E+_*k+b*T,t.m03=d*E+m*k+A*T,t.m04=f*S+g*O+p*R,t.m05=v*S+w*O+y*R,t.m06=l*S+_*O+b*R,t.m07=d*S+m*O+A*R,t.m08=f*I+g*M+p*N,t.m09=v*I+w*M+y*N,t.m10=l*I+_*M+b*N,t.m11=d*I+m*M+A*N,i!==t&&(t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t},i.rotateX=function(t,i,n){var e=zr(n),r=Xr(n),s=i.m04,h=i.m05,u=i.m06,o=i.m07,a=i.m08,c=i.m09,f=i.m10,v=i.m11;return i!==t&&(t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m04=s*r+a*e,t.m05=h*r+c*e,t.m06=u*r+f*e,t.m07=o*r+v*e,t.m08=a*r-s*e,t.m09=c*r-h*e,t.m10=f*r-u*e,t.m11=v*r-o*e,t},i.rotateY=function(t,i,n){var e=zr(n),r=Xr(n),s=i.m00,h=i.m01,u=i.m02,o=i.m03,a=i.m08,c=i.m09,f=i.m10,v=i.m11;return i!==t&&(t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m00=s*r-a*e,t.m01=h*r-c*e,t.m02=u*r-f*e,t.m03=o*r-v*e,t.m08=s*e+a*r,t.m09=h*e+c*r,t.m10=u*e+f*r,t.m11=o*e+v*r,t},i.rotateZ=function(t,i,n){var e=zr(n),r=Xr(n),s=i.m00,h=i.m01,u=i.m02,o=i.m03,a=i.m04,c=i.m05,f=i.m06,v=i.m07;return i!==t&&(t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m00=s*r+a*e,t.m01=h*r+c*e,t.m02=u*r+f*e,t.m03=o*r+v*e,t.m04=a*r-s*e,t.m05=c*r-h*e,t.m06=f*r-u*e,t.m07=v*r-o*e,t},i.fromTranslation=function(t,n){return i.identity(t),t.m12=n.x,t.m13=n.y,t.m14=n.z,t},i.fromScaling=function(t,n){return i.identity(t),t.m00=n.x,t.m05=n.y,t.m10=n.z,t},i.fromRotation=function(t,i,n){var e=n.x,r=n.y,s=n.z,h=Wr(e*e+r*r+s*s);if(Vr(h)<qn)return null;e*=h=1/h,r*=h,s*=h;var u=zr(i),o=Xr(i),a=1-o;return t.m00=e*e*a+o,t.m01=r*e*a+s*u,t.m02=s*e*a-r*u,t.m03=0,t.m04=e*r*a-s*u,t.m05=r*r*a+o,t.m06=s*r*a+e*u,t.m07=0,t.m08=e*s*a+r*u,t.m09=r*s*a-e*u,t.m10=s*s*a+o,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.fromXRotation=function(t,n){var e=zr(n),r=Xr(n);return i.identity(t),t.m05=r,t.m06=e,t.m09=-e,t.m10=r,t},i.fromYRotation=function(t,n){var e=zr(n),r=Xr(n);return i.identity(t),t.m00=r,t.m02=-e,t.m08=e,t.m10=r,t},i.fromZRotation=function(t,n){var e=zr(n),r=Xr(n);return i.identity(t),t.m00=r,t.m01=e,t.m04=-e,t.m05=r,t},i.fromRT=function(t,i,n){var e=i.x,r=i.y,s=i.z,h=i.w,u=e+e,o=r+r,a=s+s,c=e*u,f=e*o,v=e*a,l=r*o,d=r*a,g=s*a,w=h*u,_=h*o,m=h*a;return t.m00=1-(l+g),t.m01=f+m,t.m02=v-_,t.m03=0,t.m04=f-m,t.m05=1-(c+g),t.m06=d+w,t.m07=0,t.m08=v+_,t.m09=d-w,t.m10=1-(c+l),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},i.getTranslation=function(t,i){return t.x=i.m12,t.y=i.m13,t.z=i.m14,t},i.getScaling=function(t,i){var n=Qr.m00=i.m00,e=Qr.m01=i.m01,r=Qr.m02=i.m02,s=Qr.m03=i.m04,h=Qr.m04=i.m05,u=Qr.m05=i.m06,o=Qr.m06=i.m08,a=Qr.m07=i.m09,c=Qr.m08=i.m10;return t.x=Wr(n*n+e*e+r*r),t.y=Wr(s*s+h*h+u*u),t.z=Wr(o*o+a*a+c*c),_r.determinant(Qr)<0&&(t.x*=-1),t},i.getRotation=function(t,i){var n=i.m00+i.m05+i.m10,e=0;return n>0?(e=2*Wr(n+1),t.w=.25*e,t.x=(i.m06-i.m09)/e,t.y=(i.m08-i.m02)/e,t.z=(i.m01-i.m04)/e):i.m00>i.m05&&i.m00>i.m10?(e=2*Wr(1+i.m00-i.m05-i.m10),t.w=(i.m06-i.m09)/e,t.x=.25*e,t.y=(i.m01+i.m04)/e,t.z=(i.m08+i.m02)/e):i.m05>i.m10?(e=2*Wr(1+i.m05-i.m00-i.m10),t.w=(i.m08-i.m02)/e,t.x=(i.m01+i.m04)/e,t.y=.25*e,t.z=(i.m06+i.m09)/e):(e=2*Wr(1+i.m10-i.m00-i.m05),t.w=(i.m01-i.m04)/e,t.x=(i.m08+i.m02)/e,t.y=(i.m06+i.m09)/e,t.z=.25*e),t},i.toRTS=function(t,n,e,r){i.toSRT(t,n,e,r)},i.toSRT=function(t,i,n,e){n&&ir.set(n,t.m12,t.m13,t.m14);var r=ir.set(qr,t.m00,t.m01,t.m02).length(),s=ir.set(qr,t.m04,t.m05,t.m06).length(),h=ir.set(qr,t.m08,t.m09,t.m10).length();if(e&&(e.x=r,e.y=s,e.z=h),0!==r&&0!==s&&0!==h){Qr.m00=t.m00/r,Qr.m01=t.m01/r,Qr.m02=t.m02/r,Qr.m03=t.m04/s,Qr.m04=t.m05/s,Qr.m05=t.m06/s,Qr.m06=t.m08/h,Qr.m07=t.m09/h,Qr.m08=t.m10/h;var u=_r.determinant(Qr);e&&u<0&&(e.x*=-1),i&&(u<0&&(Qr.m00*=-1,Qr.m01*=-1,Qr.m02*=-1),Cr.fromMat3(i,Qr))}else i&&Cr.identity(i)},i.toEuler=function(t,i){return _r.set(Qr,t.m00,t.m01,t.m02,t.m04,t.m05,t.m06,t.m08,t.m09,t.m10),_r.toEuler(Qr,i)},i.fromRTS=function(t,n,e,r){return i.fromSRT(t,n,e,r)},i.fromSRT=function(t,i,n,e){var r=i.x,s=i.y,h=i.z,u=i.w,o=r+r,a=s+s,c=h+h,f=r*o,v=r*a,l=r*c,d=s*a,g=s*c,w=h*c,_=u*o,m=u*a,p=u*c,y=e.x,b=e.y,A=e.z;return t.m00=(1-(d+w))*y,t.m01=(v+p)*y,t.m02=(l-m)*y,t.m03=0,t.m04=(v-p)*b,t.m05=(1-(f+w))*b,t.m06=(g+_)*b,t.m07=0,t.m08=(l+m)*A,t.m09=(g-_)*A,t.m10=(1-(f+d))*A,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},i.fromRTSOrigin=function(t,n,e,r,s){return i.fromSRTOrigin(t,n,e,r,s)},i.fromSRTOrigin=function(t,i,n,e,r){var s=i.x,h=i.y,u=i.z,o=i.w,a=s+s,c=h+h,f=u+u,v=s*a,l=s*c,d=s*f,g=h*c,w=h*f,_=u*f,m=o*a,p=o*c,y=o*f,b=e.x,A=e.y,E=e.z,k=r.x,T=r.y,S=r.z;return t.m00=(1-(g+_))*b,t.m01=(l+y)*b,t.m02=(d-p)*b,t.m03=0,t.m04=(l-y)*A,t.m05=(1-(v+_))*A,t.m06=(w+m)*A,t.m07=0,t.m08=(d+p)*E,t.m09=(w-m)*E,t.m10=(1-(v+g))*E,t.m11=0,t.m12=n.x+k-(t.m00*k+t.m04*T+t.m08*S),t.m13=n.y+T-(t.m01*k+t.m05*T+t.m09*S),t.m14=n.z+S-(t.m02*k+t.m06*T+t.m10*S),t.m15=1,t},i.fromQuat=function(t,i){var n=i.x,e=i.y,r=i.z,s=i.w,h=n+n,u=e+e,o=r+r,a=n*h,c=e*h,f=e*u,v=r*h,l=r*u,d=r*o,g=s*h,w=s*u,_=s*o;return t.m00=1-f-d,t.m01=c+_,t.m02=v-w,t.m03=0,t.m04=c-_,t.m05=1-a-d,t.m06=l+g,t.m07=0,t.m08=v+w,t.m09=l-g,t.m10=1-a-f,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.frustum=function(t,i,n,e,r,s,h){var u=1/(n-i),o=1/(r-e),a=1/(s-h);return t.m00=2*s*u,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*s*o,t.m06=0,t.m07=0,t.m08=(n+i)*u,t.m09=(r+e)*o,t.m10=(h+s)*a,t.m11=-1,t.m12=0,t.m13=0,t.m14=h*s*2*a,t.m15=0,t},i.perspective=function(t,i,n,e,r,s,h,u,o){void 0===s&&(s=!0),void 0===h&&(h=-1),void 0===u&&(u=1),void 0===o&&(o=0);var a=1/Yr(i/2),c=1/(e-r),f=s?a/n:a,v=(s?a:a*n)*u,l=Hr[o];return t.m00=f*l[0],t.m01=f*l[1],t.m02=0,t.m03=0,t.m04=v*l[2],t.m05=v*l[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-h*e)*c,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*e*c*(1-h),t.m15=0,t},i.ortho=function(t,i,n,e,r,s,h,u,o,a){void 0===u&&(u=-1),void 0===o&&(o=1),void 0===a&&(a=0);var c=1/(i-n),f=1/(e-r)*o,v=1/(s-h),l=-2*c,d=-2*f,g=(i+n)*c,w=(r+e)*f,_=Hr[a];return t.m00=l*_[0],t.m01=l*_[1],t.m02=0,t.m03=0,t.m04=d*_[2],t.m05=d*_[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=v*(1-u),t.m11=0,t.m12=g*_[0]+w*_[2],t.m13=g*_[1]+w*_[3],t.m14=(s-u*h)*v,t.m15=1,t},i.lookAt=function(t,i,n,e){var r=i.x,s=i.y,h=i.z,u=e.x,o=e.y,a=e.z,c=r-n.x,f=s-n.y,v=h-n.z,l=1/Wr(c*c+f*f+v*v),d=o*(v*=l)-a*(f*=l),g=a*(c*=l)-u*v,w=u*f-o*c,_=f*(w*=l=1/Wr(d*d+g*g+w*w))-v*(g*=l),m=v*(d*=l)-c*w,p=c*g-f*d;return t.m00=d,t.m01=_,t.m02=c,t.m03=0,t.m04=g,t.m05=m,t.m06=f,t.m07=0,t.m08=w,t.m09=p,t.m10=v,t.m11=0,t.m12=-(d*r+g*s+w*h),t.m13=-(_*r+m*s+p*h),t.m14=-(c*r+f*s+v*h),t.m15=1,t},i.inverseTranspose=function(t,i){var n=i.m00,e=i.m01,r=i.m02,s=i.m03,h=i.m04,u=i.m05,o=i.m06,a=i.m07,c=i.m08,f=i.m09,v=i.m10,l=i.m11,d=i.m12,g=i.m13,w=i.m14,_=i.m15,m=n*u-e*h,p=n*o-r*h,y=n*a-s*h,b=e*o-r*u,A=e*a-s*u,E=r*a-s*o,k=c*g-f*d,T=c*w-v*d,S=c*_-l*d,O=f*w-v*g,R=f*_-l*g,I=v*_-l*w,M=m*I-p*R+y*O+b*S-A*T+E*k;return M?(M=1/M,t.m00=(u*I-o*R+a*O)*M,t.m01=(o*S-h*I-a*T)*M,t.m02=(h*R-u*S+a*k)*M,t.m03=0,t.m04=(r*R-e*I-s*O)*M,t.m05=(n*I-r*S+s*T)*M,t.m06=(e*S-n*R-s*k)*M,t.m07=0,t.m08=(g*E-w*A+_*b)*M,t.m09=(w*y-d*E-_*p)*M,t.m10=(d*A-g*y+_*m)*M,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.m00,t[n+1]=i.m01,t[n+2]=i.m02,t[n+3]=i.m03,t[n+4]=i.m04,t[n+5]=i.m05,t[n+6]=i.m06,t[n+7]=i.m07,t[n+8]=i.m08,t[n+9]=i.m09,t[n+10]=i.m10,t[n+11]=i.m11,t[n+12]=i.m12,t[n+13]=i.m13,t[n+14]=i.m14,t[n+15]=i.m15,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.m00=i[n+0],t.m01=i[n+1],t.m02=i[n+2],t.m03=i[n+3],t.m04=i[n+4],t.m05=i[n+5],t.m06=i[n+6],t.m07=i[n+7],t.m08=i[n+8],t.m09=i[n+9],t.m10=i[n+10],t.m11=i[n+11],t.m12=i[n+12],t.m13=i[n+13],t.m14=i[n+14],t.m15=i[n+15],t},i.add=function(t,i,n){return t.m00=i.m00+n.m00,t.m01=i.m01+n.m01,t.m02=i.m02+n.m02,t.m03=i.m03+n.m03,t.m04=i.m04+n.m04,t.m05=i.m05+n.m05,t.m06=i.m06+n.m06,t.m07=i.m07+n.m07,t.m08=i.m08+n.m08,t.m09=i.m09+n.m09,t.m10=i.m10+n.m10,t.m11=i.m11+n.m11,t.m12=i.m12+n.m12,t.m13=i.m13+n.m13,t.m14=i.m14+n.m14,t.m15=i.m15+n.m15,t},i.subtract=function(t,i,n){return t.m00=i.m00-n.m00,t.m01=i.m01-n.m01,t.m02=i.m02-n.m02,t.m03=i.m03-n.m03,t.m04=i.m04-n.m04,t.m05=i.m05-n.m05,t.m06=i.m06-n.m06,t.m07=i.m07-n.m07,t.m08=i.m08-n.m08,t.m09=i.m09-n.m09,t.m10=i.m10-n.m10,t.m11=i.m11-n.m11,t.m12=i.m12-n.m12,t.m13=i.m13-n.m13,t.m14=i.m14-n.m14,t.m15=i.m15-n.m15,t},i.multiplyScalar=function(t,i,n){return t.m00=i.m00*n,t.m01=i.m01*n,t.m02=i.m02*n,t.m03=i.m03*n,t.m04=i.m04*n,t.m05=i.m05*n,t.m06=i.m06*n,t.m07=i.m07*n,t.m08=i.m08*n,t.m09=i.m09*n,t.m10=i.m10*n,t.m11=i.m11*n,t.m12=i.m12*n,t.m13=i.m13*n,t.m14=i.m14*n,t.m15=i.m15*n,t},i.multiplyScalarAndAdd=function(t,i,n,e){return t.m00=i.m00+n.m00*e,t.m01=i.m01+n.m01*e,t.m02=i.m02+n.m02*e,t.m03=i.m03+n.m03*e,t.m04=i.m04+n.m04*e,t.m05=i.m05+n.m05*e,t.m06=i.m06+n.m06*e,t.m07=i.m07+n.m07*e,t.m08=i.m08+n.m08*e,t.m09=i.m09+n.m09*e,t.m10=i.m10+n.m10*e,t.m11=i.m11+n.m11*e,t.m12=i.m12+n.m12*e,t.m13=i.m13+n.m13*e,t.m14=i.m14+n.m14*e,t.m15=i.m15+n.m15*e,t},i.strictEquals=function(t,i){return t.m00===i.m00&&t.m01===i.m01&&t.m02===i.m02&&t.m03===i.m03&&t.m04===i.m04&&t.m05===i.m05&&t.m06===i.m06&&t.m07===i.m07&&t.m08===i.m08&&t.m09===i.m09&&t.m10===i.m10&&t.m11===i.m11&&t.m12===i.m12&&t.m13===i.m13&&t.m14===i.m14&&t.m15===i.m15},i.equals=function(t,i,n){return void 0===n&&(n=qn),Vr(t.m00-i.m00)<=n*$r(1,Vr(t.m00),Vr(i.m00))&&Vr(t.m01-i.m01)<=n*$r(1,Vr(t.m01),Vr(i.m01))&&Vr(t.m02-i.m02)<=n*$r(1,Vr(t.m02),Vr(i.m02))&&Vr(t.m03-i.m03)<=n*$r(1,Vr(t.m03),Vr(i.m03))&&Vr(t.m04-i.m04)<=n*$r(1,Vr(t.m04),Vr(i.m04))&&Vr(t.m05-i.m05)<=n*$r(1,Vr(t.m05),Vr(i.m05))&&Vr(t.m06-i.m06)<=n*$r(1,Vr(t.m06),Vr(i.m06))&&Vr(t.m07-i.m07)<=n*$r(1,Vr(t.m07),Vr(i.m07))&&Vr(t.m08-i.m08)<=n*$r(1,Vr(t.m08),Vr(i.m08))&&Vr(t.m09-i.m09)<=n*$r(1,Vr(t.m09),Vr(i.m09))&&Vr(t.m10-i.m10)<=n*$r(1,Vr(t.m10),Vr(i.m10))&&Vr(t.m11-i.m11)<=n*$r(1,Vr(t.m11),Vr(i.m11))&&Vr(t.m12-i.m12)<=n*$r(1,Vr(t.m12),Vr(i.m12))&&Vr(t.m13-i.m13)<=n*$r(1,Vr(t.m13),Vr(i.m13))&&Vr(t.m14-i.m14)<=n*$r(1,Vr(t.m14),Vr(i.m14))&&Vr(t.m15-i.m15)<=n*$r(1,Vr(t.m15),Vr(i.m15))};var n=i.prototype;return n.clone=function(){return new i(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===c&&(c=1),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=0),void 0===g&&(g=1);var w=this;return"object"==typeof t?(w.m01=t.m01,w.m02=t.m02,w.m03=t.m03,w.m04=t.m04,w.m05=t.m05,w.m06=t.m06,w.m07=t.m07,w.m08=t.m08,w.m09=t.m09,w.m10=t.m10,w.m11=t.m11,w.m12=t.m12,w.m13=t.m13,w.m14=t.m14,w.m15=t.m15,w.m00=t.m00):(w.m01=i,w.m02=n,w.m03=e,w.m04=r,w.m05=s,w.m06=h,w.m07=u,w.m08=o,w.m09=a,w.m10=c,w.m11=f,w.m12=v,w.m13=l,w.m14=d,w.m15=g,w.m00=t),w},n.equals=function(t,i){void 0===i&&(i=qn);var n=1/0,e=this,r=e.m00,s=e.m01,h=e.m02,u=e.m03,o=e.m04,a=e.m05,c=e.m06,f=e.m07,v=e.m08,l=e.m09,d=e.m10,g=e.m11,w=e.m12,_=e.m13,m=e.m14,p=e.m15;return!(Vr(r)===n||Vr(s)===n||Vr(h)===n||Vr(u)===n||Vr(o)===n||Vr(a)===n||Vr(c)===n||Vr(f)===n||Vr(v)===n||Vr(l)===n||Vr(d)===n||Vr(g)===n||Vr(w)===n||Vr(_)===n||Vr(m)===n||Vr(p)===n)&&Vr(r-t.m00)<=i*$r(1,Vr(r),Vr(t.m00))&&Vr(s-t.m01)<=i*$r(1,Vr(s),Vr(t.m01))&&Vr(h-t.m02)<=i*$r(1,Vr(h),Vr(t.m02))&&Vr(u-t.m03)<=i*$r(1,Vr(u),Vr(t.m03))&&Vr(o-t.m04)<=i*$r(1,Vr(o),Vr(t.m04))&&Vr(a-t.m05)<=i*$r(1,Vr(a),Vr(t.m05))&&Vr(c-t.m06)<=i*$r(1,Vr(c),Vr(t.m06))&&Vr(f-t.m07)<=i*$r(1,Vr(f),Vr(t.m07))&&Vr(v-t.m08)<=i*$r(1,Vr(v),Vr(t.m08))&&Vr(l-t.m09)<=i*$r(1,Vr(l),Vr(t.m09))&&Vr(d-t.m10)<=i*$r(1,Vr(d),Vr(t.m10))&&Vr(g-t.m11)<=i*$r(1,Vr(g),Vr(t.m11))&&Vr(w-t.m12)<=i*$r(1,Vr(w),Vr(t.m12))&&Vr(_-t.m13)<=i*$r(1,Vr(_),Vr(t.m13))&&Vr(m-t.m14)<=i*$r(1,Vr(m),Vr(t.m14))&&Vr(p-t.m15)<=i*$r(1,Vr(p),Vr(t.m15))},n.strictEquals=function(t){var i=this;return i.m00===t.m00&&i.m01===t.m01&&i.m02===t.m02&&i.m03===t.m03&&i.m04===t.m04&&i.m05===t.m05&&i.m06===t.m06&&i.m07===t.m07&&i.m08===t.m08&&i.m09===t.m09&&i.m10===t.m10&&i.m11===t.m11&&i.m12===t.m12&&i.m13===t.m13&&i.m14===t.m14&&i.m15===t.m15},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+",\n"+t.m04+", "+t.m05+", "+t.m06+", "+t.m07+",\n"+t.m08+", "+t.m09+", "+t.m10+", "+t.m11+",\n"+t.m12+", "+t.m13+", "+t.m14+", "+t.m15+"\n]"},n.identity=function(){return i.identity(this)},n.zero=function(){return i.zero(this)},n.transpose=function(){var t=this,i=t.m01,n=t.m02,e=t.m03,r=t.m06,s=t.m07,h=t.m11;return t.m01=t.m04,t.m02=t.m08,t.m03=t.m12,t.m04=i,t.m06=t.m09,t.m07=t.m13,t.m08=n,t.m09=r,t.m11=t.m14,t.m12=e,t.m13=s,t.m14=h,t},n.invert=function(){var t=this,i=t.m00,n=t.m01,e=t.m02,r=t.m03,s=t.m04,h=t.m05,u=t.m06,o=t.m07,a=t.m08,c=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,g=t.m14,w=t.m15,_=i*h-n*s,m=i*u-e*s,p=i*o-r*s,y=n*u-e*h,b=n*o-r*h,A=e*o-r*u,E=a*d-c*l,k=a*g-f*l,T=a*w-v*l,S=c*g-f*d,O=c*w-v*d,R=f*w-v*g,I=_*R-m*O+p*S+y*T-b*k+A*E;return 0===I?(t.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),t):(I=1/I,t.m00=(h*R-u*O+o*S)*I,t.m01=(e*O-n*R-r*S)*I,t.m02=(d*A-g*b+w*y)*I,t.m03=(f*b-c*A-v*y)*I,t.m04=(u*T-s*R-o*k)*I,t.m05=(i*R-e*T+r*k)*I,t.m06=(g*p-l*A-w*m)*I,t.m07=(a*A-f*p+v*m)*I,t.m08=(s*O-h*T+o*E)*I,t.m09=(n*T-i*O-r*E)*I,t.m10=(l*b-d*p+w*_)*I,t.m11=(c*p-a*b-v*_)*I,t.m12=(h*k-s*S-u*E)*I,t.m13=(i*S-n*k+e*E)*I,t.m14=(d*m-l*y-g*_)*I,t.m15=(a*y-c*m+f*_)*I,t)},n.determinant=function(){var t=this,i=t.m00,n=t.m01,e=t.m02,r=t.m03,s=t.m04,h=t.m05,u=t.m06,o=t.m07,a=t.m08,c=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,g=t.m14,w=t.m15;return(i*h-n*s)*(f*w-v*g)-(i*u-e*s)*(c*w-v*d)+(i*o-r*s)*(c*g-f*d)+(n*u-e*h)*(a*w-v*l)-(n*o-r*h)*(a*g-f*l)+(e*o-r*u)*(a*d-c*l)},n.add=function(t){var i=this;return i.m00+=t.m00,i.m01+=t.m01,i.m02+=t.m02,i.m03+=t.m03,i.m04+=t.m04,i.m05+=t.m05,i.m06+=t.m06,i.m07+=t.m07,i.m08+=t.m08,i.m09+=t.m09,i.m10+=t.m10,i.m11+=t.m11,i.m12+=t.m12,i.m13+=t.m13,i.m14+=t.m14,i.m15+=t.m15,i},n.subtract=function(t){var i=this;return i.m00-=t.m00,i.m01-=t.m01,i.m02-=t.m02,i.m03-=t.m03,i.m04-=t.m04,i.m05-=t.m05,i.m06-=t.m06,i.m07-=t.m07,i.m08-=t.m08,i.m09-=t.m09,i.m10-=t.m10,i.m11-=t.m11,i.m12-=t.m12,i.m13-=t.m13,i.m14-=t.m14,i.m15-=t.m15,i},n.multiply=function(t){return i.multiply(this,this,t)},n.multiplyScalar=function(t){var i=this;return i.m00*=t,i.m01*=t,i.m02*=t,i.m03*=t,i.m04*=t,i.m05*=t,i.m06*=t,i.m07*=t,i.m08*=t,i.m09*=t,i.m10*=t,i.m11*=t,i.m12*=t,i.m13*=t,i.m14*=t,i.m15*=t,i},n.translate=function(t){return this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},n.transform=function(t){var i=t.x,n=t.y,e=t.z,r=this,s=r.m00,h=r.m01,u=r.m02,o=r.m03,a=r.m04,c=r.m05,f=r.m06,v=r.m07,l=r.m08,d=r.m09,g=r.m10,w=r.m11;return r.m12=s*i+a*n+l*e+r.m12,r.m13=h*i+c*n+d*e+r.m13,r.m14=u*i+f*n+g*e+r.m14,r.m15=o*i+v*n+w*e+r.m15,r},n.scale=function(t){var i=t.x,n=t.y,e=t.z,r=this;return r.m00*=i,r.m01*=i,r.m02*=i,r.m03*=i,r.m04*=n,r.m05*=n,r.m06*=n,r.m07*=n,r.m08*=e,r.m09*=e,r.m10*=e,r.m11*=e,r},n.rotate=function(t,i){var n=i.x,e=i.y,r=i.z,s=Wr(n*n+e*e+r*r);if(Vr(s)<qn)return null;n*=s=1/s,e*=s,r*=s;var h=zr(t),u=Xr(t),o=1-u,a=this,c=a.m00,f=a.m01,v=a.m02,l=a.m03,d=a.m04,g=a.m05,w=a.m06,_=a.m07,m=a.m08,p=a.m09,y=a.m10,b=a.m11,A=n*n*o+u,E=e*n*o+r*h,k=r*n*o-e*h,T=n*e*o-r*h,S=e*e*o+u,O=r*e*o+n*h,R=n*r*o+e*h,I=e*r*o-n*h,M=r*r*o+u;return a.m00=c*A+d*E+m*k,a.m01=f*A+g*E+p*k,a.m02=v*A+w*E+y*k,a.m03=l*A+_*E+b*k,a.m04=c*T+d*S+m*O,a.m05=f*T+g*S+p*O,a.m06=v*T+w*S+y*O,a.m07=l*T+_*S+b*O,a.m08=c*R+d*I+m*M,a.m09=f*R+g*I+p*M,a.m10=v*R+w*I+y*M,a.m11=l*R+_*I+b*M,a},n.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},n.getScale=function(t){var i=this,n=Qr.m00=i.m00,e=Qr.m01=i.m01,r=Qr.m02=i.m02,s=Qr.m03=i.m04,h=Qr.m04=i.m05,u=Qr.m05=i.m06,o=Qr.m06=i.m08,a=Qr.m07=i.m09,c=Qr.m08=i.m10;return t.x=Wr(n*n+e*e+r*r),t.y=Wr(s*s+h*h+u*u),t.z=Wr(o*o+a*a+c*c),_r.determinant(Qr)<0&&(t.x*=-1),t},n.getRotation=function(t){var i=this,n=ir.set(qr,i.m00,i.m01,i.m02).length(),e=ir.set(qr,i.m04,i.m05,i.m06).length(),r=ir.set(qr,i.m08,i.m09,i.m10).length();return Qr.m00=i.m00/n,Qr.m01=i.m01/n,Qr.m02=i.m02/n,Qr.m03=i.m04/e,Qr.m04=i.m05/e,Qr.m05=i.m06/e,Qr.m06=i.m08/r,Qr.m07=i.m09/r,Qr.m08=i.m10/r,_r.determinant(Qr)<0&&(Qr.m00*=-1,Qr.m01*=-1,Qr.m02*=-1),Cr.fromMat3(t,Qr)},n.fromRTS=function(t,n,e){return i.fromSRT(this,t,n,e)},n.fromSRT=function(t,n,e){return i.fromSRT(this,t,n,e)},n.fromQuat=function(t){return i.fromQuat(this,t)},i}(Pi));Lr=Kr,Kr.IDENTITY=Object.freeze(new Lr);var qr=new ir,Qr=new _r;function Zr(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g){return new Kr(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g)}Un.fastDefine("cc.Mat4",Kr,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),T.Mat4=Kr,T.mat4=Zr;var Jr=Math.abs,ts=Math.max,is=Math.min,ns=Math.PI,es=Math.acos,rs=Math.sin,ss=Math.cos,hs=Math.sqrt,us=Math.atan2,os=Math.ceil,as=Math.floor,cs=Math.round;function fs(t,i){return Object.freeze(new ls(t,i))}var vs,ls=t("Vec2",function(t){function i(i,n){var e;return e=t.call(this)||this,"object"==typeof i?(e.x=i.x,e.y=i.y):(e.x=i||0,e.y=n||0),e}s(i,t),i.clone=function(t){return new i(t.x,t.y)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t},i.set=function(t,i,n){return t.x=i,t.y=n,t},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t},i.ceil=function(t,i){return t.x=os(i.x),t.y=os(i.y),t},i.floor=function(t,i){return t.x=as(i.x),t.y=as(i.y),t},i.min=function(t,i,n){return t.x=is(i.x,n.x),t.y=is(i.y,n.y),t},i.max=function(t,i,n){return t.x=ts(i.x,n.x),t.y=ts(i.y,n.y),t},i.round=function(t,i){return t.x=cs(i.x),t.y=cs(i.y),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t},i.scaleAndAdd=function(t,i,n,e){return t.x=i.x+n.x*e,t.y=i.y+n.y*e,t},i.distance=function(t,i){var n=i.x-t.x,e=i.y-t.y;return hs(n*n+e*e)},i.squaredDistance=function(t,i){var n=i.x-t.x,e=i.y-t.y;return n*n+e*e},i.len=function(t){var i=t.x,n=t.y;return hs(i*i+n*n)},i.lengthSqr=function(t){var i=t.x,n=t.y;return i*i+n*n},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t},i.inverse=function(t,i){return t.x=1/i.x,t.y=1/i.y,t},i.inverseSafe=function(t,i){var n=i.x,e=i.y;return Jr(n)<qn?t.x=0:t.x=1/n,Jr(e)<qn?t.y=0:t.y=1/e,t},i.normalize=function(t,i){var n=i.x,e=i.y,r=n*n+e*e;return r>0?(r=1/hs(r),t.x=n*r,t.y=e*r):(t.x=0,t.y=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y},i.cross=function(t,i,n){return t instanceof ir?(t.x=t.y=0,t.z=i.x*n.y-i.y*n.x,t):t.x*i.y-t.y*i.x},i.lerp=function(t,i,n,e){var r=i.x,s=i.y;return t.x=r+e*(n.x-r),t.y=s+e*(n.y-s),t},i.random=function(t,i){i=i||1;var n=2*re()*ns;return t.x=ss(n)*i,t.y=rs(n)*i,t},i.transformMat3=function(t,i,n){var e=i.x,r=i.y;return t.x=n.m00*e+n.m03*r+n.m06,t.y=n.m01*e+n.m04*r+n.m07,t},i.transformMat4=function(t,i,n){var e=i.x,r=i.y;return t.x=n.m00*e+n.m04*r+n.m12,t.y=n.m01*e+n.m05*r+n.m13,t},i.str=function(t){return"Vec2("+t.x+", "+t.y+")"},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y},i.equals=function(t,i,n){return void 0===n&&(n=qn),Jr(t.x-i.x)<=n*ts(1,Jr(t.x),Jr(i.x))&&Jr(t.y-i.y)<=n*ts(1,Jr(t.y),Jr(i.y))},i.angle=function(t,i){var n=t.x*t.x+t.y*t.y,e=i.x*i.x+i.y*i.y;if(0===n||0===e)return 0;var r=(t.x*i.x+t.y*i.y)/hs(n*e);return r=Jn(r,-1,1),es(r)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y)},n.set=function(t,i){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=i||0),this},n.equals=function(t,n){return void 0===n&&(n=qn),i.equals(this,t,n)},n.equals2f=function(t,i,n){return void 0===n&&(n=qn),Jr(this.x-t)<=n*ts(1,Jr(this.x),Jr(t))&&Jr(this.y-i)<=n*ts(1,Jr(this.y),Jr(i))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},n.strictEquals2f=function(t,i){return this.x===t&&this.y===i},n.toString=function(){return"("+this.x+", "+this.y+")"},n.lerp=function(t,i){var n=this.x,e=this.y;return this.x=n+i*(t.x-n),this.y=e+i*(t.y-e),this},n.clampf=function(t,i){return this.x=Jn(this.x,t.x,i.x),this.y=Jn(this.y,t.y,i.y),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.add2f=function(t,i){return this.x+=t,this.y+=i,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.subtract2f=function(t,i){return this.x-=t,this.y-=i,this},n.multiplyScalar=function(t){return"object"==typeof t&&st(16359),this.x*=t,this.y*=t,this},n.multiply=function(t){return"object"!=typeof t&&st(16360),this.x*=t.x,this.y*=t.y,this},n.multiply2f=function(t,i){return this.x*=t,this.y*=i,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.divide2f=function(t,i){return this.x/=t,this.y/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.length=function(){return hs(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var t=this,i=t.x,n=t.y,e=i*i+n*n;return e>0&&(e=1/hs(e),t.x*=e,t.y*=e),t},n.angle=function(t){var i=this.lengthSqr(),n=t.lengthSqr();if(0===i||0===n)return 0;var e=this.dot(t)/hs(i*n);return e=Jn(e,-1,1),es(e)},n.signAngle=function(t){var i=this.cross(t),n=this.dot(t);return us(i,n)},n.rotate=function(t){var i=this.x,n=this.y,e=rs(t),r=ss(t);return this.x=r*i-e*n,this.y=e*i+r*n,this},n.project=function(t){var i=this.dot(t)/t.dot(t);return this.x=t.x*i,this.y=t.y*i,this},n.transformMat4=function(t){var i=this.x,n=this.y;return this.x=t.m00*i+t.m04*n+t.m12,this.y=t.m01*i+t.m05*n+t.m13,this},n.toVec3=function(){return new ir(this.x,this.y,0)},i}(Pi));function ds(t,i){return new ls(t,i)}ls.ZERO=fs(0,0),ls.ONE=fs(1,1),ls.NEG_ONE=fs(-1,-1),ls.UNIT_X=fs(1,0),ls.UNIT_Y=fs(0,1),Un.fastDefine("cc.Vec2",ls,{x:0,y:0}),T.Vec2=ls,T.v2=ds,dt(ls,"Vec2",[{name:"sub",newName:"subtract",target:ls,targetName:"Vec2"},{name:"mul",newName:"multiply",target:ls,targetName:"Vec2"},{name:"div",newName:"divide",target:ls,targetName:"Vec2"},{name:"dist",newName:"distance",target:ls,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:ls,targetName:"Vec2"},{name:"mag",newName:"len",target:ls,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:ls,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ls,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ls,targetName:"Vec2"}]),dt(ls.prototype,"Vec2",[{name:"mag",newName:"length",target:ls.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:ls.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ls.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ls.prototype,targetName:"Vec2"}]),dt(ir,"Vec3",[{name:"sub",newName:"subtract",target:ir,targetName:"Vec3"},{name:"mul",newName:"multiply",target:ir,targetName:"Vec3"},{name:"div",newName:"divide",target:ir,targetName:"Vec3"},{name:"dist",newName:"distance",target:ir,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:ir,targetName:"Vec3"},{name:"mag",newName:"len",target:ir,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:ir,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:ir,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:ir,targetName:"Vec3"}]),dt(ir.prototype,"Vec3",[{name:"mag",newName:"length",target:ir.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:ir.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:ir.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:ir.prototype,targetName:"Vec3"}]),dt(De,"Vec4",[{name:"sub",newName:"subtract",target:De,targetName:"Vec4"},{name:"mul",newName:"multiply",target:De,targetName:"Vec4"},{name:"div",newName:"divide",target:De,targetName:"Vec4"},{name:"dist",newName:"distance",target:De,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:De,targetName:"Vec4"},{name:"mag",newName:"len",target:De,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:De,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:De,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:De,targetName:"Vec4"}]),dt(De.prototype,"Vec4",[{name:"mag",newName:"length",target:De.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:De.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:De.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:De.prototype,targetName:"Vec4"}]),dt(Cr,"Quat",[{name:"mag",newName:"len",target:Cr,targetName:"Quat"},{name:"mul",newName:"multiply",target:Cr,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Cr,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Cr,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Cr,targetName:"Quat"}]),dt(Cr.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Cr.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Cr.prototype,targetName:"Quat"}]),dt(cr,"Color",[{name:"sub",newName:"subtract",target:cr,targetName:"Color"},{name:"mul",newName:"multiply",target:cr,targetName:"Color"},{name:"div",newName:"divide",target:cr,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:cr,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var e=i[1].toString(16);return T.Color.fromHEX(i[0],e)}}]),dt(_r,"Mat3",[{name:"sub",newName:"subtract",target:_r,targetName:"Mat3"},{name:"mul",newName:"multiply",target:_r,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:_r,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:_r,targetName:"Mat3"}]),dt(_r.prototype,"Mat3",[{name:"sub",newName:"subtract",target:_r.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:_r.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:_r.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:_r.prototype,targetName:"Mat3"}]),dt(Kr,"Mat4",[{name:"sub",newName:"subtract",target:Kr,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Kr,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Kr,targetName:"Mat4"}]),dt(Kr.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Kr.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Kr.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Kr.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Kr.prototype,targetName:"Mat4"}]);var gs=t("Size",function(t){function i(i,n){var e;return e=t.call(this)||this,"object"==typeof i?(e.width=i.width,e.height=i.height):(e.width=i||0,e.height=n||0),e}s(i,t),i.lerp=function(t,i,n,e){return t.width=i.width+(n.width-i.width)*e,t.height=i.height+(n.height-i.height)*e,t},i.equals=function(t,i){return t.width===i.width&&t.height===i.height};var n=i.prototype;return n.clone=function(){return new i(this.width,this.height)},n.set=function(t,i){return"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=i||0),this},n.equals=function(t){return this.width===t.width&&this.height===t.height},n.lerp=function(t,i){return this.width+=(t.width-this.width)*i,this.height+=(t.height-this.height)*i,this},n.toString=function(){return"("+this.width+", "+this.height+")"},e(i,[{key:"x",get:function(){return this.width},set:function(t){this.width=t}},{key:"y",get:function(){return this.height},set:function(t){this.height=t}}]),i}(Pi));function ws(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),new gs(t,i)}vs=gs,gs.ZERO=Object.freeze(new vs(0,0)),gs.ONE=Object.freeze(new vs(1,1)),Un.fastDefine("cc.Size",gs,{width:0,height:0}),T.size=ws,T.Size=gs;var _s=Math.max,ms=Math.min,ps=t("Rect",function(t){function i(i,n,e,r){var s;return s=t.call(this)||this,"object"==typeof i?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):(s.x=i||0,s.y=n||0,s.width=e||0,s.height=r||0),s}s(i,t),i.fromMinMax=function(t,i,n){var e=ms(i.x,n.x),r=ms(i.y,n.y),s=_s(i.x,n.x),h=_s(i.y,n.y);return t.x=e,t.y=r,t.width=s-e,t.height=h-r,t},i.lerp=function(t,i,n,e){var r=i.x,s=i.y,h=i.width,u=i.height;return t.x=r+(n.x-r)*e,t.y=s+(n.y-s)*e,t.width=h+(n.width-h)*e,t.height=u+(n.height-u)*e,t},i.intersection=function(t,i,n){var e=i.x,r=i.y,s=i.x+i.width,h=i.y+i.height,u=n.x,o=n.y,a=n.x+n.width,c=n.y+n.height;return t.x=_s(e,u),t.y=_s(r,o),t.width=ms(s,a)-t.x,t.height=ms(h,c)-t.y,t},i.union=function(t,i,n){var e=i.x,r=i.y,s=i.width,h=i.height,u=n.x,o=n.y,a=n.width,c=n.height;return t.x=ms(e,u),t.y=ms(r,o),t.width=_s(e+s,u+a)-t.x,t.height=_s(r+h,o+c)-t.y,t},i.equals=function(t,i){return t.x===i.x&&t.y===i.y&&t.width===i.width&&t.height===i.height};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.width,this.height)},n.set=function(t,i,n,e){var r=this;return"object"==typeof t?(r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height):(r.x=t||0,r.y=i||0,r.width=n||0,r.height=e||0),r},n.equals=function(t){var i=this;return i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height},n.lerp=function(t,i){var n=this,e=n.x,r=n.y,s=n.width,h=n.height;return n.x=e+(t.x-e)*i,n.y=r+(t.y-r)*i,n.width=s+(t.width-s)*i,n.height=h+(t.height-h)*i,n},n.toString=function(){var t=this;return"("+t.x+", "+t.y+", "+t.width+", "+t.height+")"},n.intersects=function(t){var i=this,n=i.x+i.width,e=i.y+i.height,r=t.x+t.width,s=t.y+t.height;return!(n<t.x||r<i.x||e<t.y||s<i.y)},n.contains=function(t){var i=this;return i.x<=t.x&&i.x+i.width>=t.x&&i.y<=t.y&&i.y+i.height>=t.y},n.containsRect=function(t){var i=this;return i.x<=t.x&&i.x+i.width>=t.x+t.width&&i.y<=t.y&&i.y+i.height>=t.y+t.height},n.transformMat4=function(t){var i=this,n=i.x,e=i.y,r=n+i.width,s=e+i.height,h=t.m00*n+t.m04*e+t.m12,u=t.m01*n+t.m05*e+t.m13,o=t.m00*r+t.m04*e+t.m12,a=t.m01*r+t.m05*e+t.m13,c=t.m00*n+t.m04*s+t.m12,f=t.m01*n+t.m05*s+t.m13,v=t.m00*r+t.m04*s+t.m12,l=t.m01*r+t.m05*s+t.m13,d=ms(h,o,c,v),g=_s(h,o,c,v),w=ms(u,a,f,l),_=_s(u,a,f,l);return i.x=d,i.y=w,i.width=g-d,i.height=_-w,i},n.transformMat4ToPoints=function(t,i,n,e,r){var s=this,h=s.x,u=s.y,o=h+s.width,a=u+s.height;i.x=t.m00*h+t.m04*u+t.m12,i.y=t.m01*h+t.m05*u+t.m13,r.x=t.m00*o+t.m04*u+t.m12,r.y=t.m01*o+t.m05*u+t.m13,n.x=t.m00*h+t.m04*a+t.m12,n.y=t.m01*h+t.m05*a+t.m13,e.x=t.m00*o+t.m04*a+t.m12,e.y=t.m01*o+t.m05*a+t.m13},e(i,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new ls(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new ls(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new gs(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",get:function(){return this.width},set:function(t){this.width=t}},{key:"w",get:function(){return this.height},set:function(t){this.height=t}}]),i}(Pi));function ys(t,i,n,e){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),new ps(t,i,n,e)}Un.fastDefine("cc.Rect",ps,{x:0,y:0,width:0,height:0}),T.Rect=ps,T.rect=ys;var bs=t("MATH_FLOAT_ARRAY",Float64Array),As=t("MathBase",function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.createFloatArray=function(t){return new bs(t)},e(i,[{key:"array",get:function(){return this._array}}]),i}(Pi)),Es=Object.freeze({__proto__:null,Color:cr,EPSILON:qn,HALF_PI:Yn,MATH_FLOAT_ARRAY:bs,Mat3:_r,Mat4:Kr,MathBase:As,Quat:Cr,Rect:ps,Size:gs,TWO_PI:Kn,Vec2:ls,Vec3:ir,Vec4:De,absMax:we,absMaxComponent:ge,approx:Zn,bits:B,clamp:Jn,clamp01:te,color:fr,enumerableProps:_e,equals:Qn,floatToHalf:Ae,halfToFloat:Ee,inverseLerp:de,lerp:ie,mat4:Zr,nextPow2:fe,pingPong:le,preTransforms:Hr,pseudoRandom:oe,pseudoRandomRange:ae,pseudoRandomRangeInt:ce,quat:Gr,random:re,randomRange:he,randomRangeInt:ue,rect:ys,repeat:ve,setRandGenerator:se,size:ws,toDegree:ee,toRadian:ne,v2:ds,v3:nr,v4:Ue});t("math",Es);var ks=new ir,Ts=new ir,Ss=new ir,Os=new ir,Rs=new ir,Is=new ir,Ms=new Array(3),Ns=new Array(3);function Cs(t,i){return ir.dot(i.n,t)-i.d}function Ls(t,i,n){return ir.copy(t,i),ir.subtract(Rs,n.center,n.halfExtents),ir.add(Is,n.center,n.halfExtents),t.x=t.x<Rs.x?Rs.x:t.x,t.y=t.y<Rs.y?Rs.y:t.y,t.z=t.z<Rs.z?Rs.z:t.z,t.x=t.x>Is.x?Is.x:t.x,t.y=t.y>Is.y?Is.y:t.y,t.z=t.z>Is.z?Is.z:t.z,t}function Fs(t,i,n){ir.set(ks,n.orientation.m00,n.orientation.m01,n.orientation.m02),ir.set(Ts,n.orientation.m03,n.orientation.m04,n.orientation.m05),ir.set(Ss,n.orientation.m06,n.orientation.m07,n.orientation.m08),Ms[0]=ks,Ms[1]=Ts,Ms[2]=Ss,Ns[0]=n.halfExtents.x,Ns[1]=n.halfExtents.y,Ns[2]=n.halfExtents.z,ir.subtract(Os,i,n.center),ir.set(t,n.center.x,n.center.y,n.center.z);for(var e=0;e<3;e++){var r=ir.dot(Os,Ms[e]);r>Ns[e]&&(r=Ns[e]),r<-Ns[e]&&(r=-Ns[e]),t.x+=r*Ms[e].x,t.y+=r*Ms[e].y,t.z+=r*Ms[e].z}return t}var Ps=Object.freeze({__proto__:null,point_plane:Cs,pt_point_aabb:Ls,pt_point_line:function(t,i,n,e){ir.subtract(ks,n,e);var r=ks.clone(),s=ir.lengthSqr(r);if(0===s)ir.copy(t,n);else{ir.subtract(ks,i,n);var h=ir.dot(ks,r)/s;h<0?ir.copy(t,n):h>1?ir.copy(t,e):ir.scaleAndAdd(t,n,r,h)}},pt_point_obb:Fs,pt_point_plane:function(t,i,n){var e=Cs(i,n);return ir.subtract(t,i,ir.multiplyScalar(t,n.n,e))}}),Bs=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=-1),this.s=void 0,this.e=void 0,this.M=void 0,this.M=2,this.s=new ir(t,i,n),this.e=new ir(e,r,s)}return t.create=function(i,n,e,r,s,h){return new t(i,n,e,r,s,h)},t.clone=function(i){return new t(i.s.x,i.s.y,i.s.z,i.e.x,i.e.y,i.e.z)},t.copy=function(t,i){return ir.copy(t.s,i.s),ir.copy(t.e,i.e),t},t.fromPoints=function(t,i,n){return ir.copy(t.s,i),ir.copy(t.e,n),t},t.set=function(t,i,n,e,r,s,h){return t.s.x=i,t.s.y=n,t.s.z=e,t.e.x=r,t.e.y=s,t.e.z=h,t},t.len=function(t){return ir.distance(t.s,t.e)},t.prototype.length=function(){return ir.distance(this.s,this.e)},e(t,[{key:"type",get:function(){return this.M}}]),t}(),Ds=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=-1),this._type=1,this.o=new ir(t,i,n),this.d=new ir(e,r,s)}return t.create=function(i,n,e,r,s,h){return void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=1),new t(i,n,e,r,s,h)},t.clone=function(i){return new t(i.o.x,i.o.y,i.o.z,i.d.x,i.d.y,i.d.z)},t.copy=function(t,i){return ir.copy(t.o,i.o),ir.copy(t.d,i.d),t},t.fromPoints=function(t,i,n){return ir.copy(t.o,i),ir.normalize(t.d,ir.subtract(t.d,n,i)),t},t.set=function(t,i,n,e,r,s,h){return t.o.x=i,t.o.y=n,t.o.z=e,t.d.x=r,t.d.y=s,t.d.z=h,t},t.prototype.computeHit=function(t,i){ir.normalize(t,this.d),ir.scaleAndAdd(t,this.o,t,i)},e(t,[{key:"type",get:function(){return this._type}}]),t}(),Us=new ir,xs=new ir,Gs=new ir,js=new ir;function Hs(t){return Math.max(Math.max(t.x,t.y),t.z)}var Vs,$s,Ws,zs,Xs,Ys=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),this._type=4,this._center=new ir(t,i,n),this.N=e}t.create=function(i,n,e,r){return new t(i,n,e,r)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.radius)},t.copy=function(t,i){return ir.copy(t.center,i.center),t.radius=i.radius,t},t.fromPoints=function(t,i,n){return ir.multiplyScalar(t.center,ir.add(Us,i,n),.5),t.radius=.5*ir.subtract(Us,n,i).length(),t},t.set=function(t,i,n,e,r){return t.center.x=i,t.center.y=n,t.center.z=e,t.radius=r,t};var i=t.prototype;return i.destroy=function(){},i.clone=function(){return t.clone(this)},i.copy=function(i){return t.copy(this,i)},i.getBoundary=function(t,i){ir.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),ir.set(i,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},i.transform=function(t,i,n,e,r){ir.transformMat4(r.center,this.center,t),r.radius=this.radius*Hs(e)},i.translateAndRotate=function(t,i,n){ir.transformMat4(n.center,this.center,t)},i.setScale=function(t,i){i.radius=this.radius*Hs(t)},i.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),ir.subtract(xs,t,this.center);var i=xs.length();if(i>this.radius){var n=.5*(i-this.radius);this.radius+=n,ir.multiplyScalar(xs,xs,n/i),ir.add(this.center,this.center,xs)}},i.mergePoints=function(t){var i=t.length;if(!(i<1)){this.radius=-1;for(var n=0;n<i;n++)this.mergePoint(t[n])}},i.mergeAABB=function(t){t.getBoundary(Gs,js),this.mergePoint(Gs),this.mergePoint(js)},e(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this.N},set:function(t){this.N=t}},{key:"type",get:function(){return this._type}}]),t}(),Ks=ir.squaredDistance,qs=ir.subtract,Qs=ir.dot,Zs=ir.set,Js=ir.cross,th=ir.multiplyScalar,ih=ir.copy,nh=ir.add,eh=ir.scaleAndAdd,rh=Math.max,sh=Math.min,hh=Math.abs,uh=function(t,i){var n=Qs(t.d,i.n);if(hh(n)<Number.EPSILON)return 0;var e=-Cs(t.o,i)/n;return e<0?0:e},oh=(Vs=nr(),$s=nr(),Ws=nr(),zs=nr(),Xs=nr(),function(t,i,n){qs(Vs,i.b,i.a),qs($s,i.c,i.a),Js(Ws,t.d,$s);var e=Qs(Vs,Ws);if(e<Number.EPSILON&&(!n||e>-Number.EPSILON))return 0;var r=1/e;qs(zs,t.o,i.a);var s=Qs(zs,Ws)*r;if(s<0||s>1)return 0;Js(Xs,zs,Vs);var h=Qs(t.d,Xs)*r;if(h<0||s+h>1)return 0;var u=Qs($s,Xs)*r;return u<0?0:u}),ah=function(){var t=nr();return function(i,n){var e=n.radius,r=n.center,s=i.o,h=i.d,u=e*e;qs(t,r,s);var o=t.lengthSqr(),a=Qs(t,h),c=u-(o-a*a);if(c<0)return 0;var f=Math.sqrt(c),v=o<u?a+f:a-f;return v<0?0:v}}(),ch=function(){var t=nr(),i=nr();return function(n,e){return qs(t,e.center,e.halfExtents),nh(i,e.center,e.halfExtents),fh(n,t,i)}}();function fh(t,i,n){var e=t.o,r=t.d,s=1/r.x,h=1/r.y,u=1/r.z,o=(i.x-e.x)*s,a=(n.x-e.x)*s,c=(i.y-e.y)*h,f=(n.y-e.y)*h,v=(i.z-e.z)*u,l=(n.z-e.z)*u,d=rh(rh(sh(o,a),sh(c,f)),sh(v,l)),g=sh(sh(rh(o,a),rh(c,f)),rh(v,l));return g<0||d>g?0:d>0?d:g}var vh=function(){var t=nr(),i=nr(),n=nr(),e=nr(),r=nr(),s=nr(),h=nr(),u=new Array(3),o=new Array(3),a=new Array(3),c=new Array(6);return function(f,v){var l=v.halfExtents,d=v.orientation;u[0]=l.x,u[1]=l.y,u[2]=l.z,t=v.center,i=f.o,n=f.d,Zs(e,d.m00,d.m01,d.m02),Zs(r,d.m03,d.m04,d.m05),Zs(s,d.m06,d.m07,d.m08),qs(h,t,i),o[0]=Qs(e,n),o[1]=Qs(r,n),o[2]=Qs(s,n),a[0]=Qs(e,h),a[1]=Qs(r,h),a[2]=Qs(s,h);for(var g=0;g<3;++g){if(0===o[g]){if(-a[g]-u[g]>0||-a[g]+u[g]<0)return 0;o[g]=1e-7}c[2*g+0]=(a[g]+u[g])/o[g],c[2*g+1]=(a[g]-u[g])/o[g]}var w=rh(rh(sh(c[0],c[1]),sh(c[2],c[3])),sh(c[4],c[5])),_=sh(sh(rh(c[0],c[1]),rh(c[2],c[3])),rh(c[4],c[5]));return _<0||w>_?0:w>0?w:_}}(),lh=function(){var t=nr(),i=nr(),n=nr(),e=nr(),r=nr(),s=nr(),h=nr(),u=new Ys;return function(o,a){var c=a.ellipseCenter0,f=a.ellipseCenter1,v=qs(i,f,c);if(v.length()<qn)return u.radius=a.radius,u.center.set(a.ellipseCenter0),Qh.raySphere(o,u);var l=o.o,d=qs(n,l,c),g=ir.normalize(t,o.d),w=Js(e,g,v),_=w.lengthSqr();if(0===_){u.radius=a.radius;var m=qs(r,f,l);return d.lengthSqr()<m.lengthSqr()?u.center.set(c):u.center.set(f),Qh.raySphere(o,u)}var p=Js(r,d,v),y=v.lengthSqr(),b=2*Qs(w,p),A=a.radius*a.radius,E=b*b-4*_*(p.lengthSqr()-A*y);if(E<0)return 0;var k=(-b-Math.sqrt(E))/(2*_);if(k<0){u.radius=a.radius;var T=qs(s,f,l);return d.lengthSqr()<T.lengthSqr()?u.center.set(a.ellipseCenter0):u.center.set(a.ellipseCenter1),Qh.raySphere(o,u)}var S=eh(s,o.o,g,k),O=qs(h,S,c),R=Qs(O,v)/y;return R>=0&&R<=1?k:R<0?(u.radius=a.radius,u.center.set(a.ellipseCenter0),Qh.raySphere(o,u)):R>1?(u.radius=a.radius,u.center.set(a.ellipseCenter1),Qh.raySphere(o,u)):0}}(),dh=function(){var t=nr();return function(i,n){qs(t,i.e,i.s);var e=-Cs(i.s,n)/Qs(t,n.n);return e<0||e>1?0:e}}(),gh=function(){var t=nr(),i=nr(),n=nr(),e=nr(),r=nr(),s=nr();return function(h,u,o){qs(t,u.b,u.a),qs(i,u.c,u.a),qs(n,h.s,h.e),Js(r,t,i);var a=Qs(n,r);if(a<=0)return 0;qs(e,h.s,u.a);var c=Qs(e,r);if(c<0||c>a)return 0;Js(s,n,e);var f=Qs(i,s);if(f<0||f>a)return 0;var v=-Qs(t,s);if(v<0||f+v>a)return 0;if(o){var l=1/a,d=1-(f*=l)-(v*=l);Zs(o,u.a.x*d+u.b.x*f+u.c.x*v,u.a.y*d+u.b.y*f+u.c.y*v,u.a.z*d+u.b.z*f+u.c.z*v)}return 1}}(),wh=new Ds;function _h(t,i){wh.o.set(t.s),qs(wh.d,t.e,t.s),wh.d.normalize();var n=ch(wh,i);return n<=t.length()?n:0}function mh(t,i){wh.o.set(t.s),qs(wh.d,t.e,t.s),wh.d.normalize();var n=vh(wh,i);return n<=t.length()?n:0}function ph(t,i){wh.o.set(t.s),qs(wh.d,t.e,t.s),wh.d.normalize();var n=ah(wh,i);return n<=t.length()?n:0}var yh,bh,Ah,Eh,kh=(yh=nr(),bh=nr(),Ah=nr(),Eh=nr(),function(t,i){return qs(yh,t.center,t.halfExtents),nh(bh,t.center,t.halfExtents),qs(Ah,i.center,i.halfExtents),nh(Eh,i.center,i.halfExtents),yh.x<=Eh.x&&bh.x>=Ah.x&&yh.y<=Eh.y&&bh.y>=Ah.y&&yh.z<=Eh.z&&bh.z>=Ah.z});function Th(t,i,n){Zs(n[0],t.x,i.y,i.z),Zs(n[1],t.x,i.y,t.z),Zs(n[2],t.x,t.y,i.z),Zs(n[3],t.x,t.y,t.z),Zs(n[4],i.x,i.y,i.z),Zs(n[5],i.x,i.y,t.z),Zs(n[6],i.x,t.y,i.z),Zs(n[7],i.x,t.y,t.z)}function Sh(t,i,n,e,r,s){Zs(s[0],t.x+n.x*i.x+e.x*i.y+r.x*i.z,t.y+n.y*i.x+e.y*i.y+r.y*i.z,t.z+n.z*i.x+e.z*i.y+r.z*i.z),Zs(s[1],t.x-n.x*i.x+e.x*i.y+r.x*i.z,t.y-n.y*i.x+e.y*i.y+r.y*i.z,t.z-n.z*i.x+e.z*i.y+r.z*i.z),Zs(s[2],t.x+n.x*i.x-e.x*i.y+r.x*i.z,t.y+n.y*i.x-e.y*i.y+r.y*i.z,t.z+n.z*i.x-e.z*i.y+r.z*i.z),Zs(s[3],t.x+n.x*i.x+e.x*i.y-r.x*i.z,t.y+n.y*i.x+e.y*i.y-r.y*i.z,t.z+n.z*i.x+e.z*i.y-r.z*i.z),Zs(s[4],t.x-n.x*i.x-e.x*i.y-r.x*i.z,t.y-n.y*i.x-e.y*i.y-r.y*i.z,t.z-n.z*i.x-e.z*i.y-r.z*i.z),Zs(s[5],t.x+n.x*i.x-e.x*i.y-r.x*i.z,t.y+n.y*i.x-e.y*i.y-r.y*i.z,t.z+n.z*i.x-e.z*i.y-r.z*i.z),Zs(s[6],t.x-n.x*i.x+e.x*i.y-r.x*i.z,t.y-n.y*i.x+e.y*i.y-r.y*i.z,t.z-n.z*i.x+e.z*i.y-r.z*i.z),Zs(s[7],t.x-n.x*i.x-e.x*i.y+r.x*i.z,t.y-n.y*i.x-e.y*i.y+r.y*i.z,t.z-n.z*i.x-e.z*i.y+r.z*i.z)}function Oh(t,i){for(var n=Qs(i,t[0]),e=n,r=1;r<8;++r){var s=Qs(i,t[r]);n=s<n?s:n,e=s>e?s:e}return[n,e]}var Rh,Ih,Mh,Nh,Ch,Lh=function(){for(var t=new Array(15),i=0;i<15;i++)t[i]=nr();for(var n=new Array(8),e=new Array(8),r=0;r<8;r++)n[r]=nr(),e[r]=nr();var s=nr(),h=nr();return function(i,r){var u=r.orientation;Zs(t[0],1,0,0),Zs(t[1],0,1,0),Zs(t[2],0,0,1),Zs(t[3],u.m00,u.m01,u.m02),Zs(t[4],u.m03,u.m04,u.m05),Zs(t[5],u.m06,u.m07,u.m08);for(var o=0;o<3;++o)Js(t[6+3*o],t[o],t[3]),Js(t[7+3*o],t[o],t[4]),Js(t[7+3*o],t[o],t[5]);qs(s,i.center,i.halfExtents),nh(h,i.center,i.halfExtents),Th(s,h,n),Sh(r.center,r.halfExtents,t[3],t[4],t[5],e);for(var a=0;a<15;++a){var c=Oh(n,t[a]),f=Oh(e,t[a]);if(f[0]>c[1]||c[0]>f[1])return 0}return 1}}(),Fh=function(t,i){var n=t.halfExtents,e=i.n,r=n.x*hh(e.x)+n.y*hh(e.y)+n.z*hh(e.z),s=Qs(e,t.center);return s+r<i.d?-1:s-r>i.d?0:1},Ph=function(t,i){for(var n=i.planes,e=0;e<n.length;e++)if(-1===Fh(t,n[e]))return 0;return 1},Bh=function(){for(var t=new Array(8),i=0,n=0,e=0;e<t.length;e++)t[e]=nr();return function(e,r){for(var s=r.vertices,h=e.halfExtents,u=0,o=!1,a=0;a<r.planes.length;a++){if(-1===(u=Fh(e,r.planes[a])))return 0;1===u&&(o=!0)}if(!o)return 1;for(var c=0;c<s.length;c++)qs(t[c],s[c],e.center);i=0,n=0;for(var f=0;f<s.length;f++)t[f].x>h.x?i++:t[f].x<-h.x&&n++;if(i===s.length||n===s.length)return 0;i=0,n=0;for(var v=0;v<s.length;v++)t[v].y>h.y?i++:t[v].y<-h.y&&n++;if(i===s.length||n===s.length)return 0;i=0,n=0;for(var l=0;l<s.length;l++)t[l].z>h.z?i++:t[l].z<-h.z&&n++;return i===s.length||n===s.length?0:1}}(),Dh=(Rh=nr(),Ih=new _r,function(t,i){return qs(Rh,i,t.center),ir.transformMat3(Rh,Rh,_r.transpose(Ih,t.orientation)),n=Rh,e=t.halfExtents,hh(n.x)<e.x&&hh(n.y)<e.y&&hh(n.z)<e.z;var n,e}),Uh=(Mh=function(t,i,n,e){return hh(t.x*i+t.y*n+t.z*e)},function(t,i){var n=t.orientation,e=t.halfExtents,r=i.n,s=i.d,h=e.x*Mh(r,n.m00,n.m01,n.m02)+e.y*Mh(r,n.m03,n.m04,n.m05)+e.z*Mh(r,n.m06,n.m07,n.m08),u=Qs(r,t.center);return u+h<s?-1:u-h>s?0:1}),xh=function(t,i){for(var n=i.planes,e=0;e<n.length;e++)if(-1===Uh(t,n[e]))return 0;return 1},Gh=function(){for(var t=new Array(8),i=0,n=0,e=0,r=0;r<t.length;r++)t[r]=nr();var s=function(t,i,n,e){return t.x*i+t.y*n+t.z*e};return function(r,h){for(var u=r.orientation,o=r.halfExtents,a=h.vertices,c=h.planes,f=0,v=!1,l=0;l<c.length;l++){if(-1===(f=Uh(r,c[l])))return 0;1===f&&(v=!0)}if(!v)return 1;for(var d=0;d<a.length;d++)qs(t[d],a[d],r.center);n=0,e=0;for(var g=0;g<a.length;g++)(i=s(t[g],u.m00,u.m01,u.m02))>o.x?n++:i<-o.x&&e++;if(n===a.length||e===a.length)return 0;n=0,e=0;for(var w=0;w<a.length;w++)(i=s(t[w],u.m03,u.m04,u.m05))>o.y?n++:i<-o.y&&e++;if(n===a.length||e===a.length)return 0;n=0,e=0;for(var _=0;_<a.length;_++)(i=s(t[_],u.m06,u.m07,u.m08))>o.z?n++:i<-o.z&&e++;return n===a.length||e===a.length?0:1}}(),jh=function(){for(var t=new Array(15),i=0;i<15;i++)t[i]=nr();for(var n=new Array(8),e=new Array(8),r=0;r<8;r++)n[r]=nr(),e[r]=nr();return function(i,r){var s=i.orientation,h=r.orientation;Zs(t[0],s.m00,s.m01,s.m02),Zs(t[1],s.m03,s.m04,s.m05),Zs(t[2],s.m06,s.m07,s.m08),Zs(t[3],h.m00,h.m01,h.m02),Zs(t[4],h.m03,h.m04,h.m05),Zs(t[5],h.m06,h.m07,h.m08);for(var u=0;u<3;++u)Js(t[6+3*u],t[u],t[3]),Js(t[7+3*u],t[u],t[4]),Js(t[8+3*u],t[u],t[5]);Sh(i.center,i.halfExtents,t[0],t[1],t[2],n),Sh(r.center,r.halfExtents,t[3],t[4],t[5],e);for(var o=0;o<15;++o){var a=Oh(n,t[o]),c=Oh(e,t[o]);if(c[0]>a[1]||a[0]>c[1])return 0}return 1}}(),Hh=function(){for(var t=new Ys,i=nr(),n=nr(),e=nr(),r=new Array(8),s=0;s<8;s++)r[s]=nr();for(var h=new Array(8),u=0;u<8;u++)h[u]=nr();return function(s,u){var o=u.ellipseCenter0,a=u.ellipseCenter1,c=u.radius;if(0===Ks(o,a))return t.radius=u.radius,t.center.set(o),Qh.sphereOBB(t,s);var f=s.orientation;i.x=f.m00,i.y=f.m01,i.z=f.m02,n.x=f.m03,n.y=f.m04,n.z=f.m05,e.x=f.m06,e.y=f.m07,e.z=f.m08,Sh(s.center,s.halfExtents,i,n,e,r);var v=h,l=ih(v[0],i),d=ih(v[1],n),g=ih(v[2],e);qs(v[3],u.center,s.center).normalize();var w=qs(v[4],o,a);w.normalize(),Js(v[5],l,w),Js(v[6],d,w),Js(v[7],g,w);for(var _=0;_<8;++_){var m=Oh(r,v[_]),p=Qs(v[_],o),y=Qs(v[_],a),b=rh(p,y)+c;if(sh(p,y)-c>m[1]||m[0]>b)return 0}return 1}}(),Vh=function(t,i){var n=Qs(i.n,t.center),e=t.radius*i.n.length();return n+e<i.d?-1:n-e>i.d?0:1},$h=function(t,i){for(var n=i.planes,e=0;e<n.length;e++)if(-1===Vh(t,n[e]))return 0;return 1},Wh=(Nh=nr(),Ch=[1,-1,1,-1,1,-1],function(t,i){for(var n=0;n<6;n++){var e=i.planes[n],r=t.radius,s=t.center,h=e.n,u=e.d,o=Qs(h,s);if(o+r<u)return 0;if(!(o-r>u)){nh(Nh,s,th(Nh,h,r));for(var a=0;a<6;a++)if(a!==n&&a!==n+Ch[n]){var c=i.planes[a];if(Qs(c.n,Nh)<c.d)return 0}}}return 1}),zh=function(t,i){var n=t.radius+i.radius;return Ks(t.center,i.center)<n*n},Xh=function(){var t=nr();return function(i,n){var e=i.radius;return Ls(t,i.center,n),Ks(i.center,t)<e*e}}(),Yh=function(){var t=nr();return function(i,n){var e=i.radius;return Fs(t,i.center,n),Ks(i.center,t)<e*e}}(),Kh=function(){var t=nr(),i=nr();return function(n,e){var r=e.ellipseCenter0,s=e.ellipseCenter1,h=n.center,u=n.radius+e.radius,o=u*u,a=Ks(r,s);if(0===a)return Ks(h,e.center)<o;qs(t,h,r),qs(i,s,r);var c=Qs(t,i)/a;return c<0?Ks(h,r)<o:c>1?Ks(h,s)<o:(eh(t,r,i,c),Ks(h,t)<o)}}(),qh=function(){var t=nr(),i=nr(),n=nr(),e=nr(),r=nr(),s=nr();return function(h,u){var o,a,c=h.ellipseCenter0,f=h.ellipseCenter1,v=u.ellipseCenter1,l=u.ellipseCenter0,d=qs(t,f,c),g=qs(i,v,l),w=qs(n,c,l),_=Qs(d,d),m=Qs(d,g),p=Qs(g,g),y=Qs(d,w),b=Qs(g,w),A=_*p-m*m,E=A,k=A;A<qn?(o=0,E=1,a=b,k=p):(a=_*b-m*y,(o=m*b-p*y)<0?(o=0,a=b,k=p):o>E&&(o=E,a=b+m,k=p)),a<0?(a=0,-y<0?o=0:-y>_?o=E:(o=-y,E=_)):a>k&&(a=k,-y+m<0?o=0:-y+m>_?o=E:(o=-y+m,E=_));var T=hh(o)<qn?0:o/E,S=hh(a)<qn?0:a/k,O=e;O.set(w),O.add(th(r,d,T)),O.subtract(th(s,g,S));var R=h.radius+u.radius;return O.lengthSqr()<R*R}}(),Qh={raySphere:ah,rayAABB:ch,rayOBB:vh,rayPlane:uh,rayTriangle:oh,rayCapsule:lh,raySubMesh:null,rayMesh:null,rayModel:null,lineSphere:ph,lineAABB:_h,lineOBB:mh,linePlane:dh,lineTriangle:gh,sphereWithSphere:zh,sphereAABB:Xh,sphereOBB:Yh,spherePlane:Vh,sphereFrustum:$h,sphereFrustumAccurate:Wh,sphereCapsule:Kh,aabbWithAABB:kh,aabbWithOBB:Lh,aabbPlane:Fh,aabbFrustum:Ph,aabbFrustumAccurate:Bh,obbWithOBB:jh,obbPlane:Uh,obbFrustum:xh,obbFrustumAccurate:Gh,obbPoint:Dh,obbCapsule:Hh,aabbFrustumCompletelyInside:function(t,i){for(var n=i.planes,e=0;e<n.length;e++)if(0!==Fh(t,n[e]))return 0;return 1},capsuleWithCapsule:qh,resolve:function(t,i,n){void 0===n&&(n=null);var e=t._type,r=i._type,s=this[e|r];return e<r?s(t,i,n):s(i,t,n)}};Qh[5]=ah,Qh[9]=ch,Qh[17]=vh,Qh[33]=uh,Qh[65]=oh,Qh[513]=lh,Qh[6]=ph,Qh[10]=_h,Qh[18]=mh,Qh[34]=dh,Qh[66]=gh,Qh[4]=zh,Qh[12]=Xh,Qh[20]=Yh,Qh[36]=Vh,Qh[132]=$h,Qh[260]=Wh,Qh[516]=Kh,Qh[8]=kh,Qh[24]=Lh,Qh[40]=Fh,Qh[136]=Ph,Qh[264]=Bh,Qh[16]=jh,Qh[48]=Uh,Qh[144]=xh,Qh[272]=Gh,Qh[528]=Hh,Qh[512]=qh,dt(Bs.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),gt(Qh,"intersect",[{name:"line_quad"}]);var Zh=new ir(0,0,0),Jh=new ir(0,0,0),tu=Zr(),iu=Ue(),nu=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),this._type=32,this.n=new ir(t,i,n),this.d=e}return t.create=function(i,n,e,r){return new t(i,n,e,r)},t.clone=function(i){return new t(i.n.x,i.n.y,i.n.z,i.d)},t.copy=function(t,i){return ir.copy(t.n,i.n),t.d=i.d,t},t.fromPoints=function(t,i,n,e){return ir.subtract(Zh,n,i),ir.subtract(Jh,e,i),ir.normalize(t.n,ir.cross(t.n,Zh,Jh)),t.d=ir.dot(t.n,i),t},t.set=function(t,i,n,e,r){return t.n.x=i,t.n.y=n,t.n.z=e,t.d=r,t},t.fromNormalAndPoint=function(t,i,n){return ir.copy(t.n,i),t.d=ir.dot(i,n),t},t.normalize=function(t,i){var n=i.n.length();return ir.normalize(t.n,i.n),n>0&&(t.d=i.d/n),t},t.prototype.transform=function(t){Kr.invert(tu,t),Kr.transpose(tu,tu),De.set(iu,this.n.x,this.n.y,this.n.z,-this.d),De.transformMat4(iu,iu,tu),ir.set(this.n,iu.x,iu.y,iu.z),this.d=-iu.w},e(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}(),eu=function(){function t(t,i,n,e,r,s,h,u,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===o&&(o=0),this._type=64,this.a=new ir(t,i,n),this.b=new ir(e,r,s),this.c=new ir(h,u,o)}return t.create=function(i,n,e,r,s,h,u,o,a){return void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=1),new t(i,n,e,r,s,h,u,o,a)},t.clone=function(i){return new t(i.a.x,i.a.y,i.a.z,i.b.x,i.b.y,i.b.z,i.c.x,i.c.y,i.c.z)},t.copy=function(t,i){return ir.copy(t.a,i.a),ir.copy(t.b,i.b),ir.copy(t.c,i.c),t},t.fromPoints=function(t,i,n,e){return ir.copy(t.a,i),ir.copy(t.b,n),ir.copy(t.c,e),t},t.set=function(t,i,n,e,r,s,h,u,o,a){return t.a.x=i,t.a.y=n,t.a.z=e,t.b.x=r,t.b.y=s,t.b.z=h,t.c.x=u,t.c.y=o,t.c.z=a,t},e(t,[{key:"type",get:function(){return this._type}}]),t}();St({replaceProperty:{since:"3.6.0",removed:!1},removeProperty:{since:"3.6.0",removed:!1},markAsWarning:{since:"3.6.0",removed:!1},setDefaultLogTimes:{since:"3.6.0",removed:!1}});var ru=function(){function t(){this._poolHandle=-1,hu.addContainer(this)}return t.prototype.destroy=function(){hu.removeContainer(this)},t}(),su=function(){function t(){this.C=[],this.L=0,this.shrinkTimeSpan=5}var i=t.prototype;return i.addContainer=function(t){-1===t._poolHandle&&(t._poolHandle=this.C.length,this.C.push(t))},i.removeContainer=function(t){-1!==t._poolHandle&&(this.C[this.C.length-1]._poolHandle=t._poolHandle,pi(this.C,t._poolHandle),t._poolHandle=-1)},i.tryShrink=function(){for(var t=0;t<this.C.length;t++)this.C[t].tryShrink()},i.update=function(t){this.L+=t,this.L>this.shrinkTimeSpan&&(this.tryShrink(),this.L-=this.shrinkTimeSpan)},t}(),hu=new su,uu=t("Pool",function(t){function i(i,n,e,r){var s;(s=t.call(this)||this).F=[],s.P=i,s.D=e||null,s.U=Math.max(n,1),s.H=r?M(r,1):s.U,s.V=s.U-1;for(var h=0;h<s.U;++h)s.F.push(i());return s}s(i,t);var n=i.prototype;return n.alloc=function(){if(this.V<0){this.F.length=this.U;for(var t=0;t<this.U;t++)this.F[t]=this.P();this.V=this.U-1}return this.F[this.V--]},n.free=function(t){this.F[++this.V]=t},n.freeArray=function(t){this.F.length=this.V+1,Array.prototype.push.apply(this.F,t),this.V+=t.length},n.tryShrink=function(){var t=this.V+1;if(!(t<=this.H)){var i;if(i=t>>1>=this.H?t>>1:Math.floor((t-this.H+1)/2),this.D)for(var n=this.V-i+1;n<=this.V;++n)this.D(this.F[n]);this.V-=i,this.F.length=this.V+1}},n.destroy=function(){var i=arguments.length>0?arguments[0]:null;i&&st(14100);var n=i||this.D;if(n)for(var e=0;e<=this.V;e++)n(this.F[e]);this.F.length=0,this.V=-1,t.prototype.destroy.call(this)},i}(ru)),ou=t("RecyclePool",function(t){function i(i,n,e){var r;(r=t.call(this)||this).$=0,r.W=i,r.D=e||null,r.I=new Array(n),r.K=n;for(var s=0;s<n;++s)r.I[s]=i();return r}s(i,t);var n=i.prototype;return n.reset=function(){this.$=0},n.resize=function(t){if(t>this.I.length)for(var i=this.I.length;i<t;++i)this.I[i]=this.W()},n.add=function(){return this.$>=this.I.length&&this.resize(this.I.length<<1),this.I[this.$++]},n.destroy=function(){if(this.D)for(var i=0;i<this.I.length;i++)this.D(this.I[i]);this.I.length=0,this.$=0,t.prototype.destroy.call(this)},n.tryShrink=function(){if(this.I.length>>2>this.$){var t=Math.max(this.K,this.I.length>>1);if(this.D)for(var i=t;i<this.I.length;i++)this.D(this.I[i]);this.I.length=t}},n.removeAt=function(t){if(!(t>=this.$)){var i=this.$-1,n=this.I[t];this.I[t]=this.I[i],this.I[i]=n,this.$-=1}},e(i,[{key:"length",get:function(){return this.$}},{key:"data",get:function(){return this.I}}]),i}(ru)),au=t("CachedArray",function(t){function i(i,n){var e;return(e=t.call(this)||this).length=0,e.K=0,e.array=new Array(i),e.K=i,e.Z=n,e}s(i,t);var n=i.prototype;return n.push=function(t){this.array[this.length++]=t},n.pop=function(){return this.array[--this.length]},n.get=function(t){return this.array[t]},n.clear=function(){this.length=0},n.destroy=function(){this.length=0,this.array.length=0,t.prototype.destroy.call(this)},n.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this.K,this.array.length>>1))},n.sort=function(){this.array.length=this.length,this.array.sort(this.Z)},n.concat=function(t){for(var i=0;i<t.length;++i)this.array[this.length++]=t[i]},n.fastRemove=function(t){if(!(t>=this.length||t<0)){var i=--this.length;this.array[t]=this.array[i]}},n.indexOf=function(t){for(var i=0,n=this.length;i<n;++i)if(this.array[i]===t)return i;return-1},i}(ru));t("memop",Object.freeze({__proto__:null,CachedArray:au,Pool:uu,RecyclePool:ou}));var cu=t("editorExtrasTag","__editorExtras__"),fu=t("CCObjectFlags",{Destroyed:1,RealDestroyed:2,ToDestroy:4,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsOnEnableCalled:2048,IsEditorOnEnableCalled:4096,IsPreloadStarted:8192,IsOnLoadCalled:16384,IsOnLoadStarted:32768,IsStartCalled:65536,IsRotationLocked:131072,IsScaleLocked:262144,IsAnchorLocked:524288,IsSizeLocked:1048576,IsPositionLocked:2097152,PersistentMask:-4192741,AllHideMasks:1560}),vu=[];function lu(t,i){var n,e=t instanceof T.Node||t instanceof T.Component,r=e?"_id":null,s={};for(n in t)if(t.hasOwnProperty(n)){if(n===r)continue;switch(typeof t[n]){case"string":s[n]="";break;case"object":case"function":s[n]=null}}if(Un._isCCClass(i))for(var h=T.Class.Attr.getClassAttrs(i),u=i.__props__,o=0;o<u.length;o++){var a=""+(n=u[o]);if(a in h){if(e&&"_id"===n)continue;switch(typeof h[a]){case"string":s[n]="";break;case"object":case"function":s[n]=null;break;case"undefined":s[n]=void 0}}}var c="";for(n in s){var f;f=Un.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+Un.escapeForJS(n)+"]=";var v=s[n];""===v&&(v='""'),c+=f+v+";\n"}return Function("o",c)}var du=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=0,this._name=t}t._deferredDestroy=function(){for(var t=vu.length,i=0;i<t;++i){var n=vu[i];1&n._objFlags||n._destroyImmediate()}t===vu.length?vu.length=0:vu.splice(0,t)};var i=t.prototype;return i.destroy=function(){return 1&this._objFlags?(st(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,vu.push(this),0))},i._destruct=function(){var t,i=this.constructor;Object.prototype.hasOwnProperty.call(i,"__destruct__")?t=i.__destruct__:(t=lu(this,i),Dt(i,"__destruct__",t,!0)),t(this)},i._destroyImmediate=function(){var t;1&this._objFlags?ut(5e3):(null==(t=this._onPreDestroy)||t.call(this),this._destruct(),this._objFlags|=1)},e(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"hideFlags",get:function(){return 1560&this._objFlags},set:function(t){var i=1560&t;this._objFlags=-1561&this._objFlags|i}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}());du.prototype._deserialize=null,Un.fastDefine("cc.Object",du,{_name:"",_objFlags:0});var gu={};for(var wu in fu)"string"==typeof wu&&"number"==typeof fu[wu]&&(gu[wu]=fu[wu]);function _u(t){return t instanceof du}function mu(t,i){return"object"==typeof t?!(!t||t._objFlags&(i?5:1)):void 0!==t}Dt(du,"Flags",gu),T.isValid=mu,T.Object=du;var pu=pi;function yu(){}var bu=function(){function t(){this.callback=yu,this.target=void 0,this.once=!1}var i=t.prototype;return i.set=function(t,i,n){this.callback=t||yu,this.target=i,this.once=!!n},i.reset=function(){this.target=void 0,this.callback=yu,this.once=!1},i.check=function(){return!(_u(this.target)&&!mu(this.target,!0))},t}(),Au=new uu((function(){return new bu}),32),Eu=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var i=t.prototype;return i.removeByCallback=function(t){for(var i=0;i<this.callbackInfos.length;++i){var n=this.callbackInfos[i];n&&n.callback===t&&(n.reset(),Au.free(n),pu(this.callbackInfos,i),--i)}},i.removeByTarget=function(t){for(var i=0;i<this.callbackInfos.length;++i){var n=this.callbackInfos[i];n&&n.target===t&&(n.reset(),Au.free(n),pu(this.callbackInfos,i),--i)}},i.cancel=function(t){var i=this.callbackInfos[t];i&&(i.reset(),this.isInvoking?this.callbackInfos[t]=null:pu(this.callbackInfos,t),Au.free(i)),this.containCanceled=!0},i.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var i=this.callbackInfos[t];i&&(i.reset(),Au.free(i),this.callbackInfos[t]=null)}this.containCanceled=!0},i.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||pu(this.callbackInfos,t);this.containCanceled=!1},i.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),ku=new uu((function(){return new Eu}),16),Tu=t("CallbacksInvoker",function(){function t(){this._callbackTable=jt(!0),this.J=void 0}var i=t.prototype;return i.on=function(t,i,n,e){if(!this.hasEventListener(t,i,n)){var r=this._callbackTable[t];r||(r=this._callbackTable[t]=ku.alloc());var s=Au.alloc();s.set(i,n,e),r.callbackInfos.push(s)}return i},i.hasEventListener=function(t,i,n){var e=this._callbackTable&&this._callbackTable[t];if(!e)return!1;var r=e.callbackInfos;if(!i){if(e.isInvoking){for(var s=0;s<r.length;++s)if(r[s])return!0;return!1}return r.length>0}for(var h=0;h<r.length;++h){var u=r[h];if(u&&u.check()&&u.callback===i&&u.target===n)return!0}return!1},i.removeAll=function(t){var i=typeof t;if("string"===i||"number"===i){var n=this._callbackTable&&this._callbackTable[t];n&&(n.isInvoking?n.cancelAll():(n.clear(),ku.free(n),delete this._callbackTable[t]))}else if(t)for(var e in this._callbackTable){var r=this._callbackTable[e];if(r.isInvoking)for(var s=r.callbackInfos,h=0;h<s.length;++h){var u=s[h];u&&u.target===t&&r.cancel(h)}else r.removeByTarget(t)}},i.off=function(t,i,n){var e,r=this._callbackTable&&this._callbackTable[t];if(r){var s=r.callbackInfos;if(i)for(var h=0;h<s.length;++h){var u=s[h];if(u&&u.callback===i&&u.target===n){r.cancel(h);break}}else this.removeAll(t)}null==(e=this.J)||e.call(this)},i.emit=function(t,i,n,e,r,s){var h=this._callbackTable&&this._callbackTable[t];if(h){var u=!h.isInvoking;h.isInvoking=!0;for(var o=h.callbackInfos,a=0,c=o.length;a<c;++a){var f=o[a];if(f){var v=f.callback,l=f.target;f.once&&this.off(t,v,l),f.check()?l?v.call(l,i,n,e,r,s):v(i,n,e,r,s):this.off(t,v,l)}}u&&(h.isInvoking=!1,h.containCanceled&&h.purgeCanceled())}},i.clear=function(){for(var t in this._callbackTable){var i=this._callbackTable[t];i&&(i.clear(),ku.free(i),delete this._callbackTable[t])}},i.tt=function(t){this.J=t},t}());function Su(t){for(var i=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this)._callbackTable=jt(!0),i}s(i,t);var n=i.prototype;return n.once=function(t,i,n){return this.on(t,i,n,!0)},n.targetOff=function(t){this.removeAll(t)},i}(t),n=Tu.prototype,e=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<e.length;++r){var h=e[r];if(!(h in i.prototype)){var u=Object.getOwnPropertyDescriptor(n,h);u&&Object.defineProperty(i.prototype,h,u)}}return i}var Ou=t("EventTarget",Su((function(){})));T.EventTarget=Ou;var Ru,Iu,Mu,Nu,Cu,Lu,Fu=t("AsyncDelegate",function(){function t(){this.it=[]}var i=t.prototype;return i.add=function(t){this.it.includes(t)||this.it.push(t)},i.hasListener=function(t){return this.it.includes(t)},i.remove=function(t){bi(this.it,t)},i.dispatch=function(){for(var t=arguments,i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return Promise.all(this.it.map((function(i){return i.apply(void 0,t)})).filter(Boolean))},t}());!function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(Ru||(Ru={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg",t.HINDI="hi"}(Iu||(Iu={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(Mu||(Mu={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS",t.OPENHARMONY="OpenHarmony"}(Nu||(Nu={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.OPENHARMONY="OPENHARMONY",t.WECHAT_GAME="WECHAT_GAME",t.WECHAT_MINI_PROGRAM="WECHAT_MINI_PROGRAM",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.TAOBAO_CREATIVE_APP="TAOBAO_CREATIVE_APP",t.TAOBAO_MINI_GAME="TAOBAO_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.MIGU_MINI_GAME="MIGU_MINI_GAME",t.HONOR_MINI_GAME="HONOR_MINI_GAME"}(Cu||(Cu={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.HPE="HPE",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER",t.EVENT_GAMEPAD="EVENT_GAMEPAD",t.EVENT_HANDLE="EVENT_HANDLE",t.EVENT_HMD="EVENT_HMD",t.EVENT_HANDHELD="EVENT_HANDHELD",t.WASM="WASM"}(Lu||(Lu={}));var Pu=function(t){function i(){var i,n;(n=t.call(this)||this).nt=null,n.et=[];var e,r=window.navigator,s=r.userAgent.toLowerCase();null==r.getBattery||r.getBattery().then((function(t){n.nt=t})),n.networkType=Mu.LAN,n.isNative=!1,n.isBrowser=!0,n.isMobile=/mobile|android|iphone|ipad/.test(s),n.platform=n.isMobile?Cu.MOBILE_BROWSER:Cu.DESKTOP_BROWSER,n.isLittleEndian=(e=new ArrayBuffer(2),new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]);var h=r.language;n.nativeLanguage=h.toLowerCase(),h=(h=h||r.browserLanguage)?h.split("-")[0]:Iu.ENGLISH,n.language=h;var u=!1,o=!1,a="",c=0,f=/android\s*(\d+(?:\.\d+)*)/i.exec(s)||/android\s*(\d+(?:\.\d+)*)/i.exec(r.platform);f&&(u=!0,a=f[1]||"",c=parseInt(a)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(s))?(o=!0,a=f[2]||"",c=parseInt(a)||0):(/(iPhone|iPad|iPod)/.exec(r.platform)||"MacIntel"===r.platform&&r.maxTouchPoints&&r.maxTouchPoints>1)&&(o=!0,a="",c=0);var v=Nu.UNKNOWN;-1!==r.appVersion.indexOf("Win")?v=Nu.WINDOWS:o?v=Nu.IOS:-1!==r.appVersion.indexOf("Mac")?v=Nu.OSX:-1!==r.appVersion.indexOf("X11")&&-1===r.appVersion.indexOf("Linux")?v=Nu.LINUX:u?v=Nu.ANDROID:-1===r.appVersion.indexOf("Linux")&&-1===s.indexOf("ubuntu")||(v=Nu.LINUX),n.os=v,n.osVersion=a,n.osMainVersion=c,n.browserType=Ru.UNKNOWN;var l=/wechat|weixin|micromessenger/i.exec(s)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(s)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(s)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(s),d=l?l[0].toLowerCase():Nu.UNKNOWN;("safari"===d&&u||"qq"===d&&/android.*applewebkit/i.test(s))&&(d=Ru.ANDROID);var g={micromessenger:Ru.WECHAT,wechat:Ru.WECHAT,weixin:Ru.WECHAT,trident:Ru.IE,edge:Ru.EDGE,"360 aphone":Ru.BROWSER_360,mxbrowser:Ru.MAXTHON,"opr/":Ru.OPERA,ubrowser:Ru.UC,huaweibrowser:Ru.HUAWEI};n.browserType=g[d]||d,n.browserVersion="";var w=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(s);w||(w=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(s)),n.browserVersion=w?w[4]:"",n.isXR=!1;var _,m=document.createElement("canvas");m.getContext("2d");try{_=m.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){_=!1}if(n.os===Nu.IOS){var p,A=null==(p=/ applewebkit\/(\d+)/.exec(s))?void 0:p[1];"string"==typeof A&&Number.parseInt(A)>=604&&(_=!0)}else if(n.browserType===Ru.SAFARI){var E,k=null==(E=/ version\/(\d+)/.exec(s))?void 0:E[1];"string"==typeof k&&Number.parseInt(k)>=14&&(_=!0)}var T=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart||y,S=void 0!==document.documentElement.onmouseup||y,O=void 0!==navigator.xr,R=function(){if((n.os===Nu.IOS||n.os===Nu.OSX)&&/(OS 15_4)|(Version\/15.4)/.test(window.navigator.userAgent))return!1;try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1}();return n.rt=((i={})[Lu.WEBP]=_,i[Lu.IMAGE_BITMAP]=!1,i[Lu.WEB_VIEW]=!0,i[Lu.VIDEO_PLAYER]=!0,i[Lu.SAFE_AREA]=!1,i[Lu.HPE]=!1,i[Lu.INPUT_TOUCH]=T,i[Lu.EVENT_KEYBOARD]=void 0!==document.documentElement.onkeyup||y,i[Lu.EVENT_MOUSE]=S,i[Lu.EVENT_TOUCH]=T||S,i[Lu.EVENT_ACCELEROMETER]=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,i[Lu.EVENT_GAMEPAD]=void 0!==navigator.getGamepads||void 0!==navigator.webkitGetGamepads||O,i[Lu.EVENT_HANDLE]=b,i[Lu.EVENT_HMD]=O,i[Lu.EVENT_HANDHELD]=O,i[Lu.WASM]=R,i),n.et.push(n.st()),n.ht(),n}s(i,t);var n=i.prototype;return n.st=function(){var t=this;if("undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob){var i=document.createElement("canvas");i.width=i.height=2;var n=createImageBitmap(i);if(n instanceof Promise)return n.then((function(i){i&&i.close&&(t.ut(Lu.IMAGE_BITMAP,!0),i.close())}))}return Promise.resolve()},n.ht=function(){var t,i=this;t=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,e=function(){n||(n=!0,i.emit("hide"))},r=function(t,e,r,s,h){n&&(n=!1,i.emit("show",t,e,r,s,h))};if(t)for(var s=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],h=0;h<s.length;h++)document.addEventListener(s[h],(function(i){var n=document[t];(n=n||i.hidden)?e():r()}));else window.addEventListener("blur",e),window.addEventListener("focus",r);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",e),window.addEventListener("pageshow",r),document.addEventListener("pagehide",e),document.addEventListener("pageshow",r))},n.ut=function(t,i){return this.rt[t]=i},n.init=function(){return Promise.all(this.et)},n.hasFeature=function(t){return this.rt[t]},n.getBatteryLevel=function(){return this.nt?this.nt.level:1},n.triggerGC=function(){},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},n.restartJSVM=function(){},n.exit=function(){window.close()},n.close=function(){this.emit("close")},i}(Ou),Bu=new Pu,Du=/(\.[^./?\\]*)(\?.*)?$/,Uu=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,xu=/[^./]+\/\.\.\//;function Gu(){for(var t="",i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return n.forEach((function(i){t=(t+(""===t?"":"/")+i).replace(/(\/|\\\\)$/,"")})),t}function ju(t){var i=Du.exec(t);return i?i[1]:""}function Hu(t){if(t){var i=t.lastIndexOf(".");if(-1!==i)return t.substring(0,i)}return t}function Vu(t,i){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var e=/(\/|\\)([^/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!e)return t;var r=e[2];return i&&t.substring(t.length-i.length).toLowerCase()===i.toLowerCase()?r.substring(0,r.length-i.length):r}function $u(t){var i=Uu.exec(t);return i?i[2]:""}function Wu(t,i){i=i||"";var n=t.indexOf("?"),e="";return n>0&&(e=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+i+e:t.substring(0,n)+i+e}function zu(t,i,n){if(0===i.indexOf("."))return Wu(t,i);var e=t.indexOf("?"),r="",s=n?ju(t):"";return e>0&&(r=t.substring(e),t=t.substring(0,e)),e=(e=t.lastIndexOf("/"))<=0?0:e+1,t.substring(0,e)+i+s+r}function Xu(t){var i=t=String(t);do{i=t,t=t.replace(xu,"")}while(i.length!==t.length);return t}function Yu(t){return t.replace(/[/\\]$/,"")}function Ku(){return Bu.os===Nu.WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,_normalize:Xu,basename:Vu,changeBasename:zu,changeExtname:Wu,dirname:$u,extname:ju,getSeperator:Ku,join:Gu,mainFileName:Hu,stripSep:Yu}));var qu=new ir;function Qu(t,i,n,e){e||(e=new ir),t.convertToUINode(i,n,e);var r=n.position;return e.add(r),e}function Zu(t,i,n){return n||(n=new ir),t.worldToScreen(i,n),n.x/=T.view.getScaleX(),n.y/=T.view.getScaleY(),n}var Ju=t("convertUtils",{WorldNode3DToLocalNodeUI:Qu,WorldNode3DToWorldNodeUI:Zu});T.pipelineUtils=Ju,dt(T.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var e=i[0],r=i[3]||qu;return e.convertToUINode(i[1],i[2],r),r.add(i[2].position),i[3]||r.clone()}}]);var to,io={auto:Ui.AUTO,landscape:Ui.LANDSCAPE,portrait:Ui.PORTRAIT};!function(t){t[t.Unknown=0]="Unknown",t[t.SubFrame=1]="SubFrame",t[t.BrowserWindow=2]="BrowserWindow",t[t.Fullscreen=3]="Fullscreen"}(to||(to={}));var no=function(t){s(n,t);var i=n.prototype;function n(){var i,n,e,r,s,h;(i=t.call(this)||this).isFrameRotated=!1,i.handleResizeEvent=!0,i.ot=void 0,i.ct=void 0,i.ft=void 0,i.vt=!1,i.lt={width:"0px",height:"0px"},i.dt={width:"0px",height:"0px"},i.gt=void 0,i.wt=!1,i._t=void 0,i.yt=void 0,i.bt=void 0,i.At=-1,i.Et=new gs(0,0),i.kt=!1,i.Tt=!1,i.W={},i.St=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],i.Ot=1,i.Rt=Ui.AUTO,i.It=Ui.AUTO,i.ot=document.getElementById("GameDiv"),i.ct=document.getElementById("Cocos3dGameContainer"),i.ft=document.getElementById("GameCanvas"),i.ot||(i.ot=document.createElement("div"),i.ot.setAttribute("id","GameDiv"),null==(n=i.ft)||null==(e=n.parentNode)||e.insertBefore(i.ot,i.ft),i.ot.appendChild(i.ft)),i.ct||(i.ct=document.createElement("div"),i.ct.setAttribute("id","Cocos3dGameContainer"),null==(r=i.ft)||null==(s=r.parentNode)||s.insertBefore(i.ct,i.ft),i.ct.appendChild(i.ft));for(var u=i.St,o=0;o<u.length;o++)if(h=u[o],void 0!==document[h[1]]){for(var a=0;a<h.length;a++)i.W[u[0][a]]=h[a];break}return i.wt=void 0!==i.W.requestFullscreen,i._t="ontouchstart"in window?"touchend":"mousedown",i.ht(),i}return i.Mt=function(){this.Nt(),this.Ct()},i.init=function(t,i){this.gt=i,this.orientation=io[t.configOrientation],this.kt=t.exactFitScreen,this.Tt=t.isHeadlessMode,this.Ct()},i.requestFullScreen=function(){var t=this;return new Promise((function(i,n){t.isFullScreen?i():(t.Et=t.windowSize,t.Lt().then((function(){i()})).catch((function(){var e=t.Ft();e?e.addEventListener(t._t,(function(){t.Lt().then((function(){i()})).catch(n)}),{once:!0,capture:!0}):n(new Error("Cannot access fullscreen target"))})))}))},i.exitFullScreen=function(){var t=this;return new Promise((function(i,n){var e=document[t.W.exitFullscreen]();window.Promise&&e instanceof Promise?e.then((function(){t.windowSize=t.Et,i()})).catch(n):(t.windowSize=t.Et,i())}))},i.ht=function(){var t=this;document.addEventListener(this.W.fullscreenerror,(function(){null==t.bt||t.bt()})),window.addEventListener("resize",(function(){t.Mt()}));var i,n=function(i){i!==t.It&&(t.It=i,t.Mt(),t.emit("orientation-change",i))},e=function(){var i=Ui.PORTRAIT;switch(window.orientation){case 0:i=Ui.PORTRAIT;break;case 90:i=Ui.LANDSCAPE_RIGHT;break;case-90:i=Ui.LANDSCAPE_LEFT;break;case 180:i=Ui.PORTRAIT_UPSIDE_DOWN;break;default:i=t.It}return i},r=function(){-1!==t.At&&clearTimeout(t.At),t.At=setTimeout((function(){i()}),200)};if("function"==typeof window.matchMedia){!function i(){var n=window.devicePixelRatio,e=window.matchMedia("(resolution: "+n+"dppx)");e.addEventListener?e.addEventListener("change",(function(){t.emit("window-resize",t.windowSize.width,t.windowSize.height),i()}),{once:!0}):e.addListener&&e.addListener((function(){t.emit("window-resize",t.windowSize.width,t.windowSize.height)}))}();var s=window.matchMedia("(orientation: portrait)"),h=window.matchMedia("(orientation: landscape)"),u=screen.orientation;i=function(){var i=t.It;s.matches?(i=Ui.PORTRAIT,u&&(i="portrait-primary"===screen.orientation.type?Ui.PORTRAIT:Ui.PORTRAIT_UPSIDE_DOWN)):h.matches&&(i=Ui.LANDSCAPE,u&&(i="landscape-primary"===screen.orientation.type?Ui.LANDSCAPE_LEFT:Ui.LANDSCAPE_RIGHT)),n(i)},s.addEventListener?(s.addEventListener("change",r),h.addEventListener("change",r)):s.addListener&&(s.addListener(r),h.addListener(r))}else i=function(){var t=e();n(t)},window.addEventListener("orientationchange",r);document.addEventListener(this.W.fullscreenchange,(function(){null==t.yt||t.yt(),t.emit("fullscreen-change",t.windowSize.width,t.windowSize.height)}))},i.Pt=function(t){var i=t.clone(),n=this.devicePixelRatio;return i.width/=n,i.height/=n,i},i.Ct=function(t){if(this.ot){if(this.ot.style.display="flex",this.ot.style["justify-content"]="center",this.ot.style["align-items"]="center",this._windowType===to.SubFrame){if(!t)return void this.Bt();this.ot.style.width=t.width+"px",this.ot.style.height=t.height+"px"}else{var i=window.innerWidth,n=window.innerHeight,e=document.body.scrollHeight-n;Bu.os===Nu.ANDROID&&n<e&&(n+=e),this.isFrameRotated?(this.ot.style["-webkit-transform"]="rotate(90deg)",this.ot.style.transform="rotate(90deg)",this.ot.style["-webkit-transform-origin"]="0px 0px 0px",this.ot.style.transformOrigin="0px 0px 0px",this.ot.style.margin="0 0 0 "+i+"px",this.ot.style.width=n+"px",this.ot.style.height=i+"px"):(this.ot.style["-webkit-transform"]="rotate(0deg)",this.ot.style.transform="rotate(0deg)",this.ot.style.margin="0px auto",this.ot.style.width=i+"px",this.ot.style.height=n+"px")}this.Bt()}},i.Ft=function(){var t=this._windowType;return t===to.Fullscreen?document[this.W.fullscreenElement]:t===to.SubFrame?this.ot:document.body},i.Lt=function(){var t=this;return new Promise((function(i,n){if(t.wt){var e=t.Ft();if(e){t.yt=void 0,t.bt=void 0;var r=e[t.W.requestFullscreen]();window.Promise&&r instanceof Promise?r.then(i).catch(n):(t.yt=i,t.bt=n)}else n(new Error("Cannot access fullscreen target"))}else n(new Error("fullscreen is not supported"))}))},i.Nt=function(){var t=this.orientation,i=window.innerWidth>window.innerHeight;this.isFrameRotated=Bu.isMobile&&(i&&t===Ui.PORTRAIT||!i&&t===Ui.LANDSCAPE)},i.Bt=function(){if(this.ct){if(this.isProportionalToFrame){if(!this.ot)return void st(9201);var t,i,n=T.view.getDesignResolutionSize(),e=this.ot,r=e.clientWidth,s=e.clientHeight,h=n.width,u=n.height,o=r/h,a=s/u,c=this.ct.style;o<a?(t=r,i=u*o):(t=h*a,i=s),c.width=t+"px",c.height=i+"px"}else{var f=this.ct.style;f.width="100%",f.height="100%"}!this.ot||this.lt.width===this.ot.style.width&&this.lt.height===this.ot.style.height&&this.dt.width===this.ct.style.width&&this.dt.height===this.ct.style.height||(this.emit("window-resize",this.windowSize.width,this.windowSize.height),this.lt.width=this.ot.style.width,this.lt.height=this.ot.style.height,this.dt.width=this.ct.style.width,this.dt.height=this.ct.style.height)}else st(9201)},e(n,[{key:"supportFullScreen",get:function(){return this.wt}},{key:"isFullScreen",get:function(){return!!this.wt&&!!document[this.W.fullscreenElement]}},{key:"devicePixelRatio",get:function(){var t;return Math.min(null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,2)}},{key:"windowSize",get:function(){var t=this._windowSizeInCssPixels,i=this.devicePixelRatio;return t.width*=i,t.height*=i,t},set:function(t){this._windowType===to.SubFrame?this.Ct(this.Pt(t)):st(9202)}},{key:"resolution",get:function(){var t=this.windowSize,i=this.resolutionScale;return new gs(t.width*i,t.height*i)}},{key:"resolutionScale",get:function(){return this.Ot},set:function(t){var i;t!==this.Ot&&(this.Ot=t,null==(i=this.gt)||i.call(this))}},{key:"orientation",get:function(){return this.Rt},set:function(t){this.Rt!==t&&(this.Rt=t,this.Mt())}},{key:"safeAreaEdge",get:function(){var t=this.devicePixelRatio;return{top:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top")||"0")*t,bottom:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-bottom")||"0")*t,left:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-left")||"0")*t,right:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-right")||"0")*t}}},{key:"isProportionalToFrame",get:function(){return this.vt},set:function(t){this.vt!==t&&(this.vt=t,this.Bt())}},{key:"_windowSizeInCssPixels",get:function(){if(this.isProportionalToFrame)return this.ct?new gs(this.ct.clientWidth,this.ct.clientHeight):(st(9201),new gs(0,0));var t,i,n;switch(this._windowType){case to.SubFrame:return this.ot?new gs(this.ot.clientWidth,this.ot.clientHeight):(st(9201),new gs(0,0));case to.Fullscreen:return t=this.Ft(),i=this.isFrameRotated?t.clientHeight:t.clientWidth,n=this.isFrameRotated?t.clientWidth:t.clientHeight,new gs(i,n);case to.BrowserWindow:return i=this.isFrameRotated?window.innerHeight:window.innerWidth,n=this.isFrameRotated?window.innerWidth:window.innerHeight,new gs(i,n);case to.Unknown:default:return new gs(1,1)}}},{key:"_windowType",get:function(){return this.Tt?to.Unknown:this.isFullScreen?to.Fullscreen:this.ot?this.kt?to.BrowserWindow:to.SubFrame:(st(9201),to.Unknown)}}]),n}(Ou),eo=new no,ro=function(){function t(){}var i=t.prototype;return i.init=function(){var t,i,n=null===(t=xi.querySettings("screen","exactFitScreen"))||void 0===t||t,e=null!==(i=xi.querySettings("screen","orientation"))&&void 0!==i?i:"auto",r=3===xi.querySettings("rendering","renderMode");eo.init({exactFitScreen:n,configOrientation:e,isHeadlessMode:r},(function(){var t,i=T.director;null!=(t=i.root)&&t.pipeline?i.root.pipeline.shadingScale=eo.resolutionScale:st(1220)}))},i.fullScreen=function(){return eo.isFullScreen},i.requestFullScreen=function(t,i,n){return arguments.length>0&&st(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),eo.requestFullScreen().then((function(){null==i||i.call(document)})).catch((function(t){Y(t),null==n||n.call(document)}))},i.exitFullScreen=function(){return eo.exitFullScreen()},i.autoFullScreen=function(t,i){var n;null==(n=this.requestFullScreen(t,i))||n.catch((function(t){X(t)}))},i.disableAutoFullScreen=function(){},i.on=function(t,i,n){eo.on(t,i,n)},i.once=function(t,i,n){eo.once(t,i,n)},i.off=function(t,i,n){eo.off(t,i,n)},e(t,[{key:"devicePixelRatio",get:function(){return eo.devicePixelRatio}},{key:"windowSize",get:function(){return eo.windowSize},set:function(t){eo.windowSize=t}},{key:"resolution",get:function(){return eo.resolution}},{key:"supportsFullScreen",get:function(){return eo.supportFullScreen}}]),t}(),so=t("screen",new ro);T.screen=so;var ho=t("sys",{Feature:Lu,hasFeature:function(t){return Bu.hasFeature(t)},NetworkType:Mu,Language:Iu,OS:Nu,Platform:Cu,BrowserType:Ru,isNative:Bu.isNative,isBrowser:Bu.isBrowser,isMobile:Bu.isMobile,isLittleEndian:Bu.isLittleEndian,platform:Bu.platform,language:Bu.language,languageCode:Bu.nativeLanguage,os:Bu.os,osVersion:Bu.osVersion,osMainVersion:Bu.osMainVersion,browserType:Bu.browserType,browserVersion:Bu.browserVersion,isXR:Bu.isXR,windowPixelResolution:so.windowSize,capabilities:{canvas:!0,opengl:!0,webp:Bu.hasFeature(Lu.WEBP),imageBitmap:Bu.hasFeature(Lu.IMAGE_BITMAP),touches:Bu.hasFeature(Lu.INPUT_TOUCH),mouse:Bu.hasFeature(Lu.EVENT_MOUSE),keyboard:Bu.hasFeature(Lu.EVENT_KEYBOARD),accelerometer:Bu.hasFeature(Lu.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return Bu.networkType},getBatteryLevel:function(){return Bu.getBatteryLevel()},garbageCollect:function(){Bu.triggerGC()},isObjectValid:function(t){return null!=t},Dt:!1,dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="supports webp: "+ho.hasFeature(Lu.WEBP)+"\r\n",t+="supports bitmap: "+ho.hasFeature(Lu.IMAGE_BITMAP)+"\r\n",t+="supports touches: "+ho.hasFeature(Lu.INPUT_TOUCH)+"\r\n",t+="supports mouse: "+ho.hasFeature(Lu.EVENT_MOUSE)+"\r\n",t+="supports keyboard: "+ho.hasFeature(Lu.EVENT_KEYBOARD)+"\r\n",t+="supports accelerometer: "+ho.hasFeature(Lu.EVENT_ACCELEROMETER)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",z(t+="Using "+(T.game.renderType===T.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){Bu.openURL(t)},init:function(){var t=this;return Promise.resolve().then((function(){return Bu.init()})).then((function(){try{var i=ho.localStorage=window.localStorage;i.setItem("storage",""),i.removeItem("storage"),i=null}catch(i){var n=function(){st(5200)};t.localStorage={getItem:n,setItem:n,clear:n,removeItem:n,key:n,length:0}}t.Dt=(ho.os===Nu.IOS||ho.os===Nu.OSX)&&Bu.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}))},now:function(){return Bu.now()},restartVM:function(){Bu.restartJSVM()},getSafeAreaRect:function(t){void 0===t&&(t=!0);var i=T.view,n=eo.safeAreaEdge;t&&(eo.orientation===Gi.ORIENTATION_PORTRAIT?n.top<n.bottom?n.top=n.bottom:n.bottom=n.top:n.left<n.right?n.left=n.right:n.right=n.left);var e=eo.windowSize,r=new ls(n.left,n.bottom),s=new ls(e.width-n.right,e.height-n.top);i.Ut(r),i.Ut(s);var h=r.x,u=r.y,o=s.x-r.x,a=s.y-r.y;return new ps(h,u,o,a)}});T.sys=ho,wt(T,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),wt(ho,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),dt(ho,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(t){return{name:"LANGUAGE_"+t,newName:t,target:ho.Language,targetName:"sys.Language"}}))),dt(ho,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(t){return{name:"OS_"+t,newName:t,target:ho.OS,targetName:"sys.OS"}}))),dt(ho,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(t){return{name:"BROWSER_TYPE_"+t,newName:t,target:ho.BrowserType,targetName:"sys.BrowserType"}}))),dt(ho,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:ho.BrowserType,targetName:"sys.BrowserType"}]),dt(ho,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME"].map((function(t){return{name:t,target:ho.Platform,targetName:"sys.Platform"}}))),dt(ho,"sys",[{name:"IPHONE",newName:"IOS",target:ho.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:ho.Platform,targetName:"sys.Platform"}]),gt(ho,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(t){return{name:t}}))),dt(ho,"sys",[{name:"windowPixelResolution",target:so,targetName:"screen",newName:"windowSize"}]),wt(so,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);var uo=t("visibleRect",{topLeft:T.v2(0,0),topRight:T.v2(0,0),top:T.v2(0,0),bottomLeft:T.v2(0,0),bottomRight:T.v2(0,0),bottom:T.v2(0,0),center:T.v2(0,0),left:T.v2(0,0),right:T.v2(0,0),width:0,height:0,init:function(t){var i=this.width=t.width,n=this.height=t.height,e=t.x,r=t.y,s=r+n,h=e+i;this.topLeft.x=e,this.topLeft.y=s,this.topRight.x=h,this.topRight.y=s,this.top.x=e+i/2,this.top.y=s,this.bottomLeft.x=e,this.bottomLeft.y=r,this.bottomRight.x=h,this.bottomRight.y=r,this.bottom.x=e+i/2,this.bottom.y=r,this.center.x=e+i/2,this.center.y=r+n/2,this.left.x=e,this.left.y=r+n/2,this.right.x=h,this.right.y=r+n/2}});T.visibleRect=uo;var oo=new ir,ao=new ir,co=new ir,fo=new ir,vo=new _r,lo=Math.abs,go=function(t,i,n){vo.m00=lo(n.m00),vo.m01=lo(n.m01),vo.m02=lo(n.m02),vo.m03=lo(n.m04),vo.m04=lo(n.m05),vo.m05=lo(n.m06),vo.m06=lo(n.m08),vo.m07=lo(n.m09),vo.m08=lo(n.m10),ir.transformMat3(t,i,vo)},wo=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r=1),void 0===s&&(s=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=8,this.center=new ir(t,i,n),this.halfExtents=new ir(e,r,s)}t.create=function(i,n,e,r,s,h){return new t(i,n,e,r,s,h)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.halfExtents.x,i.halfExtents.y,i.halfExtents.z)},t.copy=function(t,i){return ir.copy(t.center,i.center),ir.copy(t.halfExtents,i.halfExtents),t},t.fromPoints=function(t,i,n){return ir.add(oo,n,i),ir.subtract(ao,n,i),ir.multiplyScalar(t.center,oo,.5),ir.multiplyScalar(t.halfExtents,ao,.5),t},t.set=function(t,i,n,e,r,s,h){return t.center.set(i,n,e),t.halfExtents.set(r,s,h),t},t.merge=function(i,n,e){return ir.subtract(oo,n.center,n.halfExtents),ir.subtract(ao,e.center,e.halfExtents),ir.add(co,n.center,n.halfExtents),ir.add(fo,e.center,e.halfExtents),ir.max(fo,co,fo),ir.min(co,oo,ao),t.fromPoints(i,co,fo)},t.toBoundingSphere=function(t,i){return t.center.set(i.center),t.radius=i.halfExtents.length(),t},t.transform=function(t,i,n){return ir.transformMat4(t.center,i.center,n),go(t.halfExtents,i.halfExtents,n),t};var i=t.prototype;return i.getBoundary=function(t,i){ir.subtract(t,this.center,this.halfExtents),ir.add(i,this.center,this.halfExtents)},i.transform=function(t,i,n,e,r){ir.transformMat4(r.center,this.center,t),go(r.halfExtents,this.halfExtents,t)},i.clone=function(){var i=this.center,n=this.halfExtents;return new t(i.x,i.y,i.z,n.x,n.y,n.z)},i.copy=function(t){return ir.copy(this.center,t.center),ir.copy(this.halfExtents,t.halfExtents),this},i.mergePoint=function(t){this.getBoundary(oo,ao),t.x<oo.x&&(oo.x=t.x),t.y<oo.y&&(oo.y=t.y),t.z<oo.z&&(oo.z=t.z),t.x>ao.x&&(ao.x=t.x),t.y>ao.y&&(ao.y=t.y),t.z>ao.z&&(ao.z=t.z),ir.add(co,oo,ao),this.center.set(ir.multiplyScalar(co,co,.5)),this.halfExtents.set(ao.x-co.x,ao.y-co.y,ao.z-co.z)},i.mergePoints=function(t){if(!(t.length<1))for(var i=0;i<t.length;i++)this.mergePoint(t[i])},i.mergeFrustum=function(t){this.mergePoints(t.vertices)},e(t,[{key:"type",get:function(){return this._type}}]),t}(),_o=function(){function t(t,i,n){void 0===t&&(t=.5),void 0===i&&(i=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=512,this.radius=t,this.halfHeight=i,this.axis=n,this.center=new ir,this.rotation=new Cr,this.ellipseCenter0=new ir(0,i,0),this.ellipseCenter1=new ir(0,-i,0),this.updateCache()}var i=t.prototype;return i.transform=function(t,i,n,e,r){var s=e,h=ge(s);r.radius=this.radius*Math.abs(h);var u=(this.halfHeight+this.radius)*Math.abs(s.y)-r.radius;u<0&&(u=0),r.halfHeight=u,ir.transformMat4(r.center,this.center,t),Cr.multiply(r.rotation,this.rotation,n),r.updateCache()},i.updateCache=function(){this.updateLocalCenter(),ir.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),ir.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},i.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},e(t,[{key:"type",get:function(){return this._type}}]),t}(),mo=new Array(8);mo[0]=nr(1,1,1),mo[1]=nr(-1,1,1),mo[2]=nr(-1,-1,1),mo[3]=nr(1,-1,1),mo[4]=nr(1,1,-1),mo[5]=nr(-1,1,-1),mo[6]=nr(-1,-1,-1),mo[7]=nr(1,-1,-1);var po,yo=nr(),bo=nr(),Ao=nr(),Eo=nu.fromPoints,ko=ir.set,To=ir.transformMat4,So=function(){i.createOrthographic=function(t,i,n,e,r,s){var h=i/2,u=n/2;ko(Ao,h,u,-e),To(t.vertices[0],Ao,s),ko(Ao,-h,u,-e),To(t.vertices[1],Ao,s),ko(Ao,-h,-u,-e),To(t.vertices[2],Ao,s),ko(Ao,h,-u,-e),To(t.vertices[3],Ao,s),ko(Ao,h,u,-r),To(t.vertices[4],Ao,s),ko(Ao,-h,u,-r),To(t.vertices[5],Ao,s),ko(Ao,-h,-u,-r),To(t.vertices[6],Ao,s),ko(Ao,h,-u,-r),To(t.vertices[7],Ao,s),t.updatePlanes()},i.createOrtho=function(t,n,e,r,s,h){return i.createOrthographic(t,n,e,r,s,h)},i.createPerspective=function(t,i,n,e,r,s){var h=Math.tan(.5*n),u=h*i;yo.set(e*u,e*h,e),bo.set(r*u,r*h,r);var o=t.vertices;Ao.set(yo.x,yo.y,-yo.z),To(o[0],Ao,s),Ao.set(-yo.x,yo.y,-yo.z),To(o[1],Ao,s),Ao.set(-yo.x,-yo.y,-yo.z),To(o[2],Ao,s),Ao.set(yo.x,-yo.y,-yo.z),To(o[3],Ao,s),Ao.set(bo.x,bo.y,-bo.z),To(o[4],Ao,s),Ao.set(-bo.x,bo.y,-bo.z),To(o[5],Ao,s),Ao.set(-bo.x,-bo.y,-bo.z),To(o[6],Ao,s),Ao.set(bo.x,-bo.y,-bo.z),To(o[7],Ao,s),t.updatePlanes()},i.createFromAABB=function(t,i){var n=new ir,e=new ir;ir.subtract(n,i.center,i.halfExtents),ir.add(e,i.center,i.halfExtents);var r=t.vertices;return r[0].set(e.x,e.y,-n.z),r[1].set(n.x,e.y,-n.z),r[2].set(n.x,n.y,-n.z),r[3].set(e.x,n.y,-n.z),r[4].set(e.x,e.y,-e.z),r[5].set(n.x,e.y,-e.z),r[6].set(n.x,n.y,-e.z),r[7].set(e.x,n.y,-e.z),t.updatePlanes(),t};var t=i.prototype;function i(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=128,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=nu.create(0,0,0,0);this.vertices=new Array(8);for(var i=0;i<8;++i)this.vertices[i]=new ir}return t.split=function(t,n,e,r,s){return i.createPerspective(this,e,r,t,n,s)},i.create=function(){return new i},i.clone=function(t){return i.copy(new i,t)},i.copy=function(t,i){t._type=i.type;for(var n=0;n<6;++n)nu.copy(t.planes[n],i.planes[n]);for(var e=0;e<8;++e)ir.copy(t.vertices[e],i.vertices[e]);return t},t.update=function(t,i){var n=this.planes;ko(n[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),n[0].d=-(t.m15+t.m12),ko(n[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),n[1].d=-(t.m15-t.m12),ko(n[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),n[2].d=-(t.m15+t.m13),ko(n[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),n[3].d=-(t.m15-t.m13),ko(n[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),n[4].d=-(t.m15+t.m14),ko(n[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),n[5].d=-(t.m15-t.m14);for(var e=0;e<6;e++){var r=n[e],s=1/r.n.length();ir.multiplyScalar(r.n,r.n,s),r.d*=s}for(var h=0;h<8;h++)To(this.vertices[h],mo[h],i)},t.transform=function(t){for(var i=0;i<8;i++)To(this.vertices[i],this.vertices[i],t);this.updatePlanes()},t.zero=function(){for(var t=0;t<8;t++)this.vertices[t].set(0,0,0);for(var i=0;i<6;i++)nu.set(this.planes[i],0,0,0,0)},t.updatePlanes=function(){var t=this.planes,i=this.vertices;Eo(t[0],i[1],i[6],i[5]),Eo(t[1],i[3],i[4],i[7]),Eo(t[2],i[6],i[3],i[7]),Eo(t[3],i[0],i[5],i[4]),Eo(t[4],i[2],i[0],i[3]),Eo(t[5],i[7],i[5],i[6])},e(i,[{key:"accurate",set:function(t){this._type=t?256:128}},{key:"type",get:function(){return this._type}}]),i}(),Oo=new ir,Ro=new ir,Io=new _r,Mo=Math.abs,No=function(t,i,n){Io.m00=Mo(n.m00),Io.m01=Mo(n.m01),Io.m02=Mo(n.m02),Io.m03=Mo(n.m03),Io.m04=Mo(n.m04),Io.m05=Mo(n.m05),Io.m06=Mo(n.m06),Io.m07=Mo(n.m07),Io.m08=Mo(n.m08),ir.transformMat3(t,i,Io)},Co=function(){function t(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r=1),void 0===s&&(s=1),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===c&&(c=1),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=16,this.center=new ir(t,i,n),this.halfExtents=new ir(e,r,s),this.orientation=new _r(h,u,o,a,c,f,v,l,d)}t.create=function(i,n,e,r,s,h,u,o,a,c,f,v,l,d,g){return new t(i,n,e,r,s,h,u,o,a,c,f,v,l,d,g)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.halfExtents.x,i.halfExtents.y,i.halfExtents.z,i.orientation.m00,i.orientation.m01,i.orientation.m02,i.orientation.m03,i.orientation.m04,i.orientation.m05,i.orientation.m06,i.orientation.m07,i.orientation.m08)},t.copy=function(t,i){return ir.copy(t.center,i.center),ir.copy(t.halfExtents,i.halfExtents),_r.copy(t.orientation,i.orientation),t},t.fromPoints=function(t,i,n){return ir.multiplyScalar(t.center,ir.add(Oo,i,n),.5),ir.multiplyScalar(t.halfExtents,ir.subtract(Ro,n,i),.5),_r.identity(t.orientation),t},t.set=function(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g){return ir.set(t.center,i,n,e),ir.set(t.halfExtents,r,s,h),_r.set(t.orientation,u,o,a,c,f,v,l,d,g),t};var i=t.prototype;return i.getBoundary=function(t,i){No(Oo,this.halfExtents,this.orientation),ir.subtract(t,this.center,Oo),ir.add(i,this.center,Oo)},i.transform=function(t,i,n,e,r){ir.transformMat4(r.center,this.center,t),_r.fromQuat(r.orientation,n),ir.multiply(r.halfExtents,this.halfExtents,e)},i.translateAndRotate=function(t,i,n){ir.transformMat4(n.center,this.center,t),_r.fromQuat(n.orientation,i)},i.setScale=function(t,i){ir.multiply(i.halfExtents,this.halfExtents,t)},e(t,[{key:"type",get:function(){return this._type}}]),t}();function Lo(t,i,n){void 0===n&&(n=1e-6);for(var e=0,r=t.length-1,s=r>>>1;e<=r;s=e+r>>>1){var h=t[s];if(h>i+n)r=s-1;else{if(!(h<i-n))return s;e=s+1}}return~e}po=Symbol.iterator;var Fo=function(){function t(){this._times=[],this._values=[]}var i=t.prototype;return i[po]=function(){var t=this,i=0;return{next:function(){if(i>=t._times.length)return{done:!0,value:void 0};var n=[t._times[i],t._values[i]];return++i,{done:!1,value:n}}}},i.keyframes=function(){return this},i.times=function(){return this._times},i.values=function(){return this._values},i.getKeyframeTime=function(t){return this._times[t]},i.getKeyframeValue=function(t){return this._values[t]},i.addKeyFrame=function(t,i){return this.xt(t,i)},i.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},i.indexOfKeyframe=function(t){return Lo(this._times,t)},i.updateTime=function(t,i){var n=this._values[t];this.removeKeyframe(t),this.xt(i,n)},i.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},i.clear=function(){this._times.length=0,this._values.length=0},i.searchKeyframe=function(t){return Lo(this._times,t)},i.setKeyframes=function(t,i){t.length,i.length,Po(t),this._times=t,this._values=i},i.xt=function(t,i){var n=this._times,e=this._values,r=n.length,s=Lo(n,t);if(s>=0)return s;var h=~s;return 0===h?(n.unshift(t),e.unshift(i)):h===r?(n.push(t),e.push(i)):(n.splice(h-1,0,t),e.splice(h-1,0,i)),h},e(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}();function Po(t){return t.every((function(t,i,n){return 0===i||t>n[i-1]||Zn(t,n[i-1],1e-6)}))}function Bo(t,i,n,e,r){var s=n/e,h=i/e,u=s*s,o=1/3*(-1/3*u+h),a=.5*(2/27*s*u-1/3*s*h+t/e),c=o*o*o,f=a*a+c,v=0;if(Uo(f)){if(Uo(a))return r[0]=0,1;var l=Math.cbrt(-a);return r[0]=2*l,r[1]=-l,2}if(f<0){var d=1/3*Math.acos(-a/Math.sqrt(-c)),g=2*Math.sqrt(-o);r[0]=g*Math.cos(d),r[1]=-g*Math.cos(d+Math.PI/3),r[2]=-g*Math.cos(d-Math.PI/3),v=3}else{var w=Math.sqrt(f),_=Math.cbrt(w-a),m=-Math.cbrt(w+a);r[0]=_+m,v=1}for(var p=1/3*s,y=0;y<v;++y)r[y]-=p;return v}Un.fastDefine("cc.KeyframeCurve",Fo,{_times:[],_values:[]}),t("RealInterpolationMode",{LINEAR:0,CONSTANT:1,CUBIC:2}),t("ExtrapolationMode",{LINEAR:0,CLAMP:1,LOOP:2,PING_PONG:3}),t("TangentWeightMode",{NONE:0,LEFT:1,RIGHT:2,BOTH:3});var Do=1e-9;function Uo(t){return t>-1e-9&&t<Do}function xo(t,i,n,e){return n.slice().reverse().reduce((function(n,e){return e(t,i,n)||n}),e)}var Go=function(){},jo=function(){return Go},Ho=Vo((function(){}));function Vo(t){return function(i){return"function"==typeof i?t(i):function(n){return t(n,i)}}}function $o(t,i,n){var e=Xo(t);if(e){var r=Yo(e,"proto");Yo(r,"editor")[i]=n}}function Wo(t){return function(i){return function(n){$o(n,t,i)}}}var zo="__ccclassCache__";function Xo(t){return Yo(t,zo)}function Yo(t,i){return t[i]||(t[i]={})}var Ko=Vo((function(t,i){var n=ti(t);n===Object&&(n=null);var e={name:i,extends:n,ctor:t},r=t[zo];if(r){var s=r.proto;s&&Zt(e,s),t[zo]=void 0}return Un(e)})),qo=Wo("requireComponent"),Qo=Wo("executionOrder"),Zo=Ho;function Jo(t,i,n){var e=null;function r(t,i,n){sa(na(t),ea(t,i),t.constructor,i,e,n)}return void 0===t?Jo({type:void 0}):void 0===i?(e=t,r):void r(t,i,n)}function ta(t){var i;try{i=t()}catch(i){return t}return"object"!=typeof i||null===i?i:t}function ia(t){var i;try{i=new t}catch(t){return{}}return i}function na(t){return Xo(t.constructor)}function ea(t,i){var n,e,r=Yo(Xo(t.constructor),"proto"),s=Yo(r,"properties");return null!==(e=s[n=i])&&void 0!==e?e:s[n]={}}function ra(t,i,n){var e,r,s=Xo(t.constructor),h=Yo(s,"proto"),u=Yo(h,"properties"),o=null!==(r=u[e=i])&&void 0!==r?r:u[e]={};return o.__internalFlags|=1,n&&"function"!=typeof n&&(n.get||n.set)?(n.get&&(o.get=n.get),n.set&&(o.set=n.set)):ha(s,o,t.constructor,i,n),o}function sa(t,i,n,e,r,s){var h,u=s&&"function"!=typeof s&&(s.get||s.set);r&&(h=yn(r,u));var o=Zt(i,h||r||{});u?(s.get&&(o.get=s.get),s.set&&(o.set=s.set)):ha(t,o,n,e,s)}function ha(t,i,n,e,r){if(void 0!==r)"function"==typeof r?i.default=ta(r):null===r||r.initializer&&(i.default=ta(r.initializer));else{var s=t.default||(t.default=ia(n));s.hasOwnProperty(e)&&(i.default=s[e])}}var ua=Symbol("cc:SerializationMetadata"),oa=t("serializable",(function(t,i,n){fa(ra(t,i,n))}));function aa(t){return function(i,n,e){var r=ra(i,n,e);r.formerlySerializedAs=t,fa(r)}}var ca=function(t,i,n){var e=ra(t,i,n);e.editorOnly=!0,fa(e)};function fa(t){t.__internalFlags|=4}var va=Go,la=Ho,da=jo,ga=Ho,wa=jo,_a=jo,ma=jo,pa=t("editable",Go),ya=t("visible",jo),ba=t("displayName",jo),Aa=t("tooltip",jo),Ea=t("range",jo),ka=t("rangeStep",jo),Ta=t("slide",Go),Sa=t("displayOrder",jo),Oa=t("disallowAnimation",Go),Ra=Ca(cn),Ia=Ca(fn),Ma=Ca(vn),Na=Ca(ln);function Ca(t){return Jo({type:t})}var La,Fa,Pa,Ba,Da,Ua,xa,Ga,ja=t("override",(function(t,i,n){ra(t,i,n).override=!0})),Ha=t("EditorExtendable",(function(){})),Va=Object.freeze({__proto__:null,boolean:Ma,ccclass:Ko,disallowAnimation:Oa,disallowMultiple:Zo,displayName:ba,displayOrder:Sa,editable:pa,executeInEditMode:la,executionOrder:Qo,float:Ia,formerlySerializedAs:aa,help:ma,icon:_a,inspector:wa,integer:Ra,menu:da,override:ja,playOnFocus:ga,property:Jo,range:Ea,rangeStep:ka,requireComponent:qo,serializable:oa,slide:Ta,string:Na,tooltip:Aa,type:Ca,uniquelyReferenced:va,visible:ya});function $a(t,i){return(i<<3)+t}function Wa(t){return Xa[t]}function za(t){switch(t){case 0:return Uint8Array;case 1:return Uint16Array;case 2:return Uint32Array;case 3:return Int8Array;case 4:return Int16Array;case 5:return Int32Array;case 6:return Float32Array;case 7:return Float64Array}}t("_decorator",Va),t("CompactValueTypeArray",Ko("cc.CompactValueTypeArray")((xa=function(){function t(){this._byteOffset=Pa&&Pa(),this._unitCount=Ba&&Ba(),this._unitElement=Da&&Da(),this._length=Ua&&Ua()}return t.lengthFor=function(t,i,n){return Wa(i).requiredUnits*t.length*za(n).BYTES_PER_ELEMENT},t.compress=function(i,n,e,r,s,h){for(var u=Wa(n),o=za(e),a=u.requiredUnits*i.length,c=new o(r,s,a),f=0;f<i.length;++f)u.compress(c,f,i[f]);var v=new t;return v._unitElement=$a(e,n),v._byteOffset=h,v._unitCount=a,v._length=i.length,v},t.prototype.decompress=function(t){for(var i,n={storageUnit:7&(i=this._unitElement),elementType:i>>3},e=n.storageUnit,r=Wa(n.elementType),s=new(za(e))(t,this._byteOffset,this._unitCount),h=new Array(this._length),u=0;u<this._length;++u)h[u]=r.decompress(s,u);return h},t}(),xa.StorageUnit={Uint8:0,Uint16:1,Uint32:2,Int8:3,Int16:4,Int32:5,Float32:6,Float64:7},xa.ElementType={Scalar:0,Vec2:1,Vec3:2,Vec4:3,Quat:4,Mat4:5},Pa=xo((Fa=xa).prototype,"_byteOffset",[oa],(function(){return 0})),Ba=xo(Fa.prototype,"_unitCount",[oa],(function(){return 0})),Da=xo(Fa.prototype,"_unitElement",[oa],(function(){return $a(0,0)})),Ua=xo(Fa.prototype,"_length",[oa],(function(){return 0})),La=Fa))||La);var Xa=((Ga={})[0]={requiredUnits:1,compress:function(t,i,n){t[i]=n},decompress:function(t,i){return t[i]}},Ga[1]={requiredUnits:2,compress:function(t,i,n){t[2*i]=n.x,t[2*i+1]=n.y},decompress:function(t,i){return new ir(t[2*i],t[2*i+1])}},Ga[2]={requiredUnits:3,compress:function(t,i,n){t[3*i]=n.x,t[3*i+1]=n.y,t[3*i+2]=n.z},decompress:function(t,i){return new ir(t[3*i],t[3*i+1],t[3*i+2])}},Ga[3]={requiredUnits:4,compress:function(t,i,n){t[4*i]=n.x,t[4*i+1]=n.y,t[4*i+2]=n.z,t[4*i+3]=n.w},decompress:function(t,i){return new De(t[4*i],t[4*i+1],t[4*i+2],t[4*i+3])}},Ga[4]={requiredUnits:4,compress:function(t,i,n){t[4*i]=n.x,t[4*i+1]=n.y,t[4*i+2]=n.z,t[4*i+3]=n.w},decompress:function(t,i){return new Cr(t[4*i],t[4*i+1],t[4*i+2],t[4*i+3])}},Ga[5]={requiredUnits:16,compress:function(t,i,n){Kr.toArray(t,n,16*i)},decompress:function(t,i){return Kr.fromArray(new Kr,t,16*i)}},Ga),Ya=t("serializeTag",Symbol("[[Serialize]]")),Ka=t("deserializeTag",Symbol("[[Deserialize]]"));function qa(){return 0}function Qa(t){return t}function Za(t){return t*t}function Ja(t){return t*(2-t)}function tc(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function ic(t){return t*t*t}function nc(t){return--t*t*t+1}function ec(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function rc(t){return t*t*t*t}function sc(t){return 1- --t*t*t*t}function hc(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function uc(t){return t*t*t*t*t}function oc(t){return--t*t*t*t*t+1}function ac(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function cc(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function fc(t){return Math.sin(t*Math.PI/2)}function vc(t){return.5*(1-Math.cos(Math.PI*t))}function lc(t){return 0===t?0:Math.pow(1024,t-1)}function dc(t){return 1===t?1:1-Math.pow(2,-10*t)}function gc(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function wc(t){return 1-Math.sqrt(1-t*t)}function _c(t){return Math.sqrt(1- --t*t)}function mc(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function pc(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4))}function yc(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-i)*Math.PI/.4)+1)}function bc(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4)*.5+1)}function Ac(t){if(1===t)return 1;var i=1.70158;return t*t*((i+1)*t-i)}function Ec(t){if(0===t)return 0;var i=1.70158;return--t*t*((i+1)*t+i)+1}function kc(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)}function Tc(t){return 1-Sc(1-t)}function Sc(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Oc(t){return t<.5?.5*Tc(2*t):.5*Sc(2*t-1)+.5}function Rc(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function Ic(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}T._decorator=Va;var Mc=Gc(Za,Ja),Nc=Gc(ic,nc),Cc=Gc(rc,sc),Lc=Gc(uc,oc),Fc=Gc(cc,fc),Pc=Gc(lc,dc),Bc=Gc(wc,_c),Dc=Gc(pc,yc),Uc=Gc(Ac,Ec),xc=Gc(Tc,Sc);function Gc(t,i){return function(n){return n<.5?i(2*n)/2:t(2*n-1)/2+.5}}var jc,Hc=Object.freeze({__proto__:null,backIn:Ac,backInOut:kc,backOut:Ec,backOutIn:Uc,bounceIn:Tc,bounceInOut:Oc,bounceOut:Sc,bounceOutIn:xc,circIn:wc,circInOut:mc,circOut:_c,circOutIn:Bc,constant:qa,cubicIn:ic,cubicInOut:ec,cubicOut:nc,cubicOutIn:Nc,elasticIn:pc,elasticInOut:bc,elasticOut:yc,elasticOutIn:Dc,expoIn:lc,expoInOut:gc,expoOut:dc,expoOutIn:Pc,fade:Ic,linear:Qa,quadIn:Za,quadInOut:tc,quadOut:Ja,quadOutIn:Mc,quartIn:rc,quartInOut:hc,quartOut:sc,quartOutIn:Cc,quintIn:uc,quintInOut:ac,quintOut:oc,quintOutIn:Lc,sineIn:cc,sineInOut:vc,sineOut:fc,sineOutIn:Fc,smooth:Rc});t("easing",Hc),t("EasingMethod",{LINEAR:0,CONSTANT:1,QUAD_IN:2,QUAD_OUT:3,QUAD_IN_OUT:4,QUAD_OUT_IN:5,CUBIC_IN:6,CUBIC_OUT:7,CUBIC_IN_OUT:8,CUBIC_OUT_IN:9,QUART_IN:10,QUART_OUT:11,QUART_IN_OUT:12,QUART_OUT_IN:13,QUINT_IN:14,QUINT_OUT:15,QUINT_IN_OUT:16,QUINT_OUT_IN:17,SINE_IN:18,SINE_OUT:19,SINE_IN_OUT:20,SINE_OUT_IN:21,EXPO_IN:22,EXPO_OUT:23,EXPO_IN_OUT:24,EXPO_OUT_IN:25,CIRC_IN:26,CIRC_OUT:27,CIRC_IN_OUT:28,CIRC_OUT_IN:29,ELASTIC_IN:30,ELASTIC_OUT:31,ELASTIC_IN_OUT:32,ELASTIC_OUT_IN:33,BACK_IN:34,BACK_OUT:35,BACK_IN_OUT:36,BACK_OUT_IN:37,BOUNCE_IN:38,BOUNCE_OUT:39,BOUNCE_IN_OUT:40,BOUNCE_OUT_IN:41,SMOOTH:42,FADE:43});var Vc,$c=((jc={})[1]=qa,jc[0]=Qa,jc[2]=Za,jc[3]=Ja,jc[4]=tc,jc[5]=Mc,jc[6]=ic,jc[7]=nc,jc[8]=ec,jc[9]=Nc,jc[10]=rc,jc[11]=sc,jc[12]=hc,jc[13]=Cc,jc[14]=uc,jc[15]=oc,jc[16]=ac,jc[17]=Lc,jc[18]=cc,jc[19]=fc,jc[20]=vc,jc[21]=Fc,jc[22]=lc,jc[23]=dc,jc[24]=gc,jc[25]=Pc,jc[26]=wc,jc[27]=_c,jc[28]=mc,jc[29]=Bc,jc[30]=pc,jc[31]=yc,jc[32]=bc,jc[33]=Dc,jc[34]=Ac,jc[35]=Ec,jc[36]=kc,jc[37]=Uc,jc[38]=Tc,jc[39]=Sc,jc[40]=Oc,jc[41]=xc,jc[42]=Rc,jc[43]=Ic,jc);function Wc(t){return $c[t]}C(255),C(65280);var zc,Xc,Yc,Kc=function(t){function i(){var i;return(i=t.call(this)||this).value=0,i.rightTangent=0,i.rightTangentWeight=0,i.leftTangent=0,i.leftTangentWeight=0,i.Gt=0,i}return s(i,t),e(i,[{key:"interpolationMode",get:function(){return 255&this.Gt},set:function(t){this.Gt&=-256,this.Gt|=0|t}},{key:"tangentWeightMode",get:function(){return(65280&this.Gt)>>8},set:function(t){this.Gt&=-65281,this.Gt|=t<<8}},{key:"easingMethod",get:function(){return(16711680&this.Gt)>>16},set:function(t){this.Gt&=-16711681,this.Gt|=t<<16}}]),i}(Ha);function qc(t){var i=new Kc;if("number"==typeof t)i.value=t;else{var n=t.interpolationMode,e=t.tangentWeightMode,r=t.value,s=t.rightTangent,h=t.rightTangentWeight,u=t.leftTangent,o=t.leftTangentWeight,a=t.easingMethod,c=t[cu];i.value=null!=r?r:i.value,i.rightTangent=null!=s?s:i.rightTangent,i.rightTangentWeight=null!=h?h:i.rightTangentWeight,i.leftTangent=null!=u?u:i.leftTangent,i.leftTangentWeight=null!=o?o:i.leftTangentWeight,i.interpolationMode=null!=n?n:i.interpolationMode,i.tangentWeightMode=null!=e?e:i.tangentWeightMode,i.easingMethod=null!=a?a:i.easingMethod,c&&(i[cu]=c)}return i}Un.fastDefine("cc.RealKeyframeValue",Kc,((Vc={interpolationMode:0,tangentWeightMode:0,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:0})[cu]=void 0,Vc)),Un.Attr.setClassAttr(Kc,cu,"editorOnly",!0),(zc=Kc,null!==(Yc=(Xc=zc)[ua])&&void 0!==Yc?Yc:Xc[ua]={}).uniquelyReferenced=!0;var Qc=t("RealCurve",function(t){function i(){var i;return(i=t.call(this)||this).preExtrapolation=1,i.postExtrapolation=1,i}s(i,t);var n=i.prototype;return n.evaluate=function(t){var i=this._times,n=this._values,e=i.length;if(0===e)return 0;var r=i[0],s=i[e-1];if(t<r){var h=this.preExtrapolation,u=n[0];if(1===h||e<2)return u.value;switch(h){case 0:return kf(r,n[0].value,i[1],n[1].value,t);case 2:t=Af(t,r,s);break;case 3:t=Ef(t,r,s);break;default:return u.value}}else if(t>s){var o=this.postExtrapolation,a=n[e-1];if(1===o||e<2)return a.value;switch(o){case 0:return kf(s,a.value,i[e-2],n[e-2].value,t);case 2:t=Af(t,r,s);break;case 3:t=Ef(t,r,s);break;default:return a.value}}var c=Lo(i,t);if(c>=0)return n[c].value;var f=~c,v=f-1,l=i[v],d=n[v],g=i[f];return Tf(l,d,g,n[f],(t-l)/(g-l))},n.addKeyFrame=function(i,n){return t.prototype.addKeyFrame.call(this,i,qc(n))},n.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.map((function(t){return qc(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return qc(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var i=this._values[0].value;return this._values.every((function(n){return Zn(n.value,i,t)}))},n[Ya]=function(t,i){if(i.toCCON){var n=this._times,e=this._values,r=n.length,s=new DataView(new ArrayBuffer(0+tf+tf+nf+ef*r+pf*r)),h=0;s.setUint8(h,this.preExtrapolation),h+=tf,s.setUint8(h,this.postExtrapolation),h+=tf,s.setUint32(h,r,!0),h+=nf,n.forEach((function(t,i){return s.setFloat32(h+ef*i,t,!0)})),h+=ef*r;for(var u,o=d(e);!(u=o()).done;){var a=u.value;h=yf(s,a,h)}var c=new Uint8Array(s.buffer,0,h);t.writeProperty("bytes",c);var f=e.map((function(t){return t[cu]}));f.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",f)}else t.writeThis()},n[Ka]=function(t,i){if(i.fromCCON){var n=t.readProperty("bytes"),e=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;this.preExtrapolation=e.getUint8(r),r+=tf,this.postExtrapolation=e.getUint8(r),r+=tf;var s=e.getUint32(r,!0);r+=nf;var h=Array.from({length:s},(function(t,i){return e.getFloat32(r+ef*i,!0)}));r+=ef*s;for(var u=new Array(s),o=0;o<s;++o){var a=qc({});r=bf(e,a,r),u[o]=a}n.byteLength;var c=t.readProperty("keyframeValueEditorExtras");c&&(c.length,c.forEach((function(t,i){return u[i][cu]=t}))),this._times=h,this._values=u}else t.readThis()},i}(Fo));Un.fastDefine("cc.RealCurve",Qc,{_times:[],_values:[],preExtrapolation:1,postExtrapolation:1});var Zc=8,Jc=255<<Zc,tf=1,nf=4,ef=4,rf=4,sf=4,hf=1,uf=1,of=4,af=4,cf=4,ff=4,vf=qc({}),lf=vf.interpolationMode,df=vf.tangentWeightMode,gf=vf.leftTangent,wf=vf.leftTangentWeight,_f=vf.rightTangent,mf=vf.rightTangentWeight,pf=rf+sf+hf+uf+of+af+cf+ff+0;function yf(t,i,n){var e=0,r=n,s=r;r+=rf;var h=i.value,u=i.interpolationMode,o=i.tangentWeightMode,a=i.rightTangent,c=i.rightTangentWeight,f=i.leftTangent,v=i.leftTangentWeight,l=i.easingMethod;return t.setFloat32(r,h,!0),r+=sf,u!==lf&&(e|=2,t.setUint8(r,u),r+=hf),o!==df&&(e|=4,t.setUint8(r,o),r+=uf),f!==gf&&(e|=8,t.setFloat32(r,f,!0),r+=of),v!==wf&&(e|=16,t.setFloat32(r,v,!0),r+=af),a!==_f&&(e|=32,t.setFloat32(r,a,!0),r+=cf),c!==mf&&(e|=64,t.setFloat32(r,c,!0),r+=ff),e|=l<<Zc,t.setUint32(s,e,!0),r}function bf(t,i,n){var e=n,r=t.getUint32(e,!0);e+=rf,i.value=t.getFloat32(e,!0),e+=sf,2&r&&(i.interpolationMode=t.getUint8(e),e+=hf),4&r&&(i.tangentWeightMode=t.getUint8(e),e+=uf),8&r&&(i.leftTangent=t.getFloat32(e,!0),e+=of),16&r&&(i.leftTangentWeight=t.getFloat32(e,!0),e+=af),32&r&&(i.rightTangent=t.getFloat32(e,!0),e+=cf),64&r&&(i.rightTangentWeight=t.getFloat32(e,!0),e+=ff);var s=(r&Jc)>>Zc;return i.easingMethod=s,e}function Af(t,i,n){return i+ve(t-i,n-i)}function Ef(t,i,n){return i+le(t-i,n-i)}function kf(t,i,n,e,r){return i+(e-i)/(n-t)*(r-t)}function Tf(t,i,n,e,r){var s=n-t;switch(i.interpolationMode){default:case 1:return i.value;case 0:var h=0===i.easingMethod?r:Wc(i.easingMethod)(r);return ie(i.value,e.value,h);case 2:var u=1/3,o=i.rightTangent,a=i.rightTangentWeight,c=!!(2&i.tangentWeightMode),f=e.leftTangent,v=e.leftTangentWeight,l=!!(1&e.tangentWeightMode);if(c||l){var d=0;if(c)d=a;else{var g=s,w=s*o;d=Math.sqrt(g*g+w*w)*u}var _=Math.atan(o),m=Math.cos(_)*d+t,p=Math.sin(_)*d+i.value,y=0;if(l)y=v;else{var b=s,A=s*f;y=Math.sqrt(b*b+A*A)*u}var E=Math.atan(f),k=(m-t)/s,T=(-Math.cos(E)*y+n-t)/s,S=p,O=-Math.sin(E)*y+e.value,R=[0,0,0],I=Of(R,Bo(0-r,3*k,3*T-6*k,3*(k-T)+1,R),r);return Sf(i.value,S,O,e.value,I)}var M=i.value+u*o*s,N=e.value-u*f*s;return Sf(i.value,M,N,e.value,r)}}function Sf(t,i,n,e,r){var s=1-r;return s*s*s*t+3*s*s*r*i+3*s*r*r*n+r*r*r*e}function Of(t,i,n){var e=n;if(1===i)e=t[0];else{e=-1/0;for(var r=0;r<i;++r){var s=t[r];s>=0&&s<=1&&s>e&&(e=s)}e===-1/0&&(e=0)}return e}function Rf(t,i,n,e,r){var s=1-r;return s*(s*(t+(3*i-t)*r)+3*n*r*r)+e*r*r*r}T.bezier=Rf;var If,Mf,Nf,Cf,Lf,Ff,Pf,Bf,Df,Uf=Math.cos,xf=Math.acos,Gf=Math.max,jf=2*Math.PI,Hf=Math.sqrt;function Vf(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function $f(t,i){var n,e,r,s,h=i-0,u=i-t[0],o=3*h,a=3*u,c=3*(i-t[2]),f=1/(-h+a-c+(i-1)),v=1/3,l=(o-6*u+c)*f,d=l*v,g=(-o+a)*f,w=(3*g-l*l)*v,_=w*v,m=(2*l*l*l-9*l*g+h*f*27)/27,p=m/2,y=p*p+_*_*_;if(y<0){var b=-w*v,A=Hf(b*b*b),E=-m/(2*A),k=xf(E<-1?-1:E>1?1:E),T=2*Vf(A);return e=T*Uf(k*v)-d,r=T*Uf((k+jf)*v)-d,s=T*Uf((k+2*jf)*v)-d,e>=0&&e<=1?r>=0&&r<=1?s>=0&&s<=1?Gf(e,r,s):Gf(e,r):s>=0&&s<=1?Gf(e,s):e:r>=0&&r<=1?s>=0&&s<=1?Gf(r,s):r:s}if(0===y)return r=-(n=p<0?Vf(-p):-Vf(p))-d,(e=2*n-d)>=0&&e<=1?r>=0&&r<=1?Gf(e,r):e:r;var S=Hf(y);return(n=Vf(-p+S))-Vf(p+S)-d}function Wf(t,i){var n=$f(t,i),e=t[1];return((1-n)*(e+(t[3]-e)*n)*3+n*n)*n}T.bezierByTime=Wf,t("QuatInterpolationMode",{SLERP:0,CONSTANT:1});var zf=Ko("cc.QuatKeyframeValue")(If=va((Mf=function(t){var i=void 0===t?{}:t,n=i.value,e=i.interpolationMode,r=i.easingMethod;this.interpolationMode=Nf&&Nf(),this.value=Cf&&Cf(),this.easingMethod=Lf&&Lf(),this.value=n?Cr.clone(n):this.value,this.interpolationMode=null!=e?e:this.interpolationMode,this.easingMethod=null!=r?r:this.easingMethod},Nf=xo(Mf.prototype,"interpolationMode",[oa],(function(){return 0})),Cf=xo(Mf.prototype,"value",[oa],(function(){return Cr.clone(Cr.IDENTITY)})),Lf=xo(Mf.prototype,"easingMethod",[oa],(function(){return 0})),If=Mf))||If)||If;function Xf(t){return new zf(t)}var Yf,Kf=t("QuatCurve",Ko("cc.QuatCurve")((Pf=function(t){function i(){var i;return(i=t.call(this)||this).preExtrapolation=Bf&&Bf(),i.postExtrapolation=Df&&Df(),i}s(i,t);var n=i.prototype;return n.evaluate=function(t,i){var n;null!==(n=i)&&void 0!==n||(i=new Cr);var e=this._times,r=this._values,s=this.postExtrapolation,h=this.preExtrapolation,u=e.length;if(0===u)return i;var o=e[0],a=e[u-1];if(t<o){var c=r[0];switch(h){case 2:t=o+ve(t-o,a-o);break;case 3:t=o+le(t-o,a-o);break;default:return Cr.copy(i,c.value)}}else if(t>a){var f=r[u-1];switch(s){case 2:t=o+ve(t-o,a-o);break;case 3:t=o+le(t-o,a-o);break;default:return Cr.copy(i,f.value)}}var v=Lo(e,t);if(v>=0)return Cr.copy(i,r[v].value);var l=~v,d=l-1,g=e[d],w=r[d],_=e[l],m=r[l],p=(t-g)/(_-g);switch(w.interpolationMode){default:case 1:return Cr.copy(i,w.value);case 0:var y=w.easingMethod,b=0===y?p:Array.isArray(y)?Wf(y,p):Wc(y)(p);return Cr.slerp(i,w.value,m.value,b)}},n.addKeyFrame=function(i,n){var e=new zf(n);return t.prototype.addKeyFrame.call(this,i,e)},n.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.map((function(t){return Xf(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return Xf(t[1])})))}},n[Ya]=function(t,i){if(i.toCCON){var n=this._times,e=this._values,r=!0;e.forEach((function(t,i,n){var e=n[0];r&&t.interpolationMode!==e.interpolationMode&&(r=!1)}));var s=n.length,h=tv*(r?1:s),u=e.reduce((function(t,i){var n=i.easingMethod;return t+(Array.isArray(n)?iv+4*ev:iv)}),0),o=0,a=new DataView(new ArrayBuffer(o+=qf+Qf+Zf*s+4*Jf*s+u+h+0)),c=0,f=0;r&&(f|=1),a.setUint32(c,f,!0),c+=qf,a.setUint32(c,s,!0),c+=Qf,n.forEach((function(t,i){return a.setFloat32(c+Zf*i,t,!0)})),c+=Zf*s,e.forEach((function(t,i){var n=t.value,e=n.x,r=n.y,s=n.z,h=n.w,u=c+4*Jf*i;a.setFloat32(u+0*Jf,e,!0),a.setFloat32(u+1*Jf,r,!0),a.setFloat32(u+2*Jf,s,!0),a.setFloat32(u+3*Jf,h,!0)})),c+=4*Jf*s,e.forEach((function(t){var i=t.easingMethod;Array.isArray(i)?(a.setUint8(c,nv),++c,a.setFloat32(c+0*ev,i[0],!0),a.setFloat32(c+1*ev,i[1],!0),a.setFloat32(c+2*ev,i[2],!0),a.setFloat32(c+3*ev,i[3],!0),c+=4*ev):(a.setUint8(c,i),++c)}));var v=c;c+=h;var l=v;e.forEach((function(t){var i=t.interpolationMode;a.setUint8(l,i),r||(l+=tv)}));var d=new Uint8Array(a.buffer);t.writeProperty("bytes",d)}else t.writeThis()},n[Ka]=function(t,i){if(i.fromCCON){var n=t.readProperty("bytes"),e=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0,s=e.getUint32(r,!0);r+=qf;var h=1&s,u=e.getUint32(r,!0);r+=Qf;var o=Array.from({length:u},(function(t,i){return e.getFloat32(r+Zf*i,!0)})),a=r+=Zf*u;r+=4*Jf*u;var c=Array.from({length:u},(function(t,i){var n=a+4*Jf*i,s=e.getFloat32(n+0*Jf,!0),h=e.getFloat32(n+1*Jf,!0),u=e.getFloat32(n+2*Jf,!0),o=e.getFloat32(n+3*Jf,!0),c=e.getUint8(r);++r;var f=Xf({value:{x:s,y:h,z:u,w:o}});return c!==nv?f.easingMethod=c:(f.easingMethod=[e.getFloat32(r+0*ev,!0),e.getFloat32(r+1*ev,!0),e.getFloat32(r+2*ev,!0),e.getFloat32(r+3*ev,!0)],r+=4*ev),f}));if(h){var f=e.getUint8(r);++r;for(var v=0;v<u;++v)c[v].interpolationMode=f}else{for(var l=0;l<u;++l){var d=e.getUint8(r+l);c[l].interpolationMode=d}r+=u}this._times=o,this._values=c}else t.readThis()},i}(Fo),Bf=xo(Pf.prototype,"preExtrapolation",[oa],(function(){return 1})),Df=xo(Pf.prototype,"postExtrapolation",[oa],(function(){return 1})),Ff=Pf))||Ff),qf=1,Qf=4,Zf=4,Jf=4,tv=1,iv=1,nv=255,ev=4,rv=t("ObjectCurve",Ko("cc.ObjectCurve")(Yf=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.evaluate=function(t){var i=this.searchKeyframe(t);if(i>=0)return this._values[i];var n=Jn(~i-1,0,this._values.length-1);return this._values[n]},i}(Fo))||Yf),sv={Blend:0,Fixed:1};Ni(sv);var hv=t("ColorKey",(function(){this.color=cr.WHITE.clone(),this.time=0}));Un.fastDefine("cc.ColorKey",hv,{color:cr.WHITE.clone(),time:0}),Un.Attr.setClassAttr(hv,"color","visible",!0),Un.Attr.setClassAttr(hv,"time","visible",!0);var uv=t("AlphaKey",(function(){this.alpha=1,this.time=0}));Un.fastDefine("cc.AlphaKey",uv,{alpha:1,time:0}),Un.Attr.setClassAttr(uv,"alpha","visible",!0),Un.Attr.setClassAttr(uv,"time","visible",!0);var ov=t("Gradient",function(){function t(){this.colorKeys=[],this.alphaKeys=[],this.mode=0}var i=t.prototype;return i.setKeys=function(t,i){this.colorKeys=t,this.alphaKeys=i},i.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,i){return t.time-i.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,i){return t.time-i.time}))},i.evaluate=function(t){return this.evaluateFast(new cr,t)},i.evaluateFast=function(t,i){return this.jt(t,i),t.a=this.Ht(i),t},i.randomColor=function(){return this.getRandomColor(new cr)},i.getRandomColor=function(t){var i=this.colorKeys[Math.trunc(re()*this.colorKeys.length)],n=this.alphaKeys[Math.trunc(re()*this.alphaKeys.length)];return t.set(i.color),t.a=n.alpha,t},i.jt=function(t,i){var n=this.colorKeys,e=n.length;if(e>1){i=ve(i,1+qn);for(var r=1;r<e;++r){var s=n[r-1].time,h=n[r].time;if(i>=s&&i<h){if(1===this.mode)return cr.copy(t,n[r].color),t;var u=(i-s)/(h-s);return cr.lerp(t,n[r-1].color,n[r].color,u),t}}var o=e-1;Zn(i,n[o].time,qn)?cr.copy(t,n[o].color):i<n[0].time?cr.lerp(t,cr.BLACK,n[0].color,i/n[0].time):i>n[o].time&&cr.lerp(t,n[o].color,cr.BLACK,(i-n[o].time)/(1-n[o].time))}else 1===e?cr.copy(t,n[0].color):cr.copy(t,cr.WHITE);return t},i.Ht=function(t){var i=this.alphaKeys,n=i.length;if(n>1){t=ve(t,1+qn);for(var e=1;e<n;++e){var r=i[e-1].time,s=i[e].time;if(t>=r&&t<s){if(1===this.mode)return i[e].alpha;var h=(t-r)/(s-r);return ie(i[e-1].alpha,i[e].alpha,h)}}var u=n-1;return Zn(t,i[u].time,qn)?i[u].alpha:t<i[0].time?ie(0,i[0].alpha,t/i[0].time):t>i[u].time?ie(i[u].alpha,0,(t-i[u].time)/(1-i[u].time)):255}return 1===n?i[0].alpha:255},t}());ov.Mode=sv,Un.fastDefine("cc.Gradient",ov,{colorKeys:[],alphaKeys:[],mode:0}),Un.Attr.setClassAttr(ov,"colorKeys","visible",!0),Un.Attr.setClassAttr(ov,"alphaKeys","visible",!0),Un.Attr.setClassAttr(ov,"mode","visible",!0);var av=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};Un.fastDefine("cc.Keyframe",av,{time:0,value:0,inTangent:0,outTangent:0});var cv=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return fv(t-this.time,this.coefficient)},t}();function fv(t,i){return t*(t*(t*i[0]+i[1])+i[2])+i[3]}var vv=function(){function t(t){if(void 0===t&&(t=null),this._curve=void 0,this.Vt=void 0,t instanceof Qc)this._curve=t;else{var i=new Qc;this._curve=i,i.preExtrapolation=2,i.postExtrapolation=1,t?i.assignSorted(t.map((function(t){return[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):i.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]])}this.Vt=new cv}var i=t.prototype;return i.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},i.evaluate_slow=function(t){return this._curve.evaluate(t)},i.evaluate=function(t){var i=this.Vt,n=this._curve,e=n.keyFramesCount-1,r=t,s=t<0?n.preExtrapolation:n.postExtrapolation,h=n.getKeyframeTime(0),u=n.getKeyframeTime(e);switch(s){case 2:r=ve(t-h,u-h)+h;break;case 3:r=le(t-h,u-h)+h;break;default:r=Jn(t,h,u)}if(r>=i.time&&r<i.endTime)return i.evaluate(r);var o=this.$t(i,r),a=Math.min(o+1,e);return this.calcOptimizedKey(i,o,a),i.evaluate(r)},i.calcOptimizedKey=function(t,i,n){var e=this._curve.getKeyframeTime(i),r=this._curve.getKeyframeTime(n),s=this._curve.getKeyframeValue(i),h=s.value,u=s.leftTangent,o=this._curve.getKeyframeValue(n),a=o.value,c=o.rightTangent;t.index=i,t.time=e,t.endTime=r;var f=r-e,v=a-h,l=1/(f*f),d=u*f,g=c*f;t.coefficient[0]=(d+g-v-v)*l/f,t.coefficient[1]=(v+v+v-d-d-g)*l,t.coefficient[2]=u,t.coefficient[3]=h},i.$t=function(t,i){var n=this._curve,e=n.keyFramesCount,r=t.index;if(-1!==r)if(i>n.getKeyframeTime(r))for(var s=0;s<3;s++){var h=r+s;if(h+1<e&&n.getKeyframeTime(h+1)>i)return h}else for(var u=0;u<3;u++){var o=r-u;if(o>=0&&n.getKeyframeTime(o-1)<=i)return o-1}for(var a,c=0,f=e;f-c>1;)a=Math.floor((c+f)/2),n.getKeyframeTime(a)>=i?f=a:c=a;return c},e(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var i=t[0],n=t[1],e=new av;return e.time=i,e.value=n.value,e.inTangent=n.leftTangent,e.outTangent=n.rightTangent,e}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return dv(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=lv(t)}},{key:"postWrapMode",get:function(){return dv(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=lv(t)}}]),t}();function lv(t){switch(t){default:case 0:case 1:case 8:return 1;case 22:return 3;case 2:return 2}}function dv(t){switch(t){default:case 0:case 1:return 8;case 3:return 22;case 2:return 2}}function gv(){var t=new Qc;return t.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]]),t}vv.Wt=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],Un.fastDefine("cc.AnimationCurve",vv,{_curve:null});var wv=ir.multiplyScalar,_v=ir.add,mv=4294967295,pv=nr(),yv=nr(),bv=nr(),Av=nr(),Ev=function(){function t(t,i){void 0===t&&(t=2),void 0===i&&(i=[]),this.M=void 0,this.zt=[],this.M=1024,this.Xt=t;for(var n=0;n<i.length;n++)this.zt[n]=nr(i[n])}t.create=function(i,n){return void 0===n&&(n=[]),new t(i,n)},t.clone=function(i){return new t(i.mode,i.knots)},t.copy=function(t,i){t.Xt=i.mode,t.zt.length=0;for(var n=i.knots,e=n.length,r=0;r<e;r++)t.zt[r]=nr(n[r]);return t};var i=t.prototype;return i.setModeAndKnots=function(t,i){this.Xt=t,this.zt.length=0;for(var n=0;n<i.length;n++)this.zt[n]=nr(i[n])},i.clearKnots=function(){this.zt.length=0},i.getKnotCount=function(){return this.zt.length},i.addKnot=function(t){this.zt.push(nr(t))},i.insertKnot=function(t,i){var n=nr(i);t>=this.zt.length?this.zt.push(n):this.zt.splice(t,0,n)},i.removeKnot=function(t){Ii(this.zt,t),this.zt.splice(t,1)},i.setKnot=function(t,i){Ii(this.zt,t),this.zt[t].set(i)},i.getKnot=function(t){return Ii(this.zt,t),this.zt[t]},i.getPoint=function(i,n){void 0===n&&(n=mv),i=Jn(i,0,1);var e=this.Yt();if(0===e)return nr();if(n===mv){var r=1/e;n=Math.floor(i/r),i=i%r/r}var s=this.zt;if(n>=e)return nr(s[s.length-1]);switch(this.Xt){case 0:return t.Kt(s[n],s[n+1],i);case 1:var h=4*n;return t.qt(s[h],s[h+1],s[h+2],s[h+3],i);case 2:var u=n>0?s[n-1]:s[n],o=n+2<s.length?s[n+2]:s[n+1];return t.Qt(u,s[n],s[n+1],o,i);default:return nr()}},i.getPoints=function(t,i){if(void 0===i&&(i=mv),0===t)return[];if(1===t)return[this.getPoint(0,i)];for(var n=[],e=1/(t-1),r=0;r<t;r++){var s=r*e,h=this.getPoint(s,i);n.push(h)}return n},i.Yt=function(){var t=this.zt.length;switch(this.Xt){case 0:case 2:return t<2?(st(14300),0):t-1;case 1:return t<4||t%4!=0?(st(14301),0):t/4;default:return at(!1,16407),0}},t.Kt=function(t,i,n){var e=new ir;return wv(pv,t,1-n),wv(yv,i,n),_v(e,pv,yv),e},t.qt=function(t,i,n,e,r){var s=new ir,h=1-r;return wv(pv,t,h*h*h),wv(yv,i,3*r*h*h),wv(bv,n,3*r*r*h),wv(Av,e,r*r*r),_v(pv,pv,yv),_v(bv,bv,Av),_v(s,pv,bv),s},t.Qt=function(t,i,n,e,r){var s=new ir,h=r*r,u=h*r;return wv(pv,t,-.5*u+h-.5*r),wv(yv,i,1.5*u-2.5*h+1),wv(bv,n,-1.5*u+2*h+.5*r),wv(Av,e,.5*u-.5*h),_v(pv,pv,yv),_v(bv,bv,Av),_v(s,pv,bv),s},e(t,[{key:"type",get:function(){return this.M}},{key:"mode",get:function(){return this.Xt}},{key:"knots",get:function(){return this.zt}}]),t}();function kv(t,i){X(t+" is deprecated, please use "+i+" instead.")}dt(Qh,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Tv=function(t){function i(){var i;return i=t.call(this)||this,kv("line","Line"),i}return s(i,t),i}(Bs),Sv=function(t){function i(){var i;return i=t.call(this)||this,kv("plane","Plane"),i}return s(i,t),i}(nu),Ov=function(t){function i(){var i;return i=t.call(this)||this,kv("ray","Ray"),i}return s(i,t),i}(Ds),Rv=function(t){function i(){var i;return i=t.call(this)||this,kv("triangle","Triangle"),i}return s(i,t),i}(eu),Iv=function(t){function i(){var i;return i=t.call(this)||this,kv("sphere","Sphere"),i}return s(i,t),i}(Ys),Mv=function(t){function i(){var i;return i=t.call(this)||this,kv("aabb","AABB"),i}return s(i,t),i}(wo),Nv=function(t){function i(){var i;return i=t.call(this)||this,kv("obb","OBB"),i}return s(i,t),i}(Co),Cv=function(t){function i(){var i;return i=t.call(this)||this,kv("capsule","Capsule"),i}return s(i,t),i}(_o),Lv=function(t){function i(){var i;return i=t.call(this)||this,kv("frustum","Frustum"),i}return s(i,t),i}(So),Fv=Object.freeze({__proto__:null,AABB:wo,AnimationCurve:vv,Capsule:_o,ERaycastMode:{ALL:0,CLOSEST:1,ANY:2},Frustum:So,Keyframe:av,Line:Bs,OBB:Co,OptimizedKey:cv,Plane:nu,Ray:Ds,Sphere:Ys,Spline:Ev,SplineMode:{LINEAR:0,BEZIER:1,CATMULL_ROM:2},Triangle:eu,WrapModeMask:{Default:0,Normal:1,Loop:2,ShouldWrap:4,Clamp:8,PingPong:22,Reverse:36},aabb:Mv,capsule:Cv,constructLegacyCurveAndConvert:gv,distance:Ps,enums:{SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512,SHAPE_SPLINE:1024},evalOptCurve:fv,frustum:Lv,intersect:Qh,line:Tv,obb:Nv,plane:Sv,ray:Ov,sphere:Iv,triangle:Rv});t("geometry",Fv),t("SystemPriority",{LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});var Pv=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,i){return t._priority<i._priority?1:t._priority>i.priority?-1:0};var i=t.prototype;return i.init=function(){},i.update=function(){},i.postUpdate=function(){},i.destroy=function(){},e(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}());Pv.Priority=Ni({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});var Bv=new Rt("Scheduler"),Dv=function(){function t(t,i,n,e){this.Zt=void 0,this.Jt=void 0,this.ti=void 0,this.ii=void 0,this.Zt=t,this.Jt=i,this.ti=n,this.ii=e}return t.ni=function(i,n,e,r){var s=t.ei.pop();return s?(s.Zt=i,s.Jt=n,s.ti=e,s.ii=r):s=new t(i,n,e,r),s},t.ri=function(i){t.ei.length<20&&(i.Zt=null,t.ei.push(i))},t}();Dv.ei=[];var Uv=function(){function t(t,i,n,e){this.si=void 0,this.hi=void 0,this.Zt=void 0,this.ui=void 0,this.si=t,this.hi=i,this.Zt=n,this.ui=e}return t.ni=function(i,n,e,r){var s=t.oi.pop();return s?(s.si=i,s.hi=n,s.Zt=e,s.ui=r):s=new t(i,n,e,r),s},t.ri=function(i){t.oi.length<20&&(i.si=i.hi=i.Zt=i.ui=null,t.oi.push(i))},t}();Uv.oi=[];var xv=function(){function t(t,i,n,e,r,s){this.ai=void 0,this.Zt=void 0,this.ci=void 0,this.fi=void 0,this.li=void 0,this.ti=void 0,this.ai=t,this.Zt=i,this.ci=n,this.fi=e,this.li=r,this.ti=s}return t.ni=function(i,n,e,r,s,h){var u=t.di.pop();return u?(u.ai=i,u.Zt=n,u.ci=e,u.fi=r,u.li=s,u.ti=h):u=new t(i,n,e,r,s,h),u},t.ri=function(i){t.di.length<20&&(i.ai=i.Zt=i.fi=null,t.di.push(i))},t}();xv.di=[];var Gv=function(){function t(){this.gi=void 0,this.wi=void 0,this._i=void 0,this.mi=void 0,this.pi=void 0,this.yi=void 0,this.bi=void 0,this.Ai=void 0,this.Ei=void 0,this.ki=void 0,this.Ti=void 0,this.gi=!1,this.wi=null,this._i=-1,this.mi=!1,this.pi=!1,this.yi=0,this.bi=0,this.Ai=0,this.Ei=0,this.ki=null}t.ni=function(){return t.Si.pop()||new t},t.ri=function(i){t.Si.length<20&&!i.gi&&(i.wi=i.ki=i.Ti=null,t.Si.push(i))};var i=t.prototype;return i.Oi=function(t,i,n,e,r,s){return this.gi=!1,this.wi=t,this.ki=n,this.Ti=i,this.yi=0,this._i=-1,this.Ei=e,this.Ai=s,this.pi=this.Ai>0,this.bi=r,this.mi=this.bi===T.macro.REPEAT_FOREVER,!0},i.Ri=function(){return this.Ei},i.Ii=function(t){this.Ei=t},i.Mi=function(t){-1===this._i?(this._i=0,this.yi=0):(this._i+=t,this.mi&&!this.pi?this._i>=this.Ei&&(this.Ni(),this._i=0):(this.pi?this._i>=this.Ai&&(this.Ni(),this._i-=this.Ai,this.yi+=1,this.pi=!1):this._i>=this.Ei&&(this.Ni(),this._i=0,this.yi+=1),this.Ti&&!this.mi&&this.yi>this.bi&&this.Ci()))},i.Li=function(){return this.Ti},i.Ni=function(){this.ki&&this.Ti&&(this.gi=!0,this.Ti.call(this.ki,this._i),this.gi=!1)},i.Ci=function(){this.wi&&this.Ti&&this.ki&&this.wi.Fi(this,this.ki)},t}();Gv.Si=[];var jv=t("Scheduler",function(t){function i(){var i;return(i=t.call(this)||this).Pi=void 0,i.Bi=void 0,i.Di=void 0,i.Ui=void 0,i.xi=void 0,i.Gi=void 0,i.ji=void 0,i.Hi=void 0,i.Vi=void 0,i.$i=void 0,i.Pi=1,i.Bi=[],i.Di=[],i.Ui=[],i.xi=jt(!0),i.Gi=jt(!0),i.ji=null,i.Hi=!1,i.Vi=!1,i.$i=[],i}s(i,t),i.enableForTarget=function(t){var i=!1;(t.uuid||t.id)&&(i=!0),i||(t.id=Bv.getNewId())};var n=i.prototype;return n.setTimeScale=function(t){this.Pi=t},n.getTimeScale=function(){return this.Pi},n.update=function(t){var i,n,e,r,s;for(this.Vi=!0,1!==this.Pi&&(t*=this.Pi),i=0,e=(n=this.Bi).length;i<e;i++)(r=n[i]).ti||r.ii||!r.Zt||null==r.Zt.update||r.Zt.update(t);for(i=0,e=(n=this.Di).length;i<e;i++)(r=n[i]).ti||r.ii||!r.Zt||null==r.Zt.update||r.Zt.update(t);for(i=0,e=(n=this.Ui).length;i<e;i++)(r=n[i]).ti||r.ii||!r.Zt||null==r.Zt.update||r.Zt.update(t);var h=this.$i;for(i=0;i<h.length;i++){var u;if(s=h[i],this.ji=s,this.Hi=!1,!s.ti&&s.ai)for(s.ci=0;s.ci<s.ai.length;++s.ci)s.fi=s.ai[s.ci],s.li=!1,s.fi.Mi(t),s.fi=null;this.Hi&&0===(null==(u=this.ji.ai)?void 0:u.length)&&(this.Wi(this.ji),--i)}for(i=0,n=this.Bi;i<n.length;)(r=n[i]).ii?this.zi(r):i++;for(i=0,n=this.Di;i<n.length;)(r=n[i]).ii?this.zi(r):i++;for(i=0,n=this.Ui;i<n.length;)(r=n[i]).ii?this.zi(r):i++;this.Vi=!1,this.ji=null},n.schedule=function(t,i,n,e,r,s){var h,u,o,a;"function"!=typeof t?(st(1514),o=i,a=t):(o=t,a=i),3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(s=!!e,e=T.macro.REPEAT_FOREVER,r=0),at(Boolean(a),1502);var c=a.uuid||a.id;if(c){var f,v,l=this.Gi[c];if(l?l.ti!==s&&st(1511):(l=xv.ni(null,a,0,null,!1,Boolean(s)),this.$i.push(l),this.Gi[c]=l),null==l.ai)l.ai=[];else for(v=0;v<l.ai.length;++v)if((f=l.ai[v])&&o===f.Li())return it(1507,f.Ri(),n),void f.Ii(n);(f=Gv.ni()).Oi(this,o,a,n,null!==(h=e)&&void 0!==h?h:0,null!==(u=r)&&void 0!==u?u:0),l.ai.push(f),this.ji===l&&this.Hi&&(this.Hi=!1)}else ut(1510)},n.scheduleUpdate=function(t,i,n){var e=t.uuid||t.id;if(e){var r=this.xi[e];if(r&&r.hi){if(r.hi.Jt===i)return r.hi.ii=!1,void(r.hi.ti=n);if(this.Vi)return it(1506),r.hi.ii=!1,void(r.hi.ti=n);this.unscheduleUpdate(t)}var s,h=Dv.ni(t,i,n,!1);0===i?(s=this.Di,this.Xi(s,h)):(s=i<0?this.Bi:this.Ui,this.Yi(s,h,i)),this.xi[e]=Uv.ni(s,h,t,null)}else ut(1510)},n.unschedule=function(t,i){if(i&&t){var n=i.uuid||i.id;if(n){var e=this.Gi[n];if(e){var r=e.ai;if(!r)return;for(var s=0,h=r.length;s<h;s++){var u=r[s];if(t===u.Li())return u!==e.fi||e.li||(e.li=!0),r.splice(s,1),Gv.ri(u),e.ci>=s&&e.ci--,void(0===r.length&&(this.ji===e?this.Hi=!0:this.Wi(e)))}}}else ut(1510)}},n.Fi=function(t,i){var n=i.uuid||i.id,e=this.Gi[n],r=e.ai;if(r&&0!==r.length)for(var s=r.length-1;s>=0;s--){var h=r[s];if(h===t)return r.splice(s,1),Gv.ri(h),e.ci>=s&&e.ci--,void(0===r.length&&(this.Hi=!0))}},n.unscheduleUpdate=function(t){if(t){var i=t.uuid||t.id;if(i){var n=this.xi[i];null!=n&&n.hi&&(this.Vi?n.hi.ii=!0:this.zi(n.hi))}else ut(1510)}},n.unscheduleAllForTarget=function(t){if(t){var i=t.uuid||t.id;if(i){var n=this.Gi[i];if(null!=n&&n.ai){var e=n.ai;n.fi&&e.indexOf(n.fi)>-1&&!n.li&&(n.li=!0);for(var r=0,s=e.length;r<s;r++)Gv.ri(e[r]);e.length=0,this.ji===n?this.Hi=!0:this.Wi(n)}this.unscheduleUpdate(t)}else ut(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(2147483648)},n.unscheduleAllWithMinPriority=function(t){var i,n,e,r=this.$i;for(i=r.length-1;i>=0;i--)(n=r[i]).Zt&&this.unscheduleAllForTarget(n.Zt);var s=0;if(t<0)for(i=0;i<this.Bi.length;){var h;s=this.Bi.length,null!=(h=e=this.Bi[i])&&h.Zt&&e.Jt>=t&&this.unscheduleUpdate(e.Zt),s===this.Bi.length&&i++}if(t<=0)for(i=0;i<this.Di.length;){var u;s=this.Di.length,null!=(u=e=this.Di[i])&&u.Zt&&this.unscheduleUpdate(e.Zt),s===this.Di.length&&i++}for(i=0;i<this.Ui.length;){var o;s=this.Ui.length,null!=(o=e=this.Ui[i])&&o.Zt&&e.Jt>=t&&this.unscheduleUpdate(e.Zt),s===this.Ui.length&&i++}},n.isScheduled=function(t,i){at(Boolean(t),1508),at(Boolean(i),1509);var n=i.uuid||i.id;if(!n)return ut(1510),!1;var e=this.Gi[n];if(!e)return!1;if(null==e.ai)return!1;for(var r=e.ai,s=0;s<r.length;++s)if(t===r[s].Li())return!0;return!1},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(2147483648)},n.pauseAllTargetsWithMinPriority=function(t){var i,n,e,r,s=[],h=this.$i;for(n=0,e=h.length;n<e;n++){var u;null!=(u=i=h[n])&&u.Zt&&(i.ti=!0,s.push(i.Zt))}if(t<0)for(n=0;n<this.Bi.length;n++){var o;null!=(o=r=this.Bi[n])&&o.Zt&&r.Jt>=t&&(r.ti=!0,s.push(r.Zt))}if(t<=0)for(n=0;n<this.Di.length;n++){var a;null!=(a=r=this.Di[n])&&a.Zt&&(r.ti=!0,s.push(r.Zt))}for(n=0;n<this.Ui.length;n++){var c;null!=(c=r=this.Ui[n])&&c.Zt&&r.Jt>=t&&(r.ti=!0,s.push(r.Zt))}return s},n.resumeTargets=function(t){if(t)for(var i=0;i<t.length;i++)this.resumeTarget(t[i])},n.pauseTarget=function(t){at(Boolean(t),1503);var i=t.uuid||t.id;if(i){var n=this.Gi[i];n&&(n.ti=!0);var e=this.xi[i];null!=e&&e.hi&&(e.hi.ti=!0)}else ut(1510)},n.resumeTarget=function(t){at(Boolean(t),1504);var i=t.uuid||t.id;if(i){var n=this.Gi[i];n&&(n.ti=!1);var e=this.xi[i];null!=e&&e.hi&&(e.hi.ti=!1)}else ut(1510)},n.isTargetPaused=function(t){at(Boolean(t),1505);var i=t.uuid||t.id;if(!i)return ut(1510),!1;var n=this.Gi[i];if(n)return n.ti;var e=this.xi[i];return!(null==e||!e.hi)&&e.hi.ti},n.Wi=function(t){if(t.Zt){var i=t.Zt.uuid||t.Zt.id;if(void 0!==i){delete this.Gi[i];for(var n=this.$i,e=0,r=n.length;e<r;e++)if(n[e]===t){n.splice(e,1);break}xv.ri(t)}}},n.zi=function(t){if(t.Zt){var i=t.Zt.uuid||t.Zt.id;if(void 0!==i){var n=this.xi[i];if(n){var e=n.si,r=n.hi;if(e)for(var s=0,h=e.length;s<h;s++)if(e[s]===r){e.splice(s,1);break}delete this.xi[i],r&&Dv.ri(r),Uv.ri(n)}}}},n.Yi=function(t,i,n){for(var e=0;e<t.length;e++)if(n<t[e].Jt)return void t.splice(e,0,i);t.push(i)},n.Xi=function(t,i){t.push(i)},i}(Pv));jv.ID="scheduler",T.Scheduler=jv;var Hv={};dt(Hv,"vmath",[{name:"vec2",newName:"Vec2",target:Es,targetName:"math"},{name:"vec3",newName:"Vec3",target:Es,targetName:"math"},{name:"vec4",newName:"Vec4",target:Es,targetName:"math"},{name:"quat",newName:"Quat",target:Es,targetName:"math"},{name:"mat3",newName:"Mat3",target:Es,targetName:"math"},{name:"mat4",newName:"Mat4",target:Es,targetName:"math"},{name:"color4",newName:"Color",target:Es,targetName:"math"},{name:"rect",newName:"Rect",target:Es,targetName:"math"},{name:"approx",newName:"approx",target:Es,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Es,targetName:"math"},{name:"equals",newName:"equals",target:Es,targetName:"math"},{name:"clamp",newName:"clamp",target:Es,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Es,targetName:"math"},{name:"lerp",newName:"lerp",target:Es,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Es,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Es,targetName:"math"},{name:"random",newName:"random",target:Es,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Es,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Es,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Es,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Es,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Es,targetName:"math"},{name:"repeat",newName:"repeat",target:Es,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Es,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Es,targetName:"math"}]),T.vmath=Hv,dt(jv.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:jv,targetName:"Scheduler"}]),dt(jv,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return 2147483648}}]),gt(jv,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),wt(Oi,"js",[{name:"js",suggest:"'js.js' is deprecated since v3.7.0, please access 'js' directly instead."}]);var Vv=String.prototype.charCodeAt;function $v(t){return this[t]}function Wv(t,i){for(var n=t.length,e=i^n,r=0,s="string"==typeof t?Vv:$v;n>=4;){var h=255&s.call(t,r)|(255&s.call(t,++r))<<8|(255&s.call(t,++r))<<16|(255&s.call(t,++r))<<24;h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16),e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:e^=(255&s.call(t,r+2))<<16;case 2:e^=(255&s.call(t,r+1))<<8;case 1:e=1540483477*(65535&(e^=255&s.call(t,r)))+((1540483477*(e>>>16)&65535)<<16)}return e=1540483477*(65535&(e^=e>>>13))+((1540483477*(e>>>16)&65535)<<16),(e^=e>>>15)>>>0}T.easing=Hc;var zv=function(){function t(){this.Ki=null,this.qi=new WeakMap}var i=t.prototype;return i.registerGCObject=function(t){return t},i.init=function(){},i.Qi=function(){},i.destroy=function(){},t}(),Xv=t("garbageCollectionManager",new zv),Yv=t("GCObject",function(){function t(){return Xv.registerGCObject(this)}return t.prototype.destroy=function(){},t}());function Kv(t,i){for(var n,e=d(i);!(n=e()).done;){var r=n.value;Array.isArray(r)?Kv(t,r):t.push(r)}}function qv(t){var i=[];return Kv(i,t),i.join("")}T.math=Es,T.geometry=Fv;var Qv=function(t,i,n){for(var e=0;e<i.length;++e)t.length<=e&&t.push(new n),t[e].copy(i[e]);t.length=i.length},Zv={UNKNOWN:0,SWAPCHAIN:1,BUFFER:2,TEXTURE:3,RENDER_PASS:4,FRAMEBUFFER:5,SAMPLER:6,SHADER:7,DESCRIPTOR_SET_LAYOUT:8,PIPELINE_LAYOUT:9,PIPELINE_STATE:10,DESCRIPTOR_SET:11,INPUT_ASSEMBLER:12,COMMAND_BUFFER:13,QUEUE:14,QUERY_POOL:15,GLOBAL_BARRIER:16,TEXTURE_BARRIER:17,BUFFER_BARRIER:18,COUNT:19},Jv={UNREADY:0,FAILED:1,SUCCESS:2},tl={UNKNOWN:0,GLES2:1,GLES3:2,METAL:3,VULKAN:4,NVN:5,WEBGL:6,WEBGL2:7,WEBGPU:8},il={IDENTITY:0,ROTATE_90:1,ROTATE_180:2,ROTATE_270:3},nl={ELEMENT_INDEX_UINT:0,INSTANCED_ARRAYS:1,MULTIPLE_RENDER_TARGETS:2,BLEND_MINMAX:3,COMPUTE_SHADER:4,INPUT_ATTACHMENT_BENEFIT:5,SUBPASS_COLOR_INPUT:6,SUBPASS_DEPTH_STENCIL_INPUT:7,RASTERIZATION_ORDER_NOCOHERENT:8,MULTI_SAMPLE_RESOLVE_DEPTH_STENCIL:9,COUNT:10},el={UNKNOWN:0,A8:1,L8:2,LA8:3,R8:4,R8SN:5,R8UI:6,R8I:7,R16F:8,R16UI:9,R16I:10,R32F:11,R32UI:12,R32I:13,RG8:14,RG8SN:15,RG8UI:16,RG8I:17,RG16F:18,RG16UI:19,RG16I:20,RG32F:21,RG32UI:22,RG32I:23,RGB8:24,SRGB8:25,RGB8SN:26,RGB8UI:27,RGB8I:28,RGB16F:29,RGB16UI:30,RGB16I:31,RGB32F:32,RGB32UI:33,RGB32I:34,RGBA8:35,BGRA8:36,SRGB8_A8:37,RGBA8SN:38,RGBA8UI:39,RGBA8I:40,RGBA16F:41,RGBA16UI:42,RGBA16I:43,RGBA32F:44,RGBA32UI:45,RGBA32I:46,R5G6B5:47,R11G11B10F:48,RGB5A1:49,RGBA4:50,RGB10A2:51,RGB10A2UI:52,RGB9E5:53,DEPTH:54,DEPTH_STENCIL:55,BC1:56,BC1_ALPHA:57,BC1_SRGB:58,BC1_SRGB_ALPHA:59,BC2:60,BC2_SRGB:61,BC3:62,BC3_SRGB:63,BC4:64,BC4_SNORM:65,BC5:66,BC5_SNORM:67,BC6H_UF16:68,BC6H_SF16:69,BC7:70,BC7_SRGB:71,ETC_RGB8:72,ETC2_RGB8:73,ETC2_SRGB8:74,ETC2_RGB8_A1:75,ETC2_SRGB8_A1:76,ETC2_RGBA8:77,ETC2_SRGB8_A8:78,EAC_R11:79,EAC_R11SN:80,EAC_RG11:81,EAC_RG11SN:82,PVRTC_RGB2:83,PVRTC_RGBA2:84,PVRTC_RGB4:85,PVRTC_RGBA4:86,PVRTC2_2BPP:87,PVRTC2_4BPP:88,ASTC_RGBA_4X4:89,ASTC_RGBA_5X4:90,ASTC_RGBA_5X5:91,ASTC_RGBA_6X5:92,ASTC_RGBA_6X6:93,ASTC_RGBA_8X5:94,ASTC_RGBA_8X6:95,ASTC_RGBA_8X8:96,ASTC_RGBA_10X5:97,ASTC_RGBA_10X6:98,ASTC_RGBA_10X8:99,ASTC_RGBA_10X10:100,ASTC_RGBA_12X10:101,ASTC_RGBA_12X12:102,ASTC_SRGBA_4X4:103,ASTC_SRGBA_5X4:104,ASTC_SRGBA_5X5:105,ASTC_SRGBA_6X5:106,ASTC_SRGBA_6X6:107,ASTC_SRGBA_8X5:108,ASTC_SRGBA_8X6:109,ASTC_SRGBA_8X8:110,ASTC_SRGBA_10X5:111,ASTC_SRGBA_10X6:112,ASTC_SRGBA_10X8:113,ASTC_SRGBA_10X10:114,ASTC_SRGBA_12X10:115,ASTC_SRGBA_12X12:116,COUNT:117},rl={NONE:0,UNORM:1,SNORM:2,UINT:3,INT:4,UFLOAT:5,FLOAT:6},sl={FLOAT:0,UNFILTERABLE_FLOAT:1,SINT:2,UINT:3},hl={UNKNOWN:0,BOOL:1,BOOL2:2,BOOL3:3,BOOL4:4,INT:5,INT2:6,INT3:7,INT4:8,UINT:9,UINT2:10,UINT3:11,UINT4:12,FLOAT:13,FLOAT2:14,FLOAT3:15,FLOAT4:16,MAT2:17,MAT2X3:18,MAT2X4:19,MAT3X2:20,MAT3:21,MAT3X4:22,MAT4X2:23,MAT4X3:24,MAT4:25,SAMPLER1D:26,SAMPLER1D_ARRAY:27,SAMPLER2D:28,SAMPLER2D_ARRAY:29,SAMPLER3D:30,SAMPLER_CUBE:31,SAMPLER:32,TEXTURE1D:33,TEXTURE1D_ARRAY:34,TEXTURE2D:35,TEXTURE2D_ARRAY:36,TEXTURE3D:37,TEXTURE_CUBE:38,IMAGE1D:39,IMAGE1D_ARRAY:40,IMAGE2D:41,IMAGE2D_ARRAY:42,IMAGE3D:43,IMAGE_CUBE:44,SUBPASS_INPUT:45,COUNT:46},ul={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,INDEX:4,VERTEX:8,UNIFORM:16,STORAGE:32,INDIRECT:64},ol={NONE:0,ENABLE_STAGING_WRITE:1},al={NONE:0,READ_ONLY:1,WRITE_ONLY:2,READ_WRITE:3},cl={NONE:0,DEVICE:1,HOST:2},fl={TEX1D:0,TEX2D:1,TEX3D:2,CUBE:3,TEX1D_ARRAY:4,TEX2D_ARRAY:5},vl={UNKNOWN:0,BUFFER:1,TEX1D:2,TEX1D_ARRAY:3,TEX2D:4,TEX2D_ARRAY:5,TEX2DMS:6,TEX2DMS_ARRAY:7,TEX3D:8,TEXCUBE:9,TEXCUBE_ARRAY:10,RAYTRACING_ACCELERATION_STRUCTURE:11},ll={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,SAMPLED:4,STORAGE:8,COLOR_ATTACHMENT:16,DEPTH_STENCIL_ATTACHMENT:32,INPUT_ATTACHMENT:64,SHADING_RATE:128},dl={NONE:0,GEN_MIPMAP:1,GENERAL_LAYOUT:2,EXTERNAL_OES:4,EXTERNAL_NORMAL:8,LAZILY_ALLOCATED:16,MUTABLE_VIEW_FORMAT:64,MUTABLE_STORAGE:128},gl={NONE:0,RENDER_TARGET:1,SAMPLED_TEXTURE:2,LINEAR_FILTER:4,STORAGE_TEXTURE:8,VERTEX_ATTRIBUTE:16,SHADING_RATE:32},wl={X1:1,X2:2,X4:4,X8:8,X16:16,X32:32,X64:64},_l={OFF:0,ON:1,RELAXED:2,MAILBOX:3,HALF:4},ml={NONE:0,POINT:1,LINEAR:2,ANISOTROPIC:3},pl={WRAP:0,MIRROR:1,CLAMP:2,BORDER:3},yl={NEVER:0,LESS:1,EQUAL:2,LESS_EQUAL:3,GREATER:4,NOT_EQUAL:5,GREATER_EQUAL:6,ALWAYS:7},bl={ZERO:0,KEEP:1,REPLACE:2,INCR:3,DECR:4,INVERT:5,INCR_WRAP:6,DECR_WRAP:7},Al={ZERO:0,ONE:1,SRC_ALPHA:2,DST_ALPHA:3,ONE_MINUS_SRC_ALPHA:4,ONE_MINUS_DST_ALPHA:5,SRC_COLOR:6,DST_COLOR:7,ONE_MINUS_SRC_COLOR:8,ONE_MINUS_DST_COLOR:9,SRC_ALPHA_SATURATE:10,CONSTANT_COLOR:11,ONE_MINUS_CONSTANT_COLOR:12,CONSTANT_ALPHA:13,ONE_MINUS_CONSTANT_ALPHA:14},El={ADD:0,SUB:1,REV_SUB:2,MIN:3,MAX:4},kl={NONE:0,R:1,G:2,B:4,A:8,ALL:15},Tl={NONE:0,VERTEX:1,CONTROL:2,EVALUATION:4,GEOMETRY:8,FRAGMENT:16,COMPUTE:32,ALL:63},Sl={LOAD:0,CLEAR:1,DISCARD:2},Ol={STORE:0,DISCARD:1},Rl={NONE:0,INDIRECT_BUFFER:1,INDEX_BUFFER:2,VERTEX_BUFFER:4,VERTEX_SHADER_READ_UNIFORM_BUFFER:8,VERTEX_SHADER_READ_TEXTURE:16,VERTEX_SHADER_READ_OTHER:32,FRAGMENT_SHADER_READ_UNIFORM_BUFFER:64,FRAGMENT_SHADER_READ_TEXTURE:128,FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT:256,FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT:512,FRAGMENT_SHADER_READ_OTHER:1024,COLOR_ATTACHMENT_READ:2048,DEPTH_STENCIL_ATTACHMENT_READ:4096,COMPUTE_SHADER_READ_UNIFORM_BUFFER:8192,COMPUTE_SHADER_READ_TEXTURE:16384,COMPUTE_SHADER_READ_OTHER:32768,TRANSFER_READ:65536,HOST_READ:131072,PRESENT:262144,VERTEX_SHADER_WRITE:524288,FRAGMENT_SHADER_WRITE:1048576,COLOR_ATTACHMENT_WRITE:2097152,DEPTH_STENCIL_ATTACHMENT_WRITE:4194304,COMPUTE_SHADER_WRITE:8388608,TRANSFER_WRITE:16777216,HOST_PREINITIALIZED:33554432,HOST_WRITE:67108864,SHADING_RATE:134217728},Il={NONE:0,SAMPLE_ZERO:1,AVERAGE:2,MIN:3,MAX:4},Ml={GRAPHICS:0,COMPUTE:1,RAY_TRACING:2},Nl={POINT_LIST:0,LINE_LIST:1,LINE_STRIP:2,LINE_LOOP:3,LINE_LIST_ADJACENCY:4,LINE_STRIP_ADJACENCY:5,ISO_LINE_LIST:6,TRIANGLE_LIST:7,TRIANGLE_STRIP:8,TRIANGLE_FAN:9,TRIANGLE_LIST_ADJACENCY:10,TRIANGLE_STRIP_ADJACENCY:11,TRIANGLE_PATCH_ADJACENCY:12,QUAD_PATCH_LIST:13},Cl={FILL:0,POINT:1,LINE:2},Ll={GOURAND:0,FLAT:1},Fl={NONE:0,FRONT:1,BACK:2},Pl={NONE:0,LINE_WIDTH:1,DEPTH_BIAS:2,BLEND_CONSTANTS:4,DEPTH_BOUNDS:8,STENCIL_WRITE_MASK:16,STENCIL_COMPARE_MASK:32},Bl={FRONT:1,BACK:2,ALL:3},Dl={UNKNOWN:0,UNIFORM_BUFFER:1,DYNAMIC_UNIFORM_BUFFER:2,STORAGE_BUFFER:4,DYNAMIC_STORAGE_BUFFER:8,SAMPLER_TEXTURE:16,SAMPLER:32,TEXTURE:64,STORAGE_IMAGE:128,INPUT_ATTACHMENT:256},Ul={GRAPHICS:0,COMPUTE:1,TRANSFER:2},xl={OCCLUSION:0,PIPELINE_STATISTICS:1,TIMESTAMP:2},Gl={PRIMARY:0,SECONDARY:1},jl={NONE:0,COLOR:1,DEPTH:2,STENCIL:4,DEPTH_STENCIL:6,ALL:7},Hl={FULL:0,SPLIT_BEGIN:1,SPLIT_END:2},Vl={RASTER:0,COMPUTE:1,COPY:2,MOVE:3,RAYTRACE:4,PRESENT:5},$l=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),Wl=function(){function t(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g,w,_,m,p,y,b,A,E,k,T){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=0),void 0===g&&(g=1),void 0===w&&(w=0),void 0===_&&(_=0),void 0===m&&(m=new $l),void 0===p&&(p=new $l),void 0===y&&(y=!1),void 0===b&&(b=!1),void 0===A&&(A=!1),void 0===E&&(E=-1),void 0===k&&(k=1),void 0===T&&(T=1),this.maxVertexAttributes=t,this.maxVertexUniformVectors=i,this.maxFragmentUniformVectors=n,this.maxTextureUnits=e,this.maxImageUnits=r,this.maxVertexTextureUnits=s,this.maxColorRenderTargets=h,this.maxShaderStorageBufferBindings=u,this.maxShaderStorageBlockSize=o,this.maxUniformBufferBindings=a,this.maxUniformBlockSize=c,this.maxTextureSize=f,this.maxCubeMapTextureSize=v,this.maxArrayTextureLayers=l,this.max3DTextureSize=d,this.uboOffsetAlignment=g,this.maxComputeSharedMemorySize=w,this.maxComputeWorkGroupInvocations=_,this.maxComputeWorkGroupSize=m,this.maxComputeWorkGroupCount=p,this.supportQuery=y,this.supportVariableRateShading=b,this.supportSubPassShading=A,this.clipSpaceMinZ=E,this.screenSpaceSignY=k,this.clipSpaceSignY=T}return t.prototype.copy=function(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.maxArrayTextureLayers=t.maxArrayTextureLayers,this.max3DTextureSize=t.max3DTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.supportVariableRateShading=t.supportVariableRateShading,this.supportSubPassShading=t.supportSubPassShading,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this},t}(),zl=function(){function t(t){void 0===t&&(t=!0),this.enableBarrierDeduce=t}return t.prototype.copy=function(t){return this.enableBarrierDeduce=t.enableBarrierDeduce,this},t}(),Xl=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),Yl=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),this.x=t,this.y=i,this.width=n,this.height=e}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t}(),Kl=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.width=t,this.height=i,this.depth=n}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this},t}(),ql=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.mipLevel=t,this.baseArrayLayer=i,this.layerCount=n}return t.prototype.copy=function(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),Ql=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=1),this.baseMipLevel=t,this.levelCount=i,this.baseArrayLayer=n,this.layerCount=e}return t.prototype.copy=function(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),Zl=function(){function t(t,i,n,e,r){void 0===t&&(t=new ql),void 0===i&&(i=new Xl),void 0===n&&(n=new ql),void 0===e&&(e=new Xl),void 0===r&&(r=new Kl),this.srcSubres=t,this.srcOffset=i,this.dstSubres=n,this.dstOffset=e,this.extent=r}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this},t}(),Jl=function(){function t(t,i,n,e,r,s){void 0===t&&(t=new ql),void 0===i&&(i=new Xl),void 0===n&&(n=new Kl),void 0===e&&(e=new ql),void 0===r&&(r=new Xl),void 0===s&&(s=new Kl),this.srcSubres=t,this.srcOffset=i,this.srcExtent=n,this.dstSubres=e,this.dstOffset=r,this.dstExtent=s}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this},t}(),td=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=new Xl),void 0===r&&(r=new Kl),void 0===s&&(s=new ql),this.buffOffset=t,this.buffStride=i,this.buffTexHeight=n,this.texOffset=e,this.texExtent=r,this.texSubres=s}return t.prototype.copy=function(t){return this.buffOffset=t.buffOffset,this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this},t}(),id=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=1),this.left=t,this.top=i,this.width=n,this.height=e,this.minDepth=r,this.maxDepth=s}var i=t.prototype;return i.copy=function(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this},i.reset=function(){this.left=0,this.top=0,this.width=0,this.height=0,this.minDepth=0,this.maxDepth=1},t}(),nd=function(){function t(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),this.x=t,this.y=i,this.z=n,this.w=e}var i=t.prototype;return i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.set=function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},i.reset=function(){this.x=0,this.y=0,this.z=0,this.w=0},t}(),ed=function(){function t(t,i){void 0===t&&(t=""),void 0===i&&(i=new nd),this.name=t,this.color=i}return t.prototype.copy=function(t){return this.name=t.name,this.color.copy(t.color),this},t}(),rd=function(){function t(t,i,n,e,r,s,h,u){void 0===t&&(t=[0]),void 0===i&&(i=[0]),void 0===n&&(n=[0]),void 0===e&&(e=[0]),void 0===r&&(r=[0]),void 0===s&&(s=[0]),void 0===h&&(h=[0]),void 0===u&&(u=[0]),this.maxBlockCounts=t,this.maxSamplerTextureCounts=i,this.maxSamplerCounts=n,this.maxTextureCounts=e,this.maxBufferCounts=r,this.maxImageCounts=s,this.maxSubpassInputCounts=h,this.setIndices=u}return t.prototype.copy=function(t){return this.maxBlockCounts=t.maxBlockCounts.slice(),this.maxSamplerTextureCounts=t.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=t.maxSamplerCounts.slice(),this.maxTextureCounts=t.maxTextureCounts.slice(),this.maxBufferCounts=t.maxBufferCounts.slice(),this.maxImageCounts=t.maxImageCounts.slice(),this.maxSubpassInputCounts=t.maxSubpassInputCounts.slice(),this.setIndices=t.setIndices.slice(),this},t}(),sd=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=null),void 0===n&&(n=1),void 0===e&&(e=0),void 0===r&&(r=0),this.windowId=t,this.windowHandle=i,this.vsyncMode=n,this.width=e,this.height=r}return t.prototype.copy=function(t){return this.windowId=t.windowId,this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this},t}(),hd=function(){function t(t){void 0===t&&(t=new rd),this.bindingMappingInfo=t}return t.prototype.copy=function(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this},t}(),ud=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r=0),this.usage=t,this.memUsage=i,this.size=n,this.stride=e,this.flags=r}return t.prototype.copy=function(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this},t}(),od=function(){function t(t,i,n){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),this.buffer=t,this.offset=i,this.range=n}return t.prototype.copy=function(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this},t}(),ad=function(){function t(t,i,n,e,r,s,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),this.vertexCount=t,this.firstVertex=i,this.indexCount=n,this.firstIndex=e,this.vertexOffset=r,this.instanceCount=s,this.firstInstance=h}return t.prototype.copy=function(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this},t}(),cd=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=null),void 0===r&&(r=0),this.groupCountX=t,this.groupCountY=i,this.groupCountZ=n,this.indirectBuffer=e,this.indirectOffset=r}return t.prototype.copy=function(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this},t}(),fd=function(){function t(t){void 0===t&&(t=[]),this.drawInfos=t}return t.prototype.copy=function(t){return Qv(this.drawInfos,t.drawInfos,ad),this},t}(),vd=function(){function t(t,i,n,e,r,s,h,u,o,a,c){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=1),void 0===u&&(u=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===c&&(c=0),this.type=t,this.usage=i,this.format=n,this.width=e,this.height=r,this.flags=s,this.layerCount=h,this.levelCount=u,this.samples=o,this.depth=a,this.externalRes=c}return t.prototype.copy=function(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this},t}(),ld=function(){function t(t,i,n,e,r,s,h,u,o){void 0===t&&(t=null),void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=1),this.texture=t,this.type=i,this.format=n,this.baseLevel=e,this.levelCount=r,this.baseLayer=s,this.layerCount=h,this.basePlane=u,this.planeCount=o}return t.prototype.copy=function(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this},t}(),dd=function(){function t(t,i,n,e,r,s,h,u){void 0===t&&(t=2),void 0===i&&(i=2),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=7),this.minFilter=t,this.magFilter=i,this.mipFilter=n,this.addressU=e,this.addressV=r,this.addressW=s,this.maxAnisotropy=h,this.cmpFunc=u}return t.prototype.copy=function(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this},t}(),gd=function(){function t(t,i,n){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),this.name=t,this.type=i,this.count=n}return t.prototype.copy=function(t){return this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),wd=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=[]),void 0===r&&(r=0),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.members=e,this.count=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,Qv(this.members,t.members,gd),this.count=t.count,this.flattened=t.flattened,this},t}(),_d=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.type=e,this.count=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this},t}(),md=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=0),this.set=t,this.binding=i,this.name=n,this.count=e,this.flattened=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this},t}(),pd=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.type=e,this.count=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this},t}(),yd=function(){function t(t,i,n,e,r,s,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=3),void 0===h&&(h=0),this.set=t,this.binding=i,this.name=n,this.type=e,this.count=r,this.memoryAccess=s,this.flattened=h}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this},t}(),bd=function(){function t(t,i,n,e,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=3),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.count=e,this.memoryAccess=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this},t}(),Ad=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===e&&(e=0),void 0===r&&(r=0),this.set=t,this.binding=i,this.name=n,this.count=e,this.flattened=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this},t}(),Ed=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=""),this.stage=t,this.source=i}return t.prototype.copy=function(t){return this.stage=t.stage,this.source=t.source,this},t}(),kd=function(){function t(t,i,n,e,r,s){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===e&&(e=0),void 0===r&&(r=!1),void 0===s&&(s=0),this.name=t,this.format=i,this.isNormalized=n,this.stream=e,this.isInstanced=r,this.location=s}return t.prototype.copy=function(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this},t}(),Td=function(){function t(t,i,n,e,r,s,h,u,o,a,c){void 0===t&&(t=""),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===e&&(e=[]),void 0===r&&(r=[]),void 0===s&&(s=[]),void 0===h&&(h=[]),void 0===u&&(u=[]),void 0===o&&(o=[]),void 0===a&&(a=[]),void 0===c&&(c=4294967295),this.name=t,this.stages=i,this.attributes=n,this.blocks=e,this.buffers=r,this.samplerTextures=s,this.samplers=h,this.textures=u,this.images=o,this.subpassInputs=a,this.hash=c}return t.prototype.copy=function(t){return this.name=t.name,Qv(this.stages,t.stages,Ed),Qv(this.attributes,t.attributes,kd),Qv(this.blocks,t.blocks,wd),Qv(this.buffers,t.buffers,bd),Qv(this.samplerTextures,t.samplerTextures,_d),Qv(this.samplers,t.samplers,md),Qv(this.textures,t.textures,pd),Qv(this.images,t.images,yd),Qv(this.subpassInputs,t.subpassInputs,Ad),this.hash=t.hash,this},t}(),Sd=function(){function t(t,i,n,e){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n=null),void 0===e&&(e=null),this.attributes=t,this.vertexBuffers=i,this.indexBuffer=n,this.indirectBuffer=e}return t.prototype.copy=function(t){return Qv(this.attributes,t.attributes,kd),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this},t}(),Od=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=1),void 0===e&&(e=0),void 0===r&&(r=null),this.format=t,this.sampleCount=i,this.loadOp=n,this.storeOp=e,this.barrier=r}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.barrier=t.barrier,this},t}(),Rd=function(){function t(t,i,n,e,r,s,h){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=1),void 0===e&&(e=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===h&&(h=null),this.format=t,this.sampleCount=i,this.depthLoadOp=n,this.depthStoreOp=e,this.stencilLoadOp=r,this.stencilStoreOp=s,this.barrier=h}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.barrier=t.barrier,this},t}(),Id=function(){function t(t,i,n,e,r,s,h,u,o){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===e&&(e=[]),void 0===r&&(r=-1),void 0===s&&(s=-1),void 0===h&&(h=-1),void 0===u&&(u=0),void 0===o&&(o=0),this.inputs=t,this.colors=i,this.resolves=n,this.preserves=e,this.depthStencil=r,this.depthStencilResolve=s,this.shadingRate=h,this.depthResolveMode=u,this.stencilResolveMode=o}return t.prototype.copy=function(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.shadingRate=t.shadingRate,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this},t}(),Md=function(){function t(t,i,n,e,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=null),void 0===e&&(e=0),void 0===r&&(r=0),this.srcSubpass=t,this.dstSubpass=i,this.generalBarrier=n,this.prevAccesses=e,this.nextAccesses=r}return t.prototype.copy=function(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.generalBarrier=t.generalBarrier,this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this},t}(),Nd=function(){function t(t,i,n,e,r){void 0===t&&(t=[]),void 0===i&&(i=new Rd),void 0===n&&(n=new Rd),void 0===e&&(e=[]),void 0===r&&(r=[]),this.colorAttachments=t,this.depthStencilAttachment=i,this.depthStencilResolveAttachment=n,this.subpasses=e,this.dependencies=r}return t.prototype.copy=function(t){return Qv(this.colorAttachments,t.colorAttachments,Od),this.depthStencilAttachment.copy(t.depthStencilAttachment),this.depthStencilResolveAttachment.copy(t.depthStencilResolveAttachment),Qv(this.subpasses,t.subpasses,Id),Qv(this.dependencies,t.dependencies,Md),this},t}(),Cd=function(){function t(t,i,n,e,r,s,h,u,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),this.width=t,this.height=i,this.depthOrArraySize=n,this.firstSlice=e,this.numSlices=r,this.mipLevel=s,this.levelCount=h,this.basePlane=u,this.planeCount=o}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depthOrArraySize=t.depthOrArraySize,this.firstSlice=t.firstSlice,this.numSlices=t.numSlices,this.mipLevel=t.mipLevel,this.levelCount=t.levelCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this},t}(),Ld=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.prevAccesses=t,this.nextAccesses=i,this.type=n}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this},t}(),Fd=function(){function t(t,i,n,e,r,s,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=new Cd),void 0===r&&(r=!1),void 0===s&&(s=null),void 0===h&&(h=null),this.prevAccesses=t,this.nextAccesses=i,this.type=n,this.range=e,this.discardContents=r,this.srcQueue=s,this.dstQueue=h}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.range.copy(t.range),this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),Pd=function(){function t(t,i,n,e,r,s,h,u){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===s&&(s=!1),void 0===h&&(h=null),void 0===u&&(u=null),this.prevAccesses=t,this.nextAccesses=i,this.type=n,this.offset=e,this.size=r,this.discardContents=s,this.srcQueue=h,this.dstQueue=u}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.offset=t.offset,this.size=t.size,this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),Bd=function(){function t(t,i,n,e){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===n&&(n=null),void 0===e&&(e=null),this.renderPass=t,this.colorTextures=i,this.depthStencilTexture=n,this.depthStencilResolveTexture=e}return t.prototype.copy=function(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this.depthStencilResolveTexture=t.depthStencilResolveTexture,this},t}(),Dd=function(){function t(t,i,n,e,r,s,h,u,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=[]),this.binding=t,this.descriptorType=i,this.count=n,this.stageFlags=e,this.access=r,this.viewDimension=s,this.sampleType=h,this.format=u,this.immutableSamplers=o}return t.prototype.copy=function(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.access=t.access,this.viewDimension=t.viewDimension,this.sampleType=t.sampleType,this.format=t.format,this.immutableSamplers=t.immutableSamplers.slice(),this},t}(),Ud=function(){function t(t){void 0===t&&(t=[]),this.bindings=t}return t.prototype.copy=function(t){return Qv(this.bindings,t.bindings,Dd),this},t}(),xd=function(){function t(t){void 0===t&&(t=null),this.layout=t}return t.prototype.copy=function(t){return this.layout=t.layout,this},t}(),Gd=function(){function t(t){void 0===t&&(t=[]),this.setLayouts=t}return t.prototype.copy=function(t){return this.setLayouts=t.setLayouts.slice(),this},t}(),jd=function(){function t(t){void 0===t&&(t=[]),this.attributes=t}return t.prototype.copy=function(t){return Qv(this.attributes,t.attributes,kd),this},t}(),Hd=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=0),this.queue=t,this.type=i}return t.prototype.copy=function(t){return this.queue=t.queue,this.type=t.type,this},t}(),Vd=function(){function t(t){void 0===t&&(t=0),this.type=t}return t.prototype.copy=function(t){return this.type=t.type,this},t}(),$d=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=32767),void 0===n&&(n=!0),this.type=t,this.maxQueryObjects=i,this.forceWait=n}return t.prototype.copy=function(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this},t}(),Wd=function(){function t(t,i,n,e,r,s,h,u){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===h&&(h=!1),void 0===u&&(u=!1),this.name=t,this.size=i,this.count=n,this.type=e,this.hasAlpha=r,this.hasDepth=s,this.hasStencil=h,this.isCompressed=u}return t.prototype.copy=function(t){return this.name=t.name,this.size=t.size,this.count=t.count,this.type=t.type,this.hasAlpha=t.hasAlpha,this.hasDepth=t.hasDepth,this.hasStencil=t.hasStencil,this.isCompressed=t.isCompressed,this},t}(),zd=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.bufferSize=t,this.textureSize=i}return t.prototype.copy=function(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this},t}(),Xd=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.writeMask=t,this.compareMask=i,this.reference=n}return t.prototype.copy=function(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this},t}(),Yd=function(){function t(t,i,n,e,r,s,h,u,o,a,c){void 0===t&&(t=new id),void 0===i&&(i=new Yl),void 0===n&&(n=new nd),void 0===e&&(e=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=new Xd),void 0===c&&(c=new Xd),this.viewport=t,this.scissor=i,this.blendConstant=n,this.lineWidth=e,this.depthBiasConstant=r,this.depthBiasClamp=s,this.depthBiasSlope=h,this.depthMinBounds=u,this.depthMaxBounds=o,this.stencilStatesFront=a,this.stencilStatesBack=c}return t.prototype.copy=function(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this},t}(),Kd=function(t){function i(n){var e;return(e=t.call(this)||this).Zi=0,e.Ji=0,e.tn=0,e.Zi=n,e.Ji=i.nn[0]++,e.tn=i.nn[n]++,e}return s(i,t),e(i,[{key:"objectType",get:function(){return this.Zi}},{key:"objectID",get:function(){return this.Ji}},{key:"typedID",get:function(){return this.tn}}]),i}(Yv);Kd.nn=Array(19).fill(65536);var qd={ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR1:"a_color1",ATTR_COLOR2:"a_color2",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_BATCH_ID:"a_batch_id",ATTR_BATCH_UV:"a_batch_uv"};function Qd(t,i,n,e,r,s,h,u){return new Wd(t,i,n,e,r,s,h,u)}function Zd(t){return new Wd("ASTC_SRGBA_"+t,1,4,1,!0,!1,!1,!0)}function Jd(t){return new Wd("ASTC_RGBA_"+t,1,4,1,!0,!1,!1,!0)}var tg=Object.freeze([Qd("UNKNOWN"),Qd("A8",1,1,1,!0),Qd("L8",1,1,1),Qd("LA8",1,2,1,!0),Qd("R8",1,1,1),Qd("R8SN",1,1,2),Qd("R8UI",1,1,3),Qd("R8I",1,1,4),Qd("R16F",2,1,6),Qd("R16UI",2,1,3),Qd("R16I",2,1,4),Qd("R32F",4,1,6),Qd("R32UI",4,1,3),Qd("R32I",4,1,4),Qd("RG8",2,2,1),Qd("RG8SN",2,2,2),Qd("RG8UI",2,2,3),Qd("RG8I",2,2,4),Qd("RG16F",4,2,6),Qd("RG16UI",4,2,3),Qd("RG16I",4,2,4),Qd("RG32F",8,2,6),Qd("RG32UI",8,2,3),Qd("RG32I",8,2,4),Qd("RGB8",3,3,1),Qd("SRGB8",3,3,1),Qd("RGB8SN",3,3,2),Qd("RGB8UI",3,3,3),Qd("RGB8I",3,3,4),Qd("RGB16F",6,3,6),Qd("RGB16UI",6,3,3),Qd("RGB16I",6,3,4),Qd("RGB32F",12,3,6),Qd("RGB32UI",12,3,3),Qd("RGB32I",12,3,4),Qd("RGBA8",4,4,1,!0),Qd("BGRA8",4,4,1,!0),Qd("SRGB8_A8",4,4,1,!0),Qd("RGBA8SN",4,4,2,!0),Qd("RGBA8UI",4,4,3,!0),Qd("RGBA8I",4,4,4,!0),Qd("RGBA16F",8,4,6,!0),Qd("RGBA16UI",8,4,3,!0),Qd("RGBA16I",8,4,4,!0),Qd("RGBA32F",16,4,6,!0),Qd("RGBA32UI",16,4,3,!0),Qd("RGBA32I",16,4,4,!0),Qd("R5G6B5",2,3,1),Qd("R11G11B10F",4,3,6),Qd("RGB5A1",2,4,1,!0),Qd("RGBA4",2,4,1,!0),Qd("RGB10A2",2,4,1,!0),Qd("RGB10A2UI",2,4,3,!0),Qd("RGB9E5",2,4,6,!0),Qd("DEPTH",4,1,6,!1,!0),Qd("DEPTH_STENCIL",5,2,6,!1,!0,!0),Qd("BC1",1,3,1,!1,!1,!1,!0),Qd("BC1_ALPHA",1,4,1,!0,!1,!1,!0),Qd("BC1_SRGB",1,3,1,!1,!1,!1,!0),Qd("BC1_SRGB_ALPHA",1,4,1,!0,!1,!1,!0),Qd("BC2",1,4,1,!0,!1,!1,!0),Qd("BC2_SRGB",1,4,1,!0,!1,!1,!0),Qd("BC3",1,4,1,!0,!1,!1,!0),Qd("BC3_SRGB",1,4,1,!0,!1,!1,!0),Qd("BC4",1,1,1,!1,!1,!1,!0),Qd("BC4_SNORM",1,1,2,!1,!1,!1,!0),Qd("BC5",1,2,1,!1,!1,!1,!0),Qd("BC5_SNORM",1,2,2,!1,!1,!1,!0),Qd("BC6H_UF16",1,3,5,!1,!1,!1,!0),Qd("BC6H_SF16",1,3,6,!1,!1,!1,!0),Qd("BC7",1,4,1,!0,!1,!1,!0),Qd("BC7_SRGB",1,4,1,!0,!1,!1,!0),Qd("ETC_RGB8",1,3,1,!1,!1,!1,!0),Qd("ETC2_RGB8",1,3,1,!1,!1,!1,!0),Qd("ETC2_SRGB8",1,3,1,!1,!1,!1,!0),Qd("ETC2_RGB8_A1",1,4,1,!0,!1,!1,!0),Qd("ETC2_SRGB8_A1",1,4,1,!0,!1,!1,!0),Qd("ETC2_RGBA8",2,4,1,!0,!1,!1,!0),Qd("ETC2_SRGB8_A8",2,4,1,!0,!1,!1,!0),Qd("EAC_R11",1,1,1,!1,!1,!1,!0),Qd("EAC_R11SN",1,1,2,!1,!1,!1,!0),Qd("EAC_RG11",2,2,1,!1,!1,!1,!0),Qd("EAC_RG11SN",2,2,2,!1,!1,!1,!0),Qd("PVRTC_RGB2",2,3,1,!1,!1,!1,!0),Qd("PVRTC_RGBA2",2,4,1,!0,!1,!1,!0),Qd("PVRTC_RGB4",2,3,1,!1,!1,!1,!0),Qd("PVRTC_RGBA4",2,4,1,!0,!1,!1,!0),Qd("PVRTC2_2BPP",2,4,1,!0,!1,!1,!0),Qd("PVRTC2_4BPP",2,4,1,!0,!1,!1,!0),Jd("4x4"),Jd("5x4"),Jd("5x5"),Jd("6x5"),Jd("6x6"),Jd("8x5"),Jd("8x6"),Jd("8x8"),Jd("10x5"),Jd("10x6"),Jd("10x8"),Jd("10x10"),Jd("12x10"),Jd("12x12"),Zd("4x4"),Zd("5x4"),Zd("5x5"),Zd("6x5"),Zd("6x6"),Zd("8x5"),Zd("8x6"),Zd("8x8"),Zd("10x5"),Zd("10x6"),Zd("10x8"),Zd("10x10"),Zd("12x10"),Zd("12x12")]),ig=15,ng=496;function eg(t){return t>0&&!(t&t-1)}var rg=Math.ceil;function sg(t,i,n,e){if(!tg[t].isCompressed)return i*n*e*tg[t].size;switch(t){case 56:case 57:case 58:case 59:case 72:case 73:case 74:case 75:case 79:case 80:case 85:case 86:case 88:return rg(i/4)*rg(n/4)*8*e;case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 77:case 76:case 81:case 82:case 89:case 103:return rg(i/4)*rg(n/4)*16*e;case 66:case 67:return rg(i/4)*rg(n/4)*32*e;case 83:case 84:case 87:return rg(i/8)*rg(n/4)*8*e;case 90:case 104:return rg(i/5)*rg(n/4)*16*e;case 91:case 105:return rg(i/5)*rg(n/5)*16*e;case 92:case 106:return rg(i/6)*rg(n/5)*16*e;case 93:case 107:return rg(i/6)*rg(n/6)*16*e;case 94:case 108:return rg(i/8)*rg(n/5)*16*e;case 95:case 109:return rg(i/8)*rg(n/6)*16*e;case 96:case 110:return rg(i/8)*rg(n/8)*16*e;case 97:case 111:return rg(i/10)*rg(n/5)*16*e;case 98:case 112:return rg(i/10)*rg(n/6)*16*e;case 99:case 113:return rg(i/10)*rg(n/8)*16*e;case 100:case 114:return rg(i/10)*rg(n/10)*16*e;case 101:case 115:return rg(i/12)*rg(n/10)*16*e;case 102:case 116:return rg(i/12)*rg(n/12)*16*e;default:return 0}}function hg(t,i,n,e,r){for(var s=0,h=0;h<r;++h)s+=sg(t,i,n,e),i=Math.max(i>>1,1),n=Math.max(n>>1,1);return s}var ug=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function og(t){return ug[t]||0}function ag(t){if(t.isCompressed)return Uint8Array;var i=t.size/t.count;switch(t.type){case 1:case 3:switch(i){case 1:default:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}case 2:case 4:switch(i){case 1:default:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}case 6:return 2===i?Uint16Array:Float32Array}return Float32Array}function cg(t){switch(t){case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 66:case 67:case 72:case 73:case 74:case 75:case 79:case 80:case 77:case 76:case 81:case 82:case 85:case 86:case 88:case 89:case 103:return{width:4,height:4};case 83:case 84:case 87:return{width:8,height:4};case 90:case 104:return{width:5,height:4};case 91:case 105:return{width:5,height:5};case 92:case 106:return{width:6,height:5};case 93:case 107:return{width:6,height:6};case 94:case 108:return{width:8,height:5};case 95:case 109:return{width:8,height:6};case 96:case 110:return{width:8,height:8};case 97:case 111:return{width:10,height:5};case 98:case 112:return{width:10,height:6};case 99:case 113:return{width:10,height:8};case 100:case 114:return{width:10,height:10};case 101:case 115:return{width:12,height:10};case 102:case 116:return{width:12,height:12};default:return{width:1,height:1}}}function fg(t,i){return rg(t/i)*i}var vg=Object.freeze({__proto__:null,API:tl,AccessFlagBit:Rl,Address:pl,Attribute:kd,AttributeName:qd,BarrierType:Hl,BindingMappingInfo:rd,BlendFactor:Al,BlendOp:El,BufferBarrierInfo:Pd,BufferFlagBit:ol,BufferInfo:ud,BufferTextureCopy:td,BufferUsageBit:ul,BufferViewInfo:od,ClearFlagBit:jl,Color:nd,ColorAttachment:Od,ColorMask:kl,CommandBufferInfo:Hd,CommandBufferType:Gl,ComparisonFunc:yl,CullMode:Fl,DESCRIPTOR_BUFFER_TYPE:ig,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:ng,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DepthStencilAttachment:Rd,DescriptorSetInfo:xd,DescriptorSetLayoutBinding:Dd,DescriptorSetLayoutInfo:Ud,DescriptorType:Dl,DeviceCaps:Wl,DeviceInfo:hd,DeviceOptions:zl,DispatchInfo:cd,DrawInfo:ad,DynamicStateFlagBit:Pl,DynamicStates:Yd,DynamicStencilStates:Xd,Extent:Kl,Feature:nl,Filter:ml,Format:el,FormatFeatureBit:gl,FormatInfo:Wd,FormatInfos:tg,FormatSize:sg,FormatSurfaceSize:hg,FormatType:rl,FramebufferInfo:Bd,GFXObject:Kd,GeneralBarrierInfo:Ld,GetTypeSize:og,IndirectBuffer:fd,InputAssemblerInfo:Sd,InputState:jd,IsPowerOf2:eg,LoadOp:Sl,MarkerInfo:ed,MemoryAccessBit:al,MemoryStatus:zd,MemoryUsageBit:cl,ObjectType:Zv,Offset:Xl,PassType:Vl,PipelineBindPoint:Ml,PipelineLayoutInfo:Gd,PolygonMode:Cl,PrimitiveMode:Nl,QueryPoolInfo:$d,QueryType:xl,QueueInfo:Vd,QueueType:Ul,Rect:Yl,RenderPassInfo:Nd,ResolveMode:Il,ResourceRange:Cd,SampleCount:wl,SampleType:sl,SamplerInfo:dd,ShadeModel:Ll,ShaderInfo:Td,ShaderStage:Ed,ShaderStageFlagBit:Tl,Size:$l,Status:Jv,StencilFace:Bl,StencilOp:bl,StoreOp:Ol,SubpassDependency:Md,SubpassInfo:Id,SurfaceTransform:il,SwapchainInfo:sd,TextureBarrierInfo:Fd,TextureBlit:Jl,TextureCopy:Zl,TextureFlagBit:dl,TextureInfo:vd,TextureSubresLayers:ql,TextureSubresRange:Ql,TextureType:fl,TextureUsageBit:ll,TextureViewInfo:ld,Type:hl,Uniform:gd,UniformBlock:wd,UniformInputAttachment:Ad,UniformSampler:md,UniformSamplerTexture:_d,UniformStorageBuffer:bd,UniformStorageImage:yd,UniformTexture:pd,ViewDimension:vl,Viewport:id,VsyncMode:_l,alignTo:fg,formatAlignment:cg,getTypedArrayConstructor:ag}),lg=function(t){function i(){var i;return(i=t.call(this,2)||this).en=0,i.rn=0,i.sn=0,i.hn=1,i.$=0,i.Gt=0,i.un=!1,i}return s(i,t),e(i,[{key:"usage",get:function(){return this.en}},{key:"memUsage",get:function(){return this.rn}},{key:"size",get:function(){return this.sn}},{key:"stride",get:function(){return this.hn}},{key:"count",get:function(){return this.$}},{key:"flags",get:function(){return this.Gt}}]),i}(Kd),dg=function(t){function i(){var i;return(i=t.call(this,13)||this).an=null,i.M=0,i.cn=0,i.vn=0,i.ln=0,i}return s(i,t),e(i,[{key:"type",get:function(){return this.M}},{key:"queue",get:function(){return this.an}},{key:"numDrawCalls",get:function(){return this.cn}},{key:"numInstances",get:function(){return this.vn}},{key:"numTris",get:function(){return this.ln}}]),i}(Kd),gg=function(){function t(){this.dn=0,this.gn="",this.wn="",this._n=new Array(10),this.mn=new Array(117),this.an=null,this.pn=null,this.cn=0,this.vn=0,this.ln=0,this.yn=new zd,this.bn=new Wl,this.An=new rd,this.En=new Map,this.kn=new Map,this.Tn=new Map,this.Sn=new Map,this.On=35}var i=t.prototype;return i.hasFeature=function(t){return this._n[t]},i.getFormatFeatures=function(t){return this.mn[t]},i.enableAutoBarrier=function(){},i.getMaxSampleCount=function(){return 1},e(t,[{key:"gfxAPI",get:function(){return this.dn}},{key:"queue",get:function(){return this.an}},{key:"commandBuffer",get:function(){return this.pn}},{key:"swapchainFormat",get:function(){return this.On}},{key:"renderer",get:function(){return this.gn}},{key:"vendor",get:function(){return this.wn}},{key:"numDrawCalls",get:function(){return this.cn}},{key:"numInstances",get:function(){return this.vn}},{key:"numTris",get:function(){return this.ln}},{key:"memoryStatus",get:function(){return this.yn}},{key:"capabilities",get:function(){return this.bn}},{key:"bindingMappingInfo",get:function(){return this.An}}]),t}();gg.Rn=void 0;var wg=function(){function t(t){this.In=null,this.Mn=null,this.Nn=null,this.Cn=null;var i=t.capabilities,n=new Uint8Array(64);if(n.fill(255),i.maxTextureSize>=2){this.In=t.createTexture(new vd(1,12,35,2,2,0));var e=new td(0,0,0,new Xl(0,0,0),new Kl(2,2,1));t.copyBuffersToTexture([n],this.In,[e])}if(i.maxTextureSize>=2){this.Nn=t.createTexture(new vd(3,12,35,2,2,0,6));var r=new td(0,0,0,new Xl(0,0,0),new Kl(2,2,1));t.copyBuffersToTexture([n],this.Nn,[r]),r.texSubres.baseArrayLayer=1,t.copyBuffersToTexture([n],this.Nn,[r]),r.texSubres.baseArrayLayer=2,t.copyBuffersToTexture([n],this.Nn,[r]),r.texSubres.baseArrayLayer=3,t.copyBuffersToTexture([n],this.Nn,[r]),r.texSubres.baseArrayLayer=4,t.copyBuffersToTexture([n],this.Nn,[r]),r.texSubres.baseArrayLayer=5,t.copyBuffersToTexture([n],this.Nn,[r])}if(i.max3DTextureSize>=2){this.Mn=t.createTexture(new vd(2,12,35,2,2,0,1,1,1,2));var s=new td(0,0,0,new Xl(0,0,0),new Kl(2,2,2),new ql(0,0,1));t.copyBuffersToTexture([n],this.Mn,[s])}if(i.maxArrayTextureLayers>=2){this.Cn=t.createTexture(new vd(5,12,35,2,2,0,2));var h=new td(0,0,0,new Xl(0,0,0),new Kl(2,2,1),new ql(0,0,1));t.copyBuffersToTexture([n],this.Cn,[h]),h.texSubres.baseArrayLayer=1,t.copyBuffersToTexture([n],this.Cn,[h])}}return t.prototype.Ln=function(t){switch(t){case 1:return this.In;case 2:return this.Mn;case 3:return this.Nn;case 5:return this.Cn;default:return null}},t}(),_g=function(t){function i(){var i;return(i=t.call(this,1)||this).Fn=0,i.Pn=null,i.Bn=null,i}return s(i,t),e(i,[{key:"colorTexture",get:function(){return this.Pn}},{key:"depthStencilTexture",get:function(){return this.Bn}},{key:"surfaceTransform",get:function(){return this.Fn}},{key:"width",get:function(){return this.Pn.width}},{key:"height",get:function(){return this.Pn.height}}]),i}(Kd),mg=function(t){function i(){var i;return(i=t.call(this,5)||this).Dn=null,i.Un=[],i.Bn=null,i.xn=0,i.Gn=0,i}return s(i,t),e(i,[{key:"renderPass",get:function(){return this.Dn}},{key:"colorTextures",get:function(){return this.Un}},{key:"depthStencilTexture",get:function(){return this.Bn}},{key:"width",get:function(){var t,i;return this.colorTextures.length>0?null!==(t=null==(i=this.colorTextures[0])?void 0:i.width)&&void 0!==t?t:this.xn:this.depthStencilTexture?this.depthStencilTexture.width:this.xn}},{key:"height",get:function(){var t,i;return this.colorTextures.length>0?null!==(t=null==(i=this.colorTextures[0])?void 0:i.height)&&void 0!==t?t:this.Gn:this.depthStencilTexture?this.depthStencilTexture.height:this.Gn}},{key:"needRebuild",get:function(){return!1}}]),i}(Kd),pg=function(t){function i(){var i;return(i=t.call(this,12)||this).jn=[],i.Hn=0,i.Vn=[],i.$n=null,i.Wn=null,i.zn=new ad,i}s(i,t);var n=i.prototype;return n.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this.Vn.length?this.Vn[t]:null},n.computeAttributesHash=function(){for(var t="attrs",i=0;i<this.attributes.length;++i){var n=this.attributes[i];t+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced+","+n.location}return Wv(t,666)},e(i,[{key:"attributes",get:function(){return this.jn}},{key:"vertexBuffers",get:function(){return this.Vn}},{key:"indexBuffer",get:function(){return this.$n}},{key:"indirectBuffer",get:function(){return this.Wn}},{key:"attributesHash",get:function(){return this.Hn}},{key:"vertexCount",get:function(){return this.zn.vertexCount},set:function(t){this.zn.vertexCount=t}},{key:"firstVertex",get:function(){return this.zn.firstVertex},set:function(t){this.zn.firstVertex=t}},{key:"indexCount",get:function(){return this.zn.indexCount},set:function(t){this.zn.indexCount=t}},{key:"firstIndex",get:function(){return this.zn.firstIndex},set:function(t){this.zn.firstIndex=t}},{key:"vertexOffset",get:function(){return this.zn.vertexOffset},set:function(t){this.zn.vertexOffset=t}},{key:"instanceCount",get:function(){return this.zn.instanceCount},set:function(t){this.zn.instanceCount=t}},{key:"firstInstance",get:function(){return this.zn.firstInstance},set:function(t){this.zn.firstInstance=t}},{key:"drawInfo",get:function(){return this.zn},set:function(t){this.zn=t}}]),i}(Kd),yg=function(t){function i(){var i;return(i=t.call(this,11)||this).Xn=null,i.Yn=[],i.Kn=[],i.En=[],i.qn=!1,i}s(i,t);var n=i.prototype;return n.bindBuffer=function(t,i,n){void 0===n&&(n=0);var e=this.Xn.bindingIndices[t],r=this.Xn.bindings[e];if(r&&r.descriptorType&ig){var s=this.Xn.descriptorIndices[t];this.Yn[s+n]!==i&&(this.Yn[s+n]=i,this.qn=!0)}},n.bindSampler=function(t,i,n){void 0===n&&(n=0);var e=this.Xn.bindingIndices[t],r=this.Xn.bindings[e];if(r&&r.descriptorType&ng){var s=this.Xn.descriptorIndices[t];this.En[s+n]!==i&&(this.En[s+n]=i,this.qn=!0)}},n.bindTexture=function(t,i,n){void 0===n&&(n=0);var e=this.Xn.bindingIndices[t],r=this.Xn.bindings[e];if(r&&r.descriptorType&ng){var s=this.Xn.descriptorIndices[t];this.Kn[s+n]!==i&&(this.Kn[s+n]=i,this.qn=!0)}},n.getBuffer=function(t,i){void 0===i&&(i=0);var n=this.Xn.descriptorIndices[t];return this.Yn[n+i]},n.getSampler=function(t,i){void 0===i&&(i=0);var n=this.Xn.descriptorIndices[t];return this.En[n+i]},n.getTexture=function(t,i){void 0===i&&(i=0);var n=this.Xn.descriptorIndices[t];return this.Kn[n+i]},e(i,[{key:"layout",get:function(){return this.Xn}}]),i}(Kd),bg=function(t){function i(){var i;return(i=t.call(this,8)||this).Qn=[],i.Zn=[],i.Jn=[],i}return s(i,t),e(i,[{key:"bindings",get:function(){return this.Qn}},{key:"bindingIndices",get:function(){return this.Zn}},{key:"descriptorIndices",get:function(){return this.Jn}}]),i}(Kd),Ag=function(t){function i(){var i;return(i=t.call(this,9)||this).te=[],i}return s(i,t),e(i,[{key:"setLayouts",get:function(){return this.te}}]),i}(Kd),Eg=function(){function t(t,i,n,e,r,s,h,u,o,a,c,f){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=2),void 0===r&&(r=!0),void 0===s&&(s=!1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===a&&(a=!0),void 0===c&&(c=!1),void 0===f&&(f=1),this.isDiscard=t,this.polygonMode=i,this.shadeModel=n,this.cullMode=e,this.isFrontFaceCCW=r,this.depthBiasEnabled=s,this.depthBias=h,this.depthBiasClamp=u,this.depthBiasSlop=o,this.isDepthClip=a,this.isMultisample=c,this.lineWidth=f}var i=t.prototype;return i.reset=function(){this.isDiscard=!1,this.polygonMode=0,this.shadeModel=0,this.cullMode=2,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},e(t,[{key:"native",get:function(){return this}}]),t}(),kg=function(){function t(t,i,n,e,r,s,h,u,o,a,c,f,v,l,d,g,w,_,m){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=1),void 0===e&&(e=!1),void 0===r&&(r=7),void 0===s&&(s=65535),void 0===h&&(h=65535),void 0===u&&(u=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===c&&(c=1),void 0===f&&(f=!1),void 0===v&&(v=7),void 0===l&&(l=65535),void 0===d&&(d=65535),void 0===g&&(g=1),void 0===w&&(w=1),void 0===_&&(_=1),void 0===m&&(m=1),this.depthTest=t,this.depthWrite=i,this.depthFunc=n,this.stencilTestFront=e,this.stencilFuncFront=r,this.stencilReadMaskFront=s,this.stencilWriteMaskFront=h,this.stencilFailOpFront=u,this.stencilZFailOpFront=o,this.stencilPassOpFront=a,this.stencilRefFront=c,this.stencilTestBack=f,this.stencilFuncBack=v,this.stencilReadMaskBack=l,this.stencilWriteMaskBack=d,this.stencilFailOpBack=g,this.stencilZFailOpBack=w,this.stencilPassOpBack=_,this.stencilRefBack=m}var i=t.prototype;return i.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=1,this.stencilTestFront=!1,this.stencilFuncFront=7,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=1,this.stencilZFailOpFront=1,this.stencilPassOpFront=1,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=7,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=1,this.stencilZFailOpBack=1,this.stencilPassOpBack=1,this.stencilRefBack=1},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},e(t,[{key:"native",get:function(){return this}}]),t}(),Tg=function(){function t(t,i,n,e,r,s,h,u){void 0===t&&(t=!1),void 0===i&&(i=1),void 0===n&&(n=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=15),this.blend=t,this.blendSrc=i,this.blendDst=n,this.blendEq=e,this.blendSrcAlpha=r,this.blendDstAlpha=s,this.blendAlphaEq=h,this.blendColorMask=u}var i=t.prototype;return i.reset=function(){this.blend=!1,this.blendSrc=1,this.blendDst=0,this.blendEq=0,this.blendSrcAlpha=1,this.blendDstAlpha=0,this.blendAlphaEq=0,this.blendColorMask=15},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},t}(),Sg=function(){function t(t,i,n,e){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=new nd),void 0===e&&(e=[new Tg]),this.isA2C=t,this.isIndepend=i,this.blendColor=n,this.targets=e}var i=t.prototype;return i.setTarget=function(t,i){var n=this.targets[t];n||(n=this.targets[t]=new Tg),Object.assign(n,i)},i.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},i.destroy=function(){},e(t,[{key:"native",get:function(){return this}}]),t}(),Og=function(t,i,n,e,r,s,h,u,o,a){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===e&&(e=new jd),void 0===r&&(r=new Eg),void 0===s&&(s=new kg),void 0===h&&(h=new Sg),void 0===u&&(u=7),void 0===o&&(o=0),void 0===a&&(a=0),this.shader=t,this.pipelineLayout=i,this.renderPass=n,this.inputState=e,this.rasterizerState=r,this.depthStencilState=s,this.blendState=h,this.primitive=u,this.dynamicStates=o,this.bindPoint=a},Rg=function(t){function i(){var i;return(i=t.call(this,10)||this).ie=null,i.ne=null,i.ee=7,i.re=null,i.se=new Eg,i.he=new kg,i.ue=new Sg,i.oe=0,i.Dn=null,i}return s(i,t),e(i,[{key:"shader",get:function(){return this.ie}},{key:"pipelineLayout",get:function(){return this.ne}},{key:"primitive",get:function(){return this.ee}},{key:"rasterizerState",get:function(){return this.se}},{key:"depthStencilState",get:function(){return this.he}},{key:"blendState",get:function(){return this.ue}},{key:"inputState",get:function(){return this.re}},{key:"dynamicStates",get:function(){return this.oe}},{key:"renderPass",get:function(){return this.Dn}}]),i}(Kd),Ig=function(t){function i(){var i;return(i=t.call(this,14)||this).M=0,i}return s(i,t),e(i,[{key:"type",get:function(){return this.M}}]),i}(Kd),Mg=function(t){function i(){var i;return(i=t.call(this,4)||this).ae=[],i.ce=null,i.fe=[],i.ve=0,i}return s(i,t),i.prototype.computeHash=function(){var t="";if(this.fe.length)for(var i=0;i<this.fe.length;++i){var n=this.fe[i];if(n.inputs.length){t+="ia";for(var e=0;e<n.inputs.length;++e){var r=this.ae[n.inputs[e]];t+=","+r.format+","+r.sampleCount}}if(n.colors.length){t+="ca";for(var s=0;s<n.colors.length;++s){var h=this.ae[n.colors[s]];t+=","+h.format+","+h.sampleCount}}if(n.depthStencil>=0){var u=this.ae[n.depthStencil];t+="ds,"+u.format+","+u.sampleCount}}else{t+="ca";for(var o=0;o<this.ae.length;++o){var a=this.ae[o];t+=","+a.format+","+a.sampleCount}var c=this.ce;c&&(t+="ds,"+c.format+","+c.sampleCount)}return Wv(t,666)},e(i,[{key:"colorAttachments",get:function(){return this.ae}},{key:"depthStencilAttachment",get:function(){return this.ce}},{key:"subPasses",get:function(){return this.fe}},{key:"hash",get:function(){return this.ve}}]),i}(Kd),Ng=function(t){function i(i,n){var e;return(e=t.call(this,6)||this).le=new dd,e.ve=0,e.le.copy(i),e.ve=n,e}return s(i,t),i.computeHash=function(t){var i=t.minFilter;return i|=t.magFilter<<2,i|=t.mipFilter<<4,i|=t.addressU<<6,i|=t.addressV<<8,i|=t.addressW<<10,(i|=Math.min(t.maxAnisotropy,16)<<12)|t.cmpFunc<<17},i.unpackFromHash=function(t){var i=new dd;return i.minFilter=3&t,i.magFilter=t>>2&3,i.mipFilter=t>>4&3,i.addressU=t>>6&3,i.addressV=t>>8&3,i.addressW=t>>10&3,i.maxAnisotropy=t>>12&31,i.cmpFunc=t>>17&7,i},e(i,[{key:"info",get:function(){return this.le}},{key:"hash",get:function(){return this.ve}}]),i}(Kd),Cg=function(t){function i(){var i;return(i=t.call(this,7)||this).de="",i.ge=[],i.jn=[],i.we=[],i.En=[],i}return s(i,t),e(i,[{key:"name",get:function(){return this.de}},{key:"attributes",get:function(){return this.jn}},{key:"blocks",get:function(){return this.we}},{key:"samplers",get:function(){return this.En}},{key:"stages",get:function(){return this.ge}}]),i}(Kd),Lg=function(t){function i(){var i;return(i=t.call(this,3)||this).le=new vd,i._e=new ld,i.me=!1,i.pe=!1,i.sn=0,i}return s(i,t),i.getLevelCount=function(t,i){return Math.floor(Math.log2(Math.max(t,i)))},e(i,[{key:"type",get:function(){return this.le.type}},{key:"usage",get:function(){return this.le.usage}},{key:"format",get:function(){return this.le.format}},{key:"width",get:function(){return this.le.width}},{key:"height",get:function(){return this.le.height}},{key:"depth",get:function(){return this.le.depth}},{key:"layerCount",get:function(){return this.le.layerCount}},{key:"levelCount",get:function(){return this.le.levelCount}},{key:"samples",get:function(){return this.le.samples}},{key:"flags",get:function(){return this.le.flags}},{key:"size",get:function(){return this.sn}},{key:"info",get:function(){return this.le}},{key:"viewInfo",get:function(){return this._e}},{key:"isTextureView",get:function(){return this.pe}}]),i}(Kd),Fg=function(t){function i(i,n){var e;return(e=t.call(this,16)||this).le=new Ld,e.ve=0,e.le.copy(i),e.ve=n,e}return s(i,t),i.computeHash=function(t){return Wv(t.prevAccesses+" "+t.nextAccesses+" "+t.type,666)},e(i,[{key:"info",get:function(){return this.le}},{key:"hash",get:function(){return this.ve}}]),i}(Kd),Pg=function(t){function i(i,n){var e;return(e=t.call(this,17)||this).le=new Fd,e.ve=0,e.le.copy(i),e.ve=n,e}return s(i,t),i.computeHash=function(t){var i=t.prevAccesses+" "+t.nextAccesses;return i+=t.type,i+=t.range.mipLevel,i+=t.range.levelCount,i+=t.range.firstSlice,i+=t.range.numSlices,i+=t.range.basePlane,i+=t.range.planeCount,i+=t.discardContents,i+=t.srcQueue?t.srcQueue.type:0,Wv(i+=t.dstQueue?t.dstQueue.type:0,666)},e(i,[{key:"info",get:function(){return this.le}},{key:"hash",get:function(){return this.ve}}]),i}(Kd),Bg=function(t){function i(i,n){var e;return(e=t.call(this,18)||this).le=new Pd,e.ve=0,e.le.copy(i),e.ve=n,e}return s(i,t),i.computeHash=function(t){var i=t.prevAccesses+" "+t.nextAccesses;return i+=t.type,i+=t.offset,i+=t.size,i+=t.discardContents,i+=t.srcQueue?t.srcQueue.type:0,Wv(i+=t.dstQueue?t.dstQueue.type:0,666)},e(i,[{key:"info",get:function(){return this.le}},{key:"hash",get:function(){return this.ve}}]),i}(Kd),Dg={Device:gg,Swapchain:_g,Buffer:lg,Texture:Lg,Sampler:Ng,Shader:Cg,InputAssembler:pg,RenderPass:Mg,Framebuffer:mg,DescriptorSet:yg,DescriptorSetLayout:bg,PipelineLayout:Ag,PipelineState:Rg,CommandBuffer:dg,Queue:Ig,GeneralBarrier:Fg,TextureBarrier:Pg,BufferBarrier:Bg,RasterizerState:Eg,BlendState:Sg,BlendTarget:Tg,DepthStencilState:kg,PipelineStateInfo:Og};Object.assign(Dg,vg),k.gfx=Dg;var Ug={GFXDevice:!0,GFXBuffer:!0,GFXTexture:!0,GFXSampler:!0,GFXShader:!0,GFXInputAssembler:!0,GFXRenderPass:!0,GFXFramebuffer:!0,GFXPipelineState:!0,GFXCommandBuffer:!0,GFXQueue:!0,GFXObjectType:!0,GFXObject:!1,GFXAttributeName:!0,GFXType:!0,GFXFormat:!0,GFXBufferUsageBit:!0,GFXMemoryUsageBit:!0,GFXBufferFlagBit:!0,GFXBufferAccessBit:"MemoryAccessBit",GFXPrimitiveMode:!0,GFXPolygonMode:!0,GFXShadeModel:!0,GFXCullMode:!0,GFXComparisonFunc:!0,GFXStencilOp:!0,GFXBlendOp:!0,GFXBlendFactor:!0,GFXColorMask:!0,GFXFilter:!0,GFXAddress:!0,GFXTextureType:!0,GFXTextureUsageBit:!0,GFXSampleCount:!0,GFXTextureFlagBit:!0,GFXShaderStageFlagBit:!0,GFXDescriptorType:!0,GFXCommandBufferType:!0,GFXLoadOp:!0,GFXStoreOp:!0,GFXPipelineBindPoint:!0,GFXDynamicStateFlagBit:!0,GFXStencilFace:!0,GFXQueueType:!0,GFXRect:!0,GFXViewport:!0,GFXColor:!0,GFXClearFlag:!0,GFXOffset:!0,GFXExtent:!0,GFXTextureSubres:"TextureSubresLayers",GFXTextureCopy:!0,GFXBufferTextureCopy:!0,GFXFormatType:!0,GFXFormatInfo:!0,GFXMemoryStatus:!0,GFXFormatInfos:!0,GFXFormatSize:!0,GFXFormatSurfaceSize:!0,GFXGetTypeSize:!0,getTypedArrayConstructor:!1};for(var xg in Ug){var Gg=Ug[xg];!0===Gg?Gg=xg.slice(3):!1===Gg&&(Gg=xg),dt(k,"cc",[{name:xg,newName:Gg,target:k.gfx,targetName:"cc.gfx"}])}gt(k,"cc",[{name:"GFX_MAX_VERTEX_ATTRIBUTES"},{name:"GFX_MAX_TEXTURE_UNITS"},{name:"GFX_MAX_ATTACHMENTS"},{name:"GFX_MAX_BUFFER_BINDINGS"},{name:"GFXTextureLayout"}]),gt(nl,"Feature",[{name:"COLOR_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.RENDER_TARGET;"},{name:"COLOR_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.RENDER_TARGET;"},{name:"TEXTURE_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R32F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R16F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"TEXTURE_HALF_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"FORMAT_R11G11B10F",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R11G11B10F) !== FormatFeatureBit.NONE;"},{name:"FORMAT_SRGB",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.SRGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC1",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC2",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC2_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_DXT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.BC1) !== FormatFeatureBit.NONE;"},{name:"FORMAT_PVRTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.PVRTC_RGB2) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ASTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ASTC_RGBA_4x4) !== FormatFeatureBit.NONE;"},{name:"FORMAT_RGB8",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.RGB8) !== FormatFeatureBit.NONE;"}]),gt(Od.prototype,"ColorAttachment",[{name:"beginAccesses",suggest:"Please assign to ColorAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to ColorAttachment.barrier instead"}]),gt(Rd.prototype,"DepthStencilAttachment",[{name:"beginAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"}]),dt(gg.prototype,"Device",[{name:"getGlobalBarrier",newName:"getGeneralBarrier"}]);var jg=function(){function t(){this.ye=!1,this.be=void 0,this.Ae=null,this.Ee=void 0,this.ke=-1,this.Te=!1}var i=t.prototype;return i.Se=function(t,i){var n=this;return this.Te?Promise.resolve(!0):t?(this.be=new t,new Promise((function(t,e){n.be.initialize(i).then((function(i){n.Te=i,t(i)})).catch((function(t){e(t)}))}))):Promise.resolve(!1)},i.Oe=function(t,i){return!!this.Te||(t&&(this.be=new t,this.Te=this.be.initialize(i)),this.Te)},i.init=function(t,i){var n=this;if(this.ye)return!0;var e=xi.querySettings(Di.Category.RENDERING,"renderMode");this.Ae=t,this.Ae&&(this.Ae.oncontextmenu=function(){return!1}),this.ke=this.Re(e),this.Te=!1;var r=new hd(i);if(1===this.ke||2===this.ke){var s=!!globalThis.WebGL2RenderingContext;if(globalThis.navigator.userAgent.toLowerCase(),ho.browserType===Ru.UC&&(s=!1),gg.Rn=t,2===this.ke&&k.WebGPUDevice)return new Promise((function(t,i){n.Se(k.WebGPUDevice,r).then((function(i){n.Ie(),t(i)})).catch((function(t){i(t)}))}));s&&k.WebGL2Device&&this.Oe(k.WebGL2Device,r),k.WebGLDevice&&this.Oe(k.WebGLDevice,r),k.EmptyDevice&&this.Oe(k.EmptyDevice,r),this.Ie()}else 4===this.ke&&k.EmptyDevice&&(this.Oe(k.EmptyDevice,r),this.Ie());return!!this.be||(ut(16337),this.ke=-1,!1)},i.Ie=function(){var t=new sd(1,this.Ae),i=so.windowSize;t.width=i.width,t.height=i.height,this.Ee=this.be.createSwapchain(t)},i.Me=function(){return"gpu"in globalThis.navigator},i.Re=function(t){("number"!=typeof t||t>4||t<0)&&(t=0);var i=0,n=!1;if(1===t?(i=0,n=!0):0===t||4===t?(i=this.Me()?2:1,n=!0):2===t?(i=1,n=!0):3===t&&(i=4,n=!0),!n)throw new Error(ft(3820,t));return i},e(t,[{key:"gfxDevice",get:function(){return this.be}},{key:"swapchain",get:function(){return this.Ee}}]),t}(),Hg=new jg;t("gfx",Object.freeze({__proto__:null,API:tl,AccessFlagBit:Rl,Address:pl,Attribute:kd,AttributeName:qd,BarrierType:Hl,BindingMappingInfo:rd,BlendFactor:Al,BlendOp:El,BlendState:Sg,BlendTarget:Tg,Buffer:lg,BufferBarrierInfo:Pd,BufferFlagBit:ol,BufferInfo:ud,BufferTextureCopy:td,BufferUsageBit:ul,BufferViewInfo:od,ClearFlagBit:jl,Color:nd,ColorAttachment:Od,ColorMask:kl,CommandBuffer:dg,CommandBufferInfo:Hd,CommandBufferType:Gl,ComparisonFunc:yl,CullMode:Fl,DESCRIPTOR_BUFFER_TYPE:ig,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:ng,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DefaultResource:wg,DepthStencilAttachment:Rd,DepthStencilState:kg,DescriptorSet:yg,DescriptorSetInfo:xd,DescriptorSetLayout:bg,DescriptorSetLayoutBinding:Dd,DescriptorSetLayoutInfo:Ud,DescriptorType:Dl,Device:gg,DeviceCaps:Wl,DeviceInfo:hd,DeviceManager:jg,DeviceOptions:zl,DispatchInfo:cd,DrawInfo:ad,DynamicStateFlagBit:Pl,DynamicStates:Yd,DynamicStencilStates:Xd,Extent:Kl,Feature:nl,Filter:ml,Format:el,FormatFeatureBit:gl,FormatInfo:Wd,FormatInfos:tg,FormatSize:sg,FormatSurfaceSize:hg,FormatType:rl,Framebuffer:mg,FramebufferInfo:Bd,GFXObject:Kd,GeneralBarrier:Fg,GeneralBarrierInfo:Ld,GetTypeSize:og,IndirectBuffer:fd,InputAssembler:pg,InputAssemblerInfo:Sd,InputState:jd,IsPowerOf2:eg,LegacyRenderMode:{AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGPU:4},LoadOp:Sl,MarkerInfo:ed,MemoryAccessBit:al,MemoryStatus:zd,MemoryUsageBit:cl,ObjectType:Zv,Offset:Xl,PassType:Vl,PipelineBindPoint:Ml,PipelineLayout:Ag,PipelineLayoutInfo:Gd,PipelineState:Rg,PipelineStateInfo:Og,PolygonMode:Cl,PrimitiveMode:Nl,QueryPoolInfo:$d,QueryType:xl,Queue:Ig,QueueInfo:Vd,QueueType:Ul,RasterizerState:Eg,Rect:Yl,RenderPass:Mg,RenderPassInfo:Nd,RenderType:{UNKNOWN:-1,CANVAS:0,WEBGL:1,WEBGPU:2,OPENGL:3,HEADLESS:4},ResolveMode:Il,ResourceRange:Cd,SampleCount:wl,SampleType:sl,Sampler:Ng,SamplerInfo:dd,ShadeModel:Ll,Shader:Cg,ShaderInfo:Td,ShaderStage:Ed,ShaderStageFlagBit:Tl,Size:$l,Status:Jv,StencilFace:Bl,StencilOp:bl,StoreOp:Ol,SubpassDependency:Md,SubpassInfo:Id,SurfaceTransform:il,Swapchain:_g,SwapchainInfo:sd,Texture:Lg,TextureBarrier:Pg,TextureBarrierInfo:Fd,TextureBlit:Jl,TextureCopy:Zl,TextureFlagBit:dl,TextureInfo:vd,TextureSubresLayers:ql,TextureSubresRange:Ql,TextureType:fl,TextureUsageBit:ll,TextureViewInfo:ld,Type:hl,Uniform:gd,UniformBlock:wd,UniformInputAttachment:Ad,UniformSampler:md,UniformSamplerTexture:_d,UniformStorageBuffer:bd,UniformStorageImage:yd,UniformTexture:pd,ViewDimension:vl,Viewport:id,VsyncMode:_l,alignTo:fg,deviceManager:Hg,formatAlignment:cg,getTypedArrayConstructor:ag}));var Vg=new De;function $g(t,i,n,e){var r=n.chunk,s=n.data,h=r.vb,u=n.vertexCount,o=t.worldMatrix,a=o.m00,c=o.m01,f=o.m02,v=o.m03,l=o.m04,d=o.m05,g=o.m06,w=o.m07,_=o.m12,m=o.m13,p=o.m14,y=o.m15;Vg.set(e.r/255,e.g/255,e.b/255,e.a/255);for(var b=0,A=0;A<u;++A){var E=s[A],k=E.x,T=E.y,S=v*k+w*T+y;S=S?1/S:1,h[b+0]=(a*k+l*T+_)*S,h[b+1]=(c*k+d*T+m)*S,h[b+2]=(f*k+g*T+p)*S,De.toArray(h,Vg,b+5),b+=n.floatStride}r.bufferId;for(var O=r.vertexOffset,R=r.meshBuffer,I=r.meshBuffer.iData,M=R.indexOffset,N=0,C=u/4;N<C;N++){var L=O+4*N;I[M++]=L,I[M++]=L+1,I[M++]=L+2,I[M++]=L+1,I[M++]=L+3,I[M++]=L+2}R.indexOffset+=n.indexCount,R.setDirty()}function Wg(t,i){for(var n,e,r,s=t.vertexFormat,h=t.chunk.vb,u=0,o=0;o<s.length;++o){if(n=s[o],(e=tg[n.format]).hasAlpha)if(r=t.floatStride,e.size/e.count==1)for(var a=~~Jn(Math.round(255*i),0,255),c=u;c<h.length;c+=r)h[c]=(4294967040&h[c]|a)>>>0;else if(e.size/e.count==4)for(var f=u+3;f<h.length;f+=r)h[f]=i;u+=e.size>>2}}var zg=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=jt(!0),this._count=0)}var i=t.prototype;return i.add=function(t,i){return t in this._map||this._count++,this._map[t]=i},i.get=function(t){return this._map[t]},i.has=function(t){return t in this._map},i.remove=function(t){var i=this._map[t];return t in this._map&&(delete this._map[t],this._count--),i},i.clear=function(){0!==this._count&&(this._map=jt(!0),this._count=0)},i.forEach=function(t){for(var i in this._map)t(this._map[i],i)},i.find=function(t){for(var i in this._map)if(t(this._map[i],i))return this._map[i];return null},i.destroy=function(){this._map=null},e(t,[{key:"map",get:function(){return this._map}},{key:"count",get:function(){return this._count}}]),t}(),Xg=function(){function t(i,n){this.id=t.Ne++,this.name="",this.pipes=[],this.name=i;for(var e=0,r=n.length;e<r;e++)this.pipes.push(n[e])}var i=t.prototype;return i.insert=function(t,i){return i>this.pipes.length?(st(4921),this):(this.pipes.splice(i,0,t),this)},i.append=function(t){return this.pipes.push(t),this},i.remove=function(t){return this.pipes.splice(t,1),this},i.sync=function(t){var i=this.pipes;if(0===i.length)return null;t.isFinished=!1;for(var n=0,e=i.length;n<e;){var r=(0,i[n])(t);if(r)return t.isFinished=!0,r;++n!==e&&(t.input=t.output,t.output=null)}return t.isFinished=!0,t.output},i.async=function(t){0!==this.pipes.length&&(t.isFinished=!1,this.Ce(0,t))},i.Ce=function(t,i){var n=this;(0,this.pipes[t])(i,(function(e){e?(i.isFinished=!0,i.dispatch("complete",e)):++t<n.pipes.length?(i.input=i.output,i.output=null,n.Ce(t,i)):(i.isFinished=!0,i.dispatch("complete",e,i.output))}))},t}();Xg.Ne=0;var Yg=new zg,Kg=new zg,qg=new zg,Qg=new zg,Zg=new Xg("normal load",[]),Jg=new Xg("fetch",[]),tw=new Xg("transform url",[]),iw=new Map,nw={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}},ew=function(){function t(i){this.id=t.Le++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinished=!0,this.set(i)}t.create=function(i){var n;return 0!==t.Fe.length?(n=t.Fe.pop()).set(i):n=new t(i),n};var i=t.prototype;return i.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},i.dispatch=function(t,i,n,e,r){switch(t){case"complete":this.onComplete&&this.onComplete(i,n);break;case"progress":this.onProgress&&this.onProgress(i,n,e,r);break;case"error":this.onError&&this.onError(i,n,e,r);break;default:var s="on"+t[0].toUpperCase()+t.substring(1);"function"==typeof this[s]&&this[s](i,n,e,r)}},i.recycle=function(){t.Fe.length!==t.Pe&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t.Fe.push(this))},e(t,[{key:"isFinish",get:function(){return this.isFinished},set:function(t){this.isFinished=t}}]),t}();ew.Pe=500,ew.Le=0,ew.Fe=[];var rw="0123456789abcdef".split(""),sw=["","","",""],hw=sw.concat(sw,"-",sw,"-",sw,"-",sw,"-",sw,sw,sw),uw=hw.map((function(t,i){return"-"===t?NaN:i})).filter(Number.isFinite);function ow(t){var i=t.split("@")[0];if(22!==i.length)return t;hw[0]=t[0],hw[1]=t[1];for(var n=2,e=2;n<22;n+=2){var r=zi[t.charCodeAt(n)],s=zi[t.charCodeAt(n+1)];hw[uw[e++]]=rw[r>>2],hw[uw[e++]]=rw[(3&r)<<2|s>>4],hw[uw[e++]]=rw[15&s]}return t.replace(i,hw.join(""))}var aw=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function cw(t){var i=aw.exec(t);return i?i[1]:""}function fw(t,i){(i=i||Object.create(null)).__isNative__=i.isNative,i.nativeExt&&(i.ext=i.nativeExt);var n=Qg.find((function(i){return!!i.getAssetInfo(t)}));return n&&(i.bundle=n.name),dw(t,i)}function vw(t){return!!t&&(t instanceof k.SceneAsset||t instanceof k.Scene)}function lw(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function dw(t,i){var n=ew.create({input:t,options:i}),e=[];try{for(var r,s=d(tw.sync(n));!(r=s()).done;){var h=r.value,u=h.url;h.recycle(),e.push(u)}}catch(t){for(var o,a=d(n.output);!(o=a()).done;)o.value.recycle();Y(t.message,t.stack)}return n.recycle(),e.length>1?e:e[0]}var gw,ww,_w,mw,pw,yw,bw=Object.freeze({__proto__:null,decodeUuid:ow,getUrlWithUuid:fw,getUuidFromURL:cw,isScene:vw,normalize:lw,transform:dw}),Aw=oa,Ew=Jo,kw=t("Asset",Ko("cc.Asset")((ww=function(t){function i(i){var n;return(n=t.call(this,i)||this).loaded=!0,n._native=_w&&_w(),n._nativeUrl="",n.Be=null,n.De=0,Object.defineProperty(f(n),"_uuid",{value:"",writable:!0}),n}s(i,t),i.deserialize=function(t){return k.deserialize(t)};var n=i.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(t,i){void 0===i&&(i=!0),this._native=!1!==i?t||"":"/"+t},n.addRef=function(){return this.De++,this},n.decRef=function(t){return void 0===t&&(t=!0),this.De>0&&this.De--,t&&k.assetManager.getReleaseManager().tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},n.validate=function(){return!0},n.destroy=function(){return q(ft(12101,this._uuid)),t.prototype.destroy.call(this)},e(i,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=fw(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=fw(this._uuid,{__nativeName__:t,nativeExt:ju(t),isNative:!0})}return this._nativeUrl}},{key:"uuid",get:function(){return this._uuid}},{key:"_nativeAsset",get:function(){return this.Be},set:function(t){this.Be=t}},{key:"nativeAsset",get:function(){return this.Be}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this.De}}]),i}(Su(du)),_w=xo(ww.prototype,"_native",[Aw],(function(){return""})),m(ww.prototype,"_nativeAsset",[Ew],Object.getOwnPropertyDescriptor(ww.prototype,"_nativeAsset"),ww.prototype),gw=ww))||gw);kw.prototype.createNode=null,k.Asset=kw;var Tw=1346981187,Sw=Ni({PVR:0,PKM:1,ASTC:2});function Ow(t,i){return 4===t?89:5===t?4===i?90:91:6===t?5===i?92:93:8===t?5===i?94:6===i?95:96:10===t?5===i?97:6===i?98:8===i?99:100:10===i?101:102}function Rw(t,i){return t[i]<<8|t[i+1]}function Iw(t){return!!(ho.hasFeature(ho.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}var Mw,Nw,Cw,Lw,Fw,Pw,Bw,Dw,Uw,xw,Gw,jw=t("ImageAsset",Ko("cc.ImageAsset")((yw=function(t){s(n,t),n.mergeCompressedTextureMips=function(t){var i=new Uint8Array(0);try{for(var n,e=8+4*t.length,r=0,s=d(t);!(n=s()).done;)r+=n.value.byteLength;r+=e,i=new Uint8Array(r);var h=new DataView(i.buffer,i.byteOffset,i.byteLength);h.setUint32(0,Tw,!0),h.setUint32(4,t.length,!0);for(var u=e,o=0;o<t.length;o++){var a=t[o];if(h.setUint32(8+4*o,a.byteLength,!0),a instanceof ArrayBuffer){var c=new Uint8Array(a);i.set(c,u)}else{var f=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);i.set(f,u)}u+=a.byteLength}}catch(t){X(t)}return i},n.Ue=function(t,i){var e={_data:new Uint8Array(0),_compressed:!0,width:0,height:0,format:0,mipmapLevelDataSize:[]},r=t instanceof ArrayBuffer?t:t.buffer,s=new DataView(r);if(s.getUint32(0,!0)===Tw){var h=s.getUint32(4,!0),u=s.getUint32(8,!0),o=8+4*h;n.xe(t,0,o,u,i,e);for(var a=o+u,c=1;c<h;c++){var f=s.getUint32(8+4*c,!0);n.xe(t,c,a,f,i,e),a+=f}}else n.xe(t,0,0,0,i,e);return e},n.xe=function(t,i,e,r,s,h){switch(s){case Sw.PVR:n.Ge(t,i,e,r,h);break;case Sw.PKM:n.je(t,i,e,r,h);break;case Sw.ASTC:n.He(t,i,e,r,h)}},n.Ge=function(t,i,n,e,r){var s=t instanceof ArrayBuffer?t:t.buffer,h=new Int32Array(s,n,13);if(55727696===h[0]){var u=n+h[12]+52,o=e-h.byteLength;if(e>0){var a=new Uint8Array(s,u,o),c=new Uint8Array(r._data.byteLength+a.byteLength);c.set(r._data),c.set(a,r._data.byteLength),r._data=c,r.mipmapLevelDataSize[i]=o}else r._data=new Uint8Array(s,u);r.width=i>0?r.width:h[7],r.height=i>0?r.height:h[6]}else{if(559044176!==h[11])throw new Error("Invalid magic number in PVR header");var f=n+h[0],v=e-h.byteLength;if(e>0){var l=new Uint8Array(s,f,v),d=new Uint8Array(r._data.byteLength+l.byteLength);d.set(r._data),d.set(l,r._data.byteLength),r._data=d,r.mipmapLevelDataSize[i]=v}else r._data=new Uint8Array(s,f);r.width=i>0?r.width:h[1],r.height=i>0?r.height:h[2]}},n.je=function(t,i,n,e,r){var s=t instanceof ArrayBuffer?t:t.buffer,h=new Uint8Array(s,n,16),u=Rw(h,6);if(0!==u&&1!==u&&3!==u)throw new Error("Invalid magic number in ETC header");var o=n+16,a=e-16;if(e>0){var c=new Uint8Array(s,o,a),f=new Uint8Array(r._data.byteLength+c.byteLength);f.set(r._data),f.set(c,r._data.byteLength),r._data=f,r.mipmapLevelDataSize[i]=a}else r._data=new Uint8Array(s,o);r.width=i>0?r.width:Rw(h,12),r.height=i>0?r.height:Rw(h,14)},n.He=function(t,i,n,e,r){var s=t instanceof ArrayBuffer?t:t.buffer,h=new Uint8Array(s,n,16);if(1554098963!==h[0]+(h[1]<<8)+(h[2]<<16)+(h[3]<<24))throw new Error("Invalid magic number in ASTC header");var u=h[4],o=h[5],a=h[6];if((u<3||u>6||o<3||o>6||a<3||a>6)&&(u<4||7===u||9===u||11===u||u>12||o<4||7===o||9===o||11===o||o>12||1!==a))throw new Error("Invalid block number in ASTC header");var c=Ow(u,o),f=n+16,v=e-16;if(e>0){var l=new Uint8Array(s,f,v),d=new Uint8Array(r._data.byteLength+l.byteLength);d.set(r._data),d.set(l,r._data.byteLength),r._data=d,r.mipmapLevelDataSize[i]=v}else r._data=new Uint8Array(s,f);r.width=i>0?r.width:h[7]+(h[8]<<8)+(h[9]<<16),r.height=i>0?r.height:h[10]+(h[11]<<8)+(h[12]<<16),r.format=c};var i=n.prototype;function n(i){var n;return(n=t.call(this)||this).Ve=void 0,n.$e=void 0,n.We=35,n.xn=0,n.Gn=0,n.Ve={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==i&&n.reset(i),n}return i.ze=function(){if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0){var t=this.mipmapLevelDataSize[0],i=this.data,e=new n({_data:new Uint8Array(i.buffer,0,t),_compressed:!0,width:this.width,height:this.height,format:this.format,mipmapLevelDataSize:[]});return e._uuid=""+this._uuid,e}return this},i.Xe=function(){var t=[];if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0)for(var i,e=this.mipmapLevelDataSize,r=this.data,s=0,h=this.height,u=this.width,o=d(e);!(i=o()).done;){var a=i.value,c=new n({_data:new Uint8Array(r.buffer,s,a),_compressed:!0,width:u,height:h,format:this.format,mipmapLevelDataSize:[]});s+=a,c._uuid=""+this._uuid,u=Math.max(u>>1,1),h=Math.max(h>>1,1),t.push(c)}else t.push(this);return t},i.reset=function(t){Iw(t)||t instanceof HTMLElement?this.Ve=t:(this.Ve=t,this.We=t.format)},i.destroy=function(){if(this.data&&this.data instanceof HTMLImageElement)this.data.src="",this._setRawAsset("");else if(Iw(this.data)){var i;null==(i=this.data)||i.close()}return t.prototype.destroy.call(this)},i._serialize=function(){},i._deserialize=function(t){var i="";"string"==typeof t?i=t:(this.xn=t.w,this.Gn=t.h,i=t.fmt);for(var e,r=Hg.gfxDevice,s=i.split("_"),h=Number.MAX_VALUE,u=this.We,o="",a=Gi.SUPPORT_TEXTURE_FORMATS,c=d(s);!(e=c()).done;){var f=e.value.split("@"),v=parseInt(f[0],void 0),l=n.Ye[v]||f[0],g=a.indexOf(l);if(-1!==g&&g<h){var w=f[1]?parseInt(f[1]):this.We;if(!(".astc"!==l||r&&2&r.getFormatFeatures(89)))continue;if(!(".pvr"!==l||r&&2&r.getFormatFeatures(86)))continue;if(!(72!==w&&1026!==w||r&&2&r.getFormatFeatures(72)))continue;if(!(73!==w&&77!==w||r&&2&r.getFormatFeatures(73)))continue;if(".webp"===l&&!ho.hasFeature(ho.Feature.WEBP))continue;h=g,o=l,u=w}}o?(this._setRawAsset(o),this.We=u):st(3121)},i.initDefault=function(i){if(t.prototype.initDefault.call(this,i),n.Ke)this.reset(n.Ke);else{var e=O.document.createElement("canvas"),r=e.getContext("2d"),s=e.width=e.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,s,s),this.reset(e),n.Ke=e}},i.validate=function(){return!!this.data},e(n,[{key:"_nativeAsset",get:function(){return this.Ve},set:function(t){t instanceof HTMLElement||Iw(t)||(t.format=t.format||this.We),this.reset(t)}},{key:"data",get:function(){return(t=this.Ve)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Iw(t)?this.Ve:this.Ve&&this.Ve._data;var t}},{key:"width",get:function(){return this.Ve.width||this.xn}},{key:"height",get:function(){return this.Ve.height||this.Gn}},{key:"format",get:function(){return this.We}},{key:"isCompressed",get:function(){return this.We>=72&&this.We<=102||this.We>=1024&&this.We<=1026}},{key:"mipmapLevelDataSize",get:function(){return this.Ve.mipmapLevelDataSize}},{key:"url",get:function(){return this.nativeUrl}}]),n}(kw),yw.Ye=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],yw.Ke=null,m((pw=yw).prototype,"_nativeAsset",[ja],Object.getOwnPropertyDescriptor(pw.prototype,"_nativeAsset"),pw.prototype),mw=pw))||mw);k.ImageAsset=jw,Fi(el);var Hw,Vw,$w,Ww=new Rt("Tex"),zw=Ko("cc.TextureBase")((Gw=function(t){function i(i){var n;return(n=t.call(this,i)||this)._format=Cw&&Cw(),n._minFilter=Lw&&Lw(),n._magFilter=Fw&&Fw(),n._mipFilter=Pw&&Pw(),n._wrapS=Bw&&Bw(),n._wrapT=Dw&&Dw(),n._wrapR=Uw&&Uw(),n._anisotropy=xw&&xw(),n.xn=1,n.Gn=1,n.qe=new dd,n.Qe=null,n.be=null,n.Ze=0,n.Je=Ww.getNewId(),n.be=n._getGFXDevice(),n.Ze=Wv(n.Je,666),n}s(i,t);var n=i.prototype;return n.getId=function(){return this.Je},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(t,i,n){void 0===n&&(n=t),this._wrapS=t,this.qe.addressU=t,this._wrapT=i,this.qe.addressV=i,this._wrapR=n,this.qe.addressW=n,this.be&&(this.Qe=this.be.getSampler(this.qe))},n.setFilters=function(t,i){this._minFilter=t,this.qe.minFilter=t,this._magFilter=i,this.qe.magFilter=i,this.be&&(this.Qe=this.be.getSampler(this.qe))},n.setMipFilter=function(t){this._mipFilter=t,this.qe.mipFilter=t,this.be&&(this.Qe=this.be.getSampler(this.qe))},n.setAnisotropy=function(t){t=Math.min(t,16),this._anisotropy=t,this.qe.maxAnisotropy=t,this.be&&(this.Qe=this.be.getSampler(this.qe))},n.destroy=function(){var i,n=t.prototype.destroy.call(this);return n&&null!=(i=k.director.root)&&i.batcher2D&&k.director.root.batcher2D.tr(this.Ze),n},n.getHash=function(){return this.Ze},n.getGFXTexture=function(){return null},n.getSamplerInfo=function(){return this.qe},n.getGFXSampler=function(){return this.Qe||(this.be?this.Qe=this.be.getSampler(this.qe):ut(9302)),this.Qe},n._serialize=function(){return""},n._deserialize=function(t){var i=t.split(",");i.unshift(""),i.length>=5&&(this.setFilters(parseInt(i[1]),parseInt(i[2])),this.setWrapMode(parseInt(i[3]),parseInt(i[4]))),i.length>=7&&(this.setMipFilter(parseInt(i[5])),this.setAnisotropy(parseInt(i[6])))},n._getGFXDevice=function(){return Hg.gfxDevice},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(t){this._format=void 0===t?35:t},n._getGFXPixelFormat=function(t){return 1026===t?t=72:1025===t?t=85:1024===t&&(t=83),t},e(i,[{key:"isCompressed",get:function(){return this._format>=72&&this._format<=102||this._format>=1024&&this._format<=1026}},{key:"width",get:function(){return this.xn}},{key:"height",get:function(){return this.Gn}}]),i}(kw),Gw.PixelFormat={RGB565:47,RGB5A1:49,RGBA4444:50,RGB888:24,RGB32F:32,RGBA8888:35,BGRA8888:36,RGBA32F:44,A8:1,I8:2,AI8:3,RGB_PVRTC_2BPPV1:83,RGBA_PVRTC_2BPPV1:84,RGB_A_PVRTC_2BPPV1:1024,RGB_PVRTC_4BPPV1:85,RGBA_PVRTC_4BPPV1:86,RGB_A_PVRTC_4BPPV1:1025,RGB_ETC1:72,RGBA_ETC1:1026,RGB_ETC2:73,RGBA_ETC2:77,RGBA_ASTC_4x4:89,RGBA_ASTC_5x4:90,RGBA_ASTC_5x5:91,RGBA_ASTC_6x5:92,RGBA_ASTC_6x6:93,RGBA_ASTC_8x5:94,RGBA_ASTC_8x6:95,RGBA_ASTC_8x8:96,RGBA_ASTC_10x5:97,RGBA_ASTC_10x6:98,RGBA_ASTC_10x8:99,RGBA_ASTC_10x10:100,RGBA_ASTC_12x10:101,RGBA_ASTC_12x12:102},Gw.WrapMode={REPEAT:0,CLAMP_TO_EDGE:2,MIRRORED_REPEAT:1,CLAMP_TO_BORDER:3},Gw.Filter={NONE:0,LINEAR:2,NEAREST:1},Cw=xo((Nw=Gw).prototype,"_format",[oa],(function(){return 35})),Lw=xo(Nw.prototype,"_minFilter",[oa],(function(){return 2})),Fw=xo(Nw.prototype,"_magFilter",[oa],(function(){return 2})),Pw=xo(Nw.prototype,"_mipFilter",[oa],(function(){return 0})),Bw=xo(Nw.prototype,"_wrapS",[oa],(function(){return 0})),Dw=xo(Nw.prototype,"_wrapT",[oa],(function(){return 0})),Uw=xo(Nw.prototype,"_wrapR",[oa],(function(){return 0})),xw=xo(Nw.prototype,"_anisotropy",[oa],(function(){return 0})),Mw=Nw))||Mw;k.TextureBase=zw;var Xw=t("Script",Ko("cc.Script")(Hw=function(t){function i(i){return t.call(this,i)||this}return s(i,t),i}(kw))||Hw);k._Script=Xw;var Yw=t("JavaScript",Ko("cc.JavaScript")(Vw=function(t){function i(i){return t.call(this,i)||this}return s(i,t),i}(Xw))||Vw);k._JavaScript=Yw;var Kw,qw,Qw,Zw,Jw,t_,i_,n_=t("TypeScript",Ko("cc.TypeScript")($w=function(t){function i(i){return t.call(this,i)||this}return s(i,t),i}(Xw))||$w);k._TypeScript=n_;var e_,r_,s_,h_,u_,o_,a_,c_,f_,v_,l_,d_=t("EventHandler",Ko("cc.ClickEvent")((qw=function(){function t(){this.target=Qw&&Qw(),this.component=Zw&&Zw(),this._componentId=Jw&&Jw(),this.handler=t_&&t_(),this.customEventData=i_&&i_()}t.emitEvents=function(i){for(var n=arguments.length,e=new Array(n>1?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];for(var s=0,h=i.length;s<h;s++){var u=i[s];u instanceof t&&u.emit(e)}};var i=t.prototype;return i.emit=function(t){var i=this.target;if(T.isValid(i)){this.ir();var n=T.js.getClassById(this._componentId),e=i.getComponent(n);if(T.isValid(e)){var r=e[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),r.apply(e,t))}}},i.nr=function(t){var i=T.js.getClassByName(t);return T.js.getClassId(i)},i.er=function(t){var i=T.js.getClassById(t);return T.js.getClassName(i)},i.ir=function(){this._componentId||(this._componentName=this.component,this.component="")},e(t,[{key:"_componentName",get:function(){return this.ir(),this.er(this._componentId)},set:function(t){this._componentId=this.nr(t)}}]),t}(),Qw=xo(qw.prototype,"target",[oa],(function(){return null})),Zw=xo(qw.prototype,"component",[oa],(function(){return""})),Jw=xo(qw.prototype,"_componentId",[oa],(function(){return""})),t_=xo(qw.prototype,"handler",[oa],(function(){return""})),i_=xo(qw.prototype,"customEventData",[oa],(function(){return""})),Kw=qw))||Kw),g_=new Rt("Comp"),w_=t("Component",(e_=Ko("cc.Component"),r_=Ca(Xw),e_((c_=function(t){function i(){var i;return(i=t.call(this)||this).node=u_&&u_(),i._enabled=o_&&o_(),i.__prefab=a_&&a_(),i._sceneGetter=null,i._id=g_.getNewId(),i}s(i,t);var n=i.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},n.addComponent=function(t){return this.node.addComponent(t)},n.getComponent=function(t){return this.node.getComponent(t)},n.getComponents=function(t){return this.node.getComponents(t)},n.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},n.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},n.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&T.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),T.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(t){return t||(t=T.instantiate._clone(this,this)),t&&(t.node=null),t},n.schedule=function(t,i,n,e){void 0===i&&(i=0),void 0===n&&(n=T.macro.REPEAT_FOREVER),void 0===e&&(e=0),at(Boolean(t),1619),at((i=i||0)>=0,1620),n=Number.isNaN(n)?T.macro.REPEAT_FOREVER:n,e=e||0;var r=T.director.getScheduler(),s=r.isTargetPaused(this);r.schedule(t,this,i,n,e,s)},n.scheduleOnce=function(t,i){void 0===i&&(i=0),this.schedule(t,0,0,i)},n.unschedule=function(t){t&&T.director.getScheduler().unschedule(t,this)},n.unscheduleAllCallbacks=function(){T.director.getScheduler().unscheduleAllForTarget(this)},e(i,[{key:"name",get:function(){if(this._name)return this._name;var t=Ht(this),i=t.lastIndexOf(".");return i>=0&&(t=t.slice(i+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var i=T.director._compScheduler;t?i.enableComp(this):i.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return 16384&this._objFlags}},{key:"internalUpdate",get:function(){return this.update}},{key:"internalLateUpdate",get:function(){return this.lateUpdate}},{key:"internalPreload",get:function(){return this.__preload}},{key:"internalOnLoad",get:function(){return this.onLoad}},{key:"internalStart",get:function(){return this.start}},{key:"internalOnEnable",get:function(){return this.onEnable}},{key:"internalOnDisable",get:function(){return this.onDisable}},{key:"internalOnDestroy",get:function(){return this.onDestroy}}]),i}(du),c_.EventHandler=d_,c_._executionOrder=0,c_._requireComponent=null,c_.system=null,m((h_=c_).prototype,"__scriptAsset",[r_],Object.getOwnPropertyDescriptor(h_.prototype,"__scriptAsset"),h_.prototype),u_=xo(h_.prototype,"node",[oa],(function(){return null})),o_=xo(h_.prototype,"_enabled",[oa],(function(){return!0})),a_=xo(h_.prototype,"__prefab",[oa],(function(){return null})),s_=h_))||s_));Dt(w_,"_registerEditorProps",(function(t,i){var n=i.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var e=i.executionOrder;e&&"number"==typeof e&&(t._executionOrder=e)})),T.Component=w_;var __=t("MissingScript",Ko("cc.MissingScript")((v_=function(t){function i(){var i;return(i=t.call(this)||this)._$erialized=l_&&l_(),i}return s(i,t),i.safeFindClass=function(t){var i=vi(t);if(i)return i;k.deserialize.reportMissingClass(t)},i.prototype.onLoad=function(){st(4600,this.node.name)},i}(w_),l_=xo(v_.prototype,"_$erialized",[oa,ca],(function(){return null})),f_=v_))||f_);k._MissingScript=__;try{var m_=__.__values__;0!==m_.length&&"_$erialized"===m_[m_.length-1]||(ut(16338),ut(16339,m_.join(", ")))}catch(Ns){ut(16340,""+Ns)}var p_=function(){function t(t,i){this.rr=t,this.sr=i}return e(t,[{key:"document",get:function(){return this.rr}},{key:"chunks",get:function(){return this.sr}}]),t}();function y_(t){var i=t;return{chunks:i.chunks,document:i.document}}function b_(t){if(t.length<16)throw new E_(ft(13102));var i=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==i.getUint32(0,!0))throw new E_(ft(13100));var n=i.getUint32(4,!0);if(1!==n)throw new E_(ft(13101,n));if(i.getUint32(8,!0)!==i.byteLength)throw new E_(ft(13102));var e=12,r=i.getUint32(e,!0);e+=4;var s=new Uint8Array(i.buffer,e+i.byteOffset,r);e+=r;var h,u=A_(s);try{h=JSON.parse(u)}catch(t){throw new E_(t)}for(var o=[];e<i.byteLength;){e%8!=0&&(e+=8-e%8);var a=i.getUint32(e,!0);e+=4,o.push(new Uint8Array(i.buffer,e+i.byteOffset,a)),e+=a}if(e!==i.byteLength)throw new E_(ft(13102));return new p_(h,o)}function A_(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(ft(13104))}var E_=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(c(Error));function k_(t,i,n,e,r){if(i instanceof k.ValueType){r||t.push("if(prop){");var s=Ht(i);t.push("s._deserializeFastDefinedObject(o"+n+",prop,"+s+");"),r||t.push("}else o"+n+"=null;")}else t.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+e+");\n} else {\n    o"+n+"=null;\n}\n")}!function(){function t(){this.hr=[],this.ur=0}var i=t.prototype;i.alignAs=function(t){if(0!==t){var i=this.ur%t;if(0!==i){var n=t-i;return this.hr.push(n),this.ur+=n,n}}return 0},i.append=function(t){var i=this.ur;return this.hr.push(t),this.ur+=t.byteLength,i},i.get=function(){var t=new Uint8Array(this.ur),i=0;return this.hr.forEach((function(n){"number"==typeof n?i+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i),i+=n.byteLength)})),t},e(t,[{key:"byteLength",get:function(){return this.ur}}])}(),k.internal.parseCCONJson=y_,k.internal.decodeCCONBinary=b_,k.internal.CCON=p_;var T_=function(t,i){for(var n=Un.Attr.getClassAttrs(i),e=i.__values__,r=["var prop;"],s=M_(i),h=0;h<e.length;h++){var u=e[h],o=void 0,a=void 0;Un.IDENTIFIER_RE.test(u)?(a='"'+u+'"',o="."+u):o="["+(a=Un.escapeForJS(u))+"]";var c=o;if(n[u+I_]){var f=n[u+I_];c=Un.IDENTIFIER_RE.test(f)?"."+f:"["+Un.escapeForJS(f)+"]"}r.push("prop=d"+c+";"),r.push('if(typeof prop!=="undefined"){');var v=Un.getDefault(n[u+R_]),l=n[u+O_];s&&(void 0!==v||l)?N_(v,l)?r.push("o"+o+"=prop;"):k_(r,v,o,a,!0):(r.push('if(typeof prop!=="object"){o'+o+"=prop;}else{"),k_(r,v,o,a,!1),r.push("}")),r.push("}")}return(ii(i,k.Node)||ii(i,k.Component))&&r.push("d._id&&(o._id=d._id);"),"_$erialized"===e[e.length-1]&&(r.push("o._$erialized=JSON.parse(JSON.stringify(d));"),r.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",r.join(""))},S_=Un.Attr.DELIMETER,O_=S_+"type",R_=S_+"default",I_=S_+"formerlySerializedAs";function M_(t){return Hi.test(gi(t))}function N_(t,i){if(void 0===t)return i instanceof Un.Attr.PrimitiveType||i===Rn||i===In;var n=typeof t;return"string"===n||"number"===n||"boolean"===n}var C_=function(t){function i(){return t.call(this,(function(t){t.clear()}),1)||this}return s(i,t),i}(wi);C_.prototype.get=function(t,i,n,e,r){var s=this._get();return s?(s.reset(t,i,n,e,r),s):new L_(t,i,n,e,r)};var L_=function(){function t(t,i,n,e){this.deserializedList=[],this.deserializedData=null,this.result=t,this.customEnv=e,this.ar=i,this.cr=n,this.vr=null==i?void 0:i.onDereferenced}var i=t.prototype;return i.reset=function(t,i,n,e){this.result=t,this.customEnv=e,this.ar=i,this.cr=n,this.vr=null==i?void 0:i.onDereferenced},i.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this.ar=null,this.cr=null,this.vr=null},i.deserialize=function(t){var i,n=!1;t instanceof p_?(n=!0,i=t.document,t.chunks.length>0&&(t.chunks.length,this.lr=t.chunks[0])):i=t,this.dr=i,this.gr={fromCCON:n};var e=Array.isArray(i)?i[0]:i;return this.deserializedData=this.wr(e,0),this.dr=void 0,this.lr=void 0,this.gr=void 0,this.deserializedData},i.wr=function(t,i,n,e){switch(t.__type__){case"TypedArray":return this._r(t);case"TypedArrayRef":return this.mr(t);default:return t.__type__?this.pr(t,i,n,e):Array.isArray(t)?this.yr(t):this.br(t)}},i._r=function(t){return globalThis[t.ctor].from(t.array)},i.mr=function(t){var i=t.offset,n=t.length,e=t.ctor;return new globalThis[e](this.lr.buffer,this.lr.byteOffset+i,n)},i.yr=function(t){for(var i,n=new Array(t.length),e=0;e<t.length;e++)"object"==typeof(i=t[e])&&i?this._deserializeAndAssignField(n,i,""+e)&&(n[e]=null):n[e]=i;return n},i.br=function(t){var i={};return this._fillPlainObject(i,t),i},i.pr=function(t,i,n,e){var r=this,s=t.__type__,h=this.ar(s,t,n,e);if(!h)return this.ar===vi&&this.cr(s),null;var u=function(t){var n=new t;return i>=0&&(r.deserializedList[i]=n),n}(h);return this.Ar(t,u,h),u},i.Ar=function(t,i,n,e){void 0===e&&(e=!1),e||!i[Ka]?i._deserialize?i._deserialize(t.content,this):k.Class._isCCClass(n)?this.Er(i,t,n):this._deserializeFastDefinedObject(i,t,n):this.kr(t,i,n)},i.kr=function(t,i,n){var e=this,r={readProperty:function(i){var n=t[i];return"object"==typeof n&&n?e.Tr(n):n},readThis:function(){e.Ar(t,i,n,!0)},readSuper:function(){var r=ti(n);r&&e.Ar(t,i,r)}};i[Ka](r,this.gr)},i.Er=function(t,i,n){var e;if(n.hasOwnProperty("__deserialize__"))e=n.__deserialize__;else{e=T_(0,n);try{if(n===__){var r=n.__values__;0!==r.length&&"_$erialized"===r[r.length-1]||(ut(16341),ut(16342,r.join(", ")));var s=e;e=function(t,i,n,e){s(t,i,n,e),i._$erialized||ut(16343,JSON.stringify(n))}}}catch(t){ut(16344,""+t)}Dt(n,"__deserialize__",e,!0)}e(this,t,i,n)},i._deserializeAndAssignField=function(t,i,n){var e=i.__id__;if("number"==typeof e){var r=this.deserializedList[e];if(r)t[n]=r;else{var s,h=this.dr[e];t[n]=this.wr(h,e,void 0,n),null==(s=this.vr)||s.call(this,this.deserializedList,e,t,n)}}else{var u=i.__uuid__;if(u){var o=i.__expectedType__;this.result.push(t,n,u,o)}else t[n]=this.wr(i,-1)}return!1},i.Tr=function(t){var i=t.__id__;if("number"==typeof i){var n=this.deserializedList[i];if(n)return n;var e=this.dr[i];return this.wr(e,i,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this.wr(t,-1)},i._fillPlainObject=function(t,i){for(var n in i)if(i.hasOwnProperty(n)){var e=i[n];"object"!=typeof e?"__type__"!==n&&(t[n]=e):e?this._deserializeAndAssignField(t,e,n)&&(t[n]=null):t[n]=null}},i._deserializeFastDefinedObject=function(t,i,n){if(n===k.Vec2)return t.x=i.x||0,void(t.y=i.y||0);if(n===k.Vec3)return t.x=i.x||0,t.y=i.y||0,void(t.z=i.z||0);if(n!==k.Color){if(n===k.Size)return t.width=i.width||0,void(t.height=i.height||0);for(var e=Un.Attr.getClassAttrs(n),r=n.__values__,s=0;s<r.length;s++){var h=r[s],u=i[h];void 0!==u||i.hasOwnProperty(h)||(u=Un.getDefault(e[h+R_])),"object"!=typeof u?t[h]=u:u?this._deserializeAndAssignField(t,u,h):t[h]=null}}else{t.r=i.r||0,t.g=i.g||0,t.b=i.b||0;var o=i.a;t.a=void 0===o?255:o}},e(t,[{key:"ignoreEditorOnly",get:function(){return this.Sr}}]),t}();function F_(t,i,n){var e,r=(n=n||{}).classFinder||vi,s=n.createAssetRefs||ho.platform===Cu.EDITOR_CORE,h=n.customEnv,u=n.ignoreEditorOnly,o=null!==(e=n.reportMissingClass)&&void 0!==e?e:k.deserialize.reportMissingClass;i.init();var a=L_.pool.get(i,r,o,h,u);k.game._isCloning=!0;var c=a.deserialize(t);return k.game._isCloning=!1,L_.pool.put(a),s&&i.assignAssetsBy((function(t,i){return EditorExtends.serialize.asAsset(t,i.type)})),c}L_.pool=new C_;var P_=[ls,ir,De,Cr,cr,gs,ps,Kr];function B_(t,i){t.x=i[1],t.y=i[2],t.z=i[3],t.w=i[4]}var D_=[function(t,i){t.x=i[1],t.y=i[2]},function(t,i){t.x=i[1],t.y=i[2],t.z=i[3]},B_,B_,function(t,i){cr.fromUint32(t,i[1])},function(t,i){t.width=i[1],t.height=i[2]},function(t,i){t.x=i[1],t.y=i[2],t.width=i[3],t.height=i[4]},function(t,i){Kr.fromArray(t,i,1)}],U_=1,x_=0,G_=0,j_=1,H_=2,V_=0,$_=0,W_=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var i=t.prototype;return i.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},i.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},i.push=function(t,i,n,e){this.uuidObjList.push(t),this.uuidPropList.push(i),this.uuidList.push(n),this.uuidTypeList.push(e||"")},t}());function z_(t,i,n){for(var e=t.length-1,r=0,s=3*t[e];r<s;r+=3){var h=t[r],u=i[t[r+2]],o=t[r+1];o>=0?h[n[o]]=u:h[~o]=u}for(;r<e;r+=3){var a=i[t[r]],c=i[t[r+2]],f=t[r+1];f>=0?a[n[f]]=c:a[~f]=c}}function X_(t,i){for(var n=t[4][i[$_]],e=n[V_],r=new(0,e[G_]),s=e[j_],h=e[H_],u=n[n.length-1],o=V_+1;o<u;++o)r[s[n[o]]]=i[o];for(;o<i.length;++o){var a=s[n[o]],c=e[n[o]+h];(0,J_[c])(t,r,a,i[o])}return r}function Y_(t,i,n){var e=new i;return e._deserialize?e._deserialize(n,t[0]):ut(5303,Ht(i)),e}function K_(t,i,n,e){e>=0?i[n]=t[5][e]:t[7][3*~e]=i}function q_(t){return function(i,n,e,r){for(var s=0;s<r.length;++s)t(i,r,s,r[s]);n[e]=r}}function Q_(t,i,n,e){i[n]=null,t[8][e]=i}function Z_(t,i,n,e){i[n]=X_(t,e)}W_.pool=new wi((function(t){t.reset()}),5),W_.pool.get=function(){return this._get()||new W_};var J_=new Array(13);function tm(t){var i=t[5],n=t[6],e=n===x_?0:n.length,r=i[i.length-1],s=i.length-e;"number"!=typeof r?r=0:(r<0&&(r=~r),--s);for(var h=0;h<s;++h)i[h]=X_(t,i[h]);for(var u=t[3],o=0;o<e;++o,++h){var a=n[o],c=i[h];if(a>=0){var f=u[a];i[h]=Y_(t,f,c)}else(0,J_[a=~a])(t,i,h,c)}return r}function im(t,i,n){return t||n(i),Object}function nm(t,i,n,e,r,s,h){var u=t(i);if(!u){if(r)return void(n[e]=function(i,n,e){return function(){var r=t(e)||im(s,e,h);return i[n]=r,new r}}(n,e,i));u=im(s,i,h)}n[e]=u}function em(t,i,n,e){for(var r=n||vi,s=t[3],h=0;h<s.length;++h){var u=s[h];"string"!=typeof u?nm(r,u[G_],u,G_,i,n,e):nm(r,u,s,h,i,n,e)}}function rm(t){var i=t[4];if(i)for(var n=t[3],e=0;e<i.length;++e){var r=i[e];r[V_]=n[r[V_]]}}function sm(t){for(var i=t[5],n=t[2],e=t[1],r=t[8],s=t[9],h=t[10],u=0;u<r.length;++u){var o=r[u];"number"==typeof o&&(r[u]=i[o]);var a=s[u];"number"==typeof a&&(a=a>=0?n[a]:~a,s[u]=a);var c=h[u];"number"==typeof c&&(h[u]=e[c])}}function hm(t){if(Array.isArray(t)){var i=t[0];return"number"==typeof i||i instanceof am}return!1}function um(t,i,n){var e;i.init(t),null!==(e=n)&&void 0!==e||(n={});var r=t[0],s=!1;if("object"==typeof r&&(s=r.preprocessed,r=r.version),r<U_)throw new Error(ft(5304,r));var h,u=n;u._version=r,u.result=i,t[0]=u,s||(em(t,!1,n.classFinder,null!==(h=n.reportMissingClass)&&void 0!==h?h:om.reportMissingClass),rm(t))}function om(t,i,n){"string"==typeof t&&(t=JSON.parse(t));var e,r=!1;if(i||(i=W_.pool.get(),r=!0),hm(t)){um(t,i,n);var s=t;k.game._isCloning=!0;var h=s[5],u=tm(s);k.game._isCloning=!1,s[7]&&z_(s[7],h,s[2]),sm(s),e=h[u]}else e=F_(t,i,n);return r&&W_.pool.put(i),e}J_[0]=function(t,i,n,e){i[n]=e},J_[1]=K_,J_[2]=q_(K_),J_[3]=q_(Q_),J_[4]=Z_,J_[5]=function(t,i,n,e){var r=e[0],s=i[n];(0,D_[r])(s,e)},J_[6]=Q_,J_[7]=function(t,i,n,e){i[n].set(e)},J_[8]=function(t,i,n,e){var r=e[0],s=new P_[r];(0,D_[r])(s,e),i[n]=s},J_[9]=q_(Z_),J_[10]=function(t,i,n,e){var r=t[3][e[0]];i[n]=Y_(t,r,e[1])},J_[11]=function(t,i,n,e){var r=e[0];i[n]=r;for(var s=1;s<e.length;s+=3){var h=e[s],u=e[s+1],o=e[s+2];(0,J_[u])(t,r,h,o)}},J_[12]=function(t,i,n,e){for(var r=e[0],s=0;s<r.length;++s){var h=r[s],u=e[s+1];0!==u&&(0,J_[u])(t,r,s,h)}i[n]=r},om.Details=W_,om.reportMissingClass=function(t){ut(5302,t)};var am=function(t){this.preprocessed=!0,this.version=t};function cm(t,i){if(t[0]<U_)throw new Error(ft(5304,t[0]));em(t,!0,i,om.reportMissingClass),rm(t);for(var n=new am(t[0]),e=t[1],r=t[2],s=t[3],h=t[4],u=t[5],o=0;o<u.length;++o)u[o].unshift(n,e,r,s,h);return u}function fm(t,i,n){return[U_,x_,x_,[t],x_,n?[i,-1]:[i],[0],x_,[],[],[]]}function vm(t){return n=(i=t)[1],i[10].map((function(t){return n[t]}));var i,n}k.deserialize=om;var lm=new WeakMap,dm=new WeakSet,gm=new WeakSet;function wm(t,i){var n;n=__.safeFindClass;var e,r=W_.pool.get();try{e=om(t,r,{classFinder:n,customEnv:i})}catch(t){throw Y(t),W_.pool.put(r),t}e._uuid=i.__uuid__||"";for(var s=r.uuidList,h=r.uuidObjList,u=r.uuidPropList,o=r.uuidTypeList||[],a=[],c=0;c<s.length;c++){var f=s[c];a[c]={uuid:ow(f),owner:h[c],prop:u[c],type:vi(o[c])}}return lm.set(e,a),e._native&&dm.add(e),W_.pool.put(r),e}var _m=function(){function t(){this._depends=new zg}var i=t.prototype;return i.init=function(){this._depends.clear()},i.getNativeDep=function(t){var i=this._depends.get(t);return i&&i.nativeDep?r({},i.nativeDep):null},i.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},i.getDepsRecursively=function(t){var i=Object.create(null),n=[];return this.Or(t,i,n),n},i.remove=function(t){this._depends.remove(t)},i.parse=function(t,i){var n,e,r=null;if(Array.isArray(i)||i.__type__||i instanceof p_){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(i)||"number"==typeof(e=(n=i[5])[n.length-1])&&e<0)try{var s=wm(i,{__uuid__:t});(r=this.Rr(s)).nativeDep&&(r.nativeDep.uuid=t),qg.add(t+"@import",s)}catch(i){Kg.remove(t+"@import"),r={deps:[]}}else r={deps:this.Ir(i)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this.Rr(i)}return this._depends.add(t,r),r},i.Rr=function(t){for(var i={deps:[],parsedFromExistAsset:!0},n=lm.get(t),e=0,r=n.length;e<r;e++)i.deps.push(n[e].uuid);return dm.has(t)&&(i.nativeDep=t._nativeDep),i},i.Ir=function(t){var i=vm(t);return i.forEach((function(t,n){return i[n]=ow(t)})),i},i.Or=function(t,i,n){for(var e=this.getDeps(t),r=0;r<e.length;r++){var s=e[r];i[s]||(i[s]=!0,n.push(s),this.Or(s,i,n))}},e(t,null,[{key:"instance",get:function(){return this.Mr||(this.Mr=new t),this.Mr}}]),t}();_m.Mr=void 0;var mm,pm=_m.instance,ym=[new td];function bm(t,i){for(var n=Math.max(t,i),e=0;n;)n>>=1,e++;return e}function Am(t){return t&&!(t&t-1)}function Em(t,i,n){return!(6===t.gfxAPI)||Am(i)&&Am(n)}var km,Tm,Sm,Om,Rm,Im=Ko("cc.SimpleTexture")(mm=function(t){function i(i){var n;return(n=t.call(this,i)||this).Nr=null,n.Cr=null,n.Lr=1,n.Fr=0,n.Pr=0,n.Br=0,n.Dr=1e3,n}s(i,t);var n=i.prototype;return n.getGFXTexture=function(){return this.Cr},n.destroy=function(){return this.Ur(),this.Gr(),t.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(t,i,n){if(void 0===i&&(i=0),void 0===n&&(n=0),this.Nr&&!(this.Lr<=i)){var e=this._getGFXDevice();if(e){var r=ym[0];r.texExtent.width=this.Fr>>i,r.texExtent.height=this.Pr>>i,r.texSubres.mipLevel=i,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?e.copyBuffersToTexture([t],this.Nr,ym):e.copyTexImagesToTexture([t],this.Nr,ym)}}},n.jr=function(t,i,n){var e=t.data;if(e&&(this.uploadData(e,i,n),this.Hr(),Gi.CLEANUP_IMAGE_CACHE)){var r=pm.getDeps(this._uuid),s=r.indexOf(t._uuid);-1!==s&&(pi(r,s),t.decRef())}},n.Hr=function(){this.Vr()},n.Vr=function(){this.loaded=!0,this.emit("load")},n.$r=function(t){this.Lr=t<1?1:t},n.Wr=function(t,i){this.Br=t<1?0:t,this.Dr=i<1?0:i},n.setMipRange=function(t,i){at(t<=i,3124),this.Wr(t,i);var n=this._getGFXDevice();if(n){var e=this.zr(n);this.Ur(),this.Cr=e}},n.Xr=function(){return null},n.Yr=function(){return null},n.Kr=function(){if(this.Ur(),this.Gr(),0!==this.Lr){var t=this._getGFXDevice();t&&(this.qr(t),this.Cr=this.zr(t))}},n.isUsingOfflineMipmaps=function(){return!1},n.qr=function(t){if(0!==this.xn&&0!==this.Gn){var i=0;0!==this._mipFilter&&Em(t,this.xn,this.Gn)&&(this.Lr=bm(this.xn,this.Gn),this.isUsingOfflineMipmaps()||this.isCompressed||(i=1));var n=this.Xr({usage:22,format:this._getGFXFormat(),levelCount:this.Lr,flags:i});if(n){var e=t.createTexture(n);this.Fr=n.width,this.Pr=n.height,this.Nr=e}}},n.zr=function(t){if(!this.Nr)return null;var i=this.Dr<this.Lr?this.Dr:this.Lr-1,n=this.Yr({texture:this.Nr,format:this._getGFXFormat(),baseLevel:this.Br,levelCount:i-this.Br+1});return n?t.createTexture(n):null},n.Gr=function(){this.Nr&&(this.Nr.destroy(),this.Nr=null)},n.Ur=function(){this.Cr&&(this.Cr.destroy(),this.Cr=null)},e(i,[{key:"mipmapLevel",get:function(){return this.Lr}}]),i}(zw))||mm;k.SimpleTexture=Im;var Mm=t("Texture2D",(km=Ko("cc.Texture2D"),Tm=Ca([jw]),km((Om=function(t){function i(i){var n;return(n=t.call(this,i)||this)._mipmaps=Rm&&Rm(),n.Qr=[],n}s(i,t);var n=i.prototype;return n.Zr=function(t){var i=this;if(this.Qr=t,this.$r(this.Qr.length),this.Qr.length>0){var n=this.Qr[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this.Qr.length,baseLevel:this.Br,maxLevel:this.Dr}),this.Qr.forEach((function(t,n){i.jr(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this.Qr.length,baseLevel:this.Br,maxLevel:this.Dr})},n.Jr=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.Jr()},n.reset=function(t){this.xn=t.width,this.Gn=t.height,this._setGFXFormat(t.format);var i=void 0===t.mipmapLevel?1:t.mipmapLevel;this.$r(i);var n=void 0===t.baseLevel?0:t.baseLevel,e=void 0===t.maxLevel?1e3:t.maxLevel;this.Wr(n,e),this.Kr()},n.create=function(t,i,n,e,r,s){void 0===n&&(n=35),void 0===e&&(e=1),void 0===r&&(r=0),void 0===s&&(s=1e3),this.reset({width:t,height:i,format:n,mipmapLevel:e,baseLevel:r,maxLevel:s})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=void 0),!(t>=this.Qr.length))for(var n=Math.min(void 0===i?this.Qr.length:i,this.Qr.length-t),e=0;e<n;++e){var r=t+e;this.jr(this.Qr[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],this.Qr=[],t.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(i,n){var e=i;t.prototype._deserialize.call(this,e.base,n),this._mipmaps=new Array(e.mipmaps.length);for(var r=0;r<e.mipmaps.length;++r)if(this._mipmaps[r]=new jw,e.mipmaps[r]){var s=e.mipmaps[r];n.result.push(this._mipmaps,""+r,s,gi(jw))}},n.Xr=function(t){var i=new vd(1);return i.width=this.xn,i.height=this.Gn,Object.assign(i,t),i},n.Yr=function(t){var i=new ld;return i.type=1,Object.assign(i,t),i},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new jw;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},e(i,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var i=[];if(1===t.length){var n=t[0];i.push.apply(i,n.Xe())}else if(t.length>1)for(var e=0;e<t.length;++e){var r=t[e];i.push(r.ze())}this.Zr(i)}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),i}(Im),Rm=xo(Om.prototype,"_mipmaps",[Tm],(function(){return[]})),Sm=Om))||Sm));function Nm(t,i,n,e){t.drawTextureAt(i,n,e)}k.Texture2D=Mm;var Cm=t("Atlas",function(){function t(t,i){this.ts={},this.ns=[],this.$=0;var n=new Lm;n.initWithSize(t,i),this.es=n,this.xn=t,this.Gn=i,this.rs=2,this.ss=2,this.hs=2}var i=t.prototype;return i.insertSpriteFrame=function(t){var i=t.rect,n=t.texture,e=this.ts[n.getId()],r=i.x,s=i.y;if(e)r+=e.x,s+=e.y;else{var h=n.width,u=n.height;if(this.rs+h+2>this.xn&&(this.rs=2,this.ss=this.hs),this.ss+u+2>this.hs&&(this.hs=this.ss+u+2),this.hs>this.Gn)return null;var o=this.es,a=n.image;k.internal.dynamicAtlasManager.textureBleeding&&((h<=8||u<=8)&&(Nm(o,a,this.rs-1,this.ss-1),Nm(o,a,this.rs-1,this.ss+1),Nm(o,a,this.rs+1,this.ss-1),Nm(o,a,this.rs+1,this.ss+1)),Nm(o,a,this.rs-1,this.ss),Nm(o,a,this.rs+1,this.ss),Nm(o,a,this.rs,this.ss-1),Nm(o,a,this.rs,this.ss+1)),Nm(o,a,this.rs,this.ss),this.ts[n.getId()]={x:this.rs,y:this.ss,texture:n},this.$++,r+=this.rs,s+=this.ss,this.rs+=h+2}var c={x:r,y:s,texture:this.es};return this.ns.push(t),c},i.removeSpriteFrame=function(t){bi(this.ns,t)},i.deleteInnerTexture=function(t){t&&this.ts[t.getId()]&&(delete this.ts[t.getId()],this.$--)},i.isEmpty=function(){return this.$<=0},i.reset=function(){this.rs=2,this.ss=2,this.hs=2;for(var t=this.ns,i=0,n=t.length;i<n;i++){var e=t[i];e.isValid&&e.us()}this.ns.length=0,this.ts={}},i.destroy=function(){this.reset(),this.es.destroy()},t}()),Lm=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.initWithSize=function(t,i,n){void 0===n&&(n=35),this.reset({width:t,height:i,format:n})},n.drawTextureAt=function(t,i,n){var e=this.getGFXTexture();if(t&&e){var r=this._getGFXDevice();if(r){var s=new td;s.texOffset.x=i,s.texOffset.y=n,s.texExtent.width=t.width,s.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],e,[s])}else st(16363)}},i}(Mm),Fm={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Pm=t("Layers",function(){function t(){}return t.init=function(){var i=xi.querySettings("engine","customLayers");if(i)for(var n=0;n<i.length;n++){var e=i[n];t.addLayer(e.name,e.bit)}},t.makeMaskInclude=function(t){return t.reduce((function(t,i){return t|i}),0)},t.makeMaskExclude=function(i){return~t.makeMaskInclude(i)},t.addLayer=function(i,n){if(void 0!==n)if(n>19||n<0)st(16365);else{var e=1<<n;t.Enum[i],ft(2104,i),t.Enum[i]=e,Dt(t.Enum,String(e),i),t.BitMask[i]=e,Dt(t.BitMask,String(e),i),Ri.update(t.BitMask),Ni.update(t.Enum)}else st(16364)},t.deleteLayer=function(i){if(i>19||i<0)st(16366);else{var n=1<<i;delete t.Enum[t.Enum[n]],delete t.Enum[n],delete t.BitMask[t.BitMask[n]],delete t.BitMask[n],Ri.update(t.BitMask),Ni.update(t.Enum)}},t.nameToLayer=function(i){return void 0===i?(st(16367),-1):N(t.Enum[i])},t.layerToName=function(i){return i>31||i<0?(st(16368),""):t.Enum[1<<i]},t}());Pm.Enum=Ni(Fm),Pm.BitMask=Ri(r({},Fm)),T.Layers=Pm;var Bm=function(){var t=i.prototype;function i(t){this.cs=null,this.fs=1,this.vs=1,this.colorDirty=!0,this._uiTransformComp=null,this.ls=null,this.ds=t}return t.gs=function(t){this.fs=t},t.applyOpacity=function(t){this.fs=this.vs*t},i.markOpacityTree=function(){},e(i,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this.ds.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this.cs},set:function(t){this.cs&&t?st(12002):this.cs=t}},{key:"opacity",get:function(){return this.fs}},{key:"localOpacity",get:function(){return this.vs},set:function(t){this.vs=t,this.colorDirty=!0}}]),i}();T.GAME_VIEW;var Dm=t("NodeSpace",{LOCAL:0,WORLD:1}),Um=t("TransformBit",{NONE:0,POSITION:1,ROTATION:2,SCALE:4,SKEW:8,RS:6,RSS:14,TRS:7,TRS_MASK:-8});T.internal.TransformBit=Um;var xm=t("MobilityMode",Ni({Static:0,Stationary:1,Movable:2})),Gm=t("NodeEventType",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",MOBILITY_CHANGED:"mobility-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed",CHILDREN_ORDER_CHANGED:"sibling-order-changed",ACTIVE_IN_HIERARCHY_CHANGED:"active-in-hierarchy-changed",COMPONENT_ADDED:"component-added",COMPONENT_REMOVED:"component-removed",LIGHT_PROBE_CHANGED:"light-probe-changed",LIGHT_PROBE_BAKING_CHANGED:"light-probe-baking-changed",ACTIVE_CHANGED:"active-changed"}),jm=t("Event",function(){function t(t,i){this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!i}var i=t.prototype;return i.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},i.reuse=function(t,i){this.type=t,this.bubbles=i||!1},i.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},i.getCurrentTarget=function(){return this.currentTarget},i.getType=function(){return this.type},t}());jm.NO_TYPE="no_type",jm.TOUCH="touch",jm.MOUSE="mouse",jm.KEYBOARD="keyboard",jm.ACCELERATION="acceleration",jm.NONE=0,jm.CAPTURING_PHASE=1,jm.AT_TARGET=2,jm.BUBBLING_PHASE=3,k.Event=jm;var Hm=t("EventAcceleration",function(t){function i(i,n){var e;return(e=t.call(this,"devicemotion",n)||this).acc=i,e}return s(i,t),i}(jm));jm.EventAcceleration=Hm;var Vm=t("EventKeyboard",function(t){function i(i,n,e){var r;return"boolean"==typeof n&&(n=n?"keydown":"keyup"),(r=t.call(this,n,e)||this).rawEvent=void 0,r.ws="keyup"!==n,"number"==typeof i?r.keyCode=i:(r.keyCode=i.keyCode,r.rawEvent=i),r.windowId=0,r}return s(i,t),e(i,[{key:"isPressed",get:function(){return this.ws}}]),i}(jm));jm.EventKeyboard=Vm;var $m=t("EventMouse",function(t){function i(n,e,r,s){var h;return(h=t.call(this,n,e)||this).movementX=0,h.movementY=0,h.windowId=0,h.preventSwallow=!1,h._s=i.BUTTON_MISSING,h.rs=0,h.ss=0,h.ps=0,h.ys=0,h.bs=0,h.As=0,h.Es=n,r&&(h.ps=r.x,h.ys=r.y),h.windowId=null!=s?s:h.windowId,h}s(i,t);var n=i.prototype;return n.setScrollData=function(t,i){this.bs=t,this.As=i},n.getScrollX=function(){return this.bs},n.getScrollY=function(){return this.As},n.setLocation=function(t,i){this.rs=t,this.ss=i},n.getLocation=function(t){return t||(t=new ls),ls.set(t,this.rs,this.ss),t},n.getLocationInView=function(t){return t||(t=new ls),ls.set(t,this.rs,k.view._designResolutionSize.height-this.ss),t},n.getUILocation=function(t){return t||(t=new ls),ls.set(t,this.rs,this.ss),k.view.Ut(t),t},n.getPreviousLocation=function(t){return t||(t=new ls),ls.set(t,this.ps,this.ys),t},n.getUIPreviousLocation=function(t){return t||(t=new ls),ls.set(t,this.ps,this.ys),k.view.Ut(t),t},n.getDelta=function(t){return t||(t=new ls),ls.set(t,this.rs-this.ps,this.ss-this.ys),t},n.getDeltaX=function(){return this.rs-this.ps},n.getDeltaY=function(){return this.ss-this.ys},n.getUIDelta=function(t){t||(t=new ls);var i=k.view;return ls.set(t,(this.rs-this.ps)/i.getScaleX(),(this.ss-this.ys)/i.getScaleY()),t},n.getUIDeltaX=function(){return(this.rs-this.ps)/k.view.getScaleX()},n.getUIDeltaY=function(){return(this.ss-this.ys)/k.view.getScaleY()},n.setButton=function(t){this._s=t},n.getButton=function(){return this._s},n.getLocationX=function(){return this.rs},n.getLocationY=function(){return this.ss},n.getUILocationX=function(){var t=k.view,i=t.getViewportRect();return(this.rs-i.x)/t.getScaleX()},n.getUILocationY=function(){var t=k.view,i=t.getViewportRect();return(this.ss-i.y)/t.getScaleY()},e(i,[{key:"eventType",get:function(){return this.Es}}]),i}(jm));$m.BUTTON_MISSING=-1,$m.BUTTON_LEFT=0,$m.BUTTON_RIGHT=2,$m.BUTTON_MIDDLE=1,$m.BUTTON_4=3,$m.BUTTON_5=4,$m.BUTTON_6=5,$m.BUTTON_7=6,$m.BUTTON_8=7,jm.EventMouse=$m;var Wm=new ls,zm=t("EventTouch",function(t){function i(i,n,e,r){var s;return void 0===r&&(r=[]),(s=t.call(this,e,n)||this).touch=null,s.simulate=!1,s.windowId=0,s.preventSwallow=!1,s.ks=e,s.Ts=i||[],s.Ss=r,s}s(i,t);var n=i.prototype;return n.getEventCode=function(){return this.ks},n.getTouches=function(){return this.Ts},n.getAllTouches=function(){return this.Ss},n.setLocation=function(t,i){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,i)},n.getLocation=function(t){return this.touch?this.touch.getLocation(t):new ls},n.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new ls},n.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new ls},n.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new ls},n.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new ls},n.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new ls},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(t){return this.touch?this.touch.getDelta(t):new ls},n.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new ls},n.getDeltaX=function(){return this.touch?this.touch.getDelta(Wm).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(Wm).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},i}(jm));zm.MAX_TOUCHES=5,jm.EventTouch=zm;var Xm=t("EventGamepad",function(t){function i(i,n){var e;return(e=t.call(this,i,!1)||this).gamepad=n,e}return s(i,t),i}(jm)),Ym=t("EventHandle",function(t){function i(i,n){var e;return(e=t.call(this,i,!1)||this).handleInputDevice=n,e}return s(i,t),i}(jm)),Km=t("EventHMD",function(t){function i(i,n){var e;return(e=t.call(this,i,!1)||this).hmdInputDevice=n,e}return s(i,t),i}(jm)),qm=(t("EventHandheld",function(t){function i(i,n){var e;return(e=t.call(this,i,!1)||this).handheldInputDevice=n,e}return s(i,t),i}(jm)),t("Acceleration",(function(t,i,n,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===e&&(e=0),this.x=t,this.y=i,this.z=n,this.timestamp=e}))),Qm=t("SystemEventType",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"});k.SystemEventType=Qm,t("KeyCode",{NONE:0,MOBILE_BACK:6,BACKSPACE:8,TAB:9,ENTER:13,SHIFT_LEFT:16,CTRL_LEFT:17,ALT_LEFT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,INSERT:45,DELETE:46,DIGIT_0:48,DIGIT_1:49,DIGIT_2:50,DIGIT_3:51,DIGIT_4:52,DIGIT_5:53,DIGIT_6:54,DIGIT_7:55,DIGIT_8:56,DIGIT_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_SUBTRACT:109,NUM_DECIMAL:110,NUM_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,BRACKET_LEFT:219,BACKSLASH:220,BRACKET_RIGHT:221,QUOTE:222,SHIFT_RIGHT:2e3,CTRL_RIGHT:2001,ALT_RIGHT:2002,NUM_ENTER:2003});var Zm=new ls,Jm=t("Touch",function(){function t(t,i,n){void 0===n&&(n=0),this.Os=new ls,this.Rs=new ls,this.Is=0,this.Je=0,this.Ms=new ls,this.Ns=!1,this.setTouchInfo(n,t,i)}var i=t.prototype;return i.getLocation=function(t){return t||(t=new ls),t.set(this.Os.x,this.Os.y),t},i.getLocationX=function(){return this.Os.x},i.getLocationY=function(){return this.Os.y},i.getUILocation=function(t){return t||(t=new ls),t.set(this.Os.x,this.Os.y),k.view.Ut(t),t},i.getUILocationX=function(){var t=k.view,i=t.getViewportRect();return(this.Os.x-i.x)/t.getScaleX()},i.getUILocationY=function(){var t=k.view,i=t.getViewportRect();return(this.Os.y-i.y)/t.getScaleY()},i.getPreviousLocation=function(t){return t||(t=new ls),t.set(this.Rs.x,this.Rs.y),t},i.getUIPreviousLocation=function(t){return t||(t=new ls),t.set(this.Rs.x,this.Rs.y),k.view.Ut(t),t},i.getStartLocation=function(t){return t||(t=new ls),t.set(this.Ms.x,this.Ms.y),t},i.getUIStartLocation=function(t){return t||(t=new ls),t.set(this.Ms.x,this.Ms.y),k.view.Ut(t),t},i.getDelta=function(t){return t||(t=new ls),t.set(this.Os),t.subtract(this.Rs),t},i.getUIDelta=function(t){t||(t=new ls),Zm.set(this.Os),Zm.subtract(this.Rs);var i=k.view;return t.set(i.getScaleX(),i.getScaleY()),ls.divide(t,Zm,t),t},i.getLocationInView=function(t){return t||(t=new ls),t.set(this.Os.x,k.view._designResolutionSize.height-this.Os.y),t},i.getPreviousLocationInView=function(t){return t||(t=new ls),t.set(this.Rs.x,k.view._designResolutionSize.height-this.Rs.y),t},i.getStartLocationInView=function(t){return t||(t=new ls),t.set(this.Ms.x,k.view._designResolutionSize.height-this.Ms.y),t},i.getID=function(){return this.Je},i.setTouchInfo=function(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.Rs=this.Os,this.Os=new ls(i||0,n||0),this.Je=t,this.Ns||(this.Ms=new ls(this.Os),this.Ns=!0)},i.setPoint=function(t,i){"object"==typeof t?(this.Os.x=t.x,this.Os.y=t.y):(this.Os.x=t||0,this.Os.y=i||0),this.Is=k.game.frameStartTime},i.setPrevPoint=function(t,i){this.Rs="object"==typeof t?new ls(t.x,t.y):new ls(t||0,i||0),this.Is=k.game.frameStartTime},i.clone=function(){var i=this.getID();this.getStartLocation(Zm);var n=new t(Zm.x,Zm.y,i);return this.getLocation(Zm),n.setPoint(Zm.x,Zm.y),this.getPreviousLocation(Zm),n.setPrevPoint(Zm),n},e(t,[{key:"lastModified",get:function(){return this.Is}}]),t}());k.Touch=Jm;var tp,ip,np,ep,rp,sp,hp,up,op,ap,cp,fp,vp,lp,dp,gp,wp,_p=new uu((function(){return new Array(16)}),3),mp=null,pp=new ls,yp=["touch-start","touch-move","touch-end","touch-cancel"],bp=["mouse-down","mouse-enter","mouse-move","mouse-leave","mouse-up","mouse-wheel"],Ap=new Tu,Ep=function(){function t(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this.Cs=null,this.Ls=!1,this.Fs=!1,this.ds=t}var i=t.prototype;return i.setEnabled=function(t,i){if(void 0===i&&(i=!1),this.Ls!==t){this.Ls=t;var n=this.node.children;if(t&&this.Ps(),Ap.emit(2),i&&n.length>0)for(var e=0;e<n.length;++e)n[e].eventProcessor.setEnabled(t,!0)}},i.reattach=function(){this.node.walk((function(i){var n=i.eventProcessor,e=n.Bs(t._maskComp);n.maskList=e}))},i.destroy=function(){if(mp===this.ds&&(mp=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),Ap.emit(1,this),this.Cs){var t=new zm([this.Cs],!0,"touch-cancel");t.touch=this.Cs,this.dispatchEvent(t),this.Cs=null}},i.on=function(t,i,n,e){var r,s;return this.Ds(t),((e=!!e)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this.Us():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this.Us()).on(t,i,n),i},i.once=function(t,i,n,e){var r,s;return this.Ds(t),((e=!!e)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this.Us():null!==(s=this.bubblingTarget)&&void 0!==s?s:this.bubblingTarget=this.Us()).on(t,i,n,!0),i},i.off=function(t,i,n,e){var r;null==(r=(e=!!e)?this.capturingTarget:this.bubblingTarget)||r.off(t,i,n)},i.targetOff=function(t){var i,n;null==(i=this.capturingTarget)||i.removeAll(t),null==(n=this.bubblingTarget)||n.removeAll(t),this.shouldHandleEventTouch&&!this.xs()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this.Gs()&&(this.shouldHandleEventMouse=!1),this.Hs()||Ap.emit(1,this)},i.emit=function(t,i,n,e,r,s){var h;null==(h=this.bubblingTarget)||h.emit(t,i,n,e,r,s)},i.dispatchEvent=function(t){var i,n=this.node,e=0;t.target=n;var r=_p.alloc();for(r.length=0,this.getCapturingTargets(t.type,r),t.eventPhase=1,e=r.length-1;e>=0;--e)if((i=r[e]).eventProcessor.capturingTarget&&(t.currentTarget=i,i.eventProcessor.capturingTarget.emit(t.type,t,r),t.propagationStopped))return void _p.free(r);if(t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(r.length=0,this.getBubblingTargets(t.type,r),t.eventPhase=3,e=0;e<r.length;++e)if((i=r[e]).eventProcessor.bubblingTarget&&(t.currentTarget=i,i.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void _p.free(r);_p.free(r)},i.hasEventListener=function(t,i,n){var e=!1;return this.bubblingTarget&&(e=this.bubblingTarget.hasEventListener(t,i,n)),!e&&this.capturingTarget&&(e=this.capturingTarget.hasEventListener(t,i,n)),e},i.getCapturingTargets=function(t,i){for(var n=this.ds.parent;n;){var e;null!=(e=n.eventProcessor.capturingTarget)&&e.hasEventListener(t)&&i.push(n),n=n.parent}},i.getBubblingTargets=function(t,i){for(var n=this.ds.parent;n;){var e;null!=(e=n.eventProcessor.bubblingTarget)&&e.hasEventListener(t)&&i.push(n),n=n.parent}},i.onUpdatingSiblingIndex=function(){Ap.emit(2)},i.Bs=function(t){var i=this.node;if(t){for(var n=0,e=[],r=i;r&&k.Node.isNode(r);r=r.parent,++n){var s=r.getComponent(t);if(s){var h={index:n,comp:s};e?e.push(h):e=[h]}}return e.length>0?e:null}return null},i.Ps=function(){this.maskList=this.Bs(t._maskComp)},i.Vs=function(t){return-1!==yp.indexOf(t)},i.$s=function(t){return-1!==bp.indexOf(t)},i.xs=function(){for(var t=0;t<yp.length;++t){var i=yp[t];if(this.hasEventListener(i))return!0}return!1},i.Gs=function(){for(var t=0;t<bp.length;++t){var i=bp[t];if(this.hasEventListener(i))return!0}return!1},i.Hs=function(){return!!this.xs()||this.Gs()},i.Ds=function(t){var i=this.Vs(t),n=this.$s(t);i?this.shouldHandleEventTouch=!0:n&&(this.shouldHandleEventMouse=!0),!i&&!n||this.Hs()||Ap.emit(0,this)},i.Us=function(){var t=this,i=new Tu;return i.tt((function(){t.shouldHandleEventTouch&&!t.xs()&&(t.shouldHandleEventTouch=!1),t.shouldHandleEventMouse&&!t.Gs()&&(t.shouldHandleEventMouse=!1),t.Hs()||Ap.emit(1,t)})),i},i.Ws=function(t){switch(t.type){case"mouse-down":return this.zs(t);case"mouse-move":return this.Xs(t);case"mouse-up":return this.Ys(t);case"mouse-wheel":return this.Ks(t);case"mouse-leave-window":return this.qs(t);case"mouse-enter-window":return this.Qs(t);default:return!1}},i.zs=function(t){var i=this.ds,n=i.Zs();return!(!i||!n||(t.getLocation(pp),!n.hitTest(pp,t.windowId)||(t.type="mouse-down",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.Xs=function(t){var i=this.ds,n=i.Zs();return!(!i||!n||this.Fs||(t.getLocation(pp),n.hitTest(pp,t.windowId)?(this.previousMouseIn||(mp&&mp!==i&&(t.type="mouse-leave",mp.dispatchEvent(t),mp.eventProcessor.previousMouseIn=!1),mp=i,t.type="mouse-enter",i.dispatchEvent(t),this.previousMouseIn=!0),t.type="mouse-move",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type="mouse-leave",i.dispatchEvent(t),this.previousMouseIn=!1,mp=null),1)))},i.Ys=function(t){var i=this.ds,n=i.Zs();return!(!i||!n||(t.getLocation(pp),!n.hitTest(pp,t.windowId)||(t.type="mouse-up",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.Ks=function(t){var i=this.ds,n=i.Zs();return!(!i||!n||(t.getLocation(pp),!n.hitTest(pp,t.windowId)||(t.type="mouse-wheel",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.qs=function(t){return this.Fs=!0,this.previousMouseIn&&(t.type="mouse-leave",this.ds.dispatchEvent(t),this.previousMouseIn=!1,mp=null),!1},i.Qs=function(){return this.Fs=!1,!1},i.Js=function(t){try{switch(t.type){case"touch-start":return this.th(t);case"touch-move":return this.ih(t);case"touch-end":return this.nh(t);case"touch-cancel":return this.eh(t);default:return!1}}catch(t){throw this.claimedTouchIdList.length=0,t}},i.th=function(t){var i=this.node,n=i.Zs();return!(!i||!n||(t.getLocation(pp),!n.hitTest(pp,t.windowId)||(t.type="touch-start",t.bubbles=!0,this.Cs=t.touch,i.dispatchEvent(t),0)))},i.ih=function(t){var i=this.node;return!(!i||!i.Zs()||(t.type="touch-move",t.bubbles=!0,this.Cs=t.touch,i.dispatchEvent(t),0))},i.nh=function(t){var i=this.node,n=i.Zs();i&&n&&(t.getLocation(pp),n.hitTest(pp,t.windowId)?t.type="touch-end":t.type="touch-cancel",t.bubbles=!0,i.dispatchEvent(t),this.Cs=null)},i.eh=function(t){var i=this.node;i&&i.Zs()&&(t.type="touch-cancel",t.bubbles=!0,i.dispatchEvent(t),this.Cs=null)},e(t,[{key:"isEnabled",get:function(){return this.Ls}},{key:"node",get:function(){return this.ds}}]),t}();Ep._maskComp=null,Ep.callbacksInvoker=Ap,k.NodeEventProcessor=Ep;var kp=128,Tp="transform-changed",Sp="active-changed",Op=new Rt("Node");function Rp(t){return t?"string"==typeof t?li(t):t:(ut(3804),null)}var Ip,Mp,Np,Cp,Lp,Fp,Pp,Bp=nr(),Dp=nr(),Up=Gr(),xp=Gr(),Gp=Gr(),jp=new _r,Hp=Zr(),Vp=Zr(),$p=[],Wp=Symbol("ReserveContentsForAllSyncablePrefab"),zp=0,Xp=(tp=Ko("cc.Node"),ip=Ca(ir),np=Ca(xm),tp((wp=function(t){s(n,t);var i=n.prototype;function n(i){var n;return void 0===i&&(i="New Node"),(n=t.call(this,i)||this)._parent=sp&&sp(),n._children=hp&&hp(),n._active=up&&up(),n._components=op&&op(),n._prefab=ap&&ap(),n._scene=null,n._activeInHierarchy=!1,n._id=Op.getNewId(),n._eventProcessor=new Ep(f(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._uiProps=new Bm(f(n)),n._static=!1,n._lpos=cp&&cp(),n._lrot=fp&&fp(),n._lscale=vp&&vp(),n._mobility=lp&&lp(),n._layer=dp&&dp(),n._euler=gp&&gp(),n._transformFlags=15,n._eulerDirty=!1,n._flagChangeVersion=0,n._hasChangedFlags=0,n._pos=new ir,n._rot=new Cr,n._scale=new ir(1,1,1),n._mat=new Kr,n}return i.rh=function(t){this._activeInHierarchy=t},n.sh=function(t){t._updateScene()},n._incSkewCompCount=function(){},n._decSkewCompCount=function(){},n._findComponent=function(t,i){var n=i,e=t._components;if(n._sealed)for(var r=0;r<e.length;++r){var s=e[r];if(s.constructor===i)return s}else for(var h=0;h<e.length;++h){var u=e[h];if(u instanceof i)return u}return null},n.hh=function(t,i,n){var e=i,r=t._components;if(e._sealed)for(var s=0;s<r.length;++s){var h=r[s];h.constructor===i&&n.push(h)}else for(var u=0;u<r.length;++u){var o=r[u];o instanceof i&&n.push(o)}},n.uh=function(t,i){for(var e=0;e<t.length;++e){var r=t[e],s=n._findComponent(r,i);if(s)return s;if(r._children.length>0&&(s=n.uh(r._children,i)))return s}return null},n.oh=function(t,i,e){for(var r=0;r<t.length;++r){var s=t[r];n.hh(s,i,e),s._children.length>0&&n.oh(s._children,i,e)}},i.ah=function(){return this._components},i._updateScene=function(){null==this._parent?ut(1640,this.name,this.uuid):this._scene=this._parent._scene},i.attr=function(t){Zt(this,t)},i.getParent=function(){return this._parent},i.fh=function(t){this._parent=t},i.setParent=function(t,i){if(void 0===i&&(i=!1),i&&this.updateWorldTransform(),this._parent!==t){var n=this._parent,e=t;if(this._parent=e,this._siblingIndex=0,this._onSetParent(n,i),this.emit&&this.emit("parent-changed",n),n&&!(n._objFlags&kp)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit("child-removed",this)}e&&(e._children.push(this),this._siblingIndex=e._children.length-1,e.emit&&e.emit("child-added",this)),this._onHierarchyChanged(n)}},i.getChildByUuid=function(t){if(!t)return z("Invalid uuid"),null;for(var i=this._children,n=0,e=i.length;n<e;n++)if(i[n]._id===t)return i[n];return null},i.getChildByName=function(t){if(!t)return z("Invalid name"),null;for(var i=this._children,n=0,e=i.length;n<e;n++)if(i[n]._name===t)return i[n];return null},i.getChildByPath=function(t){for(var i,n=t.split("/"),e=this,r=function(){var t=n[s];if(0===t.length)return 0;var i=e.children.find((function(i){return i.name===t}));if(!i)return{v:null};e=i},s=0;s<n.length;++s)if(0!==(i=r())&&i)return i.v;return e},i.addChild=function(t){t.setParent(this)},i.insertChild=function(t,i){t.setParent(this),t.setSiblingIndex(i)},i.getSiblingIndex=function(){return this._siblingIndex},i.setSiblingIndex=function(t){if(this._parent)if(256&this._parent._objFlags)ut(3821);else{var i=this._parent._children;t=t>=0?t:i.length+t;var n=i.indexOf(this);t!==n&&(i.splice(n,1),t<i.length?i.splice(t,0,this):i.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t),this._eventProcessor.onUpdatingSiblingIndex())}},i.walk=function(t,i){var e=1,r=null,s=null,h=0,u=n.dh[n.gh];u||(u=[],n.dh.push(u)),n.gh++,u.length=0,u[0]=this;for(var o=null,a=!1;e;)if(s=u[--e])if(!a&&t?t(s):a&&i&&i(s),u[e]=null,a){if(o===this._parent)break;if(a=!1,r)if(r[++h])u[e]=r[h],e++;else if(o&&(u[e]=o,e++,a=!0,o._parent?(h=(r=o._parent._children).indexOf(o),o=o._parent):(o=null,r=null),h<0))break}else s._children.length>0?(o=s,r=s._children,h=0,u[e]=r[h],e++):(u[e]=s,e++,a=!0);u.length=0,n.gh--},i.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},i.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},i.removeAllChildren=function(){for(var t=this._children,i=t.length-1;i>=0;i--){var n=t[i];n&&(n.parent=null)}this._children.length=0},i.isChildOf=function(t){var i=this;do{if(i===t)return!0;i=i._parent}while(i);return!1},i.getComponent=function(t){var i=Rp(t);return i?n._findComponent(this,i):null},i.getComponents=function(t){var i=Rp(t),e=[];return i&&n.hh(this,i,e),e},i.getComponentInChildren=function(t){var i=Rp(t);return i?n.uh(this._children,i):null},i.getComponentsInChildren=function(t){var i=Rp(t),e=[];return i&&(n.hh(this,i,e),n.oh(this._children,i,e)),e},i.addComponent=function(t){var i;if("string"==typeof t){if(!(i=li(t)))throw k._RF.peek()&&ut(3808,t),TypeError(ft(3807,t))}else{if(!t)throw TypeError(ft(3804));i=t}if("function"!=typeof i)throw TypeError(ft(3809));if(!ii(i,k.Component))throw TypeError(ft(3810));var n=i._requireComponent;if(n)if(Array.isArray(n))for(var e=0;e<n.length;e++){var r=n[e];this.getComponent(r)||this.addComponent(r)}else{var s=n;this.getComponent(s)||this.addComponent(s)}var h=new i;return h.node=this,this._components.push(h),this.emit("component-added",h),this._activeInHierarchy&&k.director._nodeActivator.activateComp(h),h},i.removeComponent=function(t){if(t){var i=null;(i=t instanceof w_?t:this.getComponent(t))&&i.destroy()}else ut(3813)},i.on=function(t,i,n,e){switch(void 0===e&&(e=!1),t){case Tp:this._eventMask|=1;break;case Sp:this._eventMask|=2}this._eventProcessor.on(t,i,n,e)},i.off=function(t,i,n,e){if(void 0===e&&(e=!1),this._eventProcessor.off(t,i,n,e),!this._eventProcessor.hasEventListener(t))switch(t){case Tp:this._eventMask&=-2;break;case Sp:this._eventMask&=-3}},i.once=function(t,i,n,e){this._eventProcessor.once(t,i,n,e)},i.emit=function(t,i,n,e,r,s){this._eventProcessor.emit(t,i,n,e,r,s)},i.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},i.hasEventListener=function(t,i,n){return this._eventProcessor.hasEventListener(t,i,n)},i.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(Tp)&&(this._eventMask&=-2),2&this._eventMask&&!this._eventProcessor.hasEventListener(Sp)&&(this._eventMask&=-3)},i.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},i.destroyAllChildren=function(){for(var t=this._children,i=0;i<t.length;++i)t[i].destroy()},i._removeComponent=function(t){if(t){if(!(this._objFlags&kp)){var i=this._components.indexOf(t);-1!==i?(this._components.splice(i,1),this.emit("component-removed",t)):t.node!==this&&ut(3815)}}else ut(3814)},i._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit("sibling-order-changed")},i._instantiate=function(t,i){return void 0===i&&(i=!1),t||(t=k.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(i),t},i._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof k.Scene||k.game.removePersistRootNode(this);var i=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==i&&k.director._nodeActivator.activateNode(this,i)},i._onPreDestroyBase=function(){this._objFlags|=kp;var t=this._parent,i=!!t&&!!(t._objFlags&kp);if(this._persistNode&&k.game.removePersistRootNode(this),!i&&t){this.emit("parent-changed",this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit("child-removed",this)}this.emit("node-destroyed",this),this._eventProcessor.destroy();for(var e=this._children,r=0;r<e.length;++r)e[r]._destroyImmediate();for(var s=this._components,h=0;h<s.length;++h)s[h]._destroyImmediate();return i},n.isNode=function(t){return t instanceof n&&(t.constructor===n||!(t instanceof k.Scene))},i._onPreDestroy=function(){return this._onPreDestroyBase()},i[Ya]=function(t){t.writeThis()},i._onSetParent=function(t,i){void 0===i&&(i=!1);var e=this,r=e._parent;if(r&&(null!=t&&t._scene===r._scene||null==r._scene||e.walk(n.sh)),i){if(r)if(r.updateWorldTransform(),Zn(Kr.determinant(r._mat),0,qn))st(14300),e._transformFlags|=7,e.updateWorldTransform();else{var s=r._mat;Kr.multiply(Hp,Kr.invert(Hp,s),e._mat),Kr.toSRT(Hp,e._lrot,e._lpos,e._lscale)}else ir.copy(e._lpos,e._pos),Cr.copy(e._lrot,e._rot),ir.copy(e._lscale,e._scale);e._eulerDirty=!0}e.invalidateChildren(7)},i._onHierarchyChanged=function(t){this.eventProcessor.reattach(),this._onHierarchyChangedBase(t)},i._onBatchCreated=function(t){2&this._eventMask&&(this._activeInHierarchy||this.emit(Sp,this,!1)),this.hasChangedFlags=7,this._children.forEach((function(i,n){i._siblingIndex=n,i._onBatchCreated(t)}))},i._onBeforeSerialize=function(){this.eulerAngles},i._onPostActivated=function(t){var i=this;2&i._eventMask&&i.emit(Sp,i,t);var n=this._eventProcessor;if(n.isEnabled===t&&Ep.callbacksInvoker.emit(2),n.setEnabled(t),t){i.invalidateChildren(7);var e=i._uiProps&&i._uiProps.uiComp;e&&(e.setNodeDirty(),e.setTextureDirty(),e.wh())}},i.translate=function(t,i){var n=i||0;if(0===n)ir.transformQuat(Bp,t,this._lrot),this._lpos.x+=Bp.x,this._lpos.y+=Bp.y,this._lpos.z+=Bp.z;else if(1===n)if(this._parent){Cr.invert(Up,this._parent.worldRotation),ir.transformQuat(Bp,t,Up);var e=this.worldScale;this._lpos.x+=Bp.x/e.x,this._lpos.y+=Bp.y/e.y,this._lpos.z+=Bp.z/e.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(1),1&this._eventMask&&this.emit(Tp,1)},i.rotate=function(t,i){var n=i||0;if(Cr.normalize(Up,t),0===n)Cr.multiply(this._lrot,this._lrot,Up);else if(1===n){var e=this.worldRotation;Cr.multiply(xp,Up,e),Cr.invert(Up,e),Cr.multiply(xp,Up,xp),Cr.multiply(this._lrot,this._lrot,xp)}this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(Tp,2)},i.lookAt=function(t,i){this.getWorldPosition(Bp),ir.subtract(Bp,Bp,t),ir.normalize(Bp,Bp),Cr.fromViewUp(Up,Bp,i),this.setWorldRotation(Up)},i.invalidateChildren=function(t){var i,n,e=0,r=0,s=0,h=0,u=1|t;for($p[0]=this;e>=0;){if(h=(i=$p[e--]).hasChangedFlags,i.isValid&&(i._transformFlags&h&t)!==t)for(i._transformFlags|=t,i.hasChangedFlags=h|t,s=(n=i._children).length,r=0;r<s;r++)$p[++e]=n[r];t=u}},i.updateWorldTransform=function(){if(this._transformFlags){for(var t,i,n,e=this,r=0;e&&e._transformFlags;)$p[r++]=e,e=e._parent;for(var s=0,h=0,u=0;r;){if(i=(t=$p[--r])._mat,n=t._pos,h=1&(s|=t._transformFlags),u=14&s,e){if(h&&!u&&(ir.transformMat4(n,t._lpos,e._mat),i.m12=n.x,i.m13=n.y,i.m14=n.z),u){var o=i;Kr.fromSRT(Hp,t._lrot,t._lpos,t._lscale),Kr.multiply(i,e._mat,Hp);var a=2&s?t._rot:null;Kr.toSRT(o,a,n,t._scale)}}else h&&(ir.copy(n,t._lpos),i.m12=n.x,i.m13=n.y,i.m14=n.z),u&&(2&s&&Cr.copy(t._rot,t._lrot),4&s&&ir.copy(t._scale,t._lscale),Kr.fromSRT(i,t._rot,t._pos,t._scale));t._transformFlags=0,e=t}}},i.setPosition=function(t,i,n){var e=this._lpos;void 0===i?ir.copy(e,t):(void 0===n&&(n=e.z),ir.set(e,t,i,n)),this.invalidateChildren(1),1&this._eventMask&&this.emit(Tp,1)},i.getPosition=function(t){return t?ir.set(t,this._lpos.x,this._lpos.y,this._lpos.z):ir.copy(new ir,this._lpos)},i.setRotation=function(t,i,n,e){void 0===i?Cr.copy(this._lrot,t):Cr.set(this._lrot,t,i,n,e),this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(Tp,2)},i.setRotationFromEuler=function(t,i,n){if(void 0===i)ir.copy(this._euler,t),Cr.fromEuler(this._lrot,t.x,t.y,t.z);else{var e=void 0===n?this._euler.z:n;ir.set(this._euler,t,i,e),Cr.fromEuler(this._lrot,t,i,e)}this._eulerDirty=!1,this.invalidateChildren(2),1&this._eventMask&&this.emit(Tp,2)},i.getRotation=function(t){return t?Cr.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Cr.copy(new Cr,this._lrot)},i.setScale=function(t,i,n){var e=this._lscale;void 0===i?ir.copy(e,t):(void 0===n&&(n=e.z),ir.set(e,t,i,n)),this.invalidateChildren(4),1&this._eventMask&&this.emit(Tp,4)},i.getScale=function(t){return t?ir.set(t,this._lscale.x,this._lscale.y,this._lscale.z):ir.copy(new ir,this._lscale)},i.inverseTransformPoint=function(t,i){ir.copy(t,i);for(var n=this,e=0;n._parent;)$p[e++]=n,n=n._parent;for(;e>=0;)ir.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=$p[--e];return t},i.setWorldPosition=function(t,i,n){var e=this._pos;void 0===i?ir.copy(e,t):ir.set(e,t,i,n);var r=this._parent,s=this._lpos;r?(r.updateWorldTransform(),ir.transformMat4(s,e,Kr.invert(Hp,r._mat))):ir.copy(s,e),this.invalidateChildren(1),1&this._eventMask&&this.emit(Tp,1)},i.getWorldPosition=function(t){return this.updateWorldTransform(),t?ir.copy(t,this._pos):ir.copy(new ir,this._pos)},i.setWorldRotation=function(t,i,n,e){var r=this._rot;void 0===i?Cr.copy(r,t):Cr.set(r,t,i,n,e),this._parent?(this._parent.updateWorldTransform(),Cr.multiply(this._lrot,Cr.conjugate(this._lrot,this._parent._rot),r)):Cr.copy(this._lrot,r),this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(Tp,2)},i.setWorldRotationFromEuler=function(t,i,n){Cr.fromEuler(Up,t,i,n),this.setWorldRotation(Up)},i.getWorldRotation=function(t){return this.updateWorldTransform(),t?Cr.copy(t,this._rot):Cr.copy(new Cr,this._rot)},i.setWorldScale=function(t,i,n){var e=this,r=e._parent;r&&e.updateWorldTransform();var s=e._scale;void 0===i?ir.copy(s,t):ir.set(s,t,i,n);var h=0;if(r){var u=e._mat;e._uiProps.ls&&(Kr.fromSRT(Hp,e._lrot,e._lpos,e._lscale),Kr.multiply(u,r._mat,Hp));var o=ir.set(Dp,u.m00,u.m01,u.m02).length(),a=ir.set(Dp,u.m04,u.m05,u.m06).length(),c=ir.set(Dp,u.m08,u.m09,u.m10).length();0===o?(Bp.x=s.x,u.m00=1,h=2):Bp.x=s.x/o,0===a?(Bp.y=s.y,u.m05=1,h=2):Bp.y=s.y/a,0===c?(Bp.z=s.z,u.m10=1,h=2):Bp.z=s.z/c,Kr.scale(Hp,u,Bp),Kr.multiply(Vp,Kr.invert(Vp,r._mat),Hp),_r.fromQuat(jp,Cr.conjugate(Gp,e._lrot)),_r.multiplyMat4(jp,jp,Vp);var f=e._lscale;f.x=ir.set(Bp,jp.m00,jp.m01,jp.m02).length(),f.y=ir.set(Bp,jp.m03,jp.m04,jp.m05).length(),f.z=ir.set(Bp,jp.m06,jp.m07,jp.m08).length(),0!==f.x&&0!==f.y&&0!==f.z||(h=2)}else ir.copy(e._lscale,s);e.invalidateChildren(4|h),1&e._eventMask&&e.emit(Tp,4|h)},i.getWorldScale=function(t){return this.updateWorldTransform(),t?ir.copy(t,this._scale):ir.copy(new ir,this._scale)},i.getWorldMatrix=function(t){this.updateWorldTransform();var i=t||new Kr;return Kr.copy(i,this._mat)},i.getWorldRS=function(t){this.updateWorldTransform();var i=t||new Kr;return Kr.copy(i,this._mat),i.m12=0,i.m13=0,i.m14=0,i},i.getWorldRT=function(t){this.updateWorldTransform();var i=t||new Kr;return Kr.fromRT(i,this._rot,this._pos)},i.setRTS=function(t,i,n){var e=0;t&&(e|=2,void 0!==t.w?(Cr.copy(this._lrot,t),this._eulerDirty=!0):(ir.copy(this._euler,t),Cr.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),i&&(ir.copy(this._lpos,i),e|=1),n&&(ir.copy(this._lscale,n),e|=4),e&&(this.invalidateChildren(e),1&this._eventMask&&this.emit(Tp,e))},i.isTransformDirty=function(){return 0!==this._transformFlags},i.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},i.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},n.resetHasChangedFlags=function(){zp+=1},n.clearNodeArray=function(){n._h<n.mh?n._h++:(n._h=0,$p.length=0)},i.getPathInHierarchy=function(){for(var t=this.name,i=this.parent;i&&!(i instanceof k.Scene);)t=i.name+"/"+t,i=i.parent;return t},i.Zs=function(){return this._uiProps.uiTransformComp},e(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(64&this._objFlags)>0},set:function(t){t?this._objFlags|=64:this._objFlags&=-65}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var i=this._parent;i&&i._activeInHierarchy&&k.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}},{key:"prefab",get:function(){return this._prefab}},{key:"id",set:function(t){this._id=t}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(t){this._siblingIndex=t}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"x",get:function(){return this._lpos.x},set:function(t){this.setPosition(t,this._lpos.y,this._lpos.z)}},{key:"y",get:function(){return this._lpos.y},set:function(t){this.setPosition(this._lpos.x,t,this._lpos.z)}},{key:"z",get:function(){return this._lpos.z},set:function(t){this.setPosition(this._lpos.x,this._lpos.y,t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"worldPositionX",get:function(){return this.updateWorldTransform(),this._pos.x},set:function(t){this.setWorldPosition(t,this._pos.y,this._pos.z)}},{key:"worldPositionY",get:function(){return this.updateWorldTransform(),this._pos.y},set:function(t){this.setWorldPosition(this._pos.x,t,this._pos.z)}},{key:"worldPositionZ",get:function(){return this.updateWorldTransform(),this._pos.z},set:function(t){this.setWorldPosition(this._pos.x,this._pos.y,t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(Cr.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this.eulerAngles.z},set:function(t){ir.set(this._euler,0,0,t),Cr.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(2),1&this._eventMask&&this.emit(Tp,2)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Kr.toSRT(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(7),this._eulerDirty=!0,1&this._eventMask&&this.emit(Tp,7)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return ir.transformQuat(new ir,ir.FORWARD,this.worldRotation)},set:function(t){var i=t.length();ir.multiplyScalar(Bp,t,-1/i),Cr.fromViewUp(Up,Bp),this.setWorldRotation(Up)}},{key:"up",get:function(){return ir.transformQuat(new ir,ir.UP,this.worldRotation)}},{key:"right",get:function(){return ir.transformQuat(new ir,ir.RIGHT,this.worldRotation)}},{key:"mobility",get:function(){return this._mobility},set:function(t){this._mobility!==t&&(this._mobility=t,this.emit("mobility-changed"))}},{key:"layer",get:function(){return this._layer},set:function(t){var i=this;if(i._layer!==t){i._layer=t;var n=i._uiProps&&i._uiProps.uiComp;n&&(n.setNodeDirty(),n.wh()),i.emit("layer-changed",i._layer)}}},{key:"flagChangedVersion",get:function(){return this._flagChangeVersion}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===zp?this._hasChangedFlags:0},set:function(t){this._flagChangeVersion=zp,this._hasChangedFlags=t}}]),n}(du),wp.ph=Op,wp.dh=[[]],wp.gh=0,wp.EventType=Gm,wp.NodeSpace=Dm,wp.TransformDirtyBit=Um,wp.TransformBit=Um,wp.reserveContentsForAllSyncablePrefabTag=Wp,wp._h=0,wp.mh=1e3,m((rp=wp).prototype,"_persistNode",[Jo],Object.getOwnPropertyDescriptor(rp.prototype,"_persistNode"),rp.prototype),sp=xo(rp.prototype,"_parent",[oa],(function(){return null})),hp=xo(rp.prototype,"_children",[oa],(function(){return[]})),up=xo(rp.prototype,"_active",[oa],(function(){return!0})),op=xo(rp.prototype,"_components",[oa],(function(){return[]})),ap=xo(rp.prototype,"_prefab",[oa],(function(){return null})),cp=xo(rp.prototype,"_lpos",[oa],(function(){return new ir})),fp=xo(rp.prototype,"_lrot",[oa],(function(){return new Cr})),vp=xo(rp.prototype,"_lscale",[oa],(function(){return new ir(1,1,1)})),lp=xo(rp.prototype,"_mobility",[oa],(function(){return xm.Static})),dp=xo(rp.prototype,"_layer",[oa],(function(){return Pm.Enum.DEFAULT})),gp=xo(rp.prototype,"_euler",[oa],(function(){return new ir})),m(rp.prototype,"eulerAngles",[ip],Object.getOwnPropertyDescriptor(rp.prototype,"eulerAngles"),rp.prototype),m(rp.prototype,"mobility",[np],Object.getOwnPropertyDescriptor(rp.prototype,"mobility"),rp.prototype),ep=rp))||ep);t({Node:Xp,BaseNode:Xp}),k.Node=Xp;var Yp=t("TextureCube",Ko("cc.TextureCube")((Pp=function(t){function i(i){var n;return(n=t.call(this,i)||this).isRGBE=Np&&Np(),n._mipmapAtlas=Cp&&Cp(),n._mipmapMode=Lp&&Lp(),n._mipmaps=Fp&&Fp(),n.Qr=[],n}s(i,t);var n=i.prototype;return n.Zr=function(t){var i=this;if(this.Qr=t,this.$r(this.Qr.length),this.Qr.length>0){var n=this.Qr[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this.Qr.length,baseLevel:this.Br,maxLevel:this.Dr}),this.Qr.forEach((function(t,n){Kp(t,(function(t,e){i.jr(t,n,e)}))}))}else this.reset({width:0,height:0,mipmapLevel:this.Qr.length,baseLevel:this.Br,maxLevel:this.Dr})},n.isUsingOfflineMipmaps=function(){return 2===this._mipmapMode},i.fromTexture2DArray=function(t,n){for(var e=[],r=t.length/6,s=0;s<r;s++){var h=6*s;e.push({front:t[h+4].image,back:t[h+5].image,left:t[h+1].image,right:t[h+0].image,top:t[h+2].image,bottom:t[h+3].image})}return(n=n||new i).mipmaps=e,n},n.onLoaded=function(){2===this._mipmapMode?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},n.reset=function(t){this.xn=t.width,this.Gn=t.height,this._setGFXFormat(t.format);var i=void 0===t.mipmapLevel?1:t.mipmapLevel;this.$r(i);var n=void 0===t.baseLevel?0:t.baseLevel,e=void 0===t.maxLevel?1e3:t.maxLevel;this.Wr(n,e),this.Kr()},n.updateMipmaps=function(t,i){var n=this;if(void 0===t&&(t=0),void 0===i&&(i=void 0),!(t>=this.Qr.length))for(var e=Math.min(void 0===i?this.Qr.length:i,this.Qr.length-t),r=function(){var i=t+s;Kp(n.Qr[i],(function(t,e){n.jr(t,i,e)}))},s=0;s<e;++s)r()},n.destroy=function(){return this._mipmaps=[],this.Qr=[],this._mipmapAtlas=null,t.prototype.destroy.call(this)},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(i,n){var e=i;if(t.prototype._deserialize.call(this,e.base,n),this.isRGBE=e.rgbe,this._mipmapMode=e.mipmapMode,2===this._mipmapMode){var r=e.mipmapAtlas,s=e.mipmapLayout;this._mipmapAtlas={atlas:{},layout:s},this._mipmapAtlas.atlas={front:new jw,back:new jw,left:new jw,right:new jw,top:new jw,bottom:new jw};var h=gi(jw);n.result.push(this._mipmapAtlas.atlas,"front",r.front,h),n.result.push(this._mipmapAtlas.atlas,"back",r.back,h),n.result.push(this._mipmapAtlas.atlas,"left",r.left,h),n.result.push(this._mipmapAtlas.atlas,"right",r.right,h),n.result.push(this._mipmapAtlas.atlas,"top",r.top,h),n.result.push(this._mipmapAtlas.atlas,"bottom",r.bottom,h)}else{this._mipmaps=new Array(e.mipmaps.length);for(var u=0;u<e.mipmaps.length;++u){this._mipmaps[u]={front:new jw,back:new jw,left:new jw,right:new jw,top:new jw,bottom:new jw};var o=e.mipmaps[u],a=gi(jw);n.result.push(this._mipmaps[u],"front",o.front,a),n.result.push(this._mipmaps[u],"back",o.back,a),n.result.push(this._mipmaps[u],"left",o.left,a),n.result.push(this._mipmaps[u],"right",o.right,a),n.result.push(this._mipmaps[u],"top",o.top,a),n.result.push(this._mipmaps[u],"bottom",o.bottom,a)}}},n.Xr=function(t){var i=new vd(3);return i.width=this.xn,i.height=this.Gn,i.layerCount=6,Object.assign(i,t),i},n.Yr=function(t){var i=new ld;return i.type=3,i.baseLayer=0,i.layerCount=6,Object.assign(i,t),i},n._uploadAtlas=function(){var t=this,i=this._mipmapAtlas.layout,n=i[0];this.reset({width:n.width,height:n.height,format:this._mipmapAtlas.atlas.front.format,mipmapLevel:i.length}),Kp(this._mipmapAtlas.atlas,(function(n,e){var r=new Mm;r.image=n,r.reset({width:n.width,height:n.height,format:n.format}),r.uploadData(n.data);for(var s=0;s<i.length;s++){var h=i[s],u=r.getGFXTexture().size,o=new Uint8Array(u),a=new td;a.texOffset.x=h.left,a.texOffset.y=h.top,a.texExtent.width=h.width,a.texExtent.height=h.height,t._getGFXDevice().copyTextureToBuffers(r.getGFXTexture(),[o],[a]);var c=new jw({_data:o,_compressed:n.isCompressed,width:h.width,height:h.height,format:n.format});t.jr(c,h.level,e)}}))},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new jw;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){if(2===this._mipmapMode){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var t=this.mipmapAtlas.atlas;return!!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},e(i,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var i=[];if(1===t.length){var n=t[0],e=n.front.Xe(),r=n.back.Xe(),s=n.left.Xe(),h=n.right.Xe(),u=n.top.Xe(),o=n.bottom.Xe();if(e.length!==r.length||e.length!==s.length||e.length!==h.length||e.length!==u.length||e.length!==o.length)return ut(16347),void this.Zr([]);for(var a=e.length,c=0;c<a;++c){var f={front:e[c],back:r[c],left:s[c],right:h[c],top:u[c],bottom:o[c]};i.push(f)}}else t.length>1&&t.forEach((function(t){var n={front:t.front.ze(),back:t.back.ze(),left:t.left.ze(),right:t.right.ze(),top:t.top.ze(),bottom:t.bottom.ze()};i.push(n)}));this.Zr(i)}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(t){var i=this;if(this._mipmapAtlas=t,this._mipmapAtlas){var n=this._mipmapAtlas.atlas.front;if(n.data){var e=this._mipmapAtlas.atlas,r=this._mipmapAtlas.layout,s=r[0],h=Object.assign(O.document.createElement("canvas"),{width:n.width,height:n.height}).getContext("2d");this.reset({width:s.width,height:s.height,format:n.format,mipmapLevel:r.length});for(var u=function(){var t=r[o];Kp(e,(function(e,r){h.clearRect(0,0,n.width,n.height);var s=e.data;h.drawImage(s,0,0);var u=h.getImageData(t.left,t.top,t.width,t.height),o=new jw({_data:u.data,_compressed:e.isCompressed,width:u.width,height:u.height,format:e.format});i.jr(o,t.level,r)}))},o=0;o<r.length;o++)u()}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),i}(Im),Pp.FaceIndex={right:0,left:1,top:2,bottom:3,front:4,back:5},Np=xo((Mp=Pp).prototype,"isRGBE",[oa],(function(){return!1})),Cp=xo(Mp.prototype,"_mipmapAtlas",[oa],(function(){return null})),Lp=xo(Mp.prototype,"_mipmapMode",[oa],(function(){return 0})),Fp=xo(Mp.prototype,"_mipmaps",[oa],(function(){return[]})),Ip=Mp))||Ip);function Kp(t,i){i(t.front,4),i(t.back,5),i(t.left,1),i(t.right,0),i(t.top,2),i(t.bottom,3)}function qp(){return k.director.root.pipeline.pipelineSceneData}T.TextureCube=Yp;var Qp,Zp,Jp,ty,iy,ny,ey,ry,sy,hy,uy,oy,ay,cy,fy=function(){function t(){this._groundAlbedoHDR=new De(.2,.2,.2,1),this._skyColorHDR=new De(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new De(.2,.2,.2,1),this._skyColorLDR=new De(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return t.prototype.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return qp().isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){qp().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return qp().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){qp().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return qp().isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){qp().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}}]),t}();fy.SUN_ILLUM=65e3,fy.SKY_ILLUM=2e4,k.Ambient=fy;var vy="MainFlow",ly="ForwardFlow",dy="ShadowFlow",gy={DEFAULT:100,UI:200};k.RenderPassStage=gy;var wy={bindings:[],layouts:{}},_y={bindings:[],layouts:{}},my=new rd([4,0,7,0],[4,0,9,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,2,1,3]),py=function(){};Qp=py,py.TIME_OFFSET=0,py.SCREEN_SIZE_OFFSET=4,py.NATIVE_SIZE_OFFSET=8,py.PROBE_INFO_OFFSET=12,py.DEBUG_VIEW_MODE_OFFSET=16,py.COUNT=20,py.SIZE=80,py.NAME="CCGlobal",py.BINDING=0,py.DESCRIPTOR=new Dd(Qp.BINDING,1,1,63),py.LAYOUT=new wd(0,Qp.BINDING,Qp.NAME,[new gd("cc_time",16,1),new gd("cc_screenSize",16,1),new gd("cc_nativeSize",16,1),new gd("cc_probeInfo",16,1),new gd("cc_debug_view_mode",16,1)],1),wy.layouts[py.NAME]=py.LAYOUT,wy.bindings[py.BINDING]=py.DESCRIPTOR;var yy=function(){};Zp=yy,yy.MAT_VIEW_OFFSET=0,yy.MAT_VIEW_INV_OFFSET=16,yy.MAT_PROJ_OFFSET=32,yy.MAT_PROJ_INV_OFFSET=48,yy.MAT_VIEW_PROJ_OFFSET=64,yy.MAT_VIEW_PROJ_INV_OFFSET=80,yy.CAMERA_POS_OFFSET=96,yy.SURFACE_TRANSFORM_OFFSET=100,yy.SCREEN_SCALE_OFFSET=104,yy.EXPOSURE_OFFSET=108,yy.MAIN_LIT_DIR_OFFSET=112,yy.MAIN_LIT_COLOR_OFFSET=116,yy.AMBIENT_SKY_OFFSET=120,yy.AMBIENT_GROUND_OFFSET=124,yy.GLOBAL_FOG_COLOR_OFFSET=128,yy.GLOBAL_FOG_BASE_OFFSET=132,yy.GLOBAL_FOG_ADD_OFFSET=136,yy.NEAR_FAR_OFFSET=140,yy.VIEW_PORT_OFFSET=144,yy.COUNT=148,yy.SIZE=592,yy.NAME="CCCamera",yy.BINDING=1,yy.DESCRIPTOR=new Dd(Zp.BINDING,1,1,63),yy.LAYOUT=new wd(0,Zp.BINDING,Zp.NAME,[new gd("cc_matView",25,1),new gd("cc_matViewInv",25,1),new gd("cc_matProj",25,1),new gd("cc_matProjInv",25,1),new gd("cc_matViewProj",25,1),new gd("cc_matViewProjInv",25,1),new gd("cc_cameraPos",16,1),new gd("cc_surfaceTransform",16,1),new gd("cc_screenScale",16,1),new gd("cc_exposure",16,1),new gd("cc_mainLitDir",16,1),new gd("cc_mainLitColor",16,1),new gd("cc_ambientSky",16,1),new gd("cc_ambientGround",16,1),new gd("cc_fogColor",16,1),new gd("cc_fogBase",16,1),new gd("cc_fogAdd",16,1),new gd("cc_nearFar",16,1),new gd("cc_viewPort",16,1)],1),wy.layouts[yy.NAME]=yy.LAYOUT,wy.bindings[yy.BINDING]=yy.DESCRIPTOR;var by=function(){};Jp=by,by.MAT_LIGHT_VIEW_OFFSET=0,by.MAT_LIGHT_VIEW_PROJ_OFFSET=16,by.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=32,by.SHADOW_PROJ_DEPTH_INFO_OFFSET=36,by.SHADOW_PROJ_INFO_OFFSET=40,by.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=44,by.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=48,by.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=52,by.SHADOW_COLOR_OFFSET=56,by.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=60,by.COUNT=64,by.SIZE=256,by.NAME="CCShadow",by.BINDING=2,by.DESCRIPTOR=new Dd(Jp.BINDING,1,1,63),by.LAYOUT=new wd(0,Jp.BINDING,Jp.NAME,[new gd("cc_matLightView",25,1),new gd("cc_matLightViewProj",25,1),new gd("cc_shadowInvProjDepthInfo",16,1),new gd("cc_shadowProjDepthInfo",16,1),new gd("cc_shadowProjInfo",16,1),new gd("cc_shadowNFLSInfo",16,1),new gd("cc_shadowWHPBInfo",16,1),new gd("cc_shadowLPNNInfo",16,1),new gd("cc_shadowColor",16,1),new gd("cc_planarNDInfo",16,1)],1),wy.layouts[by.NAME]=by.LAYOUT,wy.bindings[by.BINDING]=by.DESCRIPTOR;var Ay=function(){};ty=Ay,Ay.CSM_LEVEL_COUNT=4,Ay.CSM_VIEW_DIR_0_OFFSET=0,Ay.CSM_VIEW_DIR_1_OFFSET=16,Ay.CSM_VIEW_DIR_2_OFFSET=32,Ay.CSM_ATLAS_OFFSET=48,Ay.MAT_CSM_VIEW_PROJ_OFFSET=64,Ay.CSM_PROJ_DEPTH_INFO_OFFSET=128,Ay.CSM_PROJ_INFO_OFFSET=144,Ay.CSM_SPLITS_INFO_OFFSET=160,Ay.COUNT=164,Ay.SIZE=656,Ay.NAME="CCCSM",Ay.BINDING=3,Ay.DESCRIPTOR=new Dd(ty.BINDING,1,1,16),Ay.LAYOUT=new wd(0,ty.BINDING,ty.NAME,[new gd("cc_csmViewDir0",16,ty.CSM_LEVEL_COUNT),new gd("cc_csmViewDir1",16,ty.CSM_LEVEL_COUNT),new gd("cc_csmViewDir2",16,ty.CSM_LEVEL_COUNT),new gd("cc_csmAtlas",16,ty.CSM_LEVEL_COUNT),new gd("cc_matCSMViewProj",25,ty.CSM_LEVEL_COUNT),new gd("cc_csmProjDepthInfo",16,ty.CSM_LEVEL_COUNT),new gd("cc_csmProjInfo",16,ty.CSM_LEVEL_COUNT),new gd("cc_csmSplitsInfo",16,1)],1),wy.layouts[Ay.NAME]=Ay.LAYOUT,wy.bindings[Ay.BINDING]=Ay.DESCRIPTOR;var Ey="cc_shadowMap",ky=new Dd(4,16,1,16),Ty=new _d(0,4,Ey,28,1);wy.layouts[Ey]=Ty,wy.bindings[4]=ky;var Sy="cc_environment",Oy=new Dd(5,16,1,16),Ry=new _d(0,5,Sy,31,1);wy.layouts[Sy]=Ry,wy.bindings[5]=Oy;var Iy="cc_diffuseMap",My=new Dd(7,16,1,16),Ny=new _d(0,7,Iy,31,1);wy.layouts[Iy]=Ny,wy.bindings[7]=My;var Cy="cc_spotShadowMap",Ly=new Dd(6,16,1,16),Fy=new _d(0,6,Cy,28,1);wy.layouts[Cy]=Fy,wy.bindings[6]=Ly;var Py=function(){};iy=Py,Py.MAT_WORLD_OFFSET=0,Py.MAT_WORLD_IT_OFFSET=16,Py.LIGHTINGMAP_UVPARAM=32,Py.LOCAL_SHADOW_BIAS=36,Py.REFLECTION_PROBE_DATA1=40,Py.REFLECTION_PROBE_DATA2=44,Py.REFLECTION_PROBE_BLEND_DATA1=48,Py.REFLECTION_PROBE_BLEND_DATA2=52,Py.COUNT=56,Py.SIZE=224,Py.NAME="CCLocal",Py.BINDING=0,Py.DESCRIPTOR=new Dd(0,1,1,49,1,1),Py.LAYOUT=new wd(2,0,iy.NAME,[new gd("cc_matWorld",25,1),new gd("cc_matWorldIT",25,1),new gd("cc_lightingMapUVParam",16,1),new gd("cc_localShadowBias",16,1),new gd("cc_reflectionProbeData1",16,1),new gd("cc_reflectionProbeData2",16,1),new gd("cc_reflectionProbeBlendData1",16,1),new gd("cc_reflectionProbeBlendData2",16,1)],1),_y.layouts[Py.NAME]=Py.LAYOUT,_y.bindings[0]=Py.DESCRIPTOR;var By=function(){};ny=By,By.WORLD_BOUND_CENTER=0,By.WORLD_BOUND_HALF_EXTENTS=ny.WORLD_BOUND_CENTER+4,By.COUNT=ny.WORLD_BOUND_HALF_EXTENTS+4,By.SIZE=4*ny.COUNT,By.NAME="CCWorldBound",By.BINDING=0,By.DESCRIPTOR=new Dd(ny.BINDING,1,1,33,1,1),By.LAYOUT=new wd(2,ny.BINDING,ny.NAME,[new gd("cc_worldBoundCenter",16,1),new gd("cc_worldBoundHalfExtents",16,1)],1),_y.layouts[By.NAME]=By.LAYOUT,_y.bindings[By.BINDING]=By.DESCRIPTOR;var Dy="a_matWorld0",Uy="a_sh_linear_const_r",xy=function(){};ey=xy,xy.BATCHING_COUNT=10,xy.MAT_WORLDS_OFFSET=0,xy.COUNT=16*ey.BATCHING_COUNT,xy.SIZE=4*ey.COUNT,xy.NAME="CCLocalBatched",xy.BINDING=0,xy.DESCRIPTOR=new Dd(ey.BINDING,1,1,33,1,1),xy.LAYOUT=new wd(2,ey.BINDING,ey.NAME,[new gd("cc_matWorlds",25,ey.BATCHING_COUNT)],1),_y.layouts[xy.NAME]=xy.LAYOUT,_y.bindings[xy.BINDING]=xy.DESCRIPTOR;var Gy=function(){};ry=Gy,Gy.LIGHTS_PER_PASS=1,Gy.LIGHT_POS_OFFSET=0,Gy.LIGHT_COLOR_OFFSET=4,Gy.LIGHT_SIZE_RANGE_ANGLE_OFFSET=8,Gy.LIGHT_DIR_OFFSET=12,Gy.LIGHT_BOUNDING_SIZE_VS_OFFSET=16,Gy.COUNT=20,Gy.SIZE=80,Gy.NAME="CCForwardLight",Gy.BINDING=1,Gy.DESCRIPTOR=new Dd(ry.BINDING,2,1,16,1,1),Gy.LAYOUT=new wd(2,ry.BINDING,ry.NAME,[new gd("cc_lightPos",16,1),new gd("cc_lightColor",16,1),new gd("cc_lightSizeRangeAngle",16,1),new gd("cc_lightDir",16,1),new gd("cc_lightBoundingSizeVS",16,1)],1),_y.layouts[Gy.NAME]=Gy.LAYOUT,_y.bindings[Gy.BINDING]=Gy.DESCRIPTOR;var jy=function(){};jy.LIGHTS_PER_PASS=10;var Hy=function(){};sy=Hy,Hy.JOINTS_TEXTURE_INFO_OFFSET=0,Hy.COUNT=sy.JOINTS_TEXTURE_INFO_OFFSET+4,Hy.SIZE=4*sy.COUNT,Hy.NAME="CCSkinningTexture",Hy.BINDING=3,Hy.DESCRIPTOR=new Dd(sy.BINDING,1,1,1,1,1),Hy.LAYOUT=new wd(2,sy.BINDING,sy.NAME,[new gd("cc_jointTextureInfo",16,1)],1),_y.layouts[Hy.NAME]=Hy.LAYOUT,_y.bindings[Hy.BINDING]=Hy.DESCRIPTOR;var Vy=function(){};hy=Vy,Vy.JOINTS_ANIM_INFO_OFFSET=0,Vy.COUNT=hy.JOINTS_ANIM_INFO_OFFSET+4,Vy.SIZE=4*hy.COUNT,Vy.NAME="CCSkinningAnimation",Vy.BINDING=2,Vy.DESCRIPTOR=new Dd(hy.BINDING,1,1,1,1,1),Vy.LAYOUT=new wd(2,hy.BINDING,hy.NAME,[new gd("cc_jointAnimInfo",16,1)],1),_y.layouts[Vy.NAME]=Vy.LAYOUT,_y.bindings[Vy.BINDING]=Vy.DESCRIPTOR;var $y="a_jointAnimInfo",Wy=function(){function t(){}return t.initLayout=function(i){t.yh=i,t.$=12*i,t.sn=4*t.$,t.LAYOUT.members[0].count=3*i},e(t,null,[{key:"JOINT_UNIFORM_CAPACITY",get:function(){return t.yh}},{key:"COUNT",get:function(){return t.$}},{key:"SIZE",get:function(){return t.sn}}]),t}();function zy(t){Wy.initLayout(t),_y.layouts[Wy.NAME]=Wy.LAYOUT,_y.bindings[Wy.BINDING]=Wy.DESCRIPTOR}uy=Wy,Wy.yh=0,Wy.$=0,Wy.sn=0,Wy.NAME="CCSkinning",Wy.BINDING=3,Wy.DESCRIPTOR=new Dd(uy.BINDING,1,1,1,1,1),Wy.LAYOUT=new wd(2,uy.BINDING,uy.NAME,[new gd("cc_joints",16,1)],1);var Xy=function(){};oy=Xy,Xy.MAX_MORPH_TARGET_COUNT=60,Xy.OFFSET_OF_WEIGHTS=0,Xy.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=240,Xy.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=244,Xy.OFFSET_OF_VERTICES_COUNT=248,Xy.COUNT_BASE_4_BYTES=64,Xy.SIZE=256,Xy.NAME="CCMorph",Xy.BINDING=4,Xy.DESCRIPTOR=new Dd(oy.BINDING,1,1,1,1,1),Xy.LAYOUT=new wd(2,oy.BINDING,oy.NAME,[new gd("cc_displacementWeights",16,15),new gd("cc_displacementTextureInfo",16,1)],1),_y.layouts[Xy.NAME]=Xy.LAYOUT,_y.bindings[Xy.BINDING]=Xy.DESCRIPTOR;var Yy=function(){};ay=Yy,Yy.NAME="CCUILocal",Yy.BINDING=5,Yy.DESCRIPTOR=new Dd(ay.BINDING,2,1,1,1,1),Yy.LAYOUT=new wd(2,ay.BINDING,ay.NAME,[new gd("cc_local_data",16,1)],1),_y.layouts[Yy.NAME]=Yy.LAYOUT,_y.bindings[Yy.BINDING]=Yy.DESCRIPTOR;var Ky=function(){};cy=Ky,Ky.SH_LINEAR_CONST_R_OFFSET=0,Ky.SH_LINEAR_CONST_G_OFFSET=4,Ky.SH_LINEAR_CONST_B_OFFSET=8,Ky.SH_QUADRATIC_R_OFFSET=12,Ky.SH_QUADRATIC_G_OFFSET=16,Ky.SH_QUADRATIC_B_OFFSET=20,Ky.SH_QUADRATIC_A_OFFSET=24,Ky.COUNT=28,Ky.SIZE=112,Ky.NAME="CCSH",Ky.BINDING=6,Ky.DESCRIPTOR=new Dd(6,1,1,16,1,1),Ky.LAYOUT=new wd(2,6,cy.NAME,[new gd("cc_sh_linear_const_r",16,1),new gd("cc_sh_linear_const_g",16,1),new gd("cc_sh_linear_const_b",16,1),new gd("cc_sh_quadratic_r",16,1),new gd("cc_sh_quadratic_g",16,1),new gd("cc_sh_quadratic_b",16,1),new gd("cc_sh_quadratic_a",16,1)],1),_y.layouts[Ky.NAME]=Ky.LAYOUT,_y.bindings[6]=Ky.DESCRIPTOR;var qy="cc_jointTexture",Qy=new Dd(7,16,1,1,1,4),Zy=new _d(2,7,qy,28,1);_y.layouts[qy]=Zy,_y.bindings[7]=Qy;var Jy="cc_realtimeJoint",tb=new Dd(7,16,1,1,1,4),ib=new _d(2,7,Jy,28,1);_y.layouts[Jy]=ib,_y.bindings[7]=tb;var nb="cc_PositionDisplacements",eb=new Dd(8,16,1,1,1,4),rb=new _d(2,8,nb,28,1);_y.layouts[nb]=rb,_y.bindings[8]=eb;var sb="cc_NormalDisplacements",hb=new Dd(9,16,1,1,1,4),ub=new _d(2,9,sb,28,1);_y.layouts[sb]=ub,_y.bindings[9]=hb;var ob="cc_TangentDisplacements",ab=new Dd(10,16,1,1,1,4),cb=new _d(2,10,ob,28,1);_y.layouts[ob]=cb,_y.bindings[10]=ab;var fb="cc_lightingMap",vb=11,lb=new Dd(vb,16,1,16,1,4),db=new _d(2,vb,fb,28,1);_y.layouts[fb]=db,_y.bindings[11]=lb;var gb="cc_spriteTexture",wb=new Dd(12,16,1,16,1,4),_b=new _d(2,12,gb,28,1);_y.layouts[gb]=_b,_y.bindings[12]=wb;var mb="cc_reflectionProbeCubemap",pb=13,yb=new Dd(pb,16,1,16,1,9),bb=new _d(2,pb,mb,31,1);_y.layouts[mb]=bb,_y.bindings[13]=yb;var Ab="cc_reflectionProbePlanarMap",Eb=14,kb=new Dd(Eb,16,1,16,1,4),Tb=new _d(2,Eb,Ab,28,1);_y.layouts[Ab]=Tb,_y.bindings[14]=kb;var Sb="cc_reflectionProbeDataMap",Ob=new Dd(15,16,1,16,1,4),Rb=new _d(2,15,Sb,28,1);_y.layouts[Sb]=Rb,_y.bindings[15]=Ob,new Dd(16,16,1,16,1,9),new _d(2,16,"cc_reflectionProbeBlendCubemap",31,1);var Ib,Mb,Nb,Cb,Lb=Pm.makeMaskExclude([Pm.BitMask.UI_2D,Pm.BitMask.GIZMOS,Pm.BitMask.EDITOR,Pm.BitMask.SCENE_GIZMO,Pm.BitMask.PROFILER]),Fb=Pm.makeMaskExclude([Pm.BitMask.UI_2D,Pm.BitMask.PROFILER]),Pb=Pm.Enum.ALL;function Bb(t){if(Ib)return Ib;var i=new vd(1,0,Db(t)?11:35,16,16,0,1,1,1,1);return Ib=t.createTexture(i)}function Db(t){return!(3&~t.getFormatFeatures(11)||6===t.gfxAPI)}function Ub(){return!(!k.rendering||!k.rendering.enableEffectImport)}t("pipeline",Object.freeze({__proto__:null,CAMERA_DEFAULT_MASK:Lb,CAMERA_EDITOR_MASK:Fb,ENABLE_PROBE_BLEND:!1,INST_JOINT_ANIM_INFO:$y,INST_MAT_WORLD:Dy,INST_SH:Uy,JOINT_UNIFORM_CAPACITY:30,MODEL_ALWAYS_MASK:Pb,ModelLocalBindings:{UBO_LOCAL:0,UBO_FORWARD_LIGHTS:1,UBO_SKINNING_ANIMATION:2,UBO_SKINNING_TEXTURE:3,UBO_MORPH:4,UBO_UI_LOCAL:5,UBO_SH:6,SAMPLER_JOINTS:7,SAMPLER_MORPH_POSITION:8,SAMPLER_MORPH_NORMAL:9,SAMPLER_MORPH_TANGENT:10,SAMPLER_LIGHTMAP:11,SAMPLER_SPRITE:12,SAMPLER_REFLECTION_PROBE_CUBE:13,SAMPLER_REFLECTION_PROBE_PLANAR:14,SAMPLER_REFLECTION_PROBE_DATA_MAP:15,COUNT:16},PIPELINE_FLOW_FORWARD:ly,PIPELINE_FLOW_MAIN:vy,PIPELINE_FLOW_SHADOW:dy,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",PipelineGlobalBindings:{UBO_GLOBAL:0,UBO_CAMERA:1,UBO_SHADOW:2,UBO_CSM:3,SAMPLER_SHADOWMAP:4,SAMPLER_ENVIRONMENT:5,SAMPLER_SPOT_SHADOW_MAP:6,SAMPLER_DIFFUSEMAP:7,COUNT:8},RenderPassStage:gy,RenderPriority:{MIN:0,MAX:255,DEFAULT:128},SetIndex:{GLOBAL:0,MATERIAL:1,LOCAL:2,COUNT:3},UBOCSM:Ay,UBOCSMEnum:{CSM_LEVEL_COUNT:4,CSM_VIEW_DIR_0_OFFSET:0,CSM_VIEW_DIR_1_OFFSET:16,CSM_VIEW_DIR_2_OFFSET:32,CSM_ATLAS_OFFSET:48,MAT_CSM_VIEW_PROJ_OFFSET:64,CSM_PROJ_DEPTH_INFO_OFFSET:128,CSM_PROJ_INFO_OFFSET:144,CSM_SPLITS_INFO_OFFSET:160,COUNT:164,SIZE:656},UBOCamera:yy,UBOCameraEnum:{MAT_VIEW_OFFSET:0,MAT_VIEW_INV_OFFSET:16,MAT_PROJ_OFFSET:32,MAT_PROJ_INV_OFFSET:48,MAT_VIEW_PROJ_OFFSET:64,MAT_VIEW_PROJ_INV_OFFSET:80,CAMERA_POS_OFFSET:96,SURFACE_TRANSFORM_OFFSET:100,SCREEN_SCALE_OFFSET:104,EXPOSURE_OFFSET:108,MAIN_LIT_DIR_OFFSET:112,MAIN_LIT_COLOR_OFFSET:116,AMBIENT_SKY_OFFSET:120,AMBIENT_GROUND_OFFSET:124,GLOBAL_FOG_COLOR_OFFSET:128,GLOBAL_FOG_BASE_OFFSET:132,GLOBAL_FOG_ADD_OFFSET:136,NEAR_FAR_OFFSET:140,VIEW_PORT_OFFSET:144,COUNT:148,SIZE:592},UBODeferredLight:jy,UBOForwardLight:Gy,UBOForwardLightEnum:{LIGHTS_PER_PASS:1,LIGHT_POS_OFFSET:0,LIGHT_COLOR_OFFSET:4,LIGHT_SIZE_RANGE_ANGLE_OFFSET:8,LIGHT_DIR_OFFSET:12,LIGHT_BOUNDING_SIZE_VS_OFFSET:16,COUNT:20,SIZE:80},UBOGlobal:py,UBOGlobalEnum:{TIME_OFFSET:0,SCREEN_SIZE_OFFSET:4,NATIVE_SIZE_OFFSET:8,PROBE_INFO_OFFSET:12,DEBUG_VIEW_MODE_OFFSET:16,COUNT:20,SIZE:80},UBOLocal:Py,UBOLocalBatched:xy,UBOLocalEnum:{MAT_WORLD_OFFSET:0,MAT_WORLD_IT_OFFSET:16,LIGHTINGMAP_UVPARAM:32,LOCAL_SHADOW_BIAS:36,REFLECTION_PROBE_DATA1:40,REFLECTION_PROBE_DATA2:44,REFLECTION_PROBE_BLEND_DATA1:48,REFLECTION_PROBE_BLEND_DATA2:52,COUNT:56,SIZE:224,BINDING:0},UBOMorph:Xy,UBOMorphEnum:{MAX_MORPH_TARGET_COUNT:60,OFFSET_OF_WEIGHTS:0,OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH:240,OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT:244,OFFSET_OF_VERTICES_COUNT:248,COUNT_BASE_4_BYTES:64,SIZE:256},UBOSH:Ky,UBOSHEnum:{SH_LINEAR_CONST_R_OFFSET:0,SH_LINEAR_CONST_G_OFFSET:4,SH_LINEAR_CONST_B_OFFSET:8,SH_QUADRATIC_R_OFFSET:12,SH_QUADRATIC_G_OFFSET:16,SH_QUADRATIC_B_OFFSET:20,SH_QUADRATIC_A_OFFSET:24,COUNT:28,SIZE:112,BINDING:6},UBOShadow:by,UBOShadowEnum:{MAT_LIGHT_VIEW_OFFSET:0,MAT_LIGHT_VIEW_PROJ_OFFSET:16,SHADOW_INV_PROJ_DEPTH_INFO_OFFSET:32,SHADOW_PROJ_DEPTH_INFO_OFFSET:36,SHADOW_PROJ_INFO_OFFSET:40,SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET:44,SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET:48,SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET:52,SHADOW_COLOR_OFFSET:56,PLANAR_NORMAL_DISTANCE_INFO_OFFSET:60,COUNT:64,SIZE:256},UBOSkinning:Wy,UBOSkinningAnimation:Vy,UBOSkinningTexture:Hy,UBOUILocal:Yy,UBOWorldBound:By,UNIFORM_DIFFUSEMAP_BINDING:7,UNIFORM_ENVIRONMENT_BINDING:5,UNIFORM_JOINT_TEXTURE_BINDING:7,UNIFORM_LIGHTMAP_TEXTURE_BINDING:vb,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:9,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:8,UNIFORM_REALTIME_JOINT_TEXTURE_BINDING:7,UNIFORM_REFLECTION_PROBE_BLEND_CUBEMAP_BINDING:16,UNIFORM_REFLECTION_PROBE_CUBEMAP_BINDING:pb,UNIFORM_REFLECTION_PROBE_DATA_MAP_BINDING:15,UNIFORM_REFLECTION_PROBE_TEXTURE_BINDING:Eb,UNIFORM_SHADOWMAP_BINDING:4,UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING:6,UNIFORM_SPRITE_TEXTURE_BINDING:12,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:10,bindingMappingInfo:my,getDefaultShadowTexture:Bb,globalDescriptorSetLayout:wy,isEnableEffect:Ub,localDescriptorSetLayout:_y,localDescriptorSetLayout_ResizeMaxJoints:zy,supportsR16HalfFloatTexture:function(t){return!(3&~t.getFormatFeatures(8))},supportsR32FloatTexture:Db,supportsRGBA16HalfFloatTexture:function(t){return!(3&~t.getFormatFeatures(41))},supportsRGBA32FloatTexture:function(t){return!(3&~t.getFormatFeatures(44))}}));var xb=4227858432,Gb=66060288,jb=1044480,Hb=function(t,i,n,e){return void 0===e&&(e=0),i<<26&xb|t<<20&Gb|n<<12&jb|4095&e},Vb=function(t){return(t&xb)>>>26},$b=function(t){return(t&Gb)>>>20},Wb=function(t){return(t&jb)>>>12},zb=function(t){return 4095&t},Xb=function(t,i){return 67108863&t|i<<26&xb},Yb=((Mb={})[0]=function(t,i,n){return void 0===n&&(n=0),st(12010,n)},Mb[5]=function(t,i,n){return void 0===n&&(n=0),t[n]},Mb[6]=function(t,i,n){return void 0===n&&(n=0),ls.fromArray(i,t,n)},Mb[7]=function(t,i,n){return void 0===n&&(n=0),ir.fromArray(i,t,n)},Mb[8]=function(t,i,n){return void 0===n&&(n=0),De.fromArray(i,t,n)},Mb[13]=function(t,i,n){return void 0===n&&(n=0),t[n]},Mb[14]=function(t,i,n){return void 0===n&&(n=0),ls.fromArray(i,t,n)},Mb[15]=function(t,i,n){return void 0===n&&(n=0),ir.fromArray(i,t,n)},Mb[16]=function(t,i,n){return void 0===n&&(n=0),De.fromArray(i,t,n)},Mb[21]=function(t,i,n){return void 0===n&&(n=0),_r.fromArray(i,t,n)},Mb[25]=function(t,i,n){return void 0===n&&(n=0),Kr.fromArray(i,t,n)},Mb),Kb=((Nb={})[0]=function(t,i,n){return void 0===n&&(n=0),st(12010,n)},Nb[5]=function(t,i,n){return void 0===n&&(n=0),t[n]=i},Nb[6]=function(t,i,n){return void 0===n&&(n=0),ls.toArray(t,i,n)},Nb[7]=function(t,i,n){return void 0===n&&(n=0),ir.toArray(t,i,n)},Nb[8]=function(t,i,n){return void 0===n&&(n=0),De.toArray(t,i,n)},Nb[13]=function(t,i,n){return void 0===n&&(n=0),t[n]=i},Nb[14]=function(t,i,n){return void 0===n&&(n=0),ls.toArray(t,i,n)},Nb[15]=function(t,i,n){return void 0===n&&(n=0),ir.toArray(t,i,n)},Nb[16]=function(t,i,n){return void 0===n&&(n=0),De.toArray(t,i,n)},Nb[21]=function(t,i,n){return void 0===n&&(n=0),_r.toArray(t,i,n)},Nb[25]=function(t,i,n){return void 0===n&&(n=0),Kr.toArray(t,i,n)},Nb),qb=((Cb={})[5]=function(t){return"number"==typeof t},Cb[13]=function(t){return"number"==typeof t},Cb[6]=function(t){return!!(t instanceof ls)},Cb[14]=function(t){return!!(t instanceof ls)},Cb[7]=function(t){return!!(t instanceof ir)},Cb[15]=function(t){return!!(t instanceof ir)},Cb[8]=function(t){return!!(t instanceof De)},Cb[16]=function(t){return!!(t instanceof De||t instanceof cr||t instanceof Cr)},Cb[21]=function(t){return!!(t instanceof _r)},Cb[25]=function(t){return!!(t instanceof Kr)},Cb),Qb=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Zb(t){switch(t){case 1:case 5:case 9:case 13:return Qb[0];case 2:case 6:case 10:case 14:return Qb[1];case 4:case 8:case 12:case 16:return Qb[2];case 25:return Qb[3];case 28:return"default-texture";case 31:return"default-cube-texture";case 29:return"default-array-texture";case 30:return"default-3d-texture"}return Qb[0]}function Jb(t){switch(t){case 28:return"-texture";case 31:return"-cube-texture";case 29:return"-array-texture";case 30:return"-3d-texture";default:return"-unknown"}}function tA(t,i){for(var n=Object.entries(i),e=!1,r=0;r<n.length;r++)t[n[r][0]]!==n[r][1]&&(t[n[r][0]]=n[r][1],e=!0);return e}function iA(t,i){switch(t.type){case"boolean":return"number"==typeof i?i.toString():i?"1":"0";case"string":return void 0!==i?i:t.options[0];case"number":return void 0!==i?i.toString():t.range[0].toString();default:return st(16369),"-1"}}function nA(t,i){for(var n=[],e=0;e<i.length;e++){var r=i[e],s=r.name,h=t[s],u=iA(r,h),o=!h||"0"===h;n.push({name:s,value:u,isDefault:o})}return n}function eA(t,i){return t+i.reduce((function(t,i){return i.isDefault?t:t+"|"+i.name+i.value}),"")}function rA(t,i){for(var n=0;n<t.length;n++){var e=t[n];if("!"===e[0]){if(i[e.slice(1)])return!1}else if(!i[e])return!1}return!0}function sA(t,i,n){for(var e=[],r=t.attributes,s=0;s<r.length;s++)rA(r[s].defines,n)&&e.push(i[s]);return e}function hA(t,i){var n=t.defines;if(t.uber){for(var e="",r=0;r<n.length;r++){var s=n[r],h=i[s.name];if(h&&s._map){var u=s._map(h);e+=""+s._offset+u+"|"}}return""+e+t.hash}for(var o=0,a=0;a<n.length;a++){var c=n[a],f=i[c.name];f&&c._map&&(o|=c._map(f)<<c._offset)}return o.toString(16)+"|"+t.hash}var uA=new Map;function oA(t,i){if(i.count)return t+og(i.type)*i.count;var n=uA.get(i.name);return void 0!==n?t+og(i.type)*n:(ut(16345,i.name),t)}function aA(t){for(var i={},n=0;n<t.blocks.length;n++)for(var e=t.blocks[n],r=e.members,s=0,h=0;h<r.length;h++){var u=r[h];i[u.name]=Hb(e.binding,u.type,u.count,s),s+=(og(u.type)>>2)*u.count}for(var o=0;o<t.samplerTextures.length;o++){var a=t.samplerTextures[o];i[a.name]=Hb(a.binding,a.type,a.count)}return i}function cA(t){return Math.ceil(Math.log2(Math.max(t,2)))}function fA(t){for(var i=0,n=function(){var n=t.defines[e],r=1;if("number"===n.type){var s=n.range;r=cA(s[1]-s[0]+1),n._map=function(t){return t-s[0]}}else"string"===n.type?(r=cA(n.options.length),n._map=function(t){return Math.max(0,n.options.findIndex((function(i){return i===t})))}):"boolean"===n.type&&(n._map=function(t){return t?1:0});n._offset=i,i+=r},e=0;e<t.defines.length;e++)n();for(var r in i>31&&(t.uber=!0),t.constantMacros="",t.builtins.statistics)t.constantMacros+="#define "+r+" "+t.builtins.statistics[r]+"\n"}function vA(t){var i=Object.keys(t).reduce((function(i,n){return i.reduce((function(i,e){for(var s=t[n],h=0;h<s.length;++h){var u=r({},e);u[n]=s[h],i.push(u)}return i}),[])}),[{}]);return i}function lA(t){for(var i=0;i<t.techniques.length;i++)for(var n=t.techniques[i],e=0;e<n.passes.length;e++){var r=n.passes[e];void 0!==r.propertyIndex&&void 0===r.properties&&(r.properties=n.passes[r.propertyIndex].properties)}}uA.set("cc_joints",Wy.LAYOUT.members[0].count),uA.set("cc_lightPos",1),uA.set("cc_lightColor",1),uA.set("cc_lightSizeRangeAngle",1),uA.set("cc_lightDir",1),uA.set("cc_lightBoundingSizeVS",1);var dA=new Ud;function gA(t,i,n,e){for(var r=t.builtins[e],s=[],h=function(){var t=r.blocks[u],i=n.layouts[t.name],e=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&e&&e.descriptorType&ig))return st(16348,t.name),1;s.push(i)},u=0;u<r.blocks.length;u++)h();Array.prototype.unshift.apply(i.shaderInfo.blocks,s);for(var o=[],a=function(){var t=r.samplerTextures[c],i=n.layouts[t.name],e=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&e&&e.descriptorType&ng))return st(16349,t.name),1;o.push(i)},c=0;c<r.samplerTextures.length;c++)a();Array.prototype.unshift.apply(i.shaderInfo.samplerTextures,o)}var wA=function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var i=t.prototype;return i.register=function(t){for(var i=0;i<t.shaders.length;i++)this.define(t.shaders[i]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var e=t.techniques[n],r=0;r<e.passes.length;r++){var s=e.passes[r];void 0!==s.propertyIndex&&void 0===s.properties&&(s.properties=e.passes[s.propertyIndex].properties)}},i.define=function(t){var i=this._templates[t.name];if(i&&i.hash===t.hash)return i;var n=r({},t);if(fA(n),this._templates[t.name]=n,!this._templateInfos[n.hash]){var e={};e.samplerStartBinding=n.blocks.length,e.shaderInfo=new Td,e.blockSizes=[],e.bindings=[];for(var s=0;s<n.blocks.length;s++){var h=n.blocks[s];e.blockSizes.push(h.members.reduce(oA,0)),e.bindings.push(new Dd(h.binding,1,1,h.stageFlags)),e.shaderInfo.blocks.push(new wd(1,h.binding,h.name,h.members.map((function(t){return new gd(t.name,t.type,t.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var o=n.samplerTextures[u];e.bindings.push(new Dd(o.binding,16,o.count,o.stageFlags)),e.shaderInfo.samplerTextures.push(new _d(1,o.binding,o.name,o.type,o.count))}for(var a=0;a<n.samplers.length;a++){var c=n.samplers[a];e.bindings.push(new Dd(c.binding,32,c.count,c.stageFlags)),e.shaderInfo.samplers.push(new md(1,c.binding,c.name,c.count))}for(var f=0;f<n.textures.length;f++){var v=n.textures[f];e.bindings.push(new Dd(v.binding,64,v.count,v.stageFlags)),e.shaderInfo.textures.push(new pd(1,v.binding,v.name,v.type,v.count))}for(var l=0;l<n.buffers.length;l++){var d=n.buffers[l];e.bindings.push(new Dd(d.binding,4,1,d.stageFlags)),e.shaderInfo.buffers.push(new bd(1,d.binding,d.name,1,d.memoryAccess))}for(var g=0;g<n.images.length;g++){var w=n.images[g];e.bindings.push(new Dd(w.binding,128,w.count,w.stageFlags)),e.shaderInfo.images.push(new yd(1,w.binding,w.name,w.type,w.count,w.memoryAccess))}for(var _=0;_<n.subpassInputs.length;_++){var m=n.subpassInputs[_];e.bindings.push(new Dd(m.binding,256,m.count,m.stageFlags)),e.shaderInfo.subpassInputs.push(new Ad(1,m.binding,m.name,m.count))}e.gfxAttributes=[];for(var p=0;p<n.attributes.length;p++){var y=n.attributes[p];e.gfxAttributes.push(new kd(y.name,y.format,y.isNormalized,0,y.isInstanced,y.location))}gA(n,e,_y,"locals"),e.shaderInfo.stages.push(new Ed(1,"")),e.shaderInfo.stages.push(new Ed(16,"")),e.handleMap=aA(n),e.setLayouts=[],this._templateInfos[n.hash]=e}return n},i.getTemplate=function(t){return this._templates[t]},i.getTemplateInfo=function(t){var i=this._templates[t].hash;return this._templateInfos[i]},i.getDescriptorSetLayout=function(t,i,n){void 0===n&&(n=!1);var e=this._templates[i],r=this._templateInfos[e.hash];return r.setLayouts.length||(dA.bindings=r.bindings,r.setLayouts[1]=t.createDescriptorSetLayout(dA),dA.bindings=_y.bindings,r.setLayouts[2]=t.createDescriptorSetLayout(dA)),r.setLayouts[n?2:1]},i.hasProgram=function(t){return void 0!==this._templates[t]},i.getKey=function(t,i){return hA(this._templates[t],i)},i.destroyShaderByDefines=function(t){var i=this,n=Object.keys(t);if(n.length)for(var e=n.map((function(i){var n=t[i];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+i+n)})),r=Object.keys(this._cache).filter((function(t){return e.every((function(n){return n.test(i._cache[t].name)}))})),s=0;s<r.length;s++){var h=r[s],u=this._cache[h];q("destroyed shader "+u.name),u.destroy(),delete this._cache[h]}},i.getGFXShader=function(t,i,n,e,r){Object.assign(n,e.macros),r||(r=this.getKey(i,n));var s=this._cache[r];if(s)return s;var h=this._templates[i],u=this._templateInfos[h.hash];u.pipelineLayout||(this.getDescriptorSetLayout(t,i),gA(h,u,wy,"globals"),u.setLayouts[0]=e.descriptorSetLayout,u.pipelineLayout=t.createPipelineLayout(new Gd(u.setLayouts)));var o=nA(n,h.defines),a=e.constantMacros+h.constantMacros+o.reduce((function(t,i){return t+"#define "+i.name+" "+i.value+"\n"}),""),c=h.glsl3,f=_A(t);f?c=h[f]:ut(16346),u.shaderInfo.stages[0].source=a+c.vert,u.shaderInfo.stages[1].source=a+c.frag,u.shaderInfo.attributes=sA(h,u.gfxAttributes,n),u.shaderInfo.name=eA(i,o);var v=u.shaderInfo;return this._cache[r]=t.createShader(v)},t}();function _A(t){switch(t.gfxAPI){case 1:case 6:return"glsl1";case 2:case 7:return"glsl3";default:return"glsl4"}}var mA,pA,yA,bA,AA,EA,kA,TA=new wA;k.programLib=TA;var SA=["planar-shadow","skybox","deferred-lighting","bloom","hbao","copy-pass","post-process","profiler","splash-screen","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer","ssss-blur","float-output-process"],OA=t("EffectAsset",Ko("cc.EffectAsset")((kA=function(t){function i(i){var n;return(n=t.call(this,i)||this).techniques=yA&&yA(),n.shaders=bA&&bA(),n.combinations=AA&&AA(),n.hideInEditor=EA&&EA(),n}s(i,t),i.register=function(t){i.bh[t.name]=t,i.Ah=!1},i.remove=function(t){if("string"!=typeof t)i.bh[t.name]&&i.bh[t.name]===t&&delete i.bh[t.name];else{if(i.bh[t])return void delete i.bh[t];for(var n in i.bh)if(i.bh[n]._uuid===t)return void delete i.bh[n]}},i.get=function(t){if(i.bh[t])return i.bh[t];for(var n in i.bh)if(i.bh[n]._uuid===t)return i.bh[n];return SA.includes(t)&&st(16101,t),null},i.getAll=function(){return i.bh},i.isLayoutValid=function(){return i.Ah},i.setLayoutValid=function(){i.Ah=!0};var n=i.prototype;return n.onLoaded=function(){if(k.rendering&&k.rendering.enableEffectImport){lA(this);var t=k.rendering.programLib;t.addEffect(this),t.init(Hg.gfxDevice)}else TA.register(this);i.register(this),k.game.once(k.Game.EVENT_RENDERER_INITED,this.Eh,this)},n.Eh=function(){var t=this;if(k.rendering&&k.rendering.enableEffectImport)k.rendering.programLib.precompileEffect(Hg.gfxDevice,this);else for(var i=k.director.root,n=function(){var n=t.shaders[e],r=t.combinations[e];if(!r)return 1;vA(r).forEach((function(t){return TA.getGFXShader(Hg.gfxDevice,n.name,t,i.pipeline)}))},e=0;e<this.shaders.length;e++)n()},n.destroy=function(){return i.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var e=i.get("builtin-unlit");this.name="builtin-unlit",this.shaders=e.shaders,this.combinations=e.combinations,this.techniques=e.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},i}(kw),kA.bh={},kA.Ah=!0,yA=xo((pA=kA).prototype,"techniques",[oa],(function(){return[]})),bA=xo(pA.prototype,"shaders",[oa],(function(){return[]})),AA=xo(pA.prototype,"combinations",[oa],(function(){return[]})),EA=xo(pA.prototype,"hideInEditor",[oa,ca],(function(){return!1})),mA=pA))||mA);k.EffectAsset=OA;var RA=function(t,i){return!(t.length>i.length)||47===t.charCodeAt(i.length)},IA=function(t){var i=t.uuids,n=t.paths,e=t.types,r=t.deps,s=t.paths=Object.create(null);if(!1===t.debug){for(var h=0,u=i.length;h<u;h++)i[h]=ow(i[h]);for(var o in n){var a=n[o],c=a[1];a[1]=e[c]}}else{for(var f=Object.create(null),v=0,l=i.length;v<l;v++){var d=i[v];i[v]=f[d]=ow(d)}i=f}for(var g in n){var w=n[g];s[i[g]]=w}var _=t.scenes;for(var m in _){var p=_[m];_[m]=i[p]}var y=t.packs;for(var b in y)for(var A=y[b],E=0;E<A.length;++E)A[E]=i[A[E]];var k=t.versions;if(k)for(var T in k)for(var S=k[T],O=0;O<S.length;O+=2){var R=S[O];S[O]=i[R]||R}var I=t.redirect;if(I)for(var M=0;M<I.length;M+=2)I[M]=i[I[M]],I[M+1]=r[I[M+1]];if(t.extensionMap){var N=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return 1;t.extensionMap[n].forEach((function(e,r){t.extensionMap[n][r]=i[e]||e}))};for(var C in t.extensionMap)N(C)}},MA=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new zg,this.scenes=new zg,this.paths=new zg}var i=t.prototype;return i.init=function(t){var i=this;IA(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this.kh(t.uuids),this.Th(t.paths),this.Sh(t.scenes),this.Oh(t.packs),this.Rh(t.versions),this.Ih(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return 1;t.extensionMap[n].forEach((function(t){var e=i.assetInfos.get(t);e&&(e.extension=n)}))};for(var e in t.extensionMap)n(e)},i.getInfoWithPath=function(t,i){if(!t)return null;t=lw(t);var n=this.paths.get(t);if(n){if(!i)return n[0];for(var e=0,r=n.length;e<r;e++){var s=n[e];if(ii(s.ctor,i))return s}}return null},i.getDirWithPath=function(t,i,n){"/"===(t=lw(t))[t.length-1]&&(t=t.slice(0,-1));var e=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(t)&&RA(r,t)||!t)for(var s=0,h=n.length;s<h;s++){var u=n[s];i&&!ii(u.ctor,i)||e.push(u)}})),e},i.getAssetInfo=function(t){return this.assetInfos.get(t)||null},i.getSceneInfo=function(t){t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);var i=this.scenes.find((function(i,n){return n.endsWith(t)}));return i},i.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},i.kh=function(t){if(t){this.assetInfos.clear();for(var i=0,n=t.length;i<n;i++){var e=t[i];this.assetInfos.add(e,{uuid:e})}}},i.Th=function(t){if(t){var i=this.paths;for(var n in i.clear(),t){var e=t[n],r=e[0],s=e[1],h=3===e.length,u=this.assetInfos.get(n);u.path=r,u.ctor=vi(s),i.has(r)?h?i.get(r).push(u):i.get(r).unshift(u):i.add(r,[u])}}},i.Sh=function(t){if(t){var i=this.scenes;i.clear();var n=this.assetInfos;for(var e in t){var r=t[e],s=n.get(r);s.url=e,i.add(e,s)}}},i.Oh=function(t){if(t){var i=this.assetInfos;for(var n in t){var e=t[n],r={uuid:n,packedUuids:e,ext:".json"};i.add(n,r);for(var s=0,h=e.length;s<h;s++){var u=e[s],o=i.get(u),a=o.packs;a?1===h?a.unshift(r):a.push(r):o.packs=[r]}}}},i.Rh=function(t){if(t){var i=this.assetInfos,n=t.import;if(n)for(var e=0,r=n.length;e<r;e+=2){var s=n[e];i.get(s).ver=n[e+1]}if(n=t.native)for(var h=0,u=n.length;h<u;h+=2){var o=n[h];i.get(o).nativeVer=n[h+1]}}},i.Ih=function(t){if(t)for(var i=this.assetInfos,n=0,e=t.length;n<e;n+=2){var r=t[n];i.get(r).redirect=t[n+1]}},t}();function NA(t,i){t._uuid&&i.push(t._uuid)}function CA(t,i){for(var n=Object.getOwnPropertyNames(t),e=0;e<n.length;e++){var r=n[e];if("node"!==r&&"__eventTargets"!==r){var s=t[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var h=0;h<s.length;h++){var u=s[h];u instanceof kw&&NA(u,i)}else if(s.constructor&&s.constructor!==Object)s instanceof kw&&NA(s,i);else for(var o=Object.getOwnPropertyNames(s),a=0;a<o.length;a++){var c=s[o[a]];c instanceof kw&&NA(c,i)}}}}function LA(t,i){for(var n=0;n<t._components.length;n++)CA(t._components[n],i);for(var e=0;e<t._children.length;e++)LA(t._children[e],i)}function FA(t,i,n,e){n.push(t._uuid);for(var r=pm.getDeps(t._uuid),s=0,h=r.length;s<h;s++){var u=Yg.get(r[s]);if(u){var o=u._uuid;o in i?i[o]+=e:i[o]=u.refCount+e,n.includes(o)||FA(u,i,n,e)}}}var PA=[];function BA(t){var i=Object.create(null);if(i[t._uuid]=t.refCount,FA(t,i,PA,-1),PA.length=0,0!==i[t._uuid])return i[t._uuid];for(var n in i)0!==i[n]&&FA(Yg.get(n),i,PA,1);return PA.length=0,i[t._uuid]}var DA=function(){function t(){this.Mh=new zg,this.Nh=new zg,this.Ch=!1,this.Lh=[]}var i=t.prototype;return i.addIgnoredAsset=function(t){this.Lh.push(t._uuid)},i.init=function(){this.Mh.clear(),this.Nh.clear()},i._addPersistNodeRef=function(t){var i=[];LA(t,i);for(var n=0,e=i.length;n<e;n++){var r=Yg.get(i[n]);r&&r.addRef()}this.Mh.add(t.uuid,i)},i._removePersistNodeRef=function(t){if(this.Mh.has(t.uuid)){for(var i=this.Mh.get(t.uuid),n=0,e=i.length;n<e;n++){var r=Yg.get(i[n]);r&&r.decRef()}this.Mh.remove(t.uuid)}},i._autoRelease=function(t,i,n){if(t){for(var e=pm.getDeps(t.uuid),r=0,s=e.length;r<s;r++){var h=Yg.get(e[r]);h&&h.decRef(t.autoReleaseAssets)}var u=pm._depends.get(t.uuid);if(u&&u.persistDeps)for(var o=u.persistDeps,a=0,c=o.length;a<c;a++){var f=Yg.get(o[a]);f&&f.decRef(t.autoReleaseAssets)}t.uuid!==i.uuid&&pm.remove(t.uuid)}var v=pm._depends.get(i.uuid);for(var l in v&&(v.persistDeps=[]),n){for(var g,w,_=n[l],m=this.Mh.get(_.uuid),p=d(m);!(w=p()).done;){var y=w.value,b=Yg.get(y);b&&b.addRef()}v&&(g=v.persistDeps).push.apply(g,m)}},i.tryRelease=function(t,i){void 0===i&&(i=!1),t instanceof kw&&(i?this.Fh(t,i):(this.Nh.add(t._uuid,t),this.Ch||(this.Ch=!0,Qi(this.Ph.bind(this)))))},i.Ph=function(){var t=this;this.Ch=!1,this.Nh.forEach((function(i){t.Fh(i)})),this.Nh.clear()},i.Fh=function(t,i){void 0===i&&(i=!1);var n=t._uuid;if(this.Nh.remove(n),mu(t,!0)&&-1===this.Lh.indexOf(n)&&!(!i&&t.refCount>0&&BA(t)>0)){Yg.remove(n);for(var e=pm.getDeps(n),r=0,s=e.length;r<s;r++){var h=Yg.get(e[r]);h&&(h.decRef(!1),this.Fh(h,!1))}t.destroy(),pm.remove(n)}},t}(),UA=new DA,xA=null;function GA(t){for(var i=0,n=t.input.length;i<n;i++){var e=t.input[i];!e.isNative&&e.content instanceof kw&&e.content.decRef(!1),e.recycle()}t.input=null}function jA(t,i){return i?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function HA(t,i,n,e,r){void 0===r&&(r=0),t(r,(function(s,h){r++,!s||r>i?e&&e(s,h):setTimeout((function(){HA(t,i,n,e,r)}),n)}))}function VA(t,i,n,e,s){try{for(var h=pm.parse(t,i),u=0,o=h.deps.length;u<o;u++){var a=h.deps[u];a in n||(n[a]=!0,e.push({uuid:a,bundle:s&&s.name}))}h.nativeDep&&(s&&(h.nativeDep.bundle=s.name),e.push(r({},h.nativeDep)))}catch(t){Y(t.message,t.stack)}}function $A(t,i,n){i&&(n=void 0!==n?n:k.assetManager.cacheAsset,vw(i)||!n||i.isDefault||Yg.add(t,i))}function WA(t,i,n){var e=!1,r=lm.get(i);if(r){for(var s=0,h=r.length;s<h;s++){var u=r[s],o=n[u.uuid+"@import"];if(o)u.owner[u.prop]=o.addRef();else{if(ut(16350,u.uuid),k.assetManager.dispatchAssetMissing(i,u.owner,u.prop,u.uuid),u.type&&u.type!==kw){var a=new u.type;a.initDefault(u.uuid),u.owner[u.prop]=a}e=!0}}lm.delete(i)}return dm.has(i)&&(n[t+"@native"]?i._nativeAsset=n[t+"@native"]:(e=!0,ut(16351,t)),dm.delete(i)),e}function zA(t){var i=t.source;if(t.options.__outputAsArray__||1!==i.length)for(var n=t.output=[],e=0,r=i.length;e<r;e++)n.push(i[e].content);else t.output=i[0].content}function XA(t,i,n){var e=0,r=[],s=t.length;0===s&&n&&n(r);for(var h=function(t){t&&r.push(t),++e===s&&n&&n(r)},u=0;u<s;u++)i(t[u],h)}function YA(t,i,n){var e=t,r=i,s=n;if(void 0===n){var h="function"==typeof t;i?(s=i,h||(r=null)):void 0===i&&h&&(s=t,e=null,r=null),void 0!==i&&h&&(r=t,e=null)}return{options:e||Object.create(null),onProgress:r,onComplete:s}}function KA(t,i,n){var e=t,r=i,s=n;if(void 0===n){var h=ii(t,kw);i?(s=i,h&&(r=null)):void 0!==i||h||(s=t,r=null,e=null),void 0===i||h||(r=t,e=null)}return{type:e,onProgress:r||xA,onComplete:s}}function qA(t,i,n,e){if(void 0===e&&(e={}),!n[i]||e[i])return!1;e[i]=!0;var r=!1,s=pm.getDeps(i);if(s)for(var h=0,u=s.length;h<u;h++){var o=s[h];if(o===t||qA(t,o,n,e)){r=!0;break}}return r}function QA(t){return function(i,n){if(t){var e=[];Array.isArray(n)?n.forEach((function(t){return t instanceof kw&&e.push(t.addRef())})):n instanceof kw&&e.push(n.addRef()),Qi((function(){e.forEach((function(t){return t.decRef(!1)})),t(i,n)}))}}}var ZA=function(){function t(){this.Bh=new MA}var i=t.prototype;return i.getInfoWithPath=function(t,i){return this.Bh.getInfoWithPath(t,i)},i.getDirWithPath=function(t,i,n){return this.Bh.getDirWithPath(t,i,n)},i.getAssetInfo=function(t){return this.Bh.getAssetInfo(t)},i.getSceneInfo=function(t){return this.Bh.getSceneInfo(t)},i.init=function(t){this.Bh.init(t),Qg.add(t.name,this)},i.load=function(t,i,n,e){var r=KA(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete,o={__requestType__:"path",type:s,bundle:this.name,__outputAsArray__:Array.isArray(t)};k.assetManager.loadAny(t,o,h,u)},i.preload=function(t,i,n,e){var r=KA(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete;k.assetManager.preloadAny(t,{__requestType__:"path",type:s,bundle:this.name},h,u)},i.loadDir=function(t,i,n,e){var r=KA(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete;k.assetManager.loadAny(t,{__requestType__:"dir",type:s,bundle:this.name,__outputAsArray__:!0},h,u)},i.preloadDir=function(t,i,n,e){var r=KA(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete;k.assetManager.preloadAny(t,{__requestType__:"dir",type:s,bundle:this.name},h,u)},i.loadScene=function(t,i,n,e){var r=YA(i,n,e),s=r.options,h=r.onProgress,u=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,k.assetManager.loadAny({scene:t},s,h,(function(t,i){if(t)Y(t.message,t.stack);else if(i.scene){var n=i.scene;n.id=i._uuid,n.name=i.name}else t=new Error("The asset "+i._uuid+" is not a scene");u&&u(t,i)}))},i.preloadScene=function(t,i,n,e){var r=YA(i,n,e),s=r.options,h=r.onProgress,u=r.onComplete;s.bundle=this.name,k.assetManager.preloadAny({scene:t},s,h,(function(i){i&&ut(1210,t,i.message),u&&u(i)}))},i.get=function(t,i){var n=this.getInfoWithPath(t,i);return n&&Yg.get(n.uuid)||null},i.release=function(t,i){var n=this.get(t,i);n&&UA.tryRelease(n,!0)},i.releaseUnusedAssets=function(){var t=this;Yg.forEach((function(i){var n=t.getAssetInfo(i._uuid);n&&!n.redirect&&UA.tryRelease(i)}))},i.releaseAll=function(){var t=this;Yg.forEach((function(i){var n=t.getAssetInfo(i._uuid);n&&!n.redirect&&UA.tryRelease(i,!0)}))},i._destroy=function(){this.Bh.destroy()},e(t,[{key:"config",get:function(){return this.Bh}},{key:"name",get:function(){return this.Bh.name}},{key:"deps",get:function(){return this.Bh.deps}},{key:"base",get:function(){return this.Bh.base}}]),t}(),JA=t("resources",new ZA);function tE(t,i,n){var e=new O.Image;function r(){e.removeEventListener("load",r),e.removeEventListener("error",s),n&&n(null,e)}function s(){e.removeEventListener("load",r),e.removeEventListener("error",s),n&&n(new Error(ft(4930,t)))}return"file:"!==O.location.protocol&&(e.crossOrigin="anonymous"),e.addEventListener("load",r),e.addEventListener("error",s),e.src=t,e}function iE(t,i,n,e){var r=new XMLHttpRequest,s="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==i.xhrResponseType&&(r.responseType=i.xhrResponseType),void 0!==i.xhrWithCredentials&&(r.withCredentials=i.xhrWithCredentials),void 0!==i.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(i.xhrMimeType),void 0!==i.xhrTimeout&&(r.timeout=i.xhrTimeout),i.xhrHeader)for(var h in i.xhrHeader)r.setRequestHeader(h,i.xhrHeader[h]);return r.onload=function(){200===r.status||0===r.status?e&&e(null,r.response):e&&e(new Error(""+s+r.status+"(no response)"))},n&&(r.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),r.onerror=function(){e&&e(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){e&&e(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){e&&e(new Error(""+s+r.status+"(abort)"))},r.send(null),r}k.resources=JA;var nE=O.document,eE={};function rE(t,i,n){if(eE[t])return n&&n(null),null;var e=nE.createElement("script");function r(){e.parentNode.removeChild(e),e.removeEventListener("load",r,!1),e.removeEventListener("error",s,!1),eE[t]=!0,n&&n(null)}function s(){e.parentNode.removeChild(e),e.removeEventListener("load",r,!1),e.removeEventListener("error",s,!1),n&&n(new Error(ft(4928,t)))}return"file:"!==O.location.protocol&&(e.crossOrigin="anonymous"),e.async=i.scriptAsyncLoading||!1,e.src=t,e.addEventListener("load",r,!1),e.addEventListener("error",s,!1),nE.body.appendChild(e),e}var sE=/^(?:\w+:\/\/|\.+\/).+/,hE=function(t,i,n){(ho.hasFeature(ho.Feature.IMAGE_BITMAP)&&k.assetManager.allowImageBitmap?uE:tE)(t,i,n)},uE=function(t,i,n){i.xhrResponseType="blob",iE(t,i,i.onFileProgress,n)},oE=function(t,i,n){i.xhrResponseType="json",iE(t,i,i.onFileProgress,n)},aE=function(t,i,n){i.xhrResponseType="arraybuffer",iE(t,i,i.onFileProgress,n)},cE=function(t,i,n){bE._downloadJson(t,i,(function(i,e){if(i)n(i);else{var r=y_(e);Promise.all(r.chunks.map((function(n){return new Promise((function(e,r){bE._downloadArrayBuffer(""+Hu(t)+n,{},(function(t,n){i?r(i):e(new Uint8Array(n))}))}))}))).then((function(t){var i=new p_(r.document,t);n(null,i)})).catch((function(t){n(t)}))}}))},fE=function(t,i,n){bE._downloadArrayBuffer(t,i,(function(t,i){if(t)n(t);else try{var e=b_(new Uint8Array(i));n(null,e)}catch(t){n(t)}}))},vE=function(t,i,n){i.xhrResponseType="text",iE(t,i,i.onFileProgress,n)},lE=function(t,i,n){var e=Vu(t),r=t;sE.test(r)||(r=-1!==bE.remoteBundles.indexOf(e)?bE.remoteServerAddress+"remote/"+e:"assets/"+e);var s=i.version||bE.bundleVers[e],h=0,u=null,o=null;oE(r+"/config."+(s?s+".":"")+"json",i,(function(t,i){o=t||o,(u=i)&&(u.base=r+"/"),2==++h&&n(o,u)})),rE(r+"/index."+(s?s+".":"")+"js",i,(function(t){o=t||o,2==++h&&n(o,u)}))},dE=function(){var t=i.prototype;function i(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=tE,this.downloadDomAudio=null,this.downloadFile=iE,this.downloadScript=rE,this._downloadArrayBuffer=aE,this._downloadJson=oE,this.Dh={".png":hE,".jpg":hE,".bmp":hE,".jpeg":hE,".gif":hE,".ico":hE,".tiff":hE,".webp":hE,".image":hE,".pvr":aE,".pkm":aE,".astc":aE,".txt":vE,".xml":vE,".vsh":vE,".fsh":vE,".atlas":vE,".tmx":vE,".tsx":vE,".json":oE,".ExportJson":oE,".plist":vE,".ccon":cE,".cconb":fE,".fnt":vE,".binary":aE,".bin":aE,".dbbin":aE,".skel":aE,".js":rE,bundle:lE,default:vE},this.Uh=new zg,this.an=[],this.xh=!1,this.Gh=0,this.jh=0,this.Hh=-1,this.Vh=!1,this.$h="",this.Wh=1/30}return t.init=function(t,i,n){void 0===t&&(t=""),void 0===i&&(i={}),void 0===n&&(n=[]),this.Uh.clear(),this.an.length=0,this.$h=t,this.bundleVers=i,this.remoteBundles=n},t.register=function(t,i){"object"==typeof t?Zt(this.Dh,t):this.Dh[t]=i},t.download=function(t,i,n,e,r){var s=this,h=Kg.get(t);if(h)r(null,h);else{var u=this.Uh.get(t);if(u){u.push(r);var o=this.an.find((function(i){return i.id===t}));if(!o)return;var a=e.priority||0;o.priority<a&&(o.priority=a,this.xh=!0)}else{var c=void 0!==e.maxRetryCount?e.maxRetryCount:this.maxRetryCount,f=void 0!==e.maxConcurrency?e.maxConcurrency:this.maxConcurrency,v=void 0!==e.maxRequestsPerFrame?e.maxRequestsPerFrame:this.maxRequestsPerFrame,l=this.Dh[n]||this.Dh.default;HA((function(n,h){if(0===n&&s.Uh.add(t,[r]),s.limited){s.zh();var u=function(t,i){s.Gh--,s.Xh(f,v),h(t,i)};s.Gh<f&&s.jh<v?(l(jA(i,s.appendTimeStamp),e,u),s.Gh++,s.jh++):(s.an.push({id:t,priority:e.priority||0,url:i,options:e,done:u,handler:l}),s.xh=!0,s.Gh<f&&s.Xh(f,v))}else l(jA(i,s.appendTimeStamp),e,h)}),c,this.retryInterval,(function(i,n){i||Kg.add(t,n);for(var e=s.Uh.remove(t),r=0,h=e.length;r<h;r++)e[r](i,n)}))}}},t.loadSubpackage=function(t,i){k.assetManager.loadBundle(t,null,i)},t.zh=function(){var t=performance.now(),i=k.game.deltaTime,n=i>this.Wh?this.Wh:i;t-this.Hh>1e3*n&&(this.jh=0,this.Hh=t)},t.Yh=function(t,i){for(this.Vh=!1,this.zh();this.an.length>0&&this.Gh<t&&this.jh<i;){this.xh&&(this.an.sort((function(t,i){return t.priority-i.priority})),this.xh=!1);var n=this.an.pop();if(!n)break;this.Gh++,this.jh++,n.handler(jA(n.url,this.appendTimeStamp),n.options,n.done)}this.Xh(t,i)},t.Xh=function(t,i){!this.Vh&&this.an.length>0&&(Qi(this.Yh.bind(this),t,i),this.Vh=!0)},e(i,[{key:"remoteServerAddress",get:function(){return this.$h}},{key:"handlers",get:function(){return this.Dh}}],[{key:"instance",get:function(){return i.Mr||(i.Mr=new i),i.Mr}}]),i}();dE.Mr=void 0;var gE,wE,_E,mE,pE,yE,bE=dE.instance,AE=dE.instance,EE=t("JsonAsset",Ko("cc.JsonAsset")((wE=function(t){function i(i){var n;return(n=t.call(this,i)||this).json=_E&&_E(),n}return s(i,t),i}(kw),_E=xo(wE.prototype,"json",[oa],(function(){return null})),gE=wE))||gE);k.JsonAsset=EE;var kE,TE,SE=t("TextAsset",Ko("cc.TextAsset")((pE=function(t){function i(i){var n;return(n=t.call(this,i)||this).text=yE&&yE(),n}return s(i,t),i.prototype.toString=function(){return this.text},i}(kw),yE=xo(pE.prototype,"text",[oa],(function(){return""})),mE=pE))||mE);k.TextAsset=SE;var OE=t("BufferAsset",Ko("cc.BufferAsset")((TE=function(t){function i(i){var n;return(n=t.call(this,i)||this).Kh=null,n}s(i,t);var n=i.prototype;return n.buffer=function(){return this.Kh,this.Kh},n.validate=function(){return!!this.Kh},e(i,[{key:"_nativeAsset",get:function(){return this.Kh},set:function(t){t instanceof ArrayBuffer?this.Kh=t:this.Kh=t.buffer}}]),i}(kw),m(TE.prototype,"_nativeAsset",[ja],Object.getOwnPropertyDescriptor(TE.prototype,"_nativeAsset"),TE.prototype),kE=TE))||kE);function RE(t,i,n,e){var r=null,s=null;try{(r=new jw)._nativeUrl=t,r._nativeAsset=i}catch(t){s=t}e(s,r)}function IE(t,i,n,e){var r=new EE;r.json=i,e(null,r)}function ME(t,i,n,e){var r=new SE;r.text=i,e(null,r)}function NE(t,i,n,e){var r=new OE;r._nativeUrl=t,r._nativeAsset=i,e(null,r)}function CE(t,i,n,e){var r=new kw;r._nativeUrl=t,r._nativeAsset=i,e(null,r)}function LE(t,n,e,r){var s=Qg.get(n.name);s||(s="resources"===n.name?JA:new ZA,n.base=n.base||t+"/",s.init(n)),i.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}k.BufferAsset=OE;var FE=function(){function t(){this.qh=new zg,this.Qh={".png":RE,".jpg":RE,".bmp":RE,".jpeg":RE,".gif":RE,".ico":RE,".tiff":RE,".webp":RE,".image":RE,".pvr":RE,".pkm":RE,".astc":RE,".txt":ME,".xml":ME,".vsh":ME,".fsh":ME,".atlas":ME,".tmx":ME,".tsx":ME,".fnt":ME,".json":IE,".ExportJson":IE,".binary":NE,".bin":NE,".dbbin":NE,".skel":NE,bundle:LE,default:CE}}var i=t.prototype;return i.register=function(t,i){"object"==typeof t?Zt(this.Qh,t):this.Qh[t]=i},i.create=function(t,i,n,e,r){var s=this,h=this.Qh[n]||this.Qh.default,u=Yg.get(t);if(e.reloadAsset||!u){var o=this.qh.get(t);o?o.push(r):(this.qh.add(t,[r]),h(t,i,e,(function(i,n){!i&&n instanceof kw&&(n._uuid=t,$A(t,n,e.cacheAsset));for(var r=s.qh.remove(t),h=0,u=r.length;h<u;h++)r[h](i,n)})))}else r(null,u)},t}(),PE=new FE,BE=function(){function t(){this.Zh=new zg,this.Jh={".json":this.unpackJson}}var i=t.prototype;return i.unpackJson=function(t,i,n,e){var r=jt(!0),s=null;if(Array.isArray(i)){(i=cm(i)).length!==t.length&&ut(4915);for(var h=0;h<t.length;h++)r[t[h]+"@import"]=i[h]}else{var u=gi(Mm),o=gi(jw);if(i.type===u&&i.data){var a=i.data;a.length!==t.length&&ut(4915);for(var c=0;c<t.length;c++)r[t[c]+"@import"]=fm(u,{base:a[c][0],mipmaps:a[c][1]})}else{if(i.type!==o||!i.data)return void e(s=new Error("unmatched type pack!"),null);var f=i.data;f.length!==t.length&&ut(4915);for(var v=0;v<t.length;v++)r[t[v]+"@import"]=f[v]}}e(s,r)},i.init=function(){this.Zh.clear()},i.register=function(t,i){"object"==typeof t?Zt(this.Jh,t):this.Jh[t]=i},i.unpack=function(t,i,n,e,r){i?(0,this.Jh[n])(t,i,e,r):r(new Error("package data is wrong!"))},i.load=function(t,i,n){var e=this;if(!t.isNative&&t.info&&t.info.packs)if(Kg.has(t.id))n(null,Kg.get(t.id));else{var r=t.info.packs,s=r.find((function(t){return e.Zh.has(t.uuid)}));if(s)this.Zh.get(s.uuid).push({onComplete:n,id:t.id});else{var h=r[0];this.Zh.add(h.uuid,[{onComplete:n,id:t.id}]),t.config;var u=dw(h.uuid,{ext:h.ext,bundle:t.config.name});AE.download(h.uuid,u,h.ext,t.options,(function(i,n){Kg.remove(h.uuid),i&&Y(i.message,i.stack),e.unpack(h.packedUuids,n,h.ext,t.options,(function(t,n){if(!t)for(var r in n)Kg.add(r,n[r]);for(var s=e.Zh.remove(h.uuid),u=0,o=s.length;u<o;u++){var a=s[u];if(i||t)a.onComplete(i||t);else{var c=n[a.id];c?a.onComplete(null,c):a.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else AE.download(t.id,t.url,t.ext,t.options,n)},t}(),DE=new BE;function UE(t,i){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var e=t.options,r=t.progress,s=[],h=r.total,u=e.__exclude__=e.__exclude__||Object.create(null);t.output=[],XA(t.input,(function(e,o){if(!e.isNative&&Yg.has(e.uuid)){var a=Yg.get(e.uuid);return e.content=a.addRef(),t.output.push(e),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,e),void o()}DE.load(e,t.options,(function(a,c){a?t.isFinished||(!k.assetManager.force||n?(Y(a.message,a.stack),r.canInvoke=!1,i(a)):(t.output.push(e),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,e))):t.isFinished||(e.file=c,t.output.push(e),e.isNative||(u[e.uuid]=!0,VA(e.uuid,c,u,s,e.config),r.total=h+s.length),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,e)),o()}))}),(function(){if(t.isFinished)return GA(t),void t.dispatch("error");if(s.length>0){var h=ew.create({input:s,progress:r,options:e,onProgress:t.onProgress,onError:ew.prototype.recycle,onComplete:function(e){var r;e||((r=t.output).push.apply(r,h.output),h.recycle()),n&&xE(t),i(e)}});Jg.async(h)}else n&&xE(t),i()}))}function xE(t){for(var i=t.output,n=0,e=i.length;n<e;n++)i[n].content&&i[n].content.decRef(!1)}var GE=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.parse=function(t){var i=this._parseXML(t).documentElement;if("plist"!==i.tagName)return st(5100),{};for(var n=null,e=0,r=i.childNodes.length;e<r&&1!==(n=i.childNodes[e]).nodeType;e++);return this.tu(n)},n.tu=function(t){var i=null,n=t.tagName;if("dict"===n)i=this.iu(t);else if("array"===n)i=this.nu(t);else if("string"===n)if(1===t.childNodes.length)i=t.firstChild.nodeValue;else{i="";for(var e=0;e<t.childNodes.length;e++)i+=t.childNodes[e].nodeValue}else"false"===n?i=!1:"true"===n?i=!0:"real"===n?i=parseFloat(t.firstChild.nodeValue):"integer"===n&&(i=parseInt(t.firstChild.nodeValue,10));return i},n.nu=function(t){for(var i=[],n=0,e=t.childNodes.length;n<e;n++){var r=t.childNodes[n];1===r.nodeType&&i.push(this.tu(r))}return i},n.iu=function(t){for(var i={},n="",e=0,r=t.childNodes.length;e<r;e++){var s=t.childNodes[e];1===s.nodeType&&("key"===s.tagName?n=s.firstChild.nodeValue:i[n]=this.tu(s))}return i},i}(function(){function t(){this.eu=null,globalThis.DOMParser&&(this.eu=new DOMParser)}var i=t.prototype;return i.parse=function(t){return this._parseXML(t)},i._parseXML=function(t){if(this.eu)return this.eu.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}()),jE=new GE,HE=function(){function t(){this.ru=new zg,this.su={".png":this.hu,".jpg":this.hu,".bmp":this.hu,".jpeg":this.hu,".gif":this.hu,".ico":this.hu,".tiff":this.hu,".webp":this.hu,".image":this.hu,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.uu,".ccon":this.uu,".cconb":this.uu}}var i=t.prototype;return i.hu=function(t,i,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},i.parsePVRTex=function(t,i,n){var e=null,r=null;try{r=jw.Ue(t,0)}catch(t){X(e=t)}n(e,r)},i.parsePKMTex=function(t,i,n){var e=null,r=null;try{r=jw.Ue(t,1)}catch(t){X(e=t)}n(e,r)},i.parseASTCTex=function(t,i,n){var e=null,r=null;try{r=jw.Ue(t,2)}catch(t){X(e=t)}n(e,r)},i.parsePlist=function(t,i,n){var e=null,r=jE.parse(t);r||(e=new Error("parse failed")),n(e,r)},i.uu=function(t,i,n){if(t){var e=null,r=null;try{e=wm(t,i)}catch(t){r=t}n(r,e)}else n(new Error(ft(3702,i.__uuid__)))},i.ou=function(){this.ru.clear()},i.register=function(t,i){"object"==typeof t?Zt(this.su,t):this.su[t]=i},i.parse=function(t,i,n,e,r){var s=this,h=qg.get(t);if(h)r(null,h);else{var u=this.ru.get(t);if(u)u.push(r);else{var o=this.su[n];o?(this.ru.add(t,[r]),o(i,e,(function(i,n){i?Kg.remove(t):vw(n)||qg.add(t,n);for(var e=s.ru.remove(t),r=0,h=e.length;r<h;r++)e[r](i,n)}))):r(null,i)}}},e(t,null,[{key:"instance",get:function(){return this.Mr||(this.Mr=new t),this.Mr}}]),t}();HE.Mr=void 0;var VE=HE.instance;function $E(t,i){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var e=t.options,r=t.progress;e.__exclude__=e.__exclude__||Object.create(null),t.output=[],XA(t.input,(function(s,h){var u=ew.create({input:s,onProgress:t.onProgress,options:e,progress:r,onComplete:function(e,o){e&&!t.isFinished&&(!k.assetManager.force||n?(Y(e.message,e.stack),r.canInvoke=!1,i(e)):r.canInvoke&&t.dispatch("progress",++r.finish,r.total,s)),t.output.push(o),u.recycle(),h(null)}});WE.async(u)}),(function(){if(e.__exclude__=null,t.isFinished)return GA(t),void t.dispatch("error");zA(t),GA(t),i()}))}var WE=new Xg("loadOneAsset",[function(t,i){var n=t.output=t.input,e=n.options,r=n.isNative,s=n.uuid,h=n.file,u=e.reloadAsset;h||!u&&!r&&Yg.has(s)?i():DE.load(n,t.options,(function(t,e){n.file=e,i(t)}))},function(t,i){var n=t.output=t.input,e=t.progress,r=t.options.__exclude__,s=n.id,h=n.file,u=n.options;if(n.isNative)VE.parse(s,h,n.ext,u,(function(r,h){r?i(r):(n.content=h,e.canInvoke&&t.dispatch("progress",++e.finish,e.total,n),Kg.remove(s),qg.remove(s),i())}));else{var o=n.uuid;if(o in r){var a=r[o],c=a.finish,f=a.content,v=a.err,l=a.callbacks;e.canInvoke&&t.dispatch("progress",++e.finish,e.total,n),c||qA(o,o,r)?(f&&f.addRef(),n.content=f,i(v)):l.push({done:i,item:n})}else if(!u.reloadAsset&&Yg.has(o)){var d=Yg.get(o);n.content=d.addRef(),e.canInvoke&&t.dispatch("progress",++e.finish,e.total,n),i()}else u.__uuid__=o,VE.parse(s,h,"import",u,(function(n,e){n?i(n):zE(t,e,i)}))}}]);function zE(t,i,n){var e=t.input,r=t.progress,s=e,h=s.uuid,u=s.id,o=s.options,a=s.config,c=o.cacheAsset,f=[];i.addRef&&i.addRef(),VA(h,i,Object.create(null),f,a),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=f.length,e);var v=t.options.__exclude__[h]={content:i,finish:!1,callbacks:[{done:n,item:e}]},l=ew.create({input:f,options:t.options,onProgress:t.onProgress,onError:ew.prototype.recycle,progress:r,onComplete:function(t){if(i.decRef&&i.decRef(!1),v.finish=!0,v.err=t,!t){for(var n,e=Array.isArray(l.output)?l.output:[l.output],r=Object.create(null),s=d(e);!(n=s()).done;){var o=n.value;o&&(r[o instanceof kw?o._uuid+"@import":h+"@native"]=o)}WA(h,i,r);try{"function"!=typeof i.onLoaded||gm.has(i)||dm.has(i)||(i.onLoaded(),gm.add(i))}catch(t){ut(16352,h,t.message,t.stack)}Kg.remove(u),qg.remove(u),$A(h,i,c),l.recycle()}for(var a=v.callbacks,f=0,g=a.length;f<g;f++){var w=a[f];i.addRef&&i.addRef(),w.item.content=i,w.done(t)}a.length=0}});Zg.async(l)}function XE(t,i){var n=t.options,e=Object.create(null),r=Object.create(null);for(var s in n)switch(s){case"path":case"uuid":case"dir":case"scene":case"url":break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":e[s]=n[s];break;case"__exclude__":case"__outputAsArray__":r[s]=n[s];break;default:e[s]=n[s],r[s]=n[s]}t.options=r;var h=ew.create({input:t.input,options:e}),u=null;try{t.output=t.source=tw.sync(h)}catch(t){u=t;for(var o=0,a=h.output.length;o<a;o++)h.output[o].recycle()}h.recycle(),i(u)}var YE=function(){function t(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this.Je=""}return t.create=function(){return 0!==t.Fe.length?t.Fe.pop():new t},t.prototype.recycle=function(){t.Fe.length!==t.Pe&&(this.Je="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t.Fe.push(this))},e(t,[{key:"id",get:function(){return this.Je||(this.Je=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this.Je}}]),t}();YE.Pe=500,YE.Fe=[];var KE=[];function qE(t){var i=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var e=function(){var e=n[r],s=YE.create(),h=null,u=null;if("string"==typeof e&&((e=Object.create(null))[i.__requestType__||"uuid"]=n[r]),"object"==typeof e){Qt(e,i),e.preset&&Qt(e,nw[e.preset]);var o=function(){var t;switch(a){case"uuid":var i,r=s.uuid=ow(e.uuid);if(!e.bundle){var o=Qg.find((function(t){return!!t.getAssetInfo(r)}));e.bundle=o&&o.name}if(Qg.has(e.bundle)){if(h=Qg.get(e.bundle).config,(u=h.getAssetInfo(r))&&u.redirect){if(!Qg.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");h=Qg.get(u.redirect).config,u=h.getAssetInfo(r)}s.config=h,s.info=u}s.ext=e.ext||(null==(i=u)?void 0:i.extension)||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case"dir":if(Qg.has(e.bundle)){Qg.get(e.bundle).config.getDirWithPath(e.dir,e.type,KE);for(var c,f=d(KE);!(c=f()).done;){var v=c.value;n.push({uuid:v.uuid,__isNative__:!1,ext:v.extension||".json",bundle:e.bundle})}KE.length=0}s.recycle(),s=null;break;case"path":if(Qg.has(e.bundle)){if(h=Qg.get(e.bundle).config,(u=h.getInfoWithPath(e.path,e.type))&&u.redirect){if(!Qg.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");h=Qg.get(u.redirect).config,u=h.getAssetInfo(u.uuid)}if(!u)throw s.recycle(),new Error("Bundle "+e.bundle+" doesn't contain "+e.path);s.config=h,s.uuid=u.uuid,s.info=u}s.ext=e.ext||(null==(t=u)?void 0:t.extension)||".json";break;case"scene":if(!e.bundle){var l=Qg.find((function(t){return!!t.getSceneInfo(e.scene)}));e.bundle=l&&l.name}if(Qg.has(e.bundle)){if(h=Qg.get(e.bundle).config,(u=h.getSceneInfo(e.scene))&&u.redirect){if(!Qg.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");h=Qg.get(u.redirect).config,u=h.getAssetInfo(u.uuid)}if(!u)throw s.recycle(),new Error("Bundle "+h.name+" doesn't contain scene "+e.scene);s.config=h,s.uuid=u.uuid,s.info=u}break;case"__isNative__":s.isNative=e.__isNative__;break;case"url":s.url=e.url,s.uuid=e.uuid||e.url,s.ext=e.ext||ju(e.url),s.isNative=void 0===e.__isNative__||e.__isNative__;break;default:s.options[a]=e[a]}if(!s)return 1};for(var a in e)if(o())break}if(!s)return 1;if(t.output.push(s),!s.uuid&&!s.url)throw new Error("Can not parse this input:"+JSON.stringify(e))},r=0;r<n.length;r++)e();return null}function QE(t){for(var i=t.output=t.input,n=function(){var t=i[e];if(iw.has(t.uuid)){var n=iw.get(t.uuid),r=Qg.find((function(t){return!!t.getAssetInfo(n)}));if(r){var s;t.overrideUuid=n;var h=r.config,u=h.getAssetInfo(n);if(u&&u.redirect){if(!Qg.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");u=(h=Qg.get(u.redirect).config).getAssetInfo(n)}t.config=h,t.info=u,t.ext=t.isNative?t.ext:(null==(s=u)?void 0:s.extension)||".json"}else st(16201,n,t.uuid)}},e=0;e<i.length;e++)n()}function ZE(t){for(var i=t.output=t.input,n=0;n<i.length;n++){var e=i[n];if(!e.url){var r,s,h=e.config;s=e.isNative?h&&h.nativeBase?h.base+h.nativeBase:k.assetManager.generalNativeBase:h&&h.importBase?h.base+h.importBase:k.assetManager.generalImportBase;var u=e.overrideUuid||e.uuid,o="";e.info&&(o=e.isNative?e.info.nativeVer?"."+e.info.nativeVer:"":e.info.ver?"."+e.info.ver:""),r=".ttf"===e.ext?s+"/"+u.slice(0,2)+"/"+u+o+"/"+e.options.__nativeName__:s+"/"+u.slice(0,2)+"/"+u+o+e.ext,e.url=r}}return null}var JE=xi.querySettings.bind(xi),tk="assets",ik="asset-missing",nk=t("AssetManager",function(){function t(){this.pipeline=Zg.append(XE).append($E),this.fetchPipeline=Jg.append(XE).append(UE),this.transformPipeline=tw.append(qE).append(QE).append(ZE),this.bundles=Qg,this.assets=Yg,this.assetsOverrideMap=iw,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=pm,this.force=b,this.allowImageBitmap=!1,this.utils=bw,this.downloader=AE,this.parser=VE,this.packManager=DE,this.cacheAsset=!0,this.cacheManager=null,this.presets=nw,this.factory=PE,this.preprocessPipe=XE,this.fetchPipe=UE,this.loadPipe=$E,this.references=null,this.au=UA,this.cu=Kg,this.fu=qg,this.vu=null,this.lu=[],this.du=new Ou}var i=t.prototype;return i.getReleaseManager=function(){return this.au},i.onAssetMissing=function(t,i){this.du.on(ik,t,i)},i.offAssetMissing=function(t,i){this.du.off(ik,t,i)},i.dispatchAssetMissing=function(t,i,n,e){this.du.emit(ik,t,i,n,e)},i.init=function(t){void 0===t&&(t={});var i=t.server||JE(tk,"server")||"",n=t.bundleVers||JE(tk,"bundleVers")||{},e=t.remoteBundles||JE(tk,"remoteBundles")||[],r=t.downloadMaxConcurrency||JE(tk,"downloadMaxConcurrency");r&&r>0&&(this.downloader.maxConcurrency=r),this.cu.clear(),this.fu.clear(),this.au.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(i,n,e),this.parser.ou(),this.dependUtil.init();var s=t.importBase||JE(tk,"importBase")||"";s&&s.endsWith("/")&&(s=s.substring(0,s.length-1));var h=t.nativeBase||JE(tk,"nativeBase")||"";h&&h.endsWith("/")&&(h=h.substring(0,h.length-1)),this.generalImportBase=s,this.generalNativeBase=h,this.lu=JE(tk,"projectBundles")||[];var u=JE(tk,"assetsOverrides")||{};for(var o in u)this.assetsOverrideMap.set(o,u[o])},i.getBundle=function(t){return Qg.get(t)||null},i.removeBundle=function(t){t._destroy(),Qg.remove(t.name)},i.loadAny=function(t,i,n,e){var r=YA(i,n,e),s=r.options,h=r.onProgress,u=r.onComplete;s.preset=s.preset||"default",t=Array.isArray(t)?t.slice():t;var o=ew.create({input:t,onProgress:h,onComplete:QA(u),options:s});Zg.async(o)},i.preloadAny=function(t,i,n,e){var r=YA(i,n,e),s=r.options,h=r.onProgress,u=r.onComplete;s.preset=s.preset||"preload",t=Array.isArray(t)?t.slice():t;var o=ew.create({input:t,onProgress:h,onComplete:QA(u),options:s});Jg.async(o)},i.loadRemote=function(t,i,n){var e=YA(i,void 0,n),r=e.options,s=e.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(i,n){i?(Y(i.message,i.stack),s&&s(i,n)):PE.create(t,n,r.ext||ju(t),r,(function(t,i){s&&s(t,i)}))}))):QA(s)(null,this.assets.get(t))},i.loadBundle=function(t,i,n){var e=YA(i,void 0,n),r=e.options,s=e.onComplete,h=Vu(t);this.bundles.has(h)?QA(s)(null,this.getBundle(h)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(i,n){i?(Y(i.message,i.stack),s&&s(i,n)):PE.create(t,n,"bundle",r,(function(t,i){s&&s(t,i)}))})))},i.releaseAsset=function(t){UA.tryRelease(t,!0)},i.releaseUnusedAssets=function(){Yg.forEach((function(t){UA.tryRelease(t)}))},i.releaseAll=function(){Yg.forEach((function(t){UA.tryRelease(t,!0)}))},i.loadWithJson=function(){throw new Error("Only valid in Editor")},e(t,[{key:"files",get:function(){return this.cu}},{key:"main",get:function(){return Qg.get("main")||null}},{key:"resources",get:function(){return Qg.get("resources")||null}}],[{key:"instance",get:function(){return this.Mr||(this.Mr=new t),this.Mr}}]),t}());nk.Mr=void 0,nk.Pipeline=Xg,nk.Task=ew,nk.Cache=zg,nk.RequestItem=YE,nk.Bundle=ZA,nk.BuiltinBundleName={INTERNAL:"internal",RESOURCES:"resources",MAIN:"main",START_SCENE:"start-scene"},nk.CacheManager=function(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0},nk.Downloader=dE,nk.Parser=HE,nk.DependUtil=_m;var ek=t("assetManager",k.assetManager=nk.instance);k.AssetManager=nk;var rk,sk,hk=t("BuiltinResMgr",function(){function t(){this._resources={},this._materialsToBeCompiled=[]}var i=t.prototype;return i.init=function(){for(var t=this._resources,i=new Uint8Array(16),n=new Uint8Array(16),e=new Uint8Array(16),r=new Uint8Array(16),s=new Uint8Array(16),h=0,u=0;u<4;u++)i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=255,n[h]=0,n[h+1]=0,n[h+2]=0,n[h+3]=0,e[h]=119,e[h+1]=119,e[h+2]=119,e[h+3]=255,r[h]=255,r[h+1]=255,r[h+2]=255,r[h+3]=255,s[h]=127,s[h+1]=127,s[h+2]=255,s[h+3]=255,h+=4;var o=new Uint8Array(1024);h=0;for(var a=0;a<256;a++)o[h]=221,o[h+1]=221,o[h+2]=221,o[h+3]=255,h+=4;h=0;for(var c=0;c<8;c++){for(var f=0;f<8;f++)o[h]=85,o[h+1]=85,o[h+2]=85,o[h+3]=255,h+=4;h+=32}h+=32;for(var v=0;v<8;v++){for(var l=0;l<8;l++)o[h]=85,o[h+1]=85,o[h+2]=85,o[h+3]=255,h+=4;h+=32}var d={width:2,height:2,_data:i,_compressed:!1,format:35},g={width:2,height:2,_data:n,_compressed:!1,format:35},w={width:2,height:2,_data:e,_compressed:!1,format:35},_={width:2,height:2,_data:r,_compressed:!1,format:35},m={width:2,height:2,_data:s,_compressed:!1,format:35},p={width:16,height:16,_data:o,_compressed:!1,format:35},y=new jw(d),b=new Mm;b._uuid="black-texture",b.image=y,t[b._uuid]=b;var A=new jw(g),E=new Mm;E._uuid="empty-texture",E.image=A,t[E._uuid]=E;var T=new Yp;T._uuid="black-cube-texture",T.setMipFilter(1),T.image={front:new jw(d),back:new jw(d),left:new jw(d),right:new jw(d),top:new jw(d),bottom:new jw(d)},t[T._uuid]=T;var S=new jw(w),O=new Mm;O._uuid="grey-texture",O.image=S,t[O._uuid]=O;var R=new Yp;R._uuid="grey-cube-texture",R.setMipFilter(1),R.image={front:new jw(w),back:new jw(w),left:new jw(w),right:new jw(w),top:new jw(w),bottom:new jw(w)},t[R._uuid]=R;var I=new jw(_),M=new Mm;M._uuid="white-texture",M.image=I,t[M._uuid]=M;var N=new Yp;N._uuid="white-cube-texture",N.setMipFilter(1),N.image={front:new jw(_),back:new jw(_),left:new jw(_),right:new jw(_),top:new jw(_),bottom:new jw(_)},t[N._uuid]=N;var C=new jw(m),L=new Mm;L._uuid="normal-texture",L.image=C,t[L._uuid]=L;var F=new jw(p),P=new Mm;P._uuid="default-texture",P.image=F,t[P._uuid]=P;var B=new Yp;if(B.setMipFilter(1),B._uuid="default-cube-texture",B.image={front:new jw(p),back:new jw(p),left:new jw(p),right:new jw(p),top:new jw(p),bottom:new jw(p)},t[B._uuid]=B,k.SpriteFrame){var D=new k.SpriteFrame,U=y,x=new Mm;x.image=U,D.texture=x,D._uuid="default-spriteframe",t[D._uuid]=D}},i.addAsset=function(t,i){this._resources[t]=i},i.get=function(t){return this._resources[t]},i.loadBuiltinAssets=function(){var t=this,i=xi.querySettings("engine","builtinAssets");if(!i)return Promise.resolve();var n=this._resources;return new Promise((function(e,r){ek.loadBundle("internal",(function(s){s?r(s):ek.loadAny(i,(function(i,s){i?r(i):(s.forEach((function(i){n[i.name]=i,UA.addIgnoredAsset(i),i instanceof k.Material&&t._materialsToBeCompiled.push(i)})),e())}))}))}))},i.compileBuiltinMaterial=function(){for(var t=0;t<this._materialsToBeCompiled.length;++t)for(var i=this._materialsToBeCompiled[t],n=0;n<i.passes.length;++n)i.passes[n].tryCompile();this._materialsToBeCompiled.length=0},t}()),uk=t("builtinResMgr",k.builtinResMgr=new hk),ok=t("getPhaseID",(rk=new Map,sk=0,function(t){return"number"==typeof t?t:(rk.has(t)||(rk.set(t,1<<sk),sk++),rk.get(t))})),ak=t("InstancedBuffer",function(){function t(t){this.instances=[],this.hasPendingModels=!1,this.dynamicOffsets=[],this.gu=t.device,this.pass=t}var i=t.prototype;return i.destroy=function(){this.instances.forEach((function(t){t.vb.destroy(),t.ia.destroy()})),this.instances.length=0},i.merge=function(t,i,n){void 0===n&&(n=null);var e=t.instancedAttributeBlock,r=e.buffer.length;if(r){var s=t.inputAssembler,h=t.descriptorSet,u=h.getTexture(vb),o=h.getTexture(pb),a=h.getTexture(Eb),c=t.useReflectionProbeType,f=n;f||(f=t.shaders[i]);for(var v=t.descriptorSet,l=0;l<this.instances.length;++l){var d,g,w=this.instances[l];if(!((null==(d=w.ia.indexBuffer)?void 0:d.objectID)!==(null==(g=s.indexBuffer)?void 0:g.objectID)||w.count>=1024)&&w.lightingMap.objectID===u.objectID&&w.useReflectionProbeType===c&&w.reflectionProbeCubemap.objectID===o.objectID&&w.reflectionProbePlanarMap.objectID===a.objectID&&w.stride===r){if(w.count>=w.capacity){w.capacity<<=1;var _=w.stride*w.capacity,m=w.data;w.data=new Uint8Array(_),w.data.set(m),w.vb.resize(_)}return w.shader=f,w.descriptorSet=v,w.data.set(e.buffer,w.stride*w.count++),void(this.hasPendingModels=!0)}}for(var p=this.gu.createBuffer(new ud(10,3,32*r,r)),y=new Uint8Array(32*r),b=s.vertexBuffers.slice(),A=s.attributes.slice(),E=s.indexBuffer,k=0;k<e.attributes.length;k++){var T=e.attributes[k],S=new kd(T.name,T.format,T.isNormalized,b.length,!0);A.push(S)}y.set(e.buffer),b.push(p);var O=new Sd(A,b,E),R=this.gu.createInputAssembler(O);this.instances.push({count:1,capacity:32,vb:p,data:y,ia:R,stride:r,shader:f,descriptorSet:v,lightingMap:u,reflectionProbeCubemap:o,reflectionProbePlanarMap:a,useReflectionProbeType:c,reflectionProbeBlendCubemap:null}),this.hasPendingModels=!0}},i.uploadBuffers=function(t){for(var i=0;i<this.instances.length;++i){var n=this.instances[i];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},i.clear=function(){this.instances.forEach((function(t){t.count=0})),this.hasPendingModels=!1},t}()),ck=new ud(18,1),fk=new od(null),vk=new xd(null),lk=function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new Sg,this._dss=new kg,this._rs=new Eg,this._priority=128,this._stage=100,this._phase=ok("default"),this._passID=4294967295,this._subpassID=4294967295,this._phaseID=4294967295,this._primitive=7,this._batchingScheme=0,this._dynamicStates=0,this._instancedBuffers={},this._hash=0,this._rootBufferDirty=!1,this._root=t,this._device=Hg.gfxDevice}t.fillPipelineInfo=function(t,i){void 0!==i.priority&&(t._priority=i.priority),void 0!==i.primitive&&(t._primitive=i.primitive),void 0!==i.stage&&(t._stage=i.stage),void 0!==i.dynamicStates&&(t._dynamicStates=i.dynamicStates),void 0!==i.phase&&(t._phase=ok(i.phase));var n=t._bs;if(i.blendState){var e=i.blendState,r=e.targets;r&&r.forEach((function(t,i){n.setTarget(i,t)})),void 0!==e.isA2C&&(n.isA2C=e.isA2C),void 0!==e.isIndepend&&(n.isIndepend=e.isIndepend),void 0!==e.blendColor&&(n.blendColor=e.blendColor)}t._rs.assign(i.rasterizerState),t._dss.assign(i.depthStencilState)},t.getPassHash=function(t){var i="";if(k.rendering&&k.rendering.enableEffectImport){var n=k.rendering.programLib.getKey(t._phaseID,t.program,t.defines);i=t._phaseID.toString()+","+n}else i=TA.getKey(t.program,t.defines);var e,r=i+","+t._primitive+","+t._dynamicStates;return r+=dk(t._bs),r+=gk(t._dss),Wv(r+=",rs,"+(e=t._rs).cullMode+","+e.depthBias+","+e.isFrontFaceCCW,666)};var i=t.prototype;return i.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},i.getHandle=function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var e=this._propertyHandleMap[t];return e?(n?e=Xb(e,n):i&&(e=Xb(e,Vb(e)-i)),e+i):0},i.getBinding=function(t){var i=this.getHandle(t);return i?$b(i):-1},i.setUniform=function(t,i){var n=$b(t),e=Vb(t),r=zb(t),s=this.wu(e,n);Kb[e](s,i,r),this._rootBufferDirty=!0},i.getUniform=function(t,i){var n=$b(t),e=Vb(t),r=zb(t),s=this.wu(e,n);return Yb[e](s,i,r)},i.setUniformArray=function(t,i){for(var n=$b(t),e=Vb(t),r=og(e)>>2,s=this.wu(e,n),h=zb(t),u=0;u<i.length;u++,h+=r)null!==i[u]&&Kb[e](s,i[u],h);this._rootBufferDirty=!0},i.bindTexture=function(t,i,n){this._descriptorSet.bindTexture(t,i,n||0)},i.bindSampler=function(t,i,n){this._descriptorSet.bindSampler(t,i,n||0)},i.setDynamicState=function(t,i){var n=this._dynamics[t];n&&n.value===i||(n.value=i,n.dirty=!0)},i.overridePipelineStates=function(){st(12102)},i.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):ut(12006)},i.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new ak(this))},i.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var i=this._shaderInfo.blocks[t];this._buffers[i.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},i.resetUniform=function(t){var i=this.getHandle(t);if(i){for(var n=Vb(i),e=$b(i),r=zb(i),s=Wb(i),h=this.wu(n,e),u=this._properties[t],o=u&&u.value||Zb(n),a=(og(n)>>2)*s,c=0;c+o.length<=a;c+=o.length)h.set(o,r+c);this._rootBufferDirty=!0}},i.resetTexture=function(t,i){var n=this.getHandle(t);if(n){var e,r=Vb(n),s=$b(n),h=this._properties[t],u=h&&h.value,o=(e="string"==typeof u?uk.get(""+u+Jb(r)):u||uk.get(Zb(r)))&&e.getGFXTexture(),a=h&&void 0!==h.samplerHash?Ng.unpackFromHash(h.samplerHash):e&&e.getSamplerInfo(),c=this._device.getSampler(a);this._descriptorSet.bindSampler(s,c,i||0),this._descriptorSet.bindTexture(s,o,i||0)}},i.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var i=this._shaderInfo.blocks[t],n=0,e=0;e<i.members.length;e++){for(var r=i.members[e],s=this.wu(r.type,i.binding),h=this._properties[r.name],u=h&&h.value||Zb(r.type),o=(og(r.type)>>2)*r.count,a=0;a+u.length<=o;a+=u.length)s.set(u,n+a);n+=o}this._rootBufferDirty=!0},i.resetTextures=function(){var t=this;if(k.rendering)this._shaderInfo.descriptors[1].samplerTextures.forEach((function(i){for(var n=0;n<i.count;++n)t.resetTexture(i.name,n)}));else for(var i=0;i<this._shaderInfo.samplerTextures.length;i++)for(var n=this._shaderInfo.samplerTextures[i],e=0;e<n.count;e++)this.resetTexture(n.name,e)},i.tryCompile=function(){var i=this._root.pipeline;if(!i)return!1;if(this._syncBatchingScheme(),k.rendering&&k.rendering.enableEffectImport){var n=k.rendering.programLib,e=n.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);if(!e)return st(12103,this._programName),!1;this._shader=e.shader,this._pipelineLayout=n.getPipelineLayout(this.device,this._phaseID,this._programName)}else{var r=TA.getGFXShader(this._device,this._programName,this._defines,i);if(!r)return st(12104,this._programName),!1;this._shader=r,this._pipelineLayout=TA.getTemplateInfo(this._programName).pipelineLayout}return this._hash=t.getPassHash(this),!0},i.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return st(12105),null;if(!t)return this._shader;for(var i=this._root.pipeline,n=0;n<t.length;n++){var e=t[n];this._defines[e.name]=e.value}this._isBlend&&(this._defines.CC_IS_TRANSPARENCY_PASS=1);var r=null;if(k.rendering&&k.rendering.enableEffectImport){var s=k.rendering.programLib.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);s&&(r=s.shader)}else r=TA.getGFXShader(this._device,this._programName,this._defines,i);for(var h=0;h<t.length;h++){var u=t[h];delete this._defines[u.name]}return r},i.beginChangeStatesSilently=function(){},i.endChangeStatesSilently=function(){},i._doInit=function(i,n){var e;void 0===n&&(n=!1),this._priority=128,this._stage=100;var s=null==(e=k.rendering)?void 0:e.enableEffectImport;if(s){var h=k.rendering;if("number"==typeof i.phase?(this._passID=i._passID,this._subpassID=i._subpassID,this._phaseID=i._phaseID):(this._passID=h.getPassID(i.pass),this._passID!==h.INVALID_ID&&(i.subpass?(this._subpassID=h.getSubpassID(this._passID,i.subpass),this._phaseID=h.getPhaseID(this._subpassID,i.phase)):this._phaseID=h.getPhaseID(this._passID,i.phase))),this._passID===h.INVALID_ID)return void ut(12107,i.program);if(this._phaseID===h.INVALID_ID)return void ut(12108,i.program)}else"number"==typeof i.phase?this._passID=i._passID:i.pass&&"default"!==i.pass&&(at(4294967295===this._passID,12110),this._passID=0);this._phase=ok("default"),this._primitive=7,this._passIndex=i.passIndex,this._propertyIndex=void 0!==i.propertyIndex?i.propertyIndex:i.passIndex,this._programName=i.program,this._defines=n?r({},i.defines):i.defines,this._shaderInfo=s?k.rendering.programLib.getProgramInfo(this._phaseID,this._programName):TA.getTemplate(i.program),this._properties=i.properties||this._properties;var u=this._device;t.fillPipelineInfo(this,i),i.stateOverrides&&t.fillPipelineInfo(this,i.stateOverrides),vk.layout=s?k.rendering.programLib.getMaterialDescriptorSetLayout(this._device,this._phaseID,i.program):TA.getDescriptorSetLayout(this._device,i.program),this._descriptorSet=this._device.createDescriptorSet(vk);var o,a,c=this._shaderInfo.blocks;if(s){var f=k.rendering.programLib;o=f.getBlockSizes(this._phaseID,this._programName),a=f.getHandleMap(this._phaseID,this._programName)}else{var v=TA.getTemplateInfo(i.program);o=v.blockSizes,a=v.handleMap}if(s){var l=k.rendering.programLib.getShaderInfo(this._phaseID,this.program);this._u(u,l.blocks,o)}else this.mu(u,c,o);var d=this._propertyHandleMap=a,g={};for(var w in this._properties){var _=this._properties[w];_.handleInfo&&(g[w]=this.getHandle.apply(this,_.handleInfo))}Object.assign(d,g)},i.mu=function(t,i,n){for(var e=t.capabilities.uboOffsetAlignment,r=[],s=0,h=0,u=0;u<i.length;u++){var o=n[u];r.push(h),h+=Math.ceil(o/e)*e,s=o}var a=r[r.length-1]+16*Math.ceil(s/16);a&&(ck.size=16*Math.ceil(a/16),this._rootBuffer=t.createBuffer(ck),this._rootBlock=new ArrayBuffer(a));for(var c=0,f=0;c<i.length;c++){var v=i[c].binding,l=n[c];fk.buffer=this._rootBuffer,fk.offset=r[f++],fk.range=16*Math.ceil(l/16);var d=this._buffers[v]=t.createBuffer(fk);this._blocks[v]=new Float32Array(this._rootBlock,fk.offset,l/4),this._blocksInt[v]=new Int32Array(this._blocks[v].buffer,this._blocks[v].byteOffset,this._blocks[v].length),this._descriptorSet.bindBuffer(v,d)}},i._u=function(t,i,n){for(var e=t.capabilities.uboOffsetAlignment,r=[],s=0,h=0,u=0;u<i.length;u++)if(1===i[u].set){var o=n[u];r.push(h),h+=Math.ceil(o/e)*e,s=o}if(0!==s){var a=r[r.length-1]+s;a&&(ck.size=16*Math.ceil(a/16),this._rootBuffer=t.createBuffer(ck),this._rootBlock=new ArrayBuffer(a))}for(var c=0,f=0;c<i.length;c++)if(1===i[c].set){var v=i[c].binding,l=n[c];fk.buffer=this._rootBuffer,fk.offset=r[f++],fk.range=16*Math.ceil(l/16);var d=this._buffers[v]=t.createBuffer(fk);this._blocks[v]=new Float32Array(this._rootBlock,fk.offset,l/4),this._blocksInt[v]=new Int32Array(this._blocks[v].buffer,this._blocks[v].byteOffset,this._blocks[v].length),this._descriptorSet.bindBuffer(v,d)}},i._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(1)?this._batchingScheme=1:(this._defines.USE_INSTANCING=!1,this._batchingScheme=0):this._batchingScheme=0},i.wu=function(t,i){return t<13?this._blocksInt[i]:this._blocks[i]},i.pu=function(t,i,n){this._priority=t.priority,this._stage=t.stage,this._phase=t.phase,this._phaseID=t._phaseID,this._passID=t._passID,this._batchingScheme=t.batchingScheme,this._primitive=t.primitive,this._dynamicStates=t.dynamicStates,this._bs=t.blendState,this._dss=i,this._descriptorSet=t.descriptorSet,this._rs=t.rasterizerState,this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,k.rendering&&k.rendering.enableEffectImport?this._pipelineLayout=k.rendering.programLib.getPipelineLayout(this.device,this._phaseID,this._programName):this._pipelineLayout=TA.getTemplateInfo(this._programName).pipelineLayout,this._hash=t._hash^n},i.yu=function(){this._hash=t.getPassHash(this)},i.bu=function(t){this._rootBufferDirty=t},i.Au=function(t){this._priority=t},e(t,[{key:"_isBlend",get:function(){return this.blendState.targets.some((function(t){return t.blend}))}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return k.rendering&&k.rendering.enableEffectImport?k.rendering.programLib.getLocalDescriptorSetLayout(this._device,this._phaseID,this._programName):TA.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"passID",get:function(){return this._passID}},{key:"phaseID",get:function(){return this._phaseID}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}();function dk(t){var i=",bs,"+t.isA2C;return t.targets.forEach((function(t){i+=",bt,"+t.blend+","+t.blendEq+","+t.blendAlphaEq+","+t.blendColorMask,i+=","+t.blendSrc+","+t.blendDst+","+t.blendSrcAlpha+","+t.blendDstAlpha})),i}function gk(t){var i=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return i+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,i+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(i+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}lk.getTypeFromHandle=Vb,lk.getBindingFromHandle=$b,lk.getCountFromHandle=Wb,lk.getOffsetFromHandle=zb;var wk=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,i,n,e,r){var s=i.hash^e.hash^r.attributesHash^n.typedID,h=this.Eu.get(s);if(!h){var u=i.pipelineLayout,o=new jd(r.attributes),a=new Og(n,u,e,o,i.rasterizerState,i.depthStencilState,i.blendState,i.primitive,i.dynamicStates);h=t.createPipelineState(a),this.Eu.set(s,h)}return h},t}());wk.Eu=new Map;var _k=new id,mk=new Yl;function pk(t,i){t.x=i.x*i.x,t.y=i.y*i.y,t.z=i.z*i.z}var yk,bk,Ak,Ek,kk,Tk,Sk,Ok,Rk,Ik=null;function Mk(t){for(var i=t.length-1;i>=0;--i){var n=t[i];if(n.window.swapchain)return void(Ik=n)}Ik=null}function Nk(t,i,n,e,r){if(!Ub()&&e&&e.enabled&&r===Ik){var s=e.subModels[0],h=s.inputAssembler,u=s.passes,o=s.shaders,a=s.descriptorSet;_k.width=mk.width=r.window.width,_k.height=mk.height=r.window.height;var c=wk.getOrCreatePipelineState(t,u[0],o[0],i,h);n.setViewport(_k),n.setScissor(mk),n.bindPipelineState(c),n.bindDescriptorSet(1,u[0].descriptorSet),n.bindDescriptorSet(2,a),n.bindInputAssembler(h),n.draw(h)}}var Ck=new De,Lk=t("Material",(yk=Ko("cc.Material"),bk=Ca(OA),yk((Ek=function(t){function i(i){var n;return(n=t.call(this,i)||this)._effectAsset=kk&&kk(),n._techIdx=Tk&&Tk(),n._defines=Sk&&Sk(),n._states=Ok&&Ok(),n._props=Rk&&Rk(),n._passes=[],n._hash=0,n}s(i,t),i.getHash=function(t){for(var i,n=0,e=d(t.passes);!(i=e()).done;)n^=i.value.hash;return n};var n=i.prototype;return n.initialize=function(t){this._passes.length?st(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this.ku(t),this.Tu())},n.reset=function(t){this.initialize(t)},n.destroy=function(){return this.Su(),t.prototype.destroy.call(this)},n.recompileShaders=function(){st(16370,this.name)},n.overridePipelineStates=function(){st(16371,this.name)},n.onLoaded=function(){this.Tu()},n.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var i=0;i<this._props.length;i++)this._props[i]={};if(t)for(var n,e=d(this._passes);!(n=e()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(t,i,n){var e=!1;if(void 0===n)for(var r=this._passes,s=r.length,h=0;h<s;h++){var u=r[h];this.Ou(u,t,i)&&(this._props[u.propertyIndex][t]=i,e=!0)}else{n>=this._passes.length&&st(16372,n);var o=this._passes[n];this.Ou(o,t,i)&&(this._props[o.propertyIndex][t]=i,e=!0)}e||st(16373,t)},n.getProperty=function(t,i){if(void 0===i)for(var n=this._props,e=n.length,r=0;r<e;r++){var s=n[r];if(t in s)return s[t]}else{if(i>=this._passes.length)return st(16372,i),null;var h=this._props[this._passes[i].propertyIndex];if(t in h)return h[t]}return null},n.copy=function(t,i){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=r({},t._props[n]);this._defines.length=t._defines.length;for(var e=0;e<t._defines.length;e++)this._defines[e]=r({},t._defines[e]);this._states.length=t._states.length;for(var s=0;s<t._states.length;s++)this._states[s]=r({},t._states[s]);this._effectAsset=t._effectAsset,i&&this.ku(i),this.Tu()},n.ku=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=OA.get(t.effectName)),t.defines&&this.Ru(t.defines,this._defines),t.states&&this.Ru(t.states,this._states)},n.Ru=function(t,i){var n=t;if(!Array.isArray(n)){var e=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(e).fill(n)}for(var r=0;r<n.length;++r)Object.assign(i[r]||(i[r]={}),n[r])},n.Iu=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var i=t.passes.length,n=[],e=0;e<i;++e){var r=t.passes[e],s=r.passIndex=e,h=r.defines=this._defines[s]||(this._defines[s]={});if(r.stateOverrides=this._states[s]||(this._states[s]={}),void 0!==r.propertyIndex&&Object.assign(h,this._defines[r.propertyIndex]),void 0!==r.embeddedMacros&&Object.assign(h,r.embeddedMacros),!r.switch||h[r.switch]){var u=new lk(k.director.root);u.initialize(r),n.push(u)}}return n},n.Tu=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this.Iu();var e=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=e,t)this._passes.forEach((function(t,i){var e=n._props[i];for(var r in e||(e=n._props[i]={}),void 0!==t.propertyIndex&&Object.assign(e,n._props[t.propertyIndex]),e)n.Ou(t,r,e[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=i.getHash(this)},n.Ou=function(t,i,n){var e=this,r=t.getHandle(i);if(!r)return!1;if(Vb(r)<26)if(Array.isArray(n))t.setUniformArray(r,n);else if(null!==n){var s;if(null!=(s=t.properties[i])&&s.linear){var h=n;pk(Ck,h),Ck.w=h.w,n=Ck}t.setUniform(r,n)}else t.resetUniform(i);else Array.isArray(n)?n.forEach((function(i,n){e.Mu(t,r,i,n)})):n?this.Mu(t,r,n):t.resetTexture(i);return!0},n.Mu=function(t,i,n,e){var r=lk.getBindingFromHandle(i);if(n instanceof Lg)t.bindTexture(r,n,e);else if(n instanceof zw){var s=n.getGFXTexture();if(!s||!s.width||!s.height)return;t.bindTexture(r,s,e),t.bindSampler(r,n.getGFXSampler(),e)}},n.Su=function(){if(this._passes&&this._passes.length)for(var t,i=d(this._passes);!(t=i()).done;)t.value.destroy();this._passes.length=0},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new cr("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},e(i,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),i}(kw),kk=xo(Ek.prototype,"_effectAsset",[bk],(function(){return null})),Tk=xo(Ek.prototype,"_techIdx",[oa],(function(){return 0})),Sk=xo(Ek.prototype,"_defines",[oa],(function(){return[]})),Ok=xo(Ek.prototype,"_states",[oa],(function(){return[]})),Rk=xo(Ek.prototype,"_props",[oa],(function(){return[]})),Ak=Ek))||Ak));k.Material=Lk;var Fk=Ni({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),Pk=Ni({Planar:0,ShadowMap:1}),Bk=Ni({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3}),Dk=Ni({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4}),Uk=Ni({NONE:1,RemoveDuplicates:2,DisableRotationFix:3}),xk=Pk.ShadowMap+1,Gk=function(){function t(){this.fixedSphere=new Ys(0,0,0,.01),this.maxReceived=4,this._matLight=new Kr,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=xk,this._distance=0,this._planeBias=1,this._normal=new ir(0,1,0),this._shadowColor=new cr(0,0,0,76),this._size=new ls(1024,1024),this._shadowMapDirty=!1}var i=t.prototype;return i.getPlanarShader=function(t){this._material||(this._material=new Lk,this._material.initialize({effectName:"pipeline/planar-shadow"}));var i=this._material.passes;return i.length>0?i[0].getShaderVariant(t):null},i.initialize=function(t){this._enabled=t.enabled,this._type=this.enabled?t.type:xk,this.normal=t.planeDirection,this.distance=t.planeHeight,this.planeBias=t.planeBias,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,t.shadowMapSize!==this._size.x&&(this.size.set(t.shadowMapSize,t.shadowMapSize),this._shadowMapDirty=!0)},i.activate=function(){if(this._enabled)if(this.type===Pk.Planar)this._updatePlanarInfo();else{var t=k.director.root;t.pipeline.macros.CC_SHADOW_TYPE=2,t.onGlobalPipelineStateChanged()}else{var i=k.director.root;i.pipeline.macros.CC_SHADOW_TYPE=0,i.onGlobalPipelineStateChanged()}},i._updatePlanarInfo=function(){this._material||(this._material=new Lk,this._material.initialize({effectName:"pipeline/planar-shadow"}));var t=k.director.root;t.pipeline.macros.CC_SHADOW_TYPE=1,t.onGlobalPipelineStateChanged()},i.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:xk,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){ir.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),t}();Gk.MAX_FAR=2e3,Gk.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),k.Shadows=Gk;var jk=function(t){function i(i,n){var e;(e=t.call(this,i.root)||this).Nu=!1,e.Cu=i,e.Lu=n,e._doInit(e.Cu,!0),e._shaderInfo.blocks.forEach((function(t){var i=e._blocks[t.binding],n=e.Cu.blocks[t.binding];i.set(n)})),e._rootBufferDirty=!0;var r=e.Cu,s=e._descriptorSet;return e._shaderInfo.samplerTextures.forEach((function(t){for(var i=0;i<t.count;i++){var n=r._descriptorSet,e=t.binding,h=n.getSampler(e,i),u=n.getTexture(e,i);s.bindSampler(e,h,i),s.bindTexture(e,u,i)}})),t.prototype.tryCompile.call(f(e)),e}s(i,t);var n=i.prototype;return n.overridePipelineStates=function(t,i){this._bs.reset(),this._rs.reset(),this._dss.reset(),lk.fillPipelineInfo(this,t),lk.fillPipelineInfo(this,i),this._onStateChange()},n.tryCompile=function(i){if(i&&!tA(this._defines,i))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this.Nu=!0},n.endChangeStatesSilently=function(){this.Nu=!1},n._syncBatchingScheme=function(){this._defines.USE_INSTANCING=!1,this._batchingScheme=0},n._onStateChange=function(){this._hash=lk.getPassHash(this),this.Lu.onPassStateChange(this.Nu)},e(i,[{key:"parent",get:function(){return this.Cu}}]),i}(lk),Hk=function(t){function i(i){var n;return(n=t.call(this)||this)._passes=[],n.Fu=0,n.Cu=i.parent,n.Lu=i.owner||null,n.Fu=i.subModelIdx||0,n.copy(n.Cu),n}s(i,t);var n=i.prototype;return n.recompileShaders=function(t,i){this._passes&&this.effectAsset&&(void 0===i?this._passes.forEach((function(i){i.tryCompile(t)})):this._passes[i].tryCompile(t))},n.overridePipelineStates=function(t,i){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===i)for(var e=0;e<this._passes.length;e++){var r=this._passes[e],s=this._states[e]||(this._states[e]={});for(var h in t)s[h]=t[h];r.overridePipelineStates(n[r.passIndex],s)}else{var u=this._states[i]||(this._states[i]={});for(var o in t)u[o]=t[o];this._passes[i].overridePipelineStates(n[i],u)}}},n.destroy=function(){return this.Su(),!0},n.onPassStateChange=function(t){this._hash=Lk.getHash(this),!t&&this.Lu&&this.Lu.Pu(this.Fu,this)},n.Iu=function(){var t=[],i=this.Cu.passes;if(!i)return t;for(var n=0;n<i.length;++n)t.push(new jk(i[n],this));return t},e(i,[{key:"parent",get:function(){return this.Cu}},{key:"owner",get:function(){return this.Lu}}]),i}(Lk),Vk=null,$k=null,Wk={HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2};Ni(Wk);var zk=function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var i=t.prototype;return i.initialize=function(t){this._activated=!1,this._enabled=t.enabled,this._useIBL=t.useIBL,this._useDiffuseMap=t.applyDiffuseMap,this._useHDR=t.useHDR},i.setEnvMaps=function(t,i){this._envmapHDR=t,this._envmapLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setDiffuseMaps=function(t,i){this._diffuseMapHDR=t,this._diffuseMapLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setSkyboxMaterial=function(t){t?(this._editableMaterial=new Hk({parent:t}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},i.setReflectionMaps=function(t,i){this._reflectionHDR=t,this._reflectionLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setRotationAngle=function(t){this._rotationAngle=t},i.getRotationAngle=function(){return this._rotationAngle},i.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},i.activate=function(){var t=k.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=uk.get("default-cube-texture"),this._model||(this._model=k.director.root.createModel(k.renderer.scene.Model));var i=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(i=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!$k){var n=new Lk;n.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:i}}),$k=new Hk({parent:n})}this.enabled&&(Vk||(Vk=k.utils.createMesh(k.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,Vk.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,Vk.renderingSubMeshes[0],$k)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=k.director.root,i=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,e=this.useIBL&&this.useDiffuseMap&&this.diffuseMap&&this.diffuseMap!==this._default?this.isRGBE?2:1:0,r=this.useHDR,s=this.useConvolutionMap;if(i.macros.CC_USE_IBL===n&&i.macros.CC_USE_DIFFUSEMAP===e&&i.macros.CC_USE_HDR===r&&i.macros.CC_IBL_CONVOLUTED===s||(i.macros.CC_USE_IBL=n,i.macros.CC_USE_DIFFUSEMAP=e,i.macros.CC_USE_HDR=r,i.macros.CC_IBL_CONVOLUTED=s,this._activated&&t.onGlobalPipelineStateChanged()),this.enabled){var h=this.envmap?this.envmap:this._default,u=this._editableMaterial?this._editableMaterial:$k;u&&(u.setProperty("environmentMap",h),u.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,u),this._updateSubModes())}},i._updateGlobalBinding=function(){if(!k.rendering&&this._globalDSManager){var t=Hg.gfxDevice;if(this.reflectionMap){var i=this.reflectionMap.getGFXTexture(),n=t.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(5,n),this._globalDSManager.bindTexture(5,i)}else{var e=this.envmap?this.envmap:this._default;if(e){var r=e.getGFXTexture(),s=t.getSampler(e.getSamplerInfo());this._globalDSManager.bindSampler(5,s),this._globalDSManager.bindTexture(5,r)}}var h=this.diffuseMap?this.diffuseMap:this._default;if(h){var u=h.getGFXTexture(),o=t.getSampler(h.getSamplerInfo());this._globalDSManager.bindSampler(7,o),this._globalDSManager.bindTexture(7,u)}this._globalDSManager.update()}},i._updateSubModes=function(){if(this._model)for(var t=this._model.subModels,i=0;i<t.length;i++)t[i].update()},e(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._useHDR=t,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._useIBL=t,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return qp().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){qp().isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return qp().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){qp().isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"reflectionMap",get:function(){return qp().isHDR?this._reflectionHDR:this._reflectionLDR}},{key:"editableMaterial",get:function(){return this._editableMaterial}}]),t}();k.Skybox=zk;var Xk=new De,Yk=Ni({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),Kk=Yk.LAYERED+1,qk=function(){function t(){this._fogColor=new cr("#C8C8C8"),this._colorArray=new De(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var i=t.prototype;return i.initialize=function(t){this._activated=!1,this.fogColor=t.fogColor,this._enabled=t.enabled,this._type=this.enabled?t.type:Kk,this._accurate=t.accurate,this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},i.activate=function(){this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=k.director.root,i=this.enabled?this.type:Kk,n=this.accurate?1:0,e=t.pipeline;e.macros.CC_USE_FOG===i&&e.macros.CC_USE_ACCURATE_FOG===n||(e.macros.CC_USE_FOG=i,e.macros.CC_USE_ACCURATE_FOG=n,this._activated&&t.onGlobalPipelineStateChanged())},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():(this._type=Kk,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate=t,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),Xk.set(t.x,t.y,t.z,t.w),pk(this._colorArray,Xk)}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:Kk,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}}]),t}();k.Fog=qk;var Qk,Zk,Jk,tT,iT,nT,eT,rT,sT,hT,uT,oT,aT,cT,fT,vT,lT,dT,gT,wT,_T,mT,pT,yT,bT,AT,ET,kT,TT,ST,OT,RT,IT,MT,NT,CT,LT,FT,PT,BT,DT,UT,xT,GT,jT,HT,VT,$T,WT,zT,XT,YT,KT,qT,QT,ZT,JT,tS,iS,nS,eS,rS,sS,hS,uS,oS,aS,cS,fS,vS,lS,dS,gS,wS,_S,mS,pS,yS,bS,AS,ES,kS,TS,SS,OS,RS,IS,MS,NS,CS,LS,FS,PS,BS,DS,US,xS,GS,jS,HS,VS,$S,WS,zS,XS,YS,KS,qS,QS,ZS,JS,tO,iO,nO,eO,rO,sO,hO,uO,oO,aO,cO,fO,vO,lO,dO,gO,wO,_O,mO,pO=Ni({DEFAULT:0,LINEAR:1}),yO=function(){function t(){this._toneMappingType=pO.DEFAULT,this._activated=!1}var i=t.prototype;return i.initialize=function(t){this._toneMappingType=t.toneMappingType},i.activate=function(){this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=k.director.root;t.pipeline.macros.CC_TONE_MAPPING_TYPE=this._toneMappingType,this._activated&&t.onGlobalPipelineStateChanged()},e(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._updatePipeline()}}]),t}(),bO=new ir(0,1,0),AO=new ir,EO=new De,kO=new cr,TO=new Cr,SO=function(t){var i=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);i<1&&(t.x*=i,t.y*=i,t.z*=i)},OO=t("AmbientInfo",(Qk=Ko("cc.AmbientInfo"),Zk=Ca(fn),Jk=aa("_skyColor"),tT=aa("_skyIllum"),iT=aa("_groundAlbedo"),Qk((eT=function(){function t(){this._skyColorHDR=rT&&rT(),this._skyIllumHDR=sT&&sT(),this._groundAlbedoHDR=hT&&hT(),this._skyColorLDR=uT&&uT(),this._skyIllumLDR=oT&&oT(),this._groundAlbedoLDR=aT&&aT(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},e(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=qp().isHDR;return EO.set(t?this._skyColorHDR:this._skyColorLDR),SO(EO),kO.set(255*EO.x,255*EO.y,255*EO.z,255)},set:function(t){EO.set(t.x,t.y,t.z,t.w),qp().isHDR?this._skyColorHDR.set(EO):this._skyColorLDR.set(EO),this._resource&&this._resource.skyColor.set(EO)}},{key:"skyColor",set:function(t){qp().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return qp().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){qp().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=qp().isHDR;return EO.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),SO(EO),kO.set(255*EO.x,255*EO.y,255*EO.z,255)},set:function(t){EO.set(t.x,t.y,t.z,t.w),qp().isHDR?this._groundAlbedoHDR.set(EO):this._groundAlbedoLDR.set(EO),this._resource&&this._resource.groundAlbedo.set(EO)}},{key:"groundAlbedo",set:function(t){qp().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),m(eT.prototype,"skyIllum",[Zk],Object.getOwnPropertyDescriptor(eT.prototype,"skyIllum"),eT.prototype),rT=xo(eT.prototype,"_skyColorHDR",[oa,Jk],(function(){return new De(.2,.5,.8,1)})),sT=xo(eT.prototype,"_skyIllumHDR",[oa,tT],(function(){return fy.SKY_ILLUM})),hT=xo(eT.prototype,"_groundAlbedoHDR",[oa,iT],(function(){return new De(.2,.2,.2,1)})),uT=xo(eT.prototype,"_skyColorLDR",[oa],(function(){return new De(.2,.5,.8,1)})),oT=xo(eT.prototype,"_skyIllumLDR",[oa],(function(){return fy.SKY_ILLUM})),aT=xo(eT.prototype,"_groundAlbedoLDR",[oa],(function(){return new De(.2,.2,.2,1)})),nT=eT))||nT));T.AmbientInfo=OO;var RO=t("SkyboxInfo",(cT=Ko("cc.SkyboxInfo"),fT=Ca(Wk),vT=Ca(Yp),lT=Ca(fn),dT=Ca(Yp),gT=Ca(Yp),wT=Ca(Lk),_T=Ca(Yp),mT=aa("_envmap"),pT=Ca(Yp),yT=Ca(Yp),bT=Ca(Yp),AT=Ca(Lk),ET=Ca(Yp),kT=Ca(Yp),cT((ST=function(){function t(){this._envLightingType=OT&&OT(),this._envmapHDR=RT&&RT(),this._envmapLDR=IT&&IT(),this._diffuseMapHDR=MT&&MT(),this._diffuseMapLDR=NT&&NT(),this._enabled=CT&&CT(),this._useHDR=LT&&LT(),this._editableMaterial=FT&&FT(),this._reflectionHDR=PT&&PT(),this._reflectionLDR=BT&&BT(),this._rotationAngle=DT&&DT(),this._resource=null}var i=t.prototype;return i.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,t.initialize(this),t.setEnvMaps(this._envmapHDR,this._envmapLDR),t.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),t.setSkyboxMaterial(this._editableMaterial),t.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),t.setRotationAngle(this._rotationAngle),t.activate()},i.updateEnvMap=function(t){t||(this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=0,st(15001));var i=this._resource;i&&(i.setEnvMaps(this._envmapHDR,this._envmapLDR),i.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),i.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),i.useDiffuseMap=this.applyDiffuseMap,i.envmap=t)},i.setMaterialProperty=function(t,i,n){var e=this._resource;if(e){var r=e.editableMaterial;e.enabled&&r&&(r.setProperty(t,i,n),r.passes.forEach((function(t){t.update()})))}},e(t,[{key:"applyDiffuseMap",get:function(){return 2===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||0===t?(0===t?(this.useIBL=!1,this.applyDiffuseMap=!1):1===t?(this.useIBL=!0,this.applyDiffuseMap=!1):2===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=0,st(15001))}},{key:"useIBL",get:function(){return 0!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return qp().isHDR=this._useHDR,this._useHDR},set:function(t){qp().isHDR=t,this._useHDR=t;var i=this._resource;i&&2===this.envLightingType&&(null===this.diffuseMap?(this.envLightingType=1,st(15e3)):this.diffuseMap.isDefault&&st(15002)),i&&(i.useHDR=this._useHDR,i.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return qp().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var i=qp().isHDR;i?(this._envmapHDR=t,this._reflectionHDR=null):(this._envmapLDR=t,this._reflectionLDR=null),t||(i?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=0,st(15001));var n=this._resource;n&&(n.setEnvMaps(this._envmapHDR,this._envmapLDR),n.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),n.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),n.useDiffuseMap=this.applyDiffuseMap,n.envmap=t)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(t){this._rotationAngle=t,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return qp().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){qp().isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return qp().isHDR?this._reflectionHDR:this._reflectionLDR},set:function(t){qp().isHDR?this._reflectionHDR=t:this._reflectionLDR=t,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(t){this._editableMaterial=t,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),t}(),m(ST.prototype,"envLightingType",[fT],Object.getOwnPropertyDescriptor(ST.prototype,"envLightingType"),ST.prototype),m(ST.prototype,"envmap",[vT],Object.getOwnPropertyDescriptor(ST.prototype,"envmap"),ST.prototype),m(ST.prototype,"rotationAngle",[lT],Object.getOwnPropertyDescriptor(ST.prototype,"rotationAngle"),ST.prototype),m(ST.prototype,"diffuseMap",[dT],Object.getOwnPropertyDescriptor(ST.prototype,"diffuseMap"),ST.prototype),m(ST.prototype,"reflectionMap",[gT],Object.getOwnPropertyDescriptor(ST.prototype,"reflectionMap"),ST.prototype),m(ST.prototype,"skyboxMaterial",[wT],Object.getOwnPropertyDescriptor(ST.prototype,"skyboxMaterial"),ST.prototype),OT=xo(ST.prototype,"_envLightingType",[oa],(function(){return 0})),RT=xo(ST.prototype,"_envmapHDR",[oa,_T,mT],(function(){return null})),IT=xo(ST.prototype,"_envmapLDR",[oa,pT],(function(){return null})),MT=xo(ST.prototype,"_diffuseMapHDR",[oa,yT],(function(){return null})),NT=xo(ST.prototype,"_diffuseMapLDR",[oa,bT],(function(){return null})),CT=xo(ST.prototype,"_enabled",[oa],(function(){return!1})),LT=xo(ST.prototype,"_useHDR",[oa],(function(){return!0})),FT=xo(ST.prototype,"_editableMaterial",[oa,AT],(function(){return null})),PT=xo(ST.prototype,"_reflectionHDR",[oa,ET],(function(){return null})),BT=xo(ST.prototype,"_reflectionLDR",[oa,kT],(function(){return null})),DT=xo(ST.prototype,"_rotationAngle",[oa],(function(){return 0})),TT=ST))||TT));T.SkyboxInfo=RO;var IO=t("FogInfo",(UT=Ko("cc.FogInfo"),xT=Ca(Yk),GT=Ca(fn),jT=Ca(fn),HT=Ca(fn),VT=Ca(fn),$T=Ca(fn),WT=Ca(fn),UT((rS=function(){function t(){this._type=YT&&YT(),this._fogColor=KT&&KT(),this._enabled=qT&&qT(),this._fogDensity=QT&&QT(),this._fogStart=ZT&&ZT(),this._fogEnd=JT&&JT(),this._fogAtten=tS&&tS(),this._fogTop=iS&&iS(),this._fogRange=nS&&nS(),this._accurate=eS&&eS(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var i=this._resource;i&&(i.enabled=t,t&&(i.type=this._type))}}},{key:"accurate",get:function(){return this._accurate},set:function(t){if(this._accurate!==t){this._accurate=t;var i=this._resource;i&&(i.accurate=t,t&&(i.type=this._type))}}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),rS.FogType=Yk,m((XT=rS).prototype,"type",[xT],Object.getOwnPropertyDescriptor(XT.prototype,"type"),XT.prototype),m(XT.prototype,"fogDensity",[GT],Object.getOwnPropertyDescriptor(XT.prototype,"fogDensity"),XT.prototype),m(XT.prototype,"fogStart",[jT],Object.getOwnPropertyDescriptor(XT.prototype,"fogStart"),XT.prototype),m(XT.prototype,"fogEnd",[HT],Object.getOwnPropertyDescriptor(XT.prototype,"fogEnd"),XT.prototype),m(XT.prototype,"fogAtten",[VT],Object.getOwnPropertyDescriptor(XT.prototype,"fogAtten"),XT.prototype),m(XT.prototype,"fogTop",[$T],Object.getOwnPropertyDescriptor(XT.prototype,"fogTop"),XT.prototype),m(XT.prototype,"fogRange",[WT],Object.getOwnPropertyDescriptor(XT.prototype,"fogRange"),XT.prototype),YT=xo(XT.prototype,"_type",[oa],(function(){return Yk.LINEAR})),KT=xo(XT.prototype,"_fogColor",[oa],(function(){return new cr("#C8C8C8")})),qT=xo(XT.prototype,"_enabled",[oa],(function(){return!1})),QT=xo(XT.prototype,"_fogDensity",[oa],(function(){return.3})),ZT=xo(XT.prototype,"_fogStart",[oa],(function(){return.5})),JT=xo(XT.prototype,"_fogEnd",[oa],(function(){return 300})),tS=xo(XT.prototype,"_fogAtten",[oa],(function(){return 5})),iS=xo(XT.prototype,"_fogTop",[oa],(function(){return 1.5})),nS=xo(XT.prototype,"_fogRange",[oa],(function(){return 1.2})),eS=xo(XT.prototype,"_accurate",[oa],(function(){return!1})),zT=XT))||zT)),MO=t("ShadowsInfo",(sS=Ko("cc.ShadowsInfo"),hS=Ca(Pk),uS=Ca(fn),oS=Ca(fn),aS=Ca(cn),cS=Ca(Fk),sS((vS=function(){function t(){this._enabled=lS&&lS(),this._type=dS&&dS(),this._normal=gS&&gS(),this._distance=wS&&wS(),this._planeBias=_S&&_S(),this._shadowColor=mS&&mS(),this._maxReceived=pS&&pS(),this._size=yS&&yS(),this._resource=null}var i=t.prototype;return i.setPlaneFromNode=function(t){t.getWorldRotation(TO),this.planeDirection=ir.transformQuat(AO,bO,TO),t.getWorldPosition(AO),this.planeHeight=ir.dot(this._normal,AO)},i.activate=function(t){this._resource=t,t.initialize(this),t.activate()},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var i=this._resource;i&&(i.enabled=t,t&&(i.type=this._type))}}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){ir.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t,this._resource&&(this._resource.planeBias=t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){var i=this._resource;this._size.set(t,t),i&&(i.size.set(t,t),i.shadowMapDirty=!0)}}]),t}(),m(vS.prototype,"type",[hS],Object.getOwnPropertyDescriptor(vS.prototype,"type"),vS.prototype),m(vS.prototype,"planeHeight",[uS],Object.getOwnPropertyDescriptor(vS.prototype,"planeHeight"),vS.prototype),m(vS.prototype,"planeBias",[oS],Object.getOwnPropertyDescriptor(vS.prototype,"planeBias"),vS.prototype),m(vS.prototype,"maxReceived",[aS],Object.getOwnPropertyDescriptor(vS.prototype,"maxReceived"),vS.prototype),m(vS.prototype,"shadowMapSize",[cS],Object.getOwnPropertyDescriptor(vS.prototype,"shadowMapSize"),vS.prototype),lS=xo(vS.prototype,"_enabled",[oa],(function(){return!1})),dS=xo(vS.prototype,"_type",[oa],(function(){return Pk.Planar})),gS=xo(vS.prototype,"_normal",[oa],(function(){return new ir(0,1,0)})),wS=xo(vS.prototype,"_distance",[oa],(function(){return 0})),_S=xo(vS.prototype,"_planeBias",[oa],(function(){return 1})),mS=xo(vS.prototype,"_shadowColor",[oa],(function(){return new cr(0,0,0,76)})),pS=xo(vS.prototype,"_maxReceived",[oa],(function(){return 4})),yS=xo(vS.prototype,"_size",[oa],(function(){return new ls(1024,1024)})),fS=vS))||fS));T.ShadowsInfo=MO;var NO=t("DEFAULT_WORLD_MIN_POS",new ir(-1024,-1024,-1024)),CO=t("DEFAULT_WORLD_MAX_POS",new ir(1024,1024,1024)),LO=t("DEFAULT_OCTREE_DEPTH",8),FO=t("OctreeInfo",(bS=Ko("cc.OctreeInfo"),AS=Ca(cn),bS((kS=function(){function t(){this._enabled=TS&&TS(),this._minPos=SS&&SS(),this._maxPos=OS&&OS(),this._depth=RS&&RS(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),m(kS.prototype,"depth",[AS],Object.getOwnPropertyDescriptor(kS.prototype,"depth"),kS.prototype),TS=xo(kS.prototype,"_enabled",[oa],(function(){return!1})),SS=xo(kS.prototype,"_minPos",[oa],(function(){return new ir(NO)})),OS=xo(kS.prototype,"_maxPos",[oa],(function(){return new ir(CO)})),RS=xo(kS.prototype,"_depth",[oa],(function(){return LO})),ES=kS))||ES));T.OctreeInfo=FO;var PO=t("SkinInfo",(IS=Ko("cc.SkinInfo"),MS=Ca(fn),NS=Ca(fn),IS((LS=function(){function t(){this._enabled=FS&&FS(),this._blurRadius=PS&&PS(),this._sssIntensity=BS&&BS(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(t){this._blurRadius=t,this._resource&&(this._resource.blurRadius=t)}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(t){this._sssIntensity=t,this._resource&&(this._resource.sssIntensity=t)}}]),t}(),m(LS.prototype,"blurRadius",[MS],Object.getOwnPropertyDescriptor(LS.prototype,"blurRadius"),LS.prototype),m(LS.prototype,"sssIntensity",[NS],Object.getOwnPropertyDescriptor(LS.prototype,"sssIntensity"),LS.prototype),FS=xo(LS.prototype,"_enabled",[oa],(function(){return!0})),PS=xo(LS.prototype,"_blurRadius",[oa],(function(){return.01})),BS=xo(LS.prototype,"_sssIntensity",[oa],(function(){return 3})),CS=LS))||CS));T.SkinInfo=PO;var BO=t("PostSettingsInfo",(DS=Ko("cc.PostSettingsInfo"),US=Ca(pO),DS((GS=function(){function t(){this._toneMappingType=jS&&jS(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},e(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._resource&&(this._resource.toneMappingType=t)}}]),t}(),m(GS.prototype,"toneMappingType",[US],Object.getOwnPropertyDescriptor(GS.prototype,"toneMappingType"),GS.prototype),jS=xo(GS.prototype,"_toneMappingType",[oa],(function(){return pO.DEFAULT})),xS=GS))||xS));T.PostSettingsInfo=BO;var DO,UO,xO,GO,jO,HO,VO,$O,WO,zO,XO,YO,KO,qO,QO,ZO,JO,tR,iR,nR,eR,rR,sR,hR,uR,oR,aR,cR,fR,vR,lR,dR,gR,wR,_R,mR,pR,yR,bR,AR,ER,kR,TR,SR,OR,RR,IR,MR,NR,CR,LR,FR,PR,BR,DR,UR,xR,GR,jR,HR,VR,$R,WR,zR,XR,YR,KR,qR,QR,ZR=t("LightProbeInfo",(HS=Ko("cc.LightProbeInfo"),VS=Ca(fn),$S=Ca(cn),WS=Ca(cn),zS=Ca(fn),XS=Ca(fn),HS((KS=function(){function t(){this._giScale=qS&&qS(),this._giSamples=QS&&QS(),this._bounces=ZS&&ZS(),this._reduceRinging=JS&&JS(),this._showProbe=tO&&tO(),this._showWireframe=iO&&iO(),this._showConvex=nO&&nO(),this._data=eO&&eO(),this._lightProbeSphereVolume=rO&&rO(),this._nodes=[],this._scene=null,this._resource=null}var i=t.prototype;return i.activate=function(t,i){this._scene=t,this._resource=i,i.initialize(this)},i.onProbeBakeFinished=function(){this.Bu(this._scene)},i.onProbeBakeCleared=function(){this.clearSHCoefficients(),this.Bu(this._scene)},i.Bu=function(t){var i=this;t&&(t.emit("light-probe-baking-changed"),t.children.forEach((function(t){i.Bu(t)})))},i.clearSHCoefficients=function(){this._data&&(this._data.probes.forEach((function(t){t.coefficients.length=0})),this.Du())},i.isUniqueNode=function(){return 1===this._nodes.length},i.addNode=function(t){if(!t)return!1;for(var i=0;i<this._nodes.length;i++)if(this._nodes[i].node===t)return!1;return this._nodes.push({node:t,probes:null}),!0},i.removeNode=function(t){if(!t)return!1;var i=this._nodes.findIndex((function(i){return i.node===t}));return-1!==i&&(this._nodes.splice(i,1),!0)},i.syncData=function(t,i){for(var n=0;n<this._nodes.length;n++)if(this._nodes[n].node===t)return void(this._nodes[n].probes=i)},i.update=function(t){if(void 0===t&&(t=!0),k.internal.LightProbesData){this._data||(this._data=new k.internal.LightProbesData,this._resource&&(this._resource.data=this._data));for(var i=[],n=0;n<this._nodes.length;n++){var e=this._nodes[n],r=e.node,s=e.probes,h=r.worldPosition;if(s)for(var u=0;u<s.length;u++){var o=nr();ir.add(o,s[u],h),i.push(o)}}if(i.length<4)return this.Uu(),void this._data.reset();this._data.updateProbes(i),t&&(this.Uu(),this._data.updateTetrahedrons())}},i.Du=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.clearSHUBOs()}))}},i.Uu=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.tetrahedronIndex=-1}))}},e(t,[{key:"giScale",get:function(){return this._giScale},set:function(t){this._giScale!==t&&(this._giScale=t,this._resource&&(this._resource.giScale=t))}},{key:"giSamples",get:function(){return this._giSamples},set:function(t){this._giSamples!==t&&(this._giSamples=t,this._resource&&(this._resource.giSamples=t))}},{key:"bounces",get:function(){return this._bounces},set:function(t){this._bounces!==t&&(this._bounces=t,this._resource&&(this._resource.bounces=t))}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(t){this._reduceRinging!==t&&(this._reduceRinging=t,this._resource&&(this._resource.reduceRinging=t))}},{key:"showProbe",get:function(){return this._showProbe},set:function(t){this._showProbe!==t&&(this._showProbe=t,this._resource&&(this._resource.showProbe=t))}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(t){this._showWireframe!==t&&(this._showWireframe=t,this._resource&&(this._resource.showWireframe=t))}},{key:"showConvex",get:function(){return this._showConvex},set:function(t){this._showConvex!==t&&(this._showConvex=t,this._resource&&(this._resource.showConvex=t))}},{key:"data",get:function(){return this._data},set:function(t){this._data!==t&&(this._data=t,this._resource&&(this._resource.data=t))}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(t){this._lightProbeSphereVolume!==t&&(this._lightProbeSphereVolume=t,this._resource&&(this._resource.lightProbeSphereVolume=t))}}]),t}(),m(KS.prototype,"giScale",[VS],Object.getOwnPropertyDescriptor(KS.prototype,"giScale"),KS.prototype),m(KS.prototype,"giSamples",[$S],Object.getOwnPropertyDescriptor(KS.prototype,"giSamples"),KS.prototype),m(KS.prototype,"bounces",[WS],Object.getOwnPropertyDescriptor(KS.prototype,"bounces"),KS.prototype),m(KS.prototype,"reduceRinging",[zS],Object.getOwnPropertyDescriptor(KS.prototype,"reduceRinging"),KS.prototype),m(KS.prototype,"lightProbeSphereVolume",[XS],Object.getOwnPropertyDescriptor(KS.prototype,"lightProbeSphereVolume"),KS.prototype),qS=xo(KS.prototype,"_giScale",[oa],(function(){return 1})),QS=xo(KS.prototype,"_giSamples",[oa],(function(){return 1024})),ZS=xo(KS.prototype,"_bounces",[oa],(function(){return 2})),JS=xo(KS.prototype,"_reduceRinging",[oa],(function(){return 0})),tO=xo(KS.prototype,"_showProbe",[oa],(function(){return!0})),iO=xo(KS.prototype,"_showWireframe",[oa],(function(){return!0})),nO=xo(KS.prototype,"_showConvex",[oa],(function(){return!1})),eO=xo(KS.prototype,"_data",[oa],(function(){return null})),rO=xo(KS.prototype,"_lightProbeSphereVolume",[oa],(function(){return 1})),YS=KS))||YS)),JR=t("SceneGlobals",(sO=Ko("cc.SceneGlobals"),hO=Ca(RO),sO((oO=function(){function t(){this.ambient=aO&&aO(),this.shadows=cO&&cO(),this._skybox=fO&&fO(),this.fog=vO&&vO(),this.octree=lO&&lO(),this.skin=dO&&dO(),this.lightProbeInfo=gO&&gO(),this.postSettings=wO&&wO(),this.bakedWithStationaryMainLight=_O&&_O(),this.bakedWithHighpLightmap=mO&&mO(),this.disableLightmap=!1}return t.prototype.activate=function(t){var i=T.director.root.pipeline.pipelineSceneData;this.skybox.activate(i.skybox),this.ambient.activate(i.ambient),this.shadows.activate(i.shadows),this.fog.activate(i.fog),this.octree.activate(i.octree),this.skin.activate(i.skin),this.postSettings.activate(i.postSettings),this.lightProbeInfo&&i.lightProbes&&this.lightProbeInfo.activate(t,i.lightProbes),T.director.root.onGlobalPipelineStateChanged()},e(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),aO=xo(oO.prototype,"ambient",[oa],(function(){return new OO})),cO=xo(oO.prototype,"shadows",[oa],(function(){return new MO})),fO=xo(oO.prototype,"_skybox",[oa],(function(){return new RO})),vO=xo(oO.prototype,"fog",[oa],(function(){return new IO})),m(oO.prototype,"skybox",[hO],Object.getOwnPropertyDescriptor(oO.prototype,"skybox"),oO.prototype),lO=xo(oO.prototype,"octree",[oa],(function(){return new FO})),dO=xo(oO.prototype,"skin",[oa],(function(){return new PO})),gO=xo(oO.prototype,"lightProbeInfo",[oa],(function(){return new ZR})),wO=xo(oO.prototype,"postSettings",[oa],(function(){return new BO})),_O=xo(oO.prototype,"bakedWithStationaryMainLight",[oa],(function(){return!1})),mO=xo(oO.prototype,"bakedWithHighpLightmap",[oa],(function(){return!1})),uO=oO))||uO));T.SceneGlobals=JR;var tI=(DO=Ko("cc.TargetInfo"),UO=Ca([ln]),DO((GO=function(){this.localID=jO&&jO()},jO=xo(GO.prototype,"localID",[oa,UO],(function(){return[]})),xO=GO))||xO),iI=(HO=Ko("cc.TargetOverrideInfo"),VO=Ca(du),$O=Ca(tI),WO=Ca([ln]),zO=Ca(Xp),XO=Ca(tI),HO((KO=function(){this.source=qO&&qO(),this.sourceInfo=QO&&QO(),this.propertyPath=ZO&&ZO(),this.target=JO&&JO(),this.targetInfo=tR&&tR()},qO=xo(KO.prototype,"source",[oa,VO],(function(){return null})),QO=xo(KO.prototype,"sourceInfo",[oa,$O],(function(){return null})),ZO=xo(KO.prototype,"propertyPath",[oa,WO],(function(){return[]})),JO=xo(KO.prototype,"target",[oa,zO],(function(){return null})),tR=xo(KO.prototype,"targetInfo",[oa,XO],(function(){return null})),YO=KO))||YO),nI=Ko("cc.CompPrefabInfo")((nR=function(){this.fileId=eR&&eR()},eR=xo(nR.prototype,"fileId",[oa],(function(){return""})),iR=nR))||iR,eI=(rR=Ko("CCPropertyOverrideInfo"),sR=Ca(tI),hR=Ca([ln]),rR((oR=function(){function t(){this.targetInfo=aR&&aR(),this.propertyPath=cR&&cR(),this.value=fR&&fR()}return t.prototype.isTarget=function(){},t}(),aR=xo(oR.prototype,"targetInfo",[oa,sR],(function(){return null})),cR=xo(oR.prototype,"propertyPath",[oa,hR],(function(){return[]})),fR=xo(oR.prototype,"value",[oa],null),uR=oR))||uR),rI=(vR=Ko("cc.MountedChildrenInfo"),lR=Ca(tI),dR=Ca([Xp]),vR((wR=function(){function t(){this.targetInfo=_R&&_R(),this.nodes=mR&&mR()}return t.prototype.isTarget=function(){},t}(),_R=xo(wR.prototype,"targetInfo",[oa,lR],(function(){return null})),mR=xo(wR.prototype,"nodes",[oa,dR],(function(){return[]})),gR=wR))||gR),sI=(pR=Ko("cc.MountedComponentsInfo"),yR=Ca(tI),bR=Ca([w_]),pR((ER=function(){function t(){this.targetInfo=kR&&kR(),this.components=TR&&TR()}return t.prototype.isTarget=function(){},t}(),kR=xo(ER.prototype,"targetInfo",[oa,yR],(function(){return null})),TR=xo(ER.prototype,"components",[oa,bR],(function(){return[]})),AR=ER))||AR),hI=(SR=Ko("cc.PrefabInstance"),OR=Ca(Xp),RR=Ca([rI]),IR=Ca([sI]),MR=Ca([eI]),NR=Ca([tI]),SR((LR=function(){function t(){this.fileId=FR&&FR(),this.prefabRootNode=PR&&PR(),this.mountedChildren=BR&&BR(),this.mountedComponents=DR&&DR(),this.propertyOverrides=UR&&UR(),this.removedComponents=xR&&xR(),this.targetMap={},this.expanded=!1}var i=t.prototype;return i.findPropertyOverride=function(){},i.removePropertyOverride=function(){},t}(),FR=xo(LR.prototype,"fileId",[oa],(function(){return""})),PR=xo(LR.prototype,"prefabRootNode",[oa,OR],null),BR=xo(LR.prototype,"mountedChildren",[oa,RR],(function(){return[]})),DR=xo(LR.prototype,"mountedComponents",[oa,IR],(function(){return[]})),UR=xo(LR.prototype,"propertyOverrides",[oa,MR],(function(){return[]})),xR=xo(LR.prototype,"removedComponents",[oa,NR],(function(){return[]})),CR=LR))||CR),uI=(GR=Ko("cc.PrefabInfo"),jR=Ca(Xp),HR=Ca(hI),VR=Ca([iI]),GR((WR=function(){this.root=zR&&zR(),this.asset=XR&&XR(),this.fileId=YR&&YR(),this.instance=KR&&KR(),this.targetOverrides=qR&&qR(),this.nestedPrefabInstanceRoots=QR&&QR()},zR=xo(WR.prototype,"root",[oa,jR],null),XR=xo(WR.prototype,"asset",[oa],null),YR=xo(WR.prototype,"fileId",[oa],(function(){return""})),KR=xo(WR.prototype,"instance",[oa,HR],null),qR=xo(WR.prototype,"targetOverrides",[oa,VR],null),QR=xo(WR.prototype,"nestedPrefabInstanceRoots",[oa],null),$R=WR))||$R);function oI(t){var i=null==t?void 0:t.prefab;if(i&&i.instance){if(!i.asset)return ut(3701,t.name),void(i.instance=void 0);var n=t._objFlags,e=t.getParent(),r=t.uuid;t[cu],k.game._isCloning=!0,i.asset._doInstantiate(t),k.game._isCloning=!1,t._objFlags=n,t.fh(e),t.id=r,t.prefab&&(t.prefab.instance=i.instance)}}function aI(t,i,n){var e;if(i&&t){var r=i,s=null==(e=t.prefab)?void 0:e.instance;!n&&s&&(i[s.fileId]={},r=i[s.fileId]);var h=t.prefab;h&&(r[h.fileId]=t),t.components.forEach((function(t){t.__prefab&&(r[t.__prefab.fileId]=t)})),t.children.forEach((function(t){aI(t,r,!1)}))}}function cI(t,i){if(!t)return null;for(var n=i,e=0;e<t.length;e++){if(!n)return null;n=n[t[e]]}return n}function fI(t,i,n){if(i)for(var e=0;e<i.length;e++){var r=i[e];if(r&&r.targetInfo){var s=cI(r.targetInfo.localID,n);if(!s)continue;var h=n,u=r.targetInfo.localID;if(u.length>0)for(var o=0;o<u.length-1;o++)h=h[u[o]];if(r.nodes)for(var a=0;a<r.nodes.length;a++){var c=r.nodes[a];c&&!s.children.includes(c)&&(s.children.push(c),c.fh(s),aI(c,h,!1),c.siblingIndex=s.children.length-1,wI(c,!0))}}}}function vI(t,i,n){if(i)for(var e=0;e<i.length;e++){var r=i[e];if(r&&r.targetInfo){var s=cI(r.targetInfo.localID,n);if(!s)continue;if(r.components)for(var h=0;h<r.components.length;h++){var u=r.components[h];u&&(u.node=s,s.ah().push(u))}}}}function lI(t,i,n){if(i)for(var e=0;e<i.length;e++){var r=i[e];if(r){var s=cI(r.localID,n);if(!s||!s.node)continue;var h=s.node.components.indexOf(s);h>=0&&s.node.ah().splice(h,1)}}}function dI(t,i,n){if(!(i.length<=0))for(var e=null,r=0;r<i.length;r++){var s=i[r];if(s&&s.targetInfo){if(!(e=cI(s.targetInfo.localID,n)))continue;var h=e,u=s.propertyPath.slice();if(u.length>0){var o=u.pop();if(!o)continue;for(var a=0;a<u.length&&(h=h[u[a]]);a++);if(!h)continue;if(Array.isArray(h))if("length"===o)h[o]=s.value;else{var c=Number.parseInt(o);Number.isInteger(c)&&c<h.length&&(h[o]=s.value)}else h[o]instanceof Pi?h[o].set(s.value):h[o]=s.value}}}}function gI(t){var i,n=null==(i=t.prefab)?void 0:i.targetOverrides;if(n)for(var e=0;e<n.length;e++){var r,s=n[e],h=s.source,u=s.sourceInfo;if(u){var o,a=s.source,c=null==a||null==(o=a.prefab)?void 0:o.instance;c&&c.targetMap&&(h=cI(u.localID,c.targetMap))}if(h){var f,v=s.targetInfo;if(v){var l=s.target,d=null==l||null==(r=l.prefab)?void 0:r.instance;if(d&&d.targetMap&&(f=cI(v.localID,d.targetMap))){var g=s.propertyPath.slice(),w=h;if(g.length>0){var _=g.pop();if(!_)return;for(var m=0;m<g.length&&(w=w[g[m]]);m++);if(!w)continue;w[_]=f}}}}}}function wI(t,i){var n;void 0===i&&(i=!1);var e=null==t||null==(n=t.prefab)?void 0:n.instance;if(e&&!e.expanded){oI(t),i&&t&&t.children&&t.children.forEach((function(t){wI(t,!0)}));var r={};e.targetMap=r,aI(t,r,!0),fI(0,e.mountedChildren,r),lI(0,e.removedComponents,r),vI(0,e.mountedComponents,r),dI(0,e.propertyOverrides,r),e.expanded=!0}else i&&t&&t.children&&t.children.forEach((function(t){wI(t,!0)}))}function _I(t){var i=t.prefab;i&&i.nestedPrefabInstanceRoots&&i.nestedPrefabInstanceRoots.forEach((function(t){wI(t)}))}k._PrefabInfo=uI;var mI,pI,yI,bI,AI,EI,kI,TI=Object.freeze({__proto__:null,CompPrefabInfo:nI,MountedChildrenInfo:rI,MountedComponentsInfo:sI,PrefabInfo:uI,PrefabInstance:hI,PropertyOverrideInfo:eI,TargetInfo:tI,TargetOverrideInfo:iI,applyMountedChildren:fI,applyMountedComponents:vI,applyNodeAndComponentId:function t(i,n){for(var e=i.components,r=i.children,s=0;s<e.length;s++){var h,u,o=e[s],a=null!==(h=null==(u=o.__prefab)?void 0:u.fileId)&&void 0!==h?h:"";o._id=""+n+a}for(var c=0;c<r.length;c++){var f=r[c],v=f.prefab,l=null!=v&&v.instance?v.instance.fileId:null==v?void 0:v.fileId;l&&(f.id=""+n+l,null!=v&&v.instance||t(f,n))}},applyPropertyOverrides:dI,applyRemovedComponents:lI,applyTargetOverrides:gI,createNodeWithPrefab:oI,expandNestedPrefabInstanceNode:_I,expandPrefabInstanceNode:wI,generateTargetMap:aI,getTarget:cI}),SI=t("Scene",Ko("cc.Scene")((pI=function(t){s(n,t);var i=n.prototype;function n(i){var n;return(n=t.call(this,i)||this).autoReleaseAssets=yI&&yI(),n._globals=bI&&bI(),n.dependAssets=null,n._renderScene=null,n._prefabSyncedInLiveReload=!1,n._activeInHierarchy=!1,T.director&&T.director.root&&(n._renderScene=T.director.root.createScene({})),n._inited=!T.game||!T.game._isCloning,n}return i._updateScene=function(){this._scene=this},i.destroy=function(){var t=du.prototype.destroy.call(this);if(t)for(var i=this._children,n=0;n<i.length;++n)i[n].active=!1;return this._renderScene&&T.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},i.addComponent=function(){throw new Error(ft(3822))},i._onHierarchyChanged=function(){},i._onPostActivated=function(){},i._onBatchCreated=function(t){for(var i=this._children.length,n=0;n<i;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},i.updateWorldTransform=function(){},i._instantiate=function(){return null},i.xu=function(){this._inited||(_I(this),gI(this),this._onBatchCreated(y),this._inited=!0),this.walk(Xp.sh)},i.Gu=function(t){void 0===t&&(t=!0),T.director._nodeActivator.activateNode(this,t),this._globals.activate(this)},e(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),n}(Xp),yI=xo(pI.prototype,"autoReleaseAssets",[oa],(function(){return!1})),bI=xo(pI.prototype,"_globals",[oa],(function(){return new JR})),mI=pI))||mI);T.Scene=SI;var OI=t("SceneAsset",Ko("cc.SceneAsset")((EI=function(t){function i(i){var n;return(n=t.call(this,i)||this).scene=kI&&kI(),n}s(i,t);var n=i.prototype;return n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.scene=new SI("New Scene")},n.validate=function(){return!!this.scene},i}(kw),kI=xo(EI.prototype,"scene",[oa],(function(){return null})),AI=EI))||AI);k.SceneAsset=OI,St({SystemEventType:{newName:"Input.EventType",since:"3.3.0",removed:!1}}),St({SystemEvent:{newName:"Input",since:"3.4.0",removed:!1},systemEvent:{newName:"input",since:"3.4.0",removed:!1}});var RI=function(){function t(){this.ju=200,this.Hu=0,this.du=new Ou,this.Vu=window.DeviceMotionEvent||window.DeviceOrientationEvent,Bu.browserType===Ru.MOBILE_QQ&&(this.Vu=window.DeviceOrientationEvent),this.$u=this.Vu===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this.Wu=this.zu.bind(this)}var i=t.prototype;return i.ht=function(){this.Hu=performance.now(),window.addEventListener(this.$u,this.Wu,!1)},i.Xu=function(){this.Hu=0,window.removeEventListener(this.$u,this.Wu,!1)},i.zu=function(t){var i=performance.now();if(!(i-this.Hu<this.ju)){this.Hu=i;var n=0,e=0,r=0;if(this.Vu===window.DeviceMotionEvent){var s=t.accelerationIncludingGravity;n=.1*((null==s?void 0:s.x)||0),e=.1*((null==s?void 0:s.y)||0),r=.1*((null==s?void 0:s.z)||0)}else{var h=t;n=(h.gamma||0)/90*.981,e=-(h.beta||0)/90*.981,r=(h.alpha||0)/90*.981}if(eo.isFrameRotated){var u=n;n=-e,e=u}var o=n;90===window.orientation?(n=-e,e=o):-90===window.orientation?(n=e,e=-o):180===window.orientation&&(n=-n,e=-e),Bu.os===Nu.ANDROID&&Bu.browserType!==Ru.MOBILE_QQ&&(n=-n,e=-e);var a=performance.now(),c=new qm(n,e,r,a),f=new Hm(c);this.du.emit("devicemotion",f)}},i.start=function(){var t=this;window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(i){"granted"===i&&t.ht()})).catch((function(t){X(t)})):this.ht()},i.stop=function(){this.Xu()},i.setInterval=function(t){this.ju=t},i.on=function(t,i,n){this.du.on(t,i,n)},t}(),II=function(){},MI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(II),NI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(II),CI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(II),LI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(II),FI=function(t){function i(i){var n;return(n=t.call(this)||this).positive=i.positive,n.negative=i.negative,n}return s(i,t),i.prototype.getValue=function(){var t=this.positive.getValue(),i=this.negative.getValue();return Math.abs(t)>Math.abs(i)?t:-i},i}(MI),PI=function(t){function i(i){var n;return(n=t.call(this)||this).up=i.up,n.down=i.down,n.left=i.left,n.right=i.right,n.xAxis=new FI({positive:n.right,negative:n.left}),n.yAxis=new FI({positive:n.up,negative:n.down}),n}return s(i,t),i.prototype.getValue=function(){return new ls(this.xAxis.getValue(),this.yAxis.getValue())},i}(NI);!function(t){function i(i){var n;return(n=t.call(this)||this).up=i.up,n.down=i.down,n.left=i.left,n.right=i.right,n.forward=i.forward,n.backward=i.backward,n.xAxis=new FI({positive:n.right,negative:n.left}),n.yAxis=new FI({positive:n.up,negative:n.down}),n.zAxis=new FI({positive:n.forward,negative:n.backward}),n}s(i,t),i.prototype.getValue=function(){return new ir(this.xAxis.getValue(),this.yAxis.getValue(),this.zAxis.getValue())}}(CI);var BI,DI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(MI),UI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(PI),xI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(PI),GI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(LI),jI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(CI),HI=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(MI),VI="left",$I="right",WI=[];!function(t){t[t.HAND_LEFT=1]="HAND_LEFT",t[t.HAND_RIGHT=4]="HAND_RIGHT",t[t.AIM_LEFT=2]="AIM_LEFT",t[t.AIM_RIGHT=5]="AIM_RIGHT"}(BI||(BI={}));var zI,XI,YI,KI,qI,QI=function(){function t(t){var i;this.Yu=-1,this.Ku=!1,this.qu=((i={})[BI.HAND_LEFT]={position:ir.ZERO,orientation:Cr.IDENTITY},i[BI.HAND_RIGHT]={position:ir.ZERO,orientation:Cr.IDENTITY},i[BI.AIM_LEFT]={position:ir.ZERO,orientation:Cr.IDENTITY},i[BI.AIM_RIGHT]={position:ir.ZERO,orientation:Cr.IDENTITY},i),this.Yu=t,this.Qu()}t._init=function(){Bu.hasFeature(Lu.EVENT_GAMEPAD)&&t.ht()},t._on=function(i,n,e){t.du.on(i,n,e)},t.Zu=function(i){var n=t.all.findIndex((function(t){return t.deviceId===i}));-1!==n&&pi(t.all,n)},t.Ju=function(i,n){var e=t.all.find((function(t){return t.deviceId===i}));return e||(e=new t(i),t.all.push(e)),e.Ku=n,e},t.io=function(i){t.no=setInterval((function(){T.director&&T.Director&&(clearInterval(t.no),t.no=-1,i())}),50)},t.eo=function(){for(var i=0,n=0,e=t.ro.length;n<e;n++)t.ro[n]&&i++;t.so=i},t.ht=function(){t.io((function(){t.ro=t.ho(),t.eo(),T.director.on(T.Director.EVENT_BEGIN_FRAME,t.uo)})),window.addEventListener("gamepadconnected",(function(i){t.ro[i.gamepad.index]=i.gamepad,t.eo();var n=t.Ju(i.gamepad.index,!0);t.du.emit("gamepad-change",new Xm("gamepad-change",n))})),window.addEventListener("gamepaddisconnected",(function(i){t.ro[i.gamepad.index]=null,t.eo();var n=t.Ju(i.gamepad.index,!1);t.Zu(i.gamepad.index),t.du.emit("gamepad-change",new Xm("gamepad-change",n))}))},t.oo=function(i){if(0!==t.so){var n=t.ho();if(n){for(var e=0;e<n.length;++e){var r=n[e];if(r){var s=t.ro[r.index];if(s){for(var h=void 0,u=s.buttons,o=0;o<u.length;++o){var a=u[o],c=r.buttons[o];if(Math.abs(a.value-c.value)>.01){h=t.Ju(r.index,!0);break}}if(h){i.push(h);continue}for(var f=s.axes,v=0;v<f.length;++v){var l=f[v],d=r.axes[v];if(Math.abs(l-d)>.01){h=t.Ju(r.index,!0);break}}if(h){i.push(h);continue}}}}t.ro=n}}},t.uo=function(){WI.length=0,t.oo(WI),t.ao(WI);for(var i=0;i<WI.length;++i){var n=WI[i];t.du.emit("gamepad-input",new Xm("gamepad-input",n))}t.co()},t.ao=function(){},t.fo=function(t,i){if(!t&&!i)return!1;if(!t||!i)return!0;for(var n=i.buttons,e=0;e<n.length;++e){var r=n[e];if(0!==t.buttons[e].value||0!==r)return!0}for(var s=i.axes,h=0;h<s.length;++h){var u=s[h];if(0!==t.axes[h]||0!==u)return!0}return!1},t.vo=function(t){if(t){for(var i={buttons:new Array(t.buttons.length),axes:new Array(t.axes.length)},n=0;n<t.buttons.length;++n)i.buttons[n]=t.buttons[n].value;for(var e=0;e<t.axes.length;++e)i.axes[e]=t.axes[e];return i}},t.co=function(){},t.lo=function(){var t;return null==(t=globalThis.__globalXR)?void 0:t.webxrGamepadMap},t.ho=function(){return"function"==typeof navigator.getGamepads?navigator.getGamepads():"function"==typeof navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},t.do=function(i){for(var n=t.ho(),e=0;e<n.length;++e){var r=n[e];if(r&&r.index===i)return r}};var i=t.prototype;return i.wo=function(t){var i=Math.abs(t);return t>0?{negative:0,positive:i}:t<0?{negative:i,positive:0}:{negative:0,positive:0}},i._o=function(t){t.code!==BI.HAND_LEFT&&t.code!==BI.AIM_LEFT&&t.code!==BI.HAND_RIGHT&&t.code!==BI.AIM_RIGHT||(this.qu[t.code]={position:new ir(t.position.x,t.position.y,t.position.z),orientation:new Cr(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)})},i.Qu=function(){var i=this;this.mo=new DI,this.mo.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get(VI);return e&&e.buttons.length>5?e.buttons[5].value:0}var r=t.do(i.deviceId);return r?r.buttons[3].value:0},this.po=new DI,this.po.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get($I);return e&&e.buttons.length>5?e.buttons[5].value:0}var r=t.do(i.deviceId);return r?r.buttons[1].value:0},this.yo=new DI,this.yo.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get(VI);return e&&e.buttons.length>4?e.buttons[4].value:0}var r=t.do(i.deviceId);return r?r.buttons[2].value:0},this.bo=new DI,this.bo.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get($I);return e&&e.buttons.length>4?e.buttons[4].value:0}var r=t.do(i.deviceId);return r?r.buttons[0].value:0},this.Ao=new DI,this.Ao.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[4].value:0},this.Eo=new DI,this.Eo.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get(VI);return e&&e.buttons.length>0?e.buttons[0].value:0}var r=t.do(i.deviceId);return r?r.buttons[6].value:0},this.ko=new DI,this.ko.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get(VI);if(e){if(e.buttons.length>3&&0!==e.buttons[3].value)return e.buttons[3].value;if(e.buttons.length>2&&0!==e.buttons[2].value)return e.buttons[2].value}return 0}var r=t.do(i.deviceId);return r?r.buttons[10].value:0},this.To=new DI,this.To.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[5].value:0},this.So=new DI,this.So.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get($I);return e&&e.buttons.length>0?e.buttons[0].value:0}var r=t.do(i.deviceId);return r?r.buttons[7].value:0},this.Oo=new DI,this.Oo.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get($I);if(e){if(e.buttons.length>3&&0!==e.buttons[3].value)return e.buttons[3].value;if(e.buttons.length>2&&0!==e.buttons[2].value)return e.buttons[2].value}return 0}var r=t.do(i.deviceId);return r?r.buttons[11].value:0},this.Ro=new DI,this.Ro.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[8].value:0},this.Io=new DI,this.Io.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[9].value:0};var n=new DI;n.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[12].value:0};var e=new DI;e.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[13].value:0};var r=new DI;r.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[14].value:0};var s=new DI;s.getValue=function(){var n=t.do(i.deviceId);return n?n.buttons[15].value:0},this.Mo=new UI({up:n,down:e,left:r,right:s});var h=new DI;h.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[1]).negative:0};var u=new DI;u.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[1]).positive:0};var o=new DI;o.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[0]).negative:0};var a=new DI;a.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[0]).positive:0},this.No=new xI({up:h,down:u,left:o,right:a});var c=new DI;c.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[3]).negative:0};var f=new DI;f.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[3]).positive:0};var v=new DI;v.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[2]).negative:0};var l=new DI;l.getValue=function(){if(-1===i.deviceId)return 0;var n=t.do(i.deviceId);return n?i.wo(n.axes[2]).positive:0},this.Co=new xI({up:c,down:f,left:v,right:l}),this.Lo=new DI,this.Lo.getValue=function(){return 0},this.Fo=new DI,this.Fo.getValue=function(){return i.deviceId,0},this.Po=new DI,this.Po.getValue=function(){if(-1===i.deviceId){var n,e=null==(n=t.lo())?void 0:n.get($I);if(e&&e.buttons.length>1)return e.buttons[1].value}return 0},this.Bo=new jI,this.Bo.getValue=function(){return i.qu[BI.HAND_LEFT].position},this.Do=new GI,this.Do.getValue=function(){return i.qu[BI.HAND_LEFT].orientation},this.Uo=new jI,this.Uo.getValue=function(){return i.qu[BI.HAND_RIGHT].position},this.xo=new GI,this.xo.getValue=function(){return i.qu[BI.HAND_RIGHT].orientation},this.Go=new jI,this.Go.getValue=function(){return i.qu[BI.AIM_LEFT].position},this.jo=new GI,this.jo.getValue=function(){return i.qu[BI.AIM_LEFT].orientation},this.Ho=new jI,this.Ho.getValue=function(){return i.qu[BI.AIM_RIGHT].position},this.Vo=new GI,this.Vo.getValue=function(){return i.qu[BI.AIM_RIGHT].orientation}},e(t,[{key:"buttonNorth",get:function(){return this.mo}},{key:"buttonEast",get:function(){return this.po}},{key:"buttonWest",get:function(){return this.yo}},{key:"buttonSouth",get:function(){return this.bo}},{key:"buttonL1",get:function(){return this.Ao}},{key:"buttonL2",get:function(){return this.Eo}},{key:"buttonL3",get:function(){return this.ko}},{key:"buttonR1",get:function(){return this.To}},{key:"buttonR2",get:function(){return this.So}},{key:"buttonR3",get:function(){return this.Oo}},{key:"buttonShare",get:function(){return this.Ro}},{key:"buttonOptions",get:function(){return this.Io}},{key:"dpad",get:function(){return this.Mo}},{key:"leftStick",get:function(){return this.No}},{key:"rightStick",get:function(){return this.Co}},{key:"buttonStart",get:function(){return this.Lo}},{key:"gripLeft",get:function(){return this.Fo}},{key:"gripRight",get:function(){return this.Po}},{key:"handLeftPosition",get:function(){return this.Bo}},{key:"handLeftOrientation",get:function(){return this.Do}},{key:"handRightPosition",get:function(){return this.Uo}},{key:"handRightOrientation",get:function(){return this.xo}},{key:"aimLeftPosition",get:function(){return this.Go}},{key:"aimLeftOrientation",get:function(){return this.jo}},{key:"aimRightPosition",get:function(){return this.Ho}},{key:"aimRightOrientation",get:function(){return this.Vo}},{key:"deviceId",get:function(){return this.Yu}},{key:"connected",get:function(){return this.Ku}}]),t}();QI.all=[],QI.xr=null,QI.du=new Ou,QI.ro=[],QI.$o=null,QI.no=-1,QI.so=0,function(t){t[t.BUTTON_EAST=0]="BUTTON_EAST",t[t.BUTTON_SOUTH=1]="BUTTON_SOUTH",t[t.BUTTON_WEST=2]="BUTTON_WEST",t[t.BUTTON_NORTH=3]="BUTTON_NORTH",t[t.BUTTON_TRIGGER_LEFT=4]="BUTTON_TRIGGER_LEFT",t[t.BUTTON_TRIGGER_RIGHT=5]="BUTTON_TRIGGER_RIGHT",t[t.TRIGGER_LEFT=6]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=7]="TRIGGER_RIGHT",t[t.GRIP_LEFT=8]="GRIP_LEFT",t[t.GRIP_RIGHT=9]="GRIP_RIGHT",t[t.BUTTON_LEFT_STICK=10]="BUTTON_LEFT_STICK",t[t.LEFT_STICK_UP=11]="LEFT_STICK_UP",t[t.LEFT_STICK_DOWN=12]="LEFT_STICK_DOWN",t[t.LEFT_STICK_LEFT=13]="LEFT_STICK_LEFT",t[t.LEFT_STICK_RIGHT=14]="LEFT_STICK_RIGHT",t[t.BUTTON_RIGHT_STICK=15]="BUTTON_RIGHT_STICK",t[t.RIGHT_STICK_UP=16]="RIGHT_STICK_UP",t[t.RIGHT_STICK_DOWN=17]="RIGHT_STICK_DOWN",t[t.RIGHT_STICK_LEFT=18]="RIGHT_STICK_LEFT",t[t.RIGHT_STICK_RIGHT=19]="RIGHT_STICK_RIGHT",t[t.ROKID_MENU=20]="ROKID_MENU",t[t.ROKID_START=21]="ROKID_START"}(zI||(zI={})),function(t){t[t.KET_CLICK=0]="KET_CLICK",t[t.KET_STICK=1]="KET_STICK",t[t.KET_GRAB=2]="KET_GRAB",t[t.KET_TOUCH=3]="KET_TOUCH"}(XI||(XI={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.L1=5]="L1",t[t.R1=6]="R1",t[t.MINUS=7]="MINUS",t[t.PLUS=8]="PLUS",t[t.L3=9]="L3",t[t.R3=10]="R3",t[t.MENU=11]="MENU",t[t.START=12]="START",t[t.TRIGGER_LEFT=13]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=14]="TRIGGER_RIGHT"}(YI||(YI={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.X=1]="X",t[t.Y=2]="Y",t[t.LEFT_STICK_X=3]="LEFT_STICK_X",t[t.LEFT_STICK_Y=4]="LEFT_STICK_Y",t[t.RIGHT_STICK_X=5]="RIGHT_STICK_X",t[t.RIGHT_STICK_Y=6]="RIGHT_STICK_Y",t[t.L2=7]="L2",t[t.R2=8]="R2",t[t.LEFT_GRIP=9]="LEFT_GRIP",t[t.RIGHT_GRIP=10]="RIGHT_GRIP"}(KI||(KI={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.LEFT_TRIGGER=5]="LEFT_TRIGGER",t[t.RIGHT_TRIGGER=6]="RIGHT_TRIGGER",t[t.LEFT_THUMBSTICK=7]="LEFT_THUMBSTICK",t[t.RIGHT_THUMBSTICK=8]="RIGHT_THUMBSTICK"}(qI||(qI={}));var ZI,JI={1:zI.BUTTON_EAST,2:zI.BUTTON_SOUTH,3:zI.BUTTON_NORTH,4:zI.BUTTON_WEST,9:zI.BUTTON_LEFT_STICK,10:zI.BUTTON_RIGHT_STICK,11:zI.ROKID_MENU,12:zI.ROKID_START,13:zI.BUTTON_TRIGGER_LEFT,14:zI.BUTTON_TRIGGER_RIGHT},tM=function(){function t(){var t,i,n=this;this.du=new Ou,this.Wo=((t={})[zI.BUTTON_SOUTH]=0,t[zI.BUTTON_EAST]=0,t[zI.BUTTON_WEST]=0,t[zI.BUTTON_NORTH]=0,t[zI.BUTTON_TRIGGER_LEFT]=0,t[zI.BUTTON_TRIGGER_RIGHT]=0,t[zI.TRIGGER_LEFT]=0,t[zI.TRIGGER_RIGHT]=0,t[zI.GRIP_LEFT]=0,t[zI.GRIP_RIGHT]=0,t[zI.LEFT_STICK_UP]=0,t[zI.LEFT_STICK_DOWN]=0,t[zI.LEFT_STICK_LEFT]=0,t[zI.LEFT_STICK_RIGHT]=0,t[zI.RIGHT_STICK_UP]=0,t[zI.RIGHT_STICK_DOWN]=0,t[zI.RIGHT_STICK_LEFT]=0,t[zI.RIGHT_STICK_RIGHT]=0,t[zI.BUTTON_LEFT_STICK]=0,t[zI.BUTTON_RIGHT_STICK]=0,t[zI.ROKID_MENU]=0,t[zI.ROKID_START]=0,t),this.zo=((i={})[qI.UNDEFINE]=0,i[qI.A]=0,i[qI.B]=0,i[qI.X]=0,i[qI.Y]=0,i[qI.LEFT_TRIGGER]=0,i[qI.RIGHT_TRIGGER]=0,i[qI.LEFT_THUMBSTICK]=0,i[qI.RIGHT_THUMBSTICK]=0,i),this.Qu(),window.addEventListener("xr-remote-input",(function(t){var i=t,e=i.detail.keyEventType,r=i.detail.stickAxisCode,s=i.detail.stickAxisValue,h=i.detail.stickKeyCode,u=i.detail.isButtonPressed,o=i.detail.touchCode,a=i.detail.touchValue;if(e===XI.KET_CLICK){var c=JI[h];n.Wo[c]=u?1:0}else if(e===XI.KET_STICK||e===XI.KET_GRAB){var f,v,l;switch(r){case KI.LEFT_STICK_X:f=zI.LEFT_STICK_LEFT,v=zI.LEFT_STICK_RIGHT,l=n.wo(s);break;case KI.LEFT_STICK_Y:f=zI.LEFT_STICK_DOWN,v=zI.LEFT_STICK_UP,l=n.wo(s);break;case KI.RIGHT_STICK_X:f=zI.RIGHT_STICK_LEFT,v=zI.RIGHT_STICK_RIGHT,l=n.wo(s);break;case KI.RIGHT_STICK_Y:f=zI.RIGHT_STICK_DOWN,v=zI.RIGHT_STICK_UP,l=n.wo(s);break;case KI.L2:n.Wo[zI.TRIGGER_LEFT]=s;break;case KI.R2:n.Wo[zI.TRIGGER_RIGHT]=s;break;case KI.LEFT_GRIP:n.Wo[zI.GRIP_LEFT]=s;break;case KI.RIGHT_GRIP:n.Wo[zI.GRIP_RIGHT]=s}f&&v&&l&&(n.Wo[f]=l.negative,n.Wo[v]=l.positive)}else if(e===XI.KET_TOUCH)switch(o){case qI.A:case qI.B:case qI.X:case qI.Y:case qI.LEFT_TRIGGER:case qI.RIGHT_TRIGGER:case qI.LEFT_THUMBSTICK:case qI.RIGHT_THUMBSTICK:n.zo[o]=a}n.du.emit("handle-input",new Ym("handle-input",n))}))}var i=t.prototype;return i.wo=function(t){var i=Math.abs(t);return t>0?{negative:0,positive:i}:t<0?{negative:i,positive:0}:{negative:0,positive:0}},i._on=function(t,i,n){this.du.on(t,i,n)},i.Qu=function(){var t=this;this.mo=new DI,this.mo.getValue=function(){return t.Wo[zI.BUTTON_NORTH]},this.po=new DI,this.po.getValue=function(){return t.Wo[zI.BUTTON_EAST]},this.yo=new DI,this.yo.getValue=function(){return t.Wo[zI.BUTTON_WEST]},this.bo=new DI,this.bo.getValue=function(){return t.Wo[zI.BUTTON_SOUTH]},this.Xo=new DI,this.Xo.getValue=function(){return t.Wo[zI.BUTTON_TRIGGER_LEFT]},this.Yo=new DI,this.Yo.getValue=function(){return t.Wo[zI.BUTTON_TRIGGER_RIGHT]},this.Ko=new DI,this.Ko.getValue=function(){return t.Wo[zI.TRIGGER_LEFT]},this.qo=new DI,this.qo.getValue=function(){return t.Wo[zI.TRIGGER_RIGHT]},this.Fo=new DI,this.Fo.getValue=function(){return t.Wo[zI.GRIP_LEFT]},this.Po=new DI,this.Po.getValue=function(){return t.Wo[zI.GRIP_RIGHT]},this.Qo=new DI,this.Qo.getValue=function(){return t.Wo[zI.BUTTON_LEFT_STICK]};var i=new DI;i.getValue=function(){return t.Wo[zI.LEFT_STICK_UP]};var n=new DI;n.getValue=function(){return t.Wo[zI.LEFT_STICK_DOWN]};var e=new DI;e.getValue=function(){return t.Wo[zI.LEFT_STICK_LEFT]};var r=new DI;r.getValue=function(){return t.Wo[zI.LEFT_STICK_RIGHT]},this.No=new xI({up:i,down:n,left:e,right:r}),this.Zo=new DI,this.Zo.getValue=function(){return t.Wo[zI.BUTTON_RIGHT_STICK]};var s=new DI;s.getValue=function(){return t.Wo[zI.RIGHT_STICK_UP]};var h=new DI;h.getValue=function(){return t.Wo[zI.RIGHT_STICK_DOWN]};var u=new DI;u.getValue=function(){return t.Wo[zI.RIGHT_STICK_LEFT]};var o=new DI;o.getValue=function(){return t.Wo[zI.RIGHT_STICK_RIGHT]},this.Co=new xI({up:s,down:h,left:u,right:o}),this.Io=new DI,this.Io.getValue=function(){return t.Wo[zI.ROKID_MENU]},this.Lo=new DI,this.Lo.getValue=function(){return t.Wo[zI.ROKID_START]},this.Bo=new jI,this.Bo.getValue=function(){return ir.ZERO},this.Do=new GI,this.Do.getValue=function(){return Cr.IDENTITY},this.Uo=new jI,this.Uo.getValue=function(){return ir.ZERO},this.xo=new GI,this.xo.getValue=function(){return Cr.IDENTITY},this.Go=new jI,this.Go.getValue=function(){return ir.ZERO},this.jo=new GI,this.jo.getValue=function(){return Cr.IDENTITY},this.Ho=new jI,this.Ho.getValue=function(){return ir.ZERO},this.Vo=new GI,this.Vo.getValue=function(){return Cr.IDENTITY},this.Jo=new HI,this.Jo.getValue=function(){return t.zo[qI.A]},this.ta=new HI,this.ta.getValue=function(){return t.zo[qI.B]},this.na=new HI,this.na.getValue=function(){return t.zo[qI.X]},this.ea=new HI,this.ea.getValue=function(){return t.zo[qI.Y]},this.ra=new HI,this.ra.getValue=function(){return t.zo[qI.LEFT_TRIGGER]},this.sa=new HI,this.sa.getValue=function(){return t.zo[qI.RIGHT_TRIGGER]},this.ha=new HI,this.ha.getValue=function(){return t.zo[qI.LEFT_THUMBSTICK]},this.ua=new HI,this.ua.getValue=function(){return t.zo[qI.RIGHT_THUMBSTICK]}},e(t,[{key:"buttonNorth",get:function(){return this.mo}},{key:"buttonEast",get:function(){return this.po}},{key:"buttonWest",get:function(){return this.yo}},{key:"buttonSouth",get:function(){return this.bo}},{key:"buttonTriggerLeft",get:function(){return this.Xo}},{key:"buttonTriggerRight",get:function(){return this.Yo}},{key:"triggerLeft",get:function(){return this.Ko}},{key:"triggerRight",get:function(){return this.qo}},{key:"gripLeft",get:function(){return this.Fo}},{key:"gripRight",get:function(){return this.Po}},{key:"leftStick",get:function(){return this.No}},{key:"rightStick",get:function(){return this.Co}},{key:"buttonLeftStick",get:function(){return this.Qo}},{key:"buttonRightStick",get:function(){return this.Zo}},{key:"buttonOptions",get:function(){return this.Io}},{key:"buttonStart",get:function(){return this.Lo}},{key:"handLeftPosition",get:function(){return this.Bo}},{key:"handLeftOrientation",get:function(){return this.Do}},{key:"handRightPosition",get:function(){return this.Uo}},{key:"handRightOrientation",get:function(){return this.xo}},{key:"aimLeftPosition",get:function(){return this.Go}},{key:"aimLeftOrientation",get:function(){return this.jo}},{key:"aimRightPosition",get:function(){return this.Ho}},{key:"aimRightOrientation",get:function(){return this.Vo}},{key:"touchButtonA",get:function(){return this.Jo}},{key:"touchButtonB",get:function(){return this.ta}},{key:"touchButtonX",get:function(){return this.na}},{key:"touchButtonY",get:function(){return this.ea}},{key:"touchButtonTriggerLeft",get:function(){return this.ra}},{key:"touchButtonTriggerRight",get:function(){return this.sa}},{key:"touchButtonThumbStickLeft",get:function(){return this.ha}},{key:"touchButtonThumbStickRight",get:function(){return this.ua}}]),t}();!function(t){t[t.VIEW_LEFT=0]="VIEW_LEFT",t[t.VIEW_RIGHT=3]="VIEW_RIGHT",t[t.HEAD_MIDDLE=6]="HEAD_MIDDLE"}(ZI||(ZI={}));var iM,nM=function(){function t(){var t;this.du=new Ou,this.no=-1,this.qu=((t={})[ZI.VIEW_LEFT]={position:ir.ZERO,orientation:Cr.IDENTITY},t[ZI.VIEW_RIGHT]={position:ir.ZERO,orientation:Cr.IDENTITY},t[ZI.HEAD_MIDDLE]={position:ir.ZERO,orientation:Cr.IDENTITY},t),this.Qu(),this.ht()}var i=t.prototype;return i.io=function(){var t=this;return new Promise((function(i){t.no=setInterval((function(){T.director&&T.Director&&(clearInterval(t.no),t.no=-1,i())}),50)}))},i.ht=function(){var t=this;this.io().then((function(){T.director.on(T.Director.EVENT_BEGIN_FRAME,t.oa,t)})).catch((function(){}))},i.oa=function(){var t,i=null==(t=globalThis.__globalXR)?void 0:t.webxrHmdPoseInfos;if(i){for(var n=0;n<i.length;++n){var e=i[n];this._o(e)}this.du.emit("hmd-pose-input",new Km("hmd-pose-input",this))}},i._on=function(t,i,n){this.du.on(t,i,n)},i._o=function(t){t.code!==ZI.VIEW_LEFT&&t.code!==ZI.VIEW_RIGHT&&t.code!==ZI.HEAD_MIDDLE||(this.qu[t.code]={position:new ir(t.position.x,t.position.y,t.position.z),orientation:new Cr(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)})},i.Qu=function(){var t=this;this.aa=new jI,this.aa.getValue=function(){return t.qu[ZI.VIEW_LEFT].position},this.ca=new GI,this.ca.getValue=function(){return t.qu[ZI.VIEW_LEFT].orientation},this.fa=new jI,this.fa.getValue=function(){return t.qu[ZI.VIEW_RIGHT].position},this.va=new GI,this.va.getValue=function(){return t.qu[ZI.VIEW_RIGHT].orientation},this.la=new jI,this.la.getValue=function(){return t.qu[ZI.HEAD_MIDDLE].position},this.da=new GI,this.da.getValue=function(){return t.qu[ZI.HEAD_MIDDLE].orientation}},e(t,[{key:"viewLeftPosition",get:function(){return this.aa}},{key:"viewLeftOrientation",get:function(){return this.ca}},{key:"viewRightPosition",get:function(){return this.fa}},{key:"viewRightOrientation",get:function(){return this.va}},{key:"headMiddlePosition",get:function(){return this.la}},{key:"headMiddleOrientation",get:function(){return this.da}}]),t}(),eM=function(){function t(){this.du=new Ou,this.Qu()}var i=t.prototype;return i._on=function(t,i,n){this.du.on(t,i,n)},i.Qu=function(){this.ga=new jI,this.ga.getValue=function(){return ir.ZERO},this.wa=new GI,this.wa.getValue=function(){return Cr.IDENTITY}},e(t,[{key:"handheldPosition",get:function(){return this.ga}},{key:"handheldOrientation",get:function(){return this.wa}}]),t}(),rM={Backspace:8,Tab:9,Enter:13,ShiftLeft:16,ControlLeft:17,AltLeft:18,ShiftRight:2e3,ControlRight:2001,AltRight:2002,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,NumpadEnter:2003,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222},sM=function(){function t(){this.du=new Ou,this.ht()}var i=t.prototype;return i.dispatchKeyboardDownEvent=function(t){this._a(t)},i.dispatchKeyboardUpEvent=function(t){this.ma(t)},i.on=function(t,i,n){this.du.on(t,i,n)},i.ht=function(){var t=document.getElementById("GameCanvas");null==t||t.addEventListener("keydown",this._a.bind(this)),null==t||t.addEventListener("keyup",this.ma.bind(this))},i.pa=function(t,i){var n,e=(n=t.code,rM[n]||0);return new Vm(e,i)},i._a=function(t){if(t.stopPropagation(),t.preventDefault(),t.repeat){var i=this.pa(t,"key-pressing");this.du.emit("key-pressing",i)}else{var n=this.pa(t,"keydown");this.du.emit("keydown",n)}},i.ma=function(t){var i=this.pa(t,"keyup");t.stopPropagation(),t.preventDefault(),this.du.emit("keyup",i)},t}(),hM=function(){function t(){this.Ae=void 0,this.du=new Ou,this.ya=!1,this.ws=!1,this.ba=new ls,this.zs=void 0,this.Xs=void 0,this.Ys=void 0,Bu.hasFeature(Lu.EVENT_MOUSE)&&(this.Ae=document.getElementById("GameCanvas"),this.Ae||X("failed to access canvas"),this.zs=this.Aa("mouse-down"),this.Xs=this.Aa("mouse-move"),this.Ys=this.Aa("mouse-up"),this.ht())}var i=t.prototype;return i.dispatchMouseDownEvent=function(t){this.zs(t)},i.dispatchMouseMoveEvent=function(t){this.Xs(t)},i.dispatchMouseUpEvent=function(t){this.Ys(t)},i.dispatchScrollEvent=function(t){this.Ks(t)},i.on=function(t,i,n){this.du.on(t,i,n)},i.Ea=function(){var t=this.Ae,i=null==t?void 0:t.getBoundingClientRect();return i?new ps(i.x,i.y,i.width,i.height):new ps(0,0,0,0)},i.ka=function(t){var i=this.Ea(),n=eo.devicePixelRatio,e=this.ya?this.ba.x/n+t.movementX:t.clientX-i.x,r=this.ya?this.ba.y/n-t.movementY:i.y+i.height-t.clientY;return new ls(e*=n,r*=n)},i.ht=function(){var t,i,n,e,r,s,h=this;window.addEventListener("mousedown",(function(){h.ws=!0})),null==(t=this.Ae)||t.addEventListener("mousedown",this.zs),null==(i=this.Ae)||i.addEventListener("mousemove",this.Xs),window.addEventListener("mouseup",this.Ys),null==(n=this.Ae)||n.addEventListener("mouseup",this.Ys),null==(e=this.Ae)||e.addEventListener("wheel",this.Ks.bind(this)),this.Ta(),null==(r=this.Ae)||r.addEventListener("mouseleave",this.qs.bind(this)),null==(s=this.Ae)||s.addEventListener("mouseenter",this.Qs.bind(this))},i.Ta=function(){var t=this,i=function(){var i=t.Ae;document.pointerLockElement===i||document.mozPointerLockElement===i?t.ya=!0:t.ya=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",i,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",i,!1)},i.Aa=function(t){var i=this;return function(n){var e,r=i.ka(n),s=n.button,h=n.buttons,u=s;switch(t){case"mouse-down":null==(e=i.Ae)||e.focus(),i.ws=!0;break;case"mouse-up":i.ws=!1;break;case"mouse-move":u=1&h?$m.BUTTON_LEFT:2&h?$m.BUTTON_RIGHT:4&h?$m.BUTTON_MIDDLE:$m.BUTTON_MISSING}var o=new $m(t,!1,i.ba);o.setLocation(r.x,r.y),o.setButton(u),o.movementX=n.movementX,o.movementY=n.movementY,i.ba.set(r.x,r.y),n.stopPropagation(),n.target===i.Ae&&n.preventDefault(),i.du.emit(t,o)}},i.Ks=function(t){var i="mouse-wheel",n=this.ka(t),e=t.button,r=new $m(i,!1,this.ba);r.setLocation(n.x,n.y),r.setButton(e),r.movementX=t.movementX,r.movementY=t.movementY,r.setScrollData(5*t.deltaX,5*-t.deltaY),this.ba.set(n.x,n.y),t.stopPropagation(),t.target===this.Ae&&t.preventDefault(),this.du.emit(i,r)},i.qs=function(){var t="mouse-leave-window",i=new $m(t,!1);this.du.emit(t,i)},i.Qs=function(){var t="mouse-enter-window",i=new $m(t,!1);this.du.emit(t,i)},i.dispatchEventsInCache=function(){},t}(),uM=new ls,oM=new(function(){function t(){this.Sa=new Map,this.Oa=8}var i=t.prototype;return i.Ra=function(t,i,n){if(this.Sa.has(t))it(2301);else{if(!this.Ia(t)){var e=new Jm(i,n,t);return this.Sa.set(t,e),this.Ma(e,i,n),e}it(2300)}},i.releaseTouch=function(t){this.Sa.has(t)&&this.Sa.delete(t)},i.getTouch=function(t){return this.Sa.get(t)},i.getOrCreateTouch=function(t,i,n){var e=this.getTouch(t);return e?this.Ma(e,i,n):e=this.Ra(t,i,n),e},i.getAllTouches=function(){var t=[];return this.Sa.forEach((function(i){i&&t.push(i)})),t},i.getTouchCount=function(){return this.Sa.size},i.Ma=function(t,i,n){t.getLocation(uM),t.setPrevPoint(uM),t.setPoint(i,n)},i.Ia=function(t){var i=this;if(this.Sa.has(t))return!1;var n=Gi.ENABLE_MULTI_TOUCH?this.Oa:1;if(this.Sa.size<n)return!1;var e=performance.now();return this.Sa.forEach((function(t){e-t.lastModified>Gi.TOUCH_TIMEOUT&&(it(2302,t.getID()),i.releaseTouch(t.getID()))})),n>=this.Sa.size},t}()),aM=function(){function t(){this.Ae=void 0,this.du=new Ou,Bu.hasFeature(Lu.INPUT_TOUCH)&&(this.Ae=document.getElementById("GameCanvas"),this.Ae||X("failed to access canvas"),this.ht())}var i=t.prototype;return i.ht=function(){var t,i,n,e;null==(t=this.Ae)||t.addEventListener("touchstart",this.Aa("touch-start")),null==(i=this.Ae)||i.addEventListener("touchmove",this.Aa("touch-move")),null==(n=this.Ae)||n.addEventListener("touchend",this.Aa("touch-end")),null==(e=this.Ae)||e.addEventListener("touchcancel",this.Aa("touch-cancel"))},i.Aa=function(t){var i=this;return function(n){for(var e,r=i.Ea(),s=[],h=n.changedTouches.length,u=0;u<h;++u){var o=n.changedTouches[u],a=o.identifier;if(null!==a){var c=i.ka(o,r),f=oM.getOrCreateTouch(a,c.x,c.y);f&&("touch-end"!==t&&"touch-cancel"!==t||oM.releaseTouch(a),s.push(f))}}if(n.stopPropagation(),n.target===i.Ae&&n.preventDefault(),"touch-start"===t&&(null==(e=i.Ae)||e.focus()),s.length>0){var v=new zm(s,!1,t,oM.getAllTouches());i.du.emit(t,v)}}},i.Ea=function(){var t=this.Ae,i=null==t?void 0:t.getBoundingClientRect();return i?new ps(i.x,i.y,i.width,i.height):new ps(0,0,0,0)},i.ka=function(t,i){var n=t.clientX-i.x,e=i.y+i.height-t.clientY;if(eo.isFrameRotated){var r=n;n=i.height-e,e=r}var s=eo.devicePixelRatio;return new ls(n*=s,e*=s)},i.on=function(t,i,n){this.du.on(t,i,n)},i.dispatchEventsInCache=function(){},t}(),cM=function(){function t(t){this.priority=0,this.Na=t}var i=t.prototype;return i.onThrowException=function(){},i.dispatchEvent=function(t){return this.Na.emit(t.type,t),!0},t}(),fM=((iM={})["mouse-down"]="touch-start",iM["mouse-move"]="touch-move",iM["mouse-up"]="touch-end",iM),vM=t("Input",function(){function t(){this.du=new Ou,this.Ca=new aM,this.La=new hM,this.Fa=new sM,this.Pa=new RI,this.Ba=[],this.Da=[],this.Ua=[],this.xa=[],this.Ga=[],this.ja=[],this.Ha=!1,this.Va=[],this.$a=new tM,this.Wa=new nM,this.za=new eM,this.ht(),this.Xa=new cM(this.du),this._registerEventDispatcher(this.Xa),QI._init()}var i=t.prototype;return i.Ya=function(t){var i,n;null==(i=(n=this.La).dispatchMouseDownEvent)||i.call(n,t)},i.Ka=function(t){var i,n;null==(i=(n=this.La).dispatchMouseMoveEvent)||i.call(n,t)},i.qa=function(t){var i,n;null==(i=(n=this.La).dispatchMouseUpEvent)||i.call(n,t)},i.Qa=function(t){var i,n;null==(i=(n=this.La).dispatchScrollEvent)||i.call(n,t)},i.Za=function(t){var i,n;null==(i=(n=this.Fa).dispatchKeyboardDownEvent)||i.call(n,t)},i.Ja=function(t){var i,n;null==(i=(n=this.Fa).dispatchKeyboardUpEvent)||i.call(n,t)},i.on=function(t,i,n){return this.du.on(t,i,n),i},i.once=function(t,i,n){return this.du.once(t,i,n),i},i.off=function(t,i,n){this.du.off(t,i,n)},i.getTouch=function(t){return oM.getTouch(t)},i.getAllTouches=function(){return oM.getAllTouches()},i.getTouchCount=function(){return oM.getTouchCount()},i.setAccelerometerEnabled=function(t){t?this.Pa.start():this.Pa.stop()},i.setAccelerometerInterval=function(t){this.Pa.setInterval(t)},i.tc=function(t){var i=fM[t.type],n=oM.getOrCreateTouch(0,t.getLocationX(),t.getLocationY());if(n){var e=[n],r=new zm(e,!1,i,"touch-end"===i?[]:e);r.windowId=t.windowId,"touch-end"===i&&oM.releaseTouch(0),this.nc(r)}},i._registerEventDispatcher=function(t){this.Va.push(t),this.Va.sort((function(t,i){return i.priority-t.priority}))},i.ec=function(t){for(var i=this.Va.length,n=0;n<i;++n){var e=this.Va[n];try{if(!e.dispatchEvent(t))break}catch(t){throw this._clearEvents(),e.onThrowException(),t}}},i.ht=function(){var t=this,i=t.Ca,n=t.La,e=t.Fa,r=t.$a;if(ho.hasFeature(ho.Feature.INPUT_TOUCH)&&(i.on("touch-start",(function(i){t.nc(i)})),i.on("touch-move",(function(i){t.nc(i)})),i.on("touch-end",(function(i){t.nc(i)})),i.on("touch-cancel",(function(i){t.nc(i)}))),ho.hasFeature(ho.Feature.EVENT_MOUSE)&&(n.on("mouse-down",(function(i){t.Ha=!0,t.tc(i),t.rc(i)})),n.on("mouse-move",(function(i){t.Ha&&t.tc(i),t.rc(i)})),n.on("mouse-up",(function(i){t.Ha=!1,t.tc(i),t.rc(i)})),n.on("mouse-wheel",(function(i){t.rc(i)})),n.on("mouse-leave-window",(function(i){t.rc(i)})),n.on("mouse-enter-window",(function(i){t.rc(i)}))),ho.hasFeature(ho.Feature.EVENT_KEYBOARD)){var s=t.Ba;e.on("keydown",(function(i){t.sc(i,s)})),e.on("key-pressing",(function(i){t.sc(i,s)})),e.on("keyup",(function(i){t.sc(i,s)}))}if(ho.hasFeature(ho.Feature.EVENT_ACCELEROMETER)){var h=t.Da;t.Pa.on("devicemotion",(function(i){t.sc(i,h)}))}if(ho.hasFeature(ho.Feature.EVENT_GAMEPAD)){var u=t.Ua;QI._on("gamepad-change",(function(i){t.sc(i,u)})),QI._on("gamepad-input",(function(i){t.sc(i,u)})),QI._on("handle-pose-input",(function(i){t.sc(i,u)}))}if(ho.hasFeature(ho.Feature.EVENT_HANDLE)){var o=t.xa;r._on("handle-input",(function(i){t.sc(i,o)})),r._on("handle-pose-input",(function(i){t.sc(i,o)}))}if(ho.hasFeature(ho.Feature.EVENT_HMD)){var a=t.Ga;t.Wa._on("hmd-pose-input",(function(i){t.sc(i,a)}))}if(ho.hasFeature(ho.Feature.EVENT_HANDHELD)){var c=t.ja;t.za._on("handheld-pose-input",(function(i){t.sc(i,c)}))}},i._clearEvents=function(){this.Ba.length=0,this.Da.length=0,this.Ua.length=0,this.xa.length=0,this.Ga.length=0},i.sc=function(t){this.ec(t)},i.rc=function(t){this.ec(t)},i.nc=function(t){for(var i=t.getTouches(),n=i.length,e=0;e<n;++e)t.touch=i[e],t.propagationStopped=t.propagationImmediateStopped=!1,this.ec(t)},i._frameDispatchEvents=function(){},t}());vM.EventType={TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_LEAVE:"mouse-leave-window",MOUSE_ENTER:"mouse-enter-window",MOUSE_WHEEL:"mouse-wheel",KEY_DOWN:"keydown",KEY_PRESSING:"key-pressing",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",GAMEPAD_INPUT:"gamepad-input",GAMEPAD_CHANGE:"gamepad-change",HANDLE_INPUT:"handle-input",HANDLE_POSE_INPUT:"handle-pose-input",HMD_POSE_INPUT:"hmd-pose-input",HANDHELD_POSE_INPUT:"handheld-pose-input"};var lM=t("input",new vM),dM=t("SystemEvent",function(t){function i(){var i;return i=t.call(this)||this,lM.on("mouse-down",(function(t){i.emit("mouse-down",t)})),lM.on("mouse-move",(function(t){i.emit("mouse-move",t)})),lM.on("mouse-up",(function(t){i.emit("mouse-up",t)})),lM.on("mouse-wheel",(function(t){i.emit("mouse-wheel",t)})),lM.on("touch-start",(function(t){i.emit("touch-start",t.touch,t)})),lM.on("touch-move",(function(t){i.emit("touch-move",t.touch,t)})),lM.on("touch-end",(function(t){i.emit("touch-end",t.touch,t)})),lM.on("touch-cancel",(function(t){i.emit("touch-cancel",t.touch,t)})),lM.on("keydown",(function(t){i.emit("keydown",t)})),lM.on("key-pressing",(function(t){i.emit("keydown",t)})),lM.on("keyup",(function(t){i.emit("keyup",t)})),lM.on("devicemotion",(function(t){i.emit("devicemotion",t)})),i}s(i,t);var n=i.prototype;return n.setAccelerometerEnabled=function(t){lM.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){lM.setAccelerometerInterval(t)},n.on=function(i,n,e,r){return t.prototype.on.call(this,i,n,e,r),n},n.off=function(i,n,e){t.prototype.off.call(this,i,n,e)},i}(Ou));dM.EventType=Qm,k.SystemEvent=dM;var gM=t("systemEvent",new dM);k.systemEvent=gM,dt(Qm,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),dt(jm,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:dM.EventType,targetName:"SystemEvent.EventType"}]),wt(jm,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),dt($m,"EventMouse",["DOWN","UP","MOVE"].map((function(t){return{name:t,newName:"MOUSE_"+t,target:dM.EventType,targetName:"SystemEvent.EventType"}}))),dt($m,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:dM.EventType,targetName:"SystemEvent.EventType"}]),wt($m.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),dt(zm,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:dM.EventType,targetName:"SystemEvent.EventType"}]),dt(zm,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:dM.EventType,targetName:"SystemEvent.EventType"}]),dt(zm,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:dM.EventType,targetName:"SystemEvent.EventType"}]),dt(zm,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:dM.EventType,targetName:"SystemEvent.EventType"}]),wt(zm.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),dt(zm.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:zm,targetName:"EventTouch"}]),wt(Gi.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((function(t){return{name:t}}))),wt(Gi.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),wt(Gi.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),wt(Gi.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),wt(Gi,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]);var wM=t("DebugView",function(){function t(){this._singleMode=0,this._compositeModeValue=0,this._lightingWithAlbedo=!0,this._csmLayerColoration=!1,this._activate()}var i=t.prototype;return i.isCompositeModeEnabled=function(t){return!!(this._compositeModeValue&1<<t)},i.enableCompositeMode=function(t,i){this.hc(t,i),this._updatePipeline()},i.enableAllCompositeMode=function(t){this.uc(t),this._updatePipeline()},i.isEnabled=function(){return 0!==this.oc()},i.reset=function(){this._activate(),this._updatePipeline()},i._activate=function(){this._singleMode=0,this.uc(!0),this._lightingWithAlbedo=!0,this._csmLayerColoration=!1},i._updatePipeline=function(){var t=k.director.root,i=t.pipeline,n=this.oc();i.macros.CC_USE_DEBUG_VIEW!==n&&(i.macros.CC_USE_DEBUG_VIEW=n,t.onGlobalPipelineStateChanged())},i.hc=function(t,i){i?this._compositeModeValue|=1<<t:this._compositeModeValue&=~(1<<t)},i.uc=function(t){for(var i=0;i<17;i++)t?this._compositeModeValue|=1<<i:this._compositeModeValue&=~(1<<i)},i.oc=function(){if(0!==this._singleMode)return 1;if(!0!==this._lightingWithAlbedo||!1!==this._csmLayerColoration)return 2;for(var t=0;t<17;t++)if(!this.isCompositeModeEnabled(t))return 2;return 0},e(t,[{key:"singleMode",get:function(){return this._singleMode},set:function(t){this._singleMode=t,this._updatePipeline()}},{key:"lightingWithAlbedo",get:function(){return this._lightingWithAlbedo},set:function(t){this._lightingWithAlbedo=t,this._updatePipeline()}},{key:"csmLayerColoration",get:function(){return this._csmLayerColoration},set:function(t){this._csmLayerColoration=t,this._updatePipeline()}},{key:"debugViewType",get:function(){return this.oc()}}]),t}()),_M={VERTICAL:0,HORIZONTAL:1},mM={ORTHO:0,PERSPECTIVE:1},pM={F1_8:0,F2_0:1,F2_2:2,F2_5:3,F2_8:4,F3_2:5,F3_5:6,F4_0:7,F4_5:8,F5_0:9,F5_6:10,F6_3:11,F7_1:12,F8_0:13,F9_0:14,F10_0:15,F11_0:16,F13_0:17,F14_0:18,F16_0:19,F18_0:20,F20_0:21,F22_0:22},yM={ISO100:0,ISO200:1,ISO400:2,ISO800:3},bM={D1:0,D2:1,D4:2,D8:3,D15:4,D30:5,D60:6,D125:7,D250:8,D500:9,D1000:10,D2000:11,D4000:12},AM=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],EM=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],kM=[100,200,400,800],TM=nr(),SM=nr(),OM=Zr(),RM=[],IM=0,MM=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=1,this.postProcess=null,this.usePostProcess=!1,this.pipeline="",this.pipelineSettings=null,this.ac=null,this.ds=null,this.de=null,this.fc=!1,this.vc=-1,this.lc=1,this.dc=10,this.gc=0,this.wc=ne(45),this._c=1,this.mc=1e3,this.yc=new nd(.2,.2,.2,1),this.bc=ys(0,0,1,1),this.Ac=ys(0,0,1,1),this.Ec=0,this.kc=!0,this.Tc=Zr(),this.Sc=Zr(),this.Oc=Zr(),this.Rc=Zr(),this.Ic=Zr(),this.Mc=new So,this.Nc=nr(),this.Cc=nr(),this.Lc=0,this.Fc=19,this.Pc=7,this.Bc=0,this.Dc=0,this.Uc=0,this.xc=null,this.xn=1,this.Gn=1,this.Gc=0,this.jc=1,this.Hc=Lb,this.Vc=0,this.$c=0,this.Wc=null,this.zc=0,this.Xc=-1,this.Yc=0,this.en=100,this.Kc=IM++,this.gu=t,this.qc=AM[this.Fc],this.Bc=EM[this.Pc],this.Uc=kM[this.Dc],this.Mc.accurate=!0,!RM.length){var i=t.capabilities.clipSpaceSignY;RM[0]=new Kr(1,0,0,0,0,i),RM[1]=new Kr(0,1,0,0,-i,0),RM[2]=new Kr(-1,0,0,0,0,-i),RM[3]=new Kr(0,-1,0,0,i,0)}}var i=t.prototype;return i.Qc=function(t){if(void 0===t&&(t=!0),this.lc=this.window.width*this.bc.width/(this.window.height*this.bc.height),t){var i=this.window.swapchain;(i&&i.surfaceTransform||0)%2&&(this.lc=1/this.lc)}this.kc=!0},i.initialize=function(t){void 0!==t.usage?this.en=t.usage:this.Zc(),void 0!==t.trackingType&&(this.Yc=t.trackingType),void 0!==t.cameraType&&(this.Xc=t.cameraType),this.node=t.node,this.xn=1,this.Gn=1,this.clearFlag=0,this.clearDepth=1,this.visibility=Lb,this.de=t.name,this.vc=t.projection,this.Lc=t.priority||0,this.lc=this.screenScale=1,this.Jc(),this.changeTargetWindow(t.window)},i.destroy=function(){var t;this.ds=null,this.detachFromScene(),this.xc&&(this.xc.detachCamera(this),this.window=null),this.de=null,null==(t=this.Wc)||t.destroy()},i.attachToScene=function(t){this.fc=!0,this.ac=t},i.detachFromScene=function(){this.fc=!1,this.ac=null},i.resize=function(t,i){this.xc&&(this.xn=t,this.Gn=i,this.lc=t*this.bc.width/(i*this.bc.height),this.kc=!0)},i.setFixedSize=function(t,i){this.xn=t,this.Gn=i,this.Qc(),this.isWindowSize=!1},i.syncCameraEditor=function(){},i.update=function(t){var i;if(void 0===t&&(t=!1),this.ds){var n=!1,e=this.Nc,r=this.Tc,s=this.Sc;(this.ds.hasChangedFlags||t)&&(Kr.invert(r,this.ds.worldMatrix),e.x=-r.m02,e.y=-r.m06,e.z=-r.m10,Kr.multiply(r,(new Kr).scale(this.ds.worldScale),r),this.ds.getWorldPosition(this.Cc),n=!0);var h=null==(i=this.window)?void 0:i.swapchain,u=h&&h.surfaceTransform||0;if(this.kc||this.Ec!==u){this.Ec=u;var o=this.gu.capabilities.clipSpaceSignY;if(1===this.vc)Kr.perspective(s,this.wc,this.lc,this._c,this.mc,0===this.gc,this.gu.capabilities.clipSpaceMinZ,o,u);else{var a=this.dc*this.lc,c=this.dc;Kr.ortho(s,-a,a,-c,c,this._c,this.mc,this.gu.capabilities.clipSpaceMinZ,o,u)}Kr.invert(this.Oc,s),n=!0,this.kc=!1}n&&(Kr.multiply(this.Rc,s,r),Kr.invert(this.Ic,this.Rc),this.Mc.update(this.Rc,this.Ic))}},i.setViewportInOrientedSpace=function(t){var i,n=t.x,e=t.width,r=t.height,s=this.gu.capabilities.screenSpaceSignY<0?1-t.y-r:t.y,h=null==(i=this.window)?void 0:i.swapchain;switch(h&&h.surfaceTransform||0){case 1:this.bc.x=1-s-r,this.bc.y=n,this.bc.width=r,this.bc.height=e;break;case 2:this.bc.x=1-n-e,this.bc.y=1-s-r,this.bc.width=e,this.bc.height=r;break;case 3:this.bc.x=s,this.bc.y=1-n-e,this.bc.width=r,this.bc.height=e;break;case 0:this.bc.x=n,this.bc.y=s,this.bc.width=e,this.bc.height=r}this.Ac.x=n,this.Ac.y=s,this.Ac.width=e,this.Ac.height=r,this.resize(this.width,this.height)},i.initGeometryRenderer=function(){if(!this.Wc){var t,i=k.internal.GeometryRenderer;this.Wc=i?new i:null,null==(t=this.Wc)||t.activate(this.gu)}},i.changeTargetWindow=function(t){void 0===t&&(t=null),this.xc&&this.xc.detachCamera(this);var i=t||k.director.root.mainWindow;if(i){i.attachCamera(this),this.window=i;var n=i.swapchain;(n&&n.surfaceTransform||0)%2?this.resize(i.height,i.width):this.resize(i.width,i.height)}},i.detachCamera=function(){this.xc&&this.xc.detachCamera(this)},i.screenPointToRay=function(t,i,n){if(!this.ds)return null;var e=this.width,r=this.height,s=this.Ac.x*e,h=this.Ac.y*r,u=this.Ac.width*e,o=this.Ac.height*r,a=1===this.vc,c=this.gu.capabilities.clipSpaceSignY,f=Hr[this.Ec];ir.set(TM,(i-s)/u*2-1,(n-h)/o*2-1,a?1:-1);var v=TM.x,l=TM.y;return TM.x=v*f[0]+l*f[2]*c,TM.y=v*f[1]+l*f[3]*c,ir.transformMat4(a?TM:t.o,TM,this.Ic),a?(this.ds.getWorldPosition(SM),Ds.fromPoints(t,SM,TM)):ir.transformQuat(t.d,ir.FORWARD,this.ds.worldRotation),t},i.screenToWorld=function(t,i){var n=this.width,e=this.height,r=this.Ac.x*n,s=this.Ac.y*e,h=this.Ac.width*n,u=this.Ac.height*e,o=this.gu.capabilities.clipSpaceSignY,a=Hr[this.Ec];if(1===this.vc){ir.set(t,(i.x-r)/h*2-1,(i.y-s)/u*2-1,1);var c=t.x,f=t.y;t.x=c*a[0]+f*a[2]*o,t.y=c*a[1]+f*a[3]*o,ir.transformMat4(t,t,this.Ic),this.ds&&this.ds.getWorldPosition(TM),ir.lerp(t,TM,t,ie(this._c/this.mc,1,i.z))}else{ir.set(t,(i.x-r)/h*2-1,(i.y-s)/u*2-1,2*i.z-1);var v=t.x,l=t.y;t.x=v*a[0]+l*a[2]*o,t.y=v*a[1]+l*a[3]*o,ir.transformMat4(t,t,this.Ic)}return t},i.worldToScreen=function(t,i){var n=this.gu.capabilities.clipSpaceSignY,e=Hr[this.Ec];ir.transformMat4(t,i,this.Rc);var r=t.x,s=t.y;t.x=r*e[0]+s*e[2]*n,t.y=r*e[1]+s*e[3]*n;var h=this.width,u=this.height,o=this.Ac.x*h,a=this.Ac.y*u,c=this.Ac.width*h,f=this.Ac.height*u;return t.x=o+.5*(t.x+1)*c,t.y=a+.5*(t.y+1)*f,t.z=.5*t.z+.5,t},i.worldMatrixToScreen=function(t,i,n,e){Kr.multiply(t,this.Rc,i),Kr.multiply(t,RM[this.Ec],t);var r=n/2,s=e/2;return Kr.identity(OM),Kr.transform(OM,OM,ir.set(TM,r,s,0)),Kr.scale(OM,OM,ir.set(TM,r,s,1)),Kr.multiply(t,OM,t),t},i.calculateObliqueMat=function(t){var i=new De(Math.sign(t.x),Math.sign(t.y),1,1).transformMat4(this.Oc),n=new De(this.Sc.m03,this.Sc.m07,this.Sc.m11,this.Sc.m15),e=2/De.dot(t,i),r=t.multiplyScalar(e).subtract(n);this.Sc.m02=r.x,this.Sc.m06=r.y,this.Sc.m10=r.z,this.Sc.m14=r.w},i.getClipSpaceMinz=function(){return this.gu.capabilities.clipSpaceMinZ},i.setExposure=function(t){this.Vc=.833333/Math.pow(2,t)},i.Jc=function(){var t=Math.log2(this.qc*this.qc/this.Bc*100/this.Uc);this.setExposure(t)},i.Zc=function(){this.en=100},e(t,[{key:"name",get:function(){return this.de}},{key:"scene",get:function(){return this.ac}},{key:"node",get:function(){return this.ds},set:function(t){this.ds=t}},{key:"systemWindowId",get:function(){return this.zc}},{key:"window",get:function(){return this.xc},set:function(t){this.xc=t}},{key:"enabled",get:function(){return this.fc},set:function(t){this.fc=t}},{key:"visibility",get:function(){return this.Hc},set:function(t){this.Hc=t}},{key:"priority",get:function(){return this.Lc},set:function(t){this.Lc=t}},{key:"width",get:function(){return this.xn}},{key:"height",get:function(){return this.Gn}},{key:"position",get:function(){return this.Cc},set:function(t){this.Cc=t}},{key:"forward",get:function(){return this.Nc},set:function(t){this.Nc=t}},{key:"aperture",get:function(){return this.Fc},set:function(t){this.Fc=t,this.qc=AM[this.Fc],this.Jc()}},{key:"apertureValue",get:function(){return this.qc}},{key:"shutter",get:function(){return this.Pc},set:function(t){this.Pc=t,this.Bc=EM[this.Pc],this.Jc()}},{key:"shutterValue",get:function(){return this.Bc}},{key:"iso",get:function(){return this.Dc},set:function(t){this.Dc=t,this.Uc=kM[this.Dc],this.Jc()}},{key:"isoValue",get:function(){return this.Uc}},{key:"exposure",get:function(){return this.Vc}},{key:"clearFlag",get:function(){return this.Gc},set:function(t){this.Gc=t}},{key:"clearColor",get:function(){return this.yc},set:function(t){this.yc.x=t.x,this.yc.y=t.y,this.yc.z=t.z,this.yc.w=t.w}},{key:"clearDepth",get:function(){return this.jc},set:function(t){this.jc=t}},{key:"clearStencil",get:function(){return this.$c},set:function(t){this.$c=t}},{key:"projectionType",get:function(){return this.vc},set:function(t){this.vc=t,this.kc=!0}},{key:"aspect",get:function(){return this.lc}},{key:"orthoHeight",get:function(){return this.dc},set:function(t){this.dc=t,this.kc=!0}},{key:"fovAxis",get:function(){return this.gc},set:function(t){this.gc=t,this.kc=!0}},{key:"fov",get:function(){return this.wc},set:function(t){this.wc=t,this.kc=!0}},{key:"nearClip",get:function(){return this._c},set:function(t){this._c=t,this.kc=!0}},{key:"farClip",get:function(){return this.mc},set:function(t){this.mc=t,this.kc=!0}},{key:"viewport",get:function(){return this.bc},set:function(t){st(8302),this.setViewportInOrientedSpace(t)}},{key:"frustum",get:function(){return this.Mc},set:function(t){this.Mc=t}},{key:"matView",get:function(){return this.Tc}},{key:"matProj",get:function(){return this.Sc}},{key:"matProjInv",get:function(){return this.Oc}},{key:"matViewProj",get:function(){return this.Rc}},{key:"matViewProjInv",get:function(){return this.Ic}},{key:"cameraId",get:function(){return this.Kc}},{key:"surfaceTransform",get:function(){return this.Ec}},{key:"geometryRenderer",get:function(){return this.Wc}},{key:"cameraType",get:function(){return this.Xc},set:function(t){this.Xc=t}},{key:"trackingType",get:function(){return this.Yc},set:function(t){this.Yc=t}},{key:"cameraUsage",get:function(){return this.en},set:function(t){this.en=t}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}(),NM=new xd(null),CM=function(){function t(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=128,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._instancedAttributeBlock={buffer:null,views:[],attributes:[]},this._instancedWorldMatrixIndex=-1,this._instancedSHIndex=-1,this._useReflectionProbeType=0}var i=t.prototype;return i.initialize=function(t,i,n){void 0===n&&(n=null),k.director.root,this._device=Hg.gfxDevice,NM.layout=i[0].localSetLayout,this._inputAssembler=this._device.createInputAssembler(t.iaInfo),this._descriptorSet=this._device.createDescriptorSet(NM);var e=k.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass();if(e){var r=new xd(null);r.layout=e.localSetLayout,this._worldBoundDescriptorSet=this._device.createDescriptorSet(r)}this._subMesh=t,this._patches=n?n.sort():null,this._passes=i,this._flushPassInfo(),this.priority=128},i.destroy=function(){this._descriptorSet.destroy(),this._descriptorSet=null,this._inputAssembler.destroy(),this._inputAssembler=null,this._worldBoundDescriptorSet&&this._worldBoundDescriptorSet.destroy(),this._worldBoundDescriptorSet=null,this.priority=128,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null},i.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update(),this._worldBoundDescriptorSet&&this._worldBoundDescriptorSet.update()},i.tf=function(){var t=this._passes;t&&(t.forEach((function(t){t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()})),this._flushPassInfo())},i.onPipelineStateChanged=function(){this.tf()},i.onMacroPatchesStateChanged=function(t){(t||this._patches)&&(t&&(t=t.sort(),this._patches&&t.length===this._patches.length&&JSON.stringify(t)===JSON.stringify(this._patches))||(this._patches=t,this.tf()))},i.onGeometryChanged=function(){if(this._subMesh){var t=this._subMesh.drawInfo;if(this._inputAssembler&&t){var i=this._inputAssembler.drawInfo;Object.keys(t).forEach((function(n){i[n]=t[n]})),this._inputAssembler.drawInfo=i}}},i.getInstancedAttributeIndex=function(t){for(var i=this.instancedAttributeBlock.attributes,n=0;n<i.length;n++)if(i[n].name===t)return n;return-1},i.updateInstancedWorldMatrix=function(t,i){var n=this.instancedAttributeBlock.views,e=n[i],r=n[i+1],s=n[i+2];e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,r[0]=t.m04,r[1]=t.m05,r[2]=t.m06,r[3]=t.m13,s[0]=t.m08,s[1]=t.m09,s[2]=t.m10,s[3]=t.m14},i.updateInstancedSH=function(t,i){for(var n=this.instancedAttributeBlock.views,e=0,r=i;r<i+3;r++)for(var s=0;s<4;s++)n[r][s]=t[e++]},i.UpdateInstancedAttributes=function(t){this.instancedWorldMatrixIndex=-1,this.instancedSHIndex=-1;var i=this.passes[0];if(i.device.hasFeature(1)){for(var n=0,e=0;e<t.length;e++){var r=t[e];r.isInstanced&&(n+=tg[r.format].size)}var s=this.instancedAttributeBlock;s.buffer=new Uint8Array(n),s.views.length=s.attributes.length=0;for(var h=0,u=0;u<t.length;u++){var o=t[u];if(o.isInstanced){var a=new kd;a.format=o.format,a.name=o.name,a.isNormalized=o.isNormalized,a.location=o.location,s.attributes.push(a);var c=tg[o.format],f=new(ag(c))(s.buffer.buffer,h,c.count);s.views.push(f),h+=c.size}}1===i.batchingScheme&&i.getInstancedBuffer().destroy(),this.instancedWorldMatrixIndex=this.getInstancedAttributeIndex(Dy),this.instancedSHIndex=this.getInstancedAttributeIndex(Uy)}},i._flushPassInfo=function(){var t=this._passes;if(t){this._shaders||(this._shaders=[]),this._shaders.length=t.length;for(var i=0,n=t.length;i<n;i++)this._shaders[i]=t[i].getShaderVariant(this.patches)}},e(t,[{key:"passes",get:function(){return this._passes},set:function(t){t.length>8?ut(12004,8):(this._passes=t,this._flushPassInfo(),this._descriptorSet&&(this._descriptorSet.destroy(),NM.layout=t[0].localSetLayout,this._descriptorSet=this._device.createDescriptorSet(NM)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(t){this._inputAssembler.destroy(),this._inputAssembler=this._device.createInputAssembler(t.iaInfo),this._subMesh=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"instancedAttributeBlock",get:function(){return this._instancedAttributeBlock}},{key:"instancedWorldMatrixIndex",get:function(){return this._instancedWorldMatrixIndex},set:function(t){this._instancedWorldMatrixIndex=t}},{key:"instancedSHIndex",get:function(){return this._instancedSHIndex},set:function(t){this._instancedSHIndex=t}},{key:"useReflectionProbeType",get:function(){return this._useReflectionProbeType},set:function(t){this._useReflectionProbeType=t}}]),t}(),LM=new Kr,FM=[{name:"CC_RECEIVE_SHADOW",value:!0}],PM=[{name:"CC_USE_LIGHTMAP",value:1}],BM=[{name:"CC_USE_LIGHTMAP",value:2}],DM=[{name:"CC_LIGHT_MAP_VERSION",value:2}],UM=[{name:"CC_USE_LIGHT_PROBE",value:!0}],xM=new dd(2,2,0,2,2,2),GM=new dd(2,2,2,2,2,2),jM=function(){function t(){this.type=0,this.scene=null,this.isDynamicBatching=!1,this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(56),this._localBuffer=null,this._localSHData=null,this._localSHBuffer=null,this.if=null,this.nf=Ue(),this.ef=-1,this.rf=nr(1/0,1/0,1/0),this.sf=!1,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._receiveDirLight=!0,this._shadowBias=0,this._shadowNormalBias=0,this._reflectionProbeId=-1,this._reflectionProbeBlendId=-1,this._reflectionProbeBlendWeight=0,this._enabled=!0,this._visFlags=Pm.Enum.NONE,this._priority=0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=0,this._device=Hg.gfxDevice}var i=t.prototype;return i.initialize=function(){this._inited||(this._receiveShadow=!0,this.castShadow=!1,this.enabled=!0,this.visFlags=Pm.Enum.NONE,this._inited=!0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=0)},i.destroy=function(){for(var t=this._subModels,i=0;i<t.length;i++)this._subModels[i].destroy();this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._localSHBuffer&&(this._localSHBuffer.destroy(),this._localSHBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1},i.attachToScene=function(t){this.scene=t,this._localDataUpdated=!0},i.detachFromScene=function(){this.scene=null},i.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t.isTransformDirty()){t.updateWorldTransform(),this._localDataUpdated=!0;var i=this._worldBounds;this._modelBounds&&i&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,i)}},i.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._localDataUpdated=!0;var i=this._worldBounds;this._modelBounds&&i&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,i)}},i.updateUBOs=function(t){for(var i=this._subModels,n=0;n<i.length;n++)i[n].update();this._updateStamp=t,this.updateSHUBOs();var e=this.node.scene.globals.shadows,r=e.enabled&&e.type===Pk.Planar;if(this._localDataUpdated){this._localDataUpdated=!1;for(var s=this.transform._mat,h=!1,u=0;u<i.length;u++){var o=i[u],a=o.instancedWorldMatrixIndex;a>=0?o.updateInstancedWorldMatrix(s,a):h=!0}(h||r)&&this._localBuffer&&(Kr.toArray(this._localData,s,0),Kr.invert(LM,s),Kr.transpose(LM,LM),Kr.toArray(this._localData,LM,16),this._localBuffer.update(this._localData))}},i.hf=function(){this._localDataUpdated=!0},i.showTetrahedron=function(){return this.uf()},i.uf=function(){if(!this.sf)return!1;var t=qp().lightProbes;return!(!t||t.empty()||!this._worldBounds)},i.af=function(){if(this._localSHData){for(var t=this._subModels,i=!1,n=0;n<t.length;n++){var e=t[n],r=e.instancedSHIndex;r>=0?e.updateInstancedSH(this._localSHData,r):i=!0}i&&this._localSHBuffer&&this._localSHBuffer.update(this._localSHData)}},i.clearSHUBOs=function(){if(this._localSHData){for(var t=0;t<28;t++)this._localSHData[t]=0;this.af()}},i.updateSHUBOs=function(){if(this.uf()){var t=this._worldBounds.center;if(!t.equals(this.rf,qn)){var i=[],n=new De,e=k.director.root.pipeline.pipelineSceneData.lightProbes;if(this.rf.set(t),this.ef=e.data.getInterpolationWeights(t,this.ef,n),e.data.getInterpolationSHCoefficients(this.ef,n,i)&&this._localSHData){var r=k.internal.SH;r.reduceRinging(i,e.reduceRinging),r.updateUBOData(this._localSHData,0,i),this.af()}}}},i.createBoundingShape=function(t,i){t&&i&&(this._modelBounds||(this._modelBounds=wo.create()),this._worldBounds||(this._worldBounds=wo.create()),wo.fromPoints(this._modelBounds,t,i),this._worldBounds.copy(this._modelBounds))},i.cf=function(){return new CM},i.initSubModel=function(t,i,n){this.initialize(),null==this._subModels[t]?this._subModels[t]=this.cf():this._subModels[t].destroy(),this._subModels[t].initialize(i,n.passes,this.getMacroPatches(t)),this._updateAttributesAndBinding(t)},i.setSubModelMesh=function(t,i){this._subModels[t]&&(this._subModels[t].subMesh=i)},i.setSubModelMaterial=function(t,i){this._subModels[t]&&(this._subModels[t].passes=i.passes,this._updateAttributesAndBinding(t))},i.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onPipelineStateChanged()},i.onMacroPatchesStateChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onMacroPatchesStateChanged(this.getMacroPatches(i))},i.onGeometryChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onGeometryChanged()},i.initLightingmap=function(t,i){this.if=t,this.nf=i},i.updateLightingmap=function(t,i){De.toArray(this._localData,i,32),this._localDataUpdated=!0,this.if=t,this.nf=i,this.onMacroPatchesStateChanged(),t||(t=uk.get("empty-texture"));var n=t.getGFXTexture();if(n)for(var e=this._device.getSampler(t.mipmaps.length>1?GM:xM),r=this._subModels,s=0;s<r.length;s++){var h=r[s].descriptorSet;h.bindTexture(vb,n),h.bindSampler(vb,e),h.update()}},i.updateReflectionProbeCubemap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),t||(t=uk.get("default-cube-texture"));var i=t.getGFXTexture();if(i)for(var n=this._device.getSampler(t.getSamplerInfo()),e=this._subModels,r=0;r<e.length;r++){var s=e[r].descriptorSet;s&&(s.bindSampler(pb,n),s.bindTexture(pb,i),s.update())}},i.updateReflectionProbeBlendCubemap=function(){},i.updateReflectionProbePlanarMap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged();var i=this._device.getSampler(new dd(2,2,0,2,2,2));if(t||(t=uk.get("empty-texture").getGFXTexture()),t)for(var n=this._subModels,e=0;e<n.length;e++){var r=n[e].descriptorSet;r&&(r.bindTexture(Eb,t),r.bindSampler(Eb,i),r.update())}},i.updateReflectionProbeDataMap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),t||(t=uk.get("empty-texture"));var i=t.getGFXTexture();if(i)for(var n=this._subModels,e=0;e<n.length;e++){var r=n[e].descriptorSet;r&&(r.bindTexture(15,i),r.bindSampler(15,t.getGFXSampler()),r.update())}},i.updateLocalShadowBias=function(){var t=this._localData;t[36]=this._shadowBias,t[37]=this._shadowNormalBias,this._localDataUpdated=!0},i.updateReflectionProbeId=function(){var t=this._localData;t[38]=this._reflectionProbeId,t[39]=this._reflectionProbeBlendId;var i=null,n=null;if(k.internal.reflectionProbeManager&&(i=k.internal.reflectionProbeManager.getProbeById(this._reflectionProbeId),n=k.internal.reflectionProbeManager.getProbeById(this._reflectionProbeBlendId)),i){if(1===i.probeType)t[40]=i.node.up.x,t[41]=i.node.up.y,t[42]=i.node.up.z,t[43]=1,t[44]=1,t[45]=0,t[46]=0,t[47]=1;else{t[40]=i.node.worldPosition.x,t[41]=i.node.worldPosition.y,t[42]=i.node.worldPosition.z,t[43]=0,t[44]=i.size.x,t[45]=i.size.y,t[46]=i.size.z;var e=i.isRGBE()?1e3:0;t[47]=i.cubemap?i.cubemap.mipmapLevel+e:1+e}if(3===this._reflectionProbeType||4===this._reflectionProbeType)if(n){t[48]=n.node.worldPosition.x,t[49]=n.node.worldPosition.y,t[50]=n.node.worldPosition.z,t[51]=this.reflectionProbeBlendWeight,t[52]=n.size.x,t[53]=n.size.y,t[54]=n.size.z;var r=n.isRGBE()?1e3:0;t[55]=n.cubemap?n.cubemap.mipmapLevel+r:1+r}else 4===this._reflectionProbeType&&(t[51]=this.reflectionProbeBlendWeight)}this._localDataUpdated=!0},i.getMacroPatches=function(){var t=this.receiveShadow?FM:null;if(null!=this.if&&this.node&&this.node.scene){var i=this.node.scene.globals;if(!i.disableLightmap){var n=i.bakedWithStationaryMainLight?BM:PM;t=t?t.concat(n):n,i.bakedWithHighpLightmap&&(t=t.concat(DM))}}this.sf&&(t=t?t.concat(UM):UM);var e=[{name:"CC_USE_REFLECTION_PROBE",value:this._reflectionProbeType}];t=t?t.concat(e):e;var r=[{name:"CC_DISABLE_DIRECTIONAL_LIGHT",value:!this._receiveDirLight}];return t?t.concat(r):r},i._updateAttributesAndBinding=function(t){var i=this._subModels[t];if(i){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,i.descriptorSet),this._initLocalSHDescriptors(t),this._updateLocalSHDescriptors(t,i.descriptorSet),this._initWorldBoundDescriptors(t),i.worldBoundDescriptorSet&&this._updateWorldBoundDescriptors(t,i.worldBoundDescriptorSet);var n=[],e=new Set;i.passes.forEach((function(t){t.getShaderVariant(i.patches).attributes.forEach((function(t){e.has(t.name)||(n.push(t),e.add(t.name))}))})),this._updateInstancedAttributes(n,i)}},i._updateInstancedAttributes=function(t,i){i.UpdateInstancedAttributes(t),this._localDataUpdated=!0},i._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new ud(18,1,224,224)))},i._initLocalSHDescriptors=function(){this.sf&&(this._localSHData||(this._localSHData=new Float32Array(28)),this._localSHBuffer||(this._localSHBuffer=this._device.createBuffer(new ud(18,1,112,112))))},i._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new ud(18,1,By.SIZE,By.SIZE)))},i._updateLocalDescriptors=function(t,i){this._localBuffer&&i.bindBuffer(0,this._localBuffer)},i._updateLocalSHDescriptors=function(t,i){this._localSHBuffer&&i.bindBuffer(6,this._localSHBuffer)},i._updateWorldBoundDescriptors=function(t,i){this._worldBoundBuffer&&i.bindBuffer(By.BINDING,this._worldBoundBuffer)},e(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"localSHBuffer",get:function(){return this._localSHBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"useLightProbe",get:function(){return this.sf},set:function(t){this.sf=t,this.onMacroPatchesStateChanged()}},{key:"tetrahedronIndex",get:function(){return this.ef},set:function(t){this.ef=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t,this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveDirLight",get:function(){return this._receiveDirLight},set:function(t){this._receiveDirLight=t,this.onMacroPatchesStateChanged()}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"bakeToReflectionProbe",get:function(){return this._bakeToReflectionProbe},set:function(t){this._bakeToReflectionProbe=t}},{key:"reflectionProbeType",get:function(){return this._reflectionProbeType},set:function(t){this._reflectionProbeType=t;for(var i=this._subModels,n=0;n<i.length;n++)i[n].useReflectionProbeType=t;this.onMacroPatchesStateChanged()}},{key:"reflectionProbeId",get:function(){return this._reflectionProbeId},set:function(t){this._reflectionProbeId=t}},{key:"reflectionProbeBlendId",get:function(){return this._reflectionProbeBlendId},set:function(t){this._reflectionProbeBlendId=t}},{key:"reflectionProbeBlendWeight",get:function(){return this._reflectionProbeBlendWeight},set:function(t){this._reflectionProbeBlendWeight=t}}]),t}(),HM=function(){function t(){this._enabled=!1,this._minPos=new ir(0,0,0),this._maxPos=new ir(0,0,0),this._depth=0}return t.prototype.initialize=function(t){this._enabled=t.enabled,this._minPos=t.minPos,this._maxPos=t.maxPos,this._depth=t.depth},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t}}]),t}(),VM=function(){function t(){this._enabled=!0,this._blurRadius=.01,this._sssIntensity=3}return t.prototype.initialize=function(t){this._enabled=t.enabled,this._blurRadius=t.blurRadius,this._sssIntensity=t.sssIntensity},e(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(t){this._blurRadius=t}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(t){this._sssIntensity=t}}]),t}();function $M(t,i){i<1e3?i=1e3:i>15e3&&(i=15e3);var n=i*i,e=(.860117757+.000154118254*i+1.28641212e-7*n)/(1+.000842420235*i+7.08145163e-7*n),r=(.317398726+422806245e-13*i+4.20481691e-8*n)/(1-289741816e-13*i+1.61456053e-7*n),s=2*e-8*r+4,h=3*e/s,u=2*r/s,o=1/u*h,a=1/u*(1-h-u);t.x=3.2404542*o-1.5371385+-.4985314*a,t.y=-.969266*o+1.8760108+.041556*a,t.z=.0556434*o-.2040259+1.0572252*a}var WM,zM={DIRECTIONAL:0,SPHERE:1,SPOT:2,POINT:3,RANGED_DIRECTIONAL:4,UNKNOWN:5},XM=function(t){return 4*Math.PI*Math.PI*t*t},YM=function(){function t(){this._baked=!1,this._color=nr(1,1,1),this._colorTemp=6550,this._colorTempRGB=nr(1,1,1),this.ff=nr(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=5,this._visibility=Lb}var i=t.prototype;return i.initialize=function(){this.color=nr(1,1,1),this.colorTemperature=6550},i.attachToScene=function(t){this._scene=t},i.detachFromScene=function(){this._scene=null},i.destroy=function(){this._name=null,this._node=null},i.update=function(){},e(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",get:function(){return this._color},set:function(t){this._color.set(t),this._useColorTemperature&&ir.multiply(this.ff,this._color,this._colorTempRGB)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,t&&ir.multiply(this.ff,this._color,this._colorTempRGB)}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(t){this._colorTemp=t,$M(this._colorTempRGB,this._colorTemp),this._useColorTemperature&&ir.multiply(this.ff,this._color,this._colorTempRGB)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"finalColor",get:function(){return this.ff}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=2)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}}]),t}(),KM=new ir(0,0,-1),qM=new ir,QM=function(t){function i(){var i;return(i=t.call(this)||this)._dir=new ir(1,-1,-1),i._illuminanceHDR=fy.SUN_ILLUM,i._illuminanceLDR=1,i._shadowEnabled=!1,i._shadowPcf=Bk.HARD,i._shadowBias=1e-5,i._shadowNormalBias=0,i._shadowSaturation=1,i._shadowDistance=50,i._shadowInvisibleOcclusionRange=200,i._csmLevel=Dk.LEVEL_4,i._csmNeedUpdate=!1,i._csmLayerLambda=.75,i._csmOptimizationMode=Uk.DisableRotationFix,i._csmLayersTransition=!1,i._csmTransitionRange=.05,i._shadowFixedArea=!1,i._shadowNear=.1,i._shadowFar=10,i._shadowOrthoSize=5,i._type=0,i}s(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=fy.SUN_ILLUM,this.direction=new ir(1,-1,-1)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=ir.transformQuat(qM,KM,this._node.worldRotation))},n.vf=function(){var t=k.director.root,i=t.pipeline;this._shadowEnabled?(this._shadowFixedArea||!i.pipelineSceneData.csmSupported?i.macros.CC_DIR_LIGHT_SHADOW_TYPE=1:this.csmLevel>1&&i.pipelineSceneData.csmSupported?(i.macros.CC_DIR_LIGHT_SHADOW_TYPE=2,i.macros.CC_CASCADED_LAYERS_TRANSITION=this._csmLayersTransition):i.macros.CC_DIR_LIGHT_SHADOW_TYPE=1,i.macros.CC_DIR_SHADOW_PCF_TYPE=this._shadowPcf):i.macros.CC_DIR_LIGHT_SHADOW_TYPE=0,t.onGlobalPipelineStateChanged()},e(i,[{key:"direction",get:function(){return this._dir},set:function(t){ir.normalize(this._dir,t)}},{key:"illuminance",get:function(){return qp().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){qp().isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(t){this._illuminanceHDR=t}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(t){this._illuminanceLDR=t}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this.vf()}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this.vf()}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=t}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,Gk.MAX_FAR)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,Gk.MAX_FAR)}},{key:"csmLevel",get:function(){return this._csmLevel},set:function(t){this._csmLevel=t,this.vf()}},{key:"csmNeedUpdate",get:function(){return this._csmNeedUpdate},set:function(t){this._csmNeedUpdate=t}},{key:"csmLayerLambda",get:function(){return this._csmLayerLambda},set:function(t){this._csmLayerLambda=t}},{key:"csmOptimizationMode",get:function(){return this._csmOptimizationMode},set:function(t){this._csmOptimizationMode=t}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t,this.vf()}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,Gk.MAX_FAR)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t}},{key:"csmLayersTransition",get:function(){return this._csmLayersTransition},set:function(t){this._csmLayersTransition=t,this.vf()}},{key:"csmTransitionRange",get:function(){return this._csmTransitionRange},set:function(t){this._csmTransitionRange=t}}]),i}(YM),ZM=function(t){function i(){var i;return(i=t.call(this)||this)._needUpdate=!1,i._size=.15,i._range=1,i._luminanceHDR=0,i._luminanceLDR=0,i._pos=new ir,i._aabb=wo.create(),i._type=1,i}s(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminanceHDR=1700/XM(.15),this.luminanceLDR=1},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=this._range;wo.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1}},e(i,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return qp().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){qp().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",set:function(t){this._luminanceLDR=t}},{key:"aabb",get:function(){return this._aabb}}]),i}(YM),JM=new ir(0,0,-1),tN=new Cr,iN=new Kr,nN=new Kr,eN=new Kr,rN=new Kr,sN=function(t){function i(){var i;return(i=t.call(this)||this)._dir=new ir(1,-1,-1),i._range=5,i._spotAngle=Math.cos(Math.PI/6),i._angleAttenuationStrength=0,i._pos=new ir,i._aabb=wo.create(),i._frustum=So.create(),i._angle=0,i._needUpdate=!1,i._size=.15,i._luminanceHDR=0,i._luminanceLDR=0,i._shadowEnabled=!1,i._shadowPcf=Bk.HARD,i._shadowBias=1e-5,i._shadowNormalBias=0,i._type=2,i}s(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.luminanceHDR=1700/XM(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._dir.set(new ir(1,-1,-1))},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),ir.transformQuat(this._dir,JM,this._node.getWorldRotation(tN)),ir.normalize(this._dir,this._dir),wo.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(iN),Kr.invert(iN,iN),Kr.perspective(nN,this._angle,1,.001,this._range),Kr.multiply(eN,nN,iN),this._frustum.update(eN,rN),this._needUpdate=!1)},e(i,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return qp().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){qp().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(t){this._luminanceLDR=t}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._angle=t,this._spotAngle=Math.cos(.5*t),this._needUpdate=!0}},{key:"angleAttenuationStrength",get:function(){return this._angleAttenuationStrength},set:function(t){this._angleAttenuationStrength=t,this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}}]),i}(YM),hN=function(t){function i(){var i;return(i=t.call(this)||this).lf=!1,i.df=1,i.gf=0,i.wf=0,i._f=nr(),i.mf=wo.create(),i._type=3,i}s(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.range=1,this.luminanceHDR=1700/XM(1),this.luminanceLDR=1},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this.lf)){this._node.getWorldPosition(this._f);var t=this.df;wo.set(this.mf,this._f.x,this._f.y,this._f.z,t,t,t),this.lf=!1}},e(i,[{key:"position",get:function(){return this._f}},{key:"range",get:function(){return this.df},set:function(t){this.df=t,this.lf=!0}},{key:"luminance",get:function(){return qp().isHDR?this.gf:this.wf},set:function(t){qp().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this.gf},set:function(t){this.gf=t}},{key:"luminanceLDR",set:function(t){this.wf=t}},{key:"aabb",get:function(){return this.mf}}]),i}(YM),uN=new ir(0,0,-1),oN=function(t){function i(){var i;return(i=t.call(this)||this).pf=new ir(0,0,-1),i._f=new ir(0,0,0),i.yf=new ir(1,1,1),i.bf=new ir(1,0,0),i.Af=fy.SUN_ILLUM,i.Ef=1,i._type=4,i}s(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=fy.SUN_ILLUM},n.update=function(){this._node&&this._node.hasChangedFlags&&(this._node.getWorldPosition(this._f),this._node.getWorldScale(this.yf),ir.transformQuat(this.pf,uN,this._node.worldRotation),ir.transformQuat(this.bf,ir.RIGHT,this._node.worldRotation))},e(i,[{key:"direction",get:function(){return this.pf}},{key:"right",get:function(){return this.bf}},{key:"position",get:function(){return this._f}},{key:"scale",get:function(){return this.yf}},{key:"illuminance",get:function(){return qp().isHDR?this.Af:this.Ef},set:function(t){qp().isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this.Af},set:function(t){this.Af=t}},{key:"illuminanceLDR",get:function(){return this.Ef},set:function(t){this.Ef=t}}]),i}(YM),aN=new Od;aN.format=35;var cN=new Rd;cN.format=55;var fN=new Nd([aN],cN),vN={width:1,height:1,renderPassInfo:fN},lN=t("RenderTexture",Ko("cc.RenderTexture")(WM=function(t){function i(i){var n;return(n=t.call(this,i)||this).xc=null,n}s(i,t);var n=i.prototype;return n.initialize=function(t){this._name=t.name||"",this.xn=t.width,this.Gn=t.height,this.kf(t)},n.reset=function(t){this.initialize(t)},n.destroy=function(){if(this.xc){var i=k.director.root;null==i||i.destroyWindow(this.xc),this.xc=null}return t.prototype.destroy.call(this)},n.resize=function(t,i){this.xn=Math.floor(Jn(t,1,2048)),this.Gn=Math.floor(Jn(i,1,2048)),this.xc&&this.xc.resize(this.xn,this.Gn),this.emit("resize",this.xc)},n._serialize=function(){return{}},n._deserialize=function(i,n){var e=i;this.xn=e.w,this.Gn=e.h,this._name=e.n,t.prototype._deserialize.call(this,e.base,n)},n.getGFXTexture=function(){return this.xc&&this.xc.framebuffer.colorTextures[0]},n.onLoaded=function(){this.kf()},n.kf=function(t){var i=k.director.root;vN.title=this._name,vN.width=this.xn,vN.height=this.Gn,vN.renderPassInfo=t&&t.passInfo?t.passInfo:fN,vN.externalResLow=t&&t.externalResLow?t.externalResLow:0,vN.externalResHigh=t&&t.externalResHigh?t.externalResHigh:0,vN.externalFlag=t&&t.externalFlag?t.externalFlag:0,vN.renderPassInfo.colorAttachments.forEach((function(t){t.format=i.device.swapchainFormat})),aN.barrier=Hg.gfxDevice.getGeneralBarrier(new Ld(128,128)),this.xc?(this.xc.destroy(),this.xc.initialize(Hg.gfxDevice,vN)):this.xc=i.createWindow(vN)},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.xn=this.Gn=1,this.kf()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},n.readPixels=function(t,i,n,e,r){t=t||0,i=i||0,n=n||this.width,e=e||this.height;var s=this.getGFXTexture();if(!s)return ut(7606),null;var h=4*n*e;if(void 0===r)r=new Uint8Array(h);else if(r.length<h)return ut(7607,h),null;var u=this._getGFXDevice(),o=[],a=[],c=new td;return c.texOffset.x=t,c.texOffset.y=i,c.texExtent.width=n,c.texExtent.height=e,a.push(c),o.push(r),null==u||u.copyTextureToBuffers(s,o,a),r},e(i,[{key:"window",get:function(){return this.xc}}]),i}(zw))||WM);k.RenderTexture=lN;var dN,gN,wN={SKYBOX:14,SOLID_COLOR:7},_N={CUBE:0,PLANAR:1},mN=[nr(0,-90,0),nr(0,90,0),nr(90,0,0),nr(-90,0,0),nr(0,0,0),nr(0,180,0)],pN=nr(),yN=function(){function t(t){this.bakedCubeTextures=[],this.realtimePlanarTexture=null,this._resolution=256,this._clearFlag=14,this._backgroundColor=new cr(0,0,0,255),this._visibility=Lb,this._probeType=0,this._cubemap=null,this._size=nr(1,1,1),this.Tf=null,this.Sf=0,this.Of=!1,this.Rf=!1,this.ds=null,this.If=null,this.Mf=null,this.Nf=nr(),this.Cf=Gr(),this.Nc=nr(),this.Lf=nr(),this._previewSphere=null,this._previewPlane=null,this.Sf=t}var i=t.prototype;return i.initialize=function(t,i){this.ds=t,this.If=i,this.node.getWorldPosition(pN);var n=this._size;this.Mf=wo.create(pN.x,pN.y,pN.z,n.x,n.y,n.z),this.Ff(i)},i.initBakedTextures=function(){if(0===this.bakedCubeTextures.length)for(var t=0;t<6;t++){var i=this.Pf(this._resolution,this._resolution);this.bakedCubeTextures.push(i)}},i.captureCubemap=function(){this.initBakedTextures(),this.Bf(),this.Rf=!0},i.renderPlanarReflection=function(t){if(t){if(!this.realtimePlanarTexture){var i=k.view.getDesignResolutionSize();this.realtimePlanarTexture=this.Pf(i.width,i.height),k.internal.reflectionProbeManager.updatePlanarMap(this,this.realtimePlanarTexture.getGFXTexture())}this.Df(t),this.Uf(t),this.Rf=!0}},i.switchProbeType=function(t,i){0===t?this.Rf=!1:null!==i&&this.renderPlanarReflection(i)},i.getProbeId=function(){return this.Sf},i.updateProbeId=function(t){this.Sf=t},i.renderArea=function(){return 1===this._probeType?new ls(this.realtimePlanarTexture.width,this.realtimePlanarTexture.height):new ls(this.resolution,this.resolution)},i.isFinishedRendering=function(){return!0},i.validate=function(){return null!==this.cubemap},i.destroy=function(){this.Tf&&(this.Tf.destroy(),this.Tf=null);for(var t=0;t<this.bakedCubeTextures.length;t++)this.bakedCubeTextures[t].destroy();this.bakedCubeTextures=[],this.realtimePlanarTexture&&(this.realtimePlanarTexture.destroy(),this.realtimePlanarTexture=null)},i.enable=function(){},i.disable=function(){},i.updateCameraDir=function(t){this.cameraNode.setRotationFromEuler(mN[t]),this.camera.update(!0)},i.updateBoundingBox=function(){if(this.node){this.node.getWorldPosition(pN);var t=this._size;wo.set(this.Mf,pN.x,pN.y,pN.z,t.x,t.y,t.z)}},i.hasFrameBuffer=function(t){if(1===this.probeType){var i;if(!this.realtimePlanarTexture)return!1;if((null==(i=this.realtimePlanarTexture.window)?void 0:i.framebuffer)===t)return!0}else{if(0===this.bakedCubeTextures.length)return!1;for(var n=0;n<this.bakedCubeTextures.length;n++){var e;if((null==(e=this.bakedCubeTextures[n].window)?void 0:e.framebuffer)===t)return!0}}return!1},i.isRGBE=function(){return!0},i.Df=function(t){this.camera.projectionType=t.projectionType,this.camera.orthoHeight=t.orthoHeight,this.camera.nearClip=t.nearClip,this.camera.farClip=t.farClip,this.camera.fov=t.fov,this.camera.clearFlag=t.clearFlag,this.camera.clearColor=t.clearColor,this.camera.priority=t.priority-1,this.camera.resize(t.width,t.height)},i.Ff=function(t){var i=k.director.root;if(!this.Tf){if(this.Tf=i.createCamera(),!this.Tf)return null;this.Tf.initialize({name:t.name,node:t,projection:1,window:i&&i.tempWindow,priority:0,cameraType:-1,trackingType:0})}return this.Tf.setViewportInOrientedSpace(new ps(0,0,1,1)),this.Tf.fovAxis=0,this.Tf.fov=ne(90),this.Tf.orthoHeight=10,this.Tf.nearClip=1,this.Tf.farClip=1e3,this.Tf.clearColor=this._backgroundColor,this.Tf.clearDepth=1,this.Tf.clearStencil=0,this.Tf.clearFlag=this._clearFlag,this.Tf.visibility=this._visibility,this.Tf.aperture=19,this.Tf.shutter=7,this.Tf.iso=0,this.Tf},i.Bf=function(){this.camera.projectionType=1,this.camera.orthoHeight=10,this.camera.nearClip=1,this.camera.farClip=1e3,this.camera.fov=ne(90),this.camera.priority=0,this.camera.resize(this.resolution,this.resolution),this.camera.visibility=this._visibility,this.camera.clearFlag=this._clearFlag,this.camera.clearColor=this._backgroundColor,this.cameraNode.worldPosition=this.node.worldPosition,this.cameraNode.worldRotation=this.node.worldRotation,this.camera.update(!0)},i.Pf=function(t,i){var n=new lN;return n.reset({width:t,height:i}),n},i.Uf=function(t){var i=ir.dot(this.node.worldPosition,this.node.up);this.xf(this.Nf,t.node.worldPosition,this.node.up,i),this.cameraNode.worldPosition=this.Nf,ir.transformQuat(this.Nc,ir.FORWARD,t.node.worldRotation),this.xf(this.Nc,this.Nc,this.node.up,0),this.Nc.normalize(),this.Nc.negative(),ir.transformQuat(this.Lf,ir.UP,t.node.worldRotation),this.xf(this.Lf,this.Lf,this.node.up,0),this.Lf.normalize(),Cr.fromViewUp(this.Cf,this.Nc,this.Lf),this.cameraNode.worldRotation=this.Cf,this.camera.update(!0);var n=new De(this.node.up.x,this.node.up.y,this.node.up.z,-ir.dot(this.node.up,this.node.worldPosition));n.transformMat4(this.camera.matView.clone().invert().transpose()),this.camera.calculateObliqueMat(n)},i.xf=function(t,i,n,e){var r=ir.clone(n);r.normalize();var s=ir.dot(r,i)-e;return r.multiplyScalar(2*s),ir.subtract(t,i,r),t},e(t,[{key:"probeType",get:function(){return this._probeType},set:function(t){this._probeType=t}},{key:"resolution",get:function(){return this._resolution},set:function(t){t!==this._resolution&&this.bakedCubeTextures.forEach((function(i){i.resize(t,t)})),this._resolution=t}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this.camera.clearFlag=this._clearFlag}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this.camera.clearColor=this._backgroundColor}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this.Tf.visibility=this._visibility}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t),this.node.getWorldPosition(pN),wo.set(this.Mf,pN.x,pN.y,pN.z,t.x,t.y,t.z)}},{key:"cubemap",get:function(){return this._cubemap},set:function(t){this._cubemap=t}},{key:"node",get:function(){return this.ds}},{key:"camera",get:function(){return this.Tf}},{key:"needRefresh",get:function(){return this.Of},set:function(t){this.Of=t}},{key:"needRender",get:function(){return this.Rf},set:function(t){this.Rf=t}},{key:"boundingBox",get:function(){return this.Mf}},{key:"cameraNode",get:function(){return this.If},set:function(t){this.If=t}},{key:"previewSphere",get:function(){return this._previewSphere},set:function(t){this._previewSphere=t}},{key:"previewPlane",get:function(){return this._previewPlane},set:function(t){this._previewPlane=t}}]),t}(),bN=function(){function t(){this.Gf=1,this.jf=[]}var i=t.prototype;return i.Hf=function(t){this.jf.splice(0,0,t)},i.Vf=function(t){var i=this.jf.indexOf(t);i>=0&&this.jf.splice(i,1)},i.$f=function(){this.jf.length=0},e(t,[{key:"models",get:function(){return this.jf}}]),t}(),AN=function(){function t(){this.Wf=void 0,this.zf=null,this.Xf=!0,this.Yf=nr(0,0,0),this.Kf=1,this.qf=[],this.Qf=[],this.Zf=!1,this.gu=Hg.gfxDevice}var i=t.prototype;return i.Jf=function(t){this.Wf=t},i.tv=function(){this.Wf=null},i.iv=function(t){if(t.length!==this.Qf.length)this.Zf=!0;else for(var i=t.length,n=0;n<i;n++)if(t[n]!==this.Qf[n]){this.Zf=!0;break}this.Qf=t.slice()},i.nv=function(){return this.Zf},i.ev=function(){this.Zf=!1},i.rv=function(){return this.Qf},i.sv=function(){this.qf.length=0},i.hv=function(t,i){this.qf.splice(t,0,i)},i.ov=function(t,i){this.qf[t]=i},i.av=function(t){this.qf.splice(t,1)},i.cv=function(t){for(var i=this.fv(t),n=-1,e=0;e<this.lodCount;++e)if(i>=this.lodDataArray[e].Gf){n=e;break}return n},i.fv=function(t){return this.zf?(1===t.projectionType&&(i=ir.len(this.localBoundaryCenter.transformMat4(this.zf.worldMatrix).subtract(t.node.worldPosition))),this.vv(t,i,this.lv())):0;var i},i.vv=function(t,i,n){return 1===t.projectionType?n*t.matProj.m05/(2*i):n*t.matProj.m05*.5},i.lv=function(){var t=this.zf.scale;return Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.objectSize},e(t,[{key:"localBoundaryCenter",get:function(){return this.Yf.clone()},set:function(t){this.Yf.set(t)}},{key:"lodCount",get:function(){return this.qf.length}},{key:"objectSize",get:function(){return this.Kf},set:function(t){this.Kf=t}},{key:"lodDataArray",get:function(){return this.qf}}]),t}(),EN=Object.freeze({__proto__:null,Ambient:fy,CSMLevel:Dk,CSMOptimizationMode:Uk,Camera:MM,CameraAperture:pM,CameraFOVAxis:_M,CameraISO:yM,CameraProjection:mM,CameraShutter:bM,CameraType:{DEFAULT:-1,LEFT_EYE:0,RIGHT_EYE:1,MAIN:2},CameraUsage:{EDITOR:0,GAME_VIEW:1,SCENE_VIEW:2,PREVIEW:3,GAME:100},ColorTemperatureToRGB:$M,DirectionalLight:QM,EnvironmentLightingType:Wk,FOG_TYPE_NONE:Kk,Fog:qk,FogType:Yk,LODData:bN,LODGroup:AN,Light:YM,LightType:zM,Model:jM,ModelType:{DEFAULT:0,SKINNING:1,BAKED_SKINNING:2,BATCH_2D:3,PARTICLE_BATCH:4,LINE:5},Octree:HM,PCFType:Bk,PointLight:hN,PostSettings:yO,ProbeClearFlag:wN,ProbeType:_N,RangedDirectionalLight:oN,ReflectionProbe:yN,SKYBOX_FLAG:8,ShadowSize:Fk,ShadowType:Pk,Shadows:Gk,Skin:VM,SkyBoxFlagValue:{VALUE:8},Skybox:zk,SphereLight:ZM,SpotLight:sN,SubModel:CM,ToneMappingType:pO,TrackingType:{NO_TRACKING:0,POSITION_AND_ROTATION:1,POSITION:2,ROTATION:3},nt2lm:XM}),kN=function(){function t(t){this.de="",this.dv=[],this.jf=[],this.gv=[],this.wv=[],this._v=[],this.mv=[],this.pv=[],this.yv=[],this.bv=[],this.Av=null,this.Ev=0,this.kv=null,this.Tv=t}t.registerCreateFunc=function(i){i._createSceneFun=function(i){return new t(i)}};var i=t.prototype;return i.initialize=function(t){return this.de=t.name,this.kv=new SN(this),!0},i.update=function(t){var i=this.Av;i&&i.update();for(var n=this.mv,e=0;e<n.length;e++)n[e].update();for(var r=this.pv,s=0;s<r.length;s++)r[s].update();for(var h=this.yv,u=0;u<h.length;u++)h[u].update();for(var o=this.bv,a=0;a<o.length;a++)o[a].update();for(var c=this.jf,f=0;f<c.length;f++){var v=c[f];v.enabled&&(v.updateTransform(t),v.updateUBOs(t))}this.kv.updateLodState()},i.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeRangedDirLights(),this.removeModels(),this.Sv(),this.kv.clearCache()},i.isCulledByLod=function(t,i){return this.kv.isLodModelCulled(t,i)},i.addCamera=function(t){t.attachToScene(this),this.dv.push(t),this.kv.addCamera(t)},i.removeCamera=function(t){for(var i=0;i<this.dv.length;++i)if(this.dv[i]===t)return this.dv.splice(i,1),t.detachFromScene(),void this.kv.removeCamera(t)},i.removeCameras=function(){var t=this;this.dv.forEach((function(i){i.detachFromScene(),t.kv.removeCamera(i)})),this.dv.length=0},i.setMainLight=function(t){this.Av=t,this.Av&&this.Av.vf()},i.unsetMainLight=function(t){if(this.Av===t){var i=this._v;if(i.length)return this.setMainLight(i[i.length-1]),void(this.Av.node&&(this.Av.node.hasChangedFlags|=2));this.setMainLight(null)}},i.addDirectionalLight=function(t){t.attachToScene(this),this._v.push(t)},i.removeDirectionalLight=function(t){for(var i=0;i<this._v.length;++i)if(this._v[i]===t)return t.detachFromScene(),void this._v.splice(i,1)},i.addSphereLight=function(t){t.attachToScene(this),this.mv.push(t)},i.removeSphereLight=function(t){for(var i=0;i<this.mv.length;++i)if(this.mv[i]===t)return t.detachFromScene(),void this.mv.splice(i,1)},i.addSpotLight=function(t){t.attachToScene(this),this.pv.push(t)},i.removeSpotLight=function(t){for(var i=0;i<this.pv.length;++i)if(this.pv[i]===t)return t.detachFromScene(),void this.pv.splice(i,1)},i.removeSphereLights=function(){for(var t=0;t<this.mv.length;++t)this.mv[t].detachFromScene();this.mv.length=0},i.removeSpotLights=function(){for(var t=0;t<this.pv.length;++t)this.pv[t].detachFromScene();this.pv.length=0},i.addPointLight=function(t){t.attachToScene(this),this.yv.push(t)},i.removePointLight=function(t){for(var i=0;i<this.yv.length;++i)if(this.yv[i]===t)return t.detachFromScene(),void this.yv.splice(i,1)},i.removePointLights=function(){for(var t=0;t<this.yv.length;++t)this.yv[t].detachFromScene();this.yv.length=0},i.addRangedDirLight=function(t){t.attachToScene(this),this.bv.push(t)},i.removeRangedDirLight=function(t){for(var i=0;i<this.bv.length;++i)if(this.bv[i]===t)return t.detachFromScene(),void this.bv.splice(i,1)},i.removeRangedDirLights=function(){for(var t=0;t<this.bv.length;++t)this.bv[t].detachFromScene();this.bv.length=0},i.addModel=function(t){t.attachToScene(this),this.jf.push(t)},i.removeModel=function(t){for(var i=0;i<this.jf.length;++i)if(this.jf[i]===t)return this.kv.removeModel(t),t.detachFromScene(),void this.jf.splice(i,1)},i.removeModels=function(){var t=this;this.jf.forEach((function(i){t.kv.removeModel(i),i.detachFromScene(),i.destroy()})),this.jf.length=0},i.addBatch=function(t){this.wv.push(t)},i.removeBatch=function(t){for(var i=0;i<this.wv.length;++i)if(this.wv[i]===t)return void this.wv.splice(i,1)},i.removeBatches=function(){this.wv.length=0},i.addLODGroup=function(t){this.gv.push(t),t.Jf(this),this.kv.addLodGroup(t)},i.Ov=function(t){var i=this.gv.indexOf(t);i>=0&&(this.gv.splice(i,1),t.tv(),this.kv.removeLodGroup(t))},i.Sv=function(){var t=this;this.gv.forEach((function(i){t.kv.removeLodGroup(i)})),this.gv.length=0},i.onGlobalPipelineStateChanged=function(){this.jf.forEach((function(t){t.onGlobalPipelineStateChanged()}))},i.generateModelId=function(){return this.Ev++},e(t,[{key:"root",get:function(){return this.Tv}},{key:"name",get:function(){return this.de}},{key:"cameras",get:function(){return this.dv}},{key:"mainLight",get:function(){return this.Av}},{key:"sphereLights",get:function(){return this.mv}},{key:"spotLights",get:function(){return this.pv}},{key:"pointLights",get:function(){return this.yv}},{key:"rangedDirLights",get:function(){return this.bv}},{key:"models",get:function(){return this.jf}},{key:"batches",get:function(){return this.wv}},{key:"lodGroups",get:function(){return this.gv}}]),t}(),TN=function(){this.usedLevel=-1,this.lastUsedLevel=-1,this.transformDirty=!0},SN=function(){function t(t){this.Rv=null,this.Iv=new Map,this.Mv=new Map,this.Nv=[],this.Cv=new Map,this.Rv=t}var i=t.prototype;return i.addCamera=function(t){for(var i=this.Rv.lodGroups,n=0;n<i.length;n++){var e=i[n].zf.layer;if((t.visibility&e)===e){this.Mv.has(t)||this.Mv.set(t,new Map);break}}},i.removeCamera=function(t){this.Mv.has(t)&&this.Mv.delete(t)},i.addLodGroup=function(t){this.Nv.push(t);for(var i=this.Rv.cameras,n=0;n<i.length;n++){var e=i[n];if(!this.Mv.has(e)){var r=t.zf.layer;(e.visibility&r)===r&&this.Mv.set(e,new Map)}}},i.removeLodGroup=function(t){for(var i=this,n=0;n<t.lodCount;n++)t.lodDataArray[n].models.forEach((function(t){i.Iv.delete(t)}));for(var e,r=d(this.Mv);!(e=r()).done;)e.value[1].delete(t);this.Cv.delete(t)},i.removeModel=function(t){this.Iv.has(t)&&this.Iv.delete(t)},i.updateLodState=function(){var t=this;this.Nv.forEach((function(i){var n=t.Cv.get(i);n||(n=new Map,t.Cv.set(i,n));for(var e=0;e<i.lodCount;e++){var r=n.get(e);r||(r=[]);for(var s=i.lodDataArray[e].models,h=0;h<s.length;h++){var u=s[h],o=t.Iv.get(u);o||(o=new Map),t.Iv.set(u,o),r.push(u)}n.set(e,r)}})),this.Nv.length=0;for(var i=this.Rv.lodGroups,n=function(){var n=i[e];if(n.Xf){var r=n.rv();if(r.length>0){if(n.zf.hasChangedFlags>0)for(var s,h=d(t.Mv);!(s=h()).done;){var u=s.value,o=u[1].get(n);o||(o=new TN,u[1].set(n,o)),o.transformDirty=!0}if(n.nv()){n.ev();var a=t.Cv.get(n);a&&(a.forEach((function(i){i.forEach((function(i){var n=t.Iv.get(i);n&&n.clear()}))})),r.forEach((function(i){var n=a.get(i);n&&n.forEach((function(i){var n=t.Iv.get(i);if(n&&i.node&&i.node.active)for(var e,r=d(t.Mv);!(e=r()).done;){var s=e.value;n.set(s[0],!0)}}))})))}return 0}for(var c,f=!1,v=d(t.Mv);!(c=v()).done;){var l=c.value,g=l[1].get(n);g||(g=new TN,l[1].set(n,g));var w=l[0].node.hasChangedFlags,_=n.zf.hasChangedFlags;if(w>0||_>0||g.transformDirty){g.transformDirty&&(g.transformDirty=!1);var m=n.cv(l[0]);m!==g.usedLevel&&(g.lastUsedLevel=g.usedLevel,g.usedLevel=m,f=!0)}}var p=t.Cv.get(n);if(!p)return 0;n.nv()?(n.ev(),p.forEach((function(i){i.forEach((function(i){var n=t.Iv.get(i);n&&n.clear()}))})),f=!0):f&&t.Mv.forEach((function(i){var e=i.get(n);if(e&&e.usedLevel!==e.lastUsedLevel){var r=p.get(e.lastUsedLevel);r&&r.forEach((function(i){var n=t.Iv.get(i);n&&n.clear()}))}})),f&&t.Mv.forEach((function(i,e){var r=i.get(n);if(r){var s=r.usedLevel,h=p.get(s);h&&h.forEach((function(i){var n=t.Iv.get(i);n&&i.node&&i.node.active&&n.set(e,!0)}))}}))}},e=0;e<i.length;e++)n()},i.isLodModelCulled=function(t,i){var n=this.Iv.get(i);return!!n&&!n.has(t)},i.clearCache=function(){this.Cv.clear(),this.Iv.clear(),this.Mv.clear(),this.Nv.length=0},i.Lv=function(t,i){var n=t.zf.layer;return(i.visibility&n)===n},t}(),ON=((dN={})[Ui.PORTRAIT]=0,dN[Ui.LANDSCAPE_RIGHT]=1,dN[Ui.PORTRAIT_UPSIDE_DOWN]=2,dN[Ui.LANDSCAPE_LEFT]=3,dN),RN=0,IN=function(){var t=i.prototype;function i(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null,this._device=null,this._renderWindowId=RN++,this._isResized=!0,this._colorName="Color"+this._renderWindowId,this._depthStencilName="DepthStencil"+this._renderWindowId}return t.isRenderWindowResized=function(){return this._isResized},t.setRenderWindowResizeHandled=function(){this._isResized=!1},i.registerCreateFunc=function(t){t._createWindowFun=function(){return new i}},t.initialize=function(t,i){if(void 0!==i.title&&(this._title=i.title),void 0!==i.swapchain&&(this._swapchain=i.swapchain),this._width=i.width,this._height=i.height,this._device=t,this._renderPass=t.createRenderPass(i.renderPassInfo),i.swapchain)this._swapchain=i.swapchain,this._colorTextures.push(i.swapchain.colorTexture),this._depthStencilTexture=i.swapchain.depthStencilTexture;else{for(var n=0;n<i.renderPassInfo.colorAttachments.length;n++){var e=new vd(1,21,i.renderPassInfo.colorAttachments[n].format,this._width,this._height);i.externalFlag&&(8&i.externalFlag||4&i.externalFlag)&&(e.flags|=i.externalFlag,e.externalRes=i.externalResLow?i.externalResLow:0),this._colorTextures.push(t.createTexture(e))}i.renderPassInfo.depthStencilAttachment&&0!==i.renderPassInfo.depthStencilAttachment.format&&(this._depthStencilTexture=t.createTexture(new vd(1,36,i.renderPassInfo.depthStencilAttachment.format,this._width,this._height)),this._hasOffScreenAttachments=!0)}return this._framebuffer=t.createFramebuffer(new Bd(this._renderPass,this._colorTextures,this._depthStencilTexture)),!0},t.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var i=this._colorTextures[t];i&&i.destroy()}this._colorTextures.length=0,this._device=null},t.resize=function(t,i){if(this._swapchain)this._swapchain.resize(t,i,ON[eo.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(t,i);this._depthStencilTexture&&this._depthStencilTexture.resize(t,i),this._width=t,this._height=i}this.framebuffer&&(this.framebuffer.destroy(),this._framebuffer=this._device.createFramebuffer(new Bd(this._renderPass,this._colorTextures,this._depthStencilTexture))),this._cameras.forEach((function(n){n.resize(t,i)})),this._isResized=!0},t.extractRenderCameras=function(t){for(var i=0;i<this._cameras.length;i++){var n=this._cameras[i];n.enabled&&(n.update(),t.push(n))}},t.attachCamera=function(t){for(var i=0;i<this._cameras.length;i++)if(this._cameras[i]===t)return;this._cameras.push(t),this.sortCameras(),this._isResized=!0},t.detachCamera=function(t){for(var i=0;i<this._cameras.length;++i)if(this._cameras[i]===t)return void this._cameras.splice(i,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(t,i){return t.priority-i.priority}))},e(i,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"renderWindowId",get:function(){return this._renderWindowId}},{key:"colorName",get:function(){return this._colorName}},{key:"depthStencilName",get:function(){return this._depthStencilName}}]),i}(),MN=(t("PipelineEventType",{RENDER_FRAME_BEGIN:"render-frame-begin",RENDER_FRAME_END:"render-frame-end",RENDER_CAMERA_BEGIN:"render-camera-begin",RENDER_CAMERA_END:"render-camera-end",ATTACHMENT_SCALE_CAHNGED:"attachment-scale-changed"}),t("PipelineEventProcessor",function(t){function i(){var i;return(i=t.call(this)||this).eventTargetOn=t.prototype.on,i.eventTargetOnce=t.prototype.once,i}s(i,t);var n=i.prototype;return n.on=function(t,i,n,e){return this.eventTargetOn(t,i,n,e)},n.once=function(t,i,n){return this.eventTargetOnce(t,i,n)},i}(Ou))),NN=t("Root",function(){function t(t){var i=this;this._createSceneFun=null,this._createWindowFun=null,this.Fv=[],this.Pv=null,this.Bv=null,this.Dv=null,this.Uv=!0,this.xv=null,this.Gv=new MN,this.jv=null,this.Hv=null,this.Vv=null,this.$v=[],this.Wv=new Map,this.zv=null,this.Xv=new Map,this.Yv=new wM,this.Kv=0,this.qv=0,this.Qv=0,this.Zv=0,this.Jv=!1,this.tl=0,this.il=0,this.nl=[],this.gu=t,this.el=k.internal.DataPoolManager&&new k.internal.DataPoolManager(t),kN.registerCreateFunc(this),IN.registerCreateFunc(this),this.zv=new uu((function(){return new MM(i.gu)}),4,(function(t){return t.destroy()}))}var i=t.prototype;return i.initialize=function(){var t,i=Hg.swapchain,n=new Od;n.format=i.colorTexture.format;var e=new Rd;e.format=i.depthStencilTexture.format,e.depthStoreOp=1,e.stencilStoreOp=1;var r=new Nd([n],e);this.Pv=this.createWindow({title:"rootMainWindow",width:i.width,height:i.height,renderPassInfo:r,swapchain:i}),this.Bv=this.Pv;var s=xi.querySettings("animation","customJointTextureLayouts")||[];null==(t=this.el)||t.jointTexturePool.registerCustomTextureLayouts(s),this.rl()},i.destroy=function(){this.destroyScenes(),this.xv&&(this.xv.destroy(),this.xv=null,this.Gv=null),this.Vv&&(this.Vv.destroy(),this.Vv=null),this.Bv=null,this.Pv=null,this.dataPoolManager.clear(),k.rendering&&k.rendering.destroy()},i.resize=function(t,i){this.Fv.forEach((function(n){n.swapchain&&n.resize(t,i)}))},i.setRenderPipeline=function(t){var i=k.internal,n=k.director,e=k.rendering,r=k.legacy_rendering;if(void 0===e&&void 0===r)return ut(1223),!1;var s=!1;if(t)this.Hv=e.createCustomPipeline(),s=!0,this.xv=this.Hv,z("Using custom pipeline: "+Gi.CUSTOM_PIPELINE_NAME);else{var h=r.createDefaultPipeline();s=!0,z("Using legacy pipeline"),this.jv=h,this.xv=this.jv,this.Gv=this.jv,this.Uv=!1}if((3!==xi.querySettings("rendering","renderMode")||this.jv)&&!this.xv.activate(this.Pv.swapchain))return s&&this.xv.destroy(),this.jv=null,this.Hv=null,this.xv=null,this.Gv=null,!1;var u=n.getScene();return u&&u.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this.Vv&&i.Batcher2D&&(this.Vv=new i.Batcher2D(this),!this.Vv.initialize())&&(this.destroy(),1))},i.onGlobalPipelineStateChanged=function(){for(var t=0;t<this.$v.length;t++)this.$v[t].onGlobalPipelineStateChanged();qp().skybox.enabled&&qp().skybox.model.onGlobalPipelineStateChanged(),this.xv.onGlobalPipelineStateChanged()},i.activeWindow=function(t){this.Bv=t},i.resetCumulativeTime=function(){this.tl=0},i.frameMove=function(t){this.il=t,++this.qv,this.tl+=t,this.Kv+=t,this.Kv>1&&(this.Qv=this.qv,this.qv=0,this.Kv=0),this.sl(),this.hl(),this.ul()},i.createWindow=function(t){var i=this._createWindowFun(this);return i.initialize(this.device,t),this.Fv.push(i),i},i.destroyWindow=function(t){for(var i=0;i<this.Fv.length;++i)if(this.Fv[i]===t)return t.destroy(),void this.Fv.splice(i,1)},i.destroyWindows=function(){this.Fv.forEach((function(t){t.destroy()})),this.Fv.length=0},i.createScene=function(t){var i=this._createSceneFun(this);return i.initialize(t),this.$v.push(i),i},i.destroyScene=function(t){for(var i=0;i<this.$v.length;++i)if(this.$v[i]===t)return t.destroy(),void this.$v.splice(i,1)},i.destroyScenes=function(){this.$v.forEach((function(t){t.destroy()})),this.$v.length=0},i.createModel=function(t){var i=this.Wv.get(t);i||(this.Wv.set(t,new uu((function(){return new t}),10,(function(t){return t.destroy()}))),i=this.Wv.get(t));var n=i.alloc();return n.initialize(),n},i.destroyModel=function(t){var i=this.Wv.get(t.constructor);i?(i.free(t),t.scene&&t.scene.removeModel(t)):st(1300,t.constructor.name),t.destroy()},i.createCamera=function(){return this.zv.alloc()},i.createLight=function(t){var i=this.Xv.get(t);i||(this.Xv.set(t,new uu((function(){return new t}),4,(function(t){return t.destroy()}))),i=this.Xv.get(t));var n=i.alloc();return n.initialize(),n},i.destroyLight=function(t){if(t.scene)switch(t.type){case 0:t.scene.removeDirectionalLight(t);break;case 1:t.scene.removeSphereLight(t);break;case 2:t.scene.removeSpotLight(t);break;case 3:t.scene.removePointLight(t);break;case 4:t.scene.removeRangedDirLight(t)}t.destroy()},i.recycleLight=function(t){var i=this.Xv.get(t.constructor);if(i&&(i.free(t),t.scene))switch(t.type){case 0:t.scene.removeDirectionalLight(t);break;case 1:t.scene.removeSphereLight(t);break;case 2:t.scene.removeSpotLight(t);break;case 3:t.scene.removePointLight(t);break;case 4:t.scene.removeRangedDirLight(t)}},i.ol=function(){},i.sl=function(){for(var t=0;t<this.$v.length;++t)this.$v[t].removeBatches();this.nl.length=0},i.hl=function(){for(var t=k.director,i=this.Fv,n=this.nl,e=0;e<i.length;e++)i[e].extractRenderCameras(n);if(this.xv&&n.length>0){this.gu.acquire([Hg.swapchain]);var r=this.$v,s=t.getTotalFrames();this.Vv&&(this.Vv.update(),this.Vv.uploadBuffers());for(var h=0;h<r.length;h++)r[h].update(s)}},i.ul=function(){var t=k.director,i=k.Director,n=this.nl;if(this.xv&&n.length>0){t.emit(i.EVENT_BEFORE_COMMIT),n.sort((function(t,i){return t.priority-i.priority}));for(var e=0;e<n.length;++e){var r;null==(r=n[e].geometryRenderer)||r.update()}t.emit(i.EVENT_BEFORE_RENDER),this.xv.render(n),t.emit(i.EVENT_AFTER_RENDER),this.gu.present()}this.Vv&&this.Vv.reset()},i.rl=function(){var t=Math.max((288+By.COUNT)/4,100),i=Math.floor((Hg.gfxDevice.capabilities.maxVertexUniformVectors-t)/3);zy(i=i<256?i:256)},e(t,[{key:"device",get:function(){return this.gu}},{key:"mainWindow",get:function(){return this.Pv}},{key:"curWindow",get:function(){return this.Bv},set:function(t){this.Bv=t}},{key:"tempWindow",get:function(){return this.Dv},set:function(t){this.Dv=t}},{key:"windows",get:function(){return this.Fv}},{key:"usesCustomPipeline",get:function(){return this.Uv}},{key:"pipeline",get:function(){return this.xv}},{key:"customPipeline",get:function(){return this.Hv}},{key:"pipelineEvent",get:function(){return this.Gv}},{key:"batcher2D",get:function(){return this.Vv}},{key:"scenes",get:function(){return this.$v}},{key:"debugView",get:function(){return this.Yv}},{key:"cumulativeTime",get:function(){return this.tl}},{key:"frameTime",get:function(){return this.il}},{key:"frameCount",get:function(){return this.qv}},{key:"fps",get:function(){return this.Qv}},{key:"fixedFPS",get:function(){return this.Zv},set:function(t){t>0&&(this.Zv=t)}},{key:"dataPoolManager",get:function(){return this.el}},{key:"useDeferredPipeline",get:function(){return this.Jv}},{key:"cameraList",get:function(){return this.nl}}]),t}());k.Root=NN,Un.Attr.setClassAttr(d_,"target","type","Object"),Un.Attr.setClassAttr(d_,"target","ctor",Xp),dt(Xp.prototype,"Node",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),dt(Xp.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this.Zs().width},customSetter:function(t){this.Zs().width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this.Zs().height},customSetter:function(t){this.Zs().height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this.Zs().anchorX},customSetter:function(t){this.Zs().anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this.Zs().anchorY},customSetter:function(t){this.Zs().anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new ls),t.set(this.Zs().anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,i){this.Zs().setAnchorPoint(t,i)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new gs),t.set(this.Zs().contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,i){"number"==typeof t?this.Zs().setContentSize(t,i):this.Zs().setContentSize(t)}}]),gt(JR.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),dt(JR.prototype,"SceneGlobals.prototype",[{name:"distance",newName:"planeHeight"},{name:"normal",newName:"planeDirection"},{name:"size",newName:"shadowMapSize"}]),gt(Xp.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),dt(Bm.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),gt(Pm,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),dt(Pm,"Layers",[{name:"Default",newName:"DEFAULT",target:Pm.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Pm.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Pm.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Pm.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Pm.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Pm.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Pm.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Pm.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Pm,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Pm,targetName:"Layers"}]),gt(Pm.Enum,"Layers.Enum",[{name:"ALWAYS"}]),gt(Pm.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var CN=t("PrivateNode",Ko("cc.PrivateNode")(gN=function(t){function i(i){var n;return st(12003,(n=t.call(this,i)||this).name),n.hideFlags|=1032,n}return s(i,t),i}(Xp))||gN);function LN(t,i){if(!i){var n=T.director.getScene();if(!n)return null;i=n}return i.getChildByPath(t)}dt(Qm,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((function(t){return{name:t,target:Xp.EventType,targetName:"Node.EventType"}}))),dt(Xp.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:dM.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:dM.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:dM.EventType,targetName:"SystemEvent.EventType"}]),T.PrivateNode=CN,St({BaseNode:{newName:"Node",since:"3.7.0",removed:!1}}),T.find=LN;var FN=pi,PN=65536,BN=2048;function DN(t,i){for(var n=i.constructor._executionOrder,e=i._id,r=0,s=t.length-1,h=s>>>1;r<=s;h=r+s>>>1){var u=t[h],o=u.constructor._executionOrder;if(o>n)s=h-1;else if(o<n)r=h+1;else{var a=u._id;if(a>e)s=h-1;else{if(!(a<e))return h;r=h+1}}}return~r}function UN(t,i){for(var n=t.array,e=t.i+1;e<n.length;){var r=n[e];r.node._activeInHierarchy?++e:(t.removeAt(e),i&&(r._objFlags&=~i))}}var xN=function(){function t(t){var i=_i;this._zero=new i([]),this._neg=new i([]),this._pos=new i([]),this._invoke=t}return e(t,[{key:"zero",get:function(){return this._zero}},{key:"neg",get:function(){return this._neg}},{key:"pos",get:function(){return this._pos}}]),t}();function GN(t,i){return t.constructor._executionOrder-i.constructor._executionOrder}xN.stableRemoveInactive=UN;var jN=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.add=function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){UN(this._zero,t),UN(this._neg,t),UN(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(GN),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var i=this._pos;i.array.length>0&&(i.array.sort(GN),this._invoke(i),i.array.length=0)},i}(xN),HN=function(t){function i(i){return t.call(this,i)||this}s(i,t);var n=i.prototype;return n.add=function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.array.push(t);else{var n=i<0?this._neg.array:this._pos.array,e=DN(n,t);e<0&&n.splice(~e,0,t)}},n.remove=function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.fastRemove(t);else{var n=i<0?this._neg:this._pos,e=DN(n.array,t);e>=0&&n.removeAt(e)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},i}(xN);function VN(t,i,n){var e="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",r=i?Function("it","dt",e):Function("it",e);return $N(Function("c","dt",t),r,n)}function $N(t,i,n){return function(e,r){try{i(e,r)}catch(i){T._throw(i);var s=e.array;for(n&&(s[e.i]._objFlags|=n),++e.i;e.i<s.length;++e.i)try{t(s[e.i],r)}catch(t){T._throw(t),n&&(s[e.i]._objFlags|=n)}}}}var WN=VN("c.start();c._objFlags|="+PN,!1,PN),zN=VN("c.update(dt)",!0),XN=VN("c.lateUpdate(dt)",!0),YN=function(t){var i=T.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var e=n[t.i];e._enabled&&(e.onEnable(),!e.node._activeInHierarchy||i._onEnabled(e))}},KN=function(){function t(){this.al=[],this.unscheduleAll()}var i=t.prototype;return i.unscheduleAll=function(){this.startInvoker=new jN(WN),this.updateInvoker=new HN(zN),this.lateUpdateInvoker=new HN(XN),this.cl=!1},i._onEnabled=function(t){T.director.getScheduler().resumeTarget(t),t._objFlags|=BN,this.cl?this.al.push(t):this.fl(t)},i._onDisabled=function(t){T.director.getScheduler().pauseTarget(t),t._objFlags&=-2049;var i=this.al.indexOf(t);i>=0?FN(this.al,i):(!t.internalStart||t._objFlags&PN||this.startInvoker.remove(t),t.internalUpdate&&this.updateInvoker.remove(t),t.internalLateUpdate&&this.lateUpdateInvoker.remove(t))},i.enableComp=function(t,i){if(!(t._objFlags&BN)){if(t.internalOnEnable){if(i)return void i.add(t);if(t.internalOnEnable(),!t.node.activeInHierarchy)return}this._onEnabled(t)}},i.disableComp=function(t){t._objFlags&BN&&(t.internalOnDisable&&t.internalOnDisable(),this._onDisabled(t))},i.startPhase=function(){this.cl=!0,this.startInvoker.invoke(),this.vl()},i.updatePhase=function(t){this.updateInvoker.invoke(t)},i.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this.cl=!1,this.vl()},i.vl=function(){this.al.length>0&&(this.ll(),this.startInvoker.invoke())},i.fl=function(t){"function"!=typeof t.internalStart||t._objFlags&PN||this.startInvoker.add(t),"function"==typeof t.internalUpdate&&this.updateInvoker.add(t),"function"==typeof t.internalLateUpdate&&this.lateUpdateInvoker.add(t)},i.ll=function(){for(var t=this.al,i=0,n=t.length;i<n;i++)this.fl(t[i]);t.length=0},t}(),qN=8192,QN=32768,ZN=16384,JN=function(t){function i(i){return t.call(this,i)||this}s(i,t);var n=i.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){xN.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},i}(xN),tC=VN("c.__preload();"),iC=VN("c.onLoad();c._objFlags|="+ZN,!1,ZN),nC=new wi(4);function eC(t,i,n){ut(3817,t.name,n),z("Corrupted component value:",i),i?t._removeComponent(i):mi(t.ah(),n)}nC.get=function(){var t=this._get()||{preload:new JN(tC),onLoad:new jN(iC),onEnable:new jN(YN)};t.preload.zero.i=-1;var i=t.onLoad;return i.zero.i=-1,i.neg.i=-1,i.pos.i=-1,(i=t.onEnable).zero.i=-1,i.neg.i=-1,i.pos.i=-1,t};var rC=t("NodeActivator",function(){function t(){this.reset()}var i=t.prototype;return i.reset=function(){this._activatingStack=[]},i.activateNode=function(t,i){if(i){var n=nC.get();n&&(this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),nC.put(n))}else{this._deactivateNodeRecursively(t);for(var e,r=d(this._activatingStack);!(e=r()).done;){var s=e.value;s.preload.cancelInactive(qN),s.onLoad.cancelInactive(QN),s.onEnable.cancelInactive(2048)}}t.emit("active-in-hierarchy-changed",t)},i.activateComp=function(t,i,n,e){if(mu(t,!0)&&(t._objFlags&qN||(t._objFlags|=qN,t.internalPreload&&(i?i.add(t):t.internalPreload())),t._objFlags&QN||(t._objFlags|=QN,t.internalOnLoad?n?n.add(t):(t.internalOnLoad(),t._objFlags|=ZN):t._objFlags|=ZN),t._enabled)){if(!t.node.activeInHierarchy)return;T.director._compScheduler.enableComp(t,e)}},i.destroyComp=function(t){T.director._compScheduler.disableComp(t),t.internalOnDestroy&&t._objFlags&ZN&&t.internalOnDestroy()},i._activateNodeRecursively=function(t,i,n,e){if(256&t._objFlags)ut(3816,t.name);else{t.rh(!0);for(var r=t.components.length,s=0;s<r;++s){var h=t.components[s];h instanceof T.Component?this.activateComp(h,i,n,e):(eC(t,h,s),--s,--r)}for(var u=0,o=t.children.length;u<o;++u){var a=t.children[u];a.active&&this._activateNodeRecursively(a,i,n,e)}t._onPostActivated(!0)}},i._deactivateNodeRecursively=function(t){t._objFlags|=256,t.rh(!1);for(var i=t.components.length,n=0;n<i;++n){var e=t.components[n];if(e._enabled&&(T.director._compScheduler.disableComp(e),t.activeInHierarchy))return void(t._objFlags&=-257)}for(var r=0,s=t.children.length;r<s;++r){var h=t.children[r];if(h.activeInHierarchy&&(this._deactivateNodeRecursively(h),t.activeInHierarchy))return void(t._objFlags&=-257)}t._onPostActivated(!1),t._objFlags&=-257},t}()),sC=Un.Attr.DELIMETER+"default",hC=Un.IDENTIFIER_RE,uC="var ",oC="o",aC={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},cC=Un.escapeForJS,fC=function(){function t(t,i){this.varName=t,this.expression=i}return t.prototype.toString=function(){return uC+this.varName+"="+this.expression+";"},t}();function vC(t,i){return i instanceof fC?new fC(i.varName,t+i.expression):t+i}function lC(t,i,n){Array.isArray(n)?(n[0]=vC(i,n[0]),t.push(n)):t.push(vC(i,n)+";")}var dC=function(){function t(t){this.dl=[],this.wl=t}var i=t.prototype;return i.setTargetExp=function(t){this.wl=t},i.append=function(t,i){this.dl.push([t,i])},i.writeCode=function(t){var i;if(this.dl.length>1)t.push("t="+this.wl+";"),i="t";else{if(1!==this.dl.length)return;i=this.wl}for(var n=0;n<this.dl.length;n++){var e=this.dl[n];lC(t,i+gC(e[0])+"=",e[1])}},t}();function gC(t){return hC.test(t)?"."+t:"["+cC(t)+"]"}dC.pool=new wi((function(t){t.dl.length=0,t.wl=null}),1),dC.pool.get=function(t){var i=this._get()||new dC;return i.setTargetExp(t),i};var wC,_C,mC,pC,yC,bC,AC=function(){function t(t,i){var n;this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.parent=i,this.funcModuleCache=jt(),Zt(this.funcModuleCache,aC),this.codeArray.push(uC+oC+",t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=uC+this.globalVariables.join(",")+";");var e=qv(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",e)(this.objs,this.funcs);for(var r=0,s=this.objsToClear_iN$t.length;r<s;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var i=t.prototype;return i.getFuncModule=function(t,i){var n=Ht(t);if(n){var e=this.funcModuleCache[n];if(e)return e;if(void 0===e){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var h="F["+s+"]";return i&&(h="("+h+")"),this.funcModuleCache[n]=h,h},i.getObjRef=function(t){var i=this.objs.indexOf(t);return i<0&&(i=this.objs.length,this.objs.push(t)),"O["+i+"]"},i.setValueType=function(t,i,n,e){var r=dC.pool.get(e),s=i.constructor.__props__;s||(s=Object.keys(i));for(var h=0;h<s.length;h++){var u=s[h],o=n[u];if(i[u]!==o){var a=this.enumerateField(n,u,o);r.append(u,a)}}r.writeCode(t),dC.pool.put(r)},i.enumerateCCClass=function(t,i,n){for(var e=n.__values__,r=Un.Attr.getClassAttrs(n),s=0;s<e.length;s++){var h=e[s],u=i[h],o=r[h+sC];if(!EC(o,u))if("object"==typeof u&&u instanceof k.ValueType&&(o=Un.getDefault(o))&&o.constructor===u.constructor){var a=oC+gC(h);this.setValueType(t,o,u,a)}else this.setObjProp(t,i,h,u)}},i.instantiateArray=function(t){if(0===t.length)return"[]";var i="a"+ ++this.localVariableId,n=[new fC(i,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var e=0;e<t.length;++e)lC(n,i+"["+e+"]=",this.enumerateField(t,e,t[e]));return n},i.instantiateTypedArray=function(t){var i=t.constructor.name;if(0===t.length)return"new "+i;var n="a"+ ++this.localVariableId,e=[new fC(n,"new "+i+"("+t.length+")")];t._iN$t={globalVar:"",source:e},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&lC(e,n+"["+r+"]=",t[r]);return e},i.enumerateField=function(t,i,n){if("object"==typeof n&&n){var e=n._iN$t;if(e){var r=e.globalVar;if(!r){r=e.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var s=e.source[0];e.source[0]=vC(r+"=",s)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?cC(n):("_objFlags"===i&&_u(t)&&(n&=-4192741),n)},i.setObjProp=function(t,i,n,e){lC(t,oC+gC(n)+"=",this.enumerateField(i,n,e))},i.enumerateObject=function(t,i){var n=i.constructor;if(xn(n))this.enumerateCCClass(t,i,n);else for(var e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&(95!==e.charCodeAt(0)||95!==e.charCodeAt(1)||"__type__"===e)){var r=i[e];"object"==typeof r&&r&&r===i._iN$t||this.setObjProp(t,i,e,r)}},i.instantiateObj=function(t){if(t instanceof k.ValueType)return Un.getNewValueTypeCode(t);if(t instanceof k.Asset)return this.getObjRef(t);if(1&t._objFlags)return null;var i,n=t.constructor;if(xn(n)){if(this.parent)if(this.parent instanceof k.Component){if(t instanceof k.Node||t instanceof k.Component)return this.getObjRef(t)}else if(this.parent instanceof k.Node)if(t instanceof k.Node){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof k.Component){var e;if(null==(e=t.node)||!e.isChildOf(this.parent))return this.getObjRef(t)}i=new fC(oC,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)i=new fC(oC,"{}");else{if(n)return this.getObjRef(t);i=new fC(oC,"Object.create(null)")}var r=[i];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function EC(t,i){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===i)return!0;if(t&&i&&"object"==typeof t&&"object"==typeof i&&t.constructor===i.constructor)if(t instanceof k.ValueType){if(t.equals(i))return!0}else{if(Array.isArray(t))return 0===t.length&&0===i.length;if(t.constructor===Object)return Pt(t)&&Pt(i)}return!1}var kC=Ni({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),TC=t("Prefab",Ko("cc.Prefab")((bC=function(t){function i(){var i;return(i=t.call(this)||this).data=mC&&mC(),i.optimizationPolicy=pC&&pC(),i.persistent=yC&&yC(),i._l=null,i.ml=0,i}s(i,t);var n=i.prototype;return n.createNode=function(t){var i=T.instantiate(this);i.name=this.name,t(null,i)},n.compileCreateFunction=function(){var t,i;this._l=(i=(t=this.data)instanceof k.Node&&t,new AC(t,i).result)},n._doInstantiate=function(t){return this.data._prefab||st(3700),this._l||this.compileCreateFunction(),this._l(t)},n._instantiate=function(){var t;return this.optimizationPolicy!==kC.SINGLE_INSTANCE&&(this.optimizationPolicy===kC.MULTI_INSTANCE||this.ml+1>=i.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this.ml,t},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.data=new Xp,this.data.name="(Missing Node)";var n=new T._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;_I(t),gI(t)},i}(kw),bC.OptimizationPolicy=kC,bC.OptimizationPolicyThreshold=3,mC=xo((_C=bC).prototype,"data",[oa],(function(){return null})),pC=xo(_C.prototype,"optimizationPolicy",[oa],(function(){return kC.AUTO})),yC=xo(_C.prototype,"persistent",[oa],(function(){return!1})),wC=_C))||wC);Dt(TC,"_utils",TI),T.Prefab=TC,Vt(T,"cc._Prefab","Prefab");var SC=function(){function t(){this.pl=[],this.yl=[],this.bl=0}var i=t.prototype;return i.Al=function(t){-1===t._internalId&&(t._internalId=this.pl.length,this.pl.push(t))},i.El=function(t){if(-1!==t._internalId){var i=t._internalId;this.pl[this.pl.length-1]._internalId=i,pi(this.pl,i),t._internalId=-1,t._dirtyVersion===this.bl&&(bi(this.yl,t),t._dirtyVersion=-1)}},i.kl=function(t){t._dirtyVersion!==this.bl&&-1!==t._internalId&&(this.yl.push(t),t._dirtyVersion=this.bl)},i.Tl=function(){for(var t=this.yl,i=0;i<this.yl.length;i++)t[i].updateRenderer();this.yl.length=0,this.bl++},t}(),OC=new SC,RC=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],IC=[".mp3",".ogg",".wav",".m4a"];function MC(){return!0}var NC={transformURL:function(t){var i=cw(t);if(!i)return t;var n=Qg.find((function(t){return!!t.getAssetInfo(i)}));if(!n)return t;var e,r=n.getAssetInfo(i);if(!(e=t.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==t.indexOf(e))return t;var s=!1;if(".ttf"===ju(t)&&(s=!0),s){var h=$u(t),u=Vu(t);t=h+"."+e+"/"+u}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(function(t){return t+"."+e}));return t}},CC=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this.Sl=KA}var i=t.prototype;return i.load=function(t,i,n){void 0===n&&void 0!==i&&(n=i,i=null);for(var e=Array.isArray(t)?t:[t],r=0;r<e.length;r++){var s=e[r];"string"==typeof s?e[r]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var h=[],u=[];ek.loadAny(e,null,(function(t,n,e){e.content&&(RC.includes(e.ext)?h.push(e.content):IC.includes(e.ext)&&u.push(e.content)),i&&i(t,n,e)}),(function(t,i){var r=null;if(!t){i=Array.isArray(i)?i:[i];for(var s=function(t){var n=i[t];if(!(n instanceof kw)){var r=n,s=e[t].url;h.includes(r)?PE.create(s,n,".png",{},(function(n,e){r=i[t]=e})):u.includes(r)&&PE.create(s,n,".mp3",{},(function(n,e){r=i[t]=e})),Yg.add(s,r)}},o=0;o<i.length;o++)s(o);if(i.length>1){var a=Object.create(null);i.forEach((function(t){a[t._uuid]=t})),r={isCompleted:MC,_map:a}}else r=i[0]}n&&n(t,r)}))},i.getXMLHttpRequest=function(){return new XMLHttpRequest},i.getItem=function(t){return ek.assets.has(t)?{content:ek.assets.get(t)}:null},i.loadRes=function(t,i,n,e){var r=this.Sl(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete,o=ju(t);o&&!JA.getInfoWithPath(t,s)&&(t=t.slice(0,-o.length)),JA.load(t,s,h,u)},i.loadResArray=function(t,i,n,e){var r=this.Sl(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete;t.forEach((function(i,n){var e=ju(i);e&&!JA.getInfoWithPath(i,s)&&(t[n]=i.slice(0,-e.length))})),JA.load(t,s,h,u)},i.loadResDir=function(t,i,n,e){var r=this.Sl(i,n,e),s=r.type,h=r.onProgress,u=r.onComplete;JA.loadDir(t,s,h,(function(i,n){var e=[];i||(e=JA.getDirWithPath(t,s).map((function(t){return t.path}))),u&&u(i,n,e)}))},i.getRes=function(t,i){return Yg.has(t)?Yg.get(t):JA.get(t,i)},i.getResCount=function(){return Yg.count},i.getDependsRecursively=function(t){if(!t)return[];var i="string"==typeof t?t:t._uuid;return pm.getDepsRecursively(i).concat([i])},i.addDownloadHandlers=function(t){var i=Object.create(null),n=function(){var n=t[e];i["."+e]=function(t,i,e){n({url:t},e)}};for(var e in t)n();AE.register(i)},i.addLoadHandlers=function(t){var i=Object.create(null),n=function(){var n=t[e];i["."+e]=function(t,i,e){n({content:t},e)}};for(var e in t)n();VE.register(i)},i.release=function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var n=t[i];"string"==typeof n&&(n=Yg.get(n)),ek.releaseAsset(n)}else t&&("string"==typeof t&&(t=Yg.get(t)),ek.releaseAsset(t))},i.releaseAsset=function(t){ek.releaseAsset(t)},i.releaseRes=function(t,i){JA.release(t,i)},i.releaseAll=function(){ek.releaseAll(),Yg.clear()},i.removeItem=function(t){return!!Yg.remove(t)},i.setAutoRelease=function(t,i){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!i},i.setAutoReleaseRecursively=function(t,i){"object"==typeof t&&(t=t._uuid),i=!!i,this._autoReleaseSetting[t]=i;for(var n=pm.getDepsRecursively(t),e=0;e<n.length;e++)this._autoReleaseSetting[n[e]]=i},i.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},e(t,[{key:"onProgress",set:function(t){xA=t}},{key:"_cache",get:function(){if(Yg instanceof zg)return Yg.map;var t={};return Yg.forEach((function(i,n){t[n]=i})),t}},{key:"md5Pipe",get:function(){return NC}},{key:"downloader",get:function(){return AE}},{key:"loader",get:function(){return ek.parser}}]),t}()),LC=t("loader",new CC),FC=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,ek.init(t),t.rawAssets&&JA.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:"resources",importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets),extensionMap:{}})},loadAsset:function(t,i){ek.loadAny(t,i)}}),PC=t("url",{});dt(PC,"url",[{name:"normalize",target:ek.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?dw({path:Wu(t.substring(10)),bundle:"resources",__isNative__:!0,ext:ju(t)}):""}}]),gt(FC,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),gt(LC,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"loader.assetLoader was removed, assetLoader and md5Pipe were merged into assetManager.transformPipeline"}]),dt(k,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return LC}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return FC}},{name:"Pipeline",target:nk,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return PC}}]),gt(k,"cc",[{name:"LoadingItems",suggest:ft(1400,"LoadingItems","AssetManager.Task")}]),dt(Gi,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:AE,targetName:"assetManager.downloader",newName:"maxConcurrency"}]);var BC=UA._autoRelease;UA._autoRelease=function(t,i,n){BC.call(UA,t,i,n);for(var e=LC._autoReleaseSetting,r=Object.keys(e),s=0;s<r.length;s++){var h=r[s];if(!0===e[h]){var u=Yg.get(h);u&&UA.tryRelease(u)}}};var DC=t("DirectorEvent",{INIT:"director_init",RESET:"director_reset",BEFORE_SCENE_LOADING:"director_before_scene_loading",BEFORE_SCENE_LAUNCH:"director_before_scene_launch",AFTER_SCENE_LAUNCH:"director_after_scene_launch",BEFORE_UPDATE:"director_before_update",AFTER_UPDATE:"director_after_update",BEFORE_DRAW:"director_before_draw",AFTER_DRAW:"director_after_draw",BEFORE_COMMIT:"director_before_commit",BEFORE_RENDER:"director_before_render",AFTER_RENDER:"director_after_render",BEFORE_PHYSICS:"director_before_physics",AFTER_PHYSICS:"director_after_physics",BEGIN_FRAME:"director_begin_frame",END_FRAME:"director_end_frame"}),UC=t("Director",function(t){function i(){var i;return(i=t.call(this)||this)._compScheduler=new KN,i._nodeActivator=new rC,i.Ol=!1,i.Rl=!1,i.Tv=null,i.Il="",i.ac=null,i.Ml=0,i.wi=new jv,i.Nl=[],i.Cl={},i}s(i,t);var n=i.prototype;return n.end=function(){var t=this;this.once("director_end_frame",(function(){t.purgeDirector()}))},n.pause=function(){this.Rl=!0},n.purgeDirector=function(){this.wi.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),mu(this.ac)&&this.ac.destroy(),this.ac=null,this.stopAnimation(),ek.releaseAll()},n.reset=function(){for(var t in this.purgeDirector(),this.Cl)this.removePersistRootNode(this.Cl[t]);var i=this.getScene();i&&i.destroy(),this.emit("director_reset"),this.startAnimation()},n.runSceneImmediate=function(t,i,n){var e=this;t instanceof OI&&(t=t.scene),at(t instanceof SI,1216),t.xu();for(var r=Object.keys(this.Cl).map((function(t){return e.Cl[t]})),s=0;s<r.length;s++){var h=r[s];h.emit("scene-changed-for-persists",t.renderScene);var u=t.uuid===h._originalSceneId&&t.getChildByUuid(h.uuid);if(u){var o=u.siblingIndex;h.hideFlags&=-9,h.hideFlags|=8&u.hideFlags,u._destroyImmediate(),t.insertChild(h,o)}else h.hideFlags|=8,h.parent=t}var a=this.ac;mu(a)&&a.destroy(),UA._autoRelease(a,t,this.Cl),this.ac=null,du._deferredDestroy(),i&&i(),this.emit("director_before_scene_launch",t),this.ac=t,t.Gu(),this.Tv&&this.Tv.resetCumulativeTime(),this.startAnimation(),n&&n(null,t),this.emit("director_after_scene_launch",t)},n.runScene=function(t,i,n){var e=this;t instanceof OI&&(t=t.scene),at(Boolean(t),1205),at(t instanceof SI,1216),this.once("director_end_frame",(function(){e.runSceneImmediate(t,i,n)}))},n.loadScene=function(t,i,n){var e=this;if(this.Il)return st(1208,t,this.Il),!1;var r=ek.bundles.find((function(i){return!!i.getSceneInfo(t)}));return r?(this.emit("director_before_scene_loading",t),this.Il=t,console.time("LoadScene "+t),r.loadScene(t,(function(r,s){console.timeEnd("LoadScene "+t),e.Il="",r?(Y(r),i&&i(r)):e.runSceneImmediate(s,n,i)})),!0):(ut(1209,t),!1)},n.preloadScene=function(t,i,n){var e=ek.bundles.find((function(i){return!!i.getSceneInfo(t)}));if(e)e.preloadScene(t,null,i,n);else{var r='Can not preload the scene "'+t+'" because it is not in the build settings.';n&&n(new Error(r)),Y("preloadScene: "+r)}},n.resume=function(){this.Rl=!1},n.getScene=function(){return this.ac},n.getDeltaTime=function(){return k.game.deltaTime},n.getTotalTime=function(){return k.game.totalTime},n.getCurrentTime=function(){return k.game.frameStartTime},n.getTotalFrames=function(){return this.Ml},n.isPaused=function(){return this.Rl},n.getScheduler=function(){return this.wi},n.setScheduler=function(t){this.wi!==t&&(this.unregisterSystem(this.wi),this.wi=t,this.registerSystem(jv.ID,t,200))},n.registerSystem=function(t,i,n){i.id=t,i.priority=n,this.Nl.push(i),this.Nl.sort(Pv.sortByPriority)},n.unregisterSystem=function(t){bi(this.Nl,t),this.Nl.sort(Pv.sortByPriority)},n.getSystem=function(t){return this.Nl.find((function(i){return i.id===t}))},n.getAnimationManager=function(){return this.getSystem(k.AnimationManager.ID)},n.startAnimation=function(){this.Ol=!1},n.stopAnimation=function(){this.Ol=!0},n.mainLoop=function(){var t;t=k.game._calculateDT(!1),this.tick(t)},n.tick=function(t){if(!this.Ol){if(this.emit("director_begin_frame"),lM._frameDispatchEvents(),!this.Rl){this.emit("director_before_update"),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var i=0;i<this.Nl.length;++i)this.Nl[i].update(t);this._compScheduler.lateUpdatePhase(t),this.emit("director_after_update"),du._deferredDestroy();for(var n=0;n<this.Nl.length;++n)this.Nl[n].postUpdate(t)}this.emit("director_before_draw"),OC.Tl(),this.Tv.frameMove(t),this.emit("director_after_draw"),Xp.resetHasChangedFlags(),Xp.clearNodeArray(),hu.update(t),this.emit("director_end_frame"),this.Ml++}},n.buildRenderPipeline=function(){if(this.Tv){var t=this.Tv.customPipeline,i=this.Tv.cameraList;t.beginSetup();var n=k.rendering.getCustomPipeline(Gi.CUSTOM_PIPELINE_NAME);k.rendering.dispatchResizeEvents(i,n,t),n.setup(i,t),t.endSetup()}},n.Ll=function(){""!==Gi.CUSTOM_PIPELINE_NAME&&k.rendering&&this.Tv&&this.Tv.usesCustomPipeline&&this.on("director_before_scene_launch",k.rendering.forceResizeAllWindows,k.rendering)},n.init=function(){this.Ml=0,this.Rl=!1,this.registerSystem(jv.ID,this.wi,200),this.Tv=new NN(Hg.gfxDevice),this.Tv.initialize({}),this.Ll();for(var t=0;t<this.Nl.length;t++)this.Nl[t].init();this.emit("director_init")},n.addPersistRootNode=function(t){if(Xp.isNode(t)&&t.uuid){var i=t.uuid;if(!this.Cl[i]){var n=this.ac;if(mu(n))if(t.parent){if(!(t.parent instanceof SI))return void st(3801);if(t.parent!==n)return void st(3802);t._originalSceneId=n.uuid}else t.parent=n,t._originalSceneId=n.uuid;this.Cl[i]=t,t._persistNode=!0,UA._addPersistNodeRef(t)}}else st(3800)},n.removePersistRootNode=function(t){var i=t.uuid||"";t===this.Cl[i]&&(delete this.Cl[i],t._persistNode=!1,t._originalSceneId="",UA._removePersistNodeRef(t))},n.isPersistRootNode=function(t){return!!t._persistNode},e(i,[{key:"root",get:function(){return this.Tv}}]),i}(Ou));UC.EVENT_INIT="director_init",UC.EVENT_RESET="director_reset",UC.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",UC.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",UC.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",UC.EVENT_BEFORE_UPDATE="director_before_update",UC.EVENT_AFTER_UPDATE="director_after_update",UC.EVENT_BEFORE_DRAW="director_before_draw",UC.EVENT_AFTER_DRAW="director_after_draw",UC.EVENT_BEFORE_COMMIT="director_before_commit",UC.EVENT_BEFORE_RENDER="director_before_render",UC.EVENT_AFTER_RENDER="director_after_render",UC.EVENT_BEFORE_PHYSICS="director_before_physics",UC.EVENT_AFTER_PHYSICS="director_after_physics",UC.EVENT_BEGIN_FRAME="director_begin_frame",UC.EVENT_END_FRAME="director_end_frame",UC.instance=void 0,k.Director=UC,k.DirectorEvent=DC;var xC=t("director",UC.instance=k.director=new UC);var GC,jC=function(){function t(){var t=this;this.Fl=0,this.Pl=null,this.Bl=60,this.il=0,this.Dl=0,this.Ul=!1,this.qv=0,this.Ti=null,this.xl=void 0,this.Gl=void 0,this._handleRAF=function(){var i=performance.now(),n=i-t.Dl,e=Math.floor(n/t.il);e<0&&(t.Dl=i,t.qv=0),e<t.qv?t.Fl=t.xl.call(window,t._handleRAF):(t.qv=e+1,t.Ti&&t.Ti())},this.il=1e3/this.Bl,this.xl=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,this.Gl=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame}var i=t.prototype;return i.start=function(){var t=this;if(!this.Ul){var i=void 0===this.xl||A;this.Dl=performance.now(),this.Fl=this.jl((function n(){i&&(t.Dl=performance.now()),t.Ul&&(t.Fl=t.jl(n)),t.Pl&&t.Pl()})),this.Ul=!0,this.qv=0}},i.stop=function(){this.Ul&&(this.Hl(this.Fl),this.Fl=0,this.Ul=!1,this.qv=0)},i.jl=function(t){if(void 0===this.xl){var i=performance.now(),n=Math.max(0,i-this.Dl),e=Math.max(0,this.il-n);return setTimeout(t,e)}return this.Ti=t,this.xl.call(window,this._handleRAF)},i.Hl=function(t){void 0===this.Gl?clearTimeout(t):t&&this.Gl.call(window,t)},e(t,[{key:"targetFrameRate",get:function(){return this.Bl},set:function(t){this.Bl!==t&&(this.Bl=t,this.il=1e3/this.Bl,this.Ul&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this.Pl},set:function(t){this.Pl=t}}]),t}(),HC=t("PipelineInputAssemblerData",(function(){this.quadIB=null,this.quadVB=null,this.quadIA=null}));gt(zw.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),dt(lN.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this.window}}]);var VC=((GC={})[1]="Uint",GC[2]="Int",GC[3]="Uint",GC[4]="Int",GC[5]="Float",GC[6]="Float",GC.default="Uint",GC);function $C(t){return""+(VC[t.type]||VC.default)+t.size/t.count*8}function WC(t,i,n,e,r){void 0===n&&(n=11),void 0===e&&(e=0),void 0===r&&(r=0);var s=tg[n];r||(r=s.size);for(var h="set"+$C(s),u=s.size/s.count,o=Math.floor(i.length/s.count),a=ho.isLittleEndian,c=0;c<o;++c)for(var f=e+r*c,v=0;v<s.count;++v){var l=f+u*v;t[h](l,i[s.count*c+v],a)}}function zC(t,i,n,e,r,s){void 0===i&&(i=11),void 0===n&&(n=0),void 0===e&&(e=t.byteLength-n),void 0===r&&(r=0),void 0===s&&(s=[]);var h=tg[i];r||(r=h.size);for(var u="get"+$C(h),o=h.size/h.count,a=Math.floor(e/r),c=ho.isLittleEndian,f=0;f<a;++f)for(var v=n+r*f,l=0;l<h.count;++l){var d=v+o*l;s[h.count*f+l]=t[u](d,c)}return s}function XC(t,i,n,e,r,s,h){void 0===n&&(n=11),void 0===e&&(e=0),void 0===r&&(r=t.byteLength-e),void 0===s&&(s=0),h||(h=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var u=tg[n];s||(s=u.size);for(var o="set"+$C(u),a="get"+$C(u),c=u.size/u.count,f=Math.floor(r/s),v=ho.isLittleEndian,l=0;l<f;++l)for(var d=e+s*l,g=0;g<u.count;++g){var w=d+c*g,_=t[a](w,v);h[o](w,i(_,g,t),v)}return h}var YC,KC={positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:ir.ZERO,max:ir.ZERO}},qC=t("RenderingSubMesh",function(){function t(t,i,n,e,r,s){void 0===e&&(e=null),void 0===r&&(r=null),void 0===s&&(s=!0),this.mesh=void 0,this.subMeshIdx=void 0,this.Vl=[],this.$l=void 0,this.Wl=void 0,this.zl=void 0,this.Xl=void 0,this.Vn=void 0,this.zn=null,this.jn=i,this.Vn=t,this.$n=e,this.Wn=r,this.Yl=n,this.Kl=new Sd(i,t,e,r),this.ql=s}var i=t.prototype;return i.invalidateGeometricInfo=function(){this.Xl=void 0},i.genFlatBuffers=function(){if(!this.Vl.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,i=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(i=n.indexView.count);for(var e=0;e<n.vertexBundelIndices.length;e++){var r=n.vertexBundelIndices[e],s=t.struct.vertexBundles[r],h=n.indexView?n.indexView.count:s.view.count,u=s.view.stride,o=u*h,a=new Uint8Array(t.data.buffer,s.view.offset,s.view.length),c=new Uint8Array(n.indexView?o:s.view.length);if(n.indexView){for(var f=t.readIndices(this.subMeshIdx),v=0;v<i;++v)for(var l=v*u,d=f[v]*u,g=0;g<u;++g)c[l+g]=a[d+g];this.Vl.push({stride:u,count:h,buffer:c})}else c.set(t.data.subarray(s.view.offset,s.view.offset+s.view.length)),this.Vl.push({stride:u,count:h,buffer:c})}}},i.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this.$n&&(this.ql&&this.$n.destroy(),this.$n=null),this.$l&&this.Wl){for(var i=0;i<this.Wl.length;i++)this.$l[this.Wl[i]].destroy();this.$l=void 0,this.Wl=void 0}this.Wn&&(this.Wn.destroy(),this.Wn=null)},i.enableVertexIdChannel=function(t){if(!this.zl){var i=this.vertexBuffers.length,n=this.attributes.length,e=this.Ql(t);this.Vn.push(e),this.jn.push(new kd("a_vertexId",11,!1,i)),this.Kl.attributes=this.jn,this.Kl.vertexBuffers=this.Vn,this.zl={stream:i,index:n}}},i.Ql=function(t){for(var i=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(i),e=0;e<i;++e)n[e]=e+.5;var r=t.createBuffer(new ud(10,1,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},e(t,[{key:"attributes",get:function(){return this.jn}},{key:"vertexBuffers",get:function(){return this.Vn}},{key:"indexBuffer",get:function(){return this.$n}},{key:"indirectBuffer",get:function(){return this.Wn}},{key:"primitiveMode",get:function(){return this.Yl}},{key:"geometricInfo",get:function(){if(this.Xl)return this.Xl;if(void 0===this.mesh)return KC;if(void 0===this.subMeshIdx)return KC;var t,i=this.mesh,n=this.subMeshIdx,e=this.attributes.find((function(t){return"a_position"===t.name}));if(!e)return KC;switch(e.format){case 21:case 32:if(!(t=i.readAttribute(n,"a_position")))return KC;break;case 44:var r=i.readAttribute(n,"a_position");if(!r)return KC;var s=r.length/4;t=new Float32Array(3*s);for(var h=0;h<s;++h){var u=3*h,o=4*h;t[u]=r[o],t[u+1]=r[o+1],t[u+2]=r[o+2]}break;case 18:case 29:var a=i.readAttribute(n,"a_position");if(!a)return KC;t=new Float32Array(a.length);for(var c=0;c<a.length;++c)t[c]=Ee(a[c]);break;case 41:var f=i.readAttribute(n,"a_position");if(!f)return KC;var v=f.length/4;t=new Float32Array(3*v);for(var l=0;l<v;++l){var d=3*l,g=4*l;t[d]=Ee(f[g]),t[d+1]=Ee(f[g+1]),t[d+2]=Ee(f[g+2])}break;default:return KC}var w=i.readIndices(n)||void 0,_=new ir,m=new ir,p=tg[e.format].count;2===p?(_.set(t[0],t[1],0),m.set(t[0],t[1],0)):(_.set(t[0],t[1],t[2]),m.set(t[0],t[1],t[2]));for(var y=0;y<t.length;y+=p)2===p?(_.x=t[y]>_.x?t[y]:_.x,_.y=t[y+1]>_.y?t[y+1]:_.y,m.x=t[y]<m.x?t[y]:m.x,m.y=t[y+1]<m.y?t[y+1]:m.y):(_.x=t[y]>_.x?t[y]:_.x,_.y=t[y+1]>_.y?t[y+1]:_.y,_.z=t[y+2]>_.z?t[y+2]:_.z,m.x=t[y]<m.x?t[y]:m.x,m.y=t[y+1]<m.y?t[y+1]:m.y,m.z=t[y+2]<m.z?t[y+2]:m.z);return this.Xl={positions:t,indices:w,boundingBox:{max:_,min:m}},this.Xl}},{key:"drawInfo",get:function(){return this.zn},set:function(t){this.zn=t}},{key:"flatBuffers",get:function(){return this.Vl}},{key:"jointMappedBuffers",get:function(){var t=this;if(this.$l)return this.$l;var i=this.$l=[],n=this.Wl=[];if(!this.mesh||void 0===this.subMeshIdx)return this.$l=this.vertexBuffers;var e,r,s=this.mesh.struct,h=s.primitives[this.subMeshIdx];if(!s.jointMaps||void 0===h.jointMapIndex||!s.jointMaps[h.jointMapIndex])return this.$l=this.vertexBuffers;for(var u=k.director.root.device,o=function(){var o=s.vertexBundles[h.vertexBundelIndices[a]];r=0,e=0;for(var c=0;c<o.attributes.length;c++){var f=o.attributes[c];if("a_joints"===f.name){e=f.format;break}r+=tg[f.format].size}if(e){var v=new Uint8Array(t.mesh.data.buffer,o.view.offset,o.view.length),l=new DataView(v.slice().buffer),d=s.jointMaps[h.jointMapIndex];XC(l,(function(t){return d.indexOf(t)}),e,r,o.view.length,o.view.stride,l);var g=u.createBuffer(new ud(10,1,o.view.length,o.view.stride));g.update(l.buffer),i.push(g),n.push(a)}else i.push(t.vertexBuffers[h.vertexBundelIndices[a]])},a=0;a<h.vertexBundelIndices.length;a++)o();return this.zl&&i.push(this.Ql(u)),i}},{key:"iaInfo",get:function(){return this.Kl}}]),t}()),QC=new Kr,ZC=new Kr,JC=new Kr,tL=new Kr,iL=new Kr,nL=new Kr,eL=new Kr,rL=new ir(0,0,0),sL=new ir,hL=new ls,uL=new ir,oL=new ir,aL=new ir(1e7,1e7,1e7),cL=new ir(-1e7,-1e7,-1e7),fL=new ir,vL=0,lL=0,dL=function(){function t(t){this._shadowObjects=[],this._shadowCameraFar=0,this._matShadowView=new Kr,this._matShadowProj=new Kr,this._matShadowViewProj=new Kr,this._validFrustum=new So,this._splitFrustum=new So,this._lightViewFrustum=new So,this._castLightViewBoundingBox=new wo,this._level=t,this._validFrustum.accurate=!0,this._splitFrustum.accurate=!0,this._lightViewFrustum.accurate=!0}var i=t.prototype;return i.copyToValidFrustum=function(t){So.copy(this._validFrustum,t)},i.calculateValidFrustumOrtho=function(t,i,n,e,r){So.createOrtho(this._validFrustum,t,i,n,e,r)},i.calculateSplitFrustum=function(t,i,n,e){this._splitFrustum.split(n,e,t.aspect,t.fov,i)},i.destroy=function(){this._shadowObjects.length=0},i.createMatrix=function(t,i,n){var e=k.director.root.device,r=t.shadowInvisibleOcclusionRange;So.copy(this._lightViewFrustum,this._splitFrustum),Kr.fromRT(ZC,t.node.rotation,rL),Kr.invert(JC,ZC);var s,h,u=JC.clone();this._lightViewFrustum.transform(JC),wo.fromPoints(this._castLightViewBoundingBox,aL,cL),this._castLightViewBoundingBox.mergeFrustum(this._lightViewFrustum),t.csmOptimizationMode===Uk.DisableRotationFix?(s=2*this._castLightViewBoundingBox.halfExtents.x,h=2*this._castLightViewBoundingBox.halfExtents.y):s=h=ir.distance(this._lightViewFrustum.vertices[0],this._lightViewFrustum.vertices[6]);var o=k.director.root.pipeline.pipelineSceneData.csmSupported?t.csmLevel:1;if(o>1&&t.csmOptimizationMode===Uk.RemoveDuplicates)if(this._level>=o-1)lL=this._castLightViewBoundingBox.halfExtents.z,vL=this._castLightViewBoundingBox.center.z;else{var a=Math.abs(this._castLightViewBoundingBox.center.z-vL)+lL;this._castLightViewBoundingBox.halfExtents.z=Math.max(this._castLightViewBoundingBox.center.z,a)}var c=this._castLightViewBoundingBox.halfExtents.z;this._shadowCameraFar=2*c+r;var f=this._castLightViewBoundingBox.center;if(fL.set(f.x,f.y,f.z+c+r),ir.transformMat4(fL,fL,ZC),Kr.fromRT(ZC,t.node.rotation,fL),Kr.invert(JC,ZC),!n){var v=.5*s,l=.5*h;Kr.ortho(tL,-v,v,-l,l,.1,this._shadowCameraFar,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY),Kr.multiply(nL,tL,u),ir.transformMat4(sL,fL,nL);var d=2/i;hL.set(d,d);var g=sL.x%hL.x,w=sL.y%hL.y;uL.set(sL.x-g,sL.y-w,sL.z),Kr.invert(eL,nL),ir.transformMat4(oL,uL,eL),Kr.fromRT(ZC,t.node.rotation,oL),Kr.invert(JC,ZC),Kr.multiply(iL,tL,JC),Kr.copy(this._matShadowView,JC),Kr.copy(this._matShadowProj,tL),Kr.copy(this._matShadowViewProj,iL)}So.createOrtho(this._validFrustum,s,h,.1,this._shadowCameraFar,ZC)},e(t,[{key:"level",get:function(){return this._level}},{key:"shadowObjects",get:function(){return this._shadowObjects}},{key:"shadowCameraFar",get:function(){return this._shadowCameraFar},set:function(t){this._shadowCameraFar=t}},{key:"matShadowView",get:function(){return this._matShadowView},set:function(t){this._matShadowView=t}},{key:"matShadowProj",get:function(){return this._matShadowProj},set:function(t){this._matShadowProj=t}},{key:"matShadowViewProj",get:function(){return this._matShadowViewProj},set:function(t){this._matShadowViewProj=t}},{key:"validFrustum",get:function(){return this._validFrustum}},{key:"splitFrustum",get:function(){return this._splitFrustum}},{key:"lightViewFrustum",get:function(){return this._lightViewFrustum}},{key:"castLightViewBoundingBox",get:function(){return this._castLightViewBoundingBox}}]),t}(),gL=function(t){function i(i){var n;return(n=t.call(this,i)||this)._splitCameraNear=0,n._splitCameraFar=0,n._csmAtlas=new De,n.Zl(i),n}s(i,t);var n=i.prototype;return n.destroy=function(){t.prototype.destroy.call(this)},n.Zl=function(t){var i=k.director.root.device.capabilities.clipSpaceSignY,n=t%2-.5,e=(.5-Math.floor(t/2))*i;this._csmAtlas.set(.5,.5,n,e)},e(i,[{key:"splitCameraNear",get:function(){return this._splitCameraNear},set:function(t){this._splitCameraNear=t}},{key:"splitCameraFar",get:function(){return this._splitCameraFar},set:function(t){this._splitCameraFar=t}},{key:"csmAtlas",get:function(){return this._csmAtlas},set:function(t){this._csmAtlas=t}}]),i}(dL),wL=function(){function t(){this._castShadowObjects=[],this._layerObjects=new au(64),this._layers=[],this._levelCount=0,this._specialLayer=new dL(1),this._shadowDistance=0;for(var t=0;t<Dk.LEVEL_4;t++)this._layers[t]=new gL(t)}var i=t.prototype;return i.update=function(t,i){var n=i.scene.mainLight;if(null!==n){var e=t.shadows,r=k.director.root.pipeline.pipelineSceneData.csmSupported?n.csmLevel:1,s=n.shadowDistance;e.enabled&&n.shadowEnabled&&(n.shadowFixedArea?this.Jl(n):((n.csmNeedUpdate||this._levelCount!==r||this._shadowDistance!==s)&&(this.td(n),this._levelCount=r,this._shadowDistance=s),this.nd(i,n,e)))}},i.destroy=function(){this._castShadowObjects.length=0;for(var t=0;t<this._layers.length;t++)this._layers[t].destroy();this._layers.length=0},i.Jl=function(t){var i=k.director.root.device,n=t.shadowOrthoSize,e=t.shadowOrthoSize,r=t.shadowNear,s=t.shadowFar;Kr.fromRT(ZC,t.node.worldRotation,t.node.worldPosition),Kr.invert(JC,ZC),Kr.ortho(tL,-n,n,-e,e,r,s,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY),Kr.multiply(iL,tL,JC),this._specialLayer.matShadowView=JC,this._specialLayer.matShadowProj=tL,this._specialLayer.matShadowViewProj=iL,this._specialLayer.calculateValidFrustumOrtho(2*n,2*e,r,s,ZC)},i.td=function(t){var i=.1,n=t.shadowDistance,e=n/i,r=k.director.root.pipeline.pipelineSceneData.csmSupported?t.csmLevel:1,s=t.csmLayerLambda;this._layers[0].splitCameraNear=i;for(var h=1;h<r;h++){var u=h/r,o=s*i*Math.pow(e,u)+(1-s)*(i+(n-i)*u),a=1.005*o;this._layers[h].splitCameraNear=o,this._layers[h-1].splitCameraFar=a}this._layers[r-1].splitCameraFar=n,t.csmNeedUpdate=!1},i.nd=function(t,i,n){var e=k.director.root.pipeline.pipelineSceneData.csmSupported?i.csmLevel:1,r=e>1?.5*n.size.x:n.size.x;if(!(r<0)){this.ed(QC,t);for(var s=e-1;s>=0;s--){var h=this._layers[s],u=h.splitCameraNear,o=h.splitCameraFar;h.calculateSplitFrustum(t,QC,u,o),h.createMatrix(i,r,!1)}e===Dk.LEVEL_1?(this._specialLayer.shadowCameraFar=this._layers[0].shadowCameraFar,Kr.copy(this._specialLayer.matShadowView,this._layers[0].matShadowView),Kr.copy(this._specialLayer.matShadowProj,this._layers[0].matShadowProj),Kr.copy(this._specialLayer.matShadowViewProj,this._layers[0].matShadowViewProj),this._specialLayer.copyToValidFrustum(this._layers[0].validFrustum)):(this._specialLayer.calculateSplitFrustum(t,QC,.1,i.shadowDistance),this._specialLayer.createMatrix(i,r,!0))}},i.ed=function(t,i){if(i.node){var n=i.node,e=n.worldPosition,r=n.worldRotation;Kr.fromRT(t,r,e)}},e(t,[{key:"castShadowObjects",get:function(){return this._castShadowObjects}},{key:"layerObjects",get:function(){return this._layerObjects}},{key:"layers",get:function(){return this._layers}},{key:"specialLayer",get:function(){return this._specialLayer}}]),t}(),_L=t("PipelineSceneData",function(){function t(){this.fog=new qk,this.ambient=new fy,this.skybox=new zk,this.shadows=new Gk,this.csmLayers=new wL,this.octree=new HM,this.skin=new VM,this.postSettings=new yO,this.lightProbes=k.internal.LightProbes?new k.internal.LightProbes:null,this.validPunctualLights=[],this.renderObjects=[],this.shadowFrameBufferMap=new Map,this._geometryRendererMaterials=[],this._geometryRendererPasses=[],this._geometryRendererShaders=[],this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._csmSupported=!0,this.rd=null,this.sd=null,this.hd=null,this._shadingScale=1}var i=t.prototype;return i.activate=function(t){return this._device=t,this.initGeometryRendererMaterials(),this.initOcclusionQuery(),!0},i.initGeometryRendererMaterials=function(){for(var t=0,i=this._geometryRendererMaterials,n=0;n<6;n++){i[n]=new Lk,i[n]._uuid="geometry-renderer-material-"+n,i[n].initialize({effectName:"internal/builtin-geometry-renderer",technique:n});for(var e=i[n].passes,r=0;r<e.length;++r)this._geometryRendererPasses[t]=e[r],this._geometryRendererShaders[t]=e[r].getShaderVariant(),t++}},i.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this.ud()),!this._occlusionQueryMaterial){var t=new Lk;t._uuid="default-occlusion-query-material",t.initialize({effectName:"internal/builtin-occlusion-query"}),this._occlusionQueryMaterial=t,t.passes.length>0&&(this._occlusionQueryShader=t.passes[0].getShaderVariant())}},i.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial&&this._occlusionQueryMaterial.passes.length>0?this._occlusionQueryMaterial.passes[0]:null},i.updatePipelineSceneData=function(){},i.destroy=function(){var t,i,n;this.shadows.destroy(),this.csmLayers.destroy(),this.validPunctualLights.length=0,null==(t=this._occlusionQueryInputAssembler)||t.destroy(),this._occlusionQueryInputAssembler=null,null==(i=this._occlusionQueryVertexBuffer)||i.destroy(),this._occlusionQueryVertexBuffer=null,null==(n=this._occlusionQueryIndicesBuffer)||n.destroy(),this._occlusionQueryIndicesBuffer=null,this.rd=null,this.sd=null,this.hd=null},i.ud=function(){var t=this._device,i=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]);this._occlusionQueryVertexBuffer=t.createBuffer(new ud(10,1,96,12)),this._occlusionQueryVertexBuffer.update(i);var n=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]);this._occlusionQueryIndicesBuffer=t.createBuffer(new ud(6,1,72,2)),this._occlusionQueryIndicesBuffer.update(n);var e=[new kd("a_position",32)],r=new Sd(e,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return t.createInputAssembler(r)},e(t,[{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR=t}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale=t}},{key:"csmSupported",get:function(){return this._csmSupported},set:function(t){this._csmSupported=t}},{key:"standardSkinModel",get:function(){return this.sd},set:function(t){this.sd=t}},{key:"standardSkinMeshRenderer",get:function(){return this.rd},set:function(t){this.rd&&this.rd!==t&&this.rd.od(),this.rd=t,this.standardSkinModel=t?t.model:null}},{key:"skinMaterialModel",get:function(){return this.hd},set:function(t){this.hd=t}},{key:"geometryRendererPasses",get:function(){return this._geometryRendererPasses}},{key:"geometryRendererShaders",get:function(){return this._geometryRendererShaders}}]),t}()),mL=ws(),pL=((YC={})[Gi.ORIENTATION_AUTO]=Ui.AUTO,YC[Gi.ORIENTATION_LANDSCAPE]=Ui.LANDSCAPE,YC[Gi.ORIENTATION_PORTRAIT]=Ui.PORTRAIT,YC),yL=t("View",function(t){function i(){var i;(i=t.call(this)||this)._designResolutionSize=ws(0,0),i.ad=1,i.fd=1,i.vd=ys(),i.ld=ys(),i.dd=!1,i.gd=!1,i.wd=null;var n=bL,e=AL;return i._d=new ML(n.EQUAL_TO_FRAME,e.EXACT_FIT),i.md=new ML(n.EQUAL_TO_FRAME,e.SHOW_ALL),i.pd=new ML(n.EQUAL_TO_FRAME,e.NO_BORDER),i.yd=new ML(n.EQUAL_TO_FRAME,e.FIXED_HEIGHT),i.bd=new ML(n.EQUAL_TO_FRAME,e.FIXED_WIDTH),i.Ad=i.md,i}s(i,t);var n=i.prototype;return n.init=function(){var t=so.windowSize,i=t.width,n=t.height;this._designResolutionSize.width=i,this._designResolutionSize.height=n,this.vd.width=i,this.vd.height=n,this.ld.width=i,this.ld.height=n,mL.width=this.ld.width,mL.height=this.ld.height,uo.init(this.ld),this.resizeWithBrowserSize(!0);var e=xi.querySettings("screen","designResolution");e&&this.setDesignResolutionSize(Number(e.width),Number(e.height),e.policy||ML.FIXED_HEIGHT),so.on("window-resize",this.Ed,this),so.on("fullscreen-change",this.Ed,this)},n.resizeWithBrowserSize=function(t){eo.handleResizeEvent=t},n.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this.wd=t)},n.setOrientation=function(t){eo.orientation=pL[t]},n.adjustViewportMeta=function(){},n.enableRetina=function(t){this.gd=!!t},n.isRetinaEnabled=function(){return this.gd},n.enableAutoFullScreen=function(t){t!==this.dd&&(this.dd=t,t&&so.requestFullScreen().catch((function(){})))},n.isAutoFullScreenEnabled=function(){return this.dd},n.setCanvasSize=function(t,i){eo.resolutionScale=1;var n=eo.devicePixelRatio,e=new gs(t*n,i*n);so.windowSize=e},n.getCanvasSize=function(){return so.windowSize},n.getFrameSize=function(){var t=eo.devicePixelRatio,i=so.windowSize;return i.width/=t,i.height/=t,i},n.setFrameSize=function(t,i){var n=eo.devicePixelRatio;so.windowSize=new gs(t*n,i*n)},n.getVisibleSize=function(){return new gs(this.ld.width,this.ld.height)},n.getVisibleSizeInPixel=function(){return new gs(this.ld.width*this.ad,this.ld.height*this.fd)},n.getVisibleOrigin=function(){return new ls(this.ld.x,this.ld.y)},n.getVisibleOriginInPixel=function(){return new ls(this.ld.x*this.ad,this.ld.y*this.fd)},n.getResolutionPolicy=function(){return this.Ad},n.kd=function(t){if(t instanceof ML)this.Ad=t;else{var i=ML;t===i.EXACT_FIT&&(this.Ad=this._d),t===i.SHOW_ALL&&(this.Ad=this.md),t===i.NO_BORDER&&(this.Ad=this.pd),t===i.FIXED_HEIGHT&&(this.Ad=this.yd),t===i.FIXED_WIDTH&&(this.Ad=this.bd)}},n.setResolutionPolicy=function(t){this.kd(t);var i=NL.getDesignResolutionSize();NL.setDesignResolutionSize(i.width,i.height,t)},n.setDesignResolutionSize=function(t,i,n){if(t>0&&i>0){this.kd(n);var e=this.Ad;e&&e.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=i;var r=e.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this.ad=r.scale[0],this.fd=r.scale[1]),r.viewport){var s=this.vd,h=this.ld,u=r.viewport;s.x=u.x,s.y=u.y,s.width=u.width,s.height=u.height,h.x=0,h.y=0,h.width=u.width/this.ad,h.height=u.height/this.fd}e.postApply(this),mL.width=this.ld.width,mL.height=this.ld.height,uo.init(this.ld),this.emit("design-resolution-changed")}else ut(2200)},n.getDesignResolutionSize=function(){return new gs(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(t,i,n){document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,i,n)},n.getViewportRect=function(){return this.vd},n.getScaleX=function(){return this.ad},n.getScaleY=function(){return this.fd},n.getDevicePixelRatio=function(){return eo.devicePixelRatio},n.convertToLocationInView=function(t,i,n,e){void 0===e&&(e=new ls);var r=eo.devicePixelRatio*(t-n.left),s=eo.devicePixelRatio*(n.top+n.height-i);return eo.isFrameRotated?(e.x=so.windowSize.width-s,e.y=r):(e.x=r,e.y=s),e},n.Ut=function(t){var i=this.vd;t.x=(t.x-i.x)/this.ad,t.y=(t.y-i.y)/this.fd},n.Ed=function(t,i,n){k.director.root.resize(t,i,void 0===n||0===n?1:n);var e=this._designResolutionSize,r=e.width,s=e.height;t>0&&i>0?this.setDesignResolutionSize(r,s,this.Ad):K(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),this.wd&&this.wd()},i}(Su(Pv)));yL.instance=void 0;var bL=function(){function t(){this.name="ContainerStrategy"}var i=t.prototype;return i.preApply=function(){},i.apply=function(){},i.postApply=function(){},i._setupCanvas=function(){var t=k.game.canvas;if(t){var i=so.windowSize;t.width!==i.width&&(t.width=i.width),t.height!==i.height&&(t.height=i.height)}},t}();bL.EQUAL_TO_FRAME=void 0,bL.PROPORTION_TO_FRAME=void 0;var AL=function(){function t(){this.name="ContentStrategy",this.Td={scale:[1,1],viewport:null},this._strategy=ML.UNKNOWN}var i=t.prototype;return i.preApply=function(){},i.apply=function(){return{scale:[1,1]}},i.postApply=function(){},i._buildResult=function(t,i,n,e,r,s){Math.abs(t-n)<2&&(n=t),Math.abs(i-e)<2&&(e=i);var h=new ps(Math.round((t-n)/2),Math.round((i-e)/2),n,e),u=this.Td;return u.scale=[r,s],u.viewport=h,u},e(t,[{key:"strategy",get:function(){return this._strategy}}]),t}(),EL=function(t){function i(){var i;return(i=t.call(this)||this).name="EqualToFrame",i}return s(i,t),i.prototype.apply=function(){eo.isProportionalToFrame=!1,this._setupCanvas()},i}(bL),kL=function(t){function i(){var i;return(i=t.call(this)||this).name="ProportionalToFrame",i}return s(i,t),i.prototype.apply=function(){eo.isProportionalToFrame=!0,this._setupCanvas()},i}(bL);bL.EQUAL_TO_FRAME=new EL,bL.PROPORTION_TO_FRAME=new kL;var TL=function(t){function i(){var i;return(i=t.call(this)||this).name="ExactFit",i._strategy=ML.EXACT_FIT,i}return s(i,t),i.prototype.apply=function(t,i){var n=so.windowSize,e=n.width,r=n.height,s=e/i.width,h=r/i.height;return this._buildResult(e,r,e,r,s,h)},i}(AL),SL=function(t){function i(){var i;return(i=t.call(this)||this).name="ShowAll",i._strategy=ML.SHOW_ALL,i}return s(i,t),i.prototype.apply=function(t,i){var n,e,r=so.windowSize,s=r.width,h=r.height,u=i.width,o=i.height,a=s/u,c=h/o,f=0;return a<c?(n=s,e=o*(f=a)):(n=u*(f=c),e=h),this._buildResult(s,h,n,e,f,f)},i}(AL),OL=function(t){function i(){var i;return(i=t.call(this)||this).name="NoBorder",i._strategy=ML.NO_BORDER,i}return s(i,t),i.prototype.apply=function(t,i){var n,e,r,s=so.windowSize,h=s.width,u=s.height,o=i.width,a=i.height,c=h/o,f=u/a;return c<f?(e=o*(n=f),r=u):(e=h,r=a*(n=c)),this._buildResult(h,u,e,r,n,n)},i}(AL),RL=function(t){function i(){var i;return(i=t.call(this)||this).name="FixedHeight",i._strategy=ML.FIXED_HEIGHT,i}return s(i,t),i.prototype.apply=function(t,i){var n=so.windowSize,e=n.width,r=n.height,s=r/i.height,h=e,u=r;return this._buildResult(e,r,h,u,s,s)},i}(AL),IL=function(t){function i(){var i;return(i=t.call(this)||this).name="FixedWidth",i._strategy=ML.FIXED_WIDTH,i}return s(i,t),i.prototype.apply=function(t,i){var n=so.windowSize,e=n.width,r=n.height,s=e/i.width,h=e,u=r;return this._buildResult(e,r,h,u,s,s)},i}(AL),ML=t("ResolutionPolicy",function(){function t(t,i){this.name="ResolutionPolicy",this.Sd=t,this.Od=i}var i=t.prototype;return i.preApply=function(t){this.Od.preApply(t)},i.apply=function(t,i){return this.Sd.apply(t,i),this.Od.apply(t,i)},i.postApply=function(t){this.Od.postApply(t)},i.setContainerStrategy=function(t){this.Sd=t},i.setContentStrategy=function(t){this.Od=t},i.getContentStrategy=function(){return this.Od},e(t,[{key:"canvasSize",get:function(){return so.windowSize}}]),t}());ML.EXACT_FIT=0,ML.NO_BORDER=1,ML.SHOW_ALL=2,ML.FIXED_HEIGHT=3,ML.FIXED_WIDTH=4,ML.UNKNOWN=5,ML.ContainerStrategy=bL,ML.ContentStrategy=AL,k.ResolutionPolicy=ML,AL.EXACT_FIT=new TL,AL.SHOW_ALL=new SL,AL.NO_BORDER=new OL,AL.FIXED_HEIGHT=new RL,AL.FIXED_WIDTH=new IL;var NL=t("view",yL.instance=k.view=new yL);xC.registerSystem("view",NL,0),k.winSize=mL;var CL=new ls;function LL(t,i,n,e){t.setProperty(i,n,e)}var FL=function(){var t=i.prototype;function i(){this.Rd=void 0,this.Id=0,this.Md=void 0,this.Nd=void 0,this.Cd=void 0,this.Ld=void 0,this.Fd=void 0,this.Pd=void 0,this.Bd=void 0,this.Dd=void 0,this.Ud=void 0,this.xd=void 0,this.Gd=void 0,this.jd=!1,this.Hd=void 0,this.Vd=void 0,this.$d=void 0,this.Wd=void 0,this.zd=void 0,this.Xd=void 0,this.Yd=void 0,this.Kd=void 0,this.qd=1920,this.Qd=1080,this.Zd=140,this.Jd=200,this.tg=0,this.ig=0,this.ng=.5,this.eg=1/6+2.5/6,this.rg=24,this.sg=24,this.hg=.5,this.ug=32,this.og=4,this.ag=1}return t.init=function(){var t,i,n,e,r,s,h,u=this,o=ML.SHOW_ALL,a=xi.querySettings("screen","designResolution");if(null!==a&&(o=a.policy),this.Rd={cg:null!==(t=o)&&void 0!==t?t:ML.SHOW_ALL,fg:null!==(i=xi.querySettings("splashScreen","displayRatio"))&&void 0!==i?i:.4,vg:null!==(n=xi.querySettings("splashScreen","totalTime"))&&void 0!==n?n:3e3,lg:null!==(e=xi.querySettings("splashScreen","watermarkLocation"))&&void 0!==e?e:"default",dg:null===(r=xi.querySettings("splashScreen","autoFit"))||void 0===r||r,gg:null!==(s=xi.querySettings("splashScreen","logo"))&&void 0!==s?s:void 0,wg:null!==(h=xi.querySettings("splashScreen","background"))&&void 0!==h?h:void 0},this.Id=0,!(this.Rd.vg<=0||void 0===this.Rd.gg||void 0===this.Rd.wg)){this.Md=k.director.root.device,this.Nd=k.director.root.mainWindow.swapchain,this._g(),this.mg(),"default"===this.Rd.gg.type&&this.pg();var c=Promise.resolve(),f=Promise.resolve();return"custom"===this.Rd.wg.type&&(c=new Promise((function(t,i){u.Vd=new O.Image,u.Vd.onload=function(){u.yg(),t()},u.Vd.onerror=function(){i()},u.Vd.src=u.Rd.wg.base64}))),"none"!==this.Rd.gg.type&&(f=new Promise((function(t,i){u.zd=new O.Image,u.zd.onload=function(){u.bg(),t()},u.zd.onerror=function(){i()},u.zd.src=u.Rd.gg.base64}))),Promise.all([c,f])}return this.Rd.vg=0,Promise.resolve([])},t._g=function(){var t,i=null==(t=this.Rd.wg)?void 0:t.color;this.xd=i?[new nd(i.x,i.y,i.z,i.w)]:[new nd(0,0,0,1)];var n=this.Md,e=this.Nd,r=n.capabilities;this.Ud=new Yl(0,0,e.width,e.height),this.Fd=n.commandBuffer;var s=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]);this.Bd=n.createBuffer(new ud(10,1,64,16)),this.Bd.update(s);var h=new Uint16Array([0,1,2,1,3,2]);this.Dd=n.createBuffer(new ud(6,1,12,2)),this.Dd.update(h);var u=[new kd("a_position",21),new kd("a_texCoord",21)],o=new Sd(u,[this.Bd],this.Dd);this.Pd=n.createInputAssembler(o),this.Gd=new Kr,Kr.ortho(this.Gd,-1,1,-1,1,-1,1,r.clipSpaceMinZ,r.clipSpaceSignY,e.surfaceTransform),this.jd=ho.isMobile},t.mg=function(){this.jd?(this.qd=812,this.Qd=375,this.Zd=70,this.Jd=100,this.rg=12,this.sg=this.rg+this.og,this.hg=.5,this.ug=16):(this.qd=1920,this.Qd=1080,this.Zd=140,this.Jd=200,this.rg=24,this.sg=this.rg+this.og,this.hg=.5,this.ug=32),this.ng=.5,this.eg=1/6+2.5/6,this.Ag()},t.Ag=function(){var t=this.Nd.width,i=this.Nd.height,n=this.jd?375:1080,e=this.jd?812:1920;if(t>i){var r=e;e=n,n=r}this.ag=t/i>16/9?i/e:t/n},t.update=function(t){var i=this.Rd,n=this.Md,e=this.Nd,r=n.capabilities;Kr.ortho(this.Gd,-1,1,-1,1,-1,1,r.clipSpaceMinZ,r.clipSpaceSignY,e.surfaceTransform);var s=e.width,h=e.height;this.Ag(),this.Id+=1e3*t;var u=nc(te(this.Id/i.vg)),o=1,a=1,c=this.Vd;if("custom"===i.wg.type){i.cg===ML.FIXED_WIDTH?(o=s,a=s/c.width*c.height):i.cg===ML.FIXED_HEIGHT?(o=h/c.height*c.width,a=h):i.cg===ML.SHOW_ALL?c.width/this.Qd>s/h?(o=s,a=s/c.width*c.height):(o=h/c.height*c.width,a=h):i.cg===ML.NO_BORDER?c.width/c.height>s/h?(o=h/c.height*c.width,a=h):(o=s,a=s/c.width*c.height):(o=s,a=h);var f=this.Hd;LL(f,"resolution",CL.set(s,h),0),LL(f,"scale",CL.set(o,a),0),LL(f,"translate",CL.set(.5*s,.5*h),0),LL(f,"percent",1),LL(f,"u_projection",this.Gd),f.passes[0].update()}var v=h*this.eg;if("none"!==this.Rd.gg.type){a=.185*h*i.fg,o=this.tg*(.185*h/this.ig)*i.fg;var l=this.Wd;LL(l,"resolution",CL.set(s,h),0),LL(l,"scale",CL.set(o,a),0),LL(l,"translate",CL.set(s*this.ng,v),0),LL(l,"percent",u),LL(l,"u_projection",this.Gd),l.passes[0].update()}if("default"===this.Rd.gg.type&&this.Yd){var d=this.Kd.width,g=this.Kd.height;o=d,a=g;var w=v-(.5*this.ig*i.fg+this.ug)*this.ag-.5*g,_=this.Yd;LL(_,"resolution",CL.set(s,h),0),LL(_,"scale",CL.set(o,a),0),LL(_,"translate",CL.set(s*this.hg,w),0),LL(_,"percent",u),LL(_,"u_projection",this.Gd),_.passes[0].update()}this.Eg()},t.yg=function(){var t=this.Md;this.Hd=new Lk,this.Hd.initialize({effectName:"util/splash-screen"});var i=new dd;i.addressU=2,i.addressV=2,i.addressW=2,this.Ld=t.getSampler(i),this.$d=t.createTexture(new vd(1,6,35,this.Vd.width,this.Vd.height));var n=this.Hd.passes[0],e=n.getBinding("mainTexture");n.bindTexture(e,this.$d),this.Cd=n.getShaderVariant();var r=n.descriptorSet;r.bindSampler(e,this.Ld),r.update();var s=new td,h=s.texExtent;h.width=this.Vd.width,h.height=this.Vd.height,h.depth=1,t.copyTexImagesToTexture([this.Vd],this.$d,[s])},t.bg=function(){var t=this.Md;this.Wd=new Lk,this.Wd.initialize({effectName:"util/splash-screen"});var i=new dd;i.addressU=2,i.addressV=2,i.addressW=2,this.Ld=t.getSampler(i),this.Xd=t.createTexture(new vd(1,6,35,this.zd.width,this.zd.height));var n=this.Wd.passes[0],e=n.getBinding("mainTexture");n.bindTexture(e,this.Xd),this.Cd=n.getShaderVariant();var r=n.descriptorSet;r.bindSampler(e,this.Ld),r.update();var s=new td,h=s.texExtent;h.width=this.zd.width,h.height=this.zd.height,h.depth=1,t.copyTexImagesToTexture([this.zd],this.Xd,[s]);var u=this.zd.width/this.zd.height;u<1?(this.tg=this.Zd,this.ig=this.Zd/u):(this.tg=this.Jd*u,this.ig=this.Jd)},t.pg=function(){var t=O.document.createElement("canvas");t.height=this.sg*this.ag,t.style.width=""+t.width,t.style.height=""+t.height;var i="Created with Cocos",n=t.getContext("2d");n.font=this.rg*this.ag+"px Arial",n.textBaseline="top",n.textAlign="center",n.fillStyle="#707070";var e=n.measureText(i).width+10;t.width=e,n.font=this.rg*this.ag+"px Arial",n.textBaseline="top",n.textAlign="center",n.fillStyle="#707070",n.fillText(i,t.width/2,0);var r=new td,s=r.texExtent;s.width=t.width,s.height=t.height,s.depth=1,this.Kd=this.Md.createTexture(new vd(1,6,35,t.width,t.height)),this.Md.copyTexImagesToTexture([t],this.Kd,[r]),this.Yd=new Lk,this.Yd.initialize({effectName:"util/splash-screen"});var h=this.Yd.passes[0],u=h.getBinding("mainTexture");h.bindTexture(u,this.Kd),h.descriptorSet.update()},t.Eg=function(){var t=this.Md,i=this.Nd;this.Gd;var n=this.Hd,e=this.Wd,r=this.Yd,s=this.Rd,h=this.Pd;if(t.capabilities,!ho.isXR||xr.entry.isRenderAllowable())for(var u=ho.isXR?2:1,o=0;o<u;o++){t.enableAutoBarrier(!0),t.acquire([i]);var a=this.Fd,c=k.director.root.mainWindow.framebuffer,f=this.Ud;if(f.width=i.width,f.height=i.height,a.begin(),a.beginRenderPass(c.renderPass,c,f,this.xd,1,0),k.director.root.pipeline,"custom"===s.wg.type){var v=n.passes[0],l=wk.getOrCreatePipelineState(t,v,this.Cd,c.renderPass,h);a.bindPipelineState(l),a.bindDescriptorSet(1,v.descriptorSet),a.bindInputAssembler(h),a.draw(h)}if("none"!==s.gg.type){var d=e.passes[0],g=wk.getOrCreatePipelineState(t,d,this.Cd,c.renderPass,h);a.bindPipelineState(g),a.bindDescriptorSet(1,d.descriptorSet),a.bindInputAssembler(h),a.draw(h)}if("default"===s.gg.type&&r){var w=this.Yd.passes[0],_=wk.getOrCreatePipelineState(t,w,this.Cd,c.renderPass,h);a.bindPipelineState(_),a.bindDescriptorSet(1,w.descriptorSet),a.bindInputAssembler(h),a.draw(h)}a.endRenderPass(),a.end(),t.flushCommands([a]),t.queue.submit([a]),t.present(),t.enableAutoBarrier(!T.rendering)}},t.kg=function(){this.Md=null,this.Nd=null,this.xd=null,this.Vd&&(this.Vd.destroy&&this.Vd.destroy(),this.Vd=null),this.Hd&&(this.Hd.destroy(),this.Hd=null),this.$d&&(this.$d.destroy(),this.$d=null),this.zd&&(this.zd.destroy&&this.zd.destroy(),this.zd=null),this.Wd&&(this.Wd.destroy(),this.Wd=null),this.Xd&&(this.Xd.destroy(),this.Xd=null),this.Ud=null,this.Fd=null,this.Cd=null,this.Pd&&(this.Pd.destroy(),this.Pd=null),this.Bd&&(this.Bd.destroy(),this.Bd=null),this.Dd&&(this.Dd.destroy(),this.Dd=null),this.Ld=null,this.Yd&&(this.Yd.destroy(),this.Yd=null),this.Kd&&(this.Kd.destroy(),this.Kd=null),this.Rd=null},i.createInstance=function(){return i.Tg=new i,i.Tg},i.releaseInstance=function(){i.Tg&&(i.Tg.kg(),i.Tg=null)},e(i,[{key:"isFinished",get:function(){return this.Id>=this.Rd.vg}},{key:"curTime",get:function(){return this.Id},set:function(t){this.Id=t}}],[{key:"instance",get:function(){return i.Tg}}]),i}();FL.Tg=null,k.internal.SplashScreen=FL;var PL=new(function(){function t(){this.I=null}return t.prototype.init=function(t){var i=this;return void 0===t&&(t=""),T.rendering&&T.rendering.enableEffectImport&&t?new Promise((function(n,e){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="arraybuffer",r.onload=function(){i.I=r.response,n()},r.onerror=function(){e(new Error("request effect settings failed!"))},r.send(null)})):Promise.resolve()},e(t,[{key:"data",get:function(){return this.I}}]),t}());T.effectSettings=PL;var BL=xi.querySettings.bind(xi),DL=t("Game",function(t){function n(){var i;return(i=t.call(this)||this).frame=null,i.container=null,i.canvas=null,i.renderType=-1,i.eventTargetOn=t.prototype.on,i.eventTargetOnce=t.prototype.once,i.config={},i.onStart=null,i.frameTime=1e3/60,i._isCloning=!1,i.Sg=!1,i.Og=!1,i.Rg=!1,i.Rl=!0,i.Ig=!1,i.Mg=60,i.Ng=null,i.Cg=0,i.Dl=0,i.Lg=0,i.Fg=!1,i.Pg=!0,i.onPreBaseInitDelegate=new Fu,i.onPostBaseInitDelegate=new Fu,i.onPreInfrastructureInitDelegate=new Fu,i.onPostInfrastructureInitDelegate=new Fu,i.onPreSubsystemInitDelegate=new Fu,i.onPostSubsystemInitDelegate=new Fu,i.onPreProjectInitDelegate=new Fu,i.onPostProjectInitDelegate=new Fu,i}s(n,t);var r=n.prototype;return r.setFrameRate=function(t){this.frameRate=t},r.getFrameRate=function(){return this.frameRate},r.step=function(){xC.tick(this._calculateDT(!0))},r.Bg=function(){this.Rl||(this.Ig=!0,this.pause())},r.Dg=function(){this.Ig&&(this.resume(),this.Ig=!1)},r.pause=function(){var t;this.Rl||(this.Rl=!0,null==(t=this.Ng)||t.stop(),this.emit(n.EVENT_PAUSE))},r.resume=function(){var t;this.Rl&&(lM._clearEvents(),this.Rl=!1,null==(t=this.Ng)||t.start(),this.emit(n.EVENT_RESUME))},r.isPaused=function(){return this.Rl},r.restart=function(){var t=this;return new Promise((function(t){xC.once("director_end_frame",(function(){return t()}))})).then((function(){xC.reset(),k.Object._deferredDestroy(),t.pause(),t.resume(),t.Pg=!0})).then((function(){return FL.createInstance().init()})).then((function(){t.Ug(n.EVENT_RESTART)}))},r.end=function(){Bu.close()},r.on=function(t,i,n,e){return this.xg(t)&&i.call(n),this.eventTargetOn(t,i,n,e)},r.once=function(t,i,n){return this.xg(t)?i.call(n):this.eventTargetOnce(t,i,n)},r.xg=function(t){return this.Og&&t===n.EVENT_ENGINE_INITED||this.Sg&&t===n.EVENT_GAME_INITED||this.Rg&&t===n.EVENT_RENDERER_INITED},r.init=function(t){var e=this;return this.Gg(t),Promise.resolve().then((function(){return e.emit(n.EVENT_PRE_BASE_INIT),e.onPreBaseInitDelegate.dispatch()})).then((function(){Q(t.debugMode||0)})).then((function(){return ho.init()})).then((function(){e.jg()})).then((function(){return xi.init(t.settingsPath,t.overrideSettings)})).then((function(){return e.emit(n.EVENT_POST_BASE_INIT),e.onPostBaseInitDelegate.dispatch()})).then((function(){return e.emit(n.EVENT_PRE_INFRASTRUCTURE_INIT),e.onPreInfrastructureInitDelegate.dispatch()})).then((function(){Gi.init(),e.Hg();var t={frame:document.querySelector("#GameDiv"),container:document.querySelector("#Cocos3dGameContainer"),canvas:document.querySelector("#GameCanvas")};return e.canvas=t.canvas,e.frame=t.frame,e.container=t.container,so.init(),Xv.init(),Hg.init(e.canvas,my)})).then((function(){if(BL("rendering","customPipeline")){if(!k.rendering)return void ut(12109);Gi.CUSTOM_PIPELINE_NAME||(Gi.CUSTOM_PIPELINE_NAME="Builtin")}else k.rendering=void 0;ek.init(),uk.init(),Pm.init(),e.Vg()})).then((function(){return e.emit(n.EVENT_POST_INFRASTRUCTURE_INIT),e.onPostInfrastructureInitDelegate.dispatch()})).then((function(){return e.emit(n.EVENT_PRE_SUBSYSTEM_INIT),e.onPreSubsystemInitDelegate.dispatch()})).then((function(){return PL.init(BL("rendering","effectSettingsPath"))})).then((function(){if(k.rendering&&k.rendering.enableEffectImport)if(3!==BL("rendering","renderMode")){var t=PL.data;null!==t?k.rendering.init(Hg.gfxDevice,t):ut(1102)}else k.rendering.init(Hg.gfxDevice,null)})).then((function(){var t=BL("scripting","scriptPackages");return t?Promise.all(t.map((function(t){return i.import(t)}))):Promise.resolve([])})).then((function(){return xC.init(),uk.loadBuiltinAssets()})).then((function(){return e.emit(n.EVENT_POST_SUBSYSTEM_INIT),e.onPostSubsystemInitDelegate.dispatch()})).then((function(){z("Cocos Creator v"+S),e.emit(n.EVENT_ENGINE_INITED),e.Og=!0})).then((function(){return e.emit(n.EVENT_PRE_PROJECT_INIT),e.onPreProjectInitDelegate.dispatch()})).then((function(){var t=BL("plugins","jsList"),i=Promise.resolve();return t&&t.forEach((function(t){i=i.then((function(){return i="src/"+t,new Promise((function(t,n){var e;function r(t){t.filename===i&&(e=t.error)}window.addEventListener("error",r);var s=document.createElement("script");s.charset="utf-8",s.async=!0,s.crossOrigin="anonymous",s.addEventListener("error",(function(){window.removeEventListener("error",r),n(Error("Error loading "+i))})),s.addEventListener("load",(function(){window.removeEventListener("error",r),document.head.removeChild(s),e?n(e):t()})),s.src=i.replace("#","%23"),document.head.appendChild(s)}));var i}))})),i})).then((function(){return e._loadProjectBundles()})).then((function(){return e.$g()})).then((function(){return e.Wg()})).then((function(){return e.zg()})).then((function(){return uk.compileBuiltinMaterial(),FL.createInstance().init()})).then((function(){return e.emit(n.EVENT_POST_PROJECT_INIT),e.onPostProjectInitDelegate.dispatch()})).then((function(){e.Sg=!0,e.Ug(n.EVENT_GAME_INITED)}))},r.Hg=function(){},r.Gg=function(t){var i=t.overrideSettings=t.overrideSettings||{};"showFPS"in t&&(i.profiling=i.profiling||{},i.profiling.showFPS=t.showFPS),"frameRate"in t&&(i.screen=i.screen||{},i.screen.frameRate=t.frameRate),"renderMode"in t&&(i.rendering=i.rendering||{},i.rendering.renderMode=t.renderMode),"renderPipeline"in t&&(i.rendering=i.rendering||{},i.rendering.renderPipeline=t.renderPipeline),"assetOptions"in t&&(i.assets=i.assets||{},Object.assign(i.assets,t.assetOptions)),"customJointTextureLayouts"in t&&(i.animation=i.animation||{},i.animation.customJointTextureLayouts=t.customJointTextureLayouts),"physics"in t&&(i.physics=i.physics||{},Object.assign(i.physics,t.physics)),"orientation"in t&&(i.screen=i.screen||{},i.screen.orientation=t.orientation),"exactFitScreen"in t&&(i.screen=i.screen||{},i.screen.exactFitScreen=t.exactFitScreen)},r.zg=function(){var t=BL("assets","preloadAssets");return t?Promise.all(t.map((function(t){return new Promise((function(i,n){ek.loadAny(t,(function(t){t?n(t):i()}))}))}))):Promise.resolve([])},r.$g=function(){return new Promise((function(t){t()}))},r._loadProjectBundles=function(){var t=BL("assets","preloadBundles");return t?Promise.all(t.map((function(t){var i=t.bundle,n=t.version;return new Promise((function(t,e){var r={};n&&(r.version=n),ek.loadBundle(i,r,(function(i){i?e(i):t()}))}))}))):Promise.resolve([])},r.run=function(t){t&&(this.onStart=t),this.Sg&&this.resume()},r._calculateDT=function(t){if(this.Fg=t,t)return this.Dl=performance.now(),this.frameTime/1e3;var i=performance.now();return this.Lg=i>this.Dl?(i-this.Dl)/1e3:0,this.Lg>n.DEBUG_DT_THRESHOLD&&(this.Lg=this.frameTime/1e3),this.Dl=i,this.Lg},r.Xg=function(){var t=this;if(this.Sg)if(FL.instance&&!FL.instance.isFinished)FL.instance.update(this._calculateDT(!1));else if(this.Pg){FL.releaseInstance(),this.Pg=!1;var i,n=BL("launch","launchScene");n?xC.loadScene(n,(function(){it(1103,n),t.Cg=performance.now(),xC.startAnimation(),null==t.onStart||t.onStart()})):(this.Cg=performance.now(),xC.startAnimation(),null==(i=this.onStart)||i.call(this))}else xC.tick(this._calculateDT(!1))},r.Vg=function(){var t,i=null!==(t=BL("screen","frameRate"))&&void 0!==t?t:60;K("number"==typeof i),this.Ng=new jC,this.Ng.onTick=this.Xg.bind(this),this.frameRate=i},r.jg=function(){Bu.on("show",this.Yg,this),Bu.on("hide",this.Kg,this),Bu.on("close",this.qg,this)},r.Kg=function(){this.emit(n.EVENT_HIDE),this.Bg()},r.Yg=function(){this.emit(n.EVENT_SHOW),this.Dg()},r.qg=function(){this.emit(n.EVENT_CLOSE),Bu.exit()},r.addPersistRootNode=function(t){xC.addPersistRootNode(t)},r.removePersistRootNode=function(t){xC.removePersistRootNode(t)},r.isPersistRootNode=function(t){return xC.isPersistRootNode(t)},r.Wg=function(){var t=BL("rendering","customPipeline");return this.Qg(!!t)},r.Qg=function(t){xC.root.setRenderPipeline(t)?(this.Rg=!0,this.Ug(n.EVENT_RENDERER_INITED)):ut(1222)},r.Ug=function(t){this.emit(t)},e(n,[{key:"inited",get:function(){return this.Sg}},{key:"frameRate",get:function(){return this.Mg},set:function(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this.Mg=t,this.frameTime=1e3/t,this.Ng&&(this.Ng.targetFrameRate=this.Mg)}},{key:"deltaTime",get:function(){return this.Fg?this.frameTime/1e3:this.Lg}},{key:"totalTime",get:function(){return performance.now()-this.Cg}},{key:"frameStartTime",get:function(){return this.Dl}}]),n}(Ou));DL.EVENT_HIDE="game_on_hide",DL.EVENT_SHOW="game_on_show",DL.EVENT_LOW_MEMORY="game_on_low_memory",DL.EVENT_GAME_INITED="game_inited",DL.EVENT_ENGINE_INITED="engine_inited",DL.EVENT_RENDERER_INITED="renderer_inited",DL.EVENT_PRE_BASE_INIT="pre_base_init",DL.EVENT_POST_BASE_INIT="post_base_init",DL.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",DL.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",DL.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",DL.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",DL.EVENT_PRE_PROJECT_INIT="pre_project_init",DL.EVENT_POST_PROJECT_INIT="post_project_init",DL.EVENT_RESTART="game_on_restart",DL.EVENT_PAUSE="game_on_pause",DL.EVENT_RESUME="game_on_resume",DL.EVENT_CLOSE="game_on_close",DL.RENDER_TYPE_CANVAS=0,DL.RENDER_TYPE_WEBGL=1,DL.RENDER_TYPE_OPENGL=2,DL.RENDER_TYPE_HEADLESS=3,DL.DEBUG_DT_THRESHOLD=1,k.Game=DL;var UL=t("game",k.game=new DL);wt(UC.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),gt(UC.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]),dt(xC,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var i;return ek.main?null==(i=ek.main.getSceneInfo(t))?void 0:i.uuid:""}}]),wt(UL,"game",[{name:"collisionMatrix"},{name:"groupList"}]),dt(UL,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return ek.main&&ek.main.config.scenes.forEach((function(i){t.push(i)})),t}}]);var xL=t("DynamicAtlasManager",function(t){function i(){var i;return(i=t.call(this)||this).Zg=[],i.Jg=-1,i.tw=5,i.iw=2048,i.nw=512,i.ew=!0,i.fc=!1,i}s(i,t);var n=i.prototype;return n.rw=function(){var t=this.Zg[++this.Jg];return!t&&this.Jg<this.maxAtlasCount&&(t=new Cm(this.iw,this.iw),this.Zg.push(t)),t},n.sw=function(){this.reset()},n.init=function(){this.enabled=!Gi.CLEANUP_IMAGE_CACHE},n.insertSpriteFrame=function(t){if(!this.fc||this.Jg>=this.tw||!t||t.original)return null;if(!t.packable)return null;var i=t.texture.getSamplerInfo();if(2!==i.minFilter||2!==i.magFilter||0!==i.mipFilter)return null;var n=this.Zg[this.Jg];n||(n=this.rw());var e=n?n.insertSpriteFrame(t):null;return!e&&this.Jg<this.tw?(n=this.rw())?n.insertSpriteFrame(t):null:e},n.reset=function(){for(var t=0,i=this.Zg.length;t<i;t++)this.Zg[t].destroy();this.Zg.length=0,this.Jg=-1},n.deleteAtlasSpriteFrame=function(t){if(t.original){for(var i=this.Zg.length-1;i>=0;i--)this.Zg[i].removeSpriteFrame(t);var n=t.original._texture;this.deleteAtlasTexture(n)}},n.deleteAtlasTexture=function(t){if(t)for(var i=this.Zg.length-1;i>=0;i--)this.Zg[i].deleteInnerTexture(t),this.Zg[i].isEmpty()&&(this.Zg[i].destroy(),this.Zg.splice(i,1),this.Jg--)},n.packToDynamicAtlas=function(t,i){if(this.fc&&i&&!i.original&&i.packable&&i.texture&&i.texture.width>0&&i.texture.height>0){var n=this.insertSpriteFrame(i);n&&i.hw(n)}},e(i,[{key:"enabled",get:function(){return this.fc},set:function(t){this.fc!==t&&(t?(this.reset(),xC.on("director_before_scene_launch",this.sw,this)):(this.reset(),xC.off("director_before_scene_launch",this.sw,this)),this.fc=t)}},{key:"maxAtlasCount",get:function(){return this.tw},set:function(t){this.tw=t}},{key:"atlasCount",get:function(){return this.Zg.length}},{key:"textureBleeding",get:function(){return this.ew},set:function(t){this.ew=t}},{key:"textureSize",get:function(){return this.iw},set:function(t){this.iw=t}},{key:"maxFrameSize",get:function(){return this.nw},set:function(t){this.nw=t}}]),i}(Pv));xL.instance=void 0;var GL=t("dynamicAtlasManager",xL.instance=new xL);xC.registerSystem("dynamicAtlasManager",GL,0),k.internal.dynamicAtlasManager=GL;var jL={positions:"a_position",normals:"a_normal",uvs:"a_texCoord",colors:"a_color"},HL=function(){function t(){this.uw=[],this.ur=0}var i=t.prototype;return i.ow=function(t){if(0!==t){var i=this.ur%t;if(0!==i){var n=t-i;this.uw.push(n),this.ur+=n}}},i.aw=function(t){var i=this.ur;return this.uw.push(t),this.ur+=t.byteLength,i},i.cw=function(){return this.ur},i.fw=function(){var t=new Uint8Array(this.ur),i=0;return this.uw.forEach((function(n){"number"==typeof n?i+=n:(t.set(new Uint8Array(n),i),i+=n.byteLength)})),t.buffer},t}();function VL(t,i){return new $L(t,i)}var $L=function(){function t(t,i){if(this.lw=[],this.dw=t,this.dw.struct.morph){var n=this.dw.struct.primitives.length;this.lw=new Array(n).fill(null);for(var e=0;e<n;++e){var r=this.dw.struct.morph.subMeshMorphs[e];r&&(r.targets.length>60?this.lw[e]=new zL(this.dw,e,this.dw.struct.morph,i):this.lw[e]=new WL(this.dw,e,this.dw.struct.morph,i))}}}return t.prototype.createInstance=function(){for(var t=this,i=this.dw.struct.primitives.length,n=new Array(i),e=0;e<i;++e){var r,s;n[e]=null!==(r=null==(s=this.lw[e])?void 0:s.createInstance())&&void 0!==r?r:null}return{setWeights:function(t,i){var e;null==(e=n[t])||e.setWeights(i)},requiredPatches:function(i){t.dw.struct.morph;var e=t.dw.struct.morph.subMeshMorphs[i],r=n[i];if(null===r)return null;var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:e.targets.length}];return e.attributes.includes("a_position")&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),e.attributes.includes("a_normal")&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),e.attributes.includes("a_tangent")&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,r.requiredPatches()),s},adaptPipelineState:function(t,i){var e;null==(e=n[t])||e.adaptPipelineState(i)},destroy:function(){n.forEach((function(t){t&&t.destroy()}))}}},t}(),WL=function(){function t(t,i,n,e){this.be=e;var r=n.subMeshMorphs[i];this.gw=r,qL(t,i,e);var s=t.struct.vertexBundles[t.struct.primitives[i].vertexBundelIndices[0]].view.count;this.ww=s;var h=r.targets.length,u=KL(e,s*h);this._w={width:u.width,height:u.height},this.jn=r.attributes.map((function(i,n){var e=u.create(),h=e.valueView;return r.targets.forEach((function(i,e){for(var r=i.displacements[n],u=new Float32Array(t.data.buffer,t.data.byteOffset+r.offset,r.count),o=s*e*4,a=0;a<s;++a)h[o+4*a+0]=u[3*a+0],h[o+4*a+1]=u[3*a+1],h[o+4*a+2]=u[3*a+2]})),e.updatePixels(),{name:i,morphTexture:e}}))}var i=t.prototype;return i.destroy=function(){this.jn.forEach((function(t){t.morphTexture.destroy()}))},i.createInstance=function(){var t=this,i=new YL(this.be,this.gw.targets.length);return i.setMorphTextureInfo(this._w.width,this._w.height),i.setVerticesCount(this.ww),i.commit(),{setWeights:function(t){i.setWeights(t),i.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(n){for(var e=0;e<t.jn.length;++e){var r=t.jn[e],s=void 0;switch(r.name){case"a_position":s=8;break;case"a_normal":s=9;break;case"a_tangent":s=10;break;default:st(16374)}void 0!==s&&(n.bindSampler(s,r.morphTexture.sampler),n.bindTexture(s,r.morphTexture.texture))}n.bindBuffer(Xy.BINDING,i.buffer),n.update()},destroy:function(){}}},t}(),zL=function(){function t(t,i,n,e){this.jn=[],this.be=e;var r=n.subMeshMorphs[i];qL(t,i,e),this.jn=r.attributes.map((function(i,n){return{name:i,targets:r.targets.map((function(i){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+i.displacements[n].offset,i.displacements[n].count)}}))}}))}return t.prototype.createInstance=function(){return new XL(this,this.jn[0].targets[0].displacements.length/3,this.be)},e(t,[{key:"data",get:function(){return this.jn}}]),t}(),XL=function(){function t(t,i,n){this.Lu=t,this.mw=new YL(n,0);var e=KL(n,i);this.mw.setMorphTextureInfo(e.width,e.height),this.mw.commit(),this.jn=this.Lu.data.map((function(t){var i=e.create();return{attributeName:t.name,morphTexture:i}}))}var i=t.prototype;return i.setWeights=function(t){for(var i=0;i<this.jn.length;++i){var n=this.jn[i],e=n.morphTexture.valueView,r=this.Lu.data[i];t.length,r.targets.length;for(var s=0;s<r.targets.length;++s){var h=r.targets[s].displacements,u=t[s],o=h.length/3;if(0===s)for(var a=0;a<o;++a)e[4*a+0]=h[3*a+0]*u,e[4*a+1]=h[3*a+1]*u,e[4*a+2]=h[3*a+2]*u;else if(0!==u)for(var c=0;c<o;++c)e[4*c+0]+=h[3*c+0]*u,e[4*c+1]+=h[3*c+1]*u,e[4*c+2]+=h[3*c+2]*u}n.morphTexture.updatePixels()}},i.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},i.adaptPipelineState=function(t){for(var i=0;i<this.jn.length;++i){var n=this.jn[i],e=void 0;switch(n.attributeName){case"a_position":e=8;break;case"a_normal":e=9;break;case"a_tangent":e=10;break;default:st(16374)}void 0!==e&&(t.bindSampler(e,n.morphTexture.sampler),t.bindTexture(e,n.morphTexture.texture))}t.bindBuffer(Xy.BINDING,this.mw.buffer),t.update()},i.destroy=function(){this.mw.destroy();for(var t=0;t<this.jn.length;++t)this.jn[t].morphTexture.destroy()},t}(),YL=function(){function t(t,i){this.pw=i,this.yw=new DataView(new ArrayBuffer(256)),this.bw=t.createBuffer(new ud(18,3,256,256))}var i=t.prototype;return i.destroy=function(){this.bw.destroy()},i.setWeights=function(t){t.length,this.pw;for(var i=k.sys.isLittleEndian,n=0;n<t.length;++n)this.yw.setFloat32(0+4*n,t[n],i)},i.setMorphTextureInfo=function(t,i){var n=k.sys.isLittleEndian;this.yw.setFloat32(240,t,n),this.yw.setFloat32(244,i,n)},i.setVerticesCount=function(t){var i=k.sys.isLittleEndian;this.yw.setFloat32(248,t,i)},i.commit=function(){this.bw.update(this.yw.buffer)},e(t,[{key:"buffer",get:function(){return this.bw}}]),t}();function KL(t,i){var n,e,r,s;2&t.getFormatFeatures(44)?(n=i,r=16,e=44,s=Float32Array):(n=4*i,r=4,e=35,s=Uint8Array);var h=QL(n),u=h.width,o=h.height;return{width:u,height:o,create:function(){var i=new ArrayBuffer(u*o*r),n=new Float32Array(i),h=s===Float32Array?n:new s(i),a=new jw({width:u,height:o,_data:h,_compressed:!1,format:e}),c=new Mm;c.setFilters(1,1),c.setMipFilter(0),c.setWrapMode(2,2,2),c.image=a,c.getGFXTexture()||st(16375);var f=t.getSampler(c.getSamplerInfo());return{get texture(){return c.getGFXTexture()},get sampler(){return f},get valueView(){return n},destroy:function(){c.destroy()},updatePixels:function(){c.uploadData(h)}}}}}function qL(t,i,n){t.renderingSubMeshes[i].enableVertexIdChannel(n)}function QL(t){t<5&&(t=5);var i=N(fe(t)),n=i>>1;return{width:1<<(1&i?n+1:n),height:1<<n}}function ZL(t,n){return(e=t,new Promise((function(t,n){try{e=new URL(e,i.meta.url).href,fetch(e).then((function(i){return i.arrayBuffer().then(t)})).catch((function(){}))}catch(t){n(t)}}))).then((function(t){return WebAssembly.instantiate(t,n)}));var e}var JL={};UL.onPostInfrastructureInitDelegate.add((function(){return Promise.resolve().then((function(){return ho.hasFeature(ho.Feature.WASM)?Promise.all([i.import("./meshopt_decoder.wasm-Bwb0TT2g.js"),i.import("./meshopt_decoder.wasm-Cvy1kpGq.js")]).then((function(t){var i,n,e=t[0].default,r=t[1].default;return i=e,n=r,Promise.all([i.ready((function(t){return ZL(n,t)}))]).then((function(){JL.Aw=i.supported,JL.Ew=Promise.resolve(),JL.kw=i.decodeVertexBuffer,JL.Tw=i.decodeIndexBuffer,JL.Sw=i.decodeIndexSequence,JL.Ow=i.decodeGltfBuffer,JL.Rw=i.useWorkers,JL.Iw=i.decodeGltfBufferAsync,it(14203)}))})):i.import("./meshopt_decoder.asm-BXi3StfG.js").then((function(t){return t.m})).then((function(t){var i,n=t.default;return i=n,Promise.all([i.ready]).then((function(){JL.Aw=i.supported,JL.Ew=Promise.resolve(),JL.kw=i.decodeVertexBuffer,JL.Tw=i.decodeIndexBuffer,JL.Sw=i.decodeIndexSequence,JL.Ow=i.decodeGltfBuffer,JL.Rw=i.useWorkers,JL.Iw=i.decodeGltfBufferAsync,it(14202)}))}))})).catch((function(t){Y(t)}))}));var tF={};(function(){function t(t){throw t}var i=void 0,n=this;function e(t,e){var r,s=t.split("."),h=n;!(s[0]in h)&&h.execScript&&h.execScript("var "+s[0]);for(;s.length&&(r=s.shift());)s.length||e===i?h=h[r]?h[r]:h[r]={}:h[r]=e}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(t){var i,n,e,s,h,u,o,a,c,f,v=t.length,l=0,d=Number.POSITIVE_INFINITY;for(a=0;a<v;++a)t[a]>l&&(l=t[a]),t[a]<d&&(d=t[a]);for(i=1<<l,n=new(r?Uint32Array:Array)(i),e=1,s=0,h=2;e<=l;){for(a=0;a<v;++a)if(t[a]===e){for(u=0,o=s,c=0;c<e;++c)u=u<<1|1&o,o>>=1;for(f=e<<16|a,c=u;c<i;c+=h)n[c]=f;++s}++e,s<<=1,h<<=1}return[n,l,d]}function h(i,n){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.j=0,this.input=r?new Uint8Array(i):i,this.k=!1,this.e=o,this.o=!1,!n&&(n={})||(n.index&&(this.a=n.index),n.bufferSize&&(this.h=n.bufferSize),n.bufferType&&(this.e=n.bufferType),n.resize&&(this.o=n.resize)),this.e){case u:this.b=32768,this.c=new(r?Uint8Array:Array)(32768+this.h+258);break;case o:this.b=0,this.c=new(r?Uint8Array:Array)(this.h);break;default:t(Error("invalid inflate mode"))}}var u=0,o=1,a={q:u,p:o};h.prototype.i=function(){for(;!this.k;){var n=R(this,3);switch(1&n&&(this.k=!0),n>>>=1){case 0:var e=this.input,h=this.a,a=this.c,c=this.b,f=e.length,v=i,d=a.length,g=i;switch(this.d=this.f=0,h+1>=f&&t(Error("invalid uncompressed block header: LEN")),v=e[h++]|e[h++]<<8,h+1>=f&&t(Error("invalid uncompressed block header: NLEN")),v===~(e[h++]|e[h++]<<8)&&t(Error("invalid uncompressed block header: length verify")),h+v>e.length&&t(Error("input buffer is broken")),this.e){case u:for(;c+v>a.length;){if(v-=g=d-c,r)a.set(e.subarray(h,h+g),c),c+=g,h+=g;else for(;g--;)a[c++]=e[h++];this.b=c,a=C(this),c=this.b}break;case o:for(;c+v>a.length;)a=L(this,{m:2});break;default:t(Error("invalid inflate mode"))}if(r)a.set(e.subarray(h,h+v),c),c+=v,h+=v;else for(;v--;)a[c++]=e[h++];this.a=h,this.b=c,this.c=a;break;case 1:switch(this.e){case o:N(this,T,O);break;case u:M(this,T,O);break;default:t(Error("invalid inflate mode"))}break;case 2:var w,_,m,p,y=R(this,5)+257,b=R(this,5)+1,A=R(this,4)+4,E=new(r?Uint8Array:Array)(l.length),k=i,S=i,F=i,P=i,B=i;for(B=0;B<A;++B)E[l[B]]=R(this,3);if(!r)for(B=A,A=E.length;B<A;++B)E[l[B]]=0;for(w=s(E),k=new(r?Uint8Array:Array)(y+b),B=0,p=y+b;B<p;)switch(S=I(this,w),S){case 16:for(P=3+R(this,2);P--;)k[B++]=F;break;case 17:for(P=3+R(this,3);P--;)k[B++]=0;F=0;break;case 18:for(P=11+R(this,7);P--;)k[B++]=0;F=0;break;default:F=k[B++]=S}switch(_=s(r?k.subarray(0,y):k.slice(0,y)),m=s(r?k.subarray(y):k.slice(y)),this.e){case o:N(this,_,m);break;case u:M(this,_,m);break;default:t(Error("invalid inflate mode"))}break;default:t(Error("unknown BTYPE: "+n))}}switch(this.e){case u:var D,U,x,G,j,H,V=0,$=this.c,W=this.g,z=new(r?Uint8Array:Array)(this.j+(this.b-32768));if(0===W.length)D=r?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);else{for(x=0,G=W.length;x<G;++x)for(j=0,H=(U=W[x]).length;j<H;++j)z[V++]=U[j];for(x=32768,G=this.b;x<G;++x)z[V++]=$[x];this.g=[],D=this.buffer=z}return D;case o:var X,Y=this.b;return r?this.o?(X=new Uint8Array(Y)).set(this.c.subarray(0,Y)):X=this.c.subarray(0,Y):(this.c.length>Y&&(this.c.length=Y),X=this.c),this.buffer=X;default:t(Error("invalid inflate mode"))}};var c,f,v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=r?new Uint16Array(v):v,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],g=r?new Uint16Array(d):d,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],_=r?new Uint8Array(w):w,m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],p=r?new Uint16Array(m):m,y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=r?new Uint8Array(y):y,A=new(r?Uint8Array:Array)(288);for(c=0,f=A.length;c<f;++c)A[c]=143>=c?8:255>=c?9:279>=c?7:8;var E,k,T=s(A),S=new(r?Uint8Array:Array)(30);for(E=0,k=S.length;E<k;++E)S[E]=5;var O=s(S);function R(i,n){var e,r=i.f,s=i.d,h=i.input,u=i.a;for(u+(n-s+7>>3)>=h.length&&t(Error("input buffer is broken"));s<n;)r|=h[u++]<<s,s+=8;return e=r&(1<<n)-1,i.f=r>>>n,i.d=s-n,i.a=u,e}function I(i,n){for(var e,r,s=i.f,h=i.d,u=i.input,o=i.a,a=u.length,c=n[0],f=n[1];h<f&&!(o>=a);)s|=u[o++]<<h,h+=8;return(r=(e=c[s&(1<<f)-1])>>>16)>h&&t(Error("invalid code length: "+r)),i.f=s>>r,i.d=h-r,i.a=o,65535&e}function M(t,i,n){var e=t.c,r=t.b;t.l=i;for(var s,h,u,o,a=e.length-258;256!==(s=I(t,i));)if(256>s)r>=a&&(t.b=r,e=C(t),r=t.b),e[r++]=s;else for(o=g[h=s-257],0<_[h]&&(o+=R(t,_[h])),s=I(t,n),u=p[s],0<b[s]&&(u+=R(t,b[s])),r>=a&&(t.b=r,e=C(t),r=t.b);o--;)e[r]=e[r++-u];for(;8<=t.d;)t.d-=8,t.a--;t.b=r}function N(t,i,n){var e=t.c,r=t.b;t.l=i;for(var s,h,u,o,a=e.length;256!==(s=I(t,i));)if(256>s)r>=a&&(a=(e=L(t)).length),e[r++]=s;else for(o=g[h=s-257],0<_[h]&&(o+=R(t,_[h])),s=I(t,n),u=p[s],0<b[s]&&(u+=R(t,b[s])),r+o>a&&(a=(e=L(t)).length);o--;)e[r]=e[r++-u];for(;8<=t.d;)t.d-=8,t.a--;t.b=r}function C(t){var i,n,e=new(r?Uint8Array:Array)(t.b-32768),s=t.b-32768,h=t.c;if(r)e.set(h.subarray(32768,e.length));else for(i=0,n=e.length;i<n;++i)e[i]=h[i+32768];if(t.g.push(e),t.j+=e.length,r)h.set(h.subarray(s,s+32768));else for(i=0;32768>i;++i)h[i]=h[s+i];return t.b=32768,h}function L(t,i){var n,e,s,h=t.input.length/t.a+1|0,u=t.input,o=t.c;return i&&("number"==typeof i.m&&(h=i.m),"number"==typeof i.r&&(h+=i.r)),e=2>h?(s=(u.length-t.a)/t.l[2]/2*258|0)<o.length?o.length+s:o.length<<1:o.length*h,r?(n=new Uint8Array(e)).set(o):n=o,t.c=n,t.c}function F(i,n){var e,r;this.input=i,this.a=0,!n&&(n={})||(n.index&&(this.a=n.index),n.verify&&(this.s=n.verify)),e=i[this.a++],r=i[this.a++],(15&e)===P?this.method=P:t(Error("unsupported compression method")),0!=((e<<8)+r)%31&&t(Error("invalid fcheck flag:"+((e<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.n=new h(i,{index:this.a,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}F.prototype.i=function(){var i,n,e=this.input;if(i=this.n.i(),this.a=this.n.a,this.s){n=(e[this.a++]<<24|e[this.a++]<<16|e[this.a++]<<8|e[this.a++])>>>0;var r=i;if("string"==typeof r){var s,h,u=r.split("");for(s=0,h=u.length;s<h;s++)u[s]=(255&u[s].charCodeAt(0))>>>0;r=u}for(var o,a=1,c=0,f=r.length,v=0;0<f;){f-=o=1024<f?1024:f;do{c+=a+=r[v++]}while(--o);a%=65521,c%=65521}n!==(c<<16|a)>>>0&&t(Error("invalid adler-32 checksum"))}return i};var P=8;e("Zlib.Inflate",F),e("Zlib.Inflate.prototype.decompress",F.prototype.i);var B,D,U,x,G={ADAPTIVE:a.p,BLOCK:a.q};if(Object.keys)B=Object.keys(G);else for(D in B=[],U=0,G)B[U++]=D;for(U=0,x=B.length;U<x;++U)e("Zlib.Inflate.BufferType."+(D=B[U]),G[D])}).call(tF);var iF,nF,eF,rF,sF,hF=tF.Zlib;hF.Inflate=hF.Inflate,hF.Inflate.BufferType=hF.Inflate.BufferType,hF.Inflate.prototype.decompress=hF.Inflate.prototype.decompress;var uF=ir.add,oF=ir.multiplyScalar,aF=ir.subtract,cF=wo.transform,fF=wo.fromPoints,vF=ir.max,lF=ir.min,dF=ir.transformQuat,gF=ir.transformMat4;function wF(t){switch(t){case 1:default:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}}var _F=new ir,mF=new ir,pF=new Uint8Array,yF=t("Mesh",Ko("cc.Mesh")((nF=function(t){function i(i){var n;return(n=t.call(this,i)||this).morphRendering=null,n._struct=eF&&eF(),n._hash=rF&&rF(),n.I=pF,n.Mw=!1,n._allowDataAccess=sF&&sF(),n.Nw=!1,n.Cw=null,n.Lw=new Map,n.Fw=null,n}s(i,t);var n=i.prototype;return n.onLoaded=function(){this.initialize()},n.initialize=function(){if(!this.Mw){this.Mw=!0;var t={struct:this.struct,data:this.data};if(t.struct.compressed&&(t=OF(t)),this.struct.encoded&&(t=SF(t)),!this.struct.quantized||16&Hg.gfxDevice.getFormatFeatures(29)||(t=RF(t)),this._struct=t.struct,this.I=t.data,this._struct.dynamic){for(var i=Hg.gfxDevice,n=[],e=[],r=0;r<this._struct.vertexBundles.length;r++){var s=this._struct.vertexBundles[r],h=i.createBuffer(new ud(10,1,s.view.length,s.view.stride));n.push(h)}for(var u=0;u<this._struct.primitives.length;u++){var o=this._struct.primitives[u],a=o.indexView,c=null;a&&(c=i.createBuffer(new ud(6,1,a.length,a.stride)));for(var f=[],v=0;v<o.vertexBundelIndices.length;v++){var l=o.vertexBundelIndices[v];f.push(n[l])}for(var d=[],g=0;g<o.vertexBundelIndices.length;g++)for(var w=o.vertexBundelIndices[g],_=this._struct.vertexBundles[w].attributes,m=0;m<_.length;m++){var p=_[m],y=new kd;y.copy(p),d.push(y)}var b=new qC(f,d,o.primitiveMode,c);b.drawInfo=new ad,b.mesh=this,b.subMeshIdx=u,e.push(b)}this.Cw=e}else{for(var A=this.I.buffer,E=Hg.gfxDevice,k=this.Pw(E,A),T=[],S=[],O=0;O<this._struct.primitives.length;O++){var R=this._struct.primitives[O];if(0!==R.vertexBundelIndices.length){var I=null,M=void 0;if(R.indexView){var N=R.indexView,C=N.stride,L=N.length;if(4===C&&!E.hasFeature(0)){var F=this._struct.vertexBundles[R.vertexBundelIndices[0]].view.count;if(F>=65536){st(10001,F,65536);continue}C>>=1,L>>=1}I=E.createBuffer(new ud(4,1,L,C)),T.push(I),M=new(wF(N.stride))(A,N.offset,N.count),N.stride!==C&&(M=wF(C).from(M)),I.update(M)}var P=R.vertexBundelIndices.map((function(t){return k[t]})),B=[];if(R.vertexBundelIndices.length>0)for(var D=R.vertexBundelIndices[0],U=this._struct.vertexBundles[D].attributes,x=0;x<U.length;++x){var G=U[x];B[x]=new kd(G.name,G.format,G.isNormalized,G.stream,G.isInstanced,G.location)}var j=new qC(P,B,R.primitiveMode,I);j.mesh=this,j.subMeshIdx=O,S.push(j)}}this.Cw=S,this._struct.morph&&(this.morphRendering=VL(this,E)),this.Nw=!0,this._allowDataAccess||this.Bw()}}},n.updateSubMesh=function(t,i){if(this._struct.dynamic)if(t>=this._struct.primitives.length)st(14201);else{var n=[];if(i.positions.length>0&&n.push(i.positions),i.normals&&i.normals.length>0&&n.push(i.normals),i.uvs&&i.uvs.length>0&&n.push(i.uvs),i.tangents&&i.tangents.length>0&&n.push(i.tangents),i.colors&&i.colors.length>0&&n.push(i.colors),i.customAttributes)for(var e=0;e<i.customAttributes.length;e++)n.push(i.customAttributes[e].values);for(var r=this._struct.dynamic,s=r.info,h=this._struct.primitives[t],u=this.Cw[t],o=u.drawInfo,a=0;a<n.length;a++){var c=n[a],f=this._struct.vertexBundles[h.vertexBundelIndices[a]],v=f.view.stride,l=c.byteLength/v,d=c.byteLength,g=new Uint8Array(this.I.buffer,f.view.offset,d),w=new Uint8Array(c.buffer,c.byteOffset,d),_=u.vertexBuffers[a];s.maxSubMeshVertices,d>0&&(g.set(w),_.update(w,d)),f.view.count=l,o.vertexCount=l}if(h.indexView){var m=h.indexView,p=m.stride,y=2===p?i.indices16.length:i.indices32.length,b=y*p,A=new Uint8Array(this.I.buffer,m.offset,b),E=2===p?new Uint8Array(i.indices16.buffer,i.indices16.byteOffset,b):new Uint8Array(i.indices32.buffer,i.indices32.byteOffset,b),k=u.indexBuffer;s.maxSubMeshIndices,b>0&&(A.set(E),k.update(E,b)),m.count=y,o.indexCount=y}if(i.minPos&&i.maxPos){var T=nr(i.minPos.x,i.minPos.y,i.minPos.z),S=nr(i.maxPos.x,i.maxPos.y,i.maxPos.z);r.bounds[t]||(r.bounds[t]=new wo),fF(r.bounds[t],T,S);var O=nr(),R=nr();r.bounds.forEach((function(t){t&&(t.getBoundary(O,R),lF(T,O,T),vF(S,R,S))})),this._struct.minPosition=nr(T.x,T.y,T.z),this._struct.maxPosition=nr(S.x,S.y,S.z)}u.invalidateGeometricInfo()}else st(14200)},n.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},n.destroyRenderingMesh=function(){if(this.Cw){for(var t=0;t<this.Cw.length;t++)this.Cw[t].destroy();this.Cw=null,this.Mw=!1,this.Nw=!1}},n.assign=function(t,i){this.reset({struct:t,data:i})},n.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this.I=t.data,this._hash=0},n.getBoneSpaceBounds=function(t){if(this.Lw.has(t.hash))return this.Lw.get(t.hash);var i=[];this.Lw.set(t.hash,i);for(var n=[],e=t.bindposes,r=0;r<e.length;r++)i.push(new wo(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);for(var s=this._struct.primitives,h=0;h<s.length;h++){var u=this.readAttribute(h,"a_joints"),o=this.readAttribute(h,"a_weights"),a=this.readAttribute(h,"a_position");if(u&&o&&a)for(var c=Math.min(u.length/4,o.length/4,a.length/3),f=0;f<c;f++){ir.set(_F,a[3*f+0],a[3*f+1],a[3*f+2]);for(var v=0;v<4;++v){var l=4*f+v,d=u[l];if(!(0===o[l]||d>=e.length)){gF(mF,_F,e[d]),n[d]=!0;var g=i[d];lF(g.center,g.center,mF),vF(g.halfExtents,g.halfExtents,mF)}}}}for(var w=0;w<e.length;w++){var _=i[w];n[w]?fF(_,_.center,_.halfExtents):i[w]=null}return i},n.merge=function(t,i,n){if(n&&!this.validateMergingMesh(t))return!1;var e=new ir,r=i&&new Cr,s=i&&new wo;if(r&&i.getRotation(r),!this.Mw){var h=JSON.parse(JSON.stringify(t._struct)),u=t.I.slice();if(i){h.maxPosition&&h.minPosition&&(uF(s.center,h.maxPosition,h.minPosition),oF(s.center,s.center,.5),aF(s.halfExtents,h.maxPosition,h.minPosition),oF(s.halfExtents,s.halfExtents,.5),cF(s,s,i),uF(h.maxPosition,s.center,s.halfExtents),aF(h.minPosition,s.center,s.halfExtents));for(var o=0;o<h.vertexBundles.length;o++)for(var a=h.vertexBundles[o],c=0;c<a.attributes.length;c++)if("a_position"===a.attributes[c].name||"a_normal"===a.attributes[c].name){var f=a.attributes[c].format,v=new DataView(u.buffer,a.view.offset+bF(a.attributes,c)),l=kF(v,f),g=TF(v,f);if(!l||!g)continue;for(var w=a.view.count,_=a.view.stride,m=EF(f),p=0;p<w;p++){var y=p*_,b=y+m,A=b+m;switch(e.set(l(y),l(b),l(A)),a.attributes[c].name){case"a_position":e.transformMat4(i);break;case"a_normal":dF(e,e,r)}g(y,e.x),g(b,e.y),g(A,e.z)}}}return this.reset({struct:h,data:u}),this.initialize(),!0}for(var E,k,T,S,O,R=new HL,I=0,M=0,N=0,C=0,L=0,F=0,P=0,B=0,D=!1,U=new Array(this._struct.vertexBundles.length),x=0;x<this._struct.vertexBundles.length;++x){var G=this._struct.vertexBundles[x],j=t._struct.vertexBundles[x];N=G.view.offset,C=j.view.offset,M=G.view.stride,I=G.view.count+j.view.count,E=new ArrayBuffer(I*M),k=new Uint8Array(E),N+=(T=this.I.subarray(N,N+G.view.length)).length,C+=(S=t.I.subarray(C,C+j.view.length)).length,k.set(T),L=0;for(var H,V=d(G.attributes);!(H=V()).done;){var $=H.value;P=0,D=!1;for(var W,z=d(j.attributes);!(W=z()).done;){var X=W.value;if($.name===X.name&&$.format===X.format){D=!0;break}P+=tg[X.format].size}if(D){B=tg[$.format].size,F=G.view.length+L;for(var Y=0;Y<j.view.count;++Y){if(O=S.subarray(P,P+B),k.set(O,F),("a_position"===$.name||"a_normal"===$.name)&&i){var K=new Float32Array(k.buffer,F,3);switch(e.set(K[0],K[1],K[2]),$.name){case"a_position":e.transformMat4(i);break;case"a_normal":dF(e,e,r)}K[0]=e.x,K[1]=e.y,K[2]=e.z}F+=G.view.stride,P+=j.view.stride}}L+=tg[$.format].size}U[x]={attributes:G.attributes,view:{offset:R.cw(),length:E.byteLength,count:I,stride:M}},R.aw(E)}for(var q,Q,Z,J=0,tt=2,it=new Array(this._struct.primitives.length),nt=0;nt<this._struct.primitives.length;++nt){var et=this._struct.primitives[nt],rt=t._struct.primitives[nt];it[nt]={primitiveMode:et.primitiveMode,vertexBundelIndices:et.vertexBundelIndices};for(var st,ht=0,ut=d(et.vertexBundelIndices);!(st=ut()).done;){var ot=st.value;ht=Math.max(ht,this._struct.vertexBundles[ot].view.count)}if(et.indexView&&rt.indexView){J=et.indexView.count,J+=rt.indexView.count,N=et.indexView.offset,C=rt.indexView.offset,tt=J<256?1:J<65536?2:4;var at=new ArrayBuffer(J*tt);if(q=2===tt?new Uint16Array(at):1===tt?new Uint8Array(at):new Uint32Array(at),Q=2===et.indexView.stride?new Uint16Array(this.I.buffer,N,et.indexView.count):1===et.indexView.stride?new Uint8Array(this.I.buffer,N,et.indexView.count):new Uint32Array(this.I.buffer,N,et.indexView.count),tt===et.indexView.stride)q.set(Q);else for(var ct=0;ct<et.indexView.count;++ct)q[ct]=Q[ct];N+=et.indexView.length,Z=2===rt.indexView.stride?new Uint16Array(t.I.buffer,C,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(t.I.buffer,C,rt.indexView.count):new Uint32Array(t.I.buffer,C,rt.indexView.count);for(var ft=0;ft<rt.indexView.count;++ft)q[et.indexView.count+ft]=ht+Z[ft];C+=rt.indexView.length,it[nt].indexView={offset:R.cw(),length:at.byteLength,count:J,stride:tt},R.ow(tt),R.aw(at)}}var vt={vertexBundles:U,primitives:it,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return vt.minPosition&&t._struct.minPosition&&vt.maxPosition&&t._struct.maxPosition&&(i?(uF(s.center,t._struct.maxPosition,t._struct.minPosition),oF(s.center,s.center,.5),aF(s.halfExtents,t._struct.maxPosition,t._struct.minPosition),oF(s.halfExtents,s.halfExtents,.5),cF(s,s,i),uF(e,s.center,s.halfExtents),vF(vt.maxPosition,vt.maxPosition,e),aF(e,s.center,s.halfExtents),lF(vt.minPosition,vt.minPosition,e)):(lF(vt.minPosition,vt.minPosition,t._struct.minPosition),vF(vt.maxPosition,vt.maxPosition,t._struct.maxPosition))),this.reset({struct:vt,data:new Uint8Array(R.fw())}),this.initialize(),!0},n.validateMergingMesh=function(t){if(this._struct.dynamic||t._struct.dynamic)return!1;if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var i=0;i<this._struct.vertexBundles.length;++i){var n=this._struct.vertexBundles[i],e=t._struct.vertexBundles[i];if(n.attributes.length!==e.attributes.length)return!1;for(var r=0;r<n.attributes.length;++r)if(n.attributes[r].format!==e.attributes[r].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var h=this._struct.primitives[s],u=t._struct.primitives[s];if(h.vertexBundelIndices.length!==u.vertexBundelIndices.length)return!1;for(var o=0;o<h.vertexBundelIndices.length;++o)if(h.vertexBundelIndices[o]!==u.vertexBundelIndices[o])return!1;if(h.primitiveMode!==u.primitiveMode)return!1;if(h.indexView){if(void 0===u.indexView)return!1}else if(u.indexView)return!1}return!0},n.readAttribute=function(t,i){var n=this,e=null;return this.Dw(t,i,(function(t,i){var r=t.view.count,s=t.attributes[i].format,h=ag(tg[s]);if(0!==r){var u=new DataView(n.I.buffer,t.view.offset+bF(t.attributes,i)),o=tg[s],a=kF(u,s);if(h&&a){for(var c=o.count,f=new h(r*c),v=t.view.stride,l=0;l<r;++l)for(var d=0;d<c;++d)f[c*l+d]=a(v*l+f.BYTES_PER_ELEMENT*d);e=f}}})),e},n.copyAttribute=function(t,i,n,e,r){var s=this,h=!1;return this.Dw(t,i,(function(t,i){var u=t.view.count;if(0!==u){var o=t.attributes[i].format,a=new DataView(s.I.buffer,t.view.offset+bF(t.attributes,i)),c=new DataView(n,r),f=tg[o],v=kF(a,o),l=TF(c,o);if(v&&l){for(var d=f.count,g=t.view.stride,w=EF(o),_=e,m=w,p=0;p<u;++p)for(var y=0;y<d;++y)l(_*p+m*y,v(g*p+w*y));h=!0}}else h=!0})),h},n.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var i=this._struct.primitives[t];if(!i.indexView)return null;var n=i.indexView.stride;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this.I.buffer,i.indexView.offset,i.indexView.count)},n.copyIndices=function(t,i){if(t>=this._struct.primitives.length)return!1;var n=this._struct.primitives[t];if(!n.indexView)return!1;for(var e=n.indexView.count,r=1===n.indexView.stride?6:2===n.indexView.stride?9:12,s=kF(new DataView(this.I.buffer),r),h=0;h<e;++h)i[h]=s(n.indexView.offset+tg[r].size*h);return!0},n.readAttributeFormat=function(t,i){var n=null;return this.Dw(t,i,(function(t,i){var e=t.attributes[i].format;n=tg[e]})),n},n.Dw=function(t,i,n){if(!(t>=this._struct.primitives.length))for(var e=this._struct.primitives[t].vertexBundelIndices,r=0;r<e.length;r++){var s=e[r],h=this._struct.vertexBundles[s],u=h.attributes.findIndex((function(t){return t.name===i}));if(!(u<0)){n(h,u);break}}},n.Pw=function(t,i){return this._struct.vertexBundles.map((function(n){var e=t.createBuffer(new ud(8,1,n.view.length,n.view.stride)),r=new Uint8Array(i,n.view.offset,n.view.length);return e.update(r),e}))},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.reset({struct:{vertexBundles:[],primitives:[]},data:pF})},n.Bw=function(){this.I=pF},e(i,[{key:"_nativeAsset",get:function(){return this.I.buffer},set:function(t){this.I=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this.I}},{key:"hash",get:function(){return this._hash||(this._hash=Wv(this.I,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this.Fw?this.Fw:this.Fw=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this.Cw}},{key:"allowDataAccess",get:function(){return this._allowDataAccess},set:function(t){this._allowDataAccess=t,this.Nw&&!this._allowDataAccess&&this.Bw()}}]),i}(kw),eF=xo(nF.prototype,"_struct",[oa],(function(){return{vertexBundles:[],primitives:[]}})),rF=xo(nF.prototype,"_hash",[oa],(function(){return 0})),sF=xo(nF.prototype,"_allowDataAccess",[oa],(function(){return!0})),iF=nF))||iF);function bF(t,i){for(var n=0,e=0;e<i;++e){var r=t[e];n+=tg[r.format].size}return n}k.Mesh=yF;var AF=ho.isLittleEndian;function EF(t){var i=tg[t];return i.size/i.count}function kF(t,i){var n=tg[i],e=n.size/n.count;switch(n.type){case 1:case 3:switch(e){case 1:return function(i){return t.getUint8(i)};case 2:return function(i){return t.getUint16(i,AF)};case 4:return function(i){return t.getUint32(i,AF)}}break;case 2:case 4:switch(e){case 1:return function(i){return t.getInt8(i)};case 2:return function(i){return t.getInt16(i,AF)};case 4:return function(i){return t.getInt32(i,AF)}}break;case 6:switch(e){case 2:return function(i){return t.getUint16(i,AF)};case 4:return function(i){return t.getFloat32(i,AF)}}}return null}function TF(t,i){var n=tg[i],e=n.size/n.count;switch(n.type){case 1:case 3:switch(e){case 1:return function(i,n){return t.setUint8(i,n)};case 2:return function(i,n){return t.setUint16(i,n,AF)};case 4:return function(i,n){return t.setUint32(i,n,AF)}}break;case 2:case 4:switch(e){case 1:return function(i,n){return t.setInt8(i,n)};case 2:return function(i,n){return t.setInt16(i,n,AF)};case 4:return function(i,n){return t.setInt32(i,n,AF)}}break;case 6:switch(e){case 2:return function(i,n){return t.setUint16(i,n,AF)};case 4:return function(i,n){return t.setFloat32(i,n,AF)}}}return null}function SF(t){if(!t.struct.encoded)return t;var i=function(t){t<0&&ut(14204,t)},n=JSON.parse(JSON.stringify(t.struct)),e=new HL;e.ow(0);for(var r,s=d(n.vertexBundles);!(r=s()).done;){var h=r.value,u=h.view,o=u.count*u.stride,a=new Uint8Array(o),c=new Uint8Array(t.data.buffer,u.offset,u.length);i(JL.kw(a,u.count,u.stride,c)),e.ow(u.stride);var f={offset:e.cw(),length:a.byteLength,count:u.count,stride:u.stride};h.view=f,e.aw(a)}for(var v,l=d(n.primitives);!(v=l()).done;){var g=v.value;if(void 0!==g.indexView){var w=g.indexView,_=w.count*w.stride,m=new Uint8Array(_),p=new Uint8Array(t.data.buffer,w.offset,w.length);i(JL.Tw(m,w.count,w.stride,p)),e.ow(w.stride);var y={offset:e.cw(),length:m.byteLength,count:w.count,stride:w.stride};g.indexView=y,e.aw(m)}}return{struct:n,data:new Uint8Array(e.fw())}}function OF(t){var i=new hF.Inflate(t.data).decompress();return t.data=i,t.struct.compressed=!1,t}function RF(t){var i=JSON.parse(JSON.stringify(t.struct)),n=new HL;function e(t,i,n,e,r,s,h){for(var u=0;u<n;u++)for(var o=0;o<e;o++)i(h*u+r*o,t(s*u+r*o))}function r(t,i,n,e,r,s){for(var h=0;h<n;h++)for(var u=0;u<e;u++)i(s*h+4*u,Ee(t(r*h+2*u)))}n.ow(0);for(var s=0;s<i.vertexBundles.length;++s){for(var h=i.vertexBundles[s],u=h.view,o=h.attributes,a=t.struct.vertexBundles[s].attributes,c=[],f=[],v=[],l=0;l<o.length;++l){var g=o[l],w=kF(new DataView(t.data.buffer,u.offset+bF(a,l)),g.format),_=!0;switch(g.format){case 8:g.format=11;break;case 18:g.format=21;break;case 29:g.format=32;break;case 41:g.format=44;break;default:_=!1}c.push(tg[g.format].size),f.push(_),v.push(w)}for(var m=c.reduce((function(t,i){return t+i}),0),p=new Uint8Array(m*u.count),y=0;y<o.length;++y){var b=o[y],A=v[y],E=TF(new DataView(p.buffer,bF(o,y)),b.format),k=f[y],T=tg[b.format];k?r(A,E,u.count,T.count,u.stride,m):e(A,E,u.count,T.count,T.size/T.count,u.stride,m)}n.ow(m);var S={offset:n.cw(),length:p.byteLength,count:u.count,stride:m};h.view=S,n.aw(p)}for(var O,R=d(i.primitives);!(O=R()).done;){var I=O.value;if(void 0!==I.indexView){var M=I.indexView,N=new Uint8Array(t.data.buffer,M.offset,M.length);n.ow(M.stride);var C={offset:n.cw(),length:N.byteLength,count:M.count,stride:M.stride};I.indexView=C,n.aw(N)}}var L=new Uint8Array(n.fw());return i.quantized=!1,{struct:i,data:L}}var IF=[new kd("a_position",32),new kd("a_normal",32),new kd("a_texCoord",21),new kd("a_tangent",44),new kd("a_color",44)],MF=new ir;function NF(t,i,n){n=n||{};var e,r=[],s=0,h=[],u=0,o=t.positions.slice();if(o.length>0){e=null,t.attributes&&(e=t.attributes.find((function(t){return"a_position"===t.name}))||null),e||(e=IF[0]),r.push(e);var a=tg[e.format];u=Math.max(u,Math.floor(o.length/a.count)),h.push({offset:s,data:o,attribute:e}),s+=a.size}if(t.normals&&t.normals.length>0){e=null,t.attributes&&(e=t.attributes.find((function(t){return"a_normal"===t.name}))||null),e||(e=IF[1]);var c=tg[e.format];r.push(e),u=Math.max(u,Math.floor(t.normals.length/c.count)),h.push({offset:s,data:t.normals,attribute:e}),s+=c.size}if(t.uvs&&t.uvs.length>0){e=null,t.attributes&&(e=t.attributes.find((function(t){return"a_texCoord"===t.name}))||null),e||(e=IF[2]);var f=tg[e.format];r.push(e),u=Math.max(u,Math.floor(t.uvs.length/f.count)),h.push({offset:s,data:t.uvs,attribute:e}),s+=f.size}if(t.tangents&&t.tangents.length>0){e=null,t.attributes&&(e=t.attributes.find((function(t){return"a_tangent"===t.name}))||null),e||(e=IF[3]);var v=tg[e.format];r.push(e),u=Math.max(u,Math.floor(t.tangents.length/v.count)),h.push({offset:s,data:t.tangents,attribute:e}),s+=v.size}if(t.colors&&t.colors.length>0){e=null,t.attributes&&(e=t.attributes.find((function(t){return"a_color"===t.name}))||null),e||(e=IF[4]);var l=tg[e.format];r.push(e),u=Math.max(u,Math.floor(t.colors.length/l.count)),h.push({offset:s,data:t.colors,attribute:e}),s+=l.size}if(t.customAttributes)for(var d=0;d<t.customAttributes.length;d++){var g=t.customAttributes[d],w=tg[g.attr.format];r.push(g.attr),u=Math.max(u,Math.floor(g.values.length/w.count)),h.push({offset:s,data:g.values,attribute:g.attr}),s+=w.size}var _=new HL,m=new ArrayBuffer(u*s),p=new DataView(m);h.forEach((function(t){WC(p,t.data,t.attribute.format,t.offset,s)})),_.ow(0);var y={attributes:r,view:{offset:_.cw(),length:m.byteLength,count:u,stride:s}};_.aw(m);var b=null,A=0;if(t.indices){var E=t.indices;A=E.length,b=new ArrayBuffer(2*A),WC(new DataView(b),E,9)}var k={primitiveMode:t.primitiveMode||7,vertexBundelIndices:[0]};b&&(_.ow(2),k.indexView={offset:_.cw(),length:b.byteLength,count:A,stride:2},_.aw(b));var T=t.minPos;if(!T&&n.calculateBounds){T=ir.set(new ir,1/0,1/0,1/0);for(var S=0;S<u;++S)ir.set(MF,o[3*S+0],o[3*S+1],o[3*S+2]),ir.min(T,T,MF)}var O=t.maxPos;if(!O&&n.calculateBounds){O=ir.set(new ir,-1/0,-1/0,-1/0);for(var R=0;R<u;++R)ir.set(MF,o[3*R+0],o[3*R+1],o[3*R+2]),ir.max(O,O,MF)}var I={vertexBundles:[y],primitives:[k]};return T&&(I.minPosition=new ir(T.x,T.y,T.z)),O&&(I.maxPosition=new ir(O.x,O.y,O.z)),i||(i=new yF),i.reset({struct:I,data:new Uint8Array(_.fw())}),i}function CF(t,i){if(i>0){var n=t%i;if(0!==n)return i-n}return 0}function LF(t,i,n,e){e=e||{maxSubMeshes:1,maxSubMeshVertices:1024,maxSubMeshIndices:1024};var r=[],s=0;if(i.positions.length>0&&r.push(new kd("a_position",32,!1,s++,!1,0)),i.normals&&i.normals.length>0&&r.push(new kd("a_normal",32,!1,s++,!1,0)),i.uvs&&i.uvs.length>0&&r.push(new kd("a_texCoord",21,!1,s++,!1,0)),i.tangents&&i.tangents.length>0&&r.push(new kd("a_tangent",44,!1,s++,!1,0)),i.colors&&i.colors.length>0&&r.push(new kd("a_color",44,!1,s++,!1,0)),i.customAttributes)for(var h=0;h<i.customAttributes.length;h++){var u=i.customAttributes[h],o=new kd;o.copy(u.attr),o.stream=s++,r.push(o)}for(var a=[],c=[],f=0,v=0;v<e.maxSubMeshes;v++){for(var l,g={vertexBundelIndices:[],primitiveMode:i.primitiveMode||7},w=d(r);!(l=w()).done;){var _=l.value,m=tg[_.format],p=e.maxSubMeshVertices*m.size,y={view:{offset:f,length:p,count:0,stride:m.size},attributes:[_]},b=a.length;g.vertexBundelIndices.push(b),a.push(y),f+=p}var A=0;if(i.indices16&&i.indices16.length>0?A=2:i.indices32&&i.indices32.length>0&&(A=4),A>0){f+=CF(f,A);var E=e.maxSubMeshIndices*A,k={offset:f,length:E,count:0,stride:A};g.indexView=k,f+=E}c.push(g)}var T={info:{maxSubMeshes:e.maxSubMeshes,maxSubMeshVertices:e.maxSubMeshVertices,maxSubMeshIndices:e.maxSubMeshIndices},bounds:[]};T.bounds.length=e.maxSubMeshes;var S={struct:{vertexBundles:a,primitives:c,dynamic:T},data:new Uint8Array(f)};return n||(n=new yF),n.reset(S),n.initialize(),n.updateSubMesh(t,i),n}var FF,PF,BF=function(){function t(){}return t.createMesh=function(t,i,n){return NF(t,i,n)},t.createDynamicMesh=function(t,i,n,e){return LF(t,i,n,e)},t.decodeMesh=function(t){return SF(t)},t.inflateMesh=function(t){return OF(t)},t}(),DF=Object.freeze({__proto__:null,MeshUtils:BF,createMesh:NF,find:LN,mapBuffer:XC,readBuffer:zC,readMesh:function(t,i){void 0===i&&(i=0);var n={positions:[]},e=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),r=t.struct,s=r.primitives[i];s.vertexBundelIndices.forEach((function(t){var i=r.vertexBundles[t],s=i.view.offset,h=i.view,u=h.length,o=h.stride;i.attributes.forEach((function(t){var i=jL[t.name];i&&(n[i]=(n[i]||[]).concat(zC(e,t.format,s,u,o))),s+=tg[t.format].size}))}));var h=s.indexView;return n.indices=zC(e,el["R"+8*h.stride+"UI"],h.offset,h.length),n},toPPM:function(t,i,n){return"P3 "+i+" "+n+" 255\n"+t.filter((function(t,i){return i%4<3})).toString()+"\n"},writeBuffer:WC});t("utils",DF);var UF,xF,GF,jF=nr(),HF=Zr(),VF=ir.transformMat4,$F=ir.toArray,WF=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],zF=(t("SpriteFrameEvent",{UV_UPDATED:"uv_updated"}),t("SpriteFrame",Ko("cc.SpriteFrame")((PF=function(t){function i(i){var n;return(n=t.call(this,i)||this).vertices=null,n.uv=[],n.unbiasUV=[],n.uvSliced=[],n._rect=ys(),n._trimmedBorder=Ue(),n._offset=ds(),n._originalSize=ws(),n._rotated=!1,n._capInsets=[0,0,0,0],n._atlasUuid="",n._texture=void 0,n._isFlipUVY=!1,n._isFlipUVX=!1,n._original=null,n._packable=!0,n._pixelsToUnit=100,n._pivot=ds(.5,.5),n._meshType=0,n._extrude=0,n._customOutLine=[],n._mesh=null,n._minPos=nr(),n._maxPos=nr(),n}s(i,t),i.createWithImage=function(t){var n=t instanceof jw?t:new jw(t),e=new Mm;e.image=n;var r=new i;return r.texture=e,r};var n=i.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,i){void 0===i&&(i=!1);var n=this,e=!1;if(i&&(n._originalSize.set(0,0),n._rect.set(0,0,0,0),n._offset.set(0,0),n._capInsets=[0,0,0,0],n._rotated=!1,e=!0),t){t.texture&&(n._rect.set(0,0,t.texture.width,t.texture.height),n._refreshTexture(t.texture),n.checkRect(n._texture)),t.originalSize&&n._originalSize.set(t.originalSize),t.rect&&n._rect.set(t.rect),t.offset&&n._offset.set(t.offset);var r=n._capInsets;void 0!==t.borderTop&&(r[1]=t.borderTop),void 0!==t.borderBottom&&(r[3]=t.borderBottom),void 0!==t.borderLeft&&(r[0]=t.borderLeft),void 0!==t.borderRight&&(r[2]=t.borderRight),void 0!==t.isRotate&&(n._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(n._isFlipUVY=!!t.isFlipUv),e=!0}e&&n.texture&&n.Uw(),n.xw()},n.checkRect=function(t){var i=this._rect,n=i.x,e=i.y;return this._rotated?(n+=i.height,e+=i.width):(n+=i.width,e+=i.height),n>t.width?(ut(3300,this.name+"/"+t.name,n,t.width),!1):!(e>t.height&&(ut(3301,this.name+"/"+t.name,e,t.height),1))},n.xw=function(){var t=this,i=t._originalSize.width,n=t._originalSize.height,e=.5*(i-t._rect.width),r=.5*(n-t._rect.height),s=t._offset,h=t._trimmedBorder;h.x=s.x+e,h.y=s.x-e,h.z=s.y+r,h.w=s.y-r},n.ensureMeshData=function(){this._mesh||(this._initVertices(),this._createMesh())},n.destroy=function(){return this._packable&&GL&&GL.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n.Gw=function(){var t=this,i=t._rect,n=t.texture,e=t._capInsets,r=n.width,s=n.height,h=e[0],u=e[2],o=i.width-h-u,a=e[1],c=e[3],f=i.height-a-c,v=t.uvSliced;if(v.length=0,t._rotated){WF[0].u=i.x/r,WF[1].u=(i.x+c)/r,WF[2].u=(i.x+c+f)/r,WF[3].u=(i.x+i.height)/r,WF[3].v=i.y/s,WF[2].v=(i.y+h)/s,WF[1].v=(i.y+h+o)/s,WF[0].v=(i.y+i.width)/s;for(var l=0;l<4;++l)for(var d=WF[l],g=0;g<4;++g){var w=WF[3-g];v.push({u:d.u,v:w.v})}}else{WF[0].u=i.x/r,WF[1].u=(i.x+h)/r,WF[2].u=(i.x+h+o)/r,WF[3].u=(i.x+i.width)/r,WF[3].v=i.y/s,WF[2].v=(i.y+a)/s,WF[1].v=(i.y+a+f)/s,WF[0].v=(i.y+i.height)/s;for(var _=0;_<4;++_)for(var m=WF[_],p=0;p<4;++p){var y=WF[p];v.push({u:y.u,v:m.v})}}this.emit("uv_updated",this)},n.Uw=function(){var t=ki,i=this,n=i._rect,e=i.uv,r=i.unbiasUV,s=i.texture,h=s.width,u=s.height;if(i._rotated){var o=0===h?0:n.x/h,a=0===h?1:(n.x+n.height)/h,c=0===u?0:n.y/u,f=0===u?1:(n.y+n.width)/u;i._isFlipUVX&&i._isFlipUVY?t(e,a,f,a,c,o,f,o,c):i._isFlipUVX?t(e,a,c,a,f,o,c,o,f):i._isFlipUVY?t(e,o,f,o,c,a,f,a,c):t(e,o,c,o,f,a,c,a,f);var v=0===h?0:n.x/h,l=0===h?1:(n.x+n.height)/h,d=0===u?0:n.y/u,g=0===u?1:(n.y+n.width)/u;i._isFlipUVX&&i._isFlipUVY?t(r,l,g,l,d,v,g,v,d):i._isFlipUVX?t(r,l,d,l,g,v,d,v,g):i._isFlipUVY?t(r,v,g,v,d,l,g,l,d):t(r,v,d,v,g,l,d,l,g)}else{var w=0===h?0:n.x/h,_=0===h?1:(n.x+n.width)/h,m=0===u?1:(n.y+n.height)/u,p=0===u?0:n.y/u;i._isFlipUVX&&i._isFlipUVY?t(e,_,p,w,p,_,m,w,m):i._isFlipUVX?t(e,_,m,w,m,_,p,w,p):i._isFlipUVY?t(e,w,p,_,p,w,m,_,m):t(e,w,m,_,m,w,p,_,p);var y=0===h?0:n.x/h,b=0===h?1:(n.x+n.width)/h,A=0===u?1:(n.y+n.height)/u,E=0===u?0:n.y/u;i._isFlipUVX&&i._isFlipUVY?t(r,b,E,y,E,b,A,y,A):i._isFlipUVX?t(r,b,A,y,A,b,E,y,E):i._isFlipUVY?t(r,y,E,b,E,y,A,b,A):t(r,y,A,b,A,y,E,b,E)}i.Gw()},n.hw=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this.Uw())},n.us=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this.Uw())},n.jw=function(){var t=GL;if(t){var i=this._texture;if(i instanceof Mm&&!i.isCompressed){var n=this.width,e=this.height;if(!i.image||n>t.maxFrameSize||e>t.maxFrameSize)this._packable=!1;else{var r=O.HTMLCanvasElement;i.image&&i.image instanceof r&&(this._packable=!0)}}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var i=this,n=t,e=n.rect;e&&(i._rect=new ps(e.x,e.y,e.width,e.height));var r=n.offset;n.offset&&(i._offset=ds(r.x,r.y));var s=n.originalSize;n.originalSize&&(i._originalSize=ws(s.width,s.height)),i._rotated=!!n.rotated,i._name=n.name,i._packable=!!n.packable,i._pixelsToUnit=n.pixelsToUnit;var h=n.pivot;h&&(i._pivot=ds(h.x,h.y)),i._meshType=n.meshType;var u=n.capInsets;if(u){var o=i._capInsets;o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3]}var a=n.vertices;if(a){i.vertices||(i.vertices={rawPosition:[],positions:[],indexes:a.indexes,uv:a.uv,nuv:a.nuv,minPos:nr(a.minPos.x,a.minPos.y,a.minPos.z),maxPos:nr(a.maxPos.x,a.maxPos.y,a.maxPos.z)}),i.vertices.rawPosition.length=0;for(var c=a.rawPosition,f=0;f<c.length;f+=3)i.vertices.rawPosition.push(nr(c[f],c[f+1],c[f+2]));i._updateMeshVertices()}},n.clone=function(){var t,n,e,r,s,h=this,u=new i,o=h.vertices;return u.vertices=o?{rawPosition:o.rawPosition.slice(0),positions:o.positions.slice(0),indexes:o.indexes.slice(0),uv:o.uv.slice(0),nuv:o.nuv.slice(0),minPos:o.minPos.clone(),maxPos:o.maxPos.clone()}:null,(t=u.uv).splice.apply(t,[0,u.uv.length].concat(h.uv)),(n=u.unbiasUV).splice.apply(n,[0,u.unbiasUV.length].concat(h.unbiasUV)),(e=u.uvSliced).splice.apply(e,[0,u.uvSliced.length].concat(h.uvSliced)),u._rect.set(h._rect),u._trimmedBorder.set(h._trimmedBorder),u._offset.set(h._offset),u._originalSize.set(h._originalSize),u._rotated=h._rotated,(r=u._capInsets).splice.apply(r,[0,u._capInsets.length].concat(h._capInsets)),u._atlasUuid=h._atlasUuid,u._texture=h._texture,u._isFlipUVX=h._isFlipUVX,u._isFlipUVY=h._isFlipUVY,h._original?u._original={_texture:h._original._texture,_x:h._original._x,_y:h._original._y}:u._original=null,u._packable=h._packable,u._pixelsToUnit=h._pixelsToUnit,u._pivot.set(h._pivot),u._meshType=h._meshType,u._extrude=h._extrude,(s=u._customOutLine).splice.apply(s,[0,u._customOutLine.length].concat(h._customOutLine)),u._minPos=h._minPos,u._maxPos=h._maxPos,h._mesh&&u._createMesh(),u},n._refreshTexture=function(t){var i=this;i._texture=t;var n=i._texture,e={},r=!1;0!==i._rect.width&&0!==i._rect.height&&i.checkRect(n)||(e.rect=ys(0,0,n.width,n.height),r=!0),(0===i._originalSize.width||0===i._originalSize.height||r)&&(e.originalSize=ws(n.width,n.height),r=!0),r&&i.reset(e),i.jw(),i._mesh&&i._updateMesh()},n.onLoaded=function(){this.xw()},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new Mm;n.initDefault(),this._refreshTexture(n),this.Uw()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},n._initVertices=function(){var t=this;if(t.vertices){var i=t.vertices;i.rawPosition.length=0,i.positions.length=0,i.indexes.length=0,i.uv.length=0,i.nuv.length=0,i.minPos.set(0,0,0),i.maxPos.set(0,0,0)}else t.vertices={rawPosition:[],positions:[],indexes:[],uv:[],nuv:[],minPos:nr(),maxPos:nr()};var n=t.vertices;if(1===t._meshType);else{var e=t.texture,r=e.width,s=e.height,h=t.rect,u=h.width,o=h.height,a=h.x,c=s-h.y-o,f=u/2,v=o/2,l=0===r?0:a/r,d=0===r?1:(a+u)/r,g=0===s?1:(c+o)/s,w=0===s?0:c/s,_=n.uv,m=n.nuv,p=n.rawPosition,y=n.indexes;jF.set(-f,-v,0),p.push(jF.clone()),_.push(a,c+o),m.push(l,w),n.minPos.set(jF),jF.set(f,-v,0),p.push(jF.clone()),_.push(a+u,c+o),m.push(d,w),jF.set(-f,v,0),p.push(jF.clone()),_.push(a,c),m.push(l,g),jF.set(f,v,0),p.push(jF.clone()),_.push(a+u,c),m.push(d,g),n.maxPos.set(jF),y.push(0,1,2,2,1,3)}this._updateMeshVertices()},n._updateMeshVertices=function(){HF.identity();var t=1/this._pixelsToUnit,i=nr(-(this._pivot.x-.5)*this.rect.width*t,-(this._pivot.y-.5)*this.rect.height*t,0);HF.transform(i),i.set(t,t,1),HF.scale(i);for(var n=this.vertices,e=0;e<n.rawPosition.length;e++){var r=n.rawPosition[e];VF(i,r,HF),$F(n.positions,i,3*e)}VF(this._minPos,n.minPos,HF),VF(this._maxPos,n.maxPos,HF)},n._createMesh=function(){this._mesh=NF({primitiveMode:7,positions:this.vertices.positions,uvs:this.vertices.nuv,indices:this.vertices.indexes,minPos:this._minPos,maxPos:this._maxPos,attributes:[new kd("a_position",32),new kd("a_texCoord",21)]})},n._updateMesh=function(){this._mesh&&this._mesh.destroy(),this._initVertices(),this._createMesh()},e(i,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this.Gw())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this.Gw())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this.Gw())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this.Gw())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this.Uw(),this.xw())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this.Uw(),this.xw())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this.xw()}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this.Uw())}},{key:"texture",get:function(){return this._texture},set:function(t){t?t!==this._texture&&this.reset({texture:t},!0):st(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){globalThis.Build?this._texture=t:t&&(this._refreshTexture(t),this.Uw())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this.Uw()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this.Uw()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}},{key:"pixelsToUnit",get:function(){return this._pixelsToUnit}},{key:"pivot",get:function(){return this._pivot}},{key:"mesh",get:function(){return this._mesh}},{key:"trimmedBorder",get:function(){return this._trimmedBorder}}]),i}(kw),PF.EVENT_UV_UPDATED="uv_updated",PF.MeshType={RECT:0,POLYGON:1},FF=PF))||FF));k.SpriteFrame=zF;var XF,YF=t("SpriteAtlas",Ko("cc.SpriteAtlas")((xF=function(t){function i(i){var n;return(n=t.call(this,i)||this).spriteFrames=GF&&GF(),n}s(i,t);var n=i.prototype;return n.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var i=this.spriteFrames[t[0]];return i&&i.texture}return null},n.getSpriteFrame=function(t){var i=this.spriteFrames[t];return i?(i.name||(i.name=t),i):null},n.getSpriteFrames=function(){var t=[],i=this.spriteFrames;for(var n in i)t.push(i[n]);return t},n._serialize=function(){return null},n._deserialize=function(t,i){var n=t;this._name=n.name;var e=n.spriteFrames;this.spriteFrames=jt();for(var r=0;r<e.length;r+=2)i.result.push(this.spriteFrames,e[r],e[r+1],gi(zF))},i}(kw),GF=xo(xF.prototype,"spriteFrames",[oa],(function(){return jt()})),UF=xF))||UF);k.SpriteAtlas=YF;var KF,qF,QF,ZF=t("Font",Ko("cc.Font")(XF=function(t){function i(i){return t.call(this,i)||this}return s(i,t),i}(kw))||XF);k.Font=ZF;var JF=t("TTFFont",Ko("cc.TTFFont")((qF=function(t){function i(){var i;return(i=t.call(this)||this)._fontFamily=QF&&QF(),i}return s(i,t),i.prototype.initDefault=function(i){this._fontFamily="Arial",t.prototype.initDefault.call(this,i)},e(i,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:ju(this._native),__isNative__:!0}}}]),i}(ZF),QF=xo(qF.prototype,"_fontFamily",[oa],(function(){return null})),m(qF.prototype,"_nativeAsset",[ja,Na],Object.getOwnPropertyDescriptor(qF.prototype,"_nativeAsset"),qF.prototype),m(qF.prototype,"_nativeDep",[ja],Object.getOwnPropertyDescriptor(qF.prototype,"_nativeDep"),qF.prototype),KF=qF))||KF);k.TTFFont=JF;var tP={},iP=t("BASELINE_RATIO",.26),nP=0,eP=t("MIDDLE_RATIO",(iP+1)/2-iP);function rP(){return nP}var sP=new wi(2);sP.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var hP=t("LRUCache",function(){function t(t){this.Hw=0,this.Vw=0,this.$w={},this.Ww=null,this.zw=null,this.Vw=t}var i=t.prototype;return i.moveToHead=function(t){t.next=this.Ww,t.prev=null,this.Ww&&(this.Ww.prev=t),this.Ww=t,this.zw||(this.zw=t),this.Hw++,this.$w[t.key]=t},i.put=function(t,i){var n=sP.get();if(n.key=t,n.value=i,this.Hw>=this.Vw){var e=this.zw;delete this.$w[e.key],this.Hw--,this.zw=e.prev,this.zw.next=null,e.prev=null,e.next=null,sP.put(e)}this.moveToHead(n)},i.remove=function(t){t.prev?t.prev.next=t.next:this.Ww=t.next,t.next?t.next.prev=t.prev:this.zw=t.prev,delete this.$w[t.key],this.Hw--},i.get=function(t){var i=this.$w[t];return i?(this.remove(i),this.moveToHead(i),i.value):null},i.clear=function(){this.Hw=0,this.$w={},this.Ww=null,this.zw=null},i.has=function(t){return!!this.$w[t]},i.delete=function(t){var i=this.$w[t];this.remove(i)},t}()),uP=new hP(100),oP=/([a-zA-Z0-9--]+|\S)/,aP=/^[!,.:;'}\]%\?>]/,cP="[a-zA-Z0-9--iI]",fP=new RegExp("("+cP+"+|\\S)$"),vP=new RegExp(cP+"+$"),lP=new RegExp("^"+cP);function dP(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function gP(t){var i=t.charCodeAt(0);return i>=9&&i<=13||32===i||133===i||160===i||5760===i||i>=8192&&i<=8202||8232===i||8233===i||8239===i||8287===i||12288===i}function wP(t,i,n){var e=(n||t.font)+""+i,r=uP.get(e);if(null!==r)return r;var s=t.measureText(i),h=s&&s.width||0;return uP.put(e,h),h}function _P(t){for(var i=t.length,n=0,e=0,r=0;r<i;r++)8205!==(e=t.charCodeAt(r))&&(e>=55296&&e<=56319&&(e=t.charCodeAt(r+1))>=56320&&e<=57343?((r+2>=i||8205!==t.charCodeAt(r+2))&&n++,r++):n++);return n}function mP(t,i){for(var n=t.length,e=0,r=0,s=0,h=0,u=0;u<n;u++)if(8205!==(h=t.charCodeAt(u)))if(h>=55296&&h<=56319&&(e++,(h=t.charCodeAt(u+1))>=56320&&h<=57343)){if(e++,u+2>=n||8205!==t.charCodeAt(u+2)){if(i===r)return t.slice(s,s+e);s+=e,r++,e=0}u++}else{if(i===r)return t.charAt(u);s=u+1,r++,e=0}else e++;return""}function pP(t,i){var n=mP(t,i);if(1===n.length)return""+n.charCodeAt(0);for(var e="",r=0;r<n.length;r++)e+=""+n.charCodeAt(r);return""+e}function yP(t,i){if(i>=t.length)return t.length;for(var n=i,e=t[n];n>=0&&(""===e&&(e=t[--n]),e>="\udc00"&&e<="\udfff"&&n-1>=0&&(e=t[--n]),e>="\ud800"&&e<="\udbff")&&n-1>=0&&""===t[n-1];)e=t[--n];return n}function bP(t,i){for(var n=i,e=i,r=t[e];e<t.length;)if(""===r&&(n++,(r=t[++e])>="\ud800"&&r<="\udbff"&&(n++,r=t[++e])),r>="\ud800"&&r<="\udbff")n++,r=t[++e];else{if(!(r>="\udc00"&&r<="\udfff"))break;if(r=t[++e],!(e<t.length&&""===t[e]))break;n++,r=t[e]}return n}function AP(t,i,n){var e=yP(t,i);e<i&&(e=bP(t,i)+1);var r=n;if(void 0!==n){r=bP(t,n=Math.max(0,n-1));var s=yP(t,n);s<e||s===e&&i>e?r=e:r+=1}return t.substring(e,r)}function EP(t){return lP.exec(t)}function kP(t){return vP.exec(t)}function TP(t,i,n,e){var r=[];if(0===t.length||n<0)return r.push(""),r;for(var s=t;i>n&&s.length>1;){for(var h=s.length*(n/i)|0,u=AP(s,h),o=i-e(u),a=u,c=0,f=0;o>n&&f++<100;)h*=n/o,o=i-e(u=AP(s,h|=0));for(f=0;u&&o<=n&&f++<100;){var v=oP.exec(u);a=u,o=i-e(u=AP(s,h+=c=v?v[0].length:1))}0==(h-=c)?(h=1,a=AP(s,1)):1===h&&s[0]>="\ud800"&&s[0]<="\udbff"&&(h=2,a=AP(s,2));var l=AP(s,0,h),d=void 0;aP.test(a||u)&&(0==(h-=(d=fP.exec(l))?d[0].length:0)&&(h=1),a=AP(s,h),l=AP(s,0,h)),lP.test(a)&&(d=vP.exec(l))&&l!==d[0]&&(a=AP(s,h-=d[0].length),l=AP(s,0,h)),(0===r.length||(l=l.trim()).length>0)&&r.push(l),i=e(s=a||u)}return(0===r.length||(s=s.trim()).length>0)&&r.push(s),r}var SP,OP=O.document,RP=null,IP=-1,MP="BES bswy:->@123",NP=Object.create(null),CP=[],LP=3e3,FP=function(){if(void 0===SP)if("FontFace"in O){var t=/Gecko.*Firefox\/(\d+)/.exec(O.navigator.userAgent),i=/OS X.*Version\/10\..*Safari/.exec(O.navigator.userAgent)&&/Apple/.exec(O.navigator.vendor);SP=t?parseInt(t[1],10)>42:!i}else SP=!1;return SP};function PP(){for(var t=!0,i=Date.now(),n=CP.length-1;n>=0;n--){var e=CP[n],r=e.fontFamilyName;if(i-e.startTime>LP)st(4933,r),e.onComplete(null,r),CP.splice(n,1);else{var s=e.refWidth,h="40px "+r;RP.font=h,s!==wP(RP,MP,h)?(CP.splice(n,1),e.onComplete(null,r)):t=!1}}t&&(clearInterval(IP),IP=-1)}function BP(t,i,n){var e=new Promise((function(n,e){!function r(){Date.now()-t>=LP?e():OP.fonts.load("40px "+i).then((function(t){t.length>=1?n():setTimeout(r,100)}),(function(){e()}))}()})),r=null,s=new Promise((function(t,i){r=setTimeout(i,LP)}));Promise.race([s,e]).then((function(){r&&(clearTimeout(r),r=null),n(null,i)}),(function(){st(4933,i),n(null,i)}))}function DP(t,i,n){var e=UP(t);if(NP[e])n(null,e);else{if(!RP){var r=OP.createElement("canvas");r.width=100,r.height=100,RP=r.getContext("2d")}var s="40px "+e,h=OP.createElement("style");h.type="text/css";var u="";Number.isNaN(e)?u+="@font-face { font-family:"+e+"; src:":u+='@font-face { font-family:"'+e+'"; src:',u+='url("'+t+'");',h.textContent=u+"}",OP.body.appendChild(h);var o=OP.createElement("div"),a=o.style;if(a.fontFamily=e,o.innerHTML=".",a.position="absolute",a.left="-100px",a.top="-100px",OP.body.appendChild(o),FP())BP(Date.now(),e,n);else{var c={fontFamilyName:e,refWidth:wP(RP,MP,s),onComplete:n,startTime:Date.now()};CP.push(c),-1===IP&&(IP=setInterval(PP,100))}NP[e]=h}}function UP(t){var i=t.lastIndexOf(".ttf");if(-1===i)return t;var n,e=t.lastIndexOf("/");return-1!==(n=-1===e?t.substring(0,i)+"_LABEL":t.substring(e+1,i)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}function xP(t,i,n,e){var r=new JF;r._nativeUrl=t,r._nativeAsset=i,e(null,r)}AE.register({".font":DP,".eot":DP,".ttf":DP,".woff":DP,".svg":DP,".ttc":DP}),PE.register({".font":xP,".eot":xP,".ttf":xP,".woff":xP,".svg":xP,".ttc":xP});var GP,jP,HP,VP,$P,WP,zP,XP,YP,KP=/^(click)(\s)*=|(param)(\s)*=/,qP=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,QP=t("HtmlTextParser",function(){function t(){this.Xw=[],this.Yw=[],this.Kw=[],this.Xw.push([/&lt;/g,"<"]),this.Xw.push([/&gt;/g,">"]),this.Xw.push([/&amp;/g,"&"]),this.Xw.push([/&quot;/g,'"']),this.Xw.push([/&apos;/g,"'"])}var i=t.prototype;return i.parse=function(t){this.Kw.length=0,this.Yw.length=0;for(var i=0,n=t.length;i<n;){var e=t.indexOf(">",i),r=-1;if(e>=0&&(r=t.lastIndexOf("<",e))<i-1&&(r=t.indexOf("<",e+1),e=t.indexOf(">",r+1)),r<0)this.Yw.pop(),this.qw(t.substring(i)),i=n;else{var s=t.substring(i,r),h=t.substring(r+1,e);""===h&&(s=t.substring(i,e+1)),this.qw(s),-1===e?e=r:"/"===t.charAt(r+1)?this.Yw.pop():this.Qw(h),i=e+1}}return this.Kw},i.Zw=function(t){t=t.trim();var i={},n=/^(color|size)(\s)*=/.exec(t),e="",r=0,s="";if(n){if(e=n[0],""===(t=t.substring(e.length).trim()))return i;switch(r=t.indexOf(" "),e[0]){case"c":i.color=r>-1?t.substring(0,r).trim():t;break;case"s":i.size=parseInt(t)}return r>-1&&(s=t.substring(r+1).trim(),i.event=this.Jw(s)),i}if((n=/^(br(\s)*\/)/.exec(t))&&n[0].length>0&&(e=n[0].trim()).startsWith("br")&&"/"===e[e.length-1])return i.isNewLine=!0,this.Kw.push({text:"",style:{isNewLine:!0}}),i;var h="",u=-1;if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&n[0].length>0&&(e=n[0].trim()).startsWith("img")&&"/"===e[e.length-1]){var o;n=qP.exec(t);for(var a=!1;n;){var c=(e=(t=t.substring(t.indexOf(n[0]))).substring(0,n[0].length)).length;if(e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),h=t.substring(c).trim(),u="src"===e?this.t_(h):-1,o=(r=h.indexOf(" ",u+1>=h.length?-1:u+1))>-1?h.substring(0,r):h,t=h.substring(r).trim(),o.endsWith("/")&&(o=o.slice(0,-1)),"src"===e){switch(o.charCodeAt(0)){case 34:case 39:a=!0,o=o.slice(1,-1)}i.isImage=!0,i.src=o}else if("height"===e)i.imageHeight=parseInt(o);else if("width"===e)i.imageWidth=parseInt(o);else if("align"===e){switch(o.charCodeAt(0)){case 34:case 39:o=o.slice(1,-1)}i.imageAlign=o.toLowerCase()}else"offset"===e?i.imageOffset=o:"click"===e&&(i.event=this.Jw(e+"="+o));i.event&&"param"===e&&(i.event[e]=o.replace(/^"|"$/g,"")),n=qP.exec(t)}return a&&i.isImage&&this.Kw.push({text:"",style:i}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(t)){var f={color:"#ffffff",width:1};if(t=n[0].substring(7).trim()){var v,l=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=l.exec(t);n;)e=(t=t.substring(t.indexOf(n[0]))).substring(0,n[0].length),v=(r=(h=t.substring(e.length).trim()).indexOf(" "))>-1?h.substring(0,r):h,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=h.substring(r).trim(),"click"===e?i.event=this.Jw(e+"="+v):"color"===e?f.color=v:"width"===e&&(f.width=parseInt(v)),i.event&&"param"===e&&(i.event[e]=v.replace(/^"|"$/g,"")),n=l.exec(t)}i.outline=f}if((n=/^(on|u|b|i)(\s)*/.exec(t))&&n[0].length>0){switch(e=n[0],t=t.substring(e.length).trim(),e[0]){case"u":i.underline=!0;break;case"i":i.italic=!0;break;case"b":i.bold=!0}if(""===t)return i;i.event=this.Jw(t)}return i},i.t_=function(t){var i=-1,n=-1,e=t.indexOf("'"),r=t.indexOf('"'),s=r>-1&&(r<e||-1===e);return e>-1&&(e<r||-1===r)?(i=e,n=t.indexOf("'",i+1>=t.length?-1:i+1)):s&&(i=r,n=t.indexOf('"',i+1>=t.length?-1:i+1)),n},i.Jw=function(t){for(var i={},n=0,e=!1,r=KP.exec(t);r;){var s=r[0],h="";if(e=!1,'"'===(t=t.substring(s.length).trim()).charAt(0))(n=t.indexOf('"',1))>-1&&(h=t.substring(1,n).trim(),e=!0),n++;else if("'"===t.charAt(0))(n=t.indexOf("'",1))>-1&&(h=t.substring(1,n).trim(),e=!0),n++;else{var u=/(\S)+/.exec(t);n=(h=u?u[0]:"").length}e&&(i[s=s.substring(0,s.length-1).trim()]=h),t=t.substring(n).trim(),r=KP.exec(t)}return i},i.Qw=function(t){var i=this.Zw(t);if(0===this.Yw.length)this.Yw.push(i);else{if(i.isNewLine||i.isImage)return;var n=this.Yw[this.Yw.length-1];for(var e in n)i[e]||(i[e]=n[e]);this.Yw.push(i)}},i.qw=function(t){0!==t.length&&(t=this.i_(t),this.Yw.length>0?this.Kw.push({text:t,style:this.Yw[this.Yw.length-1]}):this.Kw.push({text:t}))},i.i_=function(t){for(var i,n=d(this.Xw);!(i=n()).done;){var e=i.value,r=e[0],s=e[1];t=t.replace(r,s)}return t},t}()),ZP=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},JP=function(){function t(t){this.letterDefinitions={},this._texture=null,this.texture=t}var i=t.prototype;return i.addLetterDefinitions=function(t,i){this.letterDefinitions[t]=i},i.cloneLetterDefinition=function(){var t={};for(var i in this.letterDefinitions){var n=new ZP;Zt(n,this.letterDefinitions[i]),t[i]=n}return t},i.getTexture=function(){return this._texture},i.getLetter=function(t){return this.letterDefinitions[t]},i.getLetterDefinitionForChar=function(t){var i=pP(t,0),n=null;return Object.prototype.hasOwnProperty.call(this.letterDefinitions,i)&&(n=this.letterDefinitions[i]),n},i.clear=function(){this.letterDefinitions={}},e(t,[{key:"texture",get:function(){return this._texture},set:function(t){var i=this._texture;i!==t&&(i&&(i.decRef(!1),i.refCount<=0&&i.destroy()),t&&t.addRef(),this._texture=t)}}]),t}(),tB=t("BitmapFont",(GP=Ko("cc.BitmapFont"),jP=Ca(zF),GP((VP=function(t){function i(){var i;return(i=t.call(this)||this).fntDataStr=$P&&$P(),i.spriteFrame=WP&&WP(),i.fontSize=zP&&zP(),i.fntConfig=XP&&XP(),i}return s(i,t),i.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new JP(t.texture));var i=this.fntConfig;if(i){var n=i.fontDefDictionary;for(var e in n){var r=n[e],s=new ZP,h=r.rect;s.offsetX=r.xOffset,s.offsetY=r.yOffset,s.w=h.width,s.h=h.height,s.u=h.x,s.v=h.y,s.valid=!0,s.xAdvance=r.xAdvance,this.fontDefDictionary.addLetterDefinitions(e,s)}}else st(16376)},i}(ZF),$P=xo(VP.prototype,"fntDataStr",[oa],(function(){return""})),WP=xo(VP.prototype,"spriteFrame",[jP],(function(){return null})),zP=xo(VP.prototype,"fontSize",[oa],(function(){return-1})),XP=xo(VP.prototype,"fntConfig",[oa],(function(){return null})),HP=VP))||HP));k.BitmapFont=tB;var iB,nB=t("LabelAtlas",Ko("cc.LabelAtlas")(YP=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(tB))||YP);k.LabelAtlas=nB;var eB=function(){function t(){this.n_=[]}t.e_=function(){return iB||(iB=new t),iB};var i=t.prototype;return i.ni=function(){var t=this.n_.pop();if(!t){var i=O.document.createElement("canvas"),n=i.getContext("2d");t={canvas:i,context:n}}return t},i.ri=function(t){this.n_.length>=Gi.MAX_LABEL_CANVAS_POOL_SIZE||this.n_.push(t)},t}(),rB=cr.WHITE.clone(),sB="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",hB=rP(),uB=function(){function t(t,i){this.image=null,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.char=t,this.labelInfo=i,this.hash=""+pP(t,0)+i.hash}var i=t.prototype;return i.updateRenderData=function(){this.r_(),this.s_()},i.destroy=function(){this.image=null,eB.e_().ri(this.data),this.data=null},i.r_=function(){if(this.data=eB.e_().ni(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){var t=this.labelInfo.fontScale;this.context.font=this.labelInfo.fontDesc;var i=wP(this.context,this.char,this.labelInfo.fontDesc),n=2*this.labelInfo.margin+2;this.width=parseFloat(i.toFixed(2))*t+n,this.height=(1+iP)*this.labelInfo.fontSize*t+n,this.offsetY=-this.labelInfo.fontSize*iP*t/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new jw),this.image.reset(this.canvas)},i.s_=function(){if(this.context&&this.canvas){var t=this.context,i=this.labelInfo,n=this.canvas.width,e=this.canvas.height,r=i.fontScale;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,n,e),t.fillStyle=sB,t.fillRect(0,0,n,e),t.font=i.fontDesc.replace(/(\d+)(\.\d+)?(px|em|rem|pt)/g,(function(t,i,n,e){return(+i*r+(+n||0)*r).toString()+e}));var s=i.fontSize*r,h=n/2,u=e/2+s*eP+s*hB,o=i.color;if(t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",i.isOutlined){var a=i.out||rB;t.strokeStyle="rgba("+a.r+", "+a.g+", "+a.b+", "+a.a/255+")",t.lineWidth=2*i.margin*r,t.strokeText(this.char,h,u)}t.fillText(this.char,h,u)}},t}(),oB=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.initWithSize=function(t,i,n){void 0===n&&(n=35),this.reset({width:t,height:i,format:n})},n.drawTextureAt=function(t,i,n){var e=this.getGFXTexture();if(t&&e){var r=this._getGFXDevice();if(r){var s=new td;s.texOffset.x=i,s.texOffset.y=n,s.texExtent.width=t.width,s.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],e,[s])}else st(16363)}},i}(Mm),aB=function(){function t(t,i){this.rs=0,this.ss=0,this.hs=0,this.xn=0,this.Gn=0,this.h_=0,this.u_=!1;var n=new oB;n.initWithSize(t,i),this.fontDefDictionary=new JP(n),this.h_=1,this.xn=t,this.Gn=i,xC.on("director_before_scene_launch",this.beforeSceneLoad,this)}var i=t.prototype;return i.insertLetterTexture=function(t){var i=t.image,n=xC.root.device;if(!i||!this.fontDefDictionary||!n)return null;var e=i.width,r=i.height;if(this.rs+e+0>this.xn&&(this.rs=0,this.ss=this.hs),this.ss+r>this.hs&&(this.hs=this.ss+r+0),this.hs>this.Gn)return st(12100),null;if(!this.fontDefDictionary.texture)return null;this.fontDefDictionary.texture.drawTextureAt(i,this.rs,this.ss),this.u_=!0;var s=new ZP;return s.u=this.rs+this.h_,s.v=this.ss+this.h_,s.valid=!0,s.w=t.width-2,s.h=t.height-2,s.xAdvance=s.w,s.offsetY=t.offsetY,this.rs+=e+0,this.fontDefDictionary.addLetterDefinitions(t.hash,s),s},i.update=function(){this.u_&&(this.u_=!1)},i.reset=function(){this.rs=0,this.ss=0,this.hs=0,this.fontDefDictionary.clear()},i.destroy=function(){this.reset();var t=this.fontDefDictionary;t&&t.texture&&(t.texture=null)},i.getTexture=function(){return this.fontDefDictionary.getTexture()},i.beforeSceneLoad=function(){this.clearAllCache()},i.clearAllCache=function(){this.destroy();var t=new oB;t.initWithSize(this.xn,this.Gn),this.fontDefDictionary.texture=t},i.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},i.getLetterDefinitionForChar=function(t,i){var n=pP(t,0)+i.hash,e=this.fontDefDictionary.letterDefinitions[n];if(!e){var r=new uB(t,i);r.updateRenderData(),e=this.insertLetterTexture(r),r.destroy()}return e},e(t,[{key:"width",get:function(){return this.xn}},{key:"height",get:function(){return this.Gn}}]),t}(),cB={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:cr.WHITE.clone(),isOutlined:!1,out:cr.WHITE.clone(),margin:0,fontScale:1};function fB(t){var i=t.color.toHEX(),n="";return t.isOutlined&&t.margin>0&&(n=n+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+i+n}var vB="a_position",lB="a_color",dB="a_texCoord",gB="a_color2",wB=[new kd(vB,32)],_B=[new kd(vB,32),new kd(lB,44)],mB=[new kd(vB,32),new kd(dB,21),new kd(lB,44)],pB=[new kd(vB,32),new kd(dB,21),new kd(lB,35,!0)],yB=[new kd(vB,32),new kd(dB,21),new kd(lB,44),new kd(gB,44)],bB=[new kd(vB,32),new kd(dB,21),new kd(lB,35,!0),new kd(gB,35,!0)];function AB(t){for(var i=0,n=0;n<t.length;n++){var e=t[n];i+=tg[e.format].count}return i}function EB(t){for(var i=0,n=0;n<t.length;n++){var e=t[n];i+=tg[e.format].size}return i}k.internal.vfmtPosUvColor=mB,k.internal.vfmtPosUvTwoColor=yB,k.internal.vfmtPosUvColor4B=pB,k.internal.vfmtPosUvTwoColor4B=bB,t("UIVertexFormat",Object.freeze({__proto__:null,getAttributeStride:EB,getComponentPerVertex:AB,vfmt:wB,vfmtPosColor:_B,vfmtPosUvColor:mB,vfmtPosUvColor4B:pB,vfmtPosUvTwoColor:yB,vfmtPosUvTwoColor4B:bB}));var kB=t("MeshBuffer",function(){var t=i.prototype;function i(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this.o_=0,this.a_=0,this.c_=0,this.jn=null,this.f_=[],this.Kl=null,this.v_=0,this.initSharedBuffer(),this.syncSharedBufferToNative()}return t.initSharedBuffer=function(){},t.syncSharedBufferToNative=function(){},t.initialize=function(t,i,n,e){this.a_=n,this.c_=e,this.jn=i,this.floatsPerVertex=EB(i)>>2,this.a_,this._floatsPerVertex,ft(9005),this.vData&&this.iData||(this.vData=new Float32Array(this.a_),this.iData=new Uint16Array(this.c_)),this.f_.push(this.l_(t))},t.reset=function(){this.v_=0,this.dirty=!1},t.destroy=function(){this.reset(),this.jn=null,this.Kl=null,this.vData=null,this.iData=null;for(var t=0;t<this.f_.length;++t){var i=this.f_[t],n=i.vertexBuffers[0];n&&n.destroy();var e=i.indexBuffer;e&&e.destroy(),i.ia.destroy()}this.f_.length=0},t.setDirty=function(){this.dirty=!0},t.request=function(){return st(9002),!1},t.requireFreeIA=function(t){return this.f_.length<=this.v_&&this.f_.push(this.l_(t)),this.f_[this.v_++].ia},t.recycleIA=function(t){for(var i=this.f_,n=0;n<this.v_;++n)if(t===i[n].ia){var e=i[n];return i[n]=i[--this.v_],void(i[this.v_]=e)}},t.checkCapacity=function(t,i){var n=(this.vertexOffset+t)*this._floatsPerVertex,e=this.indexOffset+i;return!(n>this.a_||e>this.c_)},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=ho.Dt,i=t?this.v_:1;if(t&&i/this.f_.length<.5){for(var n=i/.5,e=this.f_.length-1;e>=n;e--){var r=this.f_[e];r.vertexBuffers[0]&&r.vertexBuffers[0].destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.ia.destroy()}this.f_.length=n}for(var s=this.byteOffset,h=this.indexOffset,u=0;u<i;++u){var o=this.f_[u],a=new Float32Array(this.vData.buffer,0,s>>2),c=new Uint16Array(this.iData.buffer,0,h),f=o.vertexBuffers[0];s>f.size&&f.resize(s),f.update(a),2*h>o.indexBuffer.size&&o.indexBuffer.resize(2*h),o.indexBuffer.update(c)}this.dirty=!1}},t.l_=function(t){var i,n,e;if(ho.Dt||!this.f_[0]){var r=this.o_=4*this._floatsPerVertex,s=t.createBuffer(new ud(10,3,r,r));e=t.createBuffer(new ud(6,3,2,2)),n=[s],this.Kl=new Sd(this.jn,n,e),i=t.createInputAssembler(this.Kl)}else i=t.createInputAssembler(this.Kl),n=this.Kl.vertexBuffers,e=this.Kl.indexBuffer;return{ia:i,vertexBuffers:n,indexBuffer:e}},e(i,[{key:"attributes",get:function(){return this.jn}},{key:"vertexFormatBytes",get:function(){return this.o_}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(t){this._byteOffset=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(t){this._indexOffset=t}},{key:"dirty",get:function(){return this._dirty},set:function(t){this._dirty=t}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(t){this._floatsPerVertex=t}},{key:"vData",get:function(){return this._vData},set:function(t){this._vData=t}},{key:"iData",get:function(){return this._iData},set:function(t){this._iData=t}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),i}()),TB=function(){function t(t,i){this._buffers=[],this._device=t,this._attributes=i,this._floatsPerVertex=EB(i)>>2,this._vertexFormatBytes=4*this._floatsPerVertex}var i=t.prototype;return i.initialize=function(){},i.reset=function(){},i.request=function(){},i.appendBuffers=function(){},i.uploadBuffers=function(){},i.destroy=function(){this._attributes.length=0},e(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}(),SB=new uu((function(){return{offset:0,length:0}}),32),OB=function(){function t(t,i,n,e,r,s){this.vertexAccessor=t,this.bufferId=i,this.meshBuffer=n,this.vertexOffset=e,this.vb=r,this.indexCount=s,this.d_=new Uint16Array(s),t.getMeshBuffer(i)}return t.prototype.setIndexBuffer=function(){},e(t,[{key:"ib",get:function(){return this.d_}}]),t}(),RB=function(t){function i(n,e,r,s){var h;return(h=t.call(this,n,e)||this).g_=[],h.w_=0,h.__=0,h.Je=0,h.w_=r||Math.floor(1024*Gi.BATCHER2D_MEM_INCREMENT/h._vertexFormatBytes),h.__=s||h.w_*i.IB_SCALE,h.Je=i.generateID(),h.m_(),h}s(i,t);var n=i.prototype;return n.destroy=function(){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy();for(var n=this.g_[i],e=0;e<n.length;++e)SB.free(n[e])}this._buffers.length=0,this.g_.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var i=this._buffers[t];i.indexOffset=0,i.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var i=this.g_[t][0],n=this._buffers[t];(!i||i.length<n.vData.byteLength)&&n.uploadBuffers()}},n.appendIndices=function(t,i){var n=this._buffers[t];if(i.length){var e=n.indexOffset+i.length;if(n.iData.length<e){var r=Math.floor(1.25*e),s=new Uint16Array(r);s.set(n.iData),n.iData=s}n.iData.set(i,n.indexOffset),n.indexOffset+=i.length}},n.allocateChunk=function(t,i){var n=t*this.vertexFormatBytes;if(t>this.w_||i>this.__)return ut(9004,n),null;for(var e,r=null,s=0,h=-1,u=null,o=0;o<this._buffers.length;++o){r=this._buffers[o],e=this.g_[o];for(var a=0;a<e.length;++a)if(e[a].length>=n){u=e[a],s=o,h=a;break}if(u)break}if(u||(s=this.m_(),(r=this._buffers[s])&&(h=0,u=this.g_[s][h])),u){var c=u.offset/this.vertexFormatBytes,f=new Float32Array(r.vData.buffer,u.offset,n>>2).fill(0);return this.p_(s,h,u,n),new OB(this,s,r,c,f,i)}return null},n.recycleChunk=function(t){var i=this.g_[t.bufferId],n=this._buffers[t.bufferId],e=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var s=!1,h=0,u=null,o=i[h];o&&o.offset<e;)u=o,o=i[++h];if(u&&0==e-(u.offset+u.length)&&(u.length+=r,e=u.offset,r=u.length,o&&o.offset-(e+r)==0&&(u.length+=o.length,i.splice(h,1),SB.free(o),o=null),s=!0),!s&&o){if(0==o.offset-(e+r))o.offset=e,o.length+=r;else{var a=SB.alloc();a.offset=e,a.length=r,i.splice(h,0,a)}s=!0}if(s)e+r===n.byteOffset&&(n.byteOffset=e);else{var c=SB.alloc();c.offset=e,c.length=r,i.push(c)}}},n.p_=function(t,i,n,e){var r=n.length-e,s=n.offset+e,h=this._buffers[t];h.byteOffset<s&&(h.byteOffset=s),at(r>=0,9004,t,n.offset,n.length),0===r?(this.g_[t].splice(i,1),SB.free(n)):(n.offset+=e,n.length=r)},n.m_=function(){at(this._buffers.length===this.g_.length,9003);var t=new kB,i=this.w_*this._floatsPerVertex;t.initialize(this._device,this._attributes,i,this.__),this._buffers.push(t);var n=SB.alloc();n.offset=0,n.length=t.vData.byteLength;var e=[n];return this.g_.push(e),xC.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},i.generateID=function(){return i.ID_COUNT++},e(i,[{key:"id",get:function(){return this.Je}}]),i}(TB);RB.IB_SCALE=4,RB.ID_COUNT=0,function(){function t(t){this.y_=-1,this.b_=-1,this.A_=0,this.E_=0,this.k_=null,this.d_=null,this.T_=null,this.S_=null,this.O_=!1,this.R_=0,this.I_=0,this.M_=0,this.N_=!1,this.C_=null,this.es=null,this.L_=null,this.hn=0,this.F_=!1,this.P_=null,this.B_=0,this.D_=null,this.U_=null,this.ou(t);var i=this.x_.getAttrSharedBufferForJS(),n=0;this.G_=new Uint8Array(i,n,4),n+=4,this.j_=new Uint16Array(i,n,2),n+=4,this.H_=new Uint32Array(i,n,5)}var i=t.prototype;i.ou=function(){},i.V_=function(){this.b_=0,this.A_=0,this.E_=0,this.O_=!1},i.W_=function(t){this.y_=t},i.z_=function(t){this.b_=t},i.X_=function(t,i){this.b_=i,this.y_=t},i.Y_=function(t){this.A_=t},i.K_=function(t){this.E_=t},i.q_=function(){},i.Q_=function(){},i.Z_=function(){},i.J_=function(){},i.tm=function(t){this.R_=t},i.im=function(){},i.nm=function(t){this.O_=t},i.rm=function(t){this.M_=t},i.sm=function(t){this.N_=t},i.hm=function(){},i.um=function(t){this.C_=t},i.om=function(t){this.es=t},i.am=function(t){this.L_=t},i.fm=function(){},i.vm=function(t){this.B_=t},i.lm=function(t){this.D_=t},i.dm=function(t){this.hn=t},i.gm=function(){},i.wm=function(){},e(t,[{key:"nativeObj",get:function(){return this.x_}},{key:"render2dBuffer",get:function(){return this.U_}}])}();var IB,MB,NB,CB,LB,FB,PB,BB,DB,UB,xB,GB=EB(mB)>>2,jB=t("BaseRenderData",function(){function t(t){void 0===t&&(t=mB),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=mB,this._drawInfoType=0,this._multiOwner=!1,this._batcher=null,this._floatStride=t===mB?GB:EB(t)>>2,this._vertexFormat=t}var i=t.prototype;return i.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},i.initRenderDrawInfo=function(){},i.removeRenderDrawInfo=function(){},i._m=function(){},e(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(t){this._drawInfoType=t}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(t){this._material=t}},{key:"dataHash",get:function(){return this._dataHash},set:function(t){this._dataHash=t}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(t){this._multiOwner=t}},{key:"batcher",get:function(){return this._batcher||(this._batcher=xC.root.batcher2D),this._batcher}}]),t}()),HB=t("RenderData",function(t){function i(i,n){var e;return void 0===i&&(i=mB),void 0===n&&(n=null),(e=t.call(this,i)||this)._vertDirty=!0,e._textureHash=0,e.indices=null,e.layer=0,e.nodeDirty=!0,e.passDirty=!0,e.textureDirty=!0,e.hashDirty=!0,e.I=[],e.pm=null,e._accessor=null,e.vertexRow=1,e.vertexCol=1,n||(n=e.batcher.switchBufferAccessor(e._vertexFormat)),e._accessor=n,e}s(i,t),i.add=function(t,n){void 0===t&&(t=mB),void 0===n&&(n=null);var e=new i(t,n);return n||(n=xC.root.batcher2D.switchBufferAccessor(e._vertexFormat)),e._accessor=n,e},i.remove=function(t){t.clear(),t._accessor=null};var n=i.prototype;return n.resize=function(t,i){t===this._vc&&i===this._ic&&this.chunk||(this._vc=t,this._ic=i,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,i),this.updateHash())},n._m=function(){},n.ym=function(){},n.bm=function(){},n.resizeAndCopy=function(t,i){if(t!==this._vc||i!==this._ic||!this.chunk){this._vc=t,this._ic=i;var n=this.chunk;this.chunk=this._accessor.allocateChunk(t,i),n&&(this.chunk.vb.set(n.vb),this._accessor.recycleChunk(n)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=Wv(t,666),this.hashDirty=!1},n.updateRenderData=function(t,i){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var n=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==n&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=i,this.textureHash=i.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},n.clear=function(){this.resize(0,0),this.I.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},i.createStaticVBAccessor=function(t,i,n){var e=xC.root.device;return new RB(e,t,i,n)},e(i,[{key:"dataLength",get:function(){return this.I.length},set:function(t){var i=this.I;if(i.length!==t){for(var n=i.length;n<t;n++)i.push({x:0,y:0,z:0,u:0,v:0,color:cr.WHITE.clone()});i.length=t}this.bm()}},{key:"data",get:function(){return this.I}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(t){this._vertDirty=t}},{key:"textureHash",get:function(){return this._textureHash},set:function(t){this._textureHash=t}},{key:"frame",get:function(){return this.pm},set:function(t){this.pm=t}},{key:"accessor",get:function(){return this._accessor}}]),i}(jB)),VB=t("MeshRenderData",function(t){function i(i){var n;return void 0===i&&(i=mB),(n=t.call(this,i)||this)._isMeshBuffer=!0,n.vertexStart=0,n.vertexRange=0,n.indexStart=0,n.indexRange=0,n.lastFilledIndex=0,n.lastFilledVertex=0,n.frame=null,n.Am=0,n.Vn=[],n.$n=null,n.f_=null,n.Kl=null,n.vData=new Float32Array(256*n.stride),n.iData=new Uint16Array(1536),n}s(i,t),i.add=function(t){void 0===t&&(t=mB);var n=new i;return n._floatStride=t===mB?GB:EB(t)>>2,n._vertexFormat=t,n},i.remove=function(t){t.clear()};var n=i.prototype;return n.request=function(t,i){var n=this.Am+t*this.stride;return!!this.reserve(t,i)&&(this._vc+=t,this._ic+=i,this.Am=n,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,i){var n=this.Am+t*this.stride,e=this.indexCount+i;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,s=this.iData.length,h=this.vData.length,u=this.iData.length;if(n>r||e>s){for(;r<n||s<e;)r=4*(h*=2),s=u*=2;this._reallocBuffer(h,u)}return!0},n.resize=function(t,i){var n=t*this.stride;t>=0&&i>=0&&n<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=i,this.Am=n,this.updateRange(0,t,0,i)},n.updateRange=function(t,i,n,e){i>=0&&e>=0&&i<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=n,this.vertexRange=i,this.indexRange=e},n.requestIA=function(t){this._initIAInfo(t);var i=this.f_.add();return i.firstIndex=this.indexStart,i.indexCount=this.indexRange,i},n.uploadBuffers=function(){if(0!==this.Am&&this.Vn[0]&&this.$n){var t=this._ic,i=new Float32Array(this.vData.buffer,0,this.Am>>2),n=new Uint16Array(this.iData.buffer,0,t),e=this.Vn[0];this.Am>e.size&&e.resize(this.Am),e.update(i);var r=t<<1;r>this.$n.size&&this.$n.resize(r),this.$n.update(n)}},n.freeIAPool=function(){this.f_&&this.f_.reset()},n.reset=function(){this._vc=0,this._ic=0,this.Am=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this.f_&&this.f_.destroy(),this.Vn[0]&&(this.Vn[0].destroy(),this.Vn=[]),this.Kl=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var i=this;if(!this.Kl){var n=this.stride,e=this.Vn;e.length||e.push(t.createBuffer(new ud(10,1,n,n))),this.$n||(this.$n=t.createBuffer(new ud(6,1,2,2))),this.Kl=new Sd(this._vertexFormat,e,this.$n),this.f_=new ou((function(){return t.createInputAssembler(i.Kl)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,i){var n=this.vData;this.vData=new Float32Array(t),n&&this.vData.set(n,0);var e=this.iData;this.iData=new Uint16Array(i),e&&this.iData.set(e,0)},n._m=function(){},n.Em=function(){},e(i,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this.Am>>>2}}]),i}(jB)),$B=new ls,WB=new ls,zB=new ir,XB=new Kr,YB=new Kr,KB=new Kr,qB=new Kr(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),QB=new ps,ZB=Ko("cc.UITransform")(IB=Qo(110)(IB=Zo((LB=function(t){function i(){var i;return(i=t.call(this)||this)._priority=0,i._contentSize=NB&&NB(),i._anchorPoint=CB&&CB(),i}s(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&i.km(this.node.parent)},n.onEnable=function(){this.node.on("parent-changed",this._parentChanged,this),this.Tm()},n.onDisable=function(){this.node.off("parent-changed",this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,i){var n,e,r=this._contentSize;if(void 0===i){if(Zn(t.width,r.width,qn)&&Zn(t.height,r.height,qn))return;n=t.width,e=t.height}else{if(Zn(t,r.width,qn)&&Zn(i,r.height,qn))return;n=t,e=i}r.width=n,r.height=e,this.node.emit("size-changed"),this.Tm()},n.setAnchorPoint=function(t,i){var n=this._anchorPoint;if(void 0===i){if(t.x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&i===n.y)return;n.x=t,n.y=i}this.node.emit("anchor-changed",this._anchorPoint),this.Tm()},n.isHit=function(t){for(var i=this._contentSize.width,n=this._contentSize.height,e=$B,r=WB,s=this._getRenderScene().cameras,h=0;h<s.length;h++){var u=s[h];if(u.visibility&this.node.layer){u.node.getWorldRT(XB);var o=XB.m12,a=XB.m13,c=uo.center;if(XB.m12=c.x-(XB.m00*o+XB.m04*a),XB.m13=c.y-(XB.m01*o+XB.m05*a),Kr.invert(XB,XB),ls.transformMat4(e,t,XB),this.node.getWorldMatrix(KB),Kr.invert(XB,KB),!Kr.strictEquals(XB,qB)){ls.transformMat4(r,e,XB),r.x+=this._anchorPoint.x*i,r.y+=this._anchorPoint.y*n;var f=!1;if(r.x>=0&&r.y>=0&&r.x<=i&&r.y<=n&&(f=this.Sm(e)),f)return!0}}}return!1},n.hitTest=function(t,i){void 0===i&&(i=0);for(var n=this._contentSize.width,e=this._contentSize.height,r=zB,s=$B,h=WB,u=this._getRenderScene().cameras,o=0;o<u.length;o++){var a=u[o];if(a.visibility&this.node.layer&&(!a.window||a.window.swapchain)&&a.systemWindowId===i&&(ir.set(r,t.x,t.y,0),a.screenToWorld(r,r),ls.set(s,r.x,r.y),this.node.getWorldMatrix(KB),Kr.invert(XB,KB),!Kr.strictEquals(XB,qB))){ls.transformMat4(h,s,XB),h.x+=this._anchorPoint.x*n,h.y+=this._anchorPoint.y*e;var c=!1;if(h.x>=0&&h.y>=0&&h.x<=n&&h.y<=e&&(c=this.Sm(s)),c)return!0}}return!1},n.Sm=function(t){var i,n,e=null==(i=this.node)||null==(n=i.eventProcessor)?void 0:n.maskList;if(e)for(var r=this.node,s=e.length,h=0,u=0;r&&u<s;++h,r=r.parent){var o=e[u];if(h===o.index){if(r!==o.comp.node){e.length=u;break}var a=o.comp;if(a&&a._enabled&&!a.isHit(t))return!1;u++}else if(h>o.index){e.length=u;break}}return!0},n.convertToNodeSpaceAR=function(t,i){return this.node.getWorldMatrix(KB),Kr.invert(XB,KB),i||(i=new ir),ir.transformMat4(i,t,XB)},n.convertToWorldSpaceAR=function(t,i){return this.node.getWorldMatrix(KB),i||(i=new ir),ir.transformMat4(i,t,KB)},n.getBoundingBox=function(){var t=new ps;return this._selfBoundingBox(t),Kr.fromSRT(YB,this.node.rotation,this.node.position,this.node.scale),t.transformMat4(YB),t},n.getBoundingBoxToWorld=function(){for(var t=new ps,n=this.node.children,e=0;e<n.length;++e){var r=n[e];if(r&&r.active){var s=r.getComponent(i);s&&s.contentSize.width&&s.contentSize.height&&(s._selfBoundingBox(QB),QB.transformMat4(r.worldMatrix),0===t.width?t.set(QB):ps.union(t,t,QB))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(QB),QB.transformMat4(this.node.worldMatrix),0===t.width?t.set(QB):ps.union(t,t,QB)),t},n.getBoundingBoxTo=function(t){var n=new ps,e=this.node.children;Kr.invert(XB,t);for(var r=0;r<e.length;++r){var s=e[r];if(s&&s.active){var h=s.getComponent(i);h&&h.contentSize.width&&h.contentSize.height&&(h._selfBoundingBox(QB),Kr.multiply(YB,s.worldMatrix,XB),QB.transformMat4(YB),0===n.width?n.set(QB):ps.union(n,n,QB))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(QB),Kr.multiply(YB,this.node.worldMatrix,XB),QB.transformMat4(YB),0===n.width?n.set(QB):ps.union(n,n,QB)),n},n.getComputeAABB=function(t){var i=this._contentSize.width,n=this._contentSize.height;QB.set(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),QB.transformMat4(this.node.worldMatrix);var e=QB.x+.5*QB.width,r=QB.y+.5*QB.height,s=this.node.worldPosition.z,h=QB.width/2,u=QB.height/2;return null!=t?(wo.set(t,e,r,s,h,u,.001),t):new wo(e,r,s,h,u,.001)},n._selfBoundingBox=function(t){var i=this._contentSize.width,n=this._contentSize.height;return t.set(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),t},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&i.km(this.node.parent)},n.Tm=function(){var t=this.node._uiProps.uiComp;t&&t.wh()},i.km=function(t){var n=t.uuid;i.Om.has(n)||i.Om.set(n,t)},i.Rm=function(t){var i=t.children;i&&i.sort((function(t,i){var n=t.Zs(),e=i.Zs(),r=(n?n._priority:0)-(e?e._priority:0);return 0===r?t.siblingIndex-i.siblingIndex:r}))},i.Im=function(){i.Om.forEach((function(t){i.Rm(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),i.Om.clear()},i.Mm=function(){i.Om.clear()},e(i,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit("size-changed"),this.Tm())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit("size-changed"),this.Tm())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit("size-changed"),this.Tm())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit("anchor-changed",this._anchorPoint),this.Tm())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit("anchor-changed",this._anchorPoint),this.Tm())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit("anchor-changed",this._anchorPoint),this.Tm())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?st(6706):(this._priority=t,this.node.parent&&i.km(this.node.parent)))}},{key:"visibility",get:function(){var t=xC.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=xC.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),i}(w_),LB.EventType=Gm,LB.Om=new Map,NB=xo((MB=LB).prototype,"_contentSize",[oa],(function(){return new gs(100,100)})),CB=xo(MB.prototype,"_anchorPoint",[oa],(function(){return new ls(.5,.5)})),IB=MB))||IB)||IB)||IB;t({UITransform:ZB,UITransformComponent:ZB}),xC.on("director_after_update",ZB.Im),xC.on("director_before_scene_launch",ZB.Mm);var JB,tD,iD,nD,eD,rD,sD,hD,uD,oD,aD,cD,fD={parent:null,owner:null,subModelIdx:0},vD=Zo,lD=Ca,dD=t("Renderer",(FB=Ko("cc.Renderer"),PB=lD(Lk),BB=lD([Lk]),FB(DB=vD((UB=function(t){function i(){var i;return(i=t.call(this)||this)._materials=xB&&xB(),i._materialInstances=[],i}s(i,t);var n=i.prototype;return n.getMaterial=function(t){return this.getSharedMaterial(t)},n.setMaterial=function(t,i){this.setSharedMaterial(t,i)},n.getSharedMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},n.setSharedMaterial=function(t,i){if(t&&t instanceof Hk&&ut(12012),this._materials[i]!==t){this._materials[i]=t;var n=this._materialInstances[i];n&&(n.destroy(),this._materialInstances[i]=null),this._onMaterialModified(i,this._materials[i])}},n.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){fD.parent=this._materials[t],fD.owner=this,fD.subModelIdx=t;var i=new Hk(fD);fD.parent=null,fD.owner=null,fD.subModelIdx=0,this.setMaterialInstance(i,t)}return this._materialInstances[t]},n.setMaterialInstance=function(t,i){if("number"==typeof t){st(12007);var n=t;t=i,i=n}var e=this._materialInstances[i];t&&t.parent?t!==e&&(this._materialInstances[i]=t,this._onMaterialModified(i,t)):(t!==this._materials[i]||e)&&this.setSharedMaterial(t,i)},n.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},n._onMaterialModified=function(){},n.Pu=function(){},n._clearMaterials=function(){},e(i,[{key:"sharedMaterial",get:function(){return this.getSharedMaterial(0)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var i=0;i<t.length;i++)t[i]!==this._materials[i]&&this.setSharedMaterial(t[i],i);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setSharedMaterial(null,n);this._materials.splice(t.length)}}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){for(var i=t.length,n=this._materials.length,e=i;e<n;e++)this.setMaterialInstance(null,e);this._materials.length=i,this._materialInstances.length=i;for(var r=0;r<i;r++)this._materialInstances[r]!=t[r]&&this.setMaterialInstance(t[r],r)}}]),i}(w_),m(UB.prototype,"sharedMaterials",[PB],Object.getOwnPropertyDescriptor(UB.prototype,"sharedMaterials"),UB.prototype),xB=xo(UB.prototype,"_materials",[BB],(function(){return[]})),DB=UB))||DB)||DB)),gD=function(){function t(){this.Nm=0,this.Cm=[],this.ds=null,this.Lm=null,this.Fm=0,this.F_=!1,this.Pm=0,this.Bm=cr.WHITE.clone(),this.vs=255,this.Dm=!0,this.fc=!1}var i=t.prototype;return i.Um=function(){},i.xm=function(){},i.Gm=function(){},i.jm=function(){},i.Hm=function(){},i.Vm=function(t){this.Pm=t},i.$m=function(){return null},i.Wm=function(t){this.ds=t},i.zm=function(t){this.Lm=t},i.Xm=function(t){this.Fm=t},i.Ym=function(t){this.F_=t},i.Km=function(){},e(t,[{key:"nativeObj",get:function(){return this.x_}},{key:"renderDrawInfoArr",get:function(){return this.Cm}},{key:"renderEntityType",get:function(){return this.Nm}},{key:"color",get:function(){return this.Bm},set:function(t){this.Bm=t}},{key:"localOpacity",get:function(){return this.vs},set:function(t){this.vs=t}},{key:"colorDirty",get:function(){return this.Dm},set:function(t){this.Dm=t}},{key:"enabled",get:function(){return this.fc},set:function(t){this.fc=t}}]),t}();Fi(Al),Fi(El),Fi(kl),t("InstanceMaterialType",{ADD_COLOR:0,ADD_COLOR_AND_TEXTURE:1,GRAYSCALE:2,USE_ALPHA_SEPARATED:3,USE_ALPHA_SEPARATED_AND_GRAY:4});var wD=(JB=Ko("cc.UIRenderer"),tD=qo(ZB),iD=Ca(Lk),nD=Ca(Lk),JB(eD=tD((cD=function(t){function i(){var i;return(i=t.call(this)||this)._renderData=null,i._materials=sD&&sD(),i._customMaterial=hD&&hD(),i._srcBlendFactor=uD&&uD(),i._dstBlendFactor=oD&&oD(),i._color=aD&&aD(),i._stencilStage=0,i._assembler=null,i._postAssembler=null,i._renderDataFlag=!0,i._renderFlag=!0,i._instanceMaterialType=-1,i._srcBlendFactorCache=2,i._dstBlendFactorCache=4,i._dirtyVersion=-1,i._internalId=-1,i.qm=-1,i._useVertexOpacity=!1,i._lastParent=null,i._renderEntity=i.createRenderEntity(),i}s(i,t);var n=i.prototype;return n.Qm=function(t){this._renderData=t},n.onLoad=function(){this._renderEntity.Wm(this.node)},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this),this.node.on("parent-changed",this._colorDirty,this),!this._renderData&&this._flushAssembler&&this._flushAssembler(),this.updateMaterial(),this._colorDirty(),OC.Al(this),this.wh()},n.onRestore=function(){this.updateMaterial(),this.wh()},n.onDisable=function(){this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this),this.node.off("parent-changed",this._colorDirty,this),this.destroyRenderData(),OC.El(this),this._renderFlag=!1,this._renderEntity.enabled=!1},n.onDestroy=function(){if(this._renderEntity.Wm(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var i=this._materialInstances[t];i&&i.destroy()}},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),this.wh(t)},n.wh=function(t){if(void 0===t&&(t=!0),t){var i=this._renderData;i&&(i.vertDirty=!0),OC.kl(this)}},n.requestRenderData=function(t){void 0===t&&(t=0);var i=HB.add();return i.initRenderDrawInfo(this,t),this._renderData=i,i},n.destroyRenderData=function(){this._renderData&&(this._renderData.removeRenderDrawInfo(this),HB.remove(this._renderData),this._renderData=null)},n.updateRenderer=function(){var t=this._assembler;t&&t.updateRenderData&&t.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},n.fillBuffers=function(t){this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setSharedMaterial(t,0),2!==this.stencilStage&&6!==this.stencilStage||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},n._updateColor=function(){this.node._uiProps.colorDirty=!0,this.Zm(!0),this.setEntityColor(this._color),this.setEntityOpacity(this.node._uiProps.localOpacity);var t=this._assembler;if(t){t.updateColor&&t.updateColor(this);var i=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),i!==this._renderFlag){var n=this.renderData;n&&(n.vertDirty=!0)}}},i.setEntityColorDirtyRecursively=function(t,n){var e=t._uiProps.uiComp;e&&e.color&&(e._renderEntity.colorDirty=n);for(var r=0;r<t.children.length;r++)i.setEntityColorDirtyRecursively(t.children[r],n)},n.Zm=function(){},n.setEntityColor=function(){},n.setEntityOpacity=function(){},n.setEntityEnabled=function(){},n._updateBlendFunc=function(){var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(t=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,t.blendDstAlpha=4,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;var i=this.getMaterialInstance(0).passes[0];i.blendState.setTarget(0,t),i.yu(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},n._nodeStateChange=function(){this._renderData&&this.wh();for(var t=0;t<this.node.children.length;++t){var n=this.node.children[t].getComponent(i);n&&n.wh()}},n._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.Zm(!0)},n._onMaterialModified=function(i,n){this._renderData&&(this.wh(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,i,n)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case 0:t=uk.get("ui-base-material");break;case 2:t=uk.get("ui-sprite-gray-material");break;case 3:t=uk.get("ui-sprite-alpha-sep-material");break;case 4:t=uk.get("ui-sprite-gray-alpha-sep-material");break;default:t=uk.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this._renderData&&(this._renderData.nodeDirty=!0)},n.setTextureDirty=function(){this._renderData&&(this._renderData.textureDirty=!0)},n.createRenderEntity=function(){return new gD(0)},e(i,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var i=0;i<t.length;i++)t[i]!==this._materials[i]&&this.setSharedMaterial(t[i],i);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setSharedMaterial(null,n);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(t){this._stencilStage=t,this._renderEntity.Xm(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t}},{key:"batcher",get:function(){return xC.root.batcher2D}},{key:"renderEntity",get:function(){return this._renderEntity}}]),i}(dD),cD.BlendState=Al,cD.Assembler=null,cD.PostAssembler=null,m((rD=cD).prototype,"sharedMaterials",[ja],Object.getOwnPropertyDescriptor(rD.prototype,"sharedMaterials"),rD.prototype),m(rD.prototype,"customMaterial",[iD],Object.getOwnPropertyDescriptor(rD.prototype,"customMaterial"),rD.prototype),sD=xo(rD.prototype,"_materials",[ja],(function(){return[]})),hD=xo(rD.prototype,"_customMaterial",[nD],(function(){return null})),uD=xo(rD.prototype,"_srcBlendFactor",[oa],(function(){return 2})),oD=xo(rD.prototype,"_dstBlendFactor",[oa],(function(){return 4})),aD=xo(rD.prototype,"_color",[oa],(function(){return cr.WHITE.clone()})),eD=rD))||eD)||eD);t({UIRenderer:wD,RenderComponent:wD,UIRenderable:wD,Renderable2D:wD}),k.internal.UIRenderer=wD;var _D,mD,pD,yD,bD,AD,ED,kD,TD,SD,OD,RD,ID,MD,ND,CD,LD,FD,PD,BD,DD,UD,xD,GD,jD,HD,VD,$D,WD,zD,XD,YD,KD,qD,QD=function(){function t(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor=cr.WHITE.clone(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor=cr.BLACK.clone(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0,this.color=cr.WHITE.clone(),this.fontSize=40,this.actualFontSize=0,this.isSystemFontUsed=!1,this.originFontSize=0,this.bmfontScale=1,this.fontFamily="Arial",this.fontDesc="",this.fntConfig=null,this.spriteFrame=null,this.fontScale=1}return t.prototype.reset=function(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor.set(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor.set(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0},t}(),ZD=function(){function t(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions=new gs,this.horizontalKerning=[],this.numberOfLines=1,this.linesOffsetX=[],this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth=[]}return t.prototype.reset=function(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions.set(),this.horizontalKerning.length=0,this.numberOfLines=1,this.linesOffsetX.length=0,this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth.length=0},t}(),JD=function(){function t(){this.parsedString=[],this.nodeContentSize=gs.ZERO.clone(),this.canvasSize=new gs,this.canvasPadding=new ps,this.contentSizeExtend=gs.ZERO.clone(),this.startPosition=ls.ZERO.clone()}return t.prototype.reset=function(){this.parsedString.length=0,this.nodeContentSize.set(0,0),this.canvasSize.set(),this.canvasPadding.set(),this.contentSizeExtend.set(),this.startPosition.set()},t}(),tU=function(){function t(){this.quadCount=0,this.vertexBuffer=[],this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}return t.prototype.reset=function(){this.quadCount=0,this.vertexBuffer.length=0,this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5},t}();cr.WHITE.clone();var iU=t("HorizontalTextAlignment",{LEFT:0,CENTER:1,RIGHT:2});Fi(iU);var nU=t("VerticalTextAlignment",{TOP:0,CENTER:1,BOTTOM:2});Fi(nU);var eU=t("Overflow",{NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});Fi(eU);var rU=t("CacheMode",{NONE:0,BITMAP:1,CHAR:2});Fi(rU);var sU,hU,uU,oU,aU,cU,fU,vU,lU,dU,gU,wU,_U,mU,pU,yU,bU,AU,EU,kU,TU=(_D=Ko("cc.Label"),mD=Qo(110),pD=Ca(iU),yD=Ca(nU),bD=Ca(eU),AD=Ca(ZF),ED=Ca(rU),_D(kD=mD((qD=function(t){function i(){var i;return(i=t.call(this)||this)._string=SD&&SD(),i._horizontalAlign=OD&&OD(),i._verticalAlign=RD&&RD(),i._actualFontSize=ID&&ID(),i._fontSize=MD&&MD(),i._fontFamily=ND&&ND(),i._lineHeight=CD&&CD(),i._overflow=LD&&LD(),i._enableWrapText=FD&&FD(),i._font=PD&&PD(),i._isSystemFontUsed=BD&&BD(),i._spacingX=DD&&DD(),i._isItalic=UD&&UD(),i._isBold=xD&&xD(),i._isUnderline=GD&&GD(),i._underlineHeight=jD&&jD(),i._cacheMode=HD&&HD(),i._enableOutline=VD&&VD(),i._outlineColor=$D&&$D(),i._outlineWidth=WD&&WD(),i._enableShadow=zD&&zD(),i._shadowColor=XD&&XD(),i._shadowOffset=YD&&YD(),i._shadowBlur=KD&&KD(),i._N$file=null,i._texture=null,i._ttfSpriteFrame=null,i._userDefinedFont=null,i._assemblerData=null,i._fontAtlas=null,i._letterTexture=null,i._contentWidth=0,i._textStyle=null,i._textLayout=null,i._textRenderData=null,i._textLayoutData=null,i._ttfSpriteFrame=null,i._textStyle=new QD,i._textLayout=new ZD,i._textLayoutData=new JD,i._textRenderData=new tU,i}s(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},n.Jm=function(){if(this._ttfSpriteFrame){this._ttfSpriteFrame.us();var t=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),t){var i=t;i.image&&i.image.destroy(),t.destroy()}this._ttfSpriteFrame=null}},n._onPreDestroy=function(){t.prototype._onPreDestroy.call(this),this._isOnLoadCalled||this.Jm()},n.onDestroy=function(){this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this.Jm(),this.tp(),t.prototype.onDestroy.call(this)},n.tp=function(){var t=this._letterTexture;t&&(t.decRef(!1),t.refCount<=0&&t.destroy()),this._letterTexture=null},n.updateRenderData=function(t){void 0===t&&(t=!1),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture()),this._assembler&&this._assembler.updateRenderData(this)},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},n._updateColor=function(){t.prototype._updateColor.call(this),this.wh()},n.setEntityColor=function(){},n._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var i=this._font;if(i&&i instanceof tB){var n=i.spriteFrame;if(!n||!n.texture)return!1}return!0},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t,this.textStyle.reset(),this.textLayout.reset(),this.textLayoutData.reset(),this.textRenderData.reset()),this.renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.renderData.material=this.material,this._updateColor())},n._applyFontTexture=function(){this.wh();var t=this._font;if(t instanceof tB){var i=t.spriteFrame;i&&i.texture&&(this._texture=i,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(2===this.cacheMode){var n=this._letterTexture,e=this._assembler.getAssemblerData();e!==n&&(this.tp(),e&&e.addRef()),this._texture=this._letterTexture=e}else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new zF,this._assemblerData=this._assembler.getAssemblerData();var r=new jw(this._assemblerData.canvas),s=new Mm;s.image=r,this._ttfSpriteFrame.texture=s}2!==this.cacheMode&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},n.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(2!==this.cacheMode){var i=this._texture.texture;if(i instanceof zw){var n=i.getPixelFormat();t=1026===n||1025===n||1024===n}}this._instanceMaterialType=t?3:1,this.updateMaterial()}},n._updateBlendFunc=function(){t.prototype._updateBlendFunc.call(this)},e(i,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this.wh())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.wh())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.wh())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.wh())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.wh())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.wh())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.wh())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.wh())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.wh())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.wh())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this.destroyRenderData(),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){var i=this._cacheMode;i!==t&&(1!==i||this._font instanceof tB||!this._ttfSpriteFrame||this._ttfSpriteFrame.us(),2===i&&(this._ttfSpriteFrame=null,this.tp()),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.wh())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.wh())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.wh())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.wh())}},{key:"enableOutline",get:function(){return this._enableOutline},set:function(t){this._enableOutline!==t&&(this._enableOutline=t,this.wh())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor.set(t),this.wh())}},{key:"outlineWidth",get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this.wh())}},{key:"enableShadow",get:function(){return this._enableShadow},set:function(t){this._enableShadow!==t&&(this._enableShadow=t,this.wh())}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor.set(t),this.wh())}},{key:"shadowOffset",get:function(){return this._shadowOffset},set:function(t){this._shadowOffset!==t&&(this._shadowOffset.set(t),this.wh())}},{key:"shadowBlur",get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this.wh())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof tB?this._font.fontSize:-1}},{key:"textStyle",get:function(){return this._textStyle}},{key:"textLayout",get:function(){return this._textLayout}},{key:"textRenderData",get:function(){return this._textRenderData}},{key:"textLayoutData",get:function(){return this._textLayoutData}},{key:"contentWidth",get:function(){return this._contentWidth},set:function(t){this._contentWidth=t}}]),i}(wD),qD.HorizontalAlign=iU,qD.VerticalAlign=nU,qD.Overflow=eU,qD.CacheMode=rU,qD._canvasPool=eB.e_(),m((TD=qD).prototype,"horizontalAlign",[pD],Object.getOwnPropertyDescriptor(TD.prototype,"horizontalAlign"),TD.prototype),m(TD.prototype,"verticalAlign",[yD],Object.getOwnPropertyDescriptor(TD.prototype,"verticalAlign"),TD.prototype),m(TD.prototype,"overflow",[bD],Object.getOwnPropertyDescriptor(TD.prototype,"overflow"),TD.prototype),m(TD.prototype,"font",[AD],Object.getOwnPropertyDescriptor(TD.prototype,"font"),TD.prototype),m(TD.prototype,"cacheMode",[ED],Object.getOwnPropertyDescriptor(TD.prototype,"cacheMode"),TD.prototype),SD=xo(TD.prototype,"_string",[oa],(function(){return"label"})),OD=xo(TD.prototype,"_horizontalAlign",[oa],(function(){return 1})),RD=xo(TD.prototype,"_verticalAlign",[oa],(function(){return 1})),ID=xo(TD.prototype,"_actualFontSize",[oa],(function(){return 0})),MD=xo(TD.prototype,"_fontSize",[oa],(function(){return 40})),ND=xo(TD.prototype,"_fontFamily",[oa],(function(){return"Arial"})),CD=xo(TD.prototype,"_lineHeight",[oa],(function(){return 40})),LD=xo(TD.prototype,"_overflow",[oa],(function(){return 0})),FD=xo(TD.prototype,"_enableWrapText",[oa],(function(){return!0})),PD=xo(TD.prototype,"_font",[oa],(function(){return null})),BD=xo(TD.prototype,"_isSystemFontUsed",[oa],(function(){return!0})),DD=xo(TD.prototype,"_spacingX",[oa],(function(){return 0})),UD=xo(TD.prototype,"_isItalic",[oa],(function(){return!1})),xD=xo(TD.prototype,"_isBold",[oa],(function(){return!1})),GD=xo(TD.prototype,"_isUnderline",[oa],(function(){return!1})),jD=xo(TD.prototype,"_underlineHeight",[oa],(function(){return 2})),HD=xo(TD.prototype,"_cacheMode",[oa],(function(){return 0})),VD=xo(TD.prototype,"_enableOutline",[oa],(function(){return!1})),$D=xo(TD.prototype,"_outlineColor",[oa],(function(){return new cr(0,0,0,255)})),WD=xo(TD.prototype,"_outlineWidth",[oa],(function(){return 2})),zD=xo(TD.prototype,"_enableShadow",[oa],(function(){return!1})),XD=xo(TD.prototype,"_shadowColor",[oa],(function(){return new cr(0,0,0,255)})),YD=xo(TD.prototype,"_shadowOffset",[oa],(function(){return new ls(2,2)})),KD=xo(TD.prototype,"_shadowBlur",[oa],(function(){return 2})),kD=TD))||kD)||kD);t({Label:TU,LabelComponent:TU}),k.Label=TU;var SU={SIMPLE:0,SLICED:1,TILED:2,FILLED:3};Fi(SU);var OU={HORIZONTAL:0,VERTICAL:1,RADIAL:2};Fi(OU);var RU={CUSTOM:0,TRIMMED:1,RAW:2};Fi(RU);var IU,MU=(sU=Ko("cc.Sprite"),hU=Qo(110),uU=Ca(YF),oU=Ca(zF),aU=Ca(SU),cU=Ca(OU),fU=Ca(RU),sU(vU=hU((kU=function(t){function i(){var i;return(i=t.call(this)||this)._spriteFrame=dU&&dU(),i._type=gU&&gU(),i._fillType=wU&&wU(),i._sizeMode=_U&&_U(),i._fillCenter=mU&&mU(),i._fillStart=pU&&pU(),i._fillRange=yU&&yU(),i._isTrimmedMode=bU&&bU(),i._useGrayscale=AU&&AU(),i._atlas=EU&&EU(),i}s(i,t);var n=i.prototype;return n.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},n.onEnable=function(){t.prototype.onEnable.call(this),this.ip();var i=this._spriteFrame;i&&(this.np(),1===this._type&&i.on("uv_updated",this.np,this))},n.onDisable=function(){t.prototype.onDisable.call(this),this._spriteFrame&&1===this._type&&this._spriteFrame.off("uv_updated",this.np,this)},n.onDestroy=function(){t.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var i=this._atlas.getSpriteFrame(t);this.spriteFrame=i}else st(16377)},n.changeMaterialForDefine=function(){var t,i=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var n=!1;if(t instanceof zw){var e=t.getPixelFormat();n=1026===e||1025===e||1024===e}n&&this.grayscale?this._instanceMaterialType=4:n?this._instanceMaterialType=3:this.grayscale?this._instanceMaterialType=2:this._instanceMaterialType=1,i!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var i=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof lN){var n=new Lk;n.copy(i,{defines:{SAMPLE_FROM_RT:!0}}),i=n}return i},n._render=function(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var i=this._spriteFrame;return!(!i||!i.texture)},n._flushAssembler=function(){var t=this,n=i.Assembler.getAssembler(t);t._assembler!==n&&(t.destroyRenderData(),t._assembler=n),t._renderData||n&&n.createData&&((t._renderData=n.createData(t)).material=t.getRenderMaterial(0),t.wh(),t.spriteFrame&&n.updateUVs(t),t._updateColor());var e=t._spriteFrame;e&&(1===t._type?e.on("uv_updated",t.np,t):e.off("uv_updated",t.np,t))},n.ep=function(){var t=this,i=t._spriteFrame;if(i){var n=t.node._uiProps;if(2===t._sizeMode){var e=i.originalSize;n.uiTransformComp.setContentSize(e)}else if(1===t._sizeMode){var r=i.rect;n.uiTransformComp.setContentSize(r.width,r.height)}}},n.rp=function(){},n.ip=function(){var t=this._spriteFrame,i=this.getRenderMaterial(0);t&&i&&this.wh(),this.renderData&&(this.renderData.material=i)},n.np=function(){this._assembler&&this._assembler.updateUVs(this)},n.sp=function(t){var i=this,n=i._spriteFrame;t&&1===i._type&&t.off("uv_updated",i.np,i);var e=!1;n&&(t&&t.texture===n.texture||(e=!0),e&&(i.renderData&&(i.renderData.textureDirty=!0),(!!t&&t.texture instanceof lN)!=n.texture instanceof lN&&(i._instanceMaterialType=-1),i.changeMaterialForDefine()),i.ep(),1===i._type&&n.on("uv_updated",i.np,i))},e(i,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var i=this._spriteFrame;this._spriteFrame=t,this.wh(),this.sp(i)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(2===t||2===this._fillType?this.destroyRenderData():this.renderData&&this.wh(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,3===this._type&&this.renderData&&this.wh()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Jn(t,0,1),3===this._type&&this.renderData&&(this.wh(),this.np())}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Jn(t,-1,1),3===this._type&&this.renderData&&(this.wh(),this.np())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,0===this._type&&this.renderData&&this.wh(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,0!==t&&this.ep())}}]),i}(wD),kU.FillType=OU,kU.Type=SU,kU.SizeMode=RU,kU.EventType={SPRITE_FRAME_CHANGED:"spriteframe-changed"},m((lU=kU).prototype,"spriteAtlas",[uU],Object.getOwnPropertyDescriptor(lU.prototype,"spriteAtlas"),lU.prototype),m(lU.prototype,"spriteFrame",[oU],Object.getOwnPropertyDescriptor(lU.prototype,"spriteFrame"),lU.prototype),m(lU.prototype,"type",[aU],Object.getOwnPropertyDescriptor(lU.prototype,"type"),lU.prototype),m(lU.prototype,"fillType",[cU],Object.getOwnPropertyDescriptor(lU.prototype,"fillType"),lU.prototype),m(lU.prototype,"sizeMode",[fU],Object.getOwnPropertyDescriptor(lU.prototype,"sizeMode"),lU.prototype),dU=xo(lU.prototype,"_spriteFrame",[oa],(function(){return null})),gU=xo(lU.prototype,"_type",[oa],(function(){return 0})),wU=xo(lU.prototype,"_fillType",[oa],(function(){return 0})),_U=xo(lU.prototype,"_sizeMode",[oa],(function(){return 1})),mU=xo(lU.prototype,"_fillCenter",[oa],(function(){return new ls(0,0)})),pU=xo(lU.prototype,"_fillStart",[oa],(function(){return 0})),yU=xo(lU.prototype,"_fillRange",[oa],(function(){return 0})),bU=xo(lU.prototype,"_isTrimmedMode",[oa],(function(){return!0})),AU=xo(lU.prototype,"_useGrayscale",[oa],(function(){return!1})),EU=xo(lU.prototype,"_atlas",[oa],(function(){return null})),vU=lU))||vU)||vU);t({Sprite:MU,SpriteComponent:MU}),k.Sprite=MU;var NU,CU=Ko("cc.UIMeshRenderer")(IU=Qo(110)(IU=function(t){function i(){var i;return(i=t.call(this)||this).hp=null,i._dirtyVersion=-1,i._internalId=-1,i.stencilStage=0,i._renderData=null,i._renderEntity=new gD(1),i}s(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){OC.Al(this),this.wh()},n.onDisable=function(){OC.El(this),this.renderEntity.enabled=this._canRender()},n.onLoad=function(){this.node.Zs()||this.node.addComponent("cc.UITransform"),this.hp=this.getComponent("cc.ModelRenderer"),this.hp?this.renderEntity.Wm(this.node):st(16378,this.node?this.node.name:"")},n.onDestroy=function(){this.renderEntity.Wm(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.hp=this.getComponent("cc.ModelRenderer"),this.hp&&(this.hp._sceneGetter=null)},n._render=function(t){if(this.hp){var i=this.hp._collectModels();this.hp._detachFromScene();for(var n=0;n<i.length;n++)i[n].enabled&&t.commitModel(this,i[n],this.hp.material);return!0}return!1},n.fillBuffers=function(t){this.enabled&&this._render(t)},n.updateRenderer=function(){},n.op=function(){},n.postUpdateAssembler=function(){},n.update=function(){this.ap()},n.ap=function(){if(this.hp)for(var t=this.hp.sharedMaterials.length,i=0;i<t;i++){var n=this.hp.getMaterialInstance(i);if(null!=n)for(var e=n.passes,r=e.length,s=0;s<r;s++)e[s].Au(244),n.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},s)}},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),this.wh(t)},n.wh=function(){OC.kl(this)},n.setNodeDirty=function(){},n.setTextureDirty=function(){},n._canRender=function(){return this.enabled&&null!==this.hp},e(i,[{key:"modelComponent",get:function(){return this.hp}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),i}(w_))||IU)||IU;t({UIMeshRenderer:CU,UIModelComponent:CU}),k.UIMeshRenderer=CU;var LU=Ko("cc.LabelOutline")(NU=Qo(110)(NU=qo(TU)(NU=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.onEnable=function(){this.node.getComponent(TU).enableOutline=!0},n.onDisable=function(){this.node.getComponent(TU).enableOutline=!1},e(i,[{key:"color",get:function(){return this.node.getComponent(TU).outlineColor},set:function(t){this.node.getComponent(TU).outlineColor=t}},{key:"width",get:function(){return this.node.getComponent(TU).outlineWidth},set:function(t){this.node.getComponent(TU).outlineWidth=t}}]),i}(w_))||NU)||NU)||NU;t({LabelOutline:LU,LabelOutlineComponent:LU}),k.LabelOutline=LU;var FU,PU,BU,DU=Pm.Enum.NONE|Pm.Enum.UI_3D,UU=function(){function t(){this.cp=null,this.fp=null,this.Ld=null,this.vp=null,this.lp=!1,this.dp=0,this.gp=0,this.wp=[],this._p=[],this.mp=DU,this.pp=null,this.yp=null}var i=t.prototype;return i.kg=function(){this.wp=[]},i.V_=function(){this.pp=null,this.yp=null,this.fp=null,this.Ld=null,this.dp=0,this.gp=0,this.cp=null,this.lp=!1,this.vp=null,this.mp=DU},i.bp=function(t,i,n,e){if(t){var r=t.passes;if(!r)return;this._p.length=r.length;for(var s=0;s<r.length;s++){this.wp[s]||(this.wp[s]=new lk(k.director.root));var h=r[s],u=this.wp[s];h.update(),i||(i=h.depthStencilState,n=0),u.pu(h,i,n),this._p[s]=u.getShaderVariant(e)}}},e(t,[{key:"passes",get:function(){return this.wp}},{key:"shaders",get:function(){return this._p}}]),t}(),xU=Ko("cc.UIStaticBatch")(FU=Qo(110)((PU=function(t){function i(){var i;return(i=t.call(this)||this)._init=!1,i._bufferAccessor=null,i._dirty=!0,i.Ap=[],i}s(i,t);var n=i.prototype;return n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new UU;return t.lp=!0,this.Ap.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),i=0;i<this.Ap.length;i++)this.Ap[i].kg(t)}this.Ap.length=0,this._init=!1},n._getBatcher=function(){return xC.root&&xC.root.batcher2D?xC.root.batcher2D:(st(9301),null)},e(i,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this.Ap}}]),i}(wD),m(PU.prototype,"color",[ja],Object.getOwnPropertyDescriptor(PU.prototype,"color"),PU.prototype),FU=PU))||FU)||FU;t({UIStaticBatch:xU,UIStaticBatchComponent:xU});var GU,jU,HU,VU=t("LabelShadow",Ko("cc.LabelShadow")(BU=Qo(110)(BU=qo(TU)(BU=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.onEnable=function(){this.node.getComponent(TU).enableShadow=!0},n.onDisable=function(){this.node.getComponent(TU).enableShadow=!1},e(i,[{key:"color",get:function(){return this.node.getComponent(TU).shadowColor},set:function(t){this.node.getComponent(TU).shadowColor=t}},{key:"offset",get:function(){return this.node.getComponent(TU).shadowOffset},set:function(t){this.node.getComponent(TU).shadowOffset=t}},{key:"blur",get:function(){return this.node.getComponent(TU).shadowBlur},set:function(t){this.node.getComponent(TU).shadowBlur=t}}]),i}(w_))||BU)||BU)||BU),$U=Ko("cc.UIOpacity")(GU=Qo(110)(GU=Zo((jU=function(t){function i(){var i;return(i=t.call(this)||this).Ep=1,i.kp=!0,i._opacity=HU&&HU(),i}s(i,t);var n=i.prototype;return n.Tp=function(t){this.Ep=t},n._getParentOpacity=function(t){if(null==t||!t.isValid)return 1;var n=t._uiProps.uiComp,e=t.getComponent(i);return n&&n.color?1:e?e.Ep*(e._opacity/255):this._getParentOpacity(t.getParent())},n._parentChanged=function(){},n._setEntityLocalOpacityRecursively=function(){},n.onEnable=function(){this.node.on("parent-changed",this._parentChanged,this),this.node._uiProps.localOpacity=this.Ep*this._opacity/255,this.kp?(this._parentChanged(),this.kp=!1):this._setEntityLocalOpacityRecursively(this.node._uiProps.localOpacity)},n.onDisable=function(){this.node.off("parent-changed",this._parentChanged,this),this.node._uiProps.localOpacity=1,this._setEntityLocalOpacityRecursively(this.node._uiProps.localOpacity)},e(i,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Jn(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),i}(w_),HU=xo(jU.prototype,"_opacity",[oa],(function(){return 255})),GU=jU))||GU)||GU)||GU;function WU(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function zU(t,i){return Math.ceil(t/i)*i}t({UIOpacity:$U,UIOpacityComponent:$U});var XU=function(){function t(t){this.We=0,this.Sp=0,this.sr=[],this.Op=0,this.Rp=[],this.Ip=new td,this.Mp=new td,this.Np=new td,this.Cp=null,this.Lp=Uint8Array,this.Fp=4,this.Pp=1,this.gu=t}var i=t.prototype;return i.initialize=function(t){var i=tg[t.format];this.We=t.format,this.Sp=i.size,this.Fp=i.count,this.Lp=ag(i),this.Cp=t.roundUpFn||null,this.Pp=t.alignment||1,t.inOrderFree&&(this.alloc=this.Bp)},i.destroy=function(){for(var t=0;t<this.Op;++t)this.sr[t].texture.destroy();this.sr.length=0,this.Rp.length=0},i.alloc=function(t,i){t=zU(t,this.Pp);var n=-1,e=-1;if(void 0!==i&&(n=i,e=this.Dp(t,n)),e<0)for(var r=0;r<this.Op&&(n=r,!((e=this.Dp(t,n))>=0));++r);if(e>=0){var s=this.sr[n];s.start+=t;var h={chunkIdx:n,start:e,end:e+t,texture:s.texture};return this.Rp.push(h),h}var u=Math.sqrt(t/this.Sp),o=this.Cp&&this.Cp(u,this.Sp)||Math.max(1024,WU(u)),a=this.sr[this.createChunk(o)];a.start+=t;var c={chunkIdx:this.Op-1,start:0,end:t,texture:a.texture};return this.Rp.push(c),c},i.free=function(t){for(var i=0;i<this.Rp.length;++i)if(this.Rp[i]===t)return this.sr[t.chunkIdx].end=t.end,void this.Rp.splice(i,1)},i.createChunk=function(t){var i=t*t*this.Sp;q("TextureBufferPool: Allocate chunk "+this.Op+", size: "+i+", format: "+this.We);var n={texture:this.gu.createTexture(new vd(1,6,this.We,t,t)),size:i,start:0,end:i};return this.sr[this.Op]=n,this.Op++},i.update=function(t,i){var n=[],e=[],r=t.start/this.Sp,s=i.byteLength/this.Sp,h=r%t.texture.width,u=Math.floor(r/t.texture.width),o=Math.min(t.texture.width-h,s),a=0;h>0&&(this.Ip.texOffset.x=h,this.Ip.texOffset.y=u,this.Ip.texExtent.width=o,this.Ip.texExtent.height=1,n.push(new this.Lp(i,a*this.Sp,o*this.Fp)),e.push(this.Ip),h=0,u+=1,s-=o,a+=o),s>0&&(this.Mp.texOffset.x=h,this.Mp.texOffset.y=u,s>t.texture.width?(this.Mp.texExtent.width=t.texture.width,this.Mp.texExtent.height=Math.floor(s/t.texture.width),o=this.Mp.texExtent.width*this.Mp.texExtent.height):(o=s,this.Mp.texExtent.width=o,this.Mp.texExtent.height=1),n.push(new this.Lp(i,a*this.Sp,o*this.Fp)),e.push(this.Mp),h=0,u+=this.Mp.texExtent.height,s-=o,a+=o),s>0&&(this.Np.texOffset.x=h,this.Np.texOffset.y=u,this.Np.texExtent.width=s,this.Np.texExtent.height=1,n.push(new this.Lp(i,a*this.Sp,s*this.Fp)),e.push(this.Np)),this.gu.copyBuffersToTexture(n,t.texture,e)},i.Dp=function(t,i){var n=this.sr[i],e=!1,r=n.start;if(r+t<=n.size)e=!0;else{r=0;for(var s=this.Rp.filter((function(t){return t.chunkIdx===i})).sort((function(t,i){return t.start-i.start})),h=0;h<s.length;h++){var u=s[h];if(r+t<=u.start){e=!0;break}r=u.end}!e&&r+t<=n.size&&(e=!0)}return e?r:-1},i.Bp=function(t){t=zU(t,this.Pp);for(var i=0;i<this.Op;++i){var n=this.sr[i],e=!1,r=n.start;if(r+t<=n.end?e=!0:r>n.end?r+t<=n.size?e=!0:t<=n.end&&(n.start=r=0,e=!0):r===n.end&&(n.start=r=0,n.end=n.size,t<=n.end&&(e=!0)),e){n.start+=t;var s={chunkIdx:i,start:r,end:r+t,texture:n.texture};return this.Rp.push(s),s}}var h=Math.sqrt(t/this.Sp),u=this.Cp&&this.Cp(h,this.Sp)||Math.max(1024,WU(h)),o=this.sr[this.createChunk(u)];o.start+=t;var a={chunkIdx:this.Op,start:0,end:t,texture:o.texture};return this.Rp.push(a),a},t}();gt(kN.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),gt(kN.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]),gt(jM.prototype,"Model.prototype",[{name:"isInstancingEnabled"},{name:"instancedAttributes"}]);var YU={};gt(YU,"CameraVisFlags",[{name:"GENERAL"}]),dt(YU,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Pm.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Pm.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Pm.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Pm.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Pm.BitMask,targetName:"UI_2D"}]),T.CameraVisFlags=YU;var KU={};gt(KU,"VisibilityFlags",[{name:"GENERAL"}]),dt(KU,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Pm.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Pm.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Pm.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Pm.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Pm.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Pm.Enum,targetName:"UI_2D"}]),T.VisibilityFlags=KU,dt(lk.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),gt(MM.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),gt(Gk.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),gt(sN.prototype,"SpotLight.prototype",[{name:"aspect"}]),dt(CM.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),gt(CM.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]);var qU=Object.freeze({__proto__:null,BatchingSchemes:{NONE:0,INSTANCING:1},CameraVisFlags:YU,MaterialInstance:Hk,Pass:lk,PassInstance:jk,PassStage:{DEFAULT:1,FORWARD:2,SHADOWCAST:4},RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderScene:kN,RenderWindow:IN,TextureBufferPool:XU,VisibilityFlags:KU,createIA:function(t,i){if(!i.positions)return ut(16306),null;for(var n=[],e=i.positions.length/3,r=0;r<e;++r)n.push(i.positions[3*r],i.positions[3*r+1],i.positions[3*r+2]),i.normals&&n.push(i.normals[3*r],i.normals[3*r+1],i.normals[3*r+2]),i.uvs&&n.push(i.uvs[2*r],i.uvs[2*r+1]),i.colors&&n.push(i.colors[3*r],i.colors[3*r+1],i.colors[3*r+2]);var s=[];s.push(new kd("a_position",32)),i.normals&&s.push(new kd("a_normal",32)),i.uvs&&s.push(new kd("a_texCoord",21)),i.colors&&s.push(new kd("a_color",32));var h=t.createBuffer(new ud(10,1,4*n.length,4*n.length/e));h.update(new Float32Array(n));var u=null;return i.indices&&(u=t.createBuffer(new ud(6,1,2*i.indices.length,2))).update(new Uint16Array(i.indices)),t.createInputAssembler(new Sd(s,[h],u))},customizeType:Xb,genHandle:Hb,getBindingFromHandle:$b,getCountFromHandle:Wb,getDefaultFromType:Zb,getDeviceShaderVersion:_A,getOffsetFromHandle:zb,getStringFromType:Jb,getTypeFromHandle:Vb,nearestPOT:WU,overrideMacros:tA,programLib:TA,scene:EN,type2reader:Yb,type2validator:qb,type2writer:Kb});t("renderer",qU);var QU={BUTT:0,ROUND:1,SQUARE:2};Fi(QU);var ZU={BEVEL:0,ROUND:1,MITER:2};Fi(ZU),Fi({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});var JU=Math.PI,tx=Math.min,ix=Math.max,nx=Math.cos,ex=Math.sin,rx=Math.abs,sx=Math.sign,hx=.5522847493;function ux(t,i,n,e,r,s,h){var u,o,a=0,c=0,f=0,v=0,l=0,d=0,g=0,w=0,_=0,m=0,p=0,y=0,b=0,A=0;if(c=s-r,h=h||!1)if(rx(c)>=2*JU)c=2*JU;else for(;c<0;)c+=2*JU;else if(rx(c)>=2*JU)c=2*-JU;else for(;c>0;)c-=2*JU;for(o=0|ix(1,tx(rx(c)/(.5*JU)+.5,5)),f=rx(4/3*(1-nx(u=c/o/2))/ex(u)),h||(f=-f),A=0;A<=o;A++)d=i+(v=nx(a=r+c*(A/o)))*e,g=n+(l=ex(a))*e,w=-l*e*f,_=v*e*f,0===A?t.Up(d,g):t.xp(m+y,p+b,d-w,g-_,d,g),m=d,p=g,y=w,b=_}function ox(t,i,n,e,r){t.Up(i-e,n),t.xp(i-e,n+r*hx,i-e*hx,n+r,i,n+r),t.xp(i+e*hx,n+r,i+e,n+r*hx,i+e,n),t.xp(i+e,n-r*hx,i+e*hx,n-r,i,n-r),t.xp(i-e*hx,n-r,i-e,n-r*hx,i-e,n),t.Gp()}function ax(t,i,n,e,r,s){if(s<.1)t.jp(i,n,e,r);else{var h=tx(s,.5*rx(e))*sx(e),u=tx(s,.5*rx(r))*sx(r);t.Up(i,n+u),t.Hp(i,n+r-u),t.xp(i,n+r-u*(1-hx),i+h*(1-hx),n+r,i+h,n+r),t.Hp(i+e-h,n+r),t.xp(i+e-h*(1-hx),n+r,i+e,n+r-u*(1-hx),i+e,n+r-u),t.Hp(i+e,n+u),t.xp(i+e,n+u*(1-hx),i+e-h*(1-hx),n,i+e-h,n),t.Hp(i+h,n),t.xp(i+h*(1-hx),n,i,n+u*(1-hx),i,n+u),t.Gp()}}function cx(t,i,n,e,r,s,h,u,o,a,c){var f,v,l,d,g,w,_,m,p,y,b,A,E,k,T,S;a>10||(g=.5*(s+u),w=.5*(h+o),_=.5*((f=.5*(i+e))+(l=.5*(e+s))),m=.5*((v=.5*(n+r))+(d=.5*(r+h))),((T=rx((e-u)*(k=o-n)-(r-o)*(E=u-i)))+(S=rx((s-u)*k-(h-o)*E)))*(T+S)<t.Vp*(E*E+k*k)?t.$p(u,o,0===c?4|c:c):(cx(t,i,n,f,v,_,m,b=.5*(_+(p=.5*(l+g))),A=.5*(m+(y=.5*(d+w))),a+1,0),cx(t,b,A,p,y,g,w,u,o,a+1,c)))}var fx,vx,lx,dx,gx,wx,_x,mx,px,yx,bx,Ax,Ex,kx,Tx,Sx,Ox,Rx,Ix,Mx,Nx,Cx,Lx,Fx=function(t){function i(i,n){var e;return(e=t.call(this,i,n)||this).dx=0,e.dy=0,e.dmx=0,e.dmy=0,e.flags=0,e.len=0,e}return s(i,t),i.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},i}(ls),Px=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),Bx=function(){function t(t){this.Wp=0,this.zp=!1,this.Xp=0,this.Yp=0,this.Kp=[],this.Vp=.25,this.qp=.01,this.Qp=cr.WHITE.clone(),this.Zp=0,this.Jp=cr.BLACK.clone(),this.ty=2,this.iy=0,this.ny=0,this.ey=0,this.sy=0,this.hy=[],this.uy=[],this.oy=null,this.vy=t}var i=t.prototype;return i.Up=function(t,i){this.zp&&(this.Yp=this.Xp,this.zp=!1),this.ly(),this.$p(t,i,1),this.ey=t,this.sy=i},i.Hp=function(t,i){this.$p(t,i,1),this.ey=t,this.sy=i},i.xp=function(t,i,n,e,r,s){var h=this.oy,u=h.points[h.points.length-1];u&&(u.x!==t||u.y!==i||n!==r||e!==s?(cx(this,u.x,u.y,t,i,n,e,r,s,0,1),this.ey=r,this.sy=s):this.Hp(r,s))},i.gy=function(t,i,n,e){var r=this.ey,s=this.sy;this.xp(r+2/3*(t-r),s+2/3*(i-s),n+2/3*(t-n),e+2/3*(i-e),n,e)},i.wy=function(t,i,n,e,r,s){ux(this,t,i,n,e,r,s)},i.my=function(t,i,n,e){ox(this,t,i,n,e),this.oy.complex=!1},i.py=function(t,i,n){ox(this,t,i,n,n),this.oy.complex=!1},i.jp=function(t,i,n,e){this.Up(t,i),this.Hp(t+n,i),this.Hp(t+n,i+e),this.Hp(t,i+e),this.Gp(),this.oy.complex=!1},i.yy=function(t,i,n,e,r){ax(this,t,i,n,e,r),this.oy.complex=!1},i.V_=function(){this.Xp=0,this.Yp=0,this.ny=0,this.Wp=0,this.oy=null,this.Kp.length=0,this.hy.length=0;for(var t=this.uy,i=0,n=t.length;i<n;i++){var e=t[i];e&&(VB.remove(e),e.removeRenderDrawInfo(this.vy))}this.uy.length=0},i.Gp=function(){this.oy.closed=!0},i.Ay=function(){var t=VB.add();return this.uy.push(t),t},i.Ey=function(){return 0===this.uy.length&&this.Ay(),this.uy},i.$p=function(t,i,n){var e=this.oy;if(e){var r=this.hy,s=e.points,h=r[this.ny++];h?(h.x=t,h.y=i):(h=new Fx(t,i),r.push(h)),h.flags=n,s.push(h)}},i.ly=function(){var t=this.Xp,i=this.Kp[t];return i?i.reset():(i=new Px,this.Kp.push(i)),this.Xp++,this.oy=i,i},t}(),Dx=_B.concat([new kd("a_dist",11)]),Ux=AB(Dx),xx=EB(Dx),Gx=t("GraphicsComponent",(fx=Ko("cc.Graphics"),vx=Qo(110),lx=Ca(ZU),dx=Ca(QU),fx(gx=vx((Ex=function(t){function i(){var i;return(i=t.call(this)||this).impl=null,i.model=null,i._lineWidth=_x&&_x(),i._strokeColor=mx&&mx(),i._lineJoin=px&&px(),i._lineCap=yx&&yx(),i._fillColor=bx&&bx(),i._miterLimit=Ax&&Ax(),i._isDrawing=!1,i._isNeedUploadData=!0,i.ky=[],i._instanceMaterialType=0,i.impl=new Bx(f(i)),i}s(i,t);var n=i.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){t.prototype.onLoad.call(this),this.model=xC.root.createModel(jM),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this.Ty()},n.onDestroy=function(){this._sceneGetter=null,this.model&&(xC.root.destroyModel(this.model),this.model=null);var i=this.ky.length;if(i>0){for(var n=0;n<i;++n)this.ky[n].destroy();this.ky.length=0}this.impl&&(this._isDrawing=!1,this.impl.V_(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,i){this.impl&&this.impl.Up(t,i)},n.lineTo=function(t,i){this.impl&&this.impl.Hp(t,i)},n.bezierCurveTo=function(t,i,n,e,r,s){this.impl&&this.impl.xp(t,i,n,e,r,s)},n.quadraticCurveTo=function(t,i,n,e){this.impl&&this.impl.gy(t,i,n,e)},n.arc=function(t,i,n,e,r,s){this.impl&&this.impl.wy(t,i,n,e,r,s)},n.ellipse=function(t,i,n,e){this.impl&&this.impl.my(t,i,n,e)},n.circle=function(t,i,n){this.impl&&this.impl.py(t,i,n)},n.rect=function(t,i,n,e){this.impl&&this.impl.jp(t,i,n,e)},n.roundRect=function(t,i,n,e,r){this.impl&&this.impl.yy(t,i,n,e,r)},n.fillRect=function(t,i,n,e){this.rect(t,i,n,e),this.fill()},n.clear=function(){if(this.impl){if(this.impl.V_(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.wh()}},n.close=function(){this.impl&&this.impl.Gp()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n.Ty=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=uk.get("ui-graphics-material"),this.setSharedMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var i=Hg.gfxDevice,n=i.createBuffer(new ud(10,1,65535*xx,xx)),e=i.createBuffer(new ud(6,1,262140,2)),r=new qC([n],Dx,7,e);r.subMeshIdx=0,this.model.initSubModel(t,r,this.getMaterialInstance(0)),this.ky.push(r)}}else st(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var i=t&&t.Ey();if(!(i.length<=0)&&this.model){for(var n=this.model.subModels,e=0;e<i.length;e++){var r=i[e],s=n[e].inputAssembler;if(r.lastFilledVertex!==r.vertexStart){var h=new Float32Array(r.vData.buffer,0,r.vertexStart*Ux);s.vertexBuffers[0].update(h),s.vertexCount=r.vertexStart;var u=new Uint16Array(r.iData.buffer,0,r.indexStart);s.indexBuffer.update(u),s.indexCount=r.indexStart,r.lastFilledVertex=r.vertexStart,r.lastFilledIndex=r.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var i=this.impl.Ey(),n=this.model.subModels.length;if(i.length>n)for(var e=n;e<i.length;e++)this.activeSubModel(e)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},n.updateRenderer=function(){t.prototype.updateRenderer.call(this)},n.createRenderEntity=function(){return new gD(1)},e(i,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.iy=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.ty=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.Zp=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.Jp=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.Qp=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),i}(wD),Ex.LineJoin=ZU,Ex.LineCap=QU,m((wx=Ex).prototype,"lineJoin",[lx],Object.getOwnPropertyDescriptor(wx.prototype,"lineJoin"),wx.prototype),m(wx.prototype,"lineCap",[dx],Object.getOwnPropertyDescriptor(wx.prototype,"lineCap"),wx.prototype),m(wx.prototype,"color",[ja],Object.getOwnPropertyDescriptor(wx.prototype,"color"),wx.prototype),_x=xo(wx.prototype,"_lineWidth",[oa],(function(){return 1})),mx=xo(wx.prototype,"_strokeColor",[oa],(function(){return cr.BLACK.clone()})),px=xo(wx.prototype,"_lineJoin",[oa],(function(){return 2})),yx=xo(wx.prototype,"_lineCap",[oa],(function(){return 0})),bx=xo(wx.prototype,"_fillColor",[oa],(function(){return cr.WHITE.clone()})),Ax=xo(wx.prototype,"_miterLimit",[oa],(function(){return 10})),gx=wx))||gx)||gx));k.Graphics=Gx;var jx=new Kr,Hx=new ls,Vx=new Kr,$x=[];function Wx(t,i,n){$x.length=0;for(var e=2*Math.PI/n,r=0;r<n;++r)$x.push(new ir(i.x*Math.cos(e*r)+t.x,i.y*Math.sin(e*r)+t.y,0));return $x}var zx={GRAPHICS_RECT:0,GRAPHICS_ELLIPSE:1,GRAPHICS_STENCIL:2,SPRITE_STENCIL:3};Fi(zx);var Xx,Yx,Kx,qx,Qx,Zx,Jx=t("MaskComponent",(kx=Ko("cc.Mask"),Tx=Qo(110),Sx=Ca(zx),kx(Ox=Tx((Lx=function(t){function i(){var i;return(i=t.call(this)||this)._type=Ix&&Ix(),i._inverted=Mx&&Mx(),i._segments=Nx&&Nx(),i._alphaThreshold=Cx&&Cx(),i._sprite=null,i._graphics=null,i._stencilStage=0,i}s(i,t);var n=i.prototype;return n.onLoad=function(){this.Sy()},n.onEnable=function(){this.Sy(),this._updateGraphics(),this._enableRender(),this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this)},n.onRestore=function(){this.Sy(),this._updateGraphics()},n.onDisable=function(){this._disableRender(),this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this)},n.onDestroy=function(){this._removeMaskNode()},n.isHit=function(t){var i=this.node.Zs(),n=i.contentSize,e=n.width,r=n.height,s=Hx;this.node.getWorldMatrix(jx),Kr.invert(Vx,jx),ls.transformMat4(s,t,Vx);var h=i.anchorPoint;s.x+=h.x*e,s.y+=h.y*r;var u=!1;if(0===this.type||2===this.type||3===this.type)u=s.x>=0&&s.y>=0&&s.x<=e&&s.y<=r;else if(1===this.type){var o=e/2,a=r/2,c=s.x-.5*e,f=s.y-.5*r;u=c*c/(o*o)+f*f/(a*a)<1}return this._inverted&&(u=!u),u},n._nodeStateChange=function(){this._updateGraphics()},n.Sy=function(){3!==this._type?this._createGraphics():this._createSprite()},n._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(MU);if(!t){var i=this.node;t=this._sprite=i.addComponent(MU)}}this._sprite.stencilStage=this.inverted?6:2,this._sprite.updateMaterial()},n._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(Gx);if(!t){var i=this.node;t=this._graphics=i.addComponent(Gx)}t.lineWidth=1;var n=cr.WHITE.clone();n.a=0,t.fillColor=n}this._graphics.stencilStage=this.inverted?6:2},n._updateGraphics=function(){if(this._graphics&&(0===this._type||1===this._type)){var t=this.node.Zs(),i=this._graphics;i.clear();var n=t.contentSize,e=n.width,r=n.height,s=t.anchorPoint,h=-e*s.x,u=-r*s.y;if(0===this._type)i.rect(h,u,e,r);else if(1===this._type){for(var o=Wx(new ir(h+e/2,u+r/2,0),new ir(e/2,r/2,0),this._segments),a=0;a<o.length;++a){var c=o[a];0===a?i.moveTo(c.x,c.y):i.lineTo(c.x,c.y)}i.close()}i.fill()}},n._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},n._disableRender=function(){this.subComp&&(this.subComp.stencilStage=0,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},n._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),st(9007),this.subComp&&this.subComp.wh(t)},n.requestRenderData=function(){st(9007)},n.destroyRenderData=function(){st(9007)},n.updateRenderer=function(){st(9007),this.subComp&&this.subComp.updateRenderer()},n.fillBuffers=function(){st(9007)},n.postUpdateAssembler=function(){st(9007)},n.setNodeDirty=function(){st(9007),this.subComp&&this.subComp.setNodeDirty()},n.setTextureDirty=function(){st(9007),this.subComp&&this.subComp.setTextureDirty()},n.getMaterial=function(t){return st(9007),this.subComp?this.subComp.getSharedMaterial(t):null},n.setMaterial=function(t,i){st(9007),this.subComp&&this.subComp.setMaterial(t,i)},n.getMaterialInstance=function(t){return st(9007),this.subComp?this.subComp.getMaterialInstance(t):null},n.setMaterialInstance=function(t,i){st(9007),this.subComp&&this.subComp.setMaterialInstance(t,i)},n.getRenderMaterial=function(t){return st(9007),this.subComp?this.subComp.getRenderMaterial(t):null},e(i,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,3!==this._type?(this._sprite&&(this.node.removeComponent(MU),this._sprite._destroyImmediate(),this._sprite=null),this.Sy(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(Gx),this._graphics._destroyImmediate(),this._graphics=null),this.Sy()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?6:2}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Jn(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:ut(16307)}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,3===this.type&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return st(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){st(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return st(9007),this.subComp?this.subComp.color:null},set:function(t){st(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return st(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return st(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){st(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return st(9007),this.subComp?this.subComp.material:null},set:function(t){st(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return st(9007),this.subComp?this.subComp.materials:[null]},set:function(t){st(9007),this.subComp&&(this.subComp.materials=t)}}]),i}(w_),Lx.Type=zx,m((Rx=Lx).prototype,"type",[Sx],Object.getOwnPropertyDescriptor(Rx.prototype,"type"),Rx.prototype),Ix=xo(Rx.prototype,"_type",[oa],(function(){return 0})),Mx=xo(Rx.prototype,"_inverted",[oa],(function(){return!1})),Nx=xo(Rx.prototype,"_segments",[oa],(function(){return 64})),Cx=xo(Rx.prototype,"_alphaThreshold",[oa],(function(){return.1})),Ox=Rx))||Ox)||Ox));Ep._maskComp=Jx,k.Mask=Jx,St({RenderComponent:{newName:"UIRenderer",since:"1.2.0",removed:!0},UITransformComponent:{newName:"UITransform",since:"1.2.0",removed:!1},CanvasComponent:{newName:"Canvas",since:"1.2.0",removed:!1}}),St({UIRenderable:{newName:"UIRenderer",since:"3.0.0",removed:!0}}),St({Renderable2D:{newName:"UIRenderer",since:"3.6.0",removed:!1}});var tG,iG,nG,eG,rG,sG,hG,uG,oG,aG,cG,fG,vG,lG,dG,gG,wG,_G,mG,pG,yG,bG,AG,EG,kG,TG,SG,OG,RG,IG,MG,NG,CG,LG,FG,PG,BG=Ko("cc.PostProcess")(Xx=Zo((Zx=function(t){function i(){var i;return(i=t.call(this)||this).global=Kx&&Kx(),i._shadingScale=qx&&qx(),i.enableShadingScaleInEditor=Qx&&Qx(),i.settings=new Map,i}s(i,t);var n=i.prototype;return n.addSetting=function(t){this.settings.set(t.constructor,t)},n.removeSetting=function(t){this.settings.delete(t.constructor)},n.getSetting=function(t){return this.settings.get(t)},n.onEnable=function(){i.all.push(this)},n.onDisable=function(){var t=i.all.indexOf(this);-1!==t&&i.all.splice(t,1)},e(i,[{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale=t}}]),i}(w_),Zx.all=[],Kx=xo((Yx=Zx).prototype,"global",[Jo,oa],(function(){return!0})),qx=xo(Yx.prototype,"_shadingScale",[oa],(function(){return 1})),m(Yx.prototype,"shadingScale",[Jo],Object.getOwnPropertyDescriptor(Yx.prototype,"shadingScale"),Yx.prototype),Qx=xo(Yx.prototype,"enableShadingScaleInEditor",[Jo,oa],(function(){return!1})),Xx=Yx))||Xx)||Xx,DG=new ir,UG=Ni(mM),xG=Ni(_M),GG=Ni(pM),jG=Ni(bM),HG=Ni(yM),VG=Ni({SKYBOX:14,SOLID_COLOR:7,DEPTH_ONLY:6,DONT_CLEAR:0}),$G=(tG=Ko("cc.Camera"),iG=Ca(Pm.BitMask),nG=Ca(VG),eG=Ca(UG),rG=Ca(xG),sG=Ca(GG),hG=Ca(jG),uG=Ca(HG),oG=Ca(lN),aG=Ca(BG),tG((FG=function(t){function i(){var i;return(i=t.call(this)||this)._projection=vG&&vG(),i._priority=lG&&lG(),i._fov=dG&&dG(),i._fovAxis=gG&&gG(),i._orthoHeight=wG&&wG(),i._near=_G&&_G(),i._far=mG&&mG(),i._color=pG&&pG(),i._depth=yG&&yG(),i._stencil=bG&&bG(),i._clearFlags=AG&&AG(),i._rect=EG&&EG(),i._aperture=kG&&kG(),i._shutter=TG&&TG(),i._iso=SG&&SG(),i._screenScale=OG&&OG(),i._visibility=RG&&RG(),i._targetTexture=IG&&IG(),i._postProcess=MG&&MG(),i._usePostProcess=NG&&NG(),i._camera=null,i._inEditorMode=!1,i._flows=void 0,i._cameraType=CG&&CG(),i._trackingType=LG&&LG(),i}s(i,t);var n=i.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=1,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(t,i,n){return n||(n=Ds.create()),this._camera&&this._camera.screenPointToRay(n,t,i),n},n.worldToScreen=function(t,i){return i||(i=new ir),this._camera&&this._camera.worldToScreen(i,t),i},n.screenToWorld=function(t,i){return i||(i=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(i,t),i},n.convertToUINode=function(t,i,n){if(n||(n=new ir),!this._camera)return n;this.worldToScreen(t,DG);var e=i.getComponent("cc.UITransform"),r=k.view,s=r.getVisibleSize(),h=DG.x-.5*this._camera.width,u=DG.y-.5*this._camera.height;return DG.x=h/r.getScaleX()+.5*s.width,DG.y=u/r.getScaleY()+.5*s.height,e&&e.convertToNodeSpaceAR(DG,n),n},n._createCamera=function(){this._camera||(this._camera=k.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?k.director.root&&k.director.root.mainWindow:k.director.root&&k.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=ne(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso,this._camera.postProcess=this._postProcess,this._camera.usePostProcess=this._usePostProcess),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._checkTargetTextureEvent=function(t){var i=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){i._camera&&i._camera.setFixedSize(t.width,t.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},e(i,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,this.fov=0===t?this._fov*this._camera.aspect:this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=ne(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var i=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(i),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit("tex-change",this)}}},{key:"usePostProcess",get:function(){return this._usePostProcess},set:function(t){this._usePostProcess=t,this._camera&&(this._camera.usePostProcess=t)}},{key:"postProcess",get:function(){return this._postProcess},set:function(t){this._postProcess=t,this._camera&&(this._camera.postProcess=t)}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){if(this._inEditorMode=t,this._camera){var i=k.director.root;this._camera.changeTargetWindow(t?i&&i.mainWindow:i&&i.tempWindow)}}},{key:"cameraType",get:function(){return this._cameraType},set:function(t){this._cameraType!==t&&(this._cameraType=t,this.camera&&(this.camera.cameraType=t))}},{key:"trackingType",get:function(){return this._trackingType},set:function(t){this._trackingType!==t&&(this._trackingType=t,this.camera&&(this.camera.trackingType=t))}}]),i}(w_),FG.ProjectionType=UG,FG.FOVAxis=xG,FG.ClearFlag=VG,FG.Aperture=GG,FG.Shutter=jG,FG.ISO=HG,FG.TARGET_TEXTURE_CHANGE="tex-change",vG=xo((fG=FG).prototype,"_projection",[oa],(function(){return UG.PERSPECTIVE})),lG=xo(fG.prototype,"_priority",[oa],(function(){return 0})),dG=xo(fG.prototype,"_fov",[oa],(function(){return 45})),gG=xo(fG.prototype,"_fovAxis",[oa],(function(){return xG.VERTICAL})),wG=xo(fG.prototype,"_orthoHeight",[oa],(function(){return 10})),_G=xo(fG.prototype,"_near",[oa],(function(){return 1})),mG=xo(fG.prototype,"_far",[oa],(function(){return 1e3})),pG=xo(fG.prototype,"_color",[oa],(function(){return new cr("#333333")})),yG=xo(fG.prototype,"_depth",[oa],(function(){return 1})),bG=xo(fG.prototype,"_stencil",[oa],(function(){return 0})),AG=xo(fG.prototype,"_clearFlags",[oa],(function(){return VG.SOLID_COLOR})),EG=xo(fG.prototype,"_rect",[oa],(function(){return new ps(0,0,1,1)})),kG=xo(fG.prototype,"_aperture",[oa],(function(){return GG.F16_0})),TG=xo(fG.prototype,"_shutter",[oa],(function(){return jG.D125})),SG=xo(fG.prototype,"_iso",[oa],(function(){return HG.ISO100})),OG=xo(fG.prototype,"_screenScale",[oa],(function(){return 1})),RG=xo(fG.prototype,"_visibility",[oa],(function(){return Lb})),IG=xo(fG.prototype,"_targetTexture",[oa],(function(){return null})),MG=xo(fG.prototype,"_postProcess",[oa],(function(){return null})),NG=xo(fG.prototype,"_usePostProcess",[oa],(function(){return!1})),CG=xo(fG.prototype,"_cameraType",[oa],(function(){return-1})),LG=xo(fG.prototype,"_trackingType",[oa],(function(){return 0})),m(fG.prototype,"visibility",[iG],Object.getOwnPropertyDescriptor(fG.prototype,"visibility"),fG.prototype),m(fG.prototype,"clearFlags",[nG],Object.getOwnPropertyDescriptor(fG.prototype,"clearFlags"),fG.prototype),m(fG.prototype,"projection",[eG],Object.getOwnPropertyDescriptor(fG.prototype,"projection"),fG.prototype),m(fG.prototype,"fovAxis",[rG],Object.getOwnPropertyDescriptor(fG.prototype,"fovAxis"),fG.prototype),m(fG.prototype,"aperture",[sG],Object.getOwnPropertyDescriptor(fG.prototype,"aperture"),fG.prototype),m(fG.prototype,"shutter",[hG],Object.getOwnPropertyDescriptor(fG.prototype,"shutter"),fG.prototype),m(fG.prototype,"iso",[uG],Object.getOwnPropertyDescriptor(fG.prototype,"iso"),fG.prototype),m(fG.prototype,"targetTexture",[oG],Object.getOwnPropertyDescriptor(fG.prototype,"targetTexture"),fG.prototype),m(fG.prototype,"usePostProcess",[Jo],Object.getOwnPropertyDescriptor(fG.prototype,"usePostProcess"),fG.prototype),m(fG.prototype,"postProcess",[aG],Object.getOwnPropertyDescriptor(fG.prototype,"postProcess"),fG.prototype),cG=fG))||cG);t({Camera:$G,CameraComponent:$G}),k.Camera=$G;var WG,zG,XG,YG,KG,qG,QG,ZG,JG,tj=t("RenderRoot2D",Ko("cc.RenderRoot2D")(PG=Qo(100)(PG=qo(ZB)(PG=Zo(PG=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.onEnable=function(){k.director.root.batcher2D.addScreen(this)},n.onDisable=function(){k.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){k.director.root.batcher2D.removeScreen(this)},i}(w_))||PG)||PG)||PG)||PG),ij=new ir,nj=(WG=Ko("cc.Canvas"),zG=Qo(100),XG=Ca($G),YG=Ca($G),WG(KG=zG(KG=Zo((qG=function(t){function i(){var i;return(i=t.call(this)||this)._cameraComponent=QG&&QG(),i._alignCanvasWithScreen=ZG&&ZG(),i._f=new ir,i.Oy=0,i._thisOnCameraResized=i._onResizeCamera.bind(f(i)),i}s(i,t);var n=i.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)),this._onResizeCamera(),NL.on("canvas-resize",this._thisOnCameraResized,this),NL.on("design-resolution-changed",this._thisOnCameraResized,this)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off("tex-change",this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),NL.off("canvas-resize",this._thisOnCameraResized,this),NL.off("design-resolution-changed",this._thisOnCameraResized,this)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=uo.height/2;else{var t=so.windowSize;this._cameraComponent.orthoHeight=t.height/NL.getScaleY()/2}this.node.getWorldPosition(ij),this._cameraComponent.node.setWorldPosition(ij.x,ij.y,1e3)}},n.Ry=function(){if(this._cameraComponent){var t,i=null==(t=this.cameraComponent)?void 0:t.priority;return 0===this.Oy?i|1<<30:-1073741825&i}return 0},e(i,[{key:"renderMode",get:function(){return this.Oy},set:function(t){this.Oy=t,this._cameraComponent&&(this._cameraComponent.priority=this.Ry())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),i}(tj),m(qG.prototype,"cameraComponent",[XG],Object.getOwnPropertyDescriptor(qG.prototype,"cameraComponent"),qG.prototype),QG=xo(qG.prototype,"_cameraComponent",[YG],(function(){return null})),ZG=xo(qG.prototype,"_alignCanvasWithScreen",[oa],(function(){return!0})),KG=qG))||KG)||KG)||KG);function ej(t,i,n){var e=t.o,r=t.d,s=1/r.x,h=1/r.y,u=1/r.z,o=(i.x-e.x)*s,a=(n.x-e.x)*s,c=(i.y-e.y)*h,f=(n.y-e.y)*h,v=(i.z-e.z)*u,l=(n.z-e.z)*u,d=Math.max(Math.max(Math.min(o,a),Math.min(c,f)),Math.min(v,l)),g=Math.min(Math.min(Math.max(o,a),Math.max(c,f)),Math.max(v,l));return g<0||d>g?0:d>0?d:g}t({Canvas:nj,CanvasComponent:nj}),k.Canvas=nj,gt(t("UIComponent",Ko("cc.UIComponent")(JG=qo(ZB)(JG=Qo(110)(JG=Zo(JG=function(t){function i(){var i;return(i=t.call(this)||this)._lastParent=null,i.stencilStage=0,i}s(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){var t=this.node._uiProps;t.uiComp===this&&(t.uiComp=null)},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},i}(w_))||JG)||JG)||JG)||JG).prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),dt(nj.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){var t;return null==(t=this._cameraComponent)?void 0:t.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:cr.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),wt(ZB.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),k.UITransformComponent=ZB,ai(ZB,"cc.UITransformComponent"),ai(wD,"cc.RenderComponent"),k.CanvasComponent=nj,ai(nj,"cc.CanvasComponent"),k.internal.Renderable2D=wD,ai(wD,"cc.Renderable2D");var rj,sj,hj,uj,oj,aj,cj,fj,vj=(rj=eu.create(),sj={distance:1/0,doubleSided:!1,mode:2},hj=0,uj=function(t,i,n,e,r,s){1===t?(hj>i||0===hj)&&(hj=i,s&&(0===s.length?s.push({distance:i,vertexIndex0:n/3,vertexIndex1:e/3,vertexIndex2:r/3}):(s[0].distance=i,s[0].vertexIndex0=n/3,s[0].vertexIndex1=e/3,s[0].vertexIndex2=r/3))):(hj=i,s&&s.push({distance:i,vertexIndex0:n/3,vertexIndex1:e/3,vertexIndex2:r/3}))},oj=function(t,i,n,e,r){if(7===n)for(var s=i.length,h=0;h<s;h+=3){var u=3*i[h],o=3*i[h+1],a=3*i[h+2];ir.set(rj.a,t[u],t[u+1],t[u+2]),ir.set(rj.b,t[o],t[o+1],t[o+2]),ir.set(rj.c,t[a],t[a+1],t[a+2]);var c=Qh.rayTriangle(e,rj,r.doubleSided);if(!(0===c||c>r.distance)&&(uj(r.mode,c,u,o,a,r.result),2===r.mode))return c}else if(8===n)for(var f=i.length-2,v=0,l=0;l<f;l+=1){var d=3*i[l-v],g=3*i[l+v+1],w=3*i[l+2];ir.set(rj.a,t[d],t[d+1],t[d+2]),ir.set(rj.b,t[g],t[g+1],t[g+2]),ir.set(rj.c,t[w],t[w+1],t[w+2]),v=~v;var _=Qh.rayTriangle(e,rj,r.doubleSided);if(!(0===_||_>r.distance)&&(uj(r.mode,_,d,g,w,r.result),2===r.mode))return _}else if(9===n){var m=i.length-1,p=3*i[0];ir.set(rj.a,t[p],t[p+1],t[p+2]);for(var y=1;y<m;y+=1){var b=3*i[y],A=3*i[y+1];ir.set(rj.b,t[b],t[b+1],t[b+2]),ir.set(rj.c,t[A],t[A+1],t[A+2]);var E=Qh.rayTriangle(e,rj,r.doubleSided);if(!(0===E||E>r.distance)&&(uj(r.mode,E,p,b,A,r.result),2===r.mode))return E}}return hj},function(t,i,n){if(hj=0,0===i.geometricInfo.positions.length)return hj;var e=void 0===n?sj:n;if(ej(t,i.geometricInfo.boundingBox.min,i.geometricInfo.boundingBox.max)){var r=i.primitiveMode,s=i.geometricInfo,h=s.positions,u=s.indices;oj(h,u,r,t,e)}return hj}),lj=function(){var t=0,i={distance:1/0,doubleSided:!1,mode:2};return function(n,e,r){t=0;var s=void 0===r?i:r,h=e.renderingSubMeshes.length,u=e.struct.minPosition,o=e.struct.maxPosition;if(u&&o&&!ej(n,u,o))return t;for(var a=0;a<h;a++){var c=e.renderingSubMeshes[a],f=vj(n,c,s);if(f)if(1===s.mode)(0===t||t>f)&&(t=f,s.subIndices&&(s.subIndices[0]=a));else if(t=f,s.subIndices&&s.subIndices.push(a),2===s.mode)return f}return t&&1===s.mode&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),dj=function(){var t=0,i={distance:1/0,doubleSided:!1,mode:2},n=new Ds,e=new Kr;return function(r,s,h){t=0;var u=void 0===h?i:h,o=s.worldBounds;if(o&&!Qh.rayAABB(r,o))return t;Ds.copy(n,r),s.node&&(Kr.invert(e,s.node.getWorldMatrix(e)),ir.transformMat4(n.o,r.o,e),ir.transformMat4Normal(n.d,r.d,e));for(var a=s.subModels,c=0;c<a.length;c++){var f=a[c].subMesh,v=vj(n,f,u);if(v)if(1===u.mode)(0===t||t>v)&&(t=v,u.subIndices&&(u.subIndices[0]=c));else if(t=v,u.subIndices&&u.subIndices.push(c),2===u.mode)return v}return t&&1===u.mode&&(u.result&&(u.result[0].distance=t,u.result.length=1),u.subIndices&&(u.subIndices.length=1)),t}}();Qh.rayModel=dj,Qh.raySubMesh=vj,Qh.rayMesh=lj,ok("specular-pass");var gj,wj,_j,mj,pj,yj=Ko("cc.ModelRenderer")((cj=function(t){function i(){var i;return(i=t.call(this)||this)._visFlags=fj&&fj(),i._models=[],i._priority=0,i}s(i,t);var n=i.prototype;return n._collectModels=function(){return this._models},n.onEnable=function(){this._updatePriority()},n._attachToScene=function(){},n._detachFromScene=function(){},n._onVisibilityChange=function(){},n._updatePriority=function(){if(this._models.length>0)for(var t=0;t<this._models.length;t++)this._models[t].priority=this._priority},e(i,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"priority",get:function(){return this._priority},set:function(t){t!==this._priority&&(this._priority=t,this._updatePriority())}}]),i}(dD),fj=xo(cj.prototype,"_visFlags",[oa],(function(){return Pm.Enum.NONE})),aj=cj))||aj;t({ModelRenderer:yj,RenderableComponent:yj});var bj,Aj,Ej,kj,Tj,Sj,Oj,Rj,Ij,Mj,Nj,Cj=oa,Lj=Ca;t("PrefabLink",(gj=Ko("cc.PrefabLink"),wj=Lj(TC),gj((mj=function(t){function i(){var i;return(i=t.call(this)||this).prefab=pj&&pj(),i}return s(i,t),i}(w_),pj=xo(mj.prototype,"prefab",[wj,Cj],(function(){return null})),_j=mj))||_j)),dt($G,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),dt($G.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),wt(dD.prototype,"Renderer.prototype",[{name:"getMaterial",suggest:"please use renderer.getSharedMaterial instead."}]),k.CameraComponent=$G,ai($G,"cc.CameraComponent"),k.RenderableComponent=yj,ai(yj,"cc.RenderableComponent"),t("SpriteRenderer",(bj=Ko("cc.SpriteRenderer"),Aj=Qo(100),Ej=Ca(zF),bj(kj=Aj((Tj=function(t){function i(){var i;return(i=t.call(this)||this)._spriteFrame=Sj&&Sj(),i._mode=Oj&&Oj(),i._color=Rj&&Rj(),i._flipX=Ij&&Ij(),i._flipY=Mj&&Mj(),i._size=Nj&&Nj(),i.P_=null,i}s(i,t);var n=i.prototype;return n.onLoad=function(){this._spriteFrame&&(this._spriteFrame.mesh||this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels()},n.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene()},n.onEnable=function(){t.prototype.onEnable.call(this),this.P_||this._updateModels(),this._attachToScene()},n.onDisable=function(){this.P_&&this._detachFromScene()},n.onDestroy=function(){this.P_&&(k.director.root.destroyModel(this.P_),this.P_=null,this._models.length=0)},n._updateModels=function(){if(this._spriteFrame){var t=this.P_;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this.P_){var i=this._spriteFrame.mesh;this.P_.createBoundingShape(i.struct.minPosition,i.struct.maxPosition),this._updateModelParams(),this._onUpdateLocalDescriptorSet()}}},n._createModel=function(){var t=this.P_=k.director.root.createModel(jM);t.visFlags=this.visibility,t.node=t.transform=this.node,this._models.length=0,this._models.push(this.P_)},n._updateModelParams=function(){if(this._spriteFrame&&this.P_){this._spriteFrame.ensureMeshData();var t=this._spriteFrame.mesh;this.node.hasChangedFlags|=1,this.P_.transform.hasChangedFlags|=1;var i=t?t.renderingSubMeshes:null;if(i)for(var n=i.length,e=0;e<n;++e){var r=this.getRenderMaterial(e);r&&!r.isValid&&(r=null);var s=i[e];s&&this.P_.initSubModel(e,s,r||this._getBuiltinMaterial())}this.P_.enabled=!0}},n._getBuiltinMaterial=function(){return uk.get("missing-material")},n._onMaterialModified=function(i,n){t.prototype._onMaterialModified.call(this,i,n),this._spriteFrame&&this.P_&&this.P_.inited&&this.Pu(i,n||this._getBuiltinMaterial())},n.Pu=function(t,i){this.P_&&this.P_.inited&&(this.P_.setSubModelMaterial(t,i),this._onUpdateLocalDescriptorSet())},n._onUpdateLocalDescriptorSet=function(){if(this._spriteFrame&&this.P_&&this.P_.inited)for(var t=this._spriteFrame.getGFXTexture(),i=this._spriteFrame.getGFXSampler(),n=this.P_.subModels,e=0;e<n.length;e++){var r=n[e].descriptorSet;r.bindTexture(12,t),r.bindSampler(12,i),r.update()}},n._attachToScene=function(){if(this.node.scene&&this.P_){var t=this._getRenderScene();null!==this.P_.scene&&this._detachFromScene(),t.addModel(this.P_)}},n._detachFromScene=function(){this.P_&&this.P_.scene&&this.P_.scene.removeModel(this.P_)},e(i,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame,this._spriteFrame=t,this._spriteFrame&&(this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels(),this.enabledInHierarchy&&this._attachToScene())}},{key:"model",get:function(){return this.P_}}]),i}(yj),m(Tj.prototype,"spriteFrame",[Ej],Object.getOwnPropertyDescriptor(Tj.prototype,"spriteFrame"),Tj.prototype),Sj=xo(Tj.prototype,"_spriteFrame",[oa],(function(){return null})),Oj=xo(Tj.prototype,"_mode",[oa],(function(){return 0})),Rj=xo(Tj.prototype,"_color",[oa],(function(){return cr.WHITE.clone()})),Ij=xo(Tj.prototype,"_flipX",[oa],(function(){return!1})),Mj=xo(Tj.prototype,"_flipY",[oa],(function(){return!1})),Nj=xo(Tj.prototype,"_size",[oa],(function(){return new ls})),kj=Tj))||kj)||kj));var Fj,Pj,Bj,Dj,Uj,xj,Gj,jj,Hj,Vj,$j,Wj,zj,Xj,Yj,Kj,qj,Qj,Zj,Jj,tH,iH,nH,eH,rH,sH=new QP,hH="RICHTEXT_CHILD",uH="RICHTEXT_Image_CHILD",oH=new ls,aH=new ls,cH=new wi((function(t){if(!k.isValid(t.node))return!1;var i=t.node.getComponent(TU);return i&&(i.outlineWidth=0),!0}),20),fH=new wi((function(t){return k.isValid(t.node)}),10);function vH(t){return{node:new Xp(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function lH(t,i){var n;t===hH?n=cH._get():t===uH&&(n=fH._get());var e=(n=n||vH(t)).node;return e||(e=new Xp(t)),e.hideFlags|=1032,e.active=!0,t===uH?(n.comp=e.getComponent(MU)||e.addComponent(MU),n.comp.spriteFrame=i,n.comp.type=MU.Type.SLICED,n.comp.sizeMode=0):(n.comp=e.getComponent(TU)||e.addComponent(TU),n.comp.string=i,n.comp.horizontalAlign=0,n.comp.verticalAlign=0,n.comp.underlineHeight=2),e.setPosition(0,0,0),e.Zs().setAnchorPoint(.5,.5),n.node=e,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var dH=t("RichTextComponent",(Fj=Ko("cc.RichText"),Pj=Qo(110),Bj=Ca(iU),Dj=Ca(nU),Uj=Ca(cr),xj=Ca(ZF),Gj=Ca(rU),jj=Ca(YF),Fj(Hj=Pj((rH=function(t){function i(){var i;return(i=t.call(this)||this)._lineHeight=$j&&$j(),i._string=Wj&&Wj(),i._horizontalAlign=zj&&zj(),i._verticalAlign=Xj&&Xj(),i._fontSize=Yj&&Yj(),i._fontColor=Kj&&Kj(),i._maxWidth=qj&&qj(),i._fontFamily=Qj&&Qj(),i._font=Zj&&Zj(),i._isSystemFontUsed=Jj&&Jj(),i._userDefinedFont=tH&&tH(),i._cacheMode=iH&&iH(),i._imageAtlas=nH&&nH(),i._handleTouchEvent=eH&&eH(),i._textArray=[],i._segments=[],i._labelSegmentsCache=[],i._linesWidth=[],i._lineCount=1,i._labelWidth=0,i._labelHeight=0,i._layoutDirty=!0,i._lineOffsetX=0,i._labelChildrenNum=0,i._updateRichTextStatus=i._updateRichText,i}s(i,t);var n=i.prototype;return n.onLoad=function(){this.node.on("layer-changed",this._applyLayer,this),this.node.on("anchor-changed",this._updateRichTextPosition,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.onRestore=function(){},n.onDestroy=function(){this._segments.forEach((function(t){t.node.removeFromParent(),t.type===hH?cH.put(t):t.type===uH&&fH.put(t)})),this.node.off("anchor-changed",this._updateRichTextPosition,this),this.node.off("layer-changed",this._applyLayer,this)},n._addEventListeners=function(){this.node.on("touch-end",this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off("touch-end",this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(i){t._applyTextAttribute(i)}))},n._createFontLabel=function(t){return lH(hH,t)},n._createImage=function(t){return lH(uH,t)},n._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},n.Iy=function(t,i){var n=[];if(t.length*this.fontSize<=1638.4)return n.push(t),n;if(this.My(oH,i,t),oH.x<2048)n.push(t);else for(var e=t.split("\n"),r=0;r<e.length;r++)if(this.My(oH,i,e[r]),oH.x<2048)n.push(e[r]);else{var s=this.Ny(e[r],i);n.push.apply(n,s)}return n},n.Ny=function(t,i){var n=[],e=t,r=0,s=e.length/2,h=e.substring(r,s),u=e.substring(s),o=this.My(oH,i,h),a=this.My(aH,i,u),c=this._maxWidth;0===this._maxWidth&&(c=2047.9);for(var f=1*c;o.x>f;){if((s/=2)<1){s*=2;break}h=h.substring(r,s),u=e.substring(s),this.My(o,i,h)}for(var v=1e3,l=1;v&&r<t.length;){for(;v&&o.x<f;){var d=EP(u);d&&d.length>0&&(l=d[0].length),s+=l,h=e.substring(r,s),u=e.substring(s),this.My(o,i,h),v--}for(;v&&h.length>=2&&o.x>f;)s-=l,h=e.substring(r,s),this.My(o,i,h),l=1,v--;if(h.length>=2){var g=kP(h);g&&g.length>0&&h!==g[0]&&(s-=g[0].length,h=e.substring(r,s))}if(n.push(h),r=s,s+=h.length,h=e.substring(r,s),u=e.substring(s),this.My(a,i,u),this.My(o,i,h),v--,a.x<2048&&o.x<f){n.push(h),r=t.length,s=t.length,h=u,""!==u&&n.push(h);break}}return n},n._measureText=function(t,i){var n=this,e=function(i){return n.My(oH,t,i).x};return i?e(i):e},n.My=function(t,i,n){var e;0===this._labelSegmentsCache.length?(e=this._createFontLabel(n),this._labelSegmentsCache.push(e)):(e=this._labelSegmentsCache[0]).node.getComponent(TU).string=n,e.styleIndex=i,this._applyTextAttribute(e);var r=e.node.Zs().contentSize;return ls.set(t,r.x,r.y),t},n._onTouchEnded=function(t){var i=this,n=this.node.getComponents(w_);this._segments.forEach((function(e){var r=e.clickHandler,s=e.clickParam;r&&i._containsTouchLocation(e,t.touch.getUILocation())&&(n.forEach((function(i){var n=i[r];i.enabledInHierarchy&&n&&n.call(i,t,s)})),t.propagationStopped=!0)}))},n._containsTouchLocation=function(t,i){var n=t.node.getComponent(ZB);return!!n&&n.getBoundingBoxToWorld().contains(i)},n._resetState=function(){for(var t=this.node.children,i=t.length-1;i>=0;i--){var n=t[i];if(n.name===hH||n.name===uH){n.parent=null;var e=vH(n.name);e.node=n,n.name===hH?(e.comp=n.getComponent(TU),cH.put(e)):(e.comp=n.getComponent(MU),fH.put(e)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(t){for(var i=this.node.children.length-1;i>=0;i--){var n=this.node.children[i];n.name!==hH&&n.name!==uH||(n.active=t)}},n._addLabelSegment=function(t,i){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(t);else{var e=(n=this._labelSegmentsCache.pop()).node.getComponent(TU);e&&(e.string=t)}var r=n.comp;return r.verticalAlign!==this._verticalAlign&&(r.verticalAlign=this._verticalAlign),n.styleIndex=i,n.lineCount=this._lineCount,n.node.Zs().setAnchorPoint(0,0),n.node.layer=this.node.layer,this.node.insertChild(n.node,this._labelChildrenNum++),this._applyTextAttribute(n),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(t,i,n){var e=i;if(this._lineOffsetX>0&&e+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var s=this._getFirstWordLen(t,r,t.length),h=t.substr(r,s),u=this._measureText(n,h);if(!(this._lineOffsetX+u<=this._maxWidth)){if(r>0){var o=t.substr(0,r);this._addLabelSegment(o,n),t=t.substr(r,t.length),e=this._measureText(n,t)}this._updateLineInfo();break}this._lineOffsetX+=u,r+=s}if(e>this._maxWidth)for(var a=TP(t,e,this._maxWidth,this._measureText(n)),c=0;c<a.length;++c){var f=a[c],v=this._addLabelSegment(f,n).node.Zs().contentSize;this._lineOffsetX+=v.width,a.length>1&&c<a.length-1&&this._updateLineInfo()}else this._lineOffsetX+=e,this._addLabelSegment(t,n)},n._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var i=0;i<this._textArray.length;i++){var n=this._textArray[i],e=t[i];if(n.text!==e.text)return!0;var r=n.style,s=e.style;if(r){if(s){if(!!s.outline!=!!r.outline)return!0;if(r.size!==s.size||r.italic!==s.italic||r.isImage!==s.isImage)return!0;if(r.src!==s.src||r.imageAlign!==s.imageAlign||r.imageHeight!==s.imageHeight||r.imageWidth!==s.imageWidth||r.imageOffset!==s.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(s&&(s.size||s.italic||s.isImage||s.outline))return!0}return!1},n._addRichTextImageElement=function(t){if(t.style){var i=t.style,n=i.src,e=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(e){var r=this._createImage(e);switch(r.comp,i.imageAlign){case"top":r.node.Zs().setAnchorPoint(0,1);break;case"center":r.node.Zs().setAnchorPoint(0,.5);break;default:r.node.Zs().setAnchorPoint(0,0)}i.imageOffset&&(r.imageOffset=i.imageOffset),r.node.layer=this.node.layer,this.node.insertChild(r.node,this._labelChildrenNum++),this._segments.push(r);var s=e.rect.clone(),h=1,u=s.width,o=s.height,a=i.imageWidth||0,c=i.imageHeight||0;c>0?(u*=h=c/o,o*=h):(u*=h=this._lineHeight/o,o*=h),a>0&&(u=a),this._maxWidth>0?(this._lineOffsetX+u>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=u):(this._lineOffsetX+=u,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node.Zs().setContentSize(u,o),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var f=i.event;f&&(r.clickHandler=f.click,r.clickParam=f.param)}else st(4400)}},n._updateTextDefaultColor=function(){for(var t=0;t<this._segments.length;++t){var i,n,e=this._segments[t],r=e.node.getComponent(TU);r&&(null!=(i=this._textArray[e.styleIndex])&&null!=(n=i.style)&&n.color||(r.color=this._fontColor))}},n._updateRichText=function(){if(this.enabledInHierarchy){var t=sH.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var i,n=!1,e=0;e<this._textArray.length;++e){var r=this._textArray[e],s=r.text;if(void 0!==s){if(""===s){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var h=(s=this.Iy(s,e).join("\n")).split("\n"),u=0;u<h.length;++u){var o=h[u];if(""!==o)if(n=!1,this._maxWidth>0){var a=this._measureText(e,o);this._updateRichTextWithMaxWidth(o,a,e),h.length>1&&u<h.length-1&&this._updateLineInfo()}else i=this._addLabelSegment(o,e),this._lineOffsetX+=i.node.Zs().width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),h.length>1&&u<h.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(s)&&u===h.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+iP)*this._lineHeight,this.node.Zs().setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(t,i,n){var e=mP(t,i);if(dP(e)||gP(e))return 1;for(var r=1,s=i+1;s<n&&!gP(e=mP(t,s))&&!dP(e);++s)r++;return r},n._updateRichTextPosition=function(){for(var t=0,i=1,n=this._lineCount,e=this.node.Zs(),r=e.anchorX,s=e.anchorY,h=0;h<this._segments.length;++h){var u=this._segments[h],o=u.lineCount;o>i&&(t=0,i=o);var a=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case 0:break;case 1:a-=this._linesWidth[o-1]/2;break;case 2:a-=this._linesWidth[o-1]}var c=u.node.position;if(u.node.setPosition(t+a,this._lineHeight*(n-o)-this._labelHeight*s,c.z),o===i&&(t+=u.node.Zs().width),u.node.getComponent(MU)){var f=u.node.position.clone(),v=this._lineHeight,l=this._lineHeight*(1+iP);switch(u.node.Zs().anchorY){case 1:f.y+=v+(l-v)/2;break;case.5:f.y+=l/2;break;default:f.y+=(l-v)/2}if(u.imageOffset){var d=u.imageOffset.split(",");if(1===d.length&&d[0]){var g=parseFloat(d[0]);Number.isInteger(g)&&(f.y+=g)}else if(2===d.length){var w=parseFloat(d[0]),_=parseFloat(d[1]);Number.isInteger(w)&&(f.x+=w),Number.isInteger(_)&&(f.y+=_)}}u.node.position=f}var m=u.node.getComponent(TU);if(m&&m.enableOutline){var p=u.node.position.clone();p.y-=m.outlineWidth,u.node.position=p}}},n._convertLiteralColorValue=function(t){var i=t.toUpperCase();return cr[i]?cr[i]:(new cr).fromHEX(t)},n._applyTextAttribute=function(t){var i=t.node.getComponent(TU);if(i){this._resetLabelState(i);var n,e=t.styleIndex;if(this._textArray[e]&&(n=this._textArray[e].style),n){if(n.color?i.color=this._convertLiteralColorValue(n.color):i.color=this._fontColor,i.isBold=!!n.bold,i.isItalic=!!n.italic,i.isUnderline=!!n.underline,n.outline){var r=t.node.getComponent(TU);r||(r=t.node.addComponent(TU)),r.enableOutline=!0,r.outlineColor=this._convertLiteralColorValue(n.outline.color),r.outlineWidth=n.outline.width}i.fontSize=n.size||this._fontSize,t.clickHandler="",t.clickParam="";var s=n.event;s&&(t.clickHandler=s.click||"",t.clickParam=s.param||"")}i.cacheMode=this._cacheMode,this._font instanceof ZF&&!this._isSystemFontUsed?i.font=this._font:i.fontFamily=this._fontFamily,i.useSystemFont=this._isSystemFontUsed,i.lineHeight=this._lineHeight,i.updateRenderData(!0)}},n._applyLayer=function(){var t=this;this._segments.forEach((function(i){i.node.layer=t.node.layer}))},n._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=this._fontColor,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},e(i,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontColor",get:function(){return this._fontColor},set:function(t){this._fontColor!==t&&(this._fontColor=t,this._updateTextDefaultColor())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),i}(w_),rH.HorizontalAlign=iU,rH.VerticalAlign=nU,m((Vj=rH).prototype,"horizontalAlign",[Bj],Object.getOwnPropertyDescriptor(Vj.prototype,"horizontalAlign"),Vj.prototype),m(Vj.prototype,"verticalAlign",[Dj],Object.getOwnPropertyDescriptor(Vj.prototype,"verticalAlign"),Vj.prototype),m(Vj.prototype,"fontColor",[Uj],Object.getOwnPropertyDescriptor(Vj.prototype,"fontColor"),Vj.prototype),m(Vj.prototype,"font",[xj],Object.getOwnPropertyDescriptor(Vj.prototype,"font"),Vj.prototype),m(Vj.prototype,"cacheMode",[Gj],Object.getOwnPropertyDescriptor(Vj.prototype,"cacheMode"),Vj.prototype),m(Vj.prototype,"imageAtlas",[jj],Object.getOwnPropertyDescriptor(Vj.prototype,"imageAtlas"),Vj.prototype),$j=xo(Vj.prototype,"_lineHeight",[oa],(function(){return 40})),Wj=xo(Vj.prototype,"_string",[oa],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),zj=xo(Vj.prototype,"_horizontalAlign",[oa],(function(){return 0})),Xj=xo(Vj.prototype,"_verticalAlign",[oa],(function(){return 0})),Yj=xo(Vj.prototype,"_fontSize",[oa],(function(){return 40})),Kj=xo(Vj.prototype,"_fontColor",[oa],(function(){return cr.WHITE.clone()})),qj=xo(Vj.prototype,"_maxWidth",[oa],(function(){return 0})),Qj=xo(Vj.prototype,"_fontFamily",[oa],(function(){return"Arial"})),Zj=xo(Vj.prototype,"_font",[oa],(function(){return null})),Jj=xo(Vj.prototype,"_isSystemFontUsed",[oa],(function(){return!0})),tH=xo(Vj.prototype,"_userDefinedFont",[oa],(function(){return null})),iH=xo(Vj.prototype,"_cacheMode",[oa],(function(){return 0})),nH=xo(Vj.prototype,"_imageAtlas",[oa],(function(){return null})),eH=xo(Vj.prototype,"_handleTouchEvent",[oa],(function(){return!0})),Hj=Vj))||Hj)||Hj));k.RichText=dH,k.MaskComponent=Jx,ai(Jx,"cc.MaskComponent"),k.LabelComponent=TU,ai(TU,"cc.LabelComponent"),k.LabelOutlineComponent=LU,ai(LU,"cc.LabelOutlineComponent"),k.RichTextComponent=dH,ai(dH,"cc.RichTextComponent"),k.SpriteComponent=MU,ai(MU,"cc.SpriteComponent"),k.UIModelComponent=CU,ai(CU,"cc.UIModelComponent"),k.GraphicsComponent=Gx,ai(Gx,"cc.GraphicsComponent"),ai(xU,"cc.UIStaticBatchComponent"),ai($U,"cc.UIOpacityComponent"),dt(Jx.prototype,"Mask",[{name:"graphics",newName:"subComp",target:Jx.prototype,targetName:"Mask"}]),dt(zx,"MaskType",[{name:"RECT",newName:"GRAPHICS_RECT",target:zx,targetName:"MaskType"},{name:"ELLIPSE",newName:"GRAPHICS_ELLIPSE",target:zx,targetName:"MaskType"},{name:"IMAGE_STENCIL",newName:"SPRITE_STENCIL",target:zx,targetName:"MaskType"}]),wt(LU.prototype,"LabelOutline",[{name:"width",suggest:"Please use Label.outlineWidth instead."},{name:"color",suggest:"Please use Label.outlineColor instead."}]),wt(VU.prototype,"LabelShadow",[{name:"color",suggest:"Please use Label.shadowColor instead."},{name:"offset",suggest:"Please use Label.shadowOffset instead."},{name:"blur",suggest:"Please use Label.shadowBlur instead."}]);var gH=["left","center","right"],wH=2048,_H=rP(),mH=(1/255).toFixed(3),pH=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},yH=function(){function t(){this.gr=null,this.Ae=null,this.Cy=null,this.Ly=[],this.Fy=new ps,this.Py=100,this.By=1;var t=this.Cy=eB.e_().ni();this.Ae=t.canvas,this.gr=t.context}var i=t.prototype;return i.destroy=function(){eB.e_().ri(this.Cy),this.Cy=null,this.Ae=null,this.gr=null,this.Ly.length=0},i.processingString=function(t,i,n,e,r,s){if(t)i.fntConfig?this.By=1:this.By=this.Dy(i.originFontSize,i.fontScale),cB.fontScale=this.By,this.Uy(n,e),this.xy(i),this.Gy(i,n,r),this.jy(i,n,e,r);else{var h=0;for(this.By=this.Dy(i.fontSize,i.fontScale),this.Hy(i,e),this.Vy(i,n,e,r);(e.canvasSize.width>wH||e.canvasSize.height>wH)&&h<=3;){if(++h>3)this.By=1;else{var u=Math.max(e.canvasSize.width,e.canvasSize.height),o=wH/u;this.By*=o,this.By=Math.max(1,this.By)}this.Hy(i,e),this.Vy(i,n,e,r)}}s&&(s=e.parsedString)},i.generateRenderInfo=function(t,i,n,e,r,s,h){t?(this.$y(i,n,e),this.Wy(t,i,n,e,r,s,h)):(this.zy(i,n,e),this.s_(i,n,e,r),this.Wy(t,i,n,e,r,s,h))},i.setCanvasUsed=function(t,i){this.Ae=t,this.gr=i},i.Dy=function(t,i){var n=i,e=this.Py;return n*t>e&&t<e&&(n=e/t),n<1&&(n=1),n},i.Vy=function(t,i,n,e){if(this.gr){t.actualFontSize=t.fontSize*this.By;var r=e.split("\n"),s=n.parsedString=r,h=this.Xy(t.actualFontSize,t.fontFamily,t.isBold,t.isItalic);this.gr.font=t.fontDesc=h;var u=n.canvasSize,o=n.nodeContentSize,a=n.canvasPadding,c=n.contentSizeExtend,f=this.By;switch(i.overFlow){case 0:for(var v=0,l=0;l<r.length;++l){var d=wP(this.gr,r[l],h);v=v>d?v:d}var g=v,w=(s.length+iP)*this.Yy(i.lineHeight,t.actualFontSize,t.fontSize);u.width=g+a.width*f,u.height=w+a.height*f,o.width=(g+c.width*f)/f,o.height=(w+c.height*f)/f;break;case 2:this.Ky(r,t,i,n),this.qy(r,t,i,n),u.width=o.width*f,u.height=o.height*f;break;case 1:this.qy(r,t,i,n),u.width=o.width*f,u.height=o.height*f;break;case 3:this.qy(r,t,i,n);var _=(n.parsedString.length+iP)*this.Yy(i.lineHeight,t.actualFontSize,t.fontSize);u.width=o.width*f,u.height=_+a.height*f,o.height=(_+c.height*f)/f}}},i.Xy=function(t,i,n,e){var r=t.toString()+"px ";return r+=i,n&&(r="bold "+r),e&&(r="italic "+r),r},i.Yy=function(t,i,n){return 0===t?i:t*i/n},i.Ky=function(t,i,n,e){if(this.gr){var r=this.Xy(i.actualFontSize,i.fontFamily,i.isBold,i.isItalic);this.gr.font=r;var s=this.Qy(t,this.gr,r),h=0,u=0,o=0,a=i.actualFontSize,c=e.canvasSize,f=e.nodeContentSize,v=e.canvasPadding,l=this.By;if(n.wrapping){var d=f.width*l,g=f.height*l;if(d<0||g<0)return;u=g+1;for(var w=0,_=0|i.actualFontSize+1,m=0;w<_;){if((m=w+_+1>>1)<=0){it(4003);break}a=m,r=this.Xy(a,i.fontFamily,i.isBold,i.isItalic),this.gr.font=r;var p=this.Yy(n.lineHeight,a,i.fontSize);for(u=0,h=0;h<t.length;++h){var y=wP(this.gr,t[h],r);u+=TP(t[h],y,d,this.Zy(this.gr,r)).length*p}u>g?_=m-1:w=m}0===w?it(4003):(a=w,r=this.Xy(a,i.fontFamily,i.isBold,i.isItalic),this.gr.font=r)}else{for(u=t.length*this.Yy(n.lineHeight,a,i.fontSize),h=0;h<t.length;++h)o<s[h]&&(o=s[h]);var b=(c.width-v.width)*l/o,A=c.height*l/u;a=i.actualFontSize*Math.min(1,b,A)|0,r=this.Xy(a,i.fontFamily,i.isBold,i.isItalic),this.gr.font=r}i.actualFontSize=a,i.fontDesc=r}},i.qy=function(t,i,n,e){if(n.wrapping&&this.gr){var r=[],s=e.nodeContentSize.width*this.By,h=this.Xy(i.actualFontSize,i.fontFamily,i.isBold,i.isItalic);this.gr.font=h;for(var u=0;u<t.length;++u){var o=wP(this.gr,t[u],h),a=TP(t[u],o,s,this.Zy(this.gr,h));r=r.concat(a)}e.parsedString=r,i.fontDesc=h}},i.Zy=function(t,i){return function(n){return wP(t,n,i)}},i.Qy=function(t,i,n){return t.map((function(t){return wP(i,t,n)}))},i.Hy=function(t,i){var n=0,e=0,r=0,s=0,h=0,u=i.contentSizeExtend,o=i.canvasPadding;if(u.width=u.height=0,t.isOutlined&&(n=e=r=s=h=t.outlineWidth,u.width=u.height=2*h),t.hasShadow){var a=t.shadowBlur+h,c=t.shadowOffsetX,f=t.shadowOffsetY;r=Math.max(r,-c+a),s=Math.max(s,c+a),n=Math.max(n,f+a),e=Math.max(e,-f+a)}if(t.isItalic){var v=t.fontSize*Math.tan(.20943951);s+=v,u.width+=v}o.x=r,o.y=n,o.width=r+s,o.height=n+e},i.zy=function(t,i,n){var e=n.canvasSize;e.width=Math.min(e.width,wH),e.height=Math.min(e.height,wH);var r=this.Ae,s=this.gr;r.width=e.width,r.height=e.height,s.font=t.fontDesc,s.textAlign=gH[i.horizontalAlign],s.textBaseline="alphabetic"},i.Jy=function(t,i,n){var e=0,r=n.canvasSize,s=n.canvasPadding;2===i.horizontalAlign?e=r.width-s.width:1===i.horizontalAlign&&(e=(r.width-s.width)/2);var h=this.Yy(i.lineHeight,t.actualFontSize,t.fontSize)*(n.parsedString.length-1),u=t.actualFontSize*(1-iP/2);if(0!==i.verticalAlign){var o=h+s.height+t.actualFontSize-r.height;2===i.verticalAlign?u-=o+=iP/2*t.actualFontSize:u-=o/2}u+=_H*t.actualFontSize,n.startPosition.set(e+s.x,u+s.y)},i.s_=function(t,i,n,e){var r=this.gr,s=this.Ae;if(r&&s){r.clearRect(0,0,s.width,s.height),r.font=t.fontDesc,this.Jy(t,i,n);var h=this.Yy(i.lineHeight,t.actualFontSize,t.fontSize);r.lineJoin="round",t.isOutlined?(r.fillStyle="rgba("+t.outlineColor.r+", "+t.outlineColor.g+", "+t.outlineColor.b+", "+mH+")",r.fillRect(0,0,s.width,s.height)):(r.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+mH+")",r.fillRect(0,0,s.width,s.height)),r.fillStyle="rgb("+t.color.r+", "+t.color.g+", "+t.color.b+")";var u=n.startPosition,o=new ls(u.x,u.y),a=o.x,c=0;this.tb(o,h,t,i,n);for(var f=n.parsedString,v=0;v<f.length;++v)c=o.y+v*h,t.hasShadow&&(this.ib(t),r.fillText(f[v],a,c)),t.isOutlined&&(this.nb(t),r.strokeText(f[v],a,c)),t.hasShadow&&!t.isOutlined||r.fillText(f[v],a,c);t.hasShadow&&(r.shadowColor="transparent"),this.eb(e)}},i.eb=function(t){var i,n=this.Ae;t.texture&&n&&(i=t.texture instanceof zF?t.texture.texture:t.texture,0!==n.width&&0!==n.height&&(i.getGFXTexture(),i.getGFXSampler(),i.reset({width:n.width,height:n.height,mipmapLevel:1}),i.uploadData(n),i.setWrapMode(2,2),t.texture instanceof zF&&(t.texture.rect=new ps(0,0,n.width,n.height),t.texture.Uw()),k.director.root&&k.director.root.batcher2D&&k.director.root.batcher2D.tr(i.getHash())))},i.tb=function(t,i,n,e,r){if(n.hasShadow||n.isOutlined||n.isUnderline){for(var s=this.gr,h=r.parsedString,u=h.length>1&&n.hasShadow,o=this.Zy(this.gr,n.fontDesc),a=0,c=0,f=0;f<h.length;++f)if(a=t.x,c=t.y+f*i,u&&(n.hasShadow&&(this.ib(n),s.fillText(h[f],a,c)),n.isOutlined&&(this.nb(n),s.strokeText(h[f],a,c)),n.hasShadow&&!n.isOutlined||s.fillText(h[f],a,c)),n.isUnderline){var v=o(h[f]),l=new ls;2===e.horizontalAlign?l.x=t.x-v:1===e.horizontalAlign?l.x=t.x-v/2:l.x=t.x,l.y=c+n.actualFontSize/8,s.fillRect(l.x,l.y,v,n.underlineHeight*this.By)}u&&(s.shadowColor="transparent")}},i.nb=function(t){var i=this.gr;i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0,i.strokeStyle="rgba("+t.outlineColor.r+", "+t.outlineColor.g+", "+t.outlineColor.b+", "+t.outlineColor.a/255+")",i.lineWidth=2*t.outlineWidth*this.By},i.ib=function(t){var i=this.gr,n=this.By;i.shadowColor="rgba("+t.shadowColor.r+", "+t.shadowColor.g+", "+t.shadowColor.b+", "+t.shadowColor.a/255+")",i.shadowBlur=t.shadowBlur*n,i.shadowOffsetX=t.shadowOffsetX*n,i.shadowOffsetY=-t.shadowOffsetY*n},i.Wy=function(t,i,n,e,r,s,h){t?this.rb(i,n,e,r,s,h):(this.sb(r),h(i,e,r))},i.sb=function(t){var i=t.vertexBuffer,n=t.quadCount;if(i.length!==n){for(var e=i.length;e<n;e++)i.push({x:0,y:0,z:0,u:0,v:0,color:cr.WHITE.clone()});i.length=n}},i.Uy=function(t,i){var n=i.nodeContentSize,e=n.width,r=n.height;3===t.overFlow&&(r=0),0===t.overFlow&&(e=0,r=0),t.textWidthTemp=e,t.textHeightTemp=r,t.textDimensions.width=e,t.textDimensions.height=r,t.maxLineWidth=e},i.xy=function(t){t.bmfontScale=t.actualFontSize/(t.originFontSize*this.By)},i.Gy=function(t,i,n){var e=n,r=e.length;if(t.fntConfig){var s=t.fntConfig.kerningDict,h=i.horizontalKerning;if(s&&0!==s.length)for(var u=-1,o=0;o<r;++o){var a=e.charCodeAt(o),c=s[u<<16|65535&a]||0;h[o]=o<r-1?c:0,u=a}}},i.jy=function(t,i,n,e){this.hb(t,i,n,e,this.ub),2===i.overFlow&&(t.fontSize>0&&this.ob(t,i,n,e,this)&&this.ab(t,i,n,e,this.ob),t.fontSize>0&&this.cb(i,n)&&this.ab(t,i,n,e,this.fb)),this.lb(n,e)},i.lb=function(t,i){for(var n=[],e="",r=0,s=0,h=_P(i);r<h;++r){var u=this.Ly[r];u.valid&&(s===u.line?e+=u.char:(n=n.concat(e),s=u.line,e=""))}n=n.concat(e),t.parsedString=n},i.hb=function(t,i,n,e,r){i.linesWidth.length=0;for(var s=e,h=s.length,u=0,o=0,a=0,c=0,f=0,v=0,l=0,d=null,g=0;g<h;){var w=mP(s,g);if("\n"!==w){for(var _=r(t,i,s,g,h),m=v,p=l,y=f,b=o,A=!1,E=new ls,k=0;k<_;++k){var T=g+k;if("\r"!==(w=mP(s,T)))if(d=cB.fontAtlas.getLetterDefinitionForChar(w,cB)){var S=b+d.offsetX*t.bmfontScale-cB.margin;if(i.wrapping&&i.maxLineWidth>0&&o>0&&S+d.w*t.bmfontScale>i.maxLineWidth&&!gP(w)){i.linesWidth.push(f),f=0,u++,o=0,a-=i.lineHeight*this.gb(t,i)+0,A=!0;break}E.x=S,E.y=a-d.offsetY*t.bmfontScale,this.wb(E,w,T,u),T+1<i.horizontalKerning.length&&T<h-1&&(b+=i.horizontalKerning[T+1]*t.bmfontScale),b+=d.xAdvance*t.bmfontScale+i.spacingX,y=E.x+d.w*t.bmfontScale,m<E.y&&(m=E.y),p>E.y-d.h*t.bmfontScale&&(p=E.y-d.h*t.bmfontScale)}else this._b(T,w),null!=t.fntConfig?it(16354,t.fntConfig.atlasName,w):it(16355,t.fontFamily,w);else this._b(T,w)}A||(o=b,v<m&&(v=m),l>p&&(l=p),c<(f=y)&&(c=f),g+=_)}else i.linesWidth.push(f),f=0,u++,o=0,a-=i.lineHeight*this.gb(t,i)+0,this._b(g,w),g++}i.linesWidth.push(f),i.numberOfLines=u+1,i.textDesiredHeight=i.numberOfLines*i.lineHeight*this.gb(t,i),i.numberOfLines>1&&(i.textDesiredHeight+=0*(i.numberOfLines-1));var O=n.nodeContentSize;return O.width=i.textWidthTemp,O.height=i.textHeightTemp,i.textWidthTemp<=0&&(O.width=parseFloat(c.toFixed(2))+2*cB.margin),i.textHeightTemp<=0&&(O.height=parseFloat(i.textDesiredHeight.toFixed(2))+2*cB.margin),i.tailoredTopY=O.height,i.tailoredBottomY=0,v>0&&(i.tailoredTopY=O.height+v),l<-i.textDesiredHeight&&(i.tailoredBottomY=i.textDesiredHeight+l),!0},i._b=function(t,i){var n=this.Ly;if(t>=n.length){var e=new pH;n.push(e)}n[t].char=i,n[t].hash=""+pP(i,0)+cB.hash,n[t].valid=!1},i.wb=function(t,i,n,e){var r=this.Ly;if(n>=r.length){var s=new pH;r.push(s)}var h=""+pP(i,0)+cB.hash;r[n].line=e,r[n].char=i,r[n].hash=h,r[n].valid=cB.fontAtlas.getLetter(h).valid,r[n].x=t.x,r[n].y=t.y},i.ub=function(t,i,n,e,r){var s=mP(n,e);if(dP(s)||"\n"===s||gP(s))return 1;var h=cB.fontAtlas,u=1,o=h.getLetterDefinitionForChar(s,cB);if(!o)return u;for(var a=o.xAdvance*t.bmfontScale+i.spacingX,c=e+1;c<r&&(s=mP(n,c),o=h.getLetterDefinitionForChar(s,cB));++c){if(a+o.offsetX*t.bmfontScale+o.w*t.bmfontScale>i.maxLineWidth&&!gP(s)&&i.maxLineWidth>0)return u;if(a+=o.xAdvance*t.bmfontScale+i.spacingX,"\n"===s||gP(s)||dP(s))break;u++}return u},i.$y=function(t,i,n){var e=n.nodeContentSize;switch(i.linesOffsetX.length=0,i.letterOffsetY=0,i.horizontalAlign){case 0:for(var r=0;r<i.numberOfLines;++r)i.linesOffsetX.push(0);break;case 1:for(var s=0,h=i.linesWidth.length;s<h;s++)i.linesOffsetX.push((e.width-i.linesWidth[s])/2);break;case 2:for(var u=0,o=i.linesWidth.length;u<o;u++)i.linesOffsetX.push(e.width-i.linesWidth[u])}if(i.letterOffsetY=e.height,0!==i.verticalAlign){var a=e.height-i.textDesiredHeight+i.lineHeight*this.gb(t,i)-t.originFontSize*this.By*t.bmfontScale;2===i.verticalAlign?i.letterOffsetY-=a:i.letterOffsetY-=a/2}},i.gb=function(t,i){return 2===i.overFlow?t.bmfontScale:1},i.ob=function(t,i,n){return i.textDesiredHeight>n.nodeContentSize.height},i.fb=function(t,i,n,e,r){for(var s=!1,h=0,u=_P(e);h<u;++h){var o=r.Ly[h];if(o.valid){var a=cB.fontAtlas.getLetterDefinitionForChar(o.char,cB);if(!a)continue;var c=o.x+a.w*t.bmfontScale,f=o.line;if(i.textWidthTemp>0){var v=n.nodeContentSize;if(i.wrapping){if(i.linesWidth[f]>v.width&&(c>v.width||c<0)){s=!0;break}}else if(c>v.width){s=!0;break}}}}return s},i.cb=function(t,i){for(var n=0,e=t.linesWidth.length;n<e;++n)if(t.linesWidth[n]>i.nodeContentSize.width)return!0;return!1},i.ab=function(t,i,n,e,r){for(var s=0,h=0|t.actualFontSize,u=0;s<h;){var o=u=s+h+1>>1;if(o<=0)break;t.bmfontScale=o/(t.originFontSize*this.By),this.hb(t,i,n,e,this.ub),this.$y(t,i,n),r(t,i,n,e,this)?h=u-1:s=u}s>=0&&this.mb(t,i,n,e,s)},i.mb=function(t,i,n,e,r){var s=!0;r||(r=.1,s=!1),t.actualFontSize=r,s&&(this.xy(t),this.hb(t,i,n,e,this.ub))},i.rb=function(t,i,n,e,r,s){for(var h=cB.fontAtlas,u=t.spriteFrame?t.spriteFrame.texture:h.getTexture(),o=n.nodeContentSize,a=e.uiTransAnchorX*o.width,c=e.uiTransAnchorY*o.height,f=0,v=_P(r);f<v;++f){var l=this.Ly[f];if(l.valid){var d=h.getLetter(l.hash);if(d){var g=this.Fy;g.height=d.h,g.width=d.w,g.x=d.u,g.y=d.v;var w=l.y+i.letterOffsetY;if(i.textHeightTemp>0){if(w>i.tailoredTopY){var _=w-i.tailoredTopY;g.y+=_,g.height-=_,w-=_}w-g.height*t.bmfontScale<i.tailoredBottomY&&1===i.overFlow&&(g.height=w<i.tailoredBottomY?0:(w-i.tailoredBottomY)/t.bmfontScale)}var m=l.line,p=l.x+d.w/2*t.bmfontScale+i.linesOffsetX[m];if(i.textWidthTemp>0&&this.pb(i,n,p,m)&&1===i.overFlow&&(g.width=0),g.height>0&&g.width>0){var y=this.yb(t),b=l.x+i.linesOffsetX[l.line],A=e.quadCount;e.quadCount+=4,this.sb(e),s(t,n,e,A,u,g,y,b-a,w-c)}}else st(16353)}}return!0},i.pb=function(t,i,n,e){var r=i.nodeContentSize,s=t.linesWidth[e],h=n>r.width||n<0;return t.wrapping?s>r.width&&h:h},i.yb=function(t){var i=t.spriteFrame;if(!i)return!1;var n=i.isRotated(),e=i.getOriginalSize(),r=i.getRect(),s=i.getOffset(),h=s.x+(e.width-r.width)/2,u=s.y-(e.height-r.height)/2,o=this.Fy;if(n){var a=o.x;o.x=r.x+r.height-o.y-o.height-u,o.y=a+r.y-h,o.y<0&&(o.height+=u)}else o.x+=r.x-h,o.y+=r.y+u;return n},t}();yH.instance=void 0,yH.instance=new yH;var bH=new aB(64,64),AH=new JP(null),EH=null,kH=null,TH=null,SH=null,OH=null,RH=function(){function t(){}var i=t.prototype;return i.updateProcessingData=function(t,i,n,e,r,s){t.fontSize=r.fontSize,t.actualFontSize=r.fontSize,t.originFontSize=TH?TH.fontSize:r.fontSize,i.horizontalAlign=r.horizontalAlign,i.verticalAlign=r.verticalAlign,i.spacingX=r.spacingX;var h=r.overflow;i.overFlow=h,i.lineHeight=r.lineHeight,n.nodeContentSize.width=s.width,n.nodeContentSize.height=s.height,0===h?(i.wrapping=!1,n.nodeContentSize.width+=2*cB.margin,n.nodeContentSize.height+=2*cB.margin):3===h?(i.wrapping=!0,n.nodeContentSize.height+=2*cB.margin):i.wrapping=r.enableWrapText,e.uiTransAnchorX=s.anchorX,e.uiTransAnchorY=s.anchorY,cB.lineHeight=r.lineHeight,cB.fontSize=r.fontSize,t.spriteFrame=SH,t.fntConfig=TH,t.fontFamily=cB.fontFamily,t.color.set(r.color)},i.updateRenderData=function(t){if(t.renderData&&EH!==t){if(t.renderData.vertDirty){kH=(EH=t).node.Zs();var i=t.renderData,n=yH.instance,e=t.textStyle,r=t.textLayout,s=t.textLayoutData,h=t.textRenderData;e.fontScale=NL.getScaleX(),this._updateFontFamily(t),this.updateProcessingData(e,r,s,h,t,kH),this._updateLabelInfo(t),e.fontDesc=cB.fontDesc,n.processingString(!0,e,r,s,t.string),h.quadCount=0,n.generateRenderInfo(!0,e,r,s,h,t.string,this.generateVertexData),i.dataLength!==h.quadCount&&(this.resetRenderData(t),i.dataLength=h.quadCount,i.resize(i.dataLength,i.dataLength/2*3));for(var u=i.data,o=0,a=h.quadCount;o<a;o++)u[o]=h.vertexBuffer[o];var c=i.indexCount;this.createQuadIndices(c),i.chunk.setIndexBuffer(OH),EH.actualFontSize=e.actualFontSize,kH.setContentSize(s.nodeContentSize),this.updateUVs(t),i.vertDirty=!1,EH=null,this._resetProperties()}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},i.updateUVs=function(t){for(var i=t.renderData,n=i.chunk.vb,e=i.vertexCount,r=i.floatStride,s=i.data,h=3,u=0;u<e;u++){var o=s[u];n[h]=o.u,n[h+1]=o.v,h+=r}},i.updateColor=function(){},i.resetRenderData=function(t){var i=t.renderData;i.dataLength=0,i.resize(0,0)},i.generateVertexData=function(t,i,n,e,r,s,h,u,o){var a=e,c=t.bmfontScale,f=n.vertexBuffer,v=r.width,l=r.height,d=s.width,g=s.height,w=0,_=0,m=0,p=0;h?(w=s.x/v,p=(s.x+g)/v,_=(s.y+d)/l,m=s.y/l,f[a].u=w,f[a].v=m,f[a+1].u=w,f[a+1].v=_,f[a+2].u=p,f[a+2].v=m,f[a+3].u=p,f[a+3].v=_):(w=s.x/v,p=(s.x+d)/v,_=(s.y+g)/l,m=s.y/l,f[a].u=w,f[a].v=_,f[a+1].u=p,f[a+1].v=_,f[a+2].u=w,f[a+2].v=m,f[a+3].u=p,f[a+3].v=m),f[a].x=u,f[a].y=o-g*c,f[a+1].x=u+d*c,f[a+1].y=o-g*c,f[a+2].x=u,f[a+2].y=o,f[a+3].x=u+d*c,f[a+3].y=o},i._updateFontFamily=function(t){var i=t.font;SH=i.spriteFrame,TH=i.fntConfig,cB.fontAtlas=i.fontDefDictionary,cB.fontAtlas||(2===t.cacheMode?cB.fontAtlas=bH:cB.fontAtlas=AH),GL.packToDynamicAtlas(t,SH)},i._updateLabelInfo=function(){cB.hash="",cB.margin=0},i._resetProperties=function(){TH=null,SH=null,cB.hash="",cB.margin=0},i.createQuadIndices=function(t){if(t%6==0){var i=t/6;OH=new Uint16Array(t);for(var n=0,e=0;e<i;e++)OH[n++]=0+4*e,OH[n++]=1+4*e,OH[n++]=2+4*e,OH[n++]=1+4*e,OH[n++]=3+4*e,OH[n++]=2+4*e}else ut(16308)},t}(),IH=new cr(255,255,255,255),MH=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();return i.resize(0,0),i},n.fillBuffers=function(t){var i=t.node;IH.set(t.color),IH.a=255*i._uiProps.opacity,$g(i,0,t.renderData,IH)},i}(RH),NH=new MH,CH=null,LH=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.getAssemblerData=function(){return CH||(CH=new aB(1024,1024)),CH.getTexture()},n._updateFontFamily=function(t){cB.fontAtlas=CH,cB.fontFamily=this._getFontFamily(t),t.enableOutline&&t.outlineWidth>0?(cB.isOutlined=!0,cB.margin=t.outlineWidth,cB.out=t.outlineColor.clone(),cB.out.a=t.outlineColor.a*t.color.a/255):(cB.isOutlined=!1,cB.margin=0)},n._getFontFamily=function(t){var i="Arial";return t.useSystemFont?i=t.fontFamily||"Arial":t.font&&(i=t.font._nativeAsset||"Arial"),i},n._updateLabelInfo=function(t){cB.fontDesc=this._getFontDesc(),cB.color.set(t.color),cB.hash=fB(cB)},n._getFontDesc=function(){return cB.fontSize.toString()+"px "+cB.fontFamily},i}(RH),FH=new cr(255,255,255,255),PH=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();return i.resize(0,0),i},n.fillBuffers=function(t){if(t.renderData){var i=t.node;FH.a=255*i._uiProps.opacity,$g(i,0,t.renderData,FH)}},n.updateColor=function(){},i}(LH),BH=new PH;TU.Overflow;var DH=function(){function t(){}var i=t.prototype;return i.updateProcessingData=function(t,i,n,e,r,s){t.isSystemFontUsed=r.useSystemFont,t.fontSize=r.fontSize,n.nodeContentSize.width=n.canvasSize.width=s.width,n.nodeContentSize.height=n.canvasSize.height=s.height,i.lineHeight=r.lineHeight,i.overFlow=r.overflow,0===r.overflow?i.wrapping=!1:3===r.overflow?i.wrapping=!0:i.wrapping=r.enableWrapText,t.isBold=r.isBold,t.isItalic=r.isItalic,t.isUnderline=r.isUnderline,t.underlineHeight=r.underlineHeight,r.enableOutline&&r.outlineWidth>0?(t.isOutlined=!0,t.outlineColor.set(r.outlineColor),t.outlineWidth=r.outlineWidth):t.isOutlined=!1,r.enableShadow&&(r.shadowBlur>0||!Zn(r.shadowOffset.x,0)||!Zn(r.shadowOffset.y,0))?(t.hasShadow=!0,t.shadowColor.set(r.shadowColor),t.shadowBlur=r.shadowBlur,t.shadowOffsetX=r.shadowOffset.x,t.shadowOffsetY=r.shadowOffset.y):t.hasShadow=!1,t.color.set(r.color),e.texture=r.spriteFrame,e.uiTransAnchorX=s.anchorX,e.uiTransAnchorY=s.anchorY,i.horizontalAlign=r.horizontalAlign,i.verticalAlign=r.verticalAlign},i.getAssemblerData=function(){var t=TU._canvasPool.ni();return t.canvas.width=t.canvas.height=1,t},i.resetAssemblerData=function(t){t&&TU._canvasPool.ri(t)},i.updateRenderData=function(t){if(t.renderData){if(t.renderData.vertDirty){var i=t.node.Zs(),n=yH.instance,e=t.textStyle,r=t.textLayout,s=t.textLayoutData,h=t.textRenderData;e.fontScale=NL.getScaleX(),this.updateProcessingData(e,r,s,h,t,i),n.setCanvasUsed(t.assemblerData.canvas,t.assemblerData.context),e.fontFamily=this._updateFontFamily(t),this._resetDynamicAtlas(t),n.processingString(!1,e,r,s,t.string),n.generateRenderInfo(!1,e,r,s,h,t.string,this.generateVertexData);var u=t.renderData;u.textureDirty=!0,this._calDynamicAtlas(t,s),t.actualFontSize=e.actualFontSize,i.setContentSize(s.nodeContentSize);var o=u.data;o[0]=h.vertexBuffer[0],o[1]=h.vertexBuffer[1],o[2]=h.vertexBuffer[2],o[3]=h.vertexBuffer[3],this.updateUVs(t),t.renderData.vertDirty=!1,t.contentWidth=s.nodeContentSize.width}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},i.generateVertexData=function(t,i,n){var e=n.vertexBuffer,r=i.nodeContentSize.width,s=i.nodeContentSize.height,h=n.uiTransAnchorX*r,u=n.uiTransAnchorY*s;e[0].x=-h,e[0].y=-u,e[1].x=r-h,e[1].y=-u,e[2].x=-h,e[2].y=s-u,e[3].x=r-h,e[3].y=s-u},i.updateVertexData=function(){},i.updateUVs=function(){},i._updateFontFamily=function(t){return t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},i._calDynamicAtlas=function(t,i){if(!(1!==t.cacheMode||i.canvasSize.width<=0||i.canvasSize.height<=0)){var n=t.ttfSpriteFrame;GL.packToDynamicAtlas(t,n)}},i._resetDynamicAtlas=function(t){if(1===t.cacheMode){var i=t.ttfSpriteFrame;GL.deleteAtlasSpriteFrame(i),i.us()}},t}(),UH=cr.WHITE.clone(),xH=Uint16Array.from([0,1,2,1,3,2]),GH=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();i.dataLength=4,i.resize(4,6),t.textRenderData.quadCount=4;for(var n=i.chunk.vb,e=i.floatStride,r=[{u:0,v:1},{u:1,v:1},{u:0,v:0},{u:1,v:0}],s=3,h=0,u=i.dataLength;h<u;++h)n[s]=r[h].u,n[s+1]=r[h].v,s+=e;for(var o=5,a=0;a<i.dataLength;a++)cr.toArray(n,UH,o),o+=e;return i.chunk.setIndexBuffer(xH),i},n.fillBuffers=function(t){for(var i=t.renderData,n=i.chunk,e=i.data,r=t.node,s=n.vb,h=r.worldMatrix,u=i.floatStride,o=0,a=e.length,c=0;c<a;c++){var f=e[c],v=f.x,l=f.y,d=h.m03*v+h.m07*l+h.m15;d=d?1/d:1,s[0+(o=c*u)]=(h.m00*v+h.m04*l+h.m12)*d,s[o+1]=(h.m01*v+h.m05*l+h.m13)*d,s[o+2]=(h.m02*v+h.m06*l+h.m14)*d}var g=n.vertexOffset,w=n.meshBuffer,_=n.meshBuffer.iData,m=w.indexOffset;_[m++]=g,_[m++]=g+1,_[m++]=g+2,_[m++]=g+2,_[m++]=g+1,_[m++]=g+3,w.indexOffset+=6},n.updateVertexData=function(t){var i=t.renderData;if(i){var n=t.node.Zs(),e=n.width,r=n.height,s=n.anchorX*e,h=n.anchorY*r,u=i.data;u[0].x=-s,u[0].y=-h,u[1].x=e-s,u[1].y=-h,u[2].x=-s,u[2].y=r-h,u[3].x=e-s,u[3].y=r-h}},n.updateUVs=function(t){var i=t.renderData;if(i&&t.ttfSpriteFrame)for(var n=i.chunk.vb,e=t.ttfSpriteFrame.uv,r=i.floatStride,s=3,h=0;h<i.dataLength;++h){var u=2*h;n[s]=e[u],n[s+1]=e[u+1],s+=r}},n.updateColor=function(){},i}(DH),jH=new GH,HH=t("labelAssembler",{getAssembler:function(t){var i=jH;return t.font instanceof tB?i=NH:2===t.cacheMode&&(i=BH),i}});TU.Assembler=HH,MU.FillType;var VH=new Kr,$H=Uint16Array.from([0,1,2,1,3,2]),WH=function(){function t(){}var i=t.prototype;return i.updateRenderData=function(t){var i=t.spriteFrame;GL.packToDynamicAtlas(t,i);var n=t.renderData;if(n&&i){if(!n.vertDirty)return;var e=t.fillStart,r=t.fillRange;r<0&&(e+=r,r=-r),r=(r=(r=e+r)>1?1:r)<0?0:r;var s=(e=(e=e>1?1:e)<0?0:e)+(r=(r-=e)<0?0:r);s=s>1?1:s,this.updateUVs(t,e,s),this.bb(t,e,s),n.updateRenderData(t,i)}},i.updateUVs=function(t,i,n){var e=t.spriteFrame,r=t.renderData,s=r.chunk.vb,h=e.width,u=e.height,o=e.rect,a=0,c=0,f=0,v=0,l=0,d=0,g=0,w=0,_=0,m=0;e.isRotated()?(a=o.x/h,c=(o.y+o.width)/u,f=l=a,g=_=(o.x+o.height)/h,d=m=c,v=w=o.y/u):(a=o.x/h,c=(o.y+o.height)/u,f=g=a,l=_=(o.x+o.width)/h,v=d=c,w=m=o.y/u);var p=r.floatStride,y=3;switch(t.fillType){case 0:s[y]=f+(l-f)*i,s[y+1]=v+(d-v)*i,s[y+=p]=f+(l-f)*n,s[y+1]=v+(d-v)*n,s[y+=p]=g+(_-g)*i,s[y+1]=w+(m-w)*i,s[y+=p]=g+(_-g)*n,s[y+1]=w+(m-w)*n;break;case 1:s[y]=f+(g-f)*i,s[y+1]=v+(w-v)*i,s[y+=p]=l+(_-l)*i,s[y+1]=d+(m-d)*i,s[y+=p]=f+(g-f)*n,s[y+1]=v+(w-v)*n,s[y+=p]=l+(_-l)*n,s[y+1]=d+(m-d)*n;break;default:ut(2626)}},i.bb=function(t,i,n){var e=t.renderData.data,r=t.node.Zs(),s=r.width,h=r.height,u=r.anchorX*s,o=r.anchorY*h,a=-u,c=-o,f=s-u,v=h-o,l=0;switch(t.fillType){case 0:l=a+(f-a)*n,a+=(f-a)*i,f=l;break;case 1:l=c+(v-c)*n,c+=(v-c)*i,v=l;break;default:ut(2626)}e[0].x=a,e[0].y=c,e[1].x=f,e[1].y=c,e[2].x=a,e[2].y=v,e[3].x=f,e[3].y=v},i.createData=function(t){var i=t.requestRenderData();return i.dataLength=4,i.resize(4,6),i.chunk.setIndexBuffer($H),i.data.forEach((function(t){t.z=0})),i},i.Ab=function(t,i){t.node.getWorldMatrix(VH);for(var n=t.renderData.floatStride,e=t.renderData.data,r=i.vb,s=0,h=0;h<4;h++){var u=e[h],o=u.x,a=u.y,c=VH.m03*o+VH.m07*a+VH.m15;c=c?1/c:1,r[s=h*n]=(VH.m00*o+VH.m04*a+VH.m12)*c,r[s+1]=(VH.m01*o+VH.m05*a+VH.m13)*c,r[s+2]=(VH.m02*o+VH.m06*a+VH.m14)*c}},i.fillBuffers=function(t){var i=t.renderData,n=i.chunk;(t.qm!==t.node.flagChangedVersion||i.vertDirty)&&(this.Ab(t,n),i.vertDirty=!1,t.qm=t.node.flagChangedVersion),n.bufferId;var e=n.vertexOffset,r=n.meshBuffer,s=n.meshBuffer.iData,h=r.indexOffset;s[h++]=e,s[h++]=e+1,s[h++]=e+2,s[h++]=e+2,s[h++]=e+1,s[h++]=e+3,r.indexOffset+=6},i.updateColor=function(t){for(var i=t.renderData,n=i.chunk.vb,e=i.floatStride,r=5,s=t.color,h=s.r/255,u=s.g/255,o=s.b/255,a=t.node._uiProps.opacity,c=0;c<4;c++)n[r]=h,n[r+1]=u,n[r+2]=o,n[r+3]=a,r+=e},t}(),zH=new WH,XH=2*Math.PI,YH=1e-6,KH=new Kr,qH=[new ls,new ls,new ls,new ls],QH=new Array(4),ZH=new Array(8),JH=[new ls,new ls,new ls,new ls],tV=[new ls,new ls,new ls,new ls],iV=new ls,nV=[new ls,new ls,new ls,new ls],eV=null;function rV(t,i,n,e,r,s,h){var u=Math.sin(s);u=Math.abs(u)>YH?u:0;var o=Math.cos(s),a=0,c=0;if(0!==(o=Math.abs(o)>YH?o:0)){if(a=u/o,(t-r.x)*o>0){var f=r.y+a*(t-r.x);h[0].x=t,h[0].y=f}if((i-r.x)*o>0){var v=r.y+a*(i-r.x);h[2].x=i,h[2].y=v}}if(0!==u){if(c=o/u,(e-r.y)*u>0){var l=r.x+c*(e-r.y);h[3].x=l,h[3].y=e}if((n-r.y)*u>0){var d=r.x+c*(n-r.y);h[1].x=d,h[1].y=n}}}function sV(t){var i=t.node.Zs(),n=i.width,e=i.height,r=i.anchorX*n,s=i.anchorY*e,h=-r,u=-s,o=n-r,a=e-s,c=QH;c[0]=h,c[1]=u,c[2]=o,c[3]=a;var f=t.fillCenter,v=iV.x=Math.min(Math.max(0,f.x),1)*(o-h)+h,l=iV.y=Math.min(Math.max(0,f.y),1)*(a-u)+u;qH[0].x=qH[3].x=h,qH[1].x=qH[2].x=o,qH[0].y=qH[1].y=u,qH[2].y=qH[3].y=a,nV.forEach((function(t){ls.set(t,0,0)})),v!==c[0]&&ls.set(nV[0],3,0),v!==c[2]&&ls.set(nV[2],1,2),l!==c[1]&&ls.set(nV[1],0,1),l!==c[3]&&ls.set(nV[3],2,3)}function hV(t){var i=t.width,n=t.height,e=t.getRect(),r=0,s=0,h=0,u=0,o=ZH;t.isRotated()?(r=e.x/i,s=(e.x+e.height)/i,h=e.y/n,u=(e.y+e.width)/n,o[0]=o[2]=r,o[4]=o[6]=s,o[3]=o[7]=u,o[1]=o[5]=h):(r=e.x/i,s=(e.x+e.width)/i,h=e.y/n,u=(e.y+e.height)/n,o[0]=o[4]=r,o[2]=o[6]=s,o[1]=o[3]=u,o[5]=o[7]=h)}function uV(t,i){var n=i.x-t.x,e=i.y-t.y;if(0===n&&0===e)return 0;if(0===n)return e>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(e/n);return n<0&&(r+=Math.PI),r}function oV(t,i,n,e,r){var s=QH,h=s[0],u=s[1],o=s[2],a=s[3];t[i].x=n.x,t[i].y=n.y,t[i+1].x=e.x,t[i+1].y=e.y,t[i+2].x=r.x,t[i+2].y=r.y,aV((n.x-h)/(o-h),(n.y-u)/(a-u),t,i),aV((e.x-h)/(o-h),(e.y-u)/(a-u),t,i+1),aV((r.x-h)/(o-h),(r.y-u)/(a-u),t,i+2)}function aV(t,i,n,e){var r=ZH,s=r[0]+(r[2]-r[0])*t,h=r[4]+(r[6]-r[4])*t,u=r[1]+(r[3]-r[1])*t,o=r[5]+(r[7]-r[5])*t,a=n[e];a.u=s+(h-s)*i,a.v=u+(o-u)*i}for(var cV=function(){function t(){}var i=t.prototype;return i.createData=function(t){return t.requestRenderData()},i.updateRenderData=function(t){var i=t.spriteFrame;GL.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;if(n&&i){if(!n.vertDirty)return;var e=n.data,r=t.fillStart,s=t.fillRange;for(s<0&&(r+=s,s=-s);r>=1;)r-=1;for(;r<0;)r+=1;var h=(r*=XH)+(s*=XH);sV(t),hV(i),rV(QH[0],QH[2],QH[1],QH[3],iV,r,JH),rV(QH[0],QH[2],QH[1],QH[3],iV,r+s,tV);for(var u=0,o=0;o<4;++o){var a=nV[o];if(a)if(s>=XH)n.dataLength=u+3,oV(e,u,iV,qH[a.x],qH[a.y]),u+=3;else{var c=uV(iV,qH[a.x]),f=uV(iV,qH[a.y]);f<c&&(f+=XH),c-=XH,f-=XH;for(var v=0;v<3;++v)c>=h||(c>=r?(n.dataLength=u+3,oV(e,u,iV,qH[a.x],f>=h?tV[o]:qH[a.y]),u+=3):f>r&&(f<=h?(n.dataLength=u+3,oV(e,u,iV,JH[o],qH[a.y]),u+=3):(n.dataLength=u+3,oV(e,u,iV,JH[o],tV[o]),u+=3))),c+=XH,f+=XH}}0===u&&(n.dataLength=0),n.resize(u,u),n.updateRenderData(t,i)}},i.Eb=function(t){eV=null,eV=new Uint16Array(t);for(var i=0,n=0;n<t;n++)eV[i++]=n},i.fillBuffers=function(t){var i=t.node,n=t.renderData,e=n.chunk;(t.qm!==i.flagChangedVersion||n.vertDirty)&&(this.kb(t,e),n.vertDirty=!1,t.qm=i.flagChangedVersion),this.Tb(t),e.bufferId;for(var r=e.vertexOffset,s=e.meshBuffer,h=e.meshBuffer.iData,u=s.indexOffset,o=0;o<n.indexCount;o++)h[u+o]=r+o;s.indexOffset+=n.indexCount,s.setDirty()},i.Sb=function(t){for(var i=t.renderData,n=i.floatStride,e=i.data,r=i.chunk.vb,s=0;s<e.length;s++){var h=s*n;r[h+3]=e[s].u,r[h+4]=e[s].v}},i.kb=function(t,i){t.node.getWorldMatrix(KH);for(var n=t.renderData,e=n.floatStride,r=t.renderData.data,s=i.vb,h=n.vertexCount,u=0,o=0;o<h;o++){var a=r[o],c=a.x,f=a.y,v=KH.m03*c+KH.m07*f+KH.m15;v=v?1/v:1,s[u+0]=(KH.m00*c+KH.m04*f+KH.m12)*v,s[u+1]=(KH.m01*c+KH.m05*f+KH.m13)*v,s[u+2]=(KH.m02*c+KH.m06*f+KH.m14)*v,s[u+3]=a.u,s[u+4]=a.v,u+=e}},i.updateUVs=function(t){t.renderData.vertDirty=!0,t.wh()},i.Tb=function(t){for(var i=t.renderData,n=i.chunk.vb,e=i.floatStride,r=i.vertexCount,s=5,h=t.color,u=h.r/255,o=h.g/255,a=h.b/255,c=t.node._uiProps.opacity,f=0;f<r;f++)n[s]=u,n[s+1]=o,n[s+2]=a,n[s+3]=c,s+=e},i.updateColor=function(){},t}(),fV=new cV,vV=Uint16Array.from([0,1,2,1,3,2]),lV=function(){function t(){}var i=t.prototype;return i.createData=function(t){var i=t.requestRenderData();return i.dataLength=4,i.resize(4,6),i.chunk.setIndexBuffer(vV),i},i.updateRenderData=function(t){var i=t.spriteFrame;GL.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;n&&i&&(n.vertDirty&&this.bb(t),n.updateRenderData(t,i))},i.Ob=function(t,i){var n=t.renderData;if(n)for(var e=i.vb,r=n.data,s=t.node.worldMatrix,h=s.m00,u=s.m01,o=s.m02,a=s.m03,c=s.m04,f=s.m05,v=s.m06,l=s.m07,d=s.m12,g=s.m13,w=s.m14,_=s.m15,m=n.floatStride,p=0,y=r.length,b=0;b<y;++b){var A=r[b],E=A.x,k=A.y,T=a*E+l*k+_;T=T?1/T:1,e[0+(p=b*m)]=(h*E+c*k+d)*T,e[p+1]=(u*E+f*k+g)*T,e[p+2]=(o*E+v*k+w)*T}},i.fillBuffers=function(t){if(null!==t){var i=t.renderData;if(i){var n=i.chunk;(t.qm!==t.node.flagChangedVersion||i.vertDirty)&&(this.Ob(t,n),i.vertDirty=!1,t.qm=t.node.flagChangedVersion);var e=n.vertexOffset,r=n.meshBuffer,s=n.meshBuffer.iData,h=r.indexOffset,u=e;s[h++]=u,s[h++]=u+1,s[h++]=u+2,s[h++]=u+1,s[h++]=u+3,s[h++]=u+2,r.indexOffset+=6}}},i.bb=function(t){var i=t.renderData;if(i){var n=t.node.Zs(),e=i.data,r=n.width,s=n.height,h=n.anchorX*r,u=n.anchorY*s,o=0,a=0,c=0,f=0;if(t.trim)o=-h,a=-u,c=r-h,f=s-u;else{var v=t.spriteFrame,l=v.originalSize,d=r/l.width,g=s/l.height,w=v.trimmedBorder;o=w.x*d-h,a=w.z*g-u,c=r+w.y*d-h,f=s+w.w*g-u}e[0].x=o,e[0].y=a,e[1].x=c,e[1].y=a,e[2].x=o,e[2].y=f,e[3].x=c,e[3].y=f,i.vertDirty=!0}},i.updateUVs=function(t){var i=t.renderData;if(t.spriteFrame&&i)for(var n=i.chunk.vb,e=t.spriteFrame.uv,r=i.floatStride,s=3,h=0;h<i.dataLength;++h){var u=2*h;n[s]=e[u],n[s+1]=e[u+1],s+=r}},i.updateColor=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,e=5,r=t.color,s=r.r/255,h=r.g/255,u=r.b/255,o=r.a/255,a=0;a<4;a++,e+=i.floatStride)n[e]=s,n[e+1]=h,n[e+2]=u,n[e+3]=o},t}(),dV=new lV,gV=[],wV=0;wV<4;wV++)gV.push({x:0,y:0,z:0,u:0,v:0,color:new cr});var _V,mV,pV,yV,bV,AV,EV,kV=function(){function t(){this.Rb=void 0}var i=t.prototype;return i.createData=function(t){var i=t.requestRenderData();i.dataLength=16,i.resize(16,54);var n=this.Rb=new Uint16Array(54);return this.Eb(4,4),i.chunk.setIndexBuffer(n),i},i.Eb=function(t,i){for(var n=0,e=this.Rb,r=0;r<t-1;r++)for(var s=0;s<i-1;s++){var h=r*i+s;e[n++]=h,e[n++]=h+1,e[n++]=h+i,e[n++]=h+1,e[n++]=h+1+i,e[n++]=h+i}},i.updateRenderData=function(t){var i=t.spriteFrame;GL.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;n&&i&&(n.vertDirty&&this.bb(t),n.updateRenderData(t,i))},i.bb=function(t){var i=t.renderData;if(i){var n=i.data,e=t.node.Zs(),r=e.width,s=e.height,h=e.anchorX*r,u=e.anchorY*s,o=t.spriteFrame,a=o.insetLeft,c=o.insetRight,f=o.insetTop,v=o.insetBottom,l=r-a-c,d=s-f-v,g=r/(a+c),w=s/(f+v);g=Number.isNaN(g)||g>1?1:g,w=Number.isNaN(w)||w>1?1:w,l=l<0?0:l,d=d<0?0:d,gV[0].x=-h,gV[0].y=-u,gV[1].x=a*g-h,gV[1].y=v*w-u,gV[2].x=gV[1].x+l,gV[2].y=gV[1].y+d,gV[3].x=r-h,gV[3].y=s-u;for(var _=0;_<4;_++)for(var m=0;m<4;m++){var p=4*_+m;p<i.dataLength&&_<gV.length&&m<gV.length&&(n[p].x=gV[m].x,n[p].y=gV[_].y)}}},i.fillBuffers=function(t){var i=t.renderData;if(i){var n=i.chunk;(t.qm!==t.node.flagChangedVersion||i.vertDirty)&&(this.Ab(t,n),i.vertDirty=!1,t.qm=t.node.flagChangedVersion),n.bufferId;for(var e=n.vertexOffset,r=n.meshBuffer,s=n.meshBuffer.iData,h=r.indexOffset,u=0;u<3;++u)for(var o=0;o<3;++o){var a=e+4*u+o;s[h++]=a,s[h++]=a+1,s[h++]=a+4,s[h++]=a+1,s[h++]=a+5,s[h++]=a+4}r.indexOffset=h}},i.Ab=function(t,i){var n=t.renderData;if(n)for(var e=n.floatStride,r=n.data,s=i.vb,h=t.node.worldMatrix,u=h.m00,o=h.m01,a=h.m02,c=h.m03,f=h.m04,v=h.m05,l=h.m06,d=h.m07,g=h.m12,w=h.m13,_=h.m14,m=h.m15,p=0,y=0;y<4;++y)for(var b=r[4*y],A=0;A<4;++A){var E=r[A].x,k=b.y,T=c*E+d*k+m;T=T?1/T:1,s[0+(p=(4*y+A)*e)]=(u*E+f*k+g)*T,s[p+1]=(o*E+v*k+w)*T,s[p+2]=(a*E+l*k+_)*T}},i.updateUVs=function(t){var i=t.renderData;if(t.spriteFrame&&i)for(var n=i.chunk.vb,e=i.floatStride,r=t.spriteFrame.uvSliced,s=3,h=0;h<16;h++)n[s]=r[h].u,n[s+1]=r[h].v,s+=e},i.updateColor=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,e=i.floatStride,r=5,s=t.color,h=s.r/255,u=s.g/255,o=s.b/255,a=t.node._uiProps.opacity,c=0;c<16;c++)n[r]=h,n[r+1]=u,n[r+2]=o,n[r+3]=a,r+=e},t}(),TV=new kV,SV=new Kr,OV=0,RV=[],IV=null;function MV(t){return t&&(t.insetTop>0||t.insetBottom>0||t.insetLeft>0||t.insetRight>0)?2:0}var NV=function(){function t(){}var i=t.prototype;return i.createData=function(t){return t.requestRenderData()},i.updateRenderData=function(t){var i=t.renderData;if(i){var n=t.spriteFrame;if(n&&i&&i.vertDirty){var e=t.node.Zs(),r=Math.abs(e.width),s=Math.abs(e.height),h=n.getRect(),u=n.insetLeft,o=n.insetRight,a=h.width-u-o,c=n.insetTop,f=n.insetBottom,v=h.height-c-f,l=r-u-o,d=s-c-f;l=l>0?l:0,d=d>0?d:0;var g=0===a?l:l/a,w=0===v?d:d/v,_=MV(n),m=Math.ceil(w+_),p=Math.ceil(g+_);i.dataLength=4*m*p,this.Ib(t,l,d,m,p),i.vertexCount!==m*p*4&&(t.renderEntity.colorDirty=!0),i.resize(m*p*4,m*p*6),i.updateRenderData(t,n)}}},i.Eb=function(t){if(t%6==0){var i=t/6;IV=new Uint16Array(t);for(var n=0,e=0;e<i;e++)IV[n++]=0+4*e,IV[n++]=1+4*e,IV[n++]=2+4*e,IV[n++]=1+4*e,IV[n++]=3+4*e,IV[n++]=2+4*e}else ut(16308)},i.updateUVs=function(t){var i=t.renderData;i&&(i.vertDirty=!0,t.wh())},i.fillBuffers=function(t){var i=t.node,n=t.renderData;if(n){var e=n.chunk;if(null!==e){(t.qm!==i.flagChangedVersion||n.vertDirty)&&(this.kb(t,e),n.vertDirty=!1,t.qm=i.flagChangedVersion),this.Tb(t),e.bufferId;for(var r=e.vertexOffset,s=e.meshBuffer,h=e.meshBuffer.iData,u=s.indexOffset,o=0;o<n.indexCount;o+=6)h[u++]=r,h[u++]=r+1,h[u++]=r+2,h[u++]=r+1,h[u++]=r+3,h[u++]=r+2,r+=4,s.indexOffset+=6;s.setDirty()}}},i.Sb=function(t){var i=t.renderData;if(i)for(var n=i.floatStride,e=i.data,r=i.chunk.vb,s=0;s<e.length;s++){var h=s*n;r[h+3]=e[s].u,r[h+4]=e[s].v}},i.kb=function(t,i){var n=t.renderData;if(n){t.node.getWorldMatrix(SV);for(var e=n.floatStride,r=n.data,s=i.vb,h=r.length,u=0;u<h;u++){var o=r[u].x,a=r[u].y,c=r[u].z,f=SV.m03*o+SV.m07*a+SV.m11*c+SV.m15;f=f?1/f:1;var v=u*e;s[v]=(SV.m00*o+SV.m04*a+SV.m08*c+SV.m12)*f,s[v+1]=(SV.m01*o+SV.m05*a+SV.m09*c+SV.m13)*f,s[v+2]=(SV.m02*o+SV.m06*a+SV.m10*c+SV.m14)*f}this.Sb(t)}},i.Ib=function(t,i,n,e,r){var s=t.node.Zs(),h=t.renderData;if(h){var u,o,a=h.data,c=t.spriteFrame,f=c.rect,v=Math.abs(s.width),l=Math.abs(s.height),d=s.anchorX*v,g=s.anchorY*l,w=c.insetLeft,_=c.insetRight,m=f.width-w-_,p=c.insetTop,y=c.insetBottom,b=f.height-p-y,A=s.width/(w+_)>1?1:s.width/(w+_),E=s.height/(p+y)>1?1:s.height/(p+y);u=m>0?Math.floor(1e3*i)/1e3%m==0?m:i%m:i,o=b>0?Math.floor(1e3*n)/1e3%b==0?b:n%b:n,RV.length=0,OV=Math.max(e+1,r+1);for(var k=0;k<OV;k++)RV.push({x:0,y:0,z:0,u:0,v:0,color:new cr});var T=MV(c);if(0===T)for(var S=0;S<OV;S++)RV[S].x=S>=r?v-d:S*m-d,RV[S].y=S>=e?l-g:S*b-g;else for(var O=0;O<OV;O++)0===O?RV[O].x=-d:1===O?RV[O].x=w*A-d:O>1&&O<r-1?RV[O].x=m>0?w*A-d+m*(O-1):w+i-d:O===r-1?RV[O].x=w*A-d+u+m*(O-2):O>=r&&(RV[O].x=Math.min(w+i+_,v)-d),0===O?RV[O].y=-g:1===O?RV[O].y=y*E-g:O>1&&O<e-1?RV[O].y=b>0?y*E-g+b*(O-1):y+n-g:O===e-1?RV[O].y=y*E-g+o+b*(O-2):O>=e&&(RV[O].y=Math.min(y+n+p,l)-g);for(var R=0,I=0,M=0,N=0,C=0;C<e;++C){M=RV[C].y,N=RV[C+1].y;for(var L=0;L<r;++L){R=RV[L].x,I=RV[L+1].x;var F=4*(C*r+L);a[F].x=R,a[F].y=M,a[F+1].x=I,a[F+1].y=M,a[F+2].x=R,a[F+2].y=N,a[F+3].x=I,a[F+3].y=N}}var P=c.rotated;c.uv;var B=c.uvSliced;_V=B[0],mV=B[1],pV=B[2],yV=B[3],bV=B[4],AV=B[8],EV=B[12];for(var D=0,U=0,x=0===m?i:i/m,G=0===b?n:n/b,j=[],H=[],V=0;V<e;++V){U=n>b?n>=(T>0?V:V+1)*b?1:G%1:G;for(var $=0;$<r;++$){D=i>m?i>=(T>0?$:$+1)*m?1:x%1:x,P?(0===T?(j[0]=bV.u,j[1]=bV.u,j[2]=bV.u+(AV.u-bV.u)*U,H[0]=mV.v,H[1]=mV.v+(pV.v-mV.v)*D,H[2]=mV.v):(0===V?(j[0]=_V.u,j[1]=_V.u,j[2]=bV.u):V<e-1?(j[0]=bV.u,j[1]=bV.u,j[2]=bV.u+(AV.u-bV.u)*U):V===e-1&&(j[0]=AV.u,j[1]=AV.u,j[2]=EV.u),0===$?(H[0]=_V.v,H[1]=mV.v,H[2]=_V.v):$<r-1?(H[0]=mV.v,H[1]=mV.v+(pV.v-mV.v)*D,H[2]=mV.v):$===r-1&&(H[0]=pV.v,H[1]=yV.v,H[2]=pV.v)),j[3]=j[2],H[3]=H[1]):(0===T?(j[0]=mV.u,j[1]=mV.u+(pV.u-mV.u)*D,j[2]=mV.u,H[0]=bV.v,H[1]=bV.v,H[2]=bV.v+(AV.v-bV.v)*U):(0===$?(j[0]=_V.u,j[1]=mV.u,j[2]=_V.u):$<r-1?(j[0]=mV.u,j[1]=mV.u+(pV.u-mV.u)*D,j[2]=mV.u):$===r-1&&(j[0]=pV.u,j[1]=yV.u,j[2]=pV.u),0===V?(H[0]=_V.v,H[1]=_V.v,H[2]=bV.v):V<e-1?(H[0]=bV.v,H[1]=bV.v,H[2]=bV.v+(AV.v-bV.v)*U):V===e-1&&(H[0]=AV.v,H[1]=AV.v,H[2]=EV.v)),j[3]=j[1],H[3]=H[2]);var W=4*(V*r+$);a[W].u=j[0],a[W].v=H[0],a[W+1].u=j[1],a[W+1].v=H[1],a[W+2].u=j[2],a[W+2].v=H[2],a[W+3].u=j[3],a[W+3].v=H[3]}}}},i.Tb=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,e=i.floatStride,r=i.vertexCount,s=5,h=t.color,u=h.r/255,o=h.g/255,a=h.b/255,c=t.node._uiProps.opacity,f=0;f<r;f++)n[s]=u,n[s+1]=o,n[s+2]=a,n[s+3]=c,s+=e},i.updateColor=function(){},t}(),CV=new NV;MU.Type,MU.FillType;var LV=t("spriteAssembler",{getAssembler:function(t){var i=dV,n=t;switch(n.type){case 1:i=TV;break;case 2:i=CV;break;case 3:i=2===n.fillType?fV:zH}return i}});MU.Assembler=LV;var FV=t("StencilManager",function(){function t(){this.Mb=[],this.Nb={stencilTest:!0,func:7,stencilMask:65535,writeMask:65535,failOp:1,zFailOp:1,passOp:1,ref:1},this.Cb=0,this.Lb=new Map,this.Fb=new Map}var i=t.prototype;return i.pushMask=function(t){this.Mb.push(t)},i.clear=function(t){return 2!==t.stencilStage?5:1},i.enableMask=function(){this.stage=3},i.exitMask=function(){0!==this.Mb.length&&(this.Mb.pop(),0===this.Mb.length?this.stage=0:this.stage=3)},i.getWriteMask=function(){return 1<<this.Mb.length-1},i.getExitWriteMask=function(){return 1<<this.Mb.length},i.Pb=function(){for(var t=0,i=0;i<this.Mb.length;++i)t+=1<<i;return t},i.getMaskStackSize=function(){return this.Mb.length},i.reset=function(){this.Mb.length=0,this.stage=0},i.destroy=function(){this.Lb.forEach((function(t){t.destroy()})),this.Lb.clear()},i.getStencilStage=function(t,i){var n=0,e=!1,r=!1,s=1,h=this.Lb;if(i&&i.passes[0]){var u=i.passes[0].depthStencilState,o=0,a=0;u.depthTest&&(o=1),u.depthWrite&&(a=1),n=o|a<<1|u.depthFunc<<2|t<<6|this.Mb.length<<9,e=u.depthTest,r=u.depthWrite,s=u.depthFunc,h=this.Fb}else n=t<<16|this.Mb.length;if(h&&h.has(n))return h.get(n);this.Bb(t);var c=this.Nb,f=new kg(e,r,s,c.Db,c.Ub,c.xb,c.Gb,c.jb,c.Hb,c.Vb,c.$b,c.Db,c.Ub,c.xb,c.Gb,c.jb,c.Hb,c.Vb,c.$b);return h.set(n,f),f},i.getStencilHash=function(t){return t<<8|this.Mb.length},i.Bb=function(t){var i=this.Nb;0===t?(i.Db=!1,i.Ub=7,i.jb=1,i.xb=i.Gb=65535,i.$b=1):(i.Db=!0,3===t?(i.Ub=2,i.jb=1,i.xb=i.$b=this.Pb(),i.Gb=this.getWriteMask()):1===t?(i.Ub=0,i.jb=0,i.Gb=i.xb=i.$b=this.getWriteMask()):5===t||2===t?(i.Ub=0,i.jb=2,i.Gb=i.xb=i.$b=this.getWriteMask()):6===t&&(i.Ub=0,i.jb=0,i.Gb=i.xb=i.$b=this.getWriteMask()))},e(t,[{key:"stage",get:function(){return this.Cb},set:function(t){this.Cb=t}},{key:"pattern",get:function(){return this.Nb}}]),t}());FV.sharedManager=null,FV.sharedManager=new FV;var PV=["mouse-down","mouse-move","mouse-up","mouse-wheel","mouse-leave-window","mouse-enter-window"],BV=["touch-start","touch-move","touch-end","touch-cancel"],DV=function(){function t(){this.priority=1,this.Wb=!1,this.zb=0,this.Xb=[],this.Yb=[],this.Kb=[],lM._registerEventDispatcher(this);var t=Ep.callbacksInvoker;t.on(0,this.qb,this),t.on(1,this.Qb,this),t.on(2,this.Zb,this)}var i=t.prototype;return i.onThrowException=function(){this.zb=0},i.dispatchEvent=function(t){var i=t.type;return BV.includes(i)?this.Jb(t):!PV.includes(i)||this.tA(t)},i.qb=function(t){0===this.zb?this.Xb.includes(t)||(this.Xb.push(t),this.Wb=!0):this.Yb.includes(t)||this.Yb.push(t),yi(this.Kb,t)},i.Qb=function(t){0===this.zb?(yi(this.Xb,t),this.Wb=!0):this.Kb.includes(t)||this.Kb.push(t),yi(this.Yb,t)},i.tA=function(t){this.zb++,this.iA();for(var i=this.Xb,n=i.length,e=!0,r=0;r<n;++r){var s=i[r];if(s.isEnabled&&s.shouldHandleEventMouse&&s.Ws(t)){if(e=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this.zb<=0&&this.nA(),e},i.Jb=function(t){this.zb++,this.iA();for(var i=this.Xb,n=i.length,e=t.touch,r=!0,s=0;s<n;++s){var h=i[s];if(h.isEnabled&&h.shouldHandleEventTouch)if("touch-start"===t.type){if(h.Js(t)){if(h.isEnabled)h.claimedTouchIdList.push(e.getID());else{var u=new zm([t.touch],!0,"touch-cancel");u.touch=t.touch,h.dispatchEvent(u),h.claimedTouchIdList.length=0}if(r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(h.claimedTouchIdList.length>0){var o=h.claimedTouchIdList.indexOf(e.getID());if(-1!==o){if(h.Js(t),"touch-end"!==t.type&&"touch-cancel"!==t.type||(mi(h.claimedTouchIdList,o),t.preventSwallow||this.eA(s+1,e.getID())),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this.zb<=0&&this.nA(),r},i.eA=function(t,i){for(var n=this.Xb,e=n.length,r=t;r<e;++r){var s=n[r],h=s.claimedTouchIdList.indexOf(i);-1!==h&&mi(s.claimedTouchIdList,h)}},i.nA=function(){for(var t=this.Yb,i=t.length,n=0;n<i;++n)this.qb(t[n]);t.length=0;for(var e=this.Kb,r=e.length,s=0;s<r;++s)this.Qb(e[s]);e.length=0},i.iA=function(){if(this.Wb){for(var t=this.Xb,i=t.length,n=0;n<i;++n){var e=t[n],r=e.node;if(r._uiProps){var s=r.Zs();e.cachedCameraPriority=s.cameraPriority}}t.sort(this.rA),this.Wb=!1}},i.rA=function(t,i){var n=t.node,e=i.node;if(!(i&&e&&e.activeInHierarchy&&e.Zs()))return-1;if(!(t&&n&&n.activeInHierarchy&&n.Zs()))return 1;if(t.cachedCameraPriority!==i.cachedCameraPriority)return i.cachedCameraPriority-t.cachedCameraPriority;for(var r=n,s=e,h=!1;(null==(u=r.parent)?void 0:u.uuid)!==(null==(o=s.parent)?void 0:o.uuid);){var u,o,a,c,f,v;r=null===(null==(a=r)||null==(c=a.parent)?void 0:c.parent)?(h=!0)&&e:r&&r.parent,s=null===(null==(f=s)||null==(v=f.parent)?void 0:v.parent)?(h=!0)&&n:s&&s.parent}if(r.uuid===s.uuid){if(r.uuid===e.uuid)return-1;if(r.uuid===n.uuid)return 1}var l=r?r.siblingIndex:0,d=s?s.siblingIndex:0;return h?l-d:d-l},i.Zb=function(){this.Wb=!0},t}();new DV;var UV=new xd(null),xV=new Kr,GV=t("UI",function(){function t(t){var i=this;this.sA=[],this.hA=null,this.uA=new Map,this.oA=-1,this.aA=0,this.cA=new Lk,this.fA=null,this.vA=this.cA,this.lA=null,this.dA=null,this.gA=null,this.wA=null,this._A=null,this.mA=0,this.pA=0,this.yA=0,this.bA=null,this.AA=!1,this.EA=0,this.kA=!1,this.TA=!1,this.SA=null,this.OA=0,this.RA=0,this.IA=1,this.MA=0,this.NA=new HV,this.CA=[],this.LA=null,this.FA=null,this.PA=null,this.Tv=t,this.device=t.device,this.wv=new au(64),this.BA=new uu((function(){return new UU}),128,(function(t){return t.kg(i)}))}var i=t.prototype;return i.initialize=function(){return!0},i.destroy=function(){for(var t=0;t<this.wv.length;t++)this.wv.array[t]&&this.wv.array[t].kg(this);this.wv.destroy();for(var i,n=d(this.uA.values());!(i=n()).done;)i.value.destroy();this.uA.clear(),this.BA&&this.BA.destroy(),this.NA.kg(),FV.sharedManager.destroy(),this.LA&&this.PA&&(k.director.root.destroyModel(this.LA),this.PA.destroy()),this.FA&&this.FA.destroy()},i.DA=function(){},i.addScreen=function(t){this.sA.push(t),this.sA.sort(this.UA)},i.removeScreen=function(t){var i=this.sA.indexOf(t);-1!==i&&this.sA.splice(i,1)},i.sortScreens=function(){this.sA.sort(this.UA)},i.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var i=t.scene.renderScene.cameras,n=0;n<i.length;n++){var e=i[n];if(e.visibility&t.layer)return e}return null},i.update=function(){for(var t=this.sA,i=0,n=0;n<t.length;++n){var e=t[n],r=e._getRenderScene();if(e.enabledInHierarchy&&r){this.MA=0,this.IA=1,this.walk(e.node),this.autoMergeBatches(this.wA),this.resetRenderStates();var s=0;if(this.wv.length>i)for(;i<this.wv.length;++i){var h=this.wv.array[i];if(h.cp)for(var u=h.cp.subModels,o=0;o<u.length;o++)u[o].priority=s++;else h.yp=this.NA.xA(h);r.addBatch(h)}}}},i.uploadBuffers=function(){if(this.wv.length>0){for(var t=this.CA.length,i=0;i<t;i++)this.CA[i].uploadBuffers();for(var n,e=d(this.uA.values());!(n=e()).done;){var r=n.value;r.uploadBuffers(),r.reset()}this.NA.Mi()}},i.reset=function(){for(var t=0;t<this.wv.length;++t){var i=this.wv.array[t];i.lp||(i.V_(),this.BA.free(i))}for(var n,e=d(this.uA.values());!(n=e()).done;)n.value.reset();for(var r=this.CA.length,s=0;s<r;s++)this.CA[s].freeIAPool();this.CA.length=0,this.hA=null,this.oA=-1,this.aA=0,this.EA=0,this.yA=0,this.fA=null,this.vA=this.cA,this.lA=null,this.dA=null,this.wA=null,this._A=null,this.wv.clear(),FV.sharedManager.reset()},i.switchBufferAccessor=function(t){void 0===t&&(t=mB);var i=t===mB?36:EB(t);if(!this.hA||this.hA.vertexFormatBytes!==i){var n=this.uA.get(i);n||(n=new RB(this.device,t),this.uA.set(i,n)),this.hA=n,this.oA=-1}return this.hA},i.registerBufferAccessor=function(t,i){this.uA.set(t,i)},i.updateBuffer=function(t,i){var n=this.switchBufferAccessor(t);this.oA!==i&&(this.oA=i,this.aA=n.getMeshBuffer(i).indexOffset)},i.commitComp=function(t,i,n,e,r){var s,h=0,u=-1;if(i&&i.chunk){if(!i.isValid())return;h=i.dataHash,s=i.material,u=i.chunk.bufferId}2===t.stencilStage||6===t.stencilStage?this.GA(t):t.stencilStage=FV.sharedManager.stage;var o=t.stencilStage;this.EA===h&&0!==h&&this.vA===s&&this.bA===o||(this.autoMergeBatches(this.wA),i&&!i._isMeshBuffer&&this.updateBuffer(i.vertexFormat,u),this.fA=i,this.EA=i?i.dataHash:0,this.wA=t,this._A=r,this.vA=t.getRenderMaterial(0),this.bA=o,this.yA=t.node.layer,n?(this.lA=n.getGFXTexture(),this.dA=n.getGFXSampler(),this.mA=n.getHash(),this.pA=this.dA.hash):(this.lA=null,this.dA=null,this.mA=0,this.pA=0)),e.fillBuffers&&e.fillBuffers(t,this)},i.commitIA=function(t,i,n,e,r){this.vA!==this.cA&&(this.autoMergeBatches(this.wA),this.resetRenderStates());var s=null,h=0;t&&(t.stencilStage=FV.sharedManager.stage,s=null!==t.customMaterial?FV.sharedManager.getStencilStage(t.stencilStage,e):FV.sharedManager.getStencilStage(t.stencilStage),h=FV.sharedManager.getStencilHash(t.stencilStage));var u=this.gA?this.gA._requireDrawBatch():this.BA.alloc();u.mp=t.node.layer,u.pp=i,u.vp=r||null,n&&(u.fp=n.getGFXTexture(),u.Ld=n.getGFXSampler(),u.dp=n.getHash(),u.gp=u.Ld.hash),u.bp(e||null,s,h,null),this.wv.push(u)},i.commitMiddleware=function(t,i,n,e,r,s,h){var u=r.getGFXTexture();h&&this.TA&&this.SA===i&&this.lA===u&&this.vA.hash===s.hash&&this.OA+this.RA===n&&this.yA===t.node.layer?this.RA+=e:(this.autoMergeBatches(this.wA),this.resetRenderStates(),this.wA=t,this.lA=u,this.dA=r.getGFXSampler(),this.mA=r.getHash(),this.yA=t.node.layer,this.pA=this.dA.hash,this.EA=0,this._A=h?null:t.node,this.TA=h,this.SA=i,this.vA=s,this.OA=n,this.RA=e),this.kA=!0},i.commitModel=function(t,i,n){this.vA!==this.cA&&(this.autoMergeBatches(this.wA),this.resetRenderStates());var e=null,r=0;n&&(2===t.stencilStage||6===t.stencilStage?this.GA(t):t.stencilStage=FV.sharedManager.stage,e=FV.sharedManager.getStencilStage(t.stencilStage,n),r=FV.sharedManager.getStencilHash(t.stencilStage));var s=k.director.getTotalFrames();i&&(i.updateTransform(s),i.updateUBOs(s));for(var h=0;h<i.subModels.length;h++){var u=this.BA.alloc(),o=i.subModels[h];u.mp=t.node.layer,u.cp=i,u.fp=null,u.Ld=null,u.vp=null,e||(e=null),u.bp(n,e,r,o.patches),u.pp=o.inputAssembler,u.cp.visFlags=u.mp,u.yp=o.descriptorSet,this.wv.push(u)}},i.setupStaticBatch=function(t,i){this.finishMergeBatches(),this.hA=i,this.currStaticRoot=t},i.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this.hA=null,this.switchBufferAccessor()},i.commitStaticBatch=function(t){this.wv.concat(t.drawBatchList),this.finishMergeBatches()},i.autoMergeBatches=function(t){if(this.kA)this.jA(t);else{var i=this.vA;if(i){var n,e=this.fA,r=this.hA;if(e&&e._isMeshBuffer)n=e.requestIA(this.device),-1===this.CA.indexOf(e)&&this.CA.push(e);else if(r){var s=this.oA,h=r.getMeshBuffer(s);if(!h)return;var u=h.indexOffset-this.aA;if(u<=0)return;this.aA,h.indexOffset,h.setDirty(),(n=h.requireFreeIA(this.device)).firstIndex=this.aA,n.indexCount=u,this.aA=h.indexOffset}if(this.oA=-1,n&&this.lA){var o=null,a=0;t&&(o=null!==t.customMaterial?FV.sharedManager.getStencilStage(t.stencilStage,i):FV.sharedManager.getStencilStage(t.stencilStage),a=FV.sharedManager.getStencilHash(t.stencilStage));var c=this.gA?this.gA._requireDrawBatch():this.BA.alloc();c.mp=this.yA,c.fp=this.lA,c.Ld=this.dA,c.pp=n,c.vp=this._A,c.dp=this.mA,c.gp=this.pA,c.bp(i,o,a,null),this.wv.push(c)}}}},i.jA=function(t){var i,n;t.stencilStage=FV.sharedManager.stage,n=null!==t.customMaterial?FV.sharedManager.getStencilStage(t.stencilStage,this.vA):FV.sharedManager.getStencilStage(t.stencilStage),i=FV.sharedManager.getStencilHash(t.stencilStage);var e=this.gA?this.gA._requireDrawBatch():this.BA.alloc();e.mp=t.node.layer;var r=this.SA.requireFreeIA(this.device);r.firstIndex=this.OA,r.indexCount=this.RA,e.pp=r,e.vp=this._A,e.fp=this.lA,e.Ld=this.dA,e.dp=this.mA,e.gp=this.pA,e.bp(this.vA||null,n,i,null),this.wv.push(e),this.kA=!1,this.SA=null},i.forceMergeBatches=function(t,i,n){this.vA=t,i?(this.lA=i.getGFXTexture(),this.dA=i.getGFXSampler(),this.mA=i.getHash(),this.pA=this.dA.hash):(this.lA=this.dA=null,this.mA=this.pA=0),this.yA=n.node.layer,this.autoMergeBatches(n)},i.resetRenderStates=function(){this.vA=this.cA,this.fA=null,this.lA=null,this.wA=null,this._A=null,this.mA=0,this.pA=0,this.yA=0},i.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},i.flushMaterial=function(t){this.vA=t},i.walk=function(t,i){if(void 0===i&&(i=0),t.activeInHierarchy){var n=t.children,e=t._uiProps,r=e.uiComp,s=this.IA,h=s,u=r&&r.color?r.color.a/255:1;if(this.IA=h*=u*e.localOpacity,e.gs(h),!Zn(h,0,qn)){if(e.colorDirty&&this.MA++,r&&r.enabledInHierarchy&&r.fillBuffers(this),this.MA&&r&&!r.useVertexOpacity&&r.renderData&&r.renderData.vertexCount>0){Wg(r.renderData,h);var o=r.renderData.getMeshBuffer();o&&o.setDirty()}if(n.length>0&&!t._static)for(var a=0;a<n.length;++a){var c=n[a];this.walk(c,i)}e.colorDirty&&(this.MA--,e.colorDirty=!1)}this.IA=s,r&&r.enabledInHierarchy&&(r.postUpdateAssembler(this),(2===r.stencilStage||6===r.stencilStage)&&FV.sharedManager.getMaskStackSize()>0&&(this.autoMergeBatches(this.wA),this.resetRenderStates(),FV.sharedManager.exitMask())),i+=1}},i.UA=function(t,i){return t.node.siblingIndex-i.node.siblingIndex},i.tr=function(t){this.NA.HA(t)},i.VA=function(){if(!this.LA){this.FA=uk.get("default-clear-stencil"),this.LA=k.director.root.createModel(jM);var t=EB(wB),i=Hg.gfxDevice,n=i.createBuffer(new ud(10,1,4*t,t)),e=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(e);var r=i.createBuffer(new ud(6,1,12,2)),s=new Uint16Array([0,1,2,2,1,3]);r.update(s),this.PA=new qC([n],wB,7,r),this.PA.subMeshIdx=0,this.LA.initSubModel(0,this.PA,this.FA)}},i.GA=function(t){this.autoMergeBatches(this.wA),this.resetRenderStates(),this.VA(),this.LA.node=this.LA.transform=t.node;var i=FV.sharedManager;i.pushMask(1);var n=i.clear(t),e=null,r=0,s=this.FA;s&&(e=i.getStencilStage(n,s),r=i.getStencilHash(n));var h=this.LA,u=k.director.getTotalFrames();h&&(h.updateTransform(u),h.updateUBOs(u));for(var o=0;o<h.subModels.length;o++){var a=this.BA.alloc(),c=h.subModels[o];a.mp=t.node.layer,a.cp=h,a.fp=null,a.Ld=null,a.vp=null,e||(e=null),a.bp(s,e,r,c.patches),a.pp=c.inputAssembler,a.cp.visFlags=a.mp,a.yp=c.descriptorSet,this.wv.push(a)}i.enableMask()},i.syncMeshBuffersToNative=function(){},e(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"currBufferAccessor",get:function(){return this.hA||(this.hA=this.switchBufferAccessor()),this.hA}},{key:"batches",get:function(){return this.wv}},{key:"currStaticRoot",set:function(t){this.gA=t}},{key:"currIsStatic",set:function(t){this.AA=t}}]),t}()),jV=function(){var t=i.prototype;function i(){this.$A=null,this.Fn=null,this.Ze=0,this.WA=0,this.yw=null,this.zA=!0;var t=Hg.gfxDevice;this.XA=new Float32Array(56),this.yw=t.createBuffer(new ud(18,3,224,224))}return t.xA=function(){return this.$A},t.Jr=function(t){var i=Hg.gfxDevice;this.Fn=t.vp,this.Ze=t.dp,this.WA=t.gp,UV.layout=t.passes[0].localSetLayout,this.$A=i.createDescriptorSet(UV),this.$A.bindBuffer(0,this.yw),this.$A.bindTexture(12,t.fp),this.$A.bindSampler(12,t.Ld),this.$A.update(),this.zA=!0},t.YA=function(t){t!==this.Fn&&(this.Fn=t,this.zA=!0,this.KA())},t.qA=function(t,i,n){return this.Fn===t&&this.Ze===i&&this.WA===n},t.QA=function(){this.Fn=null,this.Ze=0,this.WA=0},t.kg=function(){this.yw&&(this.yw.destroy(),this.yw=null),this.$A&&(this.$A.destroy(),this.$A=null),this.XA=null},t.ZA=function(){return this.Fn&&this.Fn.isValid},t.KA=function(){var t=this.Fn;if((t.hasChangedFlags||t.isTransformDirty())&&(t.updateWorldTransform(),this.zA=!0),this.zA){var i=t.worldMatrix;Kr.toArray(this.XA,i,0),Kr.invert(xV,i),Kr.transpose(xV,xV);var n=Kr.determinant(xV),e=1/Math.sqrt(n);Kr.multiplyScalar(xV,xV,e),Kr.toArray(this.XA,xV,16),this.yw.update(this.XA),this.zA=!1}},i}(),HV=function(){function t(){this.NA=new Map,this.JA=new Map,this.tE=[],this.iE=new uu((function(){return new jV}),16,(function(t){return t.kg()}))}var i=t.prototype;return i.xA=function(t){if(k.director.root,t.vp){for(var i=this.tE,n=0,e=i.length;n<e;n++){var r=i[n];if(r.qA(t.vp,t.dp,t.gp))return r.xA()}var s=this.iE.alloc();return s.Jr(t),this.tE.push(s),s.xA()}var h=t.dp^t.gp;if(this.NA.has(h))return this.NA.get(h);UV.layout=t.passes[0].localSetLayout;var u=Hg.gfxDevice.createDescriptorSet(UV);return u.bindTexture(12,t.fp),u.bindSampler(12,t.Ld),u.update(),this.NA.set(h,u),this.JA.set(t.dp,h),u},i.Mi=function(){var t=this.tE,i=t.length;if(0!==i){for(var n=[],e=0;e<i;e++){var r=t[e];if(r.ZA())r.KA();else{r.QA();var s=t.indexOf(r);n.push(s)}}for(var h=n.length-1;h>=0;h--){var u=n[h],o=t[u];t.splice(u,1),this.iE.free(o)}}},i.QA=function(){for(var t=this.tE,i=t.length,n=0;n<i;n++){var e=t[n];this.iE.free(e)}this.tE.length=0},i.HA=function(t){var i=this.JA.get(t);i&&this.NA.has(i)&&(this.NA.get(i).destroy(),this.NA.delete(i),this.JA.delete(t))},i.kg=function(){for(var t,i=d(this.NA.values());!(t=i()).done;)t.value.destroy();this.NA.clear(),this.JA.clear(),this.tE.length=0,this.iE.destroy()},t}();k.internal.Batcher2D=GV,t("UIDrawBatch",function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(UU)),wt(kB.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((function(t){return{name:t,suggest:"please use meshBuffer.accessor."+t+" instead"}}))),dt(kB.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),gt(kB.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),dt(GV.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),gt(VB.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),dt(VB.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("QuadRenderData",function(t){function i(i){var n;return n=t.call(this,i)||this,st(9006),n}return s(i,t),i}(VB)),k.UI={MeshBuffer:kB,spriteAssembler:LV,labelAssembler:HH,RenderData:HB,MeshRenderData:VB},UL.on(DL.EVENT_POST_SUBSYSTEM_INIT,(function(){KV.init()}));var VV,$V,WV,zV,XV,YV,KV=t("SortingLayers",function(){function t(){}return t.getSortingPriority=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),(t+32768<<16|i+32768)>>>0},t.getLayerIndex=function(t){void 0===t&&(t=0);var i=0;return this.nE.has(t)?i=this.nE.get(t):ut(2105),i},t.getLayerIndexByName=function(t){var i=this.getLayerByName(t);return this.getLayerIndex(i)},t.getLayerName=function(t){void 0===t&&(t=0);var i="";return this.eE.has(t)?i=this.eE.get(t):ut(2105),i},t.getLayerByName=function(t){for(var i=this.eE.size,n=this.eE.keys(),e=0,r=0;r<i;r++)if(e=n.next().value,this.eE.get(e)===t)return e;return ut(2106),0},t.isLayerValid=function(t){return!!this.nE.has(t)||(ut(2105),!1)},t.getBuiltinLayers=function(){return[{id:0,name:"default",value:0}]},t.init=function(){var i=xi.querySettings("engine","sortingLayers");i&&0!==i.length||(i=this.getBuiltinLayers()),t.rE();for(var n=0;n<i.length;n++){var e=i[n];t.setLayer(e.id,e.name,e.value),t.Enum[e.name]=e.id}Ni.update(t.Enum),Ni.sortList(t.Enum,(function(i,n){return t.getLayerIndex(i.value)-t.getLayerIndex(n.value)}))},t.setLayer=function(t,i,n){this.eE.set(t,i),this.nE.set(t,n)},t.rE=function(){for(var i=Object.keys(t.Enum),n=0;n<i.length;n++)delete t.Enum[t.Enum[i[n]]],delete t.Enum[i[n]];t.nE.clear(),t.eE.clear()},t}());KV.eE=new Map,KV.nE=new Map,KV.Enum=Ni({default:0}),t("Sorting",(VV=Ko("cc.Sorting"),$V=Ca(KV.Enum),VV(WV=Zo((m((zV=function(t){function i(){var i;return(i=t.call(this)||this)._sortingLayer=XV&&XV(),i._sortingOrder=YV&&YV(),i.sE=null,i}s(i,t);var n=i.prototype;return n.__preload=function(){this.sE=this.getComponent("cc.ModelRenderer"),this.sE||st(16301,this.node.name),this._updateSortingPriority()},n._updateSortingPriority=function(){var t=KV.getLayerIndex(this._sortingLayer),i=KV.getSortingPriority(t,this._sortingOrder);this.sE&&this.sE.isValid&&(this.sE.priority=i)},e(i,[{key:"sortingLayer",get:function(){return this._sortingLayer},set:function(t){t!==this._sortingLayer&&KV.isLayerValid(t)&&(this._sortingLayer=t,this._updateSortingPriority())}},{key:"sortingOrder",get:function(){return this._sortingOrder},set:function(t){t!==this._sortingOrder&&(this._sortingOrder=Jn(t,-32768,32767),this._updateSortingPriority())}}]),i}(w_)).prototype,"sortingLayer",[$V],Object.getOwnPropertyDescriptor(zV.prototype,"sortingLayer"),zV.prototype),XV=xo(zV.prototype,"_sortingLayer",[oa],(function(){return KV.Enum.default})),YV=xo(zV.prototype,"_sortingOrder",[oa],(function(){return 0})),WV=zV))||WV)||WV));var qV,QV,ZV,JV,t$,i$,n$,e$,r$,s$,h$,u$,o$,a$,c$,f$,v$,l$,d$,g$,w$,_$,m$,p$,y$,b$,A$,E$,k$,T$,S$,O$,R$,I$,M$,N$,C$,L$,F$,P$,B$,D$,U$=function(t){function i(){var i;return(i=t.call(this)||this).hE=null,i.uE=new Set,i}s(i,t);var n=i.prototype;return n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i);if(this.hE){var e=this.hE.requiredPatches(i);if(e)return e.concat(null!=n?n:[])}return n},n.initSubModel=function(i,n,e){return t.prototype.initSubModel.call(this,i,n,this.oE(e))},n.destroy=function(){t.prototype.destroy.call(this),this.hE=null},n.setSubModelMaterial=function(i,n){return t.prototype.setSubModelMaterial.call(this,i,this.oE(n))},n.setMorphRendering=function(t){this.hE=t},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n),this.hE&&this.hE.adaptPipelineState(i,n)},n.oE=function(t){return t},i}(jM),x$=t("ReflectionProbeType",{NONE:0,BAKED_CUBEMAP:1,PLANAR_REFLECTION:2,BLEND_PROBES:3,BLEND_PROBES_AND_SKYBOX:4}),G$=Ko,j$=Qo,H$=Ca,V$=aa,$$=oa,W$=ok("specular-pass");function z$(t){var i=t.passes,n=k.rendering;Ub()&&(W$=n.getPhaseID(n.getPassID("specular-pass"),"default"));for(var e=0;e<i.length;e++)if((!n||!n.enableEffectImport)&&i[e].phase===W$||Ub()&&i[e].phaseID===W$)return e;return-1}var X$,Y$,K$,q$,Q$,Z$,J$,tW,iW=Ni({OFF:0,ON:1}),nW=Ni({OFF:0,ON:1}),eW=(qV=G$("cc.ModelBakeSettings"),QV=V$("_recieveShadow"),ZV=H$(cn),JV=H$(vn),t$=H$(vn),i$=H$(Ni(x$)),n$=H$(vn),qV((g$=function(t){function i(){var i;return(i=t.call(this)||this).texture=s$&&s$(),i.uvParam=h$&&h$(),i._bakeable=u$&&u$(),i._castShadow=o$&&o$(),i._receiveShadow=a$&&a$(),i._lightmapSize=c$&&c$(),i._useLightProbe=f$&&f$(),i._bakeToLightProbe=v$&&v$(),i._reflectionProbeType=l$&&l$(),i._bakeToReflectionProbe=d$&&d$(),i.probeCubemap=null,i.probeBlendCubemap=null,i.probePlanarmap=null,i}return s(i,t),e(i,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}},{key:"useLightProbe",get:function(){return this._useLightProbe},set:function(t){this._useLightProbe=t,this.emit("use_light_probe_changed")}},{key:"bakeToLightProbe",get:function(){return this._bakeToLightProbe},set:function(t){this._bakeToLightProbe=t}},{key:"reflectionProbe",get:function(){return this._reflectionProbeType},set:function(t){this._reflectionProbeType=t,this.emit("reflection_probe_changed")}},{key:"bakeToReflectionProbe",get:function(){return this._bakeToReflectionProbe},set:function(t){this._bakeToReflectionProbe=t,this.emit("bake_to_reflection_probe_changed")}}]),i}(Ou),g$.USE_LIGHT_PROBE_CHANGED="use_light_probe_changed",g$.REFLECTION_PROBE_CHANGED="reflection_probe_changed",g$.BAKE_TO_REFLECTION_PROBE_CHANGED="bake_to_reflection_probe_changed",s$=xo((r$=g$).prototype,"texture",[$$],(function(){return null})),h$=xo(r$.prototype,"uvParam",[$$],(function(){return new De})),u$=xo(r$.prototype,"_bakeable",[$$],(function(){return!1})),o$=xo(r$.prototype,"_castShadow",[$$],(function(){return!1})),a$=xo(r$.prototype,"_receiveShadow",[QV],(function(){return!1})),c$=xo(r$.prototype,"_lightmapSize",[$$],(function(){return 64})),f$=xo(r$.prototype,"_useLightProbe",[$$],(function(){return!1})),v$=xo(r$.prototype,"_bakeToLightProbe",[$$],(function(){return!0})),l$=xo(r$.prototype,"_reflectionProbeType",[$$],(function(){return 0})),d$=xo(r$.prototype,"_bakeToReflectionProbe",[$$],(function(){return!0})),m(r$.prototype,"lightmapSize",[ZV],Object.getOwnPropertyDescriptor(r$.prototype,"lightmapSize"),r$.prototype),m(r$.prototype,"useLightProbe",[JV],Object.getOwnPropertyDescriptor(r$.prototype,"useLightProbe"),r$.prototype),m(r$.prototype,"bakeToLightProbe",[t$],Object.getOwnPropertyDescriptor(r$.prototype,"bakeToLightProbe"),r$.prototype),m(r$.prototype,"reflectionProbe",[i$],Object.getOwnPropertyDescriptor(r$.prototype,"reflectionProbe"),r$.prototype),m(r$.prototype,"bakeToReflectionProbe",[n$],Object.getOwnPropertyDescriptor(r$.prototype,"bakeToReflectionProbe"),r$.prototype),e$=r$))||e$),rW=(w$=G$("cc.MeshRenderer"),_$=j$(100),m$=H$(fn),p$=H$(fn),y$=H$(iW),b$=H$(nW),A$=H$(yF),E$=H$(vn),w$(k$=_$((D$=function(t){s(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).bakeSettings=S$&&S$(),i._mesh=O$&&O$(),i._shadowCastingMode=R$&&R$(),i._shadowReceivingMode=I$&&I$(),i._shadowBias=M$&&M$(),i._shadowNormalBias=N$&&N$(),i._reflectionProbeId=C$&&C$(),i._reflectionProbeBlendId=L$&&L$(),i._reflectionProbeBlendWeight=F$&&F$(),i._enabledGlobalStandardSkinObject=P$&&P$(),i._reflectionProbeDataMap=null,i.aE=[],i._modelType=jM,i._model=null,i.cE=null,i._enableMorph=B$&&B$(),xi.querySettings("rendering","highQualityMode")&&(i._shadowCastingMode=iW.ON,i.bakeSettings.castShadow=!0,i.bakeSettings.receiveShadow=!0),i}return i.onUpdateReceiveDirLight=function(t,i){void 0===i&&(i=!1),this._model&&(i?this._model.receiveDirLight=!1:this.node&&(t&this.node.layer)===this.node.layer||t&this._model.visFlags?this._model.receiveDirLight=!0:this._model.receiveDirLight=!1)},i.od=function(){this._enabledGlobalStandardSkinObject=!1},i.onLoad=function(){this._mesh&&this._mesh.initialize(),this.fE()||this.vE(),this.lE(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this.dE()},i.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this.dE()},i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on("mobility-changed",this.onMobilityChanged,this),this.node.on("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.on("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.on("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.on("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this),this._model||this._updateModels(),this._model.onGlobalPipelineStateChanged(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseLightProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData(),this.dE(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene(),this.node.off("mobility-changed",this.onMobilityChanged,this),this.node.off("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.off("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.off("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.off("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this)},i.onDestroy=function(){this._model&&(k.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this.cE&&this.cE.destroy()},i.onGeometryChanged=function(){if(this._model&&this._mesh){var t=this._mesh.struct;this._model.createBoundingShape(t.minPosition,t.maxPosition),this._model.updateWorldBound(),this._model.onGeometryChanged()}},i.getWeight=function(t,i){this.aE.length;var n=this.aE[t];return n.length,n[i]},i.setWeights=function(t,i){var n=this.aE;i>=n.length||n[i].length===t.length&&(n[i]=t.slice(0),this.gE(i))},i.setWeight=function(t,i,n){var e=this.aE;if(!(i>=e.length)){var r=e[i];n>=r.length||(r[n]=t,this.gE(i))}},i.setInstancedAttribute=function(t,i){if(this.model)for(var n=this.model.subModels,e=0;e<n.length;e++)for(var r=n[e].instancedAttributeBlock,s=r.attributes,h=r.views,u=0;u<s.length;u++)if(s[u].name===t){h[u].set(i);break}},i._updateLightmap=function(t,i,n,e,r){this.bakeSettings.texture=t,this.bakeSettings.uvParam.x=i,this.bakeSettings.uvParam.y=n,this.bakeSettings.uvParam.z=e,this.bakeSettings.uvParam.w=r,this._onUpdateLightingmap(),this._updateReceiveDirLight()},i.updateProbeCubemap=function(t){this.bakeSettings.probeCubemap&&this.bakeSettings.probeCubemap===t||(this.bakeSettings.probeCubemap=t,null!==this.model&&this.model.updateReflectionProbeCubemap(this.bakeSettings.probeCubemap))},i.updateProbeBlendCubemap=function(t){this.bakeSettings.probeBlendCubemap&&this.bakeSettings.probeBlendCubemap===t||(this.bakeSettings.probeBlendCubemap=t,null!==this.model&&this.model.updateReflectionProbeBlendCubemap(this.bakeSettings.probeBlendCubemap))},i.updateProbePlanarMap=function(t){this.bakeSettings.probePlanarmap!==t&&(this.bakeSettings.probePlanarmap=t,null!==this.model&&this.model.updateReflectionProbePlanarMap(this.bakeSettings.probePlanarmap))},i.updateReflectionProbeDataMap=function(t){this._reflectionProbeDataMap=t,null!==this.model&&this.model.updateReflectionProbeDataMap(t)},i.updateReflectionProbeId=function(t){this._reflectionProbeId=t,this.model&&(this.model.reflectionProbeId=t),this._onUpdateLocalShadowBiasAndProbeId()},i.updateReflectionProbeBlendId=function(t){this._reflectionProbeBlendId=t,this.model&&(this.model.reflectionProbeBlendId=t),this._onUpdateLocalShadowBiasAndProbeId()},i.updateReflectionProbeBlendWeight=function(t){this._reflectionProbeBlendWeight=t,this.model&&(this.model.reflectionProbeBlendWeight=t),this._onUpdateLocalReflectionProbeData()},i._updateReflectionProbeTexture=function(){if(this.model){var t=this.bakeSettings,i=t.reflectionProbe,n=t.probeBlendCubemap,e=t.probePlanarmap,r=t.probeCubemap;1===i?(this.model.updateReflectionProbeCubemap(r),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null)):3===i||4===i?(this.model.updateReflectionProbeCubemap(r),this.model.updateReflectionProbeBlendCubemap(n),this.model.updateReflectionProbePlanarMap(null)):2===i?(this.model.updateReflectionProbePlanarMap(e),this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbeBlendCubemap(null)):(this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null))}},i._updateModels=function(){if(this.enabledInHierarchy){var t=this._model;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model){if(this._mesh){var i=this._mesh.struct;this._model.createBoundingShape(i.minPosition,i.maxPosition),this._model.updateWorldBound()}this._model.initLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this._updateUseLightProbe(),this._updateUseReflectionProbeType(),this._updateModelParams(),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData()}}},i._updateReceiveDirLight=function(){if(this._model){var t=this.node.scene;if(t&&t.renderScene){var i=t.renderScene.mainLight;if(i){var n=i.visibility;if(i.node)if(i.node.mobility===xm.Static){var e=this.node.scene.globals,r=e.lightProbeInfo.data,s=!1;this.bakeSettings.texture&&!e.disableLightmap&&(s=!0),r&&r.hasCoefficients()&&this._model.useLightProbe&&(s=!0),this.onUpdateReceiveDirLight(n,s)}else this.onUpdateReceiveDirLight(n)}}}},i._createModel=function(){var t=this.cE&&this._modelType===jM?U$:this._modelType,i=this._model=k.director.root.createModel(t);i.visFlags=this.visibility,i.node=i.transform=this.node,this._models.length=0,this._models.push(i),this.cE&&i instanceof U$&&i.setMorphRendering(this.cE)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=1,this._model.transform.hasChangedFlags|=1,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,i=this._mesh.renderingSubMeshes;if(i)for(var n=0;n<t;++n){var e=this.getRenderMaterial(n);e&&!e.isValid&&(e=null);var r=i[n];r&&this._model.initSubModel(n,r,e||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.bakeSettings.uvParam.x,this.bakeSettings.uvParam.y,this.bakeSettings.uvParam.z,this.bakeSettings.uvParam.w])},i._onUpdateLocalShadowBiasAndProbeId=function(){null!==this.model&&(this.model.updateLocalShadowBias(),this.model.updateReflectionProbeId()),this.setInstancedAttribute("a_localShadowBiasAndProbeId",[this._shadowBias,this._shadowNormalBias,this._reflectionProbeId,this._reflectionProbeBlendId])},i._onUpdateLocalReflectionProbeData=function(){1!==this.bakeSettings.reflectionProbe&&3!==this.bakeSettings.reflectionProbe&&4!==this.bakeSettings.reflectionProbe||(null!==this.model&&this.model.updateReflectionProbeId(),this.setInstancedAttribute("a_reflectionProbeData",[this._reflectionProbeBlendWeight,0,0,0]))},i._onUpdateReflectionProbeDataMap=function(){null!==this.model&&this.model.updateReflectionProbeDataMap(this._reflectionProbeDataMap)},i._onMaterialModified=function(t,i){this._model&&this._model.inited&&(this.Pu(t,i||this._getBuiltinMaterial()),this.dE())},i.Pu=function(t,i){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,i),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateReflectionProbeTexture(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,i=0;i<t.length;++i)this._onMaterialModified(i,null)},i._getBuiltinMaterial=function(){return uk.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateShadowBias=function(){this._model&&(this._model.shadowBias=this._shadowBias)},i._updateShadowNormalBias=function(){this._model&&(this._model.shadowNormalBias=this._shadowNormalBias)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===iW.OFF?this._model.castShadow=!1:(this._shadowCastingMode,iW.ON,this._shadowCastingMode,this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===nW.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i.onMobilityChanged=function(){this._updateUseLightProbe(),this._updateReceiveDirLight()},i.onLightProbeBakingChanged=function(){this._updateReceiveDirLight()},i.onUseLightProbeChanged=function(){this._updateUseLightProbe()},i.onReflectionProbeChanged=function(){this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId();var t=k.internal.reflectionProbeManager,i=this._model;1===this.bakeSettings.reflectionProbe||3===this.bakeSettings.reflectionProbe||4===this.bakeSettings.reflectionProbe?(t.selectReflectionProbe(i),t.getUsedReflectionProbe(i,!1)||st(16302)):2===this.bakeSettings.reflectionProbe&&(t.wE(i),t.getUsedReflectionProbe(i,!0)||st(16302))},i.onBakeToReflectionProbeChanged=function(){this._updateBakeToReflectionProbe()},i._updateUseLightProbe=function(){if(this._model){var t=this.node;this._mesh&&t&&t.mobility===xm.Movable&&this.bakeSettings.useLightProbe?this._model.useLightProbe=!0:this._model.useLightProbe=!1}},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var i=this._materials[t];if(i)for(var n=0;n<i.passes.length;++n)if(i.passes[n].batchingScheme)return!0}return!1},i._updateUseReflectionProbe=function(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe,this._updateReflectionProbeTexture())},i._updateUseReflectionProbeType=function(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe)},i._updateBakeToReflectionProbe=function(){this._model&&(this._model.bakeToReflectionProbe=this.bakeSettings.bakeToReflectionProbe)},i.lE=function(){if(this.cE&&(this.cE.destroy(),this.cE=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this.cE=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,i=0;i<t;++i)this.gE(i);this._model&&this._model instanceof U$&&this._model.setMorphRendering(this.cE)}},i.vE=function(){var t=this._mesh;if(this.aE.length=0,t){var i=t.struct.morph;if(i){var n=i.weights;this.aE=i.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):n?(n.length,t.targets.length,n.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},i.fE=function(){var t=this._mesh,i=this.aE;if(!t||!t.struct.morph)return 0===i.length;var n=t.struct.morph;return n.subMeshMorphs.length===i.length&&i.every((function(t,i){var e,r,s=t.length;return(null!==(e=null==(r=n.subMeshMorphs[i])?void 0:r.targets.length)&&void 0!==e?e:0)===s}))},i.gE=function(t){var i;null==(i=this.cE)||i.setWeights(t,this.aE[t])},i.dE=function(){var t=qp();if(this._enabledGlobalStandardSkinObject&&(t.standardSkinMeshRenderer=this,t.standardSkinModel=this.model),!t.skinMaterialModel&&this._model)for(var i=this._model.subModels,n=0;n<i.length;n++)if(!(z$(i[n])<0))return void(t.skinMaterialModel=this._model)},e(n,[{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._updateShadowBias(),this._onUpdateLocalShadowBiasAndProbeId()}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._updateShadowNormalBias(),this._onUpdateLocalShadowBiasAndProbeId()}},{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"shadowCastingModeForInspector",get:function(){return this.shadowCastingMode===iW.ON},set:function(t){this.shadowCastingMode=!0===t?iW.ON:iW.OFF}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"receiveShadowForInspector",get:function(){return this._shadowReceivingMode===nW.ON},set:function(t){this._shadowReceivingMode=!0===t?nW.ON:nW.OFF,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var i=this._mesh,n=this._mesh=t;null==n||n.initialize(),this.vE(),this.lE(),this._onMeshChanged(i),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}},{key:"isGlobalStandardSkinObject",get:function(){return this._enabledGlobalStandardSkinObject},set:function(t){qp().standardSkinMeshRenderer=t?this:null,this._enabledGlobalStandardSkinObject=t}}]),n}(yj),D$.ShadowCastingMode=iW,D$.ShadowReceivingMode=nW,S$=xo((T$=D$).prototype,"bakeSettings",[$$],(function(){return new eW})),O$=xo(T$.prototype,"_mesh",[$$],(function(){return null})),R$=xo(T$.prototype,"_shadowCastingMode",[$$],(function(){return iW.OFF})),I$=xo(T$.prototype,"_shadowReceivingMode",[$$],(function(){return nW.ON})),M$=xo(T$.prototype,"_shadowBias",[$$],(function(){return 0})),N$=xo(T$.prototype,"_shadowNormalBias",[$$],(function(){return 0})),C$=xo(T$.prototype,"_reflectionProbeId",[$$],(function(){return-1})),L$=xo(T$.prototype,"_reflectionProbeBlendId",[$$],(function(){return-1})),F$=xo(T$.prototype,"_reflectionProbeBlendWeight",[$$],(function(){return 0})),P$=xo(T$.prototype,"_enabledGlobalStandardSkinObject",[$$],(function(){return!1})),m(T$.prototype,"shadowBias",[m$],Object.getOwnPropertyDescriptor(T$.prototype,"shadowBias"),T$.prototype),m(T$.prototype,"shadowNormalBias",[p$],Object.getOwnPropertyDescriptor(T$.prototype,"shadowNormalBias"),T$.prototype),m(T$.prototype,"shadowCastingMode",[y$],Object.getOwnPropertyDescriptor(T$.prototype,"shadowCastingMode"),T$.prototype),m(T$.prototype,"receiveShadow",[b$],Object.getOwnPropertyDescriptor(T$.prototype,"receiveShadow"),T$.prototype),m(T$.prototype,"mesh",[A$],Object.getOwnPropertyDescriptor(T$.prototype,"mesh"),T$.prototype),m(T$.prototype,"isGlobalStandardSkinObject",[E$],Object.getOwnPropertyDescriptor(T$.prototype,"isGlobalStandardSkinObject"),T$.prototype),B$=xo(T$.prototype,"_enableMorph",[$$],(function(){return!0})),k$=T$))||k$)||k$);function sW(t,i){var n=t.sharedMaterials.length;if(n!==i.sharedMaterials.length)return!1;for(var e=0;e<n;e++)if(t.getRenderMaterial(e)!==i.getRenderMaterial(e))return!1;return!0}t({MeshRenderer:rW,ModelComponent:rW}),t("BatchingUtility",function(){function t(){}return t.batchStaticModel=function(t,i){var n=t.getComponentsInChildren(rW);if(n.length<2)return console.error("the number of static models to batch is less than 2,it needn't batch."),!1;for(var e=1;e<n.length;e++){if(!n[0].mesh.validateMergingMesh(n[e].mesh))return console.error("the meshes of "+n[0].node.name+" and "+n[e].node.name+" can't be merged"),!1;if(!sW(n[0],n[e]))return console.error("the materials of "+n[0].node.name+" and "+n[e].node.name+" can't be merged"),!1}var r=new yF,s=new Kr,h=new Kr;t.getWorldMatrix(h),Kr.invert(h,h);for(var u=0;u<n.length;u++){var o=n[u];o.node.getWorldMatrix(s),Kr.multiply(s,h,s),r.merge(n[u].mesh,s),o.enabled=!1}var a=i.addComponent(rW);return a.mesh=r,a.sharedMaterials=n[0].sharedMaterials,!0},t.unbatchStaticModel=function(t,i){for(var n=t.getComponentsInChildren(rW),e=0;e<n.length;e++)n[e].enabled=!0;var r=i.getComponent(rW);return r&&(r.mesh&&r.mesh.destroyRenderingMesh(),r.destroy()),!0},t}()),dt(yF.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),gt(yF.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);var hW,uW,oW,aW,cW,fW,vW,lW,dW,gW,wW,_W,mW,pW,yW,bW,AW=t("Skeleton",(X$=Ko("cc.Skeleton"),Y$=Ca([ln]),K$=Ca([Kr]),X$((Q$=function(t){function i(i){var n;return(n=t.call(this,i)||this)._joints=Z$&&Z$(),n._bindposes=J$&&J$(),n._hash=tW&&tW(),n._E=null,n}s(i,t);var n=i.prototype;return n.destroy=function(){var i,n;return null==(i=k.director.root)||null==(n=i.dataPoolManager)||n.releaseSkeleton(this),t.prototype.destroy.call(this)},n.validate=function(){return this.joints.length>0&&this.bindposes.length>0},e(i,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._E){this._E=[];for(var t=0;t<this._bindposes.length;t++){var i=new Kr;Kr.invert(i,this._bindposes[t]),this._E.push(i)}}return this._E}},{key:"hash",get:function(){if(!this._hash){for(var t="",i=0;i<this._bindposes.length;i++){var n=this._bindposes[i];t+=n.m00.toPrecision(2)+" "+n.m01.toPrecision(2)+" "+n.m02.toPrecision(2)+" "+n.m03.toPrecision(2)+" "+n.m04.toPrecision(2)+" "+n.m05.toPrecision(2)+" "+n.m06.toPrecision(2)+" "+n.m07.toPrecision(2)+" "+n.m08.toPrecision(2)+" "+n.m09.toPrecision(2)+" "+n.m10.toPrecision(2)+" "+n.m11.toPrecision(2)+" "+n.m12.toPrecision(2)+" "+n.m13.toPrecision(2)+" "+n.m14.toPrecision(2)+" "+n.m15.toPrecision(2)+"\n"}this._hash=Wv(t,666)}return this._hash}}]),i}(kw),Z$=xo(Q$.prototype,"_joints",[Y$],(function(){return[]})),J$=xo(Q$.prototype,"_bindposes",[K$],(function(){return[]})),tW=xo(Q$.prototype,"_hash",[oa],(function(){return 0})),q$=Q$))||q$));k.Skeleton=AW,gt(rW.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),k.ModelComponent=rW,ai(rW,"cc.ModelComponent");var EW,kW,TW,SW,OW,RW,IW,MW,NW,CW,LW,FW,PW,BW,DW,UW,xW,GW,jW,HW,VW,$W,WW,zW,XW,YW,KW,qW,QW,ZW,JW,tz,iz,nz,ez,rz,sz,hz,uz,oz,az,cz,fz,vz,lz,dz,gz,wz,_z,mz,pz,yz,bz,Az,Ez,kz,Tz,Sz,Oz,Rz,Iz=new ir,Mz=Ni({LUMINOUS_FLUX:0,LUMINANCE:1}),Nz=Ko("cc.StaticLightSettings")((uW=function(){function t(){this._baked=oW&&oW(),this._editorOnly=aW&&aW(),this._castShadow=cW&&cW()}return e(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),oW=xo(uW.prototype,"_baked",[oa],(function(){return!1})),aW=xo(uW.prototype,"_editorOnly",[oa],(function(){return!1})),cW=xo(uW.prototype,"_castShadow",[oa],(function(){return!1})),hW=uW))||hW,Cz=(fW=Ko("cc.Light"),vW=Ca(Nz),lW=Ca(Pm.BitMask),fW((bW=function(t){function i(){var i;return(i=t.call(this)||this)._color=wW&&wW(),i._useColorTemperature=_W&&_W(),i._colorTemperature=mW&&mW(),i._staticSettings=pW&&pW(),i._visibility=yW&&yW(),i._type=5,i._lightType=void 0,i._light=null,i._lightType=YM,i}s(i,t);var n=i.prototype;return n.onLoad=function(){this._createLight()},n.onEnable=function(){this._attachToScene()},n.onDisable=function(){this._detachFromScene()},n.onDestroy=function(){this._destroyLight()},n._createLight=function(){this._light||(this._light=k.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked,this._light.visibility=this.visibility},n._destroyLight=function(){this._light&&(k.director.root.recycleLight(this._light),this._light=null)},n._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case 0:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case 1:t.addSphereLight(this._light);break;case 2:t.addSpotLight(this._light);break;case 3:t.addPointLight(this._light);break;case 4:t.addRangedDirLight(this._light)}}},n._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case 0:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case 1:t.removeSphereLight(this._light);break;case 2:t.removeSpotLight(this._light);break;case 3:t.removePointLight(this._light);break;case 4:t.removeRangedDirLight(this._light)}}},n._onUpdateReceiveDirLight=function(){},e(i,[{key:"color",get:function(){return this._color},set:function(t){this._color=t.clone(),this._light&&(Iz.x=t.r/255,Iz.y=t.g/255,Iz.z=t.b/255,this._light.color=Iz)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}},{key:"baked",get:function(){return this.staticSettings.baked},set:function(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._light&&(this._light.visibility=t),this._onUpdateReceiveDirLight()}}]),i}(w_),bW.Type=zM,bW.PhotometricTerm=Mz,wW=xo((gW=bW).prototype,"_color",[oa],(function(){return cr.WHITE.clone()})),_W=xo(gW.prototype,"_useColorTemperature",[oa],(function(){return!1})),mW=xo(gW.prototype,"_colorTemperature",[oa],(function(){return 6550})),pW=xo(gW.prototype,"_staticSettings",[oa],(function(){return new Nz})),yW=xo(gW.prototype,"_visibility",[oa],(function(){return Lb})),m(gW.prototype,"staticSettings",[vW],Object.getOwnPropertyDescriptor(gW.prototype,"staticSettings"),gW.prototype),m(gW.prototype,"visibility",[lW],Object.getOwnPropertyDescriptor(gW.prototype,"visibility"),gW.prototype),dW=gW))||dW);t({Light:Cz,LightComponent:Cz});var Lz,Fz,Pz,Bz,Dz,Uz,xz,Gz,jz,Hz,Vz,$z,Wz,zz,Xz=Jo,Yz=oa,Kz=aa,qz=Ca,Qz=(EW=Ko("cc.DirectionalLight"),kW=Kz("_illuminance"),TW=qz(cn),SW=Xz({group:{name:"DynamicShadowSettings",displayOrder:1}}),OW=qz(vn),RW=Xz({group:{name:"DynamicShadowSettings",displayOrder:5}}),IW=qz(Bk),MW=Xz({group:{name:"DynamicShadowSettings",displayOrder:6}}),NW=qz(fn),CW=Xz({group:{name:"DynamicShadowSettings",displayOrder:7}}),LW=qz(fn),FW=Xz({group:{name:"DynamicShadowSettings",displayOrder:8}}),PW=qz(fn),BW=Xz({group:{name:"DynamicShadowSettings",displayOrder:9}}),DW=qz(fn),UW=Xz({group:{name:"DynamicShadowSettings",displayOrder:22}}),xW=qz(fn),GW=Xz({group:{name:"DynamicShadowSettings",displayOrder:10}}),jW=qz(Dk),HW=Xz({group:{name:"DynamicShadowSettings",displayOrder:11}}),VW=qz(vn),$W=Xz({group:{name:"DynamicShadowSettings",displayOrder:12}}),WW=qz(fn),zW=Xz({group:{name:"DynamicShadowSettings",displayOrder:13}}),XW=qz(Uk),YW=Xz({group:{name:"DynamicShadowSettings",displayOrder:14}}),KW=qz(vn),qW=Xz({group:{name:"DynamicShadowSettings",displayOrder:15}}),QW=qz(fn),ZW=Xz({group:{name:"DynamicShadowSettings",displayOrder:16}}),JW=qz(fn),tz=Xz({group:{name:"DynamicShadowSettings",displayOrder:17}}),iz=qz(fn),nz=Xz({group:{name:"DynamicShadowSettings",displayOrder:19}}),ez=qz(vn),rz=Xz({group:{name:"DynamicShadowSettings",displayOrder:20}}),sz=qz(vn),hz=Xz({group:{name:"DynamicShadowSettings",displayOrder:21}}),uz=qz(fn),EW((az=function(t){function i(){var i;return(i=t.call(this)||this)._illuminanceHDR=cz&&cz(),i._illuminanceLDR=fz&&fz(),i._shadowEnabled=vz&&vz(),i._shadowPcf=lz&&lz(),i._shadowBias=dz&&dz(),i._shadowNormalBias=gz&&gz(),i._shadowSaturation=wz&&wz(),i._shadowDistance=_z&&_z(),i._shadowInvisibleOcclusionRange=mz&&mz(),i._csmLevel=pz&&pz(),i._csmLayerLambda=yz&&yz(),i._csmOptimizationMode=bz&&bz(),i._csmAdvancedOptions=Az&&Az(),i._csmLayersTransition=Ez&&Ez(),i._csmTransitionRange=kz&&kz(),i._shadowFixedArea=Tz&&Tz(),i._shadowNear=Sz&&Sz(),i._shadowFar=Oz&&Oz(),i._shadowOrthoSize=Rz&&Rz(),i._lightType=QM,xi.querySettings("rendering","highQualityMode")&&(i._shadowPcf=Bk.SOFT_2X,i._shadowDistance=50,i.enableCSM=!0,i.staticSettings.castShadow=!0),i}s(i,t);var n=i.prototype;return n._createLight=function(){if(t.prototype._createLight.call(this),this._type=0,this._light){var i=this._light;i.illuminanceHDR=this._illuminanceHDR,i.illuminanceLDR=this._illuminanceLDR,i.shadowEnabled=this._shadowEnabled,i.shadowPcf=this._shadowPcf,i.shadowBias=this._shadowBias,i.shadowNormalBias=this._shadowNormalBias,i.shadowSaturation=this._shadowSaturation,i.shadowDistance=this._shadowDistance,i.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange,i.shadowFixedArea=this._shadowFixedArea,i.shadowNear=this._shadowNear,i.shadowFar=this._shadowFar,i.shadowOrthoSize=this._shadowOrthoSize,i.csmLevel=this._csmLevel,i.csmLayerLambda=this._csmLayerLambda,i.csmOptimizationMode=this._csmOptimizationMode,i.csmLayersTransition=this._csmLayersTransition,i.csmTransitionRange=this._csmTransitionRange}},n._onUpdateReceiveDirLight=function(){if(this._light){t.prototype._onUpdateReceiveDirLight.call(this);var i=this.node.scene;if(i&&i.renderScene&&i.renderScene.mainLight===this._light)for(var n=i.renderScene.models,e=0;e<n.length;e++){var r=n[e];if(r.node){var s=r.node.getComponent(rW);s&&s.onUpdateReceiveDirLight(this._visibility)}}}},e(i,[{key:"illuminance",get:function(){return qp().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){qp().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=this._shadowEnabled)}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=this._shadowPcf)}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._light&&(this._light.shadowBias=this._shadowBias)}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=this._shadowNormalBias)}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=Jn(t,0,1),this._light&&(this._light.shadowSaturation=this._shadowSaturation)}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,Gk.MAX_FAR),this._shadowDistance/.1<10&&st(15003,this._shadowDistance),this._light&&(this._light.shadowDistance=this._shadowDistance,this._light.csmNeedUpdate=!0)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,Gk.MAX_FAR),this._light&&(this._light.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange)}},{key:"csmLevel",get:function(){return this._csmLevel},set:function(t){this._csmLevel=t,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}},{key:"enableCSM",get:function(){return this._csmLevel>Dk.LEVEL_1},set:function(t){this._csmLevel=t?Dk.LEVEL_4:Dk.LEVEL_1,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}},{key:"csmLayerLambda",get:function(){return this._csmLayerLambda},set:function(t){this._csmLayerLambda=t,this._light&&(this._light.csmLayerLambda=this._csmLayerLambda,this._light.csmNeedUpdate=!0)}},{key:"csmOptimizationMode",get:function(){return this._csmOptimizationMode},set:function(t){this._csmOptimizationMode=t,this._light&&(this._light.csmOptimizationMode=this._csmOptimizationMode)}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t,this._light&&(this._light.shadowFixedArea=this._shadowFixedArea)}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t,this._light&&(this._light.shadowNear=this._shadowNear)}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,Gk.MAX_FAR),this._light&&(this._light.shadowFar=this._shadowFar)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t,this._light&&(this._light.shadowOrthoSize=this._shadowOrthoSize)}},{key:"csmAdvancedOptions",get:function(){return this._csmAdvancedOptions},set:function(t){this._csmAdvancedOptions=t}},{key:"csmLayersTransition",get:function(){return this._csmLayersTransition},set:function(t){this._csmLayersTransition=t,this._light&&(this._light.csmLayersTransition=t)}},{key:"csmTransitionRange",get:function(){return this._csmTransitionRange},set:function(t){this._csmTransitionRange=t,this._light&&(this._light.csmTransitionRange=t)}}]),i}(Cz),cz=xo(az.prototype,"_illuminanceHDR",[Xz,kW],(function(){return 65e3})),fz=xo(az.prototype,"_illuminanceLDR",[Yz],(function(){return 65e3*MM.standardExposureValue})),vz=xo(az.prototype,"_shadowEnabled",[Yz],(function(){return!1})),lz=xo(az.prototype,"_shadowPcf",[Yz],(function(){return Bk.HARD})),dz=xo(az.prototype,"_shadowBias",[Yz],(function(){return 1e-5})),gz=xo(az.prototype,"_shadowNormalBias",[Yz],(function(){return 0})),wz=xo(az.prototype,"_shadowSaturation",[Yz],(function(){return 1})),_z=xo(az.prototype,"_shadowDistance",[Yz],(function(){return 50})),mz=xo(az.prototype,"_shadowInvisibleOcclusionRange",[Yz],(function(){return 200})),pz=xo(az.prototype,"_csmLevel",[Yz],(function(){return Dk.LEVEL_4})),yz=xo(az.prototype,"_csmLayerLambda",[Yz],(function(){return.75})),bz=xo(az.prototype,"_csmOptimizationMode",[Yz],(function(){return Uk.RemoveDuplicates})),Az=xo(az.prototype,"_csmAdvancedOptions",[Yz],(function(){return!1})),Ez=xo(az.prototype,"_csmLayersTransition",[Yz],(function(){return!1})),kz=xo(az.prototype,"_csmTransitionRange",[Yz],(function(){return.05})),Tz=xo(az.prototype,"_shadowFixedArea",[Yz],(function(){return!1})),Sz=xo(az.prototype,"_shadowNear",[Yz],(function(){return.1})),Oz=xo(az.prototype,"_shadowFar",[Yz],(function(){return 10})),Rz=xo(az.prototype,"_shadowOrthoSize",[Yz],(function(){return 5})),m(az.prototype,"illuminance",[TW],Object.getOwnPropertyDescriptor(az.prototype,"illuminance"),az.prototype),m(az.prototype,"shadowEnabled",[SW,OW],Object.getOwnPropertyDescriptor(az.prototype,"shadowEnabled"),az.prototype),m(az.prototype,"shadowPcf",[RW,IW],Object.getOwnPropertyDescriptor(az.prototype,"shadowPcf"),az.prototype),m(az.prototype,"shadowBias",[MW,NW],Object.getOwnPropertyDescriptor(az.prototype,"shadowBias"),az.prototype),m(az.prototype,"shadowNormalBias",[CW,LW],Object.getOwnPropertyDescriptor(az.prototype,"shadowNormalBias"),az.prototype),m(az.prototype,"shadowSaturation",[FW,PW],Object.getOwnPropertyDescriptor(az.prototype,"shadowSaturation"),az.prototype),m(az.prototype,"shadowDistance",[BW,DW],Object.getOwnPropertyDescriptor(az.prototype,"shadowDistance"),az.prototype),m(az.prototype,"shadowInvisibleOcclusionRange",[UW,xW],Object.getOwnPropertyDescriptor(az.prototype,"shadowInvisibleOcclusionRange"),az.prototype),m(az.prototype,"csmLevel",[GW,jW],Object.getOwnPropertyDescriptor(az.prototype,"csmLevel"),az.prototype),m(az.prototype,"enableCSM",[HW,VW],Object.getOwnPropertyDescriptor(az.prototype,"enableCSM"),az.prototype),m(az.prototype,"csmLayerLambda",[$W,WW],Object.getOwnPropertyDescriptor(az.prototype,"csmLayerLambda"),az.prototype),m(az.prototype,"csmOptimizationMode",[zW,XW],Object.getOwnPropertyDescriptor(az.prototype,"csmOptimizationMode"),az.prototype),m(az.prototype,"shadowFixedArea",[YW,KW],Object.getOwnPropertyDescriptor(az.prototype,"shadowFixedArea"),az.prototype),m(az.prototype,"shadowNear",[qW,QW],Object.getOwnPropertyDescriptor(az.prototype,"shadowNear"),az.prototype),m(az.prototype,"shadowFar",[ZW,JW],Object.getOwnPropertyDescriptor(az.prototype,"shadowFar"),az.prototype),m(az.prototype,"shadowOrthoSize",[tz,iz],Object.getOwnPropertyDescriptor(az.prototype,"shadowOrthoSize"),az.prototype),m(az.prototype,"csmAdvancedOptions",[nz,ez],Object.getOwnPropertyDescriptor(az.prototype,"csmAdvancedOptions"),az.prototype),m(az.prototype,"csmLayersTransition",[rz,sz],Object.getOwnPropertyDescriptor(az.prototype,"csmLayersTransition"),az.prototype),m(az.prototype,"csmTransitionRange",[hz,uz],Object.getOwnPropertyDescriptor(az.prototype,"csmTransitionRange"),az.prototype),oz=az))||oz);t({DirectionalLight:Qz,DirectionalLightComponent:Qz});var Zz,Jz,tX,iX,nX,eX,rX,sX,hX,uX,oX,aX,cX,fX,vX,lX,dX,gX,wX,_X,mX,pX,yX,bX,AX,EX=(Lz=Ko("cc.SphereLight"),Fz=aa("_luminance"),Pz=Ca(cn),Bz=Ca(cn),Dz=Ca(Mz),Uz=Ca(fn),xz=Ca(fn),Lz((jz=function(t){function i(){var i;return(i=t.call(this)||this)._size=Hz&&Hz(),i._luminanceHDR=Vz&&Vz(),i._luminanceLDR=$z&&$z(),i._term=Wz&&Wz(),i._range=zz&&zz(),i._lightType=ZM,i}return s(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=1,this.size=this._size,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)},e(i,[{key:"luminousFlux",get:function(){return qp().isHDR?this._luminanceHDR*XM(this._size):this._luminanceLDR},set:function(t){var i=0;qp().isHDR?(this._luminanceHDR=t/XM(this._size),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return qp().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){qp().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),i}(Cz),Hz=xo(jz.prototype,"_size",[oa],(function(){return.15})),Vz=xo(jz.prototype,"_luminanceHDR",[oa,Fz],(function(){return 1700/XM(.15)})),$z=xo(jz.prototype,"_luminanceLDR",[oa],(function(){return 1700/XM(.15)*MM.standardExposureValue*MM.standardLightMeterScale})),Wz=xo(jz.prototype,"_term",[oa],(function(){return Mz.LUMINOUS_FLUX})),zz=xo(jz.prototype,"_range",[oa],(function(){return 1})),m(jz.prototype,"luminousFlux",[Pz],Object.getOwnPropertyDescriptor(jz.prototype,"luminousFlux"),jz.prototype),m(jz.prototype,"luminance",[Bz],Object.getOwnPropertyDescriptor(jz.prototype,"luminance"),jz.prototype),m(jz.prototype,"term",[Dz],Object.getOwnPropertyDescriptor(jz.prototype,"term"),jz.prototype),m(jz.prototype,"size",[Uz],Object.getOwnPropertyDescriptor(jz.prototype,"size"),jz.prototype),m(jz.prototype,"range",[xz],Object.getOwnPropertyDescriptor(jz.prototype,"range"),jz.prototype),Gz=jz))||Gz);t({SphereLight:EX,SphereLightComponent:EX});var kX,TX,SX,OX,RX,IX,MX,NX,CX,LX,FX,PX,BX,DX,UX,xX,GX,jX,HX,VX=Ca,$X=oa,WX=aa,zX=Jo,XX=(Zz=Ko("cc.SpotLight"),Jz=WX("_luminance"),tX=VX(Mz),iX=VX(fn),nX=zX({group:{name:"DynamicShadowSettings",displayOrder:1}}),eX=VX(vn),rX=zX({group:{name:"DynamicShadowSettings",displayOrder:2}}),sX=VX(Bk),hX=zX({group:{name:"DynamicShadowSettings",displayOrder:3}}),uX=VX(fn),oX=zX({group:{name:"DynamicShadowSettings",displayOrder:4}}),aX=VX(fn),Zz((fX=function(t){function i(){var i;return(i=t.call(this)||this)._size=vX&&vX(),i._luminanceHDR=lX&&lX(),i._luminanceLDR=dX&&dX(),i._term=gX&&gX(),i._range=wX&&wX(),i._spotAngle=_X&&_X(),i._angleAttenuationStrength=mX&&mX(),i._shadowEnabled=pX&&pX(),i._shadowPcf=yX&&yX(),i._shadowBias=bX&&bX(),i._shadowNormalBias=AX&&AX(),i._lightType=sN,i}return s(i,t),i.prototype._createLight=function(){if(t.prototype._createLight.call(this),this._type=2,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle,this.angleAttenuationStrength=this._angleAttenuationStrength,this._light){var i=this._light;i.luminanceHDR=this._luminanceHDR,i.luminanceLDR=this._luminanceLDR,i.shadowEnabled=this._shadowEnabled,i.shadowPcf=this._shadowPcf,i.shadowBias=this._shadowBias,i.shadowNormalBias=this._shadowNormalBias}},e(i,[{key:"luminousFlux",get:function(){return qp().isHDR?this._luminanceHDR*XM(this._size):this._luminanceLDR},set:function(t){var i=0;qp().isHDR?(this._luminanceHDR=t/XM(this._size),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return qp().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){qp().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=ne(t))}},{key:"angleAttenuationStrength",get:function(){return this._angleAttenuationStrength},set:function(t){this._angleAttenuationStrength=t,this._light&&(this._light.angleAttenuationStrength=t)}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=t)}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=t)}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._light&&(this._light.shadowBias=t)}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=t)}}]),i}(Cz),vX=xo(fX.prototype,"_size",[$X],(function(){return.15})),lX=xo(fX.prototype,"_luminanceHDR",[$X,Jz],(function(){return 1700/XM(.15)})),dX=xo(fX.prototype,"_luminanceLDR",[$X],(function(){return 1700/XM(.15)*MM.standardExposureValue*MM.standardLightMeterScale})),gX=xo(fX.prototype,"_term",[$X],(function(){return Mz.LUMINOUS_FLUX})),wX=xo(fX.prototype,"_range",[$X],(function(){return 1})),_X=xo(fX.prototype,"_spotAngle",[$X],(function(){return 60})),mX=xo(fX.prototype,"_angleAttenuationStrength",[$X],(function(){return 0})),pX=xo(fX.prototype,"_shadowEnabled",[$X],(function(){return!1})),yX=xo(fX.prototype,"_shadowPcf",[$X],(function(){return Bk.HARD})),bX=xo(fX.prototype,"_shadowBias",[$X],(function(){return 1e-5})),AX=xo(fX.prototype,"_shadowNormalBias",[$X],(function(){return 0})),m(fX.prototype,"term",[tX],Object.getOwnPropertyDescriptor(fX.prototype,"term"),fX.prototype),m(fX.prototype,"size",[iX],Object.getOwnPropertyDescriptor(fX.prototype,"size"),fX.prototype),m(fX.prototype,"shadowEnabled",[nX,eX],Object.getOwnPropertyDescriptor(fX.prototype,"shadowEnabled"),fX.prototype),m(fX.prototype,"shadowPcf",[rX,sX],Object.getOwnPropertyDescriptor(fX.prototype,"shadowPcf"),fX.prototype),m(fX.prototype,"shadowBias",[hX,uX],Object.getOwnPropertyDescriptor(fX.prototype,"shadowBias"),fX.prototype),m(fX.prototype,"shadowNormalBias",[oX,aX],Object.getOwnPropertyDescriptor(fX.prototype,"shadowNormalBias"),fX.prototype),cX=fX))||cX);t({SpotLight:XX,SpotLightComponent:XX}),t("PointLight",(kX=Ko("cc.PointLight"),TX=aa("_luminance"),SX=Ca(cn),OX=Ca(cn),RX=Ca(Mz),IX=Ca(fn),kX((NX=function(t){function i(){var i;return(i=t.call(this)||this)._luminanceHDR=CX&&CX(),i._luminanceLDR=LX&&LX(),i._term=FX&&FX(),i._range=PX&&PX(),i._lightType=hN,i}return s(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=3,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)},e(i,[{key:"luminousFlux",get:function(){return qp().isHDR?this._luminanceHDR*XM(1):this._luminanceLDR},set:function(t){var i=0;qp().isHDR?(this._luminanceHDR=t/XM(1),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return qp().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){qp().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),i}(Cz),CX=xo(NX.prototype,"_luminanceHDR",[oa,TX],(function(){return 1700/XM(.15)})),LX=xo(NX.prototype,"_luminanceLDR",[oa],(function(){return 1700/XM(.15)*MM.standardExposureValue*MM.standardLightMeterScale})),FX=xo(NX.prototype,"_term",[oa],(function(){return Mz.LUMINOUS_FLUX})),PX=xo(NX.prototype,"_range",[oa],(function(){return 1})),m(NX.prototype,"luminousFlux",[SX],Object.getOwnPropertyDescriptor(NX.prototype,"luminousFlux"),NX.prototype),m(NX.prototype,"luminance",[OX],Object.getOwnPropertyDescriptor(NX.prototype,"luminance"),NX.prototype),m(NX.prototype,"term",[RX],Object.getOwnPropertyDescriptor(NX.prototype,"term"),NX.prototype),m(NX.prototype,"range",[IX],Object.getOwnPropertyDescriptor(NX.prototype,"range"),NX.prototype),MX=NX))||MX)),t("RangedDirectionalLight",(BX=Ko("cc.RangedDirectionalLight"),DX=aa("_illuminance"),UX=Ca(cn),BX((GX=function(t){function i(){var i;return(i=t.call(this)||this)._illuminanceHDR=jX&&jX(),i._illuminanceLDR=HX&&HX(),i._lightType=oN,i}return s(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=4,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR,this._light.illuminanceLDR=this._illuminanceLDR)},e(i,[{key:"illuminance",get:function(){return qp().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){qp().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}}]),i}(Cz),jX=xo(GX.prototype,"_illuminanceHDR",[Jo,DX],(function(){return 65e3})),HX=xo(GX.prototype,"_illuminanceLDR",[oa],(function(){return 65e3*MM.standardExposureValue})),m(GX.prototype,"illuminance",[UX],Object.getOwnPropertyDescriptor(GX.prototype,"illuminance"),GX.prototype),xX=GX))||xX)),k.LightComponent=Cz,ai(Cz,"cc.LightComponent"),k.DirectionalLightComponent=Qz,ai(Qz,"cc.DirectionalLightComponent"),k.SphereLightComponent=EX,ai(EX,"cc.SphereLightComponent"),k.SpotLightComponent=XX,ai(XX,"cc.SpotLightComponent"),dt(XX.prototype,"SpotLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter:function(){return this.luminousFlux},customSetter:function(t){this.luminousFlux=t}}]),dt(EX.prototype,"SphereLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter:function(){return this.luminousFlux},customSetter:function(t){this.luminousFlux=t}}]),dt(Cz.PhotometricTerm,"Light.PhotometricTerm",[{name:"LUMINOUS_POWER",newName:"LUMINOUS_FLUX"}]);var YX=Symbol("BakeNodeCurves"),KX=function(){function t(){}return t.getOrExtract=function(i){var n=t.n_.get(i);if(!n||n.samples!==i.sample){n&&k.director.root.dataPoolManager.releaseAnimationClip(i);var e=Math.ceil(i.sample*i.duration)+1,r=i.sample;n=i[YX](0,r,e),t.n_.set(i,n)}return n},t.destroy=function(i){t.n_.delete(i)},t}();KX.n_=new Map;var qX=new Kr;function QX(t,i,n){for(Kr.identity(n);t!==i;)Kr.fromRTS(qX,t.rotation,t.position,t.scale),Kr.multiply(n,qX,n),t=t.parent;return n}var ZX=new dd(1,1,0,2,2,2),JX=function(t,i,n){t[i+0]=n.m00,t[i+1]=n.m01,t[i+2]=n.m02,t[i+3]=n.m12,t[i+4]=n.m04,t[i+5]=n.m05,t[i+6]=n.m06,t[i+7]=n.m13,t[i+8]=n.m08,t[i+9]=n.m09,t[i+10]=n.m10,t[i+11]=n.m14};function tY(t){return 2&t.getFormatFeatures(44)?44:35}function iY(t,i){var n=4/Math.sqrt(i);return 12*Math.ceil(Math.max(480*n,t)/12)}new Cr,new Cr,new ir,new Cr,new ir;var nY=new ir,eY=new ir,rY=new ir,sY=new ir,hY=new Kr,uY=new Kr,oY=new wo,aY=Number.MAX_SAFE_INTEGER;!function(){function t(t){this.gu=void 0,this._=void 0,this.mE=new Map,this.Sp=void 0,this.pE=void 0,this.yE=void 0,this.bE=new Map,this.gu=t;var i=tY(this.gu);this.Sp=tg[i].size,this.pE=48/this.Sp,this._=new XU(t),this._.initialize({format:i,roundUpFn:iY}),this.yE=new XU(t),this.yE.initialize({format:i,roundUpFn:iY})}var i=t.prototype;i.clear=function(){this._.destroy(),this.mE.clear()},i.registerCustomTextureLayouts=function(t){for(var i=0;i<t.length;i++){var n=t[i],e=n.textureLength;2&this.gu.getFormatFeatures(44)||(e*=2);for(var r=this.yE.createChunk(e),s=0;s<n.contents.length;s++){var h=n.contents[s],u=h.skeleton;this.bE.set(u,r);for(var o=0;o<h.clips.length;o++){var a=h.clips[o];this.bE.set(u^a,r)}}}},i.getDefaultPoseTexture=function(t,i,n){var e=0^t.hash,r=this.mE.get(e)||null;if(r&&r.bounds.has(i.hash))return r.refCount++,r;var s=t.joints,h=t.bindposes,u=null,o=!1,a=s.length;if(r)r.refCount++;else{var c=12*a,f=this.bE.get(e),v=void 0!==f?this.yE.alloc(4*c,f):this._.alloc(4*c);if(!v)return r;r={pixelOffset:v.start/this.Sp,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:v},u=new Float32Array(c),o=!0}ir.set(rY,aY,aY,aY),ir.set(sY,-aY,-aY,-aY);for(var l=i.getBoneSpaceBounds(t),d=0,g=0;d<a;d++,g+=12){var w=n.getChildByPath(s[d]),_=w?QX(w,n,hY):t.inverseBindposes[d],m=l[d];m&&(wo.transform(oY,m,_),oY.getBoundary(nY,eY),ir.min(rY,rY,nY),ir.max(sY,sY,eY)),o&&(w&&Kr.multiply(_,_,h[d]),JX(u,g,w?_:Kr.IDENTITY))}var p=[new wo];return r.bounds.set(i.hash,p),wo.fromPoints(p[0],rY,sY),o&&(this._.update(r.handle,u.buffer),this.mE.set(e,r)),r},i.getSequencePoseTexture=function(t,i,n,e){var r=t.hash^i.hash,s=this.mE.get(r)||null;if(s&&s.bounds.has(n.hash))return s.refCount++,s;var h=t.joints,u=t.bindposes,o=KX.getOrExtract(i).frames,a=null,c=!1,f=h.length;if(s)s.refCount++;else{var v=12*f*o,l=this.bE.get(r),d=void 0!==l?this.yE.alloc(4*v,l):this._.alloc(4*v);if(!d)return null;var g=this.AE(t,i,e);s={pixelOffset:d.start/this.Sp,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:i.hash,readyToBeDeleted:!1,handle:d,animInfos:g},a=new Float32Array(v),c=!0}var w=n.getBoneSpaceBounds(t),_=[];s.bounds.set(n.hash,_);for(var m=0;m<o;m++)_.push(new wo(aY,aY,aY,-aY,-aY,-aY));for(var p=0,y=0;p<o;p++){for(var b=_[p],A=0;A<f;A++,y+=12){var E=s.animInfos[A],k=E.curveData,T=E.downstream,S=E.bindposeIdx,O=E.bindposeCorrection,R=void 0,I=!0;k&&T?R=Kr.multiply(hY,k[p],T):k?R=k[p]:T?R=T:(R=t.inverseBindposes[S],I=!1);var M=w[A];if(M){var N=O?Kr.multiply(uY,R,O):R;wo.transform(oY,M,N),oY.getBoundary(nY,eY),ir.min(b.center,b.center,nY),ir.max(b.halfExtents,b.halfExtents,eY)}c&&(I&&Kr.multiply(hY,R,u[S]),JX(a,y,I?hY:Kr.IDENTITY))}wo.fromPoints(b,b.center,b.halfExtents)}return c&&(this._.update(s.handle,a.buffer),this.mE.set(r,s)),s},i.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var i=t.skeletonHash^t.clipHash;(void 0!==this.bE.get(i)?this.yE:this._).free(t.handle),this.mE.get(i)===t&&this.mE.delete(i)}},i.releaseSkeleton=function(t){for(var i=this.mE.values(),n=i.next();!n.done;){var e=n.value;e.skeletonHash===t.hash&&(e.readyToBeDeleted=!0,e.refCount?this.mE.delete(e.skeletonHash^e.clipHash):this.releaseHandle(e)),n=i.next()}},i.releaseAnimationClip=function(t){for(var i=this.mE.values(),n=i.next();!n.done;){var e=n.value;e.clipHash===t.hash&&(e.readyToBeDeleted=!0,e.refCount?this.mE.delete(e.skeletonHash^e.clipHash):this.releaseHandle(e)),n=i.next()}},i.AE=function(t,i,n){for(var e=[],r=t.joints,s=t.bindposes,h=r.length,u=KX.getOrExtract(i),o=0;o<h;o++){for(var a=r[o],c=u.joints[a],f=n.getChildByPath(a),v=void 0,l=void 0;!c;){var d=a.lastIndexOf("/");if(a=a.substring(0,d),c=u.joints[a],f?(v||(v=new Kr),Kr.fromRTS(hY,f.rotation,f.position,f.scale),Kr.multiply(v,hY,v),f=f.parent):l=a,d<0)break}var g=o,w=void 0;if(void 0!==l&&c){g=o-1;for(var _=0;_<h;_++)if(r[_]===l){g=_,w=new Kr,Kr.multiply(w,s[_],t.inverseBindposes[o]);break}}e.push({curveData:c&&c.transforms,downstream:v,bindposeIdx:g,bindposeCorrection:w})}return e},e(t,[{key:"pixelsPerJoint",get:function(){return this.pE}}])}();var cY=[],fY=new Map;function vY(t,i){for(var n=0,e=Kr.IDENTITY;t;){if(t.stamp===i||t.stamp+1===i&&!t.node.hasChangedFlags){e=t.world,t.stamp=i;break}t.stamp=i,cY[n++]=t,t=t.parent}for(;n>0;){t=cY[--n],cY[n]=null;var r=t.node;Kr.fromRTS(t.local,r.rotation,r.position,r.scale),e=Kr.multiply(t.world,e,t.local)}return e}function lY(t,i){for(var n,e=null,r=0;t!==i;){var s=t.uuid;if(fY.has(s)){e=fY.get(s);break}e={node:t,local:new Kr,world:new Kr,stamp:-1,parent:null},fY.set(s,e),cY[r++]=e,t=t.parent,e=null}for(;r>0;)n=cY[--r],cY[r]=null,n.parent=e,e=n;return e}function dY(t){for(var i=fY.get(t.uuid)||null;i;)fY.delete(i.node.uuid),i=i.parent}var gY=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_REAL_TIME_JOINT_TEXTURE",value:!1}],wY=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_REAL_TIME_JOINT_TEXTURE",value:!0}];function _Y(t,i,n,e){for(var r=0;r<n.length;r++){for(var s=n[r],h=-1,u=0;u<s.length;u++)if(s[u]===e){h=u;break}h>=0&&(i.push(r),t.push(h))}}var mY=new ir,pY=new ir,yY=new ir,bY=new ir,AY=new Kr,EY=new wo,kY=function(){this._format=44,this._textures=[],this._buffers=[]};kY.WIDTH=256,kY.HEIGHT=3;var TY,SY,OY,RY,IY,MY,NY,CY,LY,FY,PY,BY,DY,UY,xY,GY,jY,HY,VY,$Y,WY,zY,XY,YY,KY,qY,QY,ZY,JY,tK,iK,nK,eK=function(t){function i(){var i;return(i=t.call(this)||this).Yn=[],i.EE=[],i.kE=[],i.TE=null,i.SE=new kY,i.OE=!1,i.type=1,i}s(i,t);var n=i.prototype;return n.destroy=function(){if(this.bindSkeleton(),this.Yn.length){for(var i=0;i<this.Yn.length;i++)this.Yn[i].destroy();this.Yn.length=0}this.EE.length=0,this.SE._textures.forEach((function(t){t.destroy()})),this.SE._textures.length=0,this.SE._buffers.length=0,t.prototype.destroy.call(this)},n.uploadAnimation=function(){},n.bindSkeleton=function(t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null);for(var e=0;e<this.kE.length;e++)dY(this.kE[e].target);if(this.TE=null,this.kE.length=0,t&&i&&n){this.OE=!1,Wy.JOINT_UNIFORM_CAPACITY<t.joints.length&&(this.OE=!0),this.transform=i;var r=n.getBoneSpaceBounds(t),s=n.struct.jointMaps;this.RE(s&&s.length||1),this.TE=n.jointBufferIndices,this.ME();for(var h=0;h<t.joints.length;h++){var u=r[h],o=i.getChildByPath(t.joints[h]);if(u&&o){var a=lY(o,i),c=t.bindposes[h],f=[],v=[];s?_Y(f,v,s,h):(f.push(h),v.push(0)),this.kE.push({indices:f,buffers:v,bound:u,target:o,bindpose:c,transform:a})}}}},n.updateTransform=function(t){var i=this.transform;(i.hasChangedFlags||i.isTransformDirty())&&(i.updateWorldTransform(),this._localDataUpdated=!0),ir.set(mY,1/0,1/0,1/0),ir.set(pY,-1/0,-1/0,-1/0);for(var n=0;n<this.kE.length;n++){var e=this.kE[n],r=e.bound,s=vY(e.transform,t);wo.transform(EY,r,s),EY.getBoundary(yY,bY),ir.min(mY,mY,yY),ir.max(pY,pY,bY)}var h=this._worldBounds;this._modelBounds&&h&&(wo.fromPoints(this._modelBounds,mY,pY),this._modelBounds.transform(i._mat,i._pos,i._rot,i._scale,this._worldBounds))},n.updateUBOs=function(i){t.prototype.updateUBOs.call(this,i);for(var n=0;n<this.kE.length;n++){var e=this.kE[n],r=e.indices,s=e.buffers,h=e.transform,u=e.bindpose;Kr.multiply(AY,h.world,u);for(var o=0;o<s.length;o++)JX(this.EE[s[o]],12*r[o],AY)}if(this.OE)this.NE();else for(var a=0;a<this.Yn.length;a++)this.Yn[a].update(this.EE[a]);return!0},n.initSubModel=function(i,n,e){var r=n.vertexBuffers,s=n.iaInfo;s.vertexBuffers=n.jointMappedBuffers,t.prototype.initSubModel.call(this,i,n,e),s.vertexBuffers=r},n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i),e=gY;return this.OE&&(e=wY),n?e.concat(n):e},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n);var e=this.TE[i];if(this.OE)this.CE(e,n);else{var r=this.Yn[e];r&&n.bindBuffer(Wy.BINDING,r)}},n._updateInstancedAttributes=function(i,n){0!==n.passes[0].batchingScheme&&st(3936,this.node.getPathInHierarchy()),t.prototype._updateInstancedAttributes.call(this,i,n)},n.RE=function(t){if(this.Yn.length){for(var i=0;i<this.Yn.length;i++)this.Yn[i].destroy();this.Yn.length=0}if(this.EE.length&&(this.EE.length=0),this.OE)for(var n=0;n<t;n++){var e=kY.WIDTH;this.EE[n]=new Float32Array(12*e)}else for(var r=0;r<t;r++){this.Yn[r]=this._device.createBuffer(new ud(18,3,Wy.SIZE,Wy.SIZE));var s=Wy.JOINT_UNIFORM_CAPACITY;this.EE[r]=new Float32Array(12*s)}},n.ME=function(){if(this.SE._textures.length&&(this.SE._textures.forEach((function(t){t.destroy()})),this.SE._textures.length=0),this.SE._buffers.length=0,this.OE){var t=xC.root.device,i=kY.WIDTH,n=kY.HEIGHT;!(2&t.getFormatFeatures(44))&&(this.SE._format=35,i=4*kY.WIDTH);for(var e=this.SE._textures,r=this.SE._buffers,s=this.SE._format,h=0;h<this.EE.length;h++){r[h]=new Float32Array(4*kY.HEIGHT*kY.WIDTH);var u=r[h],o=44===s?u:new Uint8Array(u.buffer),a=new jw({width:i,height:n,_data:o,_compressed:!1,format:s}),c=new Mm;c.setFilters(1,1),c.setMipFilter(0),c.setWrapMode(2,2,2),c.image=a,e[h]=c}}},n.CE=function(t,i){if(this.OE){var n=this.SE._textures[t];if(n){var e=n.getGFXTexture(),r=n.getGFXSampler();i.bindTexture(7,e),i.bindSampler(7,r)}}},n.NE=function(){if(this.OE)for(var t=this.SE._textures,i=this.SE._buffers,n=0;n<t.length;n++){for(var e=i[n],r=this.EE[n],s=r.length/12,h=0,u=0,o=0;o<s;o++)u=4*o,e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++],u=4*(o+kY.WIDTH),e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++],u=4*(o+2*kY.WIDTH),e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++],e[u++]=r[h++];var a=44===this.SE._format?e:new Uint8Array(e.buffer);t[n].uploadData(a)}},i}(U$),rK=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],sK=function(t){function i(){var i;(i=t.call(this)||this).uploadedAnim=void 0,i.LE=void 0,i.FE=null,i.dw=null,i.PE=void 0,i.BE=-1,i.type=2,i.PE=k.director.root.dataPoolManager;var n=new Float32Array(4),e=i.PE.jointAnimationInfo.getData();return i.LE={buffer:null,jointTextureInfo:n,animInfo:e,texture:null,boundsInfo:null},i}s(i,t);var n=i.prototype;return n.destroy=function(){this.uploadedAnim=void 0,this.LE.boundsInfo=null,this.LE.buffer&&(this.LE.buffer.destroy(),this.LE.buffer=null),this._applyJointTexture(),t.prototype.destroy.call(this)},n.bindSkeleton=function(t,i,n){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),this.FE=t,this.dw=n,t&&i&&n){this.transform=i;var e=this.PE;this.LE.animInfo=e.jointAnimationInfo.getData(i.uuid),this.LE.buffer||(this.LE.buffer=this._device.createBuffer(new ud(18,1,Hy.SIZE,Hy.SIZE)))}},n.updateTransform=function(i){if(t.prototype.updateTransform.call(this,i),this.uploadedAnim){var n=this.LE,e=n.animInfo,r=n.boundsInfo[e.data[0]],s=this._worldBounds;if(s&&r){var h=this.transform;r.transform(h._mat,h._pos,h._rot,h._scale,s)}}},n.updateUBOs=function(i){t.prototype.updateUBOs.call(this,i);for(var n=this.LE.animInfo,e=!1,r=this.BE,s=0;s<this._subModels.length;s++){var h=this._subModels[s];r>=0?h.instancedAttributeBlock.views[r][0]=n.data[0]:e=!0}return e&&n.dirty&&(n.buffer.update(n.data),n.dirty=!1),!0},n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i);return n?n.concat(rK):rK},n.uploadAnimation=function(t){if(this.FE&&this.dw&&this.uploadedAnim!==t){this.uploadedAnim=t;var i=this.PE,n=null;t?(n=i.jointTexturePool.getSequencePoseTexture(this.FE,t,this.dw,this.transform),this.LE.boundsInfo=n&&n.bounds.get(this.dw.hash),this._modelBounds=null):(n=i.jointTexturePool.getDefaultPoseTexture(this.FE,this.dw,this.transform),this.LE.boundsInfo=null,this._modelBounds=n&&n.bounds.get(this.dw.hash)[0]),this._applyJointTexture(n)}},n._applyJointTexture=function(t){void 0===t&&(t=null);var i=this.LE.texture;if(i&&i!==t&&this.PE.jointTexturePool.releaseHandle(i),this.LE.texture=t,t){var n=this.LE,e=n.buffer,r=n.jointTextureInfo;r[0]=t.handle.texture.width,r[1]=this.FE.joints.length,r[2]=t.pixelOffset+.1,r[3]=1/r[0],this.DE(),e&&e.update(r);for(var s=t.handle.texture,h=0;h<this._subModels.length;++h)this._subModels[h].descriptorSet.bindTexture(7,s)}},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n);var e=this.LE,r=e.buffer,s=e.texture,h=e.animInfo;if(n.bindBuffer(Hy.BINDING,r),n.bindBuffer(Vy.BINDING,h.buffer),s){var u=this._device.getSampler(ZX);n.bindTexture(7,s.handle.texture),n.bindSampler(7,u)}},n._updateInstancedAttributes=function(i,n){t.prototype._updateInstancedAttributes.call(this,i,n),this.BE=n.getInstancedAttributeIndex($y),this.DE()},n.DE=function(){for(var t=this.LE,i=t.jointTextureInfo,n=t.animInfo,e=this.BE,r=0;r<this._subModels.length;r++){var s=this._subModels[r].instancedAttributeBlock.views;if(e>=0&&s.length>0){var h=s[e];h[0]=n.data[0],h[1]=i[1],h[2]=i[2]}}},i}(U$),hK=(TY=Ko("cc.SkinnedMeshRenderer"),SY=Qo(100),OY=Ca(AW),RY=Ca(Xp),IY=Ca(AW),MY=Ca(Xp),TY(NY=SY((CY=function(t){function i(){var i;return(i=t.call(this)||this)._skeleton=LY&&LY(),i._skinningRoot=FY&&FY(),i._clip=null,i.associatedAnimation=null,i._modelType=sK,i}s(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.UE()},n.onDestroy=function(){this.associatedAnimation&&(this.associatedAnimation.notifySkinnedMeshRemoved(this),this.associatedAnimation),t.prototype.onDestroy.call(this)},n.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},n.setUseBakedAnimation=function(t,i){void 0===t&&(t=!0),void 0===i&&(i=!1);var n=t?sK:eK;(i||this._modelType!==n)&&(this._modelType=n,this._model&&(k.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this.enabledInHierarchy&&this._attachToScene()))},n.setSharedMaterial=function(i,n){t.prototype.setSharedMaterial.call(this,i,n),this._modelType===eK&&this.getMaterialInstance(n)},n._updateModelParams=function(){this.Tu(),t.prototype._updateModelParams.call(this)},n.UE=function(){var t=this._skinningRoot;if(t){for(var i=!1,n=this.node;n;n=n.parent)if(n===t){i=!0;break}if(i){var e=t.getComponent("cc.SkeletalAnimation");e&&e.enabledInHierarchy?e.notifySkinnedMeshAdded(this):this.setUseBakedAnimation(!1)}}},n.Tu=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},e(i,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this.Tu())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this.UE(),this.Tu())}},{key:"model",get:function(){return this._model}}]),i}(rW),LY=xo(CY.prototype,"_skeleton",[OY],(function(){return null})),FY=xo(CY.prototype,"_skinningRoot",[RY],(function(){return null})),m(CY.prototype,"skeleton",[IY],Object.getOwnPropertyDescriptor(CY.prototype,"skeleton"),CY.prototype),m(CY.prototype,"skinningRoot",[MY],Object.getOwnPropertyDescriptor(CY.prototype,"skinningRoot"),CY.prototype),NY=CY))||NY)||NY);t({SkinnedMeshRenderer:hK,SkinningModelComponent:hK});var uK=new kd("a_batch_id",11),oK=new kd("a_batch_uv",21),aK=tg[uK.format].size+tg[oK.format].size,cK=(PY=Ko("cc.SkinnedMeshUnit"),BY=Ca(yF),DY=Ca(AW),UY=Ca(Lk),xY=Ca(hK),PY((jY=function(){function t(){this.mesh=HY&&HY(),this.skeleton=VY&&VY(),this.material=$Y&&$Y(),this._localTransform=WY&&WY(),this._offset=zY&&zY(),this._size=XY&&XY()}return e(t,[{key:"offset",get:function(){return this._offset},set:function(t){ls.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){ls.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getSharedMaterial(0),t.skinningRoot&&QX(t.node,t.skinningRoot,this._localTransform))}}]),t}(),HY=xo(jY.prototype,"mesh",[BY],(function(){return null})),VY=xo(jY.prototype,"skeleton",[DY],(function(){return null})),$Y=xo(jY.prototype,"material",[UY],(function(){return null})),WY=xo(jY.prototype,"_localTransform",[oa],(function(){return new Kr})),zY=xo(jY.prototype,"_offset",[oa],(function(){return new ls(0,0)})),XY=xo(jY.prototype,"_size",[oa],(function(){return new ls(1,1)})),m(jY.prototype,"copyFrom",[xY],Object.getOwnPropertyDescriptor(jY.prototype,"copyFrom"),jY.prototype),GY=jY))||GY);t({SkinnedMeshUnit:cK,SkinningModelUnit:cK});var fK=new Kr;new Kr;var vK,lK,dK,gK,wK,_K,mK,pK,yK,bK,AK,EK,kK,TK,SK,OK,RK,IK=new ir,MK=(YY=Ko("cc.SkinnedMeshBatchRenderer"),KY=Qo(100),qY=Ca([ln]),QY=Ca([cK]),YY(ZY=KY((JY=function(t){function i(){var i;return(i=t.call(this)||this).atlasSize=tK&&tK(),i.batchableTextureNames=iK&&iK(),i.units=nK&&nK(),i.Kn={},i.xE=null,i}s(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},n.onDestroy=function(){for(var i in this.Kn)this.Kn[i].destroy();this.Kn={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},n._onMaterialModified=function(i){this.cookMaterials(),t.prototype._onMaterialModified.call(this,i,this.getMaterialInstance(i))},n.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},n.cookMaterials=function(){var t=this;this.xE||(this.xE=this.getSharedMaterial(0));var i=this.getMaterialInstance(0);if(i&&this.xE&&this.xE.effectAsset){i.copy(this.xE),this.resizeAtlases();for(var n=i.effectAsset.techniques[i.technique],e=function(e){var r=n.passes[e];if(!r.properties)return 1;var s=function(n){if(r.properties[n].type>=26){var s=null;t.batchableTextureNames.find((function(t){return t===n}))?((s=t.Kn[n])||(s=t.createTexture(n)),t.cookTextures(s,n,e)):t.units.some((function(t){return s=t.material&&t.material.getProperty(n,e)})),s&&i.setProperty(n,s,e)}else{for(var h=[],u=0;u<t.units.length;u++){var o=t.units[u];o.material&&h.push(o.material.getProperty(n.slice(0,-3),e))}i.setProperty(n,h,e)}};for(var h in r.properties)s(h)},r=0;r<n.passes.length;r++)e(r)}else X("incomplete batch material!")},n.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],i=[],n=0;n<this.units.length;n++){var e=this.units[n];if(e&&e.skeleton){var r=e.skeleton;Kr.invert(fK,e._localTransform);for(var s=function(){var n=r.joints[h];if(t.findIndex((function(t){return t===n}))>=0)return 1;t.push(n),i.push(Kr.multiply(new Kr,r.bindposes[h]||Kr.IDENTITY,fK))},h=0;h<r.joints.length;h++)s()}}var u=Array.from(Array(t.length).keys()).sort((function(i,n){return t[i]>t[n]?1:t[i]<t[n]?-1:0})),o=new AW;o.joints=t.map((function(t,i,n){return n[u[i]]})),o.bindposes=i.map((function(t,i,n){return n[u[i]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=o}else X("no skinning root specified!")},n.cookMeshes=function(){for(var t=this,i=!1,n=0;n<this.units.length;n++)if(this.units[n].mesh){i=!0;break}if(i&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new yF;for(var e=0,r=0,s=0,h=0,u=0,o=0,a=0,c=0,f=0,v=0,l=new Array(this.units.length),d=this.units.length,g=0;g<d;g++){var w=this.units[g];w&&w.skeleton&&(l[g]=w.skeleton.joints.map((function(i){return t._skeleton.joints.findIndex((function(t){return i===t}))})))}for(var _=function(){var i=t.units[m];if(!i||!i.mesh||!i.mesh.data)return 1;var n=t.GE(m,i.mesh),d=new DataView(n.data.buffer);Kr.invert(fK,i._localTransform),Kr.transpose(fK,fK);for(var g=i.offset,w=i.size,_=function(){var t=n.struct.vertexBundles[p];e=t.view.offset,r=0;for(var _=0;_<t.attributes.length;_++){var y=t.attributes[_];if("a_position"===y.name){r=y.format;break}e+=tg[y.format].size}if(r){for(var b=zC(d,r,e,t.view.length,t.view.stride),A=0;A<b.length;A+=3)ir.fromArray(IK,b,A),ir.transformMat4(IK,IK,i._localTransform),ir.toArray(b,IK,A);WC(d,b,r,e,t.view.stride)}s=t.view.offset,h=0;for(var E=0;E<t.attributes.length;E++){var k=t.attributes[E];if("a_normal"===k.name){h=k.format;break}s+=tg[k.format].size}if(h){for(var T=zC(d,h,s,t.view.length,t.view.stride),S=0;S<T.length;S+=3)ir.fromArray(IK,T,S),ir.transformMat4Normal(IK,IK,fK),ir.toArray(T,IK,S);WC(d,T,h,s,t.view.stride)}u=t.view.offset,o=0;for(var O=0;O<t.attributes.length;O++){var R=t.attributes[O];if("a_tangent"===R.name){o=R.format;break}u+=tg[R.format].size}if(o){for(var I=zC(d,o,u,t.view.length,t.view.stride),M=0;M<I.length;M+=3)ir.fromArray(IK,I,M),ir.transformMat4Normal(IK,IK,fK),ir.toArray(I,IK,M);WC(d,I,o,u,t.view.stride)}a=t.view.offset,c=0;for(var N=0;N<t.attributes.length;N++){var C=t.attributes[N];if("a_batch_uv"===C.name){c=C.format;break}a+=tg[C.format].size}c&&XC(d,(function(t,i){var n,e=0===i?"x":"y";return(t=(n=t)-Math.floor(n))*w[e]+g[e]}),c,a,t.view.length,t.view.stride,d);var L=l[m];if(!L)return 1;f=t.view.offset,v=0;for(var F=0;F<t.attributes.length;F++){var P=t.attributes[F];if("a_joints"===P.name){v=P.format;break}f+=tg[P.format].size}v&&XC(d,(function(t){return L[t]}),v,f,t.view.length,t.view.stride,d)},p=0;p<n.struct.vertexBundles.length;p++)_();t._mesh.merge(n)},m=0;m<d;m++)_();this._onMeshChanged(this._mesh),this._updateModels()}},n.cookTextures=function(t,i,n){for(var e=[],r=[],s=[],h=[],u=0;u<this.units.length;u++){var o=this.units[u];if(o.material){var a=o.material.getProperty(i,n);if(a&&a.image&&a.image.data){var c=new td;c.texOffset.x=o.offset.x*this.atlasSize,c.texOffset.y=o.offset.y*this.atlasSize,c.texExtent.width=o.size.x*this.atlasSize,c.texExtent.height=o.size.y*this.atlasSize;var f=a.image.data;ArrayBuffer.isView(f)?(s.push(f),h.push(c)):(e.push(f),r.push(c))}}}var v=t.getGFXTexture(),l=k.director.root.device;s.length>0&&l.copyBuffersToTexture(s,v,h),e.length>0&&l.copyTexImagesToTexture(e,v,r)},n.createTexture=function(t){var i=new Mm;return i.setFilters(2,2),i.setMipFilter(1),i.reset({width:this.atlasSize,height:this.atlasSize,format:35}),this.Kn[t]=i,i},n.resizeAtlases=function(){for(var t in this.Kn)this.Kn[t].reset({width:this.atlasSize,height:this.atlasSize,format:35})},n.GE=function(t,i){for(var n=JSON.parse(JSON.stringify(i.struct)),e={},r=0;r<i.struct.primitives.length;r++){for(var s=i.struct.primitives[r],h=0,u=0,o=0;o<s.vertexBundelIndices.length;o++){var a=i.struct.vertexBundles[s.vertexBundelIndices[o]];h=a.view.offset,u=0;for(var c=0;c<a.attributes.length;c++){var f=a.attributes[c];if("a_texCoord"===f.name){u=f.format;break}h+=tg[f.format].size}if(u)break}if(void 0===e[o]){e[o]=[u,h];var v=n.vertexBundles[o];v.attributes.push(uK),v.attributes.push(oK),v.view.offset=0,v.view.length+=v.view.count*aK,v.view.stride+=aK}}for(var l=0,d=0;d<n.vertexBundles.length;d++)l+=n.vertexBundles[d].view.length;for(var g=0;g<n.primitives.length;g++){var w=n.primitives[g];w.indexView&&(w.indexView.offset=l,l+=w.indexView.length)}var _=new Uint8Array(l),m=i.data,p=new DataView(_.buffer),y=new DataView(m.buffer),b=k.sys.isLittleEndian;for(var A in e)for(var E=n.vertexBundles[A],T=i.struct.vertexBundles[A],S=e[A],O=zC(y,S[0],S[1],T.view.length,T.view.stride),R=T.view,I=E.view,M=R.stride,N=I.stride,C=R.offset,L=I.offset,F=0;F<I.count;F++){var P=m.subarray(C,C+M);_.set(P,L),p.setFloat32(L+M,t),p.setFloat32(L+M+4,O[2*F],b),p.setFloat32(L+M+8,O[2*F+1],b),L+=N,C+=M}for(var B=0;B<n.primitives.length;B++){var D=i.struct.primitives[B],U=n.primitives[B];if(D.indexView&&U.indexView)for(var x=D.indexView.stride,G=U.indexView.stride,j=D.indexView.offset,H=U.indexView.offset,V=0;V<U.indexView.count;V++){var $=m.subarray(j,j+x);_.set($,H),H+=G,j+=x}}var W=new yF;return W.reset({struct:n,data:_}),W},e(i,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),i}(hK),tK=xo(JY.prototype,"atlasSize",[oa],(function(){return 1024})),iK=xo(JY.prototype,"batchableTextureNames",[qY,oa],(function(){return[]})),nK=xo(JY.prototype,"units",[QY,oa],(function(){return[]})),m(JY.prototype,"mesh",[ja],Object.getOwnPropertyDescriptor(JY.prototype,"mesh"),JY.prototype),m(JY.prototype,"skeleton",[ja],Object.getOwnPropertyDescriptor(JY.prototype,"skeleton"),JY.prototype),ZY=JY))||ZY)||ZY);t({SkinnedMeshBatchRenderer:MK,BatchedSkinningModelComponent:MK}),k.SkinningModelComponent=hK,ai(hK,"cc.SkinningModelComponent"),k.SkinningModelUnit=cK,ai(cK,"cc.SkinningModelUnit"),k.BatchedSkinningModelComponent=MK,ai(MK,"cc.BatchedSkinningModelComponent");var NK,CK,LK,FK,PK,BK,DK,UK,xK,GK,jK,HK,VK,$K,WK,zK,XK,YK,KK,qK,QK,ZK,JK,tq=[.25,.125,.01],iq=t("LOD",(vK=Ko("cc.LOD"),lK=Ca([rW]),dK=Ca(fn),gK=Ca([rW]),wK=Ca([cn]),vK((mK=function(){function t(){this._screenUsagePercentage=pK&&pK(),this._renderers=yK&&yK(),this.jE=new bN,this.HE=void 0,this.jE.Gf=this._screenUsagePercentage,this.HE=null}var i=t.prototype;return i.insertRenderer=function(t,i){(t<0||t>this._renderers.length)&&(t=this._renderers.length),this._renderers.splice(t,0,i);var n=!1;return i.model&&(n=!0,this.jE.Hf(i.model)),this.HE&&n&&this.HE(),i},i.deleteRenderer=function(t){var i,n=this._renderers.splice(t,1),e=n.length>0?null==(i=n[0])?void 0:i.model:null;return e&&this.jE.Vf(e),n[0]},i.getRenderer=function(t){return this._renderers[t]||null},i.setRenderer=function(t,i){t<0||t>=this.rendererCount?Y("setRenderer to LOD error, index out of range"):(this.deleteRenderer(t),this.insertRenderer(t,i))},e(t,[{key:"screenUsagePercentage",get:function(){return this._screenUsagePercentage},set:function(t){this._screenUsagePercentage=t,this.jE.Gf=t}},{key:"renderers",get:function(){return this._renderers},set:function(t){if(t!==this._renderers){var i=!1;this._renderers.length=0,this.jE.$f();for(var n=0;n<t.length;n++){var e;this._renderers[n]=t[n];var r=null==(e=t[n])?void 0:e.model;r&&(i=!0,this.jE.Hf(r))}this.HE&&i&&this.HE()}}},{key:"triangleCount",get:function(){var t=[];return this._renderers.forEach((function(i){var n=0;if(i&&i.mesh){var e=i.mesh.struct.primitives;null==e||e.forEach((function(t){t&&t.indexView&&(n+=t.indexView.count)}))}t.push(n/3)})),t}},{key:"rendererCount",get:function(){return this._renderers.length}},{key:"lodData",get:function(){return this.jE}},{key:"modelAddedCallback",set:function(t){this.HE=t}}]),t}(),pK=xo(mK.prototype,"_screenUsagePercentage",[oa],(function(){return 1})),yK=xo(mK.prototype,"_renderers",[lK,oa],(function(){return[]})),m(mK.prototype,"screenUsagePercentage",[dK],Object.getOwnPropertyDescriptor(mK.prototype,"screenUsagePercentage"),mK.prototype),m(mK.prototype,"renderers",[gK],Object.getOwnPropertyDescriptor(mK.prototype,"renderers"),mK.prototype),m(mK.prototype,"triangleCount",[wK],Object.getOwnPropertyDescriptor(mK.prototype,"triangleCount"),mK.prototype),_K=mK))||_K)),nq=(t("LODGroup",(bK=Ko("cc.LODGroup"),AK=Ca(fn),EK=Ca([iq]),bK((TK=function(t){function i(){var i;return(i=t.call(this)||this)._localBoundaryCenter=SK&&SK(),i._objectSize=OK&&OK(),i._LODs=RK&&RK(),i._lodGroup=new AN,i.VE=!1,i.$E=[],i}s(i,t);var n=i.prototype;return n.WE=function(){0===this.objectSize&&this.recalculateBounds()},n.insertLOD=function(t,i,n){if((t<0||t>this.lodCount)&&(t=this.lodCount),n||(n=new iq),n.modelAddedCallback=this.WE.bind(this),!i){var e=this.getLOD(t-1),r=this.getLOD(t);if(e&&r)i=(e.screenUsagePercentage+r.screenUsagePercentage)/2;else if(e&&!r)(i=e.screenUsagePercentage/2)>.01&&(i=.01);else if(r&&!e){i=r.screenUsagePercentage;var s=this.getLOD(t+1);r.screenUsagePercentage=(i+(s?s.screenUsagePercentage:0))/2}else i=tq[0]}return n.screenUsagePercentage=i,this._LODs.splice(t,0,n),this._lodGroup.hv(t,n.lodData),this.zE(),this.node&&this.XE(this.node),n},n.eraseLOD=function(t){if(t<0||t>=this.lodCount)return X("eraseLOD error, index out of range"),null;var i=this._LODs[t];return i?(this._LODs.splice(t,1),this._lodGroup.av(t),this.zE(),this.XE(this.node),i):(X("eraseLOD error, LOD not exist at specified index."),null)},n.getLOD=function(t){return t<0||t>=this.lodCount?(X("getLOD error, index out of range"),null):this._LODs[t]},n.setLOD=function(t,i){t<0||t>=this.lodCount?X("setLOD error, index out of range"):(this._LODs[t]=i,i.modelAddedCallback=this.WE.bind(this),this.lodGroup.ov(t,i.lodData),this.zE())},n.recalculateBounds=function(){for(var t=new ir,i=new ir,n=null,e=new ir,r=0;r<this.lodCount;++r){var s=this.getLOD(r);if(s)for(var h=0;h<s.rendererCount;++h){var u,o,a=s.getRenderer(h);if(a){null==(u=a.model)||u.updateWorldBound();var c=null==(o=a.model)?void 0:o.worldBounds;c&&(c.getBoundary(t,i),n?(ir.min(n,n,t),ir.max(e,e,i)):(n=t.clone(),e=i.clone()))}}}if(n){var f=n,v=new ir(.5*(e.x+f.x),.5*(e.y+f.y),.5*(e.z+f.z)),l=new ir(.5*(e.x-f.x),.5*(e.y-f.y),.5*(e.z-f.z)),d=function(t,i,n){var e,r,s=new Array(new ir(t.x-i.x,t.y-i.y,t.z-i.z),new ir(t.x-i.x,t.y+i.y,t.z-i.z),new ir(t.x+i.x,t.y+i.y,t.z-i.z),new ir(t.x+i.x,t.y-i.y,t.z-i.z),new ir(t.x-i.x,t.y-i.y,t.z+i.z),new ir(t.x-i.x,t.y+i.y,t.z+i.z),new ir(t.x+i.x,t.y+i.y,t.z+i.z),new ir(t.x+i.x,t.y-i.y,t.z+i.z));r=(e=s[0].transformMat4(n)).clone();for(var h=1;h<8;++h){var u=s[h].transformMat4(n);e=ir.min(e,e,u),r=ir.max(r,r,u)}return[e,r]}(v,l,this.node.worldMatrix.clone().invert()),g=d[0],w=d[1];v.set(.5*(w.x+g.x),.5*(w.y+g.y),.5*(w.z+g.z)),l.set(.5*(w.x-g.x),.5*(w.y-g.y),.5*(w.z-g.z)),this.localBoundaryCenter=v,this.objectSize=2*Math.max(l.x,l.y,l.z)}else this.localBoundaryCenter=new ir(0,0,0),this.objectSize=0;this.XE(this.node)},n.resetObjectSize=function(){if(1!==this.objectSize){0===this.objectSize&&(this.objectSize=1);var t=1/this.objectSize;this.objectSize=1;for(var i=0;i<this.lodCount;++i){var n=this.getLOD(i);n&&(n.screenUsagePercentage*=t)}this.XE(this.node)}},n.forceLOD=function(t){this.$E=t<0?[]:[t],this.lodGroup.iv(this.$E)},n.forceLODs=function(){},n.onLoad=function(){this._lodGroup.zf=this.node,this._lodGroup.objectSize=this._objectSize,this._lodGroup.localBoundaryCenter=this._localBoundaryCenter,this.VE||(this.node.on("component-removed",this._onRemove,this),this.VE=!0),this.YE()},n._onRemove=function(t){t===this&&this.onDisable()},n.YE=function(){if(this.lodCount<1)for(var t=tq.length,i=0;i<t;i++)this.insertLOD(i,tq[i])},n.onRestore=function(){this.YE(),this.enabledInHierarchy&&this.KE()},n.onEnable=function(){var t=this;this.KE(),0===this.objectSize&&this.recalculateBounds(),this.lodGroup.iv(this.$E),this.lodCount>0&&this._lodGroup.lodCount<1&&this._LODs.forEach((function(i,n){i.lodData.Gf=i.screenUsagePercentage;var e=i.renderers;if(null!==e&&e.length>0)for(var r=0;r<e.length;r++){var s=i.lodData,h=e[r];s&&h&&h.model&&s.Hf(h.model)}t._lodGroup.hv(n,i.lodData)}))},n.onDisable=function(){this.qE(),this.lodGroup.iv([])},n.KE=function(){if(this.node&&this.node.scene){var t=this._getRenderScene();this._lodGroup.Wf&&this.qE(),t.addLODGroup(this._lodGroup)}},n.qE=function(){this._lodGroup.Wf&&this._lodGroup.Wf.Ov(this._lodGroup)},n.XE=function(){},n.zE=function(){this.qE(),this.KE()},e(i,[{key:"localBoundaryCenter",get:function(){return this._localBoundaryCenter.clone()},set:function(t){this._localBoundaryCenter.set(t),this._lodGroup.localBoundaryCenter=t}},{key:"lodCount",get:function(){return this._LODs.length}},{key:"objectSize",get:function(){return this._objectSize},set:function(t){this._objectSize=t,this._lodGroup.objectSize=t}},{key:"LODs",get:function(){return this._LODs},set:function(t){var i=this;t!==this._LODs?(this._LODs.length=0,this.lodGroup.sv(),t.forEach((function(t,n){i.lodGroup.hv(n,t.lodData),i._LODs[n]=t,t.modelAddedCallback=i.WE.bind(i)})),this.zE()):this.zE()}},{key:"lodGroup",get:function(){return this._lodGroup}}]),i}(w_),SK=xo(TK.prototype,"_localBoundaryCenter",[oa],(function(){return new ir(0,0,0)})),OK=xo(TK.prototype,"_objectSize",[oa],(function(){return 0})),RK=xo(TK.prototype,"_LODs",[oa],(function(){return[]})),m(TK.prototype,"objectSize",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"objectSize"),TK.prototype),m(TK.prototype,"LODs",[EK],Object.getOwnPropertyDescriptor(TK.prototype,"LODs"),TK.prototype),kK=TK))||kK)),Pm.makeMaskExclude([Pm.BitMask.UI_2D,Pm.BitMask.UI_3D,Pm.BitMask.GIZMOS,Pm.BitMask.EDITOR,Pm.BitMask.SCENE_GIZMO,Pm.BitMask.PROFILER,Pm.Enum.IGNORE_RAYCAST])),eq=t("ReflectionProbeManager",function(){function t(){this.QE=[],this.ZE=new Map,this.JE=new Map,this.tk=!0,this.ik=null,this.nk=!1}var i=t.prototype;return i.ek=function(){this.nk||(k.director.on(k.DirectorEvent.BEFORE_UPDATE,this.onUpdateProbes,this),this.nk=!0)},i.onUpdateProbes=function(){if(0!==this.QE.length){var t=k.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var e=i[n];e.node&&e.node.layer&nq&&(1===e.reflectionProbeType||this.rk(e)?this.selectReflectionProbe(e):2===e.reflectionProbeType&&this.wE(e))}}},i.filterModelsForPlanarReflection=function(){if(0!==this.QE.length){var t=k.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var e=i[n];e.node&&e.node.layer&nq&&2===e.reflectionProbeType&&this.wE(e)}}},i.sk=function(t){for(var i,n=d(this.JE.entries());!(i=n()).done;){var e=i.value;e[1]===t&&this.hk(e[0],null,null)}},i.uk=function(t){-1===this.QE.indexOf(t)&&(this.QE.push(t),this.updateProbeData())},i.ak=function(t){for(var i=0;i<this.QE.length;i++)if(this.QE[i]===t){var n=this.QE.splice(i,1);n[0]&&this.ck(n[0]);break}this.updateProbeData()},i.fk=function(t){if(0===this.QE.length)return!1;for(var i=0;i<this.QE.length;i++)if(this.QE[i].getProbeId()===t)return!0;return!1},i.vk=function(){for(var t=0;;){if(!this.fk(t))return t;t++}},i.getProbes=function(){return this.QE},i.getProbeById=function(t){for(var i=0;i<this.QE.length;i++)if(this.QE[i].getProbeId()===t)return this.QE[i];return null},i.lk=function(){this.QE=[]},i.dk=function(t){for(var i=0;i<this.QE.length;i++)if(this.QE[i].camera===t)return this.QE[i];return null},i.updateBakedCubemap=function(t){var i=this.gk(t);if(t.cubemap){for(var n=0;n<i.length;n++){var e=i[n];this.wk(e,t)}if(t.needRefresh=!1,0===i.length)for(var r,s=d(this.ZE.entries());!(r=s()).done;){var h=r.value;h[0].reflectionProbeBlendId===t.getProbeId()&&this._k(h[0],t)}}},i.updatePlanarMap=function(t,i){if(t.node&&t.node.scene){for(var n=this.gk(t),e=0;e<n.length;e++)this.hk(n[e],i,t);if(t.previewPlane){var r=t.previewPlane.getComponent(rW);r&&r.updateProbePlanarMap(i)}}},i.wE=function(t){if(t.node&&t.worldBounds&&2===t.reflectionProbeType){for(var i=0;i<this.QE.length;i++){var n=this.QE[i];1===n.probeType&&t.node.layer&nq&&(t.updateWorldBound(),Qh.aabbWithAABB(t.worldBounds,n.boundingBox)?this.JE.set(t,n):this.JE.has(t)&&this.JE.get(t)===n&&(this.JE.delete(t),this.hk(t,null,null)))}for(var e=0;e<this.QE.length;e++)1===this.QE[e].probeType&&(this.QE[e].realtimePlanarTexture?this.updatePlanarMap(this.QE[e],this.QE[e].realtimePlanarTexture.getGFXTexture()):this.updatePlanarMap(this.QE[e],null))}},i.selectReflectionProbe=function(t){if(t.node&&t.worldBounds&&t.node.layer&nq){t.updateWorldBound();var i=this.mk(t);i?this.ZE.has(t)?(this.ZE.get(t)!==i&&this.ZE.set(t,i),i.needRefresh=!0):(this.ZE.set(t,i),i.needRefresh=!0):(this.wk(t,null),this.ZE.delete(t))}for(var n=0;n<this.QE.length;n++)(this.QE[n].needRefresh&&0===this.QE[n].probeType||this.rk(t))&&this.updateBakedCubemap(this.QE[n])},i.updatePreviewSphere=function(t){if(t&&t.previewSphere){var i=t.previewSphere.getComponent(rW);i&&(i.updateProbeCubemap(t.cubemap),i.updateReflectionProbeId(t.getProbeId()))}},i.updatePreviewPlane=function(t){t&&t.previewPlane&&t.previewPlane.getComponent(rW)&&t.realtimePlanarTexture&&this.updatePlanarMap(t,t.realtimePlanarTexture.getGFXTexture())},i.updateProbeData=function(){if(0!==this.QE.length){var t=this.getMaxProbeId(),i=t+1;this.ik&&this.ik.destroy();for(var n=new Float32Array(12*i),e=0,r=0;r<=t;r++){var s=this.getProbeById(r);if(s){if(0===s.probeType){n[e]=s.node.worldPosition.x,n[e+1]=s.node.worldPosition.y,n[e+2]=s.node.worldPosition.z,n[e+3]=0,n[e+4]=s.size.x,n[e+5]=s.size.y,n[e+6]=s.size.z,n[e+7]=0;var h=s.isRGBE()?1e3:0;n[e+8]=s.cubemap?s.cubemap.mipmapLevel+h:1+h}else n[e]=s.node.up.x,n[e+1]=s.node.up.y,n[e+2]=s.node.up.z,n[e+3]=1,n[e+4]=1,n[e+5]=1,n[e+6]=0,n[e+7]=0,n[e+8]=1;e+=12}else e+=12}var u=new Uint8Array(n.buffer),o=new jw({_data:u,_compressed:!1,width:12,height:i,format:35});this.ik=new Mm,this.ik.setFilters(0,0),this.ik.setMipFilter(0),this.ik.setWrapMode(2,2,2),this.ik.image=o,this.ik.uploadData(u);for(var a=0;a<this.QE.length;a++)for(var c=this.QE[a],f=this.gk(c),v=0;v<f.length;v++){var l=f[v].node.getComponent(rW);l&&l.updateReflectionProbeDataMap(this.ik)}}},i.getMaxProbeId=function(){return 0===this.QE.length?-1:1===this.QE.length?this.QE[0].getProbeId():(this.QE.sort((function(t,i){return t.getProbeId()-i.getProbeId()})),this.QE[this.QE.length-1].getProbeId())},i.getUsedReflectionProbe=function(t,i){if(i){if(this.JE.has(t))return this.JE.get(t)}else if(this.ZE.has(t))return this.ZE.get(t);return null},i.setReflectionProbe=function(t,i,n){void 0===n&&(n=null),i&&(this.ZE.set(t,i),this.wk(t,i),n&&this.pk(t,i,n))},i.yk=function(){if(0!==this.QE.length){var t=k.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var e=i[n];e.node&&e.node.layer&nq&&(1===e.reflectionProbeType||2===e.reflectionProbeType||this.rk(e))&&e.updateReflectionProbeId()}}},i.mk=function(t){if(!t.node||!t.worldBounds||0===this.QE.length)return null;for(var i,n=null,e=1/0,r=d(this.QE);!(i=r()).done;){var s=i.value;if(0===s.probeType&&s.validate()&&Qh.aabbWithAABB(t.worldBounds,s.boundingBox)){var h=ir.distance(t.node.worldPosition,s.node.worldPosition);h<e&&(e=h,n=s)}}return n},i.bk=function(t){if(!t||!t.node||!t.worldBounds||this.QE.length<2)return null;for(var i=[],n=0;n<this.QE.length;n++)0===this.QE[n].probeType&&this.QE[n].validate()&&Qh.aabbWithAABB(t.worldBounds,this.QE[n].boundingBox)&&i.push(this.QE[n]);return i.sort((function(i,n){return ir.distance(t.node.worldPosition,i.node.worldPosition)-ir.distance(t.node.worldPosition,n.node.worldPosition)})),i.length>1?i[1]:null},i.gk=function(t){var i=[],n=this.ZE;1===t.probeType&&(n=this.JE);for(var e,r=d(n.entries());!(e=r()).done;){var s=e.value;s[1]===t&&i.push(s[0])}return i},i.ck=function(t){for(var i,n=d(this.ZE.keys());!(i=n()).done;){var e=i.value,r=this.ZE.get(e);void 0!==r&&r===t&&(this.ZE.delete(e),this.selectReflectionProbe(e))}for(var s,h=d(this.JE.keys());!(s=h()).done;){var u=s.value,o=this.JE.get(u);void 0!==o&&o===t&&(this.JE.delete(u),this.wE(u))}},i.wk=function(t,i){var n=t.node;if(n){var e=n.getComponent(rW);if(e&&(e.updateProbeCubemap(i?i.cubemap:null),e.updateReflectionProbeId(i&&i.cubemap?i.getProbeId():-1),i&&(e.updateReflectionProbeDataMap(this.ik),this.rk(t)))){var r=this.bk(t);this.pk(t,i,r)}}},i.hk=function(t,i,n){var e=t.node.getComponent(rW);e&&(e.updateProbePlanarMap(i),n?(e.updateReflectionProbeId(n.getProbeId()),e.updateReflectionProbeDataMap(this.ik)):e.updateReflectionProbeId(-1))},i.rk=function(t){return 3===t.reflectionProbeType||4===t.reflectionProbeType},i.pk=function(t,i,n){var e=t.node;if(e){var r=e.getComponent(rW);r&&(r.updateReflectionProbeBlendId(-1),4===t.reflectionProbeType&&r.updateReflectionProbeBlendWeight(this.Ak(t,i,n)))}},i._k=function(t,i){var n=t.node;if(n&&this.rk(t)){var e=n.getComponent(rW);e&&e.updateProbeBlendCubemap(i.cubemap)}},i.Ak=function(t,i,n){if(n){var e=ir.distance(t.node.worldPosition,i.node.worldPosition),r=ir.distance(t.node.worldPosition,n.node.worldPosition);return 1-r/(e+r)}return 3===t.reflectionProbeType?0:4===t.reflectionProbeType?this.Ek(t.worldBounds,i.boundingBox):0},i.Ek=function(t,i){if(!t)return 1;var n=new ir,e=new ir,r=new ir,s=new ir;if(ir.subtract(n,t.center,t.halfExtents),ir.add(e,t.center,t.halfExtents),ir.subtract(r,i.center,i.halfExtents),ir.add(s,i.center,i.halfExtents),n.x<=s.x&&e.x>=r.x&&n.y<=s.y&&e.y>=r.y&&n.z<=s.z&&e.z>=r.z){var h=new ir;ir.multiplyScalar(h,t.halfExtents,2);var u=n.x+h.x<=s.x&&e.x+h.x>=r.x,o=n.x-h.x<=s.x&&e.x-h.x>=r.x,a=n.y+h.y<=s.y&&e.y+h.y>=r.y,c=n.y-h.y<=s.y&&e.y-h.y>=r.y,f=n.z+h.z<=s.z&&e.z+h.z>=r.z,v=n.z-h.z<=s.z&&e.z-h.z>=r.z,l=[];if(!u){var d=e.x-s.x;l.push(d/h.x)}if(!o){var g=Math.abs(n.x-r.x);l.push(g/h.x)}if(!a){var w=e.y-s.y;l.push(w/h.y)}if(!c){var _=Math.abs(n.y-r.y);l.push(_/h.y)}if(!f){var m=e.z-s.z;l.push(m/h.z)}if(!v){var p=Math.abs(n.z-r.z);l.push(p/h.z)}return l.length>0?(l.sort((function(t,i){return i-t})),l[0]):0}return 1},e(t,[{key:"updateForRuntime",get:function(){return this.tk},set:function(t){this.tk=t}}]),t}());eq.probeManager=void 0,eq.probeManager=new eq,k.internal.reflectionProbeManager=eq.probeManager,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir,new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir(0,0,0),new ir;var rq=nr();t("ReflectionProbe",(NK=Ko("cc.ReflectionProbe"),CK=Ca(ir),LK=Ca(Ni(_N)),FK=Ca(Ni({Low_256x256:256,Medium_512x512:512,High_768x768:768})),PK=Ca(Ni(wN)),BK=Ca(cr),DK=Ca(Pm.BitMask),UK=Ca($G),xK=Ca(vn),GK=Ca(Yp),NK((JK=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this)._lastSize=nr(),i._resolution=VK&&VK(),i._clearFlag=$K&&$K(),i._backgroundColor=WK&&WK(),i._visibility=zK&&zK(),i._probeType=XK&&XK(),i._cubemap=YK&&YK(),i._size=KK&&KK(),i._sourceCamera=qK&&qK(),i._probeId=QK&&QK(),i._fastBake=ZK&&ZK(),i._probe=null,i._previewSphere=null,i._previewPlane=null,i.kk=nr(),i.Cc=nr(),i}s(i,t);var n=i.prototype;return n.onLoad=function(){this.Tk()},n.Sk=function(){this.probe&&this.sourceCamera&&1===this.probeType&&this.probe.renderPlanarReflection(this.sourceCamera.camera)},n.onEnable=function(){if(this._probe){var t=eq.probeManager.getProbeById(this._probeId);null!==t&&t!==this._probe&&(this._probeId=eq.probeManager.vk(),this._probe.updateProbeId(this._probeId)),eq.probeManager.uk(this._probe),eq.probeManager.onUpdateProbes(),this._probe.enable()}so.on("window-resize",this.Sk,this),so.on("fullscreen-change",this.Sk,this)},n.onDisable=function(){this._probe&&(eq.probeManager.ak(this._probe),this._probe.disable()),so.off("window-resize",this.Sk,this),so.off("fullscreen-change",this.Sk,this)},n.start=function(){this._sourceCamera&&1===this.probeType&&(this.probe.renderPlanarReflection(this.sourceCamera.camera),eq.probeManager.filterModelsForPlanarReflection()),eq.probeManager.updateProbeData(),this.node.getWorldPosition(this.Cc)},n.onDestroy=function(){this.probe&&this.probe.destroy()},n.update=function(){this.probe&&(1===this.probeType&&this.sourceCamera&&(7&this.sourceCamera.node.hasChangedFlags||!this.kk.equals(this.sourceCamera.node.getWorldPosition()))&&(this.kk=this.sourceCamera.node.getWorldPosition(),this.probe.renderPlanarReflection(this.sourceCamera.camera)),1&this.node.hasChangedFlags&&(this.probe.updateBoundingBox(),eq.probeManager.onUpdateProbes(),eq.probeManager.updateProbeData()),this.node.getWorldPosition(rq),this.Cc.equals(rq)||(this.Cc.set(rq),this.probe.updateBoundingBox(),eq.probeManager.updateProbeData(),eq.probeManager.yk()))},n.clearBakedCubemap=function(){this.cubemap=null,eq.probeManager.updateBakedCubemap(this.probe),eq.probeManager.updatePreviewSphere(this.probe)},n.Tk=function(){if((-1===this._probeId||eq.probeManager.fk(this._probeId))&&(this._probeId=eq.probeManager.vk()),this._probe=new yN(this._probeId),this._probe){var t=new Xp("ReflectionProbeCamera");t.hideFlags|=1032,this.node.scene.addChild(t),this._probe.initialize(this.node,t),this.enabled&&eq.probeManager.uk(this._probe),this._probe.resolution=this._resolution,this._probe.clearFlag=this._clearFlag,this._probe.backgroundColor=this._backgroundColor,this._probe.visibility=this._visibility,this._probe.probeType=this._probeType,this._probe.size=this._size,this._probe.cubemap=this._cubemap}},e(i,[{key:"size",get:function(){return this._size},set:function(t){var i;this._size.set(t),(i=this._size).x=Math.abs(i.x),i.y=Math.abs(i.y),i.z=Math.abs(i.z),this.probe.size=this._size,this.probe&&(this.probe.updateBoundingBox(),eq.probeManager.onUpdateProbes(),eq.probeManager.updateProbeData(),eq.probeManager.yk())}},{key:"probeType",get:function(){return this._probeType},set:function(t){if(this.probe.probeType=t,t!==this._probeType){var n=this._size.clone(),e=ir.equals(this._lastSize,ir.ZERO);this._probeType=t,0===this._probeType?(e&&this._size.set(i.Ok),this.probe.switchProbeType(t,null),eq.probeManager.sk(this.probe)):(e&&this._size.set(i.Rk),this._sourceCamera?this.probe.switchProbeType(t,this._sourceCamera.camera):X("the reflection camera is invalid, please set the reflection camera")),e||this._size.set(this._lastSize),this._lastSize.set(n),this.size=this._size}}},{key:"resolution",get:function(){return this._resolution},set:function(t){this._resolution=t,this.probe.resolution=t}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this.probe.clearFlag=this._clearFlag}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this.probe.backgroundColor=this._backgroundColor}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this.probe.visibility=this._visibility}},{key:"sourceCamera",get:function(){return this._sourceCamera},set:function(t){this._sourceCamera=t,t&&(this.visibility=t.visibility,this.clearFlag=t.clearFlags,this.backgroundColor=t.clearColor,1===this.probeType&&this.probe.switchProbeType(this.probeType,t.camera))}},{key:"fastBake",get:function(){return this._fastBake},set:function(t){this._fastBake=t}},{key:"cubemap",get:function(){return this._cubemap},set:function(t){this._cubemap=t,this.probe.cubemap=t,eq.probeManager.onUpdateProbes()}},{key:"probe",get:function(){return this._probe}},{key:"previewSphere",get:function(){return this._previewSphere},set:function(t){this._previewSphere=t,this.probe&&(this.probe.previewSphere=t,this._previewSphere&&eq.probeManager.updatePreviewSphere(this.probe))}},{key:"previewPlane",get:function(){return this._previewPlane},set:function(t){this._previewPlane=t,this.probe&&(this.probe.previewPlane=t,this._previewPlane&&eq.probeManager.updatePreviewPlane(this.probe))}}]),i}(w_),JK.Ok=nr(1,1,1),JK.Rk=nr(5,.5,5),VK=xo((HK=JK).prototype,"_resolution",[oa],(function(){return 256})),$K=xo(HK.prototype,"_clearFlag",[oa],(function(){return 14})),WK=xo(HK.prototype,"_backgroundColor",[oa],(function(){return new cr(0,0,0,255)})),zK=xo(HK.prototype,"_visibility",[oa],(function(){return Lb})),XK=xo(HK.prototype,"_probeType",[oa],(function(){return 0})),YK=xo(HK.prototype,"_cubemap",[oa],(function(){return null})),KK=xo(HK.prototype,"_size",[oa],(function(){return nr(1,1,1)})),qK=xo(HK.prototype,"_sourceCamera",[oa],(function(){return null})),QK=xo(HK.prototype,"_probeId",[oa],(function(){return-1})),ZK=xo(HK.prototype,"_fastBake",[oa],(function(){return!1})),m(HK.prototype,"size",[CK],Object.getOwnPropertyDescriptor(HK.prototype,"size"),HK.prototype),m(HK.prototype,"probeType",[LK],Object.getOwnPropertyDescriptor(HK.prototype,"probeType"),HK.prototype),m(HK.prototype,"resolution",[FK],Object.getOwnPropertyDescriptor(HK.prototype,"resolution"),HK.prototype),m(HK.prototype,"clearFlag",[PK],Object.getOwnPropertyDescriptor(HK.prototype,"clearFlag"),HK.prototype),m(HK.prototype,"backgroundColor",[BK],Object.getOwnPropertyDescriptor(HK.prototype,"backgroundColor"),HK.prototype),m(HK.prototype,"visibility",[DK],Object.getOwnPropertyDescriptor(HK.prototype,"visibility"),HK.prototype),m(HK.prototype,"sourceCamera",[UK],Object.getOwnPropertyDescriptor(HK.prototype,"sourceCamera"),HK.prototype),m(HK.prototype,"fastBake",[xK],Object.getOwnPropertyDescriptor(HK.prototype,"fastBake"),HK.prototype),m(HK.prototype,"cubemap",[GK],Object.getOwnPropertyDescriptor(HK.prototype,"cubemap"),HK.prototype),jK=HK))||jK)),T.utils=DF;var sq,hq,uq,oq,aq,cq="cc.animation.",fq=Symbol("CreateEval");Ko(cq+"EmbeddedPlayer")((sq=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).begin=hq&&hq(),i.end=uq&&uq(),i.reconciledSpeed=oq&&oq(),i.playable=aq&&aq(),i}return s(i,t),i}(Ha),hq=xo(sq.prototype,"begin",[oa],(function(){return 0})),uq=xo(sq.prototype,"end",[oa],(function(){return 0})),oq=xo(sq.prototype,"reconciledSpeed",[oa],(function(){return!1})),aq=xo(sq.prototype,"playable",[oa],(function(){return null})),sq));var vq=function(){},lq=function(){function t(t){this.Ik=t}return t.prototype.setTime=function(){},e(t,[{key:"randomAccess",get:function(){return this.Ik}}]),t}(),dq=function(){function t(){this.Ul=!1,this.Mk=!1,this.Nk=!1}var i=t.prototype;return i.play=function(){this.Ul?this.Mk?(this.Mk=!1,this.onResume()):this.onError(ft(3912)):(this.Ul=!0,this.onPlay())},i.stop=function(){this.Ul&&(this.Ul=!1,this.onStop(),this.Mk=!1)},i.pause=function(){this.Ul&&!this.Mk&&(this.Mk=!0,this.onPause())},i.resume=function(){this.Ul&&this.Mk&&(this.Mk=!1,this.onResume())},i.step=function(){this.pause(),this.Nk=!0,this.Ul||this.play()},i.update=function(){},i.onPlay=function(){},i.onPause=function(){},i.onResume=function(){},i.onStop=function(){},i.onError=function(){},e(t,[{key:"isPlaying",get:function(){return this.Ul}},{key:"isPaused",get:function(){return this.Mk}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),gq={Default:0,Normal:1,Reverse:36,Loop:2,LoopReverse:38,PingPong:22,PingPongReverse:54};Fi(gq);var wq=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}(),_q=function(){function t(t){this.weight=0,this.Ck=void 0,this.Lk=[],this.Ck=t}var i=t.prototype;return i.destroy=function(){for(var t=0;t<this.Lk.length;++t)this.Ck.destroyWriter(this.Lk[t]);this.Lk.length=0},i.createPoseWriter=function(t,i,n){var e=this.Ck.createWriter(t,i,this,n);return this.Lk.push(e),e},t}();function mq(){return k.director.getAnimationManager()}var pq={PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"};Fi(pq);var yq,bq,Aq,Eq=t("AnimationState",function(t){function i(i,n){var e;return void 0===n&&(n=""),(e=t.call(this)||this).duration=1,e.time=0,e.frameRate=0,e._targetNode=null,e._curveLoaded=!1,e.Fk=void 0,e.Pk=1,e.Bk=!1,e.ki=null,e.Dk=1,e.Uk=1,e.Ai=0,e.xk=0,e.Gk=!1,e.de=void 0,e.jk=NaN,e.Hk=null,e.Vk=new wq,e.$k=!1,e.Wk={weight:0},e.zk=0,e.Xk=1,e.Yk=null,e.Kk=1,e.qk=void 0,e.Qk=void 0,e.Zk=void 0,e._doNotCreateEval=!1,e.Fk=i,e.de=n||i&&i.name,e.Jk={min:0,max:i.duration},e.zk=i.duration,i.duration||q("Clip "+i.name+" has zero duration."),e}s(i,t);var n=i.prototype;return n.initialize=function(t,i,n){if(!this._curveLoaded){this._curveLoaded=!0,this.Yk&&(this.Yk.destroy(),this.Yk=null),this.qk&&(this.qk=void 0),this.Qk&&(this.Qk=void 0),this.Zk&&(this.Zk.destroy(),this.Zk=void 0),this._targetNode=t;var e=this.Fk;if(this.duration=e.duration,this.Xk=1/this.duration,this.Pk=e.speed,this.wrapMode=e.wrapMode,this.frameRate=e.sample,this.Jk.min=0,this.Jk.max=e.duration,this.zk=e.duration,2&~this.wrapMode?this.repeatCount=1:this.repeatCount=1/0,!this._doNotCreateEval){var r,s,h,u=null!==(r=null!=i?i:null==(s=mq())?void 0:s.blendState)&&void 0!==r?r:null;u&&(this.Yk=new _q(u)),this.qk=e.createEvaluator({target:t,pose:null!==(h=this.Yk)&&void 0!==h?h:void 0,mask:n})}e.containsAnyEvent()&&(this.Qk=e.createEventEvaluator(this._targetNode)),e.containsAnyEmbeddedPlayer()&&(this.Zk=e.createEmbeddedPlayerEvaluator(this._targetNode),this.Zk.notifyHostSpeedChanged(this.Pk))}},n.destroy=function(){this.isMotionless||mq().removeAnimation(this),this.Yk&&(this.Yk.destroy(),this.Yk=null),this.qk=void 0},n.emit=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];mq().pushDelayEvent(this.tT,this,i)},n.on=function(t,i,n){return this.ki&&this.ki.isValid?this.ki.on(t,i,n):null},n.once=function(t,i,n){return this.ki&&this.ki.isValid?this.ki.once(t,i,n):null},n.off=function(t,i,n){this.ki&&this.ki.isValid&&this.ki.off(t,i,n)},n.allowLastFrameEvent=function(t){this.$k=t},n._setEventTarget=function(t){this.ki=t},n.setTime=function(t){this.Gk=!1,this.time=t||0;var i,n=this.iT(t,this.Vk);null==(i=this.Qk)||i.ignore(n.ratio,n.direction)},n.update=function(t){this.xk>0&&(this.xk-=t,this.xk>0)||(this.Gk?this.time+=t*this.Pk:this.Gk=!0,this.nT())},n.sample=function(){var t=this.iT(this.time,this.Vk);return this._sampleCurves(t.time),this.eT(t),this.rT(t),t},n.onPlay=function(){var t;this.setTime(this.sT()),this.xk=this.Ai,this.hT(),this.emit("play",this),null==(t=this.Zk)||t.notifyHostPlay(this.current)},n.onStop=function(){var t;this.isPaused||this.uT(),this.emit("stop",this),null==(t=this.Zk)||t.notifyHostStop()},n.onResume=function(){var t;this.hT(),this.emit("resume",this),null==(t=this.Zk)||t.notifyHostPlay(this.current)},n.onPause=function(){var t;this.uT(),this.emit("pause",this),null==(t=this.Zk)||t.notifyHostPause(this.current)},n._sampleCurves=function(t){var i=this.Yk,n=this.qk;i&&(i.weight=this.weight),n&&n.evaluate(t)},n.nT=function(){this.Bk?this.oT():this.aT()},n.aT=function(){var t,i=this.sample();this.$k&&(t=this.Hk?this.Hk:this.Hk=new wq(i),this.repeatCount>1&&(0|i.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(i)),i.stopped&&(this.stop(),this.emit("finished",this))},n.oT=function(){var t=this.Jk.min,i=this.zk,n=0,e=0;if(0!==i&&((n=this.time%i)<0&&(n+=i),e=(t+n)*this.Xk),this._sampleCurves(t+n),this.Qk||this.Zk){var r=this.iT(this.time,this.Vk);this.eT(r),this.rT(r)}this.$k&&(Number.isNaN(this.jk)&&(this.jk=e),(this.time>0&&this.jk>e||this.time<0&&this.jk<e)&&this.emit("lastframe",this),this.jk=e)},n.cT=function(t){var i=this.wrapMode,n=!1;return 22&~i||(t-(0|t)==0&&t>0&&(t-=1),1&t&&(n=!n)),36&~i||(n=!n),n},n.iT=function(t,i){i=i||new wq;var n=this.Jk.min,e=this.zk,r=this.repeatCount;if(0===e)return i.time=0,i.ratio=0,i.direction=1,i.stopped=!!Number.isFinite(r),i.iterations=0,i;var s=!1,h=(t-=n)>0?t/e:-t/e;if(h>=r){h=r,s=!0;var u=r-(0|r);0===u&&(u=1),t=u*e*(t>0?1:-1)}if(t>e){var o=t%e;t=0===o?e:o}else t<0&&0!=(t%=e)&&(t+=e);var a=!1,c=4&this.Dk;c&&(a=this.cT(h));var f=a?-1:1;return this.speed<0&&(f*=-1),c&&a&&(t=e-t),i.time=n+t,i.ratio=i.time/this.duration,i.direction=f,i.stopped=s,i.iterations=h,i},n.sT=function(){return this.Jk.min},n.eT=function(t){var i;null==(i=this.Qk)||i.sample(t.ratio,t.direction,t.iterations)},n.rT=function(t){var i;null==(i=this.Zk)||i.evaluate(t.time,Math.trunc(t.iterations))},n.tT=function(t,i){this.ki&&this.ki.isValid&&this.ki.emit(t,t,i)},n.hT=function(){mq().addAnimation(this)},n.uT=function(){mq().removeAnimation(this)},e(i,[{key:"clip",get:function(){return this.Fk}},{key:"name",get:function(){return this.de}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this.Dk},set:function(t){var i;this.Dk=t,this.time=0,this.repeatCount=2&t?1/0:1,null==(i=this.Qk)||i.setWrapMode(t)}},{key:"repeatCount",get:function(){return this.Uk},set:function(t){this.Uk=t;var i=4&this.Dk,n=!(36&~this.wrapMode);this.Bk=t===1/0&&!i&&!n}},{key:"delay",get:function(){return this.Ai},set:function(t){this.xk=this.Ai=t}},{key:"playbackRange",get:function(){return this.Jk},set:function(t){t.max,t.min,this.Jk.min=Math.max(t.min,0),this.Jk.max=Math.min(t.max,this.duration),this.zk=this.Jk.max-this.Jk.min,this.setTime(0)}},{key:"speed",get:function(){return this.Pk},set:function(t){var i;this.Pk=t,null==(i=this.Zk)||i.notifyHostSpeedChanged(t)}},{key:"current",get:function(){return this.iT(this.time).time}},{key:"ratio",get:function(){return 0===this.duration?0:this.current/this.duration}},{key:"weight",get:function(){return this.Kk},set:function(t){this.Kk=t,this.Yk&&(this.Yk.weight=t)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),i}(dq));k.AnimationState=Eq,Ko(cq+"EmbeddedAnimationClipPlayable")((yq=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).path=bq&&bq(),i.clip=Aq&&Aq(),i}return s(i,t),i.prototype.instantiate=function(t){var i=this.clip,n=this.path;if(!i)return null;var e=t.getChildByPath(n);if(!e)return ut(3938,n,t.getPathInHierarchy(),i.name),null;var r=new Eq(i);return r.initialize(e),new Sq(r)},i}(vq),bq=xo(yq.prototype,"path",[oa],(function(){return""})),Aq=xo(yq.prototype,"clip",[oa],(function(){return null})),yq));var kq,Tq,Sq=function(t){function i(i){var n;return(n=t.call(this,!0)||this).fT=void 0,n.fT=i,n}s(i,t);var n=i.prototype;return n.destroy=function(){this.fT.destroy()},n.play=function(){this.fT.play()},n.pause=function(){this.fT.pause()},n.stop=function(){this.fT.stop()},n.setSpeed=function(t){this.fT.speed=t},n.setTime=function(t){this.fT.time=t},i}(lq);Ko(cq+"EmbeddedParticleSystemPlayable")((kq=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).path=Tq&&Tq(),i}return s(i,t),i.prototype.instantiate=function(t){var i=t.getChildByPath(this.path);if(!i)return X("Hierarchy path "+this.path+" does not exists."),null;var n=li("cc.ParticleSystem");if(!n)return X("Particle system is required for embedded particle system player."),null;var e=i.getComponent(n);return e?new Lq(e):(X(this.path+" does not includes a particle system component."),null)},i}(vq),Tq=xo(kq.prototype,"path",[oa],(function(){return""})),kq));var Oq,Rq,Iq,Mq,Nq,Cq,Lq=function(t){function i(i){var n;return(n=t.call(this,!1)||this).vT=void 0,n.vT=i,n}s(i,t);var n=i.prototype;return n.destroy=function(){},n.play=function(){this.vT.play()},n.pause=function(){this.vT.stopEmitting()},n.stop=function(){this.vT.stopEmitting()},n.setSpeed=function(t){this.vT.simulationSpeed=t},i}(lq);function Fq(t){return"string"==typeof t||"number"==typeof t}var Pq,Bq,Dq,Uq,xq,Gq,jq,Hq,Vq,$q,Wq,zq,Xq,Yq,Kq,qq,Qq,Zq=Ko("cc.animation.HierarchyPath")((Rq=function(){function t(t){this.path=Iq&&Iq(),this.path=t||""}return t.prototype.get=function(t){return t instanceof Xp?t.getChildByPath(this.path)||(st(3926,t.name,this.path),null):(st(3925),null)},t}(),Iq=xo(Rq.prototype,"path",[oa],(function(){return""})),Oq=Rq))||Oq,Jq=Ko("cc.animation.ComponentPath")((Nq=function(){function t(t){this.component=Cq&&Cq(),this.component=t||""}return t.prototype.get=function(t){return t instanceof Xp?t.getComponent(this.component)||(st(3928,t.name,this.component),null):(st(3927),null)},t}(),Cq=xo(Nq.prototype,"component",[oa],(function(){return""})),Mq=Nq))||Mq,tQ=Symbol("NormalizedFollow"),iQ=Symbol("ConvertAsTrsPath"),nQ=Symbol("TrackBinding"),eQ=Ko(cq+"TrackPath")((Bq=function(){function t(){this._paths=Dq&&Dq()}var i=t.prototype;return i.toProperty=function(t){return this._paths.push(t),this},i.toElement=function(t){return this._paths.push(t),this},i.toHierarchy=function(t){return this._paths.push(new Zq(t)),this},i.toComponent=function(t){var i=new Jq("string"==typeof t?t:Ht(t));return this._paths.push(i),this},i.toCustomized=function(t){return this._paths.push(t),this},i.append=function(){for(var t,i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];var r=(t=this._paths).concat.apply(t,n.map((function(t){return t._paths})));return this._paths=r,this},i.isPropertyAt=function(t){return"string"==typeof this._paths[t]},i.parsePropertyAt=function(t){return this._paths[t]},i.isElementAt=function(t){return"number"==typeof this._paths[t]},i.parseElementAt=function(t){return this._paths[t]},i.isHierarchyAt=function(t){return this._paths[t]instanceof Zq},i.parseHierarchyAt=function(t){return this.isHierarchyAt(t),this._paths[t].path},i.isComponentAt=function(t){return this._paths[t]instanceof Jq},i.parseComponentAt=function(t){return this.isComponentAt(t),this._paths[t].component},i.slice=function(i,n){var e=new t;return e._paths=this._paths.slice(i,n),e},i.trace=function(t,i,n){var e,r;return null!==(e=i)&&void 0!==e||(i=0),null!==(r=n)&&void 0!==r||(n=this._paths.length),this[tQ](t,i,n)},i[iQ]=function(){for(var t,i=this._paths,n=i.length,e=0,r="";e<n;++e){var s=i[e];if(!(s instanceof Zq))break;s.path&&(r?r+="/"+s.path:r=s.path)}if(e===n)return null;if(e!==n-1)return null;switch(i[e]){case"position":case"scale":case"rotation":case"eulerAngles":t=i[e];break;default:return null}return{node:r,property:t}},i[tQ]=function(t,i,n){for(var e=this._paths,r=t,s=i;s<n;++s){var h=e[s];if(Fq(h)){if(!(h in r))return st(3929,h),null;r=r[h]}else r=h.get(r);if(null===r)break}return r},e(t,[{key:"length",get:function(){return this._paths.length}}]),t}(),Dq=xo(Bq.prototype,"_paths",[oa],(function(){return[]})),Pq=Bq))||Pq,rQ=Ko(cq+"TrackBinding")(Uq=va((Hq=function(){function t(){this.path=Gq&&Gq(),this.proxy=jq&&jq()}var i=t.prototype;return i.parseTrsPath=function(){return this.proxy?null:this.path[iQ]()},i.createRuntimeBinding=function(i,n,e){var r=this.path,s=this.proxy,h=r.length,u=h-1;if(0===h||!r.isPropertyAt(u)&&!r.isElementAt(u)||s){if(s){var o=r[tQ](i,0,h);if(null===o)return null;var a=s.forTarget(o);if(!a)return null;var c={setValue:function(t){a.set(t)}},f=a.get;return f&&(c.getValue=function(){return f.call(a)}),c}return ut(3921),null}var v=r.isPropertyAt(u)?r.parsePropertyAt(u):r.parseElementAt(u),l=r[tQ](i,0,h-1);if(null===l)return null;if(n&&l instanceof Xp&&sQ(v))return n.createPoseWriter(l,v,e);var d=t.lT.get(l.constructor);d||(d=new Map,t.lT.set(l.constructor,d));var g=d.get(v);return g||(g={setValue:Function("value","this.target."+v+" = value;"),getValue:Function("return this.target."+v+";")},d.set(v,g)),{target:l,setValue:g.setValue,getValue:g.getValue}},i.isMaskedOff=function(t){var i=this.parseTrsPath();if(!i)return!1;for(var n=t.joints[Symbol.iterator](),e=n.next();!e.done;e=n.next()){var r=e.value;if(r.path===i.node)return!r.enabled}return!1},t}(),Hq.lT=new WeakMap,Gq=xo((xq=Hq).prototype,"path",[oa],(function(){return new eQ})),jq=xo(xq.prototype,"proxy",[oa],null),Uq=xq))||Uq)||Uq;function sQ(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}var hQ,uQ,oQ=Ko(cq+"Track")(($q=function(){function t(){this._binding=Wq&&Wq()}var i=t.prototype;return i.channels=function(){return[]},i.range=function(){for(var t,i={min:1/0,max:-1/0},n=d(this.channels());!(t=n()).done;){var e=t.value;i.min=Math.min(i.min,e.curve.rangeMin),i.max=Math.max(i.max,e.curve.rangeMax)}return i},e(t,[{key:"path",get:function(){return this._binding.path},set:function(t){this._binding.path=t}},{key:"proxy",get:function(){return this._binding.proxy},set:function(t){this._binding.proxy=t}},{key:nQ,get:function(){return this._binding}}]),t}(),Wq=xo($q.prototype,"_binding",[oa],(function(){return new rQ})),Vq=$q))||Vq,aQ=Ko(cq+"Channel")((Xq=function(){function t(t){this.name="",this._curve=Yq&&Yq(),this._curve=t}return e(t,[{key:"curve",get:function(){return this._curve}}]),t}(),Yq=xo(Xq.prototype,"_curve",[oa],null),zq=Xq))||zq,cQ=Ko(cq+"SingleChannelTrack")((qq=function(t){function i(){var i;return(i=t.call(this)||this)._channel=Qq&&Qq(),i._channel=new aQ(i.createCurve()),i}s(i,t);var n=i.prototype;return n.channels=function(){return[this._channel]},n.createCurve=function(){throw new Error("Not impl")},n[fq]=function(){var t=this._channel.curve;return new fQ(t)},e(i,[{key:"channel",get:function(){return this._channel}}]),i}(oQ),Qq=xo(qq.prototype,"_channel",[oa],null),Kq=qq))||Kq,fQ=function(){function t(t){this.dT=t}return t.prototype.evaluate=function(t){return this.dT.evaluate(t)},e(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),vQ=oa;Ko(cq+"RealArrayTrack")((hQ=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this)._channels=uQ&&uQ(),i}s(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[fq]=function(){return new SQ(this._channels.map((function(t){return t.curve})))},e(i,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var i=this._channels.length;if(t<i)this._channels.splice(t);else if(t>i){var n;(n=this._channels).push.apply(n,Array.from({length:t-i},(function(){return new aQ(new Qc)})))}}}]),i}(oQ),uQ=xo(hQ.prototype,"_channels",[vQ],(function(){return[]})),hQ));var lQ,dQ,gQ,wQ,_Q,mQ,pQ,yQ,bQ,AQ,EQ,kQ,TQ,SQ=function(){function t(t){this.gT=t,this.Td=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var i=this.Td,n=i.length,e=0;e<n;++e)i[e]=this.gT[e].evaluate(t);return this.Td},e(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),OQ=Ko("cc.animation.UniformProxyFactory")((dQ=function(){function t(t,i){this.passIndex=gQ&&gQ(),this.uniformName=wQ&&wQ(),_(this,"channelIndex",_Q,this),this.passIndex=i||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){if(t instanceof Lk){var i=this.passIndex,n=this.uniformName,e=this.channelIndex;if(i<0||i>=t.passes.length)st(3941,t.name,i);else{var r=t.passes[i],s=r.getHandle(n);if(s){if(Vb(s)<26){var h=void 0===e?s:r.getHandle(n,e,13);return h?RQ(r,n)?{set:function(t){r.setUniformArray(h,t)}}:{set:function(t){r.setUniform(h,t)}}:void st(3943,t.name,i,n,e)}var u=$b(s),o=r.properties[n],a=o&&o.value?""+o.value+Jb(o.type):Zb(o.type),c=uk.get(a);return c||(X("Illegal texture default value: "+a+"."),c=uk.get("default-texture")),{set:function(t){t||(t=c);var i=t.getGFXTexture();i&&i.width&&i.height&&(r.bindTexture(u,i),t instanceof zw&&r.bindSampler(u,Hg.gfxDevice.getSampler(t.getSamplerInfo())))}}}st(3942,t.name,i,n)}}else st(3940,t)},t}(),gQ=xo(dQ.prototype,"passIndex",[oa],(function(){return 0})),wQ=xo(dQ.prototype,"uniformName",[oa],(function(){return""})),_Q=m(dQ.prototype,"channelIndex",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),lQ=dQ))||lQ;function RQ(t,i){for(var n,e=d(t.shaderInfo.blocks);!(n=e()).done;)for(var r,s=d(n.value.members);!(r=s()).done;){var h=r.value;if(h.name===i)return h.count>1}return!1}var IQ,MQ,NQ,CQ,LQ,FQ=Ko("cc.animation.MorphWeightValueProxy")((pQ=function(){function t(){this.subMeshIndex=yQ&&yQ(),this.shapeIndex=bQ&&bQ()}return t.prototype.forTarget=function(t){var i=this;return{set:function(n){t.setWeight(n,i.subMeshIndex,i.shapeIndex)}}},t}(),yQ=xo(pQ.prototype,"subMeshIndex",[oa],(function(){return 0})),bQ=xo(pQ.prototype,"shapeIndex",[oa],(function(){return 0})),mQ=pQ))||mQ,PQ=Ko("cc.animation.MorphWeightsValueProxy")((EQ=function(){function t(){this.subMeshIndex=kQ&&kQ()}return t.prototype.forTarget=function(t){var i=this;return{set:function(n){t.setWeights(n,i.subMeshIndex)}}},t}(),kQ=xo(EQ.prototype,"subMeshIndex",[oa],(function(){return 0})),AQ=EQ))||AQ,BQ=Ko("cc.animation.MorphWeightsAllValueProxy")(TQ=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(i){for(var n,e,r=null!==(n=null==(e=t.mesh)?void 0:e.struct.primitives.length)&&void 0!==n?n:0,s=0;s<r;++s)t.setWeights(i,s)}}},t}())||TQ;function DQ(t,i,n,e){var r,s,h,u,o,a=new i,c=new i,f=new i,v=Ko(t)((s=function(){function t(t,n,e){this.dataPoint=h&&h(),this.inTangent=u&&u(),this.outTangent=o&&o(),this.dataPoint=t||new i,this.inTangent=n||new i,this.outTangent=e||new i}var r=t.prototype;return r.lerp=function(t,i,r){var s=this.dataPoint,h=t.dataPoint;c=n(c,this.inTangent,r),f=n(f,t.outTangent,r);var u=i*i*i,o=i*i,v=u-2*o+i,l=-2*u+3*o,d=u-o;return a=n(a,s,2*u-3*o+1),a=e(a,a,c,v),a=e(a,a,h,l),a=e(a,a,f,d)},r.getNoLerp=function(){return this.dataPoint},t}(),h=xo(s.prototype,"dataPoint",[oa],(function(){return new i})),u=xo(s.prototype,"inTangent",[oa],(function(){return new i})),o=xo(s.prototype,"outTangent",[oa],(function(){return new i})),r=s))||r;if(i===Cr){var l=v.prototype.lerp;v.prototype.lerp=function(t,i,n){var e=l.call(this,t,i,n);return Cr.normalize(e,e),e}}return v}var UQ,xQ,GQ,jQ,HQ,VQ=DQ("cc.CubicSplineVec2Value",ls,ls.multiplyScalar,ls.scaleAndAdd),$Q=DQ("cc.CubicSplineVec3Value",ir,ir.multiplyScalar,ir.scaleAndAdd),WQ=DQ("cc.CubicSplineVec4Value",De,De.multiplyScalar,De.scaleAndAdd),zQ=DQ("cc.CubicSplineQuatValue",Cr,Cr.multiplyScalar,Cr.scaleAndAdd),XQ=Ko("cc.CubicSplineNumberValue")((MQ=function(){function t(t,i,n){this.dataPoint=NQ&&NQ(),this.inTangent=CQ&&CQ(),this.outTangent=LQ&&LQ(),this.dataPoint=t,this.inTangent=i,this.outTangent=n}var i=t.prototype;return i.lerp=function(t,i,n){var e=this.dataPoint,r=t.dataPoint,s=i*i*i,h=i*i;return e*(2*s-3*h+1)+this.outTangent*n*(s-2*h+i)+r*(-2*s+3*h)+t.inTangent*n*(s-h)},i.getNoLerp=function(){return this.dataPoint},t}(),NQ=xo(MQ.prototype,"dataPoint",[oa],(function(){return 0})),CQ=xo(MQ.prototype,"inTangent",[oa],(function(){return 0})),LQ=xo(MQ.prototype,"outTangent",[oa],(function(){return 0})),IQ=MQ))||IQ,YQ=Ko(cq+"RealTrack")(UQ=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.createCurve=function(){return new Qc},i}(cQ))||UQ;function KQ(t){return 0===t.keyFramesCount?void 0:t}var qQ,QQ,ZQ,JQ,tZ,iZ,nZ,eZ,rZ=["X","Y","Z","W"],sZ=Ko(cq+"VectorTrack")((GQ=function(t){function i(){var i;(i=t.call(this)||this)._channels=jQ&&jQ(),i._nComponents=HQ&&HQ(),i._channels=new Array(4);for(var n=0;n<i._channels.length;++n){var e=new aQ(new Qc);e.name=rZ[n],i._channels[n]=e}return i}s(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[fq]=function(){switch(this._nComponents){default:case 2:return new hZ(KQ(this._channels[0].curve),KQ(this._channels[1].curve));case 3:return new uZ(KQ(this._channels[0].curve),KQ(this._channels[1].curve),KQ(this._channels[2].curve));case 4:return new oZ(KQ(this._channels[0].curve),KQ(this._channels[1].curve),KQ(this._channels[2].curve),KQ(this._channels[3].curve))}},e(i,[{key:"componentsCount",get:function(){return this._nComponents},set:function(t){this._nComponents=t}}]),i}(oQ),jQ=xo(GQ.prototype,"_channels",[oa],null),HQ=xo(GQ.prototype,"_nComponents",[oa],(function(){return 4})),xQ=GQ))||xQ,hZ=function(){function t(t,i){this.Td=new ls,this.rs=t,this.ss=i}return t.prototype.evaluate=function(t,i){return i&&ls.copy(this.Td,i),this.rs&&(this.Td.x=this.rs.evaluate(t)),this.ss&&(this.Td.y=this.ss.evaluate(t)),this.Td},e(t,[{key:"requiresDefault",get:function(){return!this.rs||!this.ss}}]),t}(),uZ=function(){function t(t,i,n){this.Td=new ir,this.rs=t,this.ss=i,this.wT=n}return t.prototype.evaluate=function(t,i){var n=this.rs,e=this.ss,r=this.wT,s=this.Td;return i&&ir.copy(s,i),n&&(s.x=n.evaluate(t)),e&&(s.y=e.evaluate(t)),r&&(s.z=r.evaluate(t)),s},e(t,[{key:"requiresDefault",get:function(){return!this.rs||!this.ss||!this.wT}}]),t}(),oZ=function(){function t(t,i,n,e){this.Td=new De,this.rs=t,this.ss=i,this.wT=n,this._T=e}return t.prototype.evaluate=function(t,i){return i&&De.copy(this.Td,i),this.rs&&(this.Td.x=this.rs.evaluate(t)),this.ss&&(this.Td.y=this.ss.evaluate(t)),this.wT&&(this.Td.z=this.wT.evaluate(t)),this._T&&(this.Td.w=this._T.evaluate(t)),this.Td},e(t,[{key:"requiresDefault",get:function(){return!(this.rs&&this.ss&&this.wT&&this._T)}}]),t}(),aZ=Ko(cq+"QuatTrack")(qQ=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.createCurve=function(){return new Kf},n[fq]=function(){return new cZ(this.channels()[0].curve)},i}(cQ))||qQ,cZ=function(){function t(t){this.Td=new Cr,this.dT=t}return t.prototype.evaluate=function(t){return this.dT.evaluate(t,this.Td),this.Td},e(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),fZ=["Red","Green","Blue","Alpha"],vZ=Ko(cq+"ColorTrack")((ZQ=function(t){function i(){var i;(i=t.call(this)||this)._channels=JQ&&JQ(),i._channels=new Array(4);for(var n=0;n<i._channels.length;++n){var e=new aQ(new Qc);e.name=fZ[n],i._channels[n]=e}return i}s(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[fq]=function(){return new lZ(KQ(this._channels[0].curve),KQ(this._channels[1].curve),KQ(this._channels[2].curve),KQ(this._channels[3].curve))},i}(oQ),JQ=xo(ZQ.prototype,"_channels",[oa],null),QQ=ZQ))||QQ,lZ=function(){function t(t,i,n,e){this.Td=new cr,this.rs=t,this.ss=i,this.wT=n,this._T=e}return t.prototype.evaluate=function(t,i){return i&&cr.copy(this.Td,i),this.rs&&(this.Td.r=this.rs.evaluate(t)),this.ss&&(this.Td.g=this.ss.evaluate(t)),this.wT&&(this.Td.b=this.wT.evaluate(t)),this._T&&(this.Td.a=this._T.evaluate(t)),this.Td},e(t,[{key:"requiresDefault",get:function(){return!(this.rs&&this.ss&&this.wT&&this._T)}}]),t}(),dZ=["Width","Height"],gZ=Ko(cq+"SizeTrack")((iZ=function(t){function i(){var i;(i=t.call(this)||this)._channels=nZ&&nZ(),i._channels=new Array(2);for(var n=0;n<i._channels.length;++n){var e=new aQ(new Qc);e.name=dZ[n],i._channels[n]=e}return i}s(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[fq]=function(){return new wZ(KQ(this._channels[0].curve),KQ(this._channels[1].curve))},i}(oQ),nZ=xo(iZ.prototype,"_channels",[oa],null),tZ=iZ))||tZ,wZ=function(){function t(t,i){this.Td=new gs,this.xn=t,this.Gn=i}return t.prototype.evaluate=function(t,i){return i&&(this.Td.x=i.x,this.Td.y=i.y),this.xn&&(this.Td.width=this.xn.evaluate(t)),this.Gn&&(this.Td.height=this.Gn.evaluate(t)),this.Td},e(t,[{key:"requiresDefault",get:function(){return!this.xn||!this.Gn}}]),t}(),_Z=Ko(cq+"ObjectTrack")(eZ=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.createCurve=function(){return new rv},i}(cQ))||eZ,mZ=Object.freeze({__proto__:null,ColorTrack:vZ,ComponentPath:Jq,CubicSplineNumberValue:XQ,CubicSplineQuatValue:zQ,CubicSplineVec2Value:VQ,CubicSplineVec3Value:$Q,CubicSplineVec4Value:WQ,HierarchyPath:Zq,MorphWeightValueProxy:FQ,MorphWeightsAllValueProxy:BQ,MorphWeightsValueProxy:PQ,ObjectTrack:_Z,QuatTrack:aZ,RealTrack:YQ,SizeTrack:gZ,Track:oQ,TrackPath:eQ,UniformProxyFactory:OQ,VectorTrack:sZ,isCustomPath:function(t,i){return t instanceof i},isPropertyPath:Fq});t("animation",mZ);var pZ=t("RatioSampler",function(){function t(t){var i,n;this.ratios=void 0,this.mT=void 0,this.ratios=t;for(var e=!0,r=1,s=t.length;r<s;r++)if(i=t[r]-t[r-1],1===r)n=i;else if(Math.abs(i-n)>1e-6){e=!1;break}this.mT=e?EZ:Lo}return t.prototype.sample=function(t){return this.mT(this.ratios,t)},t}());k.RatioSampler=pZ;var yZ=t("AnimCurve",function(){function t(i,n){this.types=void 0,this.type=null,this.pT=[],this.yT=void 0,this.bT=void 0,this.AT=void 0,this.bT=n,this.pT=i.values;var e=function(i){return"string"==typeof i?i:Array.isArray(i)?i[0]===i[1]&&i[2]===i[3]?t.Linear:t.Bezier(i):t.Linear};if(void 0!==i.easingMethod)this.type=e(i.easingMethod);else if(Array.isArray(i.easingMethods))this.types=i.easingMethods.map(e);else if(void 0!==i.easingMethods){this.types=new Array(this.pT.length).fill(null);for(var r=0,s=Object.keys(i.easingMethods);r<s.length;r++){var h=s[r];this.types[h]=e(i.easingMethods[h])}}else this.type=null;var u=i.values[0];(void 0===i.interpolate||i.interpolate)&&(this.yT=MZ(u)),void 0!==i._arrayLength&&(this.AT=new Array(i._arrayLength))}t.Bezier=function(t){return t};var i=t.prototype;return i.hasLerp=function(){return!!this.yT},i.valueAt=function(t){if(void 0===this.AT){var i=this.pT[t];return i&&i.getNoLerp?i.getNoLerp():i}for(var n=0;n<this.AT.length;++n)this.AT[n]=this.pT[this.AT.length*t+n];return this.AT},i.valueBetween=function(t,i,n,e,r){if(this.yT){var s=this.types?this.types[i]:this.type,h=r-n,u=(t-n)/h;if(s&&(u=AZ(u,s)),void 0===this.AT){var o=this.pT[i],a=this.pT[e];return this.yT(o,a,u,h*this.bT)}for(var c=0;c<this.AT.length;++c){var f=this.pT[this.AT.length*i+c],v=this.pT[this.AT.length*e+c];this.AT[c]=this.yT(f,v,u,h*this.bT)}return this.AT}if(void 0===this.AT)return this.valueAt(i);for(var l=0;l<this.AT.length;++l)this.AT[l]=this.pT[this.AT.length*i+l];return this.AT},i.empty=function(){return 0===this.pT.length},i.constant=function(){return 1===this.pT.length},t}());function bZ(t,i,n){var e=i.sample(n);if(e<0)if((e=~e)<=0)e=0;else{if(!(e>=i.ratios.length))return t.valueBetween(n,e-1,i.ratios[e-1],e,i.ratios[e]);e=i.ratios.length-1}return t.valueAt(e)}function AZ(t,i){if("string"==typeof i){var n=Hc[i];n?t=n(t):ut(3906,i)}else Array.isArray(i)&&(t=Wf(i,t));return t}function EZ(t,i){var n=t.length-1;if(0===n)return 0;var e=t[0];if(i<e)return 0;var r=t[n];if(i>r)return n;var s=(i=(i-e)/(r-e))/(1/n),h=0|s,u=1e-6;return s-h<u?h:h+1-s<u?h+1:~(h+1)}yZ.Linear=null,k.AnimCurve=yZ,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,i){this.events.push({func:t||"",params:i||[]})},t}()),k.sampleAnimationCurve=bZ;var kZ,TZ,SZ,OZ,RZ,IZ,MZ=function(){function t(t){var i=new t;return function(n,e,r){return t.lerp(i,n,e,r),i}}function i(t,i,n,e){return t.lerp(i,n,e)}return function(n){if(null!==n){if("number"==typeof n)return ie;if("object"==typeof n&&n.constructor){if(n instanceof Cr)return e=new Cr,function(t,i,n){return Cr.slerp(e,t,i,n)};if(n instanceof Pi)return t(n.constructor);if(n.constructor===Number)return ie;if("function"==typeof n.lerp)return i}var e}}}(),NZ=Ko(cq+"UntypedTrackChannel")((TZ=function(t){function i(){var i;return(i=t.call(this,new Qc)||this).property=SZ&&SZ(),i}return s(i,t),i}(aQ),SZ=xo(TZ.prototype,"property",[oa],(function(){return""})),kZ=TZ))||kZ,CZ=Ko(cq+"UntypedTrack")((RZ=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this)._channels=IZ&&IZ(),i}s(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[fq]=function(){throw new Error("UntypedTrack should be handled specially. Please file an issue.")},n.createLegacyEval=function(t){var i=this,n=function(t){var n;return null==(n=i._channels.find((function(i){return i.property===t})))?void 0:n.curve};switch(!0){default:throw new Error(ft(3931));case t instanceof ls:return new hZ(n("x"),n("y"));case t instanceof ir:return new uZ(n("x"),n("y"),n("z"));case t instanceof De:return new oZ(n("x"),n("y"),n("z"),n("w"));case t instanceof cr:return new lZ(n("r"),n("g"),n("b"),n("a"));case t instanceof gs:return new wZ(n("width"),n("height"))}},n.addChannel=function(t){var i=new NZ;return i.property=t,this._channels.push(i),i},n.upgrade=function(t){var i=this,n=function(t,n){var e=i.channels().find((function(i){return i.property===t}));e&&(n.name=e.name,n.curve.assignSorted(Array.from(e.curve.times()),Array.from(e.curve.values())))},e=t(this.path,this.proxy);switch(e){default:case"size":break;case"vec2":case"vec3":case"vec4":var r=new sZ;r.path=this.path,r.proxy=this.proxy,r.componentsCount="vec2"===e?2:"vec3"===e?3:4;var s=r.channels(),h=s[0],u=s[1],o=s[2],a=s[3];switch(e){case"vec4":n("w",a);case"vec3":n("z",o);default:n("x",h),n("y",u)}return r;case"color":var c=new vZ,f=c.channels(),v=f[0],l=f[1],d=f[2],g=f[3];return n("r",v),n("g",l),n("b",d),n("a",g),n("x",v),n("y",l),n("z",d),n("w",g),c}return null},i}(oQ),IZ=xo(RZ.prototype,"_channels",[oa],(function(){return[]})),OZ=RZ))||OZ,LZ=function(){function t(t){this.ET=[],this.gT=[],this.kT=[],this.TT=[],this.ST=void 0,this.I=null,this.bT=void 0,this.bT=t}var i=t.prototype;return i.getPropertyCurves=function(){return this.ST||this._createPropertyCurves(),this.ST},i.toTracks=function(){for(var t,i=[],n=this.keys,e=this.curves,r=this.commonTargets,s=function(t,i,n){for(var e,r=new eQ,s=d(i);!(e=s()).done;){var h=e.value;"string"==typeof h?r.toProperty(h):"number"==typeof h?r.toElement(h):h instanceof Zq?r.toHierarchy(h.path):h instanceof Jq?r.toComponent(h.component):r.toCustomized(h)}t.path=r,t.proxy=n},h=r.map((function(t){var n=new CZ;return s(n,t.modifiers,t.valueAdapter),i.push(n),n})),u=function(){var e,r=t.value,u=r.data,o=u.values;if(0===o.length)return 0;var a=u.keys<0?[0]:n[u.keys],c=o[0],f=null===(e=u.interpolate)||void 0===e||e;u._arrayLength;var v,l=new PZ(u,a.length),d=function(t){s(t,r.modifiers,r.valueAdapter)};if("number"==typeof r.commonTarget){if(!o.every((function(t){return"number"==typeof t})))return st(3932),0;if(r.valueAdapter||1!==r.modifiers.length||"string"!=typeof r.modifiers[0])return st(3933),0;var g=r.modifiers[0],w=h[r.commonTarget].addChannel(g).curve;v=w}!function(){if("number"==typeof c){if(!o.every((function(t){return"number"==typeof t})))return void st(3934);var t;if(v)t=v;else{var n=new YQ;d(n),i.push(n),t=n.channel.curve}var e=f?0:1;return t.assignSorted(a,o.map((function(t){return{value:t,interpolationMode:e}}))),void l.convert(t)}if("object"==typeof c)switch(!0){default:break;case FZ(o,ls):case FZ(o,ir):case FZ(o,De):var r=c instanceof ls?2:c instanceof ir?3:4,s=new sZ;d(s),s.componentsCount=r;var h=s.channels(),u=h[0].curve,g=h[1].curve,w=h[2].curve,_=h[3].curve,m=f?0:1,p=function(t){return{value:t,interpolationMode:m}};switch(r){case 4:_.assignSorted(a,o.map((function(t){return p(t.w)}))),l.convert(_);case 3:w.assignSorted(a,o.map((function(t){return p(t.z)}))),l.convert(w);default:u.assignSorted(a,o.map((function(t){return p(t.x)}))),l.convert(u),g.assignSorted(a,o.map((function(t){return p(t.y)}))),l.convert(g)}return void i.push(s);case FZ(o,Cr):var y=new aZ;d(y);var b=f?0:1;return y.channel.curve.assignSorted(a,o.map((function(t){return{value:Cr.clone(t),interpolationMode:b}}))),l.convertQuatCurve(y.channel.curve),void i.push(y);case FZ(o,cr):var A=new vZ;d(A);var E=A.channels(),k=E[0].curve,T=E[1].curve,S=E[2].curve,O=E[3].curve,R=f?0:1,I=function(t){return{value:t,interpolationMode:R}};return k.assignSorted(a,o.map((function(t){return I(t.r)}))),l.convert(k),T.assignSorted(a,o.map((function(t){return I(t.g)}))),l.convert(T),S.assignSorted(a,o.map((function(t){return I(t.b)}))),l.convert(S),O.assignSorted(a,o.map((function(t){return I(t.a)}))),l.convert(O),void i.push(A);case FZ(o,gs):var M=new gZ;d(M);var N=M.channels(),C=N[0].curve,L=N[1].curve,F=f?0:1,P=function(t){return{value:t,interpolationMode:F}};return C.assignSorted(a,o.map((function(t){return P(t.width)}))),l.convert(C),L.assignSorted(a,o.map((function(t){return P(t.height)}))),l.convert(L),void i.push(M);case FZ(o,XQ):l.nil;var B=new YQ;d(B);var D=f?2:1;return B.channel.curve.assignSorted(a,o.map((function(t){return{value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:D}}))),void i.push(B);case FZ(o,VQ):case FZ(o,$Q):case FZ(o,WQ):l.nil;var U=c instanceof VQ?2:c instanceof $Q?3:4,x=new sZ;d(x),x.componentsCount=U;var G=x.channels(),j=G[0],H=G[1],V=G[2],$=G[3],W=f?0:1,z=function(t,i,n){return{value:t,leftTangent:i,rightTangent:n,interpolationMode:W}};switch(U){case 4:$.curve.assignSorted(a,o.map((function(t){return z(t.dataPoint.w,t.inTangent.w,t.outTangent.w)})));case 3:V.curve.assignSorted(a,o.map((function(t){return z(t.dataPoint.z,t.inTangent.z,t.outTangent.z)})));default:j.curve.assignSorted(a,o.map((function(t){return z(t.dataPoint.y,t.inTangent.y,t.outTangent.y)}))),H.curve.assignSorted(a,o.map((function(t){return z(t.dataPoint.x,t.inTangent.x,t.outTangent.x)})))}return void i.push(x);case o.every((function(t){return t instanceof zQ})):st(3935)}var X=new _Z;d(X),X.channel.curve.assignSorted(a,o),i.push(X)}()},o=d(e);!(t=o()).done;)u();return i},i._createPropertyCurves=function(){var t=this;this.TT=this.ET.map((function(i){return new pZ(i.map((function(i){return i/t.bT})))})),this.ST=this.gT.map((function(i){return{curve:new yZ(i.data,t.bT),modifiers:i.modifiers,valueAdapter:i.valueAdapter,sampler:t.TT[i.data.keys],commonTarget:i.commonTarget}}))},e(t,[{key:"keys",get:function(){return this.ET},set:function(t){this.ET=t}},{key:"curves",get:function(){return this.gT},set:function(t){this.gT=t,delete this.ST}},{key:"commonTargets",get:function(){return this.kT},set:function(t){this.kT=t}},{key:"data",get:function(){return this.I}}]),t}();function FZ(t,i){return t.every((function(t){return t instanceof i}))}var PZ=function(){function t(t,i){this.OT=void 0;var n=t.easingMethods;Array.isArray(n)?0===n.length&&0!==i?this.OT=new Array(i).fill(null):this.OT=n:this.OT=void 0===n?new Array(i).fill(t.easingMethod):Array.from({length:i},(function(t,i){var e;return null!==(e=n[i])&&void 0!==e?e:null}))}var i=t.prototype;return i.convert=function(t){var i,n,e,r,s,h,u,o,a,c,f,v,l,d,g,w,_,m,p,y,b,A,E=this.OT;if(E){var k=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(E)&&E.length;for(var T=k-1,S=0;S<T;++S){var O=E[S];O&&(Array.isArray(O)?(n=O,e=t.getKeyframeTime(S),r=t.getKeyframeValue(S),s=t.getKeyframeTime(S+1),h=t.getKeyframeValue(S+1),u=void 0,o=void 0,a=void 0,c=void 0,f=void 0,v=void 0,l=void 0,d=void 0,g=void 0,w=void 0,_=void 0,m=void 0,p=void 0,y=void 0,b=void 0,A=void 0,u=n[0],o=n[1],a=n[2],c=n[3],f=r.value,v=3*(s-e),l=3*(h.value-f),w=(1-a)*v,_=(1-c)*l,m=1/3,p=(g=o*l)/(d=u*v),y=Math.sqrt(d*d+g*g)*m,b=_/w,A=Math.sqrt(w*w+_*_)*m,r.interpolationMode=2,r.tangentWeightMode=0===(i=r.tangentWeightMode)?2:1===i?3:i,r.rightTangent=p,r.rightTangentWeight=y,h.tangentWeightMode=aJ(h.tangentWeightMode),h.leftTangent=b,h.leftTangentWeight=A):BZ(O,t,S))}}}},i.convertQuatCurve=function(t){var i=this.OT;if(i){var n=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(i)&&i.length;for(var e=n-1,r=0;r<e;++r){var s=i[r];s&&(Array.isArray(s)?t.getKeyframeValue(r).easingMethod=s.slice():DZ(s,t,r))}}}},e(t,[{key:"nil",get:function(){return!this.OT||this.OT.every((function(t){return null==t}))}}]),t}();function BZ(t,i,n){i.keyFramesCount;var e=i.getKeyframeValue(n),r=oJ[t];1===r?e.interpolationMode=1:(e.interpolationMode=0,e.easingMethod=r)}function DZ(t,i,n){i.keyFramesCount;var e=i.getKeyframeValue(n),r=oJ[t];e.easingMethod=r}var UZ,xZ,GZ,jZ,HZ,VZ,$Z,WZ,zZ,XZ,YZ,KZ,qZ,QZ,ZZ,JZ,tJ,iJ,nJ,eJ,rJ,sJ,hJ,uJ,oJ={constant:1,linear:0,quadIn:2,quadOut:3,quadInOut:4,quadOutIn:5,cubicIn:6,cubicOut:7,cubicInOut:8,cubicOutIn:9,quartIn:10,quartOut:11,quartInOut:12,quartOutIn:13,quintIn:14,quintOut:15,quintInOut:16,quintOutIn:17,sineIn:18,sineOut:19,sineInOut:20,sineOutIn:21,expoIn:22,expoOut:23,expoInOut:24,expoOutIn:25,circIn:26,circOut:27,circInOut:28,circOutIn:29,elasticIn:30,elasticOut:31,elasticInOut:32,elasticOutIn:33,backIn:34,backOut:35,backInOut:36,backOutIn:37,bounceIn:38,bounceOut:39,bounceInOut:40,bounceOutIn:41,smooth:42,fade:43};function aJ(t){return 0===t?1:2===t?3:t}var cJ=Ko,fJ=oa;function vJ(){throw new Error("split() only valid in Editor.")}cJ(cq+"ExoticAnimation")((UZ=function(){function t(){this._nodeAnimations=xZ&&xZ()}var i=t.prototype;return i.createEvaluator=function(t){return new bJ(this._nodeAnimations,t)},i.createEvaluatorForAnimationGraph=function(t){return new kJ(this._nodeAnimations,t)},i.addNodeAnimation=function(t){var i=new lJ(t);return this._nodeAnimations.push(i),i},i.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map((function(t){return t.path}))))},i.split=function(){return vJ()},i.toHashString=function(){return this._nodeAnimations.map((function(t){return t.toHashString()})).join("\n")},t}(),xZ=xo(UZ.prototype,"_nodeAnimations",[fJ],(function(){return[]})),UZ));var lJ=cJ(cq+"ExoticNodeAnimation")((jZ=function(){function t(t){this._path=HZ&&HZ(),this._position=VZ&&VZ(),this._rotation=$Z&&$Z(),this._scale=WZ&&WZ(),this._path=t}var i=t.prototype;return i.createPosition=function(t,i){this._position=new pJ(t,new _J(i))},i.createRotation=function(t,i){this._rotation=new pJ(t,new mJ(i))},i.createScale=function(t,i){this._scale=new pJ(t,new _J(i))},i.createEvaluator=function(t){return new AJ(this._path,this._position,this._rotation,this._scale,t)},i.createEvaluatorForAnimationGraph=function(t){var i=t.bindTransform(this._path);return i?new TJ(i,this._position,this._rotation,this._scale):null},i.split=function(){return vJ()},i.toHashString=function(){var t,i,n,e,r,s;return this._path+"\n"+(null!==(t=null==(i=this._position)?void 0:i.toHashString())&&void 0!==t?t:"")+(null!==(n=null==(e=this._scale)?void 0:e.toHashString())&&void 0!==n?n:"")+(null!==(r=null==(s=this._rotation)?void 0:s.toHashString())&&void 0!==r?r:"")},e(t,[{key:"path",get:function(){return this._path}}]),t}(),HZ=xo(jZ.prototype,"_path",[fJ],(function(){return""})),VZ=xo(jZ.prototype,"_position",[fJ],(function(){return null})),$Z=xo(jZ.prototype,"_rotation",[fJ],(function(){return null})),WZ=xo(jZ.prototype,"_scale",[fJ],(function(){return null})),GZ=jZ))||GZ;function dJ(t){return t.toPrecision(2)}function gJ(t){return t.map((function(t){return Number.parseFloat(dJ(t))})).join(" ")}var wJ=cJ(cq+"ExoticVectorLikeTrackValues")((XZ=function(){function t(t){this._values=YZ&&YZ(),this._isQuantized=KZ&&KZ(),this._values=t}var i=t.prototype;return i.quantize=function(t){this._isQuantized,this._values=FJ(this._values,t),this._isQuantized=!0},i.toHashString=function(){var t=this._isQuantized,i=this._values;return t+" "+(t?i.toHashString():gJ(i))},e(t,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:RJ(this._values)}}]),t}(),YZ=xo(XZ.prototype,"_values",[fJ],null),KZ=xo(XZ.prototype,"_isQuantized",[fJ],(function(){return!1})),zZ=XZ))||zZ,_J=cJ(cq+"ExoticVec3TrackValues")(qZ=function(t){function i(){return t.apply(this,arguments)||this}s(i,t),i.imitate=function(t,n){var e=new i(t);return n._isQuantized&&e.quantize(n._values.quantizationType),e};var n=i.prototype;return n.get=function(t,i){var n=this._values;this._isQuantized?DJ(n,t,i):ir.fromArray(i,n,3*t)},n.lerp=function(t,i,n,e,r,s){var h=this._values;this._isQuantized?(DJ(h,t,e),DJ(h,i,r)):(ir.fromArray(e,h,3*t),ir.fromArray(r,h,3*i)),ir.lerp(s,e,r,n)},i}(wJ))||qZ,mJ=cJ(cq+"ExoticQuatTrackValues")(QZ=function(t){function i(){return t.apply(this,arguments)||this}s(i,t),i.imitate=function(t,n){var e=new i(t);return n._isQuantized&&e.quantize(n._values.quantizationType),e};var n=i.prototype;return n.get=function(t,i){var n=this._values;this._isQuantized?UJ(n,t,i):Cr.fromArray(i,n,4*t)},n.lerp=function(t,i,n,e,r,s){var h=this._values;this._isQuantized?(UJ(h,t,e),UJ(h,i,r)):(Cr.fromArray(e,h,4*t),Cr.fromArray(r,h,4*i)),Cr.slerp(s,e,r,n)},i}(wJ))||QZ,pJ=cJ(cq+"ExoticTrack")((JZ=function(){function t(t,i){this.times=tJ&&tJ(),this.values=iJ&&iJ(),this.times=t,this.values=i}return t.prototype.toHashString=function(){var t=this.times,i=this.values;return"times: "+gJ(t)+"; values: "+i.toHashString()},t}(),tJ=xo(JZ.prototype,"times",[fJ],null),iJ=xo(JZ.prototype,"values",[fJ],null),ZZ=JZ))||ZZ;function yJ(t,i){t.length,t.length;var n=0,e=0,r=Lo(t,i);if(r>=0)n=r;else{var s=~r,h=s-1;n=h;var u=t[s],o=t[h];e=(i-o)/(u-o)}return{index:n,ratio:e}}!function(){function t(){this.RT()}var i=t.prototype;i.calculate=function(t,i,n){if(this.RT(),!(i>n)){var e=t.length;if(e){var r=t[0],s=t[e-1],h=0,u=0;if(i<r);else if(i>=s)h=e-1,u=0;else{var o=yJ(t,i);h=o.index,u=o.ratio}var a=0,c=0;if(n<r);else if(n>=s)a=e-1,c=0;else{var f=yJ(t,n);a=f.index,c=f.ratio}var v=!u,l=!c;h!==a||u!==c?(v||(this.preLerpIndex=h,this.preLerpRatio=u),this.directKeyframesBegin=v?h:h+1,this.directKeyframesEnd=a+1,l||(this.postLerpIndex=a,this.postLerpRatio=c)):v?(this.directKeyframesBegin=h,this.directKeyframesEnd=h+1):(this.preLerpIndex=h,this.preLerpRatio=u)}}},i.RT=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0},e(t,[{key:"keyframesCount",get:function(){var t=this.preLerpIndex,i=this.directKeyframesBegin;return 0+(t<0?0:1)+(this.directKeyframesEnd-i)+(this.postLerpIndex<0?0:1)}}])}();var bJ=function(){function t(t,i){this.IT=void 0,this.IT=t.map((function(t){return t.createEvaluator(i)}))}return t.prototype.evaluate=function(t){this.IT.forEach((function(i){i.evaluate(t)}))},t}(),AJ=function(){function t(t,i,n,e,r){this.Cc=null,this.MT=null,this.yf=null,i&&(this.Cc=BJ(i.times,i.values,ir,t,"position",r)),n&&(this.MT=BJ(n.times,n.values,Cr,t,"rotation",r)),e&&(this.yf=BJ(e.times,e.values,ir,t,"scale",r))}return t.prototype.evaluate=function(t){if(this.Cc){var i=this.Cc.evaluator.evaluate(t);this.Cc.runtimeBinding.setValue(i)}if(this.MT){var n=this.MT.evaluator.evaluate(t);this.MT.runtimeBinding.setValue(n)}if(this.yf){var e=this.yf.evaluator.evaluate(t);this.yf.runtimeBinding.setValue(e)}},t}(),EJ=function(){function t(t,i,n){this.NT=void 0,this.CT={just:!1,index:-1,nextIndex:-1,ratio:0},this.pT=void 0,this.LT=void 0,this.FT=void 0,this.PT=void 0,this.NT=t,this.pT=i,this.LT=new n,this.FT=new n,this.PT=new n}return t.prototype.evaluate=function(t){var i=this.NT,n=this.pT,e=this.PT;if(0===i.length)return e;var r=SJ(i,t,this.CT);return r.just?n.get(r.index,e):n.lerp(r.index,r.nextIndex,r.ratio,this.LT,this.FT,e),e},t}(),kJ=function(){function t(t,i){this.IT=void 0,this.IT=t.map((function(t){return t.createEvaluatorForAnimationGraph(i)})).filter((function(t){return!!t}))}var i=t.prototype;return i.destroy=function(){for(var t=this.IT,i=t.length,n=0;n<i;++n)t[n].destroy()},i.evaluate=function(t,i){for(var n=this.IT,e=n.length,r=0;r<e;++r)n[r].evaluate(t,i)},t}(),TJ=function(){function t(t,i,n,e){this.Cc=null,this.MT=null,this.yf=null,this.BT=void 0,this.BT=t,i&&(this.Cc=new EJ(i.times,i.values,ir)),n&&(this.MT=new EJ(n.times,n.values,Cr)),e&&(this.yf=new EJ(e.times,e.values,ir))}var i=t.prototype;return i.destroy=function(){this.BT.destroy()},i.evaluate=function(t,i){var n=this.BT.index,e=this.Cc,r=this.MT,s=this.yf,h=i.transforms;if(e){var u=e.evaluate(t);h.setPosition(n,u)}if(r){var o=r.evaluate(t);h.setRotation(n,o)}if(s){var a=s.evaluate(t);h.setScale(n,a)}},t}();function SJ(t,i,n){var e=t.length,r=t[0],s=t[e-1];if(i<r)n.just=!0,n.index=0;else if(i>s)n.just=!0,n.index=e-1;else{var h=Lo(t,i);if(h>=0)n.just=!0,n.index=h;else{var u=~h,o=u-1,a=t[o],c=t[u],f=(i-t[o])/(c-a);n.just=!1,n.index=o,n.nextIndex=u,n.ratio=f}}return n}var OJ={uint8:Uint8Array,uint16:Uint16Array};function RJ(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return 0;case 8:return 1}}var IJ,MJ,NJ,CJ,LJ=cJ(cq+"QuantizedFloatArray")((eJ=function(){function t(t,i,n,e){void 0===e&&(e=0),this.originalPrecision=rJ&&rJ(),this.min=sJ&&sJ(),this.extent=hJ&&hJ(),this.values=uJ&&uJ(),this.originalPrecision=t,this.values=i,this.extent=n,this.min=e}return t.prototype.toHashString=function(){var t=this.originalPrecision,i=this.min,n=this.extent,e=this.values;return t+" "+dJ(i)+" "+dJ(n)+" "+e.join(" ")},e(t,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t}(),rJ=xo(eJ.prototype,"originalPrecision",[fJ],null),sJ=xo(eJ.prototype,"min",[fJ],null),hJ=xo(eJ.prototype,"extent",[fJ],null),uJ=xo(eJ.prototype,"values",[fJ],null),nJ=eJ))||nJ;function FJ(t,i){var n=OJ[i],e=1<<n.BYTES_PER_ELEMENT,r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;t.forEach((function(t){r=Math.min(t,r),s=Math.max(t,s)}));var h=s-r,u=n.from(t,(function(t){return(t-r)/h*e}));return new LJ(RJ(t),u,h,r)}function PJ(t,i){return t.values[i]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function BJ(t,i,n,e,r,s){var h=new rQ;h.path=(new eQ).toHierarchy(e).toProperty(r);var u=s(h);return u?{runtimeBinding:u,evaluator:new EJ(t,i,n)}:null}function DJ(t,i,n){ir.set(n,PJ(t,3*i+0),PJ(t,3*i+1),PJ(t,3*i+2))}function UJ(t,i,n){Cr.set(n,PJ(t,4*i+0),PJ(t,4*i+1),PJ(t,4*i+2),PJ(t,4*i+3))}var xJ,GJ,jJ,HJ,VJ,$J,WJ,zJ,XJ,YJ,KJ,qJ,QJ,ZJ,JJ,t0,i0,n0,e0,r0=Ko(cq+"AuxiliaryCurveEntry")((MJ=function(){this.name=NJ&&NJ(),this.curve=CJ&&CJ()},NJ=xo(MJ.prototype,"name",[oa],(function(){return""})),CJ=xo(MJ.prototype,"curve",[oa],(function(){return new Qc})),IJ=MJ))||IJ;function s0(t,i,n){for(var e=t.components,r=e.length,s=0;s<r;++s){var h=e[s],u=h[i];"function"==typeof u&&u.apply(h,n)}}var h0=Symbol("SearchForRootBonePath"),u0=Symbol("ExoticAnimation"),o0=Symbol("[[EmbeddedPlayerCount]]"),a0=Symbol("[[GetEmbeddedPlayers]]"),c0=Symbol("[[AddEmbeddedPlayer]]"),f0=Symbol("[[RemoveEmbeddedPlayer]]"),v0=Symbol("[[ClearEmbeddedPlayers]]"),l0=Symbol("[[Additive Settings]]"),d0=t("AnimationClip",Ko("cc.AnimationClip")((JJ=function(t){function i(i){var n;return(n=t.call(this,i)||this).sample=jJ&&jJ(),n.speed=HJ&&HJ(),n.wrapMode=VJ&&VJ(),n.enableTrsBlending=$J&&$J(),n._duration=WJ&&WJ(),n._hash=zJ&&zJ(),n.DT=0,n._tracks=XJ&&XJ(),n._exoticAnimation=YJ&&YJ(),n.UT=void 0,n.xT=!1,n._events=KJ&&KJ(),n._embeddedPlayers=qJ&&qJ(),n._additiveSettings=QJ&&QJ(),n._auxiliaryCurveEntries=ZJ&&ZJ(),n.GT={ratios:[],eventGroups:[]},n}s(i,t),i.createWithSpriteFrames=function(t,n){var e=new i;e.sample=n||e.sample,e.duration=t.length/e.sample;var r=1/e.sample,s=new _Z;return s.path=(new eQ).toComponent("cc.Sprite").toProperty("spriteFrame"),s.channels()[0].curve.assignSorted(t.map((function(t,i){return[r*i,t]}))),e.addTrack(s),e};var n=i.prototype;return n.onLoaded=function(){this.DT=this.sample,this.events=this._events},n.range=function(){for(var t={min:1/0,max:-1/0},i=this._tracks,n=i.length,e=0;e<n;++e){var r=i[e].range();t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max)}return t},n.getTrack=function(t){return this._tracks[t]},n.addTrack=function(t){var i=this._tracks.length;return this._tracks.push(t),i},n.removeTrack=function(t){this._tracks.splice(t,1)},n.clearTracks=function(){this._tracks.length=0},n.containsAnyEvent=function(){return 0!==this._events.length},n.createEventEvaluator=function(t){return new T0(t,this.GT.ratios,this.GT.eventGroups,this.wrapMode)},n.containsAnyEmbeddedPlayer=function(){return 0!==this._embeddedPlayers.length},n.createEmbeddedPlayerEvaluator=function(t){return new _0(this._embeddedPlayers,t)},n.createEvaluator=function(t){var i=this,n=t.target;return this.jT(n,(function(e){if(!t.mask||!e.isMaskedOff(t.mask)){var r=e.createRuntimeBinding(n,i.enableTrsBlending?t.pose:void 0,!1);return null!=r?r:void 0}}),t.rootMotion)},n.destroy=function(){var i,n=null==(i=k.director.root)?void 0:i.dataPoolManager;return n&&n.releaseAnimationClip(this),KX.destroy(this),t.prototype.destroy.call(this)},n[YX]=function(t,i,n){for(var e=1/i,r=this.HT(),s=r.length,h={},u=0;u<s;++u)h[r[u]]={transforms:Array.from({length:n},(function(){return new Kr}))};var o=r.reduce((function(t,i){return t[i]=new y0,t}),{});for(var a in o){var c=o[a],f=a.lastIndexOf("/");if(f>=0){var v=a.substring(0,f),l=o[v];l&&(c.parent=l)}}for(var d=this.jT(void 0,(function(t){var i=t.parseTrsPath();if(i){var n=o[i.node];if(n)return k0(n,i.property)}}),void 0),g=0;g<n;++g){var w=t+e*g;d.evaluate(w);for(var _=0;_<s;++_){var m=r[_];Kr.copy(h[m].transforms[g],o[m].globalTransform)}for(var p=0;p<s;++p){var y=r[p];o[y].invalidate()}}return{samples:i,frames:n,joints:h}},n.upgradeUntypedTracks=function(t){for(var i=[],n=[],e=this._tracks,r=e.length,s=0;s<r;++s){var h=e[s];if(h instanceof CZ){var u=h.upgrade(t);u&&(i.push(u),n.push(h))}}for(var o=n.length,a=0;a<o;++a)yi(e,n[a]);e.push.apply(e,i)},n[h0]=function(){return this.VT()},n.getPropertyCurves=function(){return this.$T().getPropertyCurves()},n.updateEventDatas=function(){this.events=this._events},n.hasEvents=function(){return 0!==this.events.length},n.syncLegacyData=function(){this.UT&&(this.WT(this.UT),this.UT=void 0)},n[a0]=function(){return this._embeddedPlayers},n[c0]=function(t){this._embeddedPlayers.push(t)},n[f0]=function(t){var i=this._embeddedPlayers.indexOf(t);i>=0&&this._embeddedPlayers.splice(i,1)},n[v0]=function(){this._embeddedPlayers.length=0},n.getAuxiliaryCurveNames_experimental=function(){return this._auxiliaryCurveEntries.map((function(t){return t.name}))},n.hasAuxiliaryCurve_experimental=function(t){return!!this.zT(t)},n.addAuxiliaryCurve_experimental=function(t){var i=this.zT(t);return i||((i=new r0).name=t,this._auxiliaryCurveEntries.push(i)),i.curve},n.getAuxiliaryCurve_experimental=function(t){return this.zT(t).curve},n.renameAuxiliaryCurve_experimental=function(t,i){var n=this.zT(t);n&&(n.name=i)},n.removeAuxiliaryCurve_experimental=function(t){Ai(this._auxiliaryCurveEntries,(function(i){return i.name===t}))},n._trySyncLegacyData=function(){this.xT&&(this.xT=!1,this.syncLegacyData())},n.jT=function(t,i,n){this.xT&&(this.xT=!1,this.syncLegacyData());var e,r=[];n&&(e=this.XT(t,n,r));for(var s,h=[],u=this._tracks,o=u.length,a=0;a<o;++a){var c=u[a];if(!r.includes(c)&&!Array.from(c.channels()).every((function(t){return 0===t.curve.keyFramesCount}))){var f=i(c[nQ]);if(f){var v=void 0;if(c instanceof CZ){if(!f.getValue){ut(3930);continue}var l=f.getValue();v=c.createLegacyEval(l)}else v=c[fq]();h.push(new w0(f,v))}}}return this._exoticAnimation&&(s=this._exoticAnimation.createEvaluator(i)),new m0(h,s,e)},n.XT=function(t,i,n){if(t instanceof Xp){var e=this.VT();if(e){var r=t.getChildByPath(e);if(r){for(var s=new p0,h=[],u=this._tracks,o=u.length,a=0;a<o;++a){var c=u[a],f=c[nQ].parseTrsPath();if(f&&f.node===e){n.push(c);var v=k0(s,f.property);if(v){var l=c[fq]();h.push(new w0(v,l))}}}return new A0(r,this._duration,s,h)}st(3924)}else st(3923)}else ut(3920)},n.VT=function(){var t=this._tracks.map((function(t){var i=t[nQ].parseTrsPath();if(i){var n=i.node;return{path:n,rank:n.split("/").length}}return{path:"",rank:0}}));t.sort((function(t,i){return t.rank-i.rank}));var i=t.findIndex((function(t){return 0!==t.rank}));if(i<0)return"";for(var n=t.length,e=t[i],r=!0,s=i+1;s<n;++s){var h=t[s];if(h.rank!==e.rank)break;if(h.path!==e.path){r=!1;break}}return r?e.path:""},n.$T=function(){return this.UT||(this.UT=this.YT()),this.UT},n.YT=function(){var t=new LZ(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t},n.WT=function(t){for(var i=t.toTracks(),n=i.length,e=0;e<n;++e)this.addTrack(i[e])},n.HT=function(){for(var t=new Set,i=this._tracks,n=i.length,e=0;e<n;++e){var r=i[e][nQ].parseTrsPath();r&&t.add(r.node)}if(this._exoticAnimation)for(var s=this._exoticAnimation.collectAnimatedJoints(),h=s.length,u=0;u<h;++u)t.add(s[u]);return Array.from(t)},n.zT=function(t){return this._auxiliaryCurveEntries.find((function(i){return i.name===t}))},e(i,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var t,i;if(this._hash)return this._hash;var n="Exotic:"+(null!==(t=null==(i=this._exoticAnimation)?void 0:i.toHashString())&&void 0!==t?t:"");return this._hash=Wv(n,666)}},{key:"events",get:function(){return this._events},set:function(t){var i=this;this._events=t;for(var n=[],e=[],r=this.events.sort((function(t,i){return t.frame-i.frame})),s=r.length,h=function(){var t=r[u],s=t.frame/i._duration,h=n.findIndex((function(t){return t===s}));h<0&&(h=n.length,n.push(s),e.push({events:[]})),e[h].events.push({functionName:t.func,parameters:t.params})},u=0;u<s;++u)h();this.GT={ratios:n,eventGroups:e}}},{key:u0,get:function(){return this._exoticAnimation}},{key:u0,set:function(t){this._exoticAnimation=t}},{key:"isAdditive_experimental",get:function(){return this._additiveSettings.enabled}},{key:l0,get:function(){return this._additiveSettings}},{key:"keys",get:function(){return this.$T().keys}},{key:"keys",set:function(t){this.xT=!0,this.$T().keys=t}},{key:"curves",get:function(){return this.xT=!0,this.$T().curves}},{key:"curves",set:function(t){this.$T().curves=t}},{key:"commonTargets",get:function(){return this.$T().commonTargets}},{key:"commonTargets",set:function(t){this.xT=!0,this.$T().commonTargets=t}},{key:"data",get:function(){return this.$T().data}},{key:"eventGroups",get:function(){return this.GT.eventGroups}},{key:o0,get:function(){return this._embeddedPlayers.length}},{key:"auxiliaryCurveCount_experimental",get:function(){return this._auxiliaryCurveEntries.length}}]),i}(kw),JJ.WrapMode=gq,jJ=xo((GJ=JJ).prototype,"sample",[oa],(function(){return 60})),HJ=xo(GJ.prototype,"speed",[oa],(function(){return 1})),VJ=xo(GJ.prototype,"wrapMode",[oa],(function(){return gq.Normal})),$J=xo(GJ.prototype,"enableTrsBlending",[oa],(function(){return!1})),WJ=xo(GJ.prototype,"_duration",[oa],(function(){return 0})),zJ=xo(GJ.prototype,"_hash",[oa],(function(){return 0})),XJ=xo(GJ.prototype,"_tracks",[oa],(function(){return[]})),YJ=xo(GJ.prototype,"_exoticAnimation",[oa],(function(){return null})),KJ=xo(GJ.prototype,"_events",[oa],(function(){return[]})),qJ=xo(GJ.prototype,"_embeddedPlayers",[oa],(function(){return[]})),QJ=xo(GJ.prototype,"_additiveSettings",[oa],(function(){return new g0})),ZJ=xo(GJ.prototype,"_auxiliaryCurveEntries",[oa],(function(){return[]})),xJ=GJ))||xJ),g0=Ko("cc.AnimationClipAdditiveSettings")((i0=function(){this.enabled=n0&&n0(),this.refClip=e0&&e0()},n0=xo(i0.prototype,"enabled",[oa],(function(){return!1})),e0=xo(i0.prototype,"refClip",[oa],(function(){return null})),t0=i0))||t0;k.AnimationClip=d0;var w0=function(){function t(t,i){this.KT=void 0,this.qT=void 0,this.QT=!0,this.KT=t,this.qT=i,this.QT=!!t.getValue&&i.requiresDefault}return t.prototype.evaluate=function(t){var i=this.KT,n=this.qT,e=this.QT?i.getValue():void 0,r=n.evaluate(t,e);i.setValue(r)},t}(),_0=function(){function t(t,i){this.ZT=t,this.JT=t.map((function(t){var n=t.playable;if(!n)return null;var e=n.instantiate(i);return e?{instantiatedPlayer:e,entered:!1,hostPauseTime:0,lastIterations:0}:null}))}var i=t.prototype;return i.destroy=function(){for(var t=this.JT,i=t.length,n=0;n<i;++n){var e;null==(e=t[n])||e.instantiatedPlayer.destroy()}this.JT.length=0},i.evaluate=function(t,i){for(var n=this.ZT,e=this.JT,r=n.length,s=0;s<r;++s){var h=e[s];if(h){var u=h.entered,o=h.instantiatedPlayer,a=h.lastIterations,c=n[s],f=c.begin,v=c.end;if(t>=f&&t<=v?u?i!==a&&(o.stop(),o.play(),h.entered=!0):(o.play(),h.entered=!0):u&&(o.stop(),h.entered=!1),h.lastIterations=i,h.entered){var l=t-f;h.instantiatedPlayer.setTime(l)}}}},i.notifyHostSpeedChanged=function(t){for(var i=this.ZT,n=this.JT,e=i.length,r=0;r<e;++r){var s=n[r];if(s){var h=s.instantiatedPlayer;i[r].reconciledSpeed&&h.setSpeed(t)}}},i.notifyHostPlay=function(t){for(var i=this.ZT,n=this.JT,e=i.length,r=0;r<e;++r){var s=n[r];if(s){var h=i[r],u=h.begin,o=h.end,a=s.instantiatedPlayer;if(s.entered){var c=s.hostPauseTime;if(a.randomAccess||Zn(c,t,1e-5)){var f=Jn(t,u,o);a.play(),a.setTime(f-u)}else a.stop()}}}},i.notifyHostPause=function(t){for(var i=this.ZT,n=this.JT,e=i.length,r=0;r<e;++r){var s=n[r];if(s){var h=s.instantiatedPlayer;s.entered&&(h.pause(),s.hostPauseTime=t)}}},i.notifyHostStop=function(){for(var t=this.ZT,i=this.JT,n=t.length,e=0;e<n;++e){var r=i[e];if(r){var s=r.instantiatedPlayer;r.entered&&(r.entered=!1,s.stop())}}},t}(),m0=function(){function t(t,i,n){this.tS=void 0,this.iS=[],this.nS=void 0,this.iS=t,this.tS=i,this.nS=n}var i=t.prototype;return i.evaluate=function(t){for(var i=this.iS,n=this.tS,e=i.length,r=0;r<e;++r)i[r].evaluate(t);n&&n.evaluate(t)},i.evaluateRootMotion=function(t,i){var n=this.nS;n&&n.evaluate(t,i)},t}(),p0=function(){function t(){this.position=new ir,this.scale=new ir(1,1,1),this.rotation=new Cr,this.eulerAngles=new ir}return t.prototype.getTransform=function(t){Kr.fromRTS(t,this.rotation,this.position,this.scale)},t}(),y0=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).parent=null,i.u_=!0,i.Fn=new Kr,i}return s(i,t),i.prototype.invalidate=function(){this.u_=!0},e(i,[{key:"globalTransform",get:function(){var t=this.Fn;return this.u_&&(this.u_=!1,Kr.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&Kr.multiply(t,this.parent.globalTransform,t)),this.Fn}}]),i}(p0),b0=new Kr,A0=function(){function t(t,i,n,e){this.eS=new Kr,this.rS=new Kr,this.sS=new Kr,this.hS=new Kr,this.uS=new Kr,this.oS=new ir,this.aS=new Cr,this.cS=new ir,this.fS=t,this.bT=i,this.vS=n,this.lS=e}var i=t.prototype;return i.evaluate=function(t,i){var n=this.dS(t,i,this.uS),e=this.oS,r=this.aS,s=this.cS,h=this.fS;Kr.toSRT(n,r,e,s),ir.add(e,e,h.position),h.setPosition(e),Cr.multiply(r,r,h.rotation),h.setRotation(r),ir.multiply(s,s,h.scale),h.setScale(s)},i.dS=function(t,i,n){var e=this.bT,r=e-t,s=this.gS(t,this.sS);if(i<r){var h=this.gS(t+i,this.hS);E0(n,s,h)}else{Kr.identity(n);var u=function(t,i){E0(b0,t,i),Kr.multiply(n,n,b0)},o=i-r,a=Math.floor(o/e),c=o-a*e,f=this.gS(0,this.eS),v=this.gS(e,this.rS),l=this.gS(c,this.hS);u(s,v),E0(b0,f,v);for(var d=0;d<a;++d)Kr.multiply(n,n,b0);u(f,l)}return n},i.gS=function(t,i){for(var n=this.lS,e=n.length,r=0;r<e;++r)n[r].evaluate(t);return this.vS.getTransform(i),i},t}();function E0(t,i,n){Kr.invert(t,i),Kr.multiply(t,n,t)}function k0(t,i){switch(i){default:return;case"position":return{setValue:function(i){ir.copy(t.position,i)}};case"rotation":return{setValue:function(i){Cr.copy(t.rotation,i)}};case"scale":return{setValue:function(i){ir.copy(t.scale,i)}};case"eulerAngles":return{setValue:function(i){ir.copy(t.eulerAngles,i)}}}}var T0=function(){function t(t,i,n,e){this.wS=-1,this.jk=0,this._S=0,this.mS=-1,this.pS=!1,this.yS=t,this.bS=i,this.AS=n,this.Dk=e}var i=t.prototype;return i.setWrapMode=function(t){this.Dk=t},i.ignore=function(t,i){this.mS=-1,this.pS=!1;var n=O0(t,this.bS);n<0&&(n=~n-1,i<0&&(n+=1),this.mS=n)},i.reset=function(){this.wS=-1,this.jk=0,this._S=0,this.mS=-1,this.pS=!1},i.sample=function(t,i,n){if(0!==this.AS.length){var e=this.AS.length,r=O0(t,this.bS);if(r<0&&(r=~r-1,i<0&&(r+=1)),this.mS!==r&&(this.mS=-1),!this.pS)return this.pS=!0,this.ES(r,!1),this.wS=r,this.jk=n,void(this._S=i);var s=this.Dk,h=S0(n),u=S0(this.jk),o=this.wS,a=this._S,c=-1!==u&&h!==u;if(o===r&&c&&1===e)this.ES(0,!1);else if(o!==r||c){i=a;do{if(o!==r){if(-1===i&&0===o&&r>0?(22&~s?o=e:i*=-1,u++):1===i&&o===e-1&&r<e-1&&(22&~s?o=-1:i*=-1,u++),o===r)break;if(u>h)break}o+=i,this.ES(o,!0)}while(o!==r&&o>-1&&o<e)}this.wS=r,this.jk=n,this._S=i}},i.ES=function(t,i){i?mq().pushDelayEvent(this.kS,this,[t]):this.kS(t)},i.kS=function(t){if(this.yS&&this.yS.isValid){var i=this.AS;if(!(t<0||t>=i.length||this.mS===t))for(var n=i[t],e=n.events.length,r=0;r<e;++r){var s=n.events[r];s0(this.yS,s.functionName,s.parameters)}}},t}();function S0(t){return t-(0|t)==0&&(t-=1),0|t}function O0(t,i){return Lo(i,t)}var R0,I0,M0=function(){function t(){this._nodeBlendStates=new Map}var i=t.prototype;return i.createWriter=function(t,i,n,e){var r=this.ref(t,i);return new N0(t,i,r,n,e)},i.destroyWriter=function(t){var i=t;this.deRef(i.node,i.property)},i.ref=function(t,i){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,i)},i.deRef=function(t,i){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(i),n.empty&&this._nodeBlendStates.delete(t))},i.apply=function(){this._nodeBlendStates.forEach((function(t,i){t.apply(i)}))},t}(),N0=function(){function t(t,i,n,e,r){this._node=t,this._property=i,this._propertyBlendState=n,this._host=e,this._constants=r}var i=t.prototype;return i.getValue=function(){return this._node[this._property]},i.setValue=function(t){var i=this._propertyBlendState,n=this._host.weight;i.blend(t,n)},e(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}(),C0=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new ir}var i=t.prototype;return i.blend=function(t,i){this.accumulatedWeight=D0(this.result,this.result,this.accumulatedWeight,t,i)},i.reset=function(){this.accumulatedWeight=0,ir.zero(this.result)},t}(),L0=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new Cr}var i=t.prototype;return i.blend=function(t,i){this.accumulatedWeight=U0(this.result,this.result,this.accumulatedWeight,t,i)},i.reset=function(){this.accumulatedWeight=0,Cr.identity(this.result)},t}(),F0=function(){function t(){this._transformApplyFlags=0,this._properties={}}var i=t.prototype;return i.refProperty=function(t,i){var n,e,r,s=this._properties;switch(i){default:case"position":case"scale":case"eulerAngles":r=null!==(n=s[i])&&void 0!==n?n:s[i]=this._createVec3BlendState(t[i]);break;case"rotation":r=null!==(e=s[i])&&void 0!==e?e:s[i]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},i.deRefProperty=function(t){var i=this._properties,n=i[t];n&&(--n.refCount,n.refCount>0||delete i[t])},i.apply=function(t){var i,n,e,r=this._transformApplyFlags,s=this._properties,h=s.position,u=s.scale,o=s.rotation,a=s.eulerAngles;r&&(h&&1&r&&(i=h.result),u&&4&r&&(n=u.result),a&&8&r&&(e=a.result),o&&2&r&&(e=o.result),(e||i||n)&&t.setRTS(e,i,n),this._transformApplyFlags=0)},e(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),P0=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.apply=function(i){var n=this._properties,e=n.position,r=n.scale,s=n.rotation,h=n.eulerAngles;e&&e.accumulatedWeight&&(this._transformApplyFlags|=1,e.accumulatedWeight<1&&e.blend(i.position,1-e.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=4,r.accumulatedWeight<1&&r.blend(i.scale,1-r.accumulatedWeight)),h&&h.accumulatedWeight&&(this._transformApplyFlags|=8,h.accumulatedWeight<1&&h.blend(i.eulerAngles,1-h.accumulatedWeight)),s&&s.accumulatedWeight&&(this._transformApplyFlags|=2,s.accumulatedWeight<1&&s.blend(i.rotation,1-s.accumulatedWeight)),t.prototype.apply.call(this,i),null==e||e.reset(),null==r||r.reset(),null==s||s.reset(),null==h||h.reset()},n._createVec3BlendState=function(){return new C0},n._createQuatBlendState=function(){return new L0},i}(F0),B0=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i.prototype.createNodeBlendState=function(){return new P0},i}(M0);function D0(t,i,n,e,r){var s=n+r;if(1!==r||n){if(s){var h=r/s;ir.lerp(t,t,e,h)}}else ir.copy(t,e);return s}function U0(t,i,n,e,r){var s=n+r;if(1!==r||n){if(s){var h=r/s;Cr.slerp(t,i,e,h)}}else Cr.copy(t,e);return s}var x0=t("AnimationManager",Ko((I0=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).TS=new _i([]),i.SS=new _i([]),i.IS=[],i.MS=new B0,i.NS=[],i}s(i,t);var n=i.prototype;return n.addCrossFade=function(t){-1===this.SS.array.indexOf(t)&&this.SS.push(t)},n.removeCrossFade=function(t){var i=this.SS.array.indexOf(t);i>=0?this.SS.fastRemoveAt(i):ut(3907)},n.update=function(t){var i=this.IS,n=this.SS,e=this.NS,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var s=this.TS,h=s.array;for(s.i=0;s.i<h.length;++s.i){var u=h[s.i];u.isMotionless||u.update(t)}this.MS.apply();for(var o=xC.getTotalFrames(),a=0,c=e.length;a<c;a++){var f=e[a],v=f.target,l=f.transform;v.matrix=vY(l,o)}for(var d=0,g=i.length;d<g;d++){var w=i[d];w.fn.apply(w.thisArg,w.args)}i.length=0},n.destruct=function(){},n.addAnimation=function(t){-1===this.TS.array.indexOf(t)&&this.TS.push(t)},n.removeAnimation=function(t){var i=this.TS.array.indexOf(t);i>=0?this.TS.fastRemoveAt(i):ut(3907)},n.pushDelayEvent=function(t,i,n){this.IS.push({fn:t,thisArg:i,args:n})},n.addSockets=function(t,i){for(var n=this,e=function(){var e=i[r];if(n.NS.find((function(t){return t.target===e.target})))return 1;var s=t.getChildByPath(e.path),h=e.target&&s&&lY(s,t);h&&n.NS.push({target:e.target,transform:h})},r=0;r<i.length;++r)e()},n.removeSockets=function(t,i){for(var n=0;n<i.length;++n)for(var e=i[n],r=0;r<this.NS.length;++r){var s=this.NS[r];if(s.target===e.target){dY(s.transform.node),this.NS[r]=this.NS[this.NS.length-1],this.NS.length--;break}}},e(i,[{key:"blendState",get:function(){return this.MS}}]),i}(Pv),I0.ID="animation",R0=I0))||R0);xC.on("director_init",(function(){var t=new x0;xC.registerSystem(x0.ID,t,200)})),k.AnimationManager=x0;var G0,j0,H0,V0,$0,W0,z0,X0,Y0,K0,q0,Q0=function(t){function i(i){var n;return(n=t.call(this)||this).CS=[],n.LS=[],n.FS=!1,n.wi=null!=i?i:mq(),n}s(i,t);var n=i.prototype;return n.update=function(t){if(!this.isMotionless){var i=this.CS,n=this.LS;if(1===i.length&&1===n.length){var e=i[0].state;e&&(e.weight=1)}else this.PS(t);1===i.length&&1===n.length&&this.BS()}},n.crossFade=function(t,i){var n;0===this.CS.length&&(i=0),0===i&&this.clear();var e=this.CS.find((function(i){return i.state===t}));e?null!=(n=e.state)&&n.isMotionless&&e.state.play():(e={state:t,reference:0},t&&t.play(),this.CS.push(e)),++e.reference,this.LS.unshift({easeDuration:i,easeTime:0,target:e}),this.isMotionless||this.DS()},n.clear=function(){for(var t=0;t<this.CS.length;++t){var i=this.CS[t].state;i&&i.stop()}this.CS.length=0,this.LS.length=0},n.onPlay=function(){t.prototype.onPlay.call(this),this.DS()},n.onPause=function(){t.prototype.onPause.call(this);for(var i=0;i<this.CS.length;++i){var n=this.CS[i].state;n&&n.pause()}this.BS()},n.onResume=function(){t.prototype.onResume.call(this);for(var i=0;i<this.CS.length;++i){var n=this.CS[i].state;n&&n.resume()}this.DS()},n.onStop=function(){t.prototype.onStop.call(this),this.clear()},n.PS=function(t){for(var i=this.CS,n=this.LS,e=0;e<i.length;++e){var r=i[e].state;r&&(r.weight=0)}for(var s=1,h=n.length,u=0;u<n.length;++u){var o=n[u];o.easeTime+=t;var a=0===o.easeDuration?1:te(o.easeTime/o.easeDuration),c=a*s;if(s*=1-a,o.target.state&&(o.target.state.weight+=c),o.easeTime>=o.easeDuration){h=u+1,o.easeTime=o.easeDuration;break}}if(h!==n.length){for(var f=h;f<n.length;++f){var v=n[f];--v.target.reference,v.target.reference<=0&&(v.target.state&&v.target.state.stop(),yi(this.CS,v.target))}n.splice(h)}},n.DS=function(){this.FS||(this.wi.addCrossFade(this),this.FS=!0)},n.BS=function(){this.FS&&(this.wi.removeCrossFade(this),this.FS=!1)},i}(dq),Z0=(G0=Ko("cc.Animation"),j0=Qo(99),H0=Ca([d0]),V0=Ca(d0),$0=Ca([d0]),G0(W0=j0((q0=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(i=t.call.apply(t,[this].concat(e))||this).playOnLoad=X0&&X0(),i._crossFade=new Q0,i._nameToState=jt(!0),i._clips=Y0&&Y0(),i._defaultClip=K0&&K0(),i.US=!1,i}s(i,t);var n=i.prototype;return n.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},n.start=function(){this.playOnLoad&&!this.US&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=jt(!0)},n.play=function(t){if(this.US=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},n.crossFade=function(t,i){void 0===i&&(i=.3),this.US=!0;var n=this._nameToState[t];n&&this.doPlayOrCrossFade(n,i)},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getState=function(t){var i=this._nameToState[t];return i&&!i.curveLoaded&&i.initialize(this.node),i||null},n.createState=function(t,i){return i=i||t.name,this.removeState(i),this._doCreateState(t,i)},n.removeState=function(t){var i=this._nameToState[t];i&&(i.allowLastFrameEvent(!1),i.stop(),delete this._nameToState[t])},n.addClip=function(t,i){return Ei(this._clips,t)||this._clips.push(t),this.createState(t,i)},n.removeClip=function(t,i){var n;for(var e in this._nameToState){var r=this._nameToState[e];if(r.clip===t){n=r;break}}if(t===this._defaultClip){if(!i)return void st(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!i)return void st(3903);n.stop()}this._clips=this._clips.filter((function(i){return i!==t})),n&&delete this._nameToState[n.name]},n.on=function(i,n,e,r){var s=t.prototype.on.call(this,i,n,e,r);return"lastframe"===i&&this.xS(),s},n.once=function(i,n,e){var r=t.prototype.once.call(this,i,n,e);return"lastframe"===i&&this.xS(),r},n.off=function(i,n,e){t.prototype.off.call(this,i,n,e),"lastframe"===i&&this.GS()},n._createState=function(t,i){return new Eq(t,i)},n._doCreateState=function(t,i){var n=this._createState(t,i);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener("lastframe")),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n.doPlayOrCrossFade=function(t,i){this._crossFade.play(),this._crossFade.crossFade(t,i)},n.jS=function(t){for(var i in this._nameToState){var n=this._nameToState[i];J0(t,n.clip)&&(n.stop(),delete this._nameToState[i])}},n.xS=function(){if(this.hasEventListener("lastframe"))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},n.GS=function(){if(!this.hasEventListener("lastframe"))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},e(i,[{key:"clips",get:function(){return this._clips},set:function(t){var i=this;this._crossFade&&this._crossFade.clear(),this._clips.forEach((function(t){t&&i.jS(t)})),t.forEach((function(t){t&&i.createState(t)}));var n=t.find((function(t){return J0(t,i._defaultClip)}));this._defaultClip=n||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(i){return J0(i,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),i}(Su(w_)),q0.EventType=pq,m((z0=q0).prototype,"clips",[H0],Object.getOwnPropertyDescriptor(z0.prototype,"clips"),z0.prototype),m(z0.prototype,"defaultClip",[V0],Object.getOwnPropertyDescriptor(z0.prototype,"defaultClip"),z0.prototype),X0=xo(z0.prototype,"playOnLoad",[oa],(function(){return!1})),Y0=xo(z0.prototype,"_clips",[$0],(function(){return[]})),K0=xo(z0.prototype,"_defaultClip",[oa],(function(){return null})),W0=z0))||W0)||W0);function J0(t,i){return t===i||!!t&&!!i&&t._uuid===i._uuid&&t._uuid}t({Animation:Z0,AnimationComponent:Z0}),k.Animation=Z0,k.AnimationComponent=Z0,ai(Z0,"cc.AnimationComponent"),T.log=z,T.warn=X,T.error=Y,T.assert=K,T._throw=Z,T.logID=it,T.warnID=st,T.errorID=ut,T.assertID=at,T.debug=pt,T.path={join:Gu,extname:ju,mainFileName:Hu,basename:Vu,dirname:$u,changeExtname:Wu,changeBasename:zu,_normalize:Xu,stripSep:Yu,get sep(){return Ku()}};var t1=1,i1=-4192741,n1=[];function e1(t){return"function"==typeof t._instantiate}function r1(t){var i;if(_u(t)){if(e1(t))return k.game._isCloning=!0,i=t._instantiate(null,!0),k.game._isCloning=!1,i;if(t instanceof k.Asset)throw new TypeError(ft(6903))}return k.game._isCloning=!0,i=s1(t),k.game._isCloning=!1,i}function s1(t,i){var n;u1(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),i);for(var e=0,r=n1.length;e<r;++e)n1[e]._iN$t=null;return n1.length=0,n}function h1(t,i,n,e){for(var r=t.__values__,s=0;s<r.length;s++){var h=r[s],u=i[h];if("object"==typeof u&&u){var o=n[h];o instanceof Pi&&o.constructor===u.constructor?o.set(u):n[h]=u._iN$t||o1(u,e)}else n[h]=u}}function u1(t,i,n){Dt(t,"_iN$t",i,!0),n1.push(t);var e=t.constructor;if(xn(e))h1(e,t,i,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r||"__prefab"===r)){var s=t[r];if("object"==typeof s&&s){if(s===i)continue;i[r]=s._iN$t||o1(s,n)}else i[r]=s}_u(t)&&(i._objFlags&=i1)}function o1(t,i){if(t instanceof Pi)return t.clone();if(t instanceof k.Asset)return t;var n;if(ArrayBuffer.isView(t)){var e=t.length;n=new t.constructor(e),t._iN$t=n,n1.push(t);for(var r=0;r<e;++r)n[r]=t[r];return n}if(Array.isArray(t)){var s=t.length;n=new Array(s),t._iN$t=n,n1.push(t);for(var h=0;h<s;++h){var u=t[h];n[h]="object"==typeof u&&u?u._iN$t||o1(u,i):u}return n}if(t._objFlags&t1)return null;var o=t.constructor;if(xn(o)){if(i)if(i instanceof w_){if(t instanceof Xp||t instanceof w_)return t}else if(i instanceof Xp)if(t instanceof Xp){if(!t.isChildOf(i))return t}else if(t instanceof w_&&t.node&&!t.node.isChildOf(i))return t;n=new o}else if(o===Object)n={};else{if(o)return t;n=Object.create(null)}return u1(t,n,i),n}r1._clone=s1,k.instantiate=r1;var a1,c1,f1=t("NodePool",function(){function t(t){this._=[],this.poolHandlerComp=t}var i=t.prototype;return i.size=function(){return this._.length},i.clear=function(){for(var t=this._.length,i=0;i<t;++i)this._[i].destroy();this._.length=0},i.put=function(t){if(t&&-1===this._.indexOf(t)){t.removeFromParent();var i=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;i&&i.unuse&&i.unuse(),this._.push(t)}},i.get=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var e=this._.length-1;if(e<0)return null;var r=this._[e];this._.length=e;var s=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return s&&s.reuse&&s.reuse(arguments),r},t}());T.NodePool=f1;var v1=null!==(a1=globalThis.jsb)&&void 0!==a1?a1:{};t("native",{DownloaderHints:v1.DownloaderHints,Downloader:v1.Downloader,zipUtils:v1.zipUtils,fileUtils:v1.fileUtils,DebugRenderer:v1.DebugRenderer,copyTextToClipboard:null==(c1=v1.copyTextToClipboard)?void 0:c1.bind(v1),garbageCollect:v1.garbageCollect,reflection:v1.reflection,bridge:v1.bridge,jsbBridgeWrapper:v1.jsbBridgeWrapper,AssetsManager:v1.AssetsManager,EventAssetsManager:v1.EventAssetsManager,Manifest:v1.Manifest,saveImageData:v1.saveImageData,process:v1.process,adpf:v1.adpf}),T.renderer=qU;var l1=function(t){function i(){var i;return(i=t.call(this)||this).HS=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.Xn=t.layout;var i=t.layout.gpuDescriptorSetLayout,n=i.VS,e=i.$S,r=i.WS;this.Yn=Array(r).fill(null),this.Kn=Array(r).fill(null),this.En=Array(r).fill(null);var s=[];this.HS={zS:s,$S:e};for(var h=0;h<n.length;++h)for(var u=n[h],o=0;o<u.count;o++){var a={XS:u.descriptorType,YS:null,KS:null,qS:null};s.push(a)}},n.destroy=function(){this.Xn=null,this.HS=null},n.update=function(){if(this.qn&&this.HS){for(var t=this.HS.zS,i=0;i<t.length;++i)if(t[i].XS&ig){var n=this.Yn[i];n&&(t[i].YS=n.gpuBuffer||n.gpuBufferView)}else t[i].XS&ng&&(this.Kn[i]&&(t[i].KS=this.Kn[i].gpuTexture),this.En[i]&&(t[i].qS=this.En[i].gpuSampler));this.qn=!1}},e(i,[{key:"gpuDescriptorSet",get:function(){return this.HS}}]),i}(yg),d1=Math.max,g1=Math.min;function w1(t){switch(t){case 4:case 6:case 14:case 16:case 24:case 25:case 27:case 36:case 35:case 37:case 39:case 51:case 53:case 56:case 58:case 60:case 61:case 62:case 63:case 64:case 66:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 79:case 81:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:default:return 5121;case 5:case 7:case 15:case 17:case 26:case 28:case 38:case 40:case 65:case 67:case 80:case 82:return 5120;case 8:case 18:case 29:case 41:return 36193;case 9:case 19:case 30:case 42:return 5123;case 10:case 20:case 31:case 43:return 5122;case 11:case 21:case 32:case 44:case 48:case 69:case 68:return 5126;case 12:case 22:case 33:case 45:case 52:case 54:return 5125;case 13:case 23:case 34:case 46:return 5124;case 47:return 33635;case 49:return 32820;case 50:return 32819;case 55:return 34042}}function _1(t){switch(t){case 47:return 36194;case 49:return 32855;case 50:return 32854;case 41:return 34842;case 44:return 34836;case 37:return 35907;case 54:return 33189;case 55:return 34041;default:return ut(16309),6408}}function m1(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 24:case 29:case 32:case 47:return 6407;case 36:case 35:case 37:case 41:case 44:case 49:case 50:return 6408;case 54:return 6402;case 55:return 34041;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ut(16310),6408}}function p1(t){switch(t){case 1:return 35670;case 2:return 35671;case 3:return 35672;case 4:return 35673;case 5:return 5124;case 6:return 35667;case 7:return 35668;case 8:return 35669;case 9:return 5125;case 13:return 5126;case 14:return 35664;case 15:return 35665;case 16:return 35666;case 17:return 35674;case 21:return 35675;case 25:return 35676;case 28:return 35678;case 31:return 35680;default:return ut(16311),0}}function y1(t){switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return Int32Array;case 13:case 14:case 15:case 16:case 17:case 21:case 25:return Float32Array;default:return ut(16312),Float32Array}}function b1(t){switch(t){case 35670:return 1;case 35671:return 2;case 35672:return 3;case 35673:return 4;case 5124:return 5;case 35667:return 6;case 35668:return 7;case 35669:return 8;case 5125:return 9;case 5126:return 13;case 35664:return 14;case 35665:return 15;case 35666:return 16;case 35674:return 17;case 35675:return 21;case 35676:return 25;case 35678:return 28;case 35680:return 31;default:return ut(16313),0}}function A1(t){switch(t){case 35670:case 5124:case 5125:case 5126:case 35678:case 35680:return 4;case 35671:case 35667:case 35664:return 8;case 35672:case 35668:case 35665:return 12;case 35673:case 35669:case 35666:case 35674:return 16;case 35675:return 36;case 35676:return 64;default:return ut(16314),0}}function E1(t){switch(t){case 35674:return 2;case 35675:return 3;case 35676:return 4;default:return 1}}var k1=[512,513,514,515,516,517,518,519],T1=[0,7680,7681,7682,7683,5386,34055,34056],S1=[32774,32778,32779,32775,32776],O1=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];function R1(t,i){var n=t.gl,e=t.stateCache,r=2&i.QS?35048:35044;if(8&i.ZS){i.JS=34962;var s=n.createBuffer();s&&(i.tO=s,i.iO>0&&(t.extensions.nO&&e.eO&&(t.extensions.rO.bindVertexArrayOES(null),e.eO=null),x1.gpuInputAssembler=null,e.sO!==i.tO&&(n.bindBuffer(34962,i.tO),e.sO=i.tO),n.bufferData(34962,i.iO,r),n.bindBuffer(34962,null),e.sO=null))}else if(4&i.ZS){i.JS=34963;var h=n.createBuffer();h&&(i.tO=h,i.iO>0&&(t.extensions.nO&&e.eO&&(t.extensions.rO.bindVertexArrayOES(null),e.eO=null),x1.gpuInputAssembler=null,e.hO!==i.tO&&(n.bindBuffer(34963,i.tO),e.hO=i.tO),n.bufferData(34963,i.iO,r),n.bindBuffer(34963,null),e.hO=null))}else 16&i.ZS?(i.JS=0,i.uO&&(i.vf32=new Float32Array(i.uO.buffer))):(64&i.ZS||2&i.ZS||1&i.ZS||ut(16315),i.JS=0)}function I1(t,i){var n=t.gl,e=t.stateCache;if(i.tO){switch(i.JS){case 34962:t.extensions.nO&&e.eO&&(t.extensions.rO.bindVertexArrayOES(null),e.eO=null),x1.gpuInputAssembler=null,n.bindBuffer(34962,null),e.sO=null;break;case 34963:t.extensions.nO&&e.eO&&(t.extensions.rO.bindVertexArrayOES(null),e.eO=null),x1.gpuInputAssembler=null,n.bindBuffer(34963,null),e.hO=null}n.deleteBuffer(i.tO),i.tO=null}}function M1(t,i,n,e,r){if(16&i.ZS)ArrayBuffer.isView(n)?i.vf32.set(n,e/4):i.vf32.set(new Float32Array(n),e/4);else if(64&i.ZS){i.aO.oO();for(var s=n.drawInfos,h=0;h<s.length;++h)i.aO.cO(e+h,s[h])}else{var u=n,o=t.gl,a=t.stateCache;switch(i.JS){case 34962:t.extensions.nO&&a.eO&&(t.extensions.rO.bindVertexArrayOES(null),a.eO=null),x1.gpuInputAssembler=null,a.sO!==i.tO&&(o.bindBuffer(34962,i.tO),a.sO=i.tO);break;case 34963:t.extensions.nO&&a.eO&&(t.extensions.rO.bindVertexArrayOES(null),a.eO=null),x1.gpuInputAssembler=null,a.hO!==i.tO&&(o.bindBuffer(34963,i.tO),a.hO=i.tO);break;default:return void ut(16316)}Bu.os===Nu.IOS&&2&i.QS&&0===e&&r===u.byteLength?o.bufferData(i.JS,u,o.DYNAMIC_DRAW):r===u.byteLength?o.bufferSubData(i.JS,e,u):o.bufferSubData(i.JS,e,u.slice(0,r))}}function N1(t,i){var n=t.gl,e=t.stateCache;i.fO=i.vO=m1(i.lO),i.dO=w1(i.lO);var r=i.gO,s=i.wO;switch(i.XS){case 1:i.JS=3553;var h=d1(r,s);if(h>t.capabilities.maxTextureSize&&ut(9100,h,t.capabilities.maxTextureSize),t.textureExclusive[i.lO]||t.extensions._O||!tg[i.lO].hasDepth){if(i.mO=n.createTexture(),i.iO>0){var u=e.pO[e.yO];if(u.mO!==i.mO&&(n.bindTexture(3553,i.mO),u.mO=i.mO),tg[i.lO].isCompressed)for(var o=0;o<i.bO;++o){var a=sg(i.lO,r,s,1),c=new Uint8Array(a);n.compressedTexImage2D(3553,o,i.vO,r,s,0,c),r=d1(1,r>>1),s=d1(1,s>>1)}else for(var f=0;f<i.bO;++f)n.texImage2D(3553,f,i.vO,r,s,0,i.fO,i.dO,null),r=d1(1,r>>1),s=d1(1,s>>1);i.AO?(i.EO=10497,i.kO=10497):(i.EO=33071,i.kO=33071),i.TO=9729,i.SO=9729,n.texParameteri(i.JS,10242,i.EO),n.texParameteri(i.JS,10243,i.kO),n.texParameteri(i.JS,10241,i.TO),n.texParameteri(i.JS,10240,i.SO)}}else i.vO=_1(i.lO),i.OO=n.createRenderbuffer(),i.iO>0&&(e.OO!==i.OO&&(n.bindRenderbuffer(36161,i.OO),e.OO=i.OO),n.renderbufferStorage(36161,i.vO,r,s));break;case 3:i.JS=34067;var v=d1(r,s);if(v>t.capabilities.maxCubeMapTextureSize&&ut(9100,v,t.capabilities.maxTextureSize),i.mO=n.createTexture(),i.iO>0){var l=e.pO[e.yO];if(l.mO!==i.mO&&(n.bindTexture(34067,i.mO),l.mO=i.mO),tg[i.lO].isCompressed)for(var d=0;d<6;++d){r=i.gO,s=i.wO;for(var g=0;g<i.bO;++g){var w=sg(i.lO,r,s,1),_=new Uint8Array(w);n.compressedTexImage2D(34069+d,g,i.vO,r,s,0,_),r=d1(1,r>>1),s=d1(1,s>>1)}}else for(var m=0;m<6;++m){r=i.gO,s=i.wO;for(var p=0;p<i.bO;++p)n.texImage2D(34069+m,p,i.vO,r,s,0,i.fO,i.dO,null),r=d1(1,r>>1),s=d1(1,s>>1)}i.AO?(i.EO=10497,i.kO=10497):(i.EO=33071,i.kO=33071),i.TO=9729,i.SO=9729,n.texParameteri(i.JS,10242,i.EO),n.texParameteri(i.JS,10243,i.kO),n.texParameteri(i.JS,10241,i.TO),n.texParameteri(i.JS,10240,i.SO)}break;default:ut(16317),i.XS=1,i.JS=3553}}function C1(t,i){var n=t.gl,e=t.stateCache;if(i.mO){var r=e.pO,s=e.yO;n.deleteTexture(i.mO);for(var h=0;h<r.length;h++)r[h].mO===i.mO&&(n.activeTexture(33984+h),s=h,n.bindTexture(i.JS,null),r[h].mO=null);e.yO=s,i.mO=null}if(i.OO){var u=e.OO;n.deleteRenderbuffer(i.OO),u===i.OO&&(n.bindRenderbuffer(36161,null),e.OO=null),i.OO=null}}function L1(t,i){if(i.iO){var n=t.gl,e=t.stateCache,r=i.gO,s=i.wO;switch(i.XS){case 1:i.JS=3553;var h=d1(r,s);if(h>t.capabilities.maxTextureSize&&ut(9100,h,t.capabilities.maxTextureSize),i.OO)e.OO!==i.OO&&(n.bindRenderbuffer(36161,i.OO),e.OO=i.OO),n.renderbufferStorage(36161,i.vO,r,s);else if(i.mO){var u=e.pO[e.yO];if(u.mO!==i.mO&&(n.bindTexture(3553,i.mO),u.mO=i.mO),tg[i.lO].isCompressed)for(var o=0;o<i.bO;++o){var a=sg(i.lO,r,s,1),c=new Uint8Array(a);n.compressedTexImage2D(3553,o,i.vO,r,s,0,c),r=d1(1,r>>1),s=d1(1,s>>1)}else for(var f=0;f<i.bO;++f)n.texImage2D(3553,f,i.vO,r,s,0,i.fO,i.dO,null),r=d1(1,r>>1),s=d1(1,s>>1)}break;case 3:i.JS=34067;var v=d1(r,s);v>t.capabilities.maxCubeMapTextureSize&&ut(9100,v,t.capabilities.maxTextureSize);var l=e.pO[e.yO];if(l.mO!==i.mO&&(n.bindTexture(34067,i.mO),l.mO=i.mO),tg[i.lO].isCompressed)for(var d=0;d<6;++d){r=i.gO,s=i.wO;for(var g=0;g<i.bO;++g){var w=sg(i.lO,r,s,1),_=new Uint8Array(w);n.compressedTexImage2D(34069+d,g,i.vO,r,s,0,_),r=d1(1,r>>1),s=d1(1,s>>1)}}else for(var m=0;m<6;++m){r=i.gO,s=i.wO;for(var p=0;p<i.bO;++p)n.texImage2D(34069+m,p,i.vO,r,s,0,i.fO,i.dO,null),r=d1(1,r>>1),s=d1(1,s>>1)}break;default:ut(16317),i.XS=1,i.JS=3553}}}function F1(t,i){for(var n=0;n<i.RO.length;++n)if(i.RO[n].IO)return void(i.MO=!1);var e=t.gl,r=t.stateCache,s=[],h=e.createFramebuffer();if(h){i.NO=h,r.NO!==i.NO&&e.bindFramebuffer(36160,i.NO);for(var u=0;u<i.RO.length;++u){var o=i.RO[u];o&&(o.mO?e.framebufferTexture2D(36160,36064+u,o.JS,o.mO,0):e.framebufferRenderbuffer(36160,36064+u,36161,o.OO),s.push(36064+u),i.gO=g1(i.gO,o.gO),i.wO=g1(i.wO,o.wO))}var a=i.CO;if(a){var c=tg[a.lO].hasStencil?33306:36096;a.mO?e.framebufferTexture2D(36160,c,a.JS,a.mO,0):e.framebufferRenderbuffer(36160,c,36161,a.OO),i.gO=g1(i.gO,a.gO),i.wO=g1(i.wO,a.wO)}t.extensions.LO&&t.extensions.LO.drawBuffersWEBGL(s);var f=e.checkFramebufferStatus(36160);if(36053!==f)switch(f){case 36054:ut(16318);break;case 36055:ut(16319);break;case 36057:ut(16320);break;case 36061:ut(16321)}r.NO!==i.NO&&e.bindFramebuffer(36160,r.NO)}}function P1(t,i){for(var n,e=t.gl,r=t.stateCache,s=function(){var t=i.FO[h],n=0,r="",s=1;switch(t.XS){case 1:r="VertexShader",n=35633;break;case 16:r="FragmentShader",n=35632;break;default:return ut(16322),{v:void 0}}var u=e.createShader(n);if(u&&(t.PO=u,e.shaderSource(t.PO,t.BO),e.compileShader(t.PO),!e.getShaderParameter(t.PO,35713))){ut(16323,r,i.DO),ut(16324,t.BO.replace(/^|\n/g,(function(){return"\n"+s+++" "}))),Y(e.getShaderInfoLog(t.PO));for(var o=0;o<i.FO.length;o++){var a=i.FO[h];a.PO&&(e.deleteShader(a.PO),a.PO=null)}return{v:void 0}}},h=0;h<i.FO.length;h++)if(n=s())return n.v;var u=e.createProgram();if(u){i.UO=u;for(var o=0;o<i.FO.length;o++){var a=i.FO[o];e.attachShader(i.UO,a.PO)}if(e.linkProgram(i.UO),t.extensions.xO)for(var c=0;c<i.FO.length;c++){var f=i.FO[c];f.PO&&(e.detachShader(i.UO,f.PO),e.deleteShader(f.PO),f.PO=null)}if(!e.getProgramParameter(i.UO,35714))return ut(16326,i.DO),void Y(e.getProgramInfoLog(i.UO));et(16325,i.DO);var v=e.getProgramParameter(i.UO,35721);i.jO=new Array(v);for(var l=0;l<v;++l){var d=e.getActiveAttrib(i.UO,l);if(d){var g,w=d.type,_=d.name,m=d.size,p=_.indexOf("[");g=-1!==p?_.substring(0,p):_;var y=e.getAttribLocation(i.UO,g),b=b1(w),A=A1(w);i.jO[l]={HO:y,DO:g,XS:b,VO:A,Hw:m,iO:A*m,dO:w,$O:y}}}if(i.WO.length>0){i.zO=new Array(i.WO.length);for(var E=0;E<i.WO.length;++E){var T=i.WO[E],S={XO:T.set,HO:T.binding,DO:T.name,iO:0,YO:new Array(T.members.length),KO:[]};i.zO[E]=S;for(var O=0;O<T.members.length;++O){var R=T.members[O],I=p1(R.type),M=A1(I),N=M*R.count;S.YO[O]={HO:-1,DO:R.name,XS:R.type,VO:M,Hw:R.count,iO:N,qO:0,dO:I,$O:null,QO:null}}}}for(var C=0;C<i.ZO.length;++C){var L=i.ZO[C];i.JO.push(new _d(L.set,L.binding,L.name,28,L.count))}if(i.JO.length>0){i.tR=new Array(i.JO.length);for(var F=0;F<i.JO.length;++F){var P=i.JO[F];i.tR[F]={XO:P.set,HO:P.binding,DO:P.name,XS:P.type,Hw:P.count,iR:[],nR:null,dO:p1(P.type),$O:null}}}for(var B=e.getProgramParameter(i.UO,35718),D=0;D<B;++D){var U=e.getActiveUniform(i.UO,D);if(U&&35678!==U.type&&35680!==U.type){var x=e.getUniformLocation(i.UO,U.name);if(t.extensions.eR(x)){var G,j=U.name.indexOf("[");G=-1!==j?U.name.substring(0,j):U.name;for(var H=0;H<i.zO.length;H++)for(var V=i.zO[H],$=0;$<V.YO.length;$++){var W=V.YO[$];if(W.DO===G){W.$O=x,W.Hw=U.size,W.iO=W.VO*W.Hw,W.QO=new(y1(W.XS))(W.iO/4),V.KO.push(W);break}}}}}for(var z=0;z<i.zO.length;z++)for(var X=i.zO[z],K=0;K<X.YO.length;K++){var q=X.YO[K];q.qO=X.iO/4,X.iO+=q.iO}var Q=[],Z=[],J=t.bindingMappings,tt=t.capabilities,it=t.stateCache.rR,nt=tt.maxTextureUnits;if(k.rendering&&k.rendering.enableEffectImport)for(var rt=0;rt<i.JO.length;++rt){var st=i.JO[rt],ht=e.getUniformLocation(i.UO,st.name);t.extensions.eR(ht)&&(Q.push(i.tR[rt]),Z.push(ht)),void 0===it[st.name]&&(it[st.name]=st.flattened%nt)}else{for(var ot=0,at=0;at<i.WO.length;++at)i.WO[at].set===J.sR&&ot++;for(var ct=0,ft=0;ft<i.JO.length;++ft){var vt=i.JO[ft],lt=e.getUniformLocation(i.UO,vt.name);if(t.extensions.eR(lt)&&(Q.push(i.tR[ft]),Z.push(lt)),void 0===it[vt.name]){var dt=vt.binding+J.hR[vt.set]+ct;vt.set===J.sR&&(dt-=ot),it[vt.name]=dt%nt,ct+=vt.count-1}}}if(Q.length){for(var gt=[],wt=0;wt<Q.length;++wt){var _t=Q[wt],mt=it[_t.DO];if(void 0!==mt){_t.$O=Z[wt];for(var pt=0;pt<_t.Hw;++pt){for(;gt[mt];)mt=(mt+1)%nt;_t.iR.push(mt),gt[mt]=!0}}}for(var yt=0,bt=0;bt<Q.length;++bt){var At=Q[bt];if(!t.extensions.eR(At.$O)){At.$O=Z[bt];for(var Et=0;Et<At.Hw;++Et){for(;gt[yt];)yt=(yt+1)%nt;void 0===it[At.DO]&&(it[At.DO]=yt),At.iR.push(yt),gt[yt]=!0}}}r.UO!==i.UO&&e.useProgram(i.UO);for(var kt=0;kt<Q.length;kt++){var Tt=Q[kt];Tt.nR=new Int32Array(Tt.iR),e.uniform1iv(Tt.$O,Tt.nR)}r.UO!==i.UO&&e.useProgram(r.UO)}for(var St=0;St<i.zO.length;)i.zO[St].KO.length?St++:(i.zO[St]=i.zO[i.zO.length-1],i.zO.length--);i.tR=Q}}function B1(t,i){if(i.UO){var n=t.gl,e=t.stateCache;if(!t.extensions.xO)for(var r=0;r<i.FO.length;r++){var s=i.FO[r];s.PO&&(n.detachShader(i.UO,s.PO),n.deleteShader(s.PO),s.PO=null)}n.deleteProgram(i.UO),e.UO===i.UO&&(n.useProgram(null),e.UO=null),i.UO=null}}function D1(t,i){t.gl,i.uR=new Array(i.oR.length);for(var n=[0,0,0,0,0,0,0,0],e=0;e<i.oR.length;++e){var r=i.oR[e],s=r.format,h=r.isNormalized,u=r.isInstanced,o=void 0!==r.stream?r.stream:0,a=i.aR[o],c=w1(s),f=tg[s].size;i.uR[e]={DO:r.name,tO:a.tO,dO:c,iO:f,Hw:tg[s].count,VO:a.VO,cR:E1(c),fR:void 0!==h&&h,vR:void 0!==u&&u,qO:n[o]},n[o]+=f}}function U1(t,i){for(var n=t.stateCache,e=i.lR.values(),r=e.next(),s=t.extensions.rO,h=n.eO;!r.done;)s.deleteVertexArrayOES(r.value),h===r.value&&(s.bindVertexArrayOES(null),h=null),r=e.next();n.eO=h,i.lR.clear()}var x1={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},G1=new Yl;function j1(t,i,n,e,r,s,h){var u=t.gl,o=t.stateCache,a=0;if(n){var c=n.dR;G1.x=e.x<<c,G1.y=e.y<<c,G1.width=e.width<<c,G1.height=e.height<<c}if(n&&i){var f=n.NO,v=G1.x,l=G1.y,d=G1.width,g=G1.height;o.NO!==f&&(u.bindFramebuffer(36160,f),o.NO=f);var w=o.gR;w.left===v&&w.top===l&&w.width===d&&w.height===g||(u.viewport(v,l,d,g),w.left=v,w.top=l,w.width=d,w.height=g);var _=o.wR;_.x===v&&_.y===l&&_.width===d&&_.height===g||(u.scissor(v,l,d,g),_.x=v,_.y=l,_.width=d,_.height=g);var m=r.length;t.extensions.LO||(m=1);for(var p=o._R,y=0;y<m;++y){var b=i.mR[y];if(0!==b.format)switch(b.loadOp){case 0:break;case 1:15!==o.pR.targets[0].blendColorMask&&u.colorMask(!0,!0,!0,!0);var A=r[0];u.clearColor(A.x,A.y,A.z,A.w),a|=16384}}if(i.yR&&0!==i.yR.format){switch(i.yR.depthLoadOp){case 0:break;case 1:p.depthWrite||u.depthMask(!0),u.clearDepth(s),a|=256}if(tg[i.yR.format].hasStencil)switch(i.yR.stencilLoadOp){case 0:break;case 1:p.stencilWriteMaskFront||u.stencilMaskSeparate(1028,65535),p.stencilWriteMaskBack||u.stencilMaskSeparate(1029,65535),u.clearStencil(h),a|=1024}}if(a&&u.clear(a),16384&a){var E=o.pR.targets[0].blendColorMask;if(15!==E){var k=!!(1&E),T=!!(2&E),S=!!(4&E),O=!!(8&E);u.colorMask(k,T,S,O)}}256&a&&!p.depthWrite&&u.depthMask(!1),1024&a&&(p.stencilWriteMaskFront||u.stencilMaskSeparate(1028,0),p.stencilWriteMaskBack||u.stencilMaskSeparate(1029,0))}}function H1(t,i,n,e,r,s){var h,u,o,a=t.gl,c=t.stateCache,f=c._R,v=c.pR,l=i&&i.bR,d=!1;if(i&&x1.gpuPipelineState!==i){if(x1.gpuPipelineState=i,x1.glPrimitive=i.AR,i.bR){var g=i.bR.UO;c.UO!==g&&(a.useProgram(g),c.UO=g,d=!0)}var w=i.ER,_=c.ER;if(w){if(_.cullMode!==w.cullMode){switch(w.cullMode){case 0:a.disable(2884);break;case 1:a.enable(2884),a.cullFace(1028);break;case 2:a.enable(2884),a.cullFace(1029)}_.cullMode=w.cullMode}var m=w.isFrontFaceCCW;_.isFrontFaceCCW!==m&&(a.frontFace(m?2305:2304),_.isFrontFaceCCW=m),_.depthBias===w.depthBias&&_.depthBiasSlop===w.depthBiasSlop||(a.polygonOffset(w.depthBias,w.depthBiasSlop),_.depthBias=w.depthBias,_.depthBiasSlop=w.depthBiasSlop),_.lineWidth!==w.lineWidth&&(a.lineWidth(w.lineWidth),_.lineWidth=w.lineWidth)}var p=i._R;p&&(f.depthTest!==p.depthTest&&(p.depthTest?a.enable(2929):a.disable(2929),f.depthTest=p.depthTest),f.depthWrite!==p.depthWrite&&(a.depthMask(p.depthWrite),f.depthWrite=p.depthWrite),f.depthFunc!==p.depthFunc&&(a.depthFunc(k1[p.depthFunc]),f.depthFunc=p.depthFunc),f.stencilTestFront===p.stencilTestFront&&f.stencilTestBack===p.stencilTestBack||(p.stencilTestFront||p.stencilTestBack?a.enable(2960):a.disable(2960),f.stencilTestFront=p.stencilTestFront,f.stencilTestBack=p.stencilTestBack),f.stencilFuncFront===p.stencilFuncFront&&f.stencilRefFront===p.stencilRefFront&&f.stencilReadMaskFront===p.stencilReadMaskFront||(a.stencilFuncSeparate(1028,k1[p.stencilFuncFront],p.stencilRefFront,p.stencilReadMaskFront),f.stencilFuncFront=p.stencilFuncFront,f.stencilRefFront=p.stencilRefFront,f.stencilReadMaskFront=p.stencilReadMaskFront),f.stencilFailOpFront===p.stencilFailOpFront&&f.stencilZFailOpFront===p.stencilZFailOpFront&&f.stencilPassOpFront===p.stencilPassOpFront||(a.stencilOpSeparate(1028,T1[p.stencilFailOpFront],T1[p.stencilZFailOpFront],T1[p.stencilPassOpFront]),f.stencilFailOpFront=p.stencilFailOpFront,f.stencilZFailOpFront=p.stencilZFailOpFront,f.stencilPassOpFront=p.stencilPassOpFront),f.stencilWriteMaskFront!==p.stencilWriteMaskFront&&(a.stencilMaskSeparate(1028,p.stencilWriteMaskFront),f.stencilWriteMaskFront=p.stencilWriteMaskFront),f.stencilFuncBack===p.stencilFuncBack&&f.stencilRefBack===p.stencilRefBack&&f.stencilReadMaskBack===p.stencilReadMaskBack||(a.stencilFuncSeparate(1029,k1[p.stencilFuncBack],p.stencilRefBack,p.stencilReadMaskBack),f.stencilFuncBack=p.stencilFuncBack,f.stencilRefBack=p.stencilRefBack,f.stencilReadMaskBack=p.stencilReadMaskBack),f.stencilFailOpBack===p.stencilFailOpBack&&f.stencilZFailOpBack===p.stencilZFailOpBack&&f.stencilPassOpBack===p.stencilPassOpBack||(a.stencilOpSeparate(1029,T1[p.stencilFailOpBack],T1[p.stencilZFailOpBack],T1[p.stencilPassOpBack]),f.stencilFailOpBack=p.stencilFailOpBack,f.stencilZFailOpBack=p.stencilZFailOpBack,f.stencilPassOpBack=p.stencilPassOpBack),f.stencilWriteMaskBack!==p.stencilWriteMaskBack&&(a.stencilMaskSeparate(1029,p.stencilWriteMaskBack),f.stencilWriteMaskBack=p.stencilWriteMaskBack));var y=i.pR;if(y){v.isA2C!==y.isA2C&&(y.isA2C?a.enable(32926):a.disable(32926),v.isA2C=y.isA2C),v.blendColor.x===y.blendColor.x&&v.blendColor.y===y.blendColor.y&&v.blendColor.z===y.blendColor.z&&v.blendColor.w===y.blendColor.w||(a.blendColor(y.blendColor.x,y.blendColor.y,y.blendColor.z,y.blendColor.w),v.blendColor.x=y.blendColor.x,v.blendColor.y=y.blendColor.y,v.blendColor.z=y.blendColor.z,v.blendColor.w=y.blendColor.w);var b=y.targets[0],A=v.targets[0];A.blend!==b.blend&&(b.blend?a.enable(3042):a.disable(3042),A.blend=b.blend),A.blendEq===b.blendEq&&A.blendAlphaEq===b.blendAlphaEq||(a.blendEquationSeparate(S1[b.blendEq],S1[b.blendAlphaEq]),A.blendEq=b.blendEq,A.blendAlphaEq=b.blendAlphaEq),A.blendSrc===b.blendSrc&&A.blendDst===b.blendDst&&A.blendSrcAlpha===b.blendSrcAlpha&&A.blendDstAlpha===b.blendDstAlpha||(a.blendFuncSeparate(O1[b.blendSrc],O1[b.blendDst],O1[b.blendSrcAlpha],O1[b.blendDstAlpha]),A.blendSrc=b.blendSrc,A.blendDst=b.blendDst,A.blendSrcAlpha=b.blendSrcAlpha,A.blendDstAlpha=b.blendDstAlpha),A.blendColorMask!==b.blendColorMask&&(a.colorMask(!!(1&b.blendColorMask),!!(2&b.blendColorMask),!!(4&b.blendColorMask),!!(8&b.blendColorMask)),A.blendColorMask=b.blendColorMask)}}if(i&&i.kR&&l){for(var E=l.zO.length,k=i.kR.TR,T=0;T<E;T++){var S=l.zO[T],O=e[S.XO],R=O&&O.$S[S.HO],I=R>=0&&O.zS[R],M=null,N=0;if(I&&I.YS){var C=I.YS,L=k[S.XO],F=L&&L[S.HO];F>=0&&(N=r[F]),"vf32"in C?M=C.vf32:(N+=C.qO,M=C.YS.vf32),N>>=2}if(M)for(var P=S.KO.length,B=0;B<P;B++){var D=S.KO[B];switch(D.dO){case 35670:case 5124:for(var U=0;U<D.QO.length;++U){var x=D.qO+N+U;if(M[x]!==D.QO[U]){for(var G=U,j=x;G<D.QO.length;++G,++j)D.QO[G]=M[j];a.uniform1iv(D.$O,D.QO);break}}break;case 35671:case 35667:for(var H=0;H<D.QO.length;++H){var V=D.qO+N+H;if(M[V]!==D.QO[H]){for(var $=H,W=V;$<D.QO.length;++$,++W)D.QO[$]=M[W];a.uniform2iv(D.$O,D.QO);break}}break;case 35672:case 35668:for(var z=0;z<D.QO.length;++z){var X=D.qO+N+z;if(M[X]!==D.QO[z]){for(var Y=z,K=X;Y<D.QO.length;++Y,++K)D.QO[Y]=M[K];a.uniform3iv(D.$O,D.QO);break}}break;case 35673:case 35669:for(var q=0;q<D.QO.length;++q){var Q=D.qO+N+q;if(M[Q]!==D.QO[q]){for(var Z=q,J=Q;Z<D.QO.length;++Z,++J)D.QO[Z]=M[J];a.uniform4iv(D.$O,D.QO);break}}break;case 5126:for(var tt=0;tt<D.QO.length;++tt){var it=D.qO+N+tt;if(M[it]!==D.QO[tt]){for(var nt=tt,et=it;nt<D.QO.length;++nt,++et)D.QO[nt]=M[et];a.uniform1fv(D.$O,D.QO);break}}break;case 35664:for(var rt=0;rt<D.QO.length;++rt){var st=D.qO+N+rt;if(M[st]!==D.QO[rt]){for(var ht=rt,ut=st;ht<D.QO.length;++ht,++ut)D.QO[ht]=M[ut];a.uniform2fv(D.$O,D.QO);break}}break;case 35665:for(var ot=0;ot<D.QO.length;++ot){var at=D.qO+N+ot;if(M[at]!==D.QO[ot]){for(var ct=ot,ft=at;ct<D.QO.length;++ct,++ft)D.QO[ct]=M[ft];a.uniform3fv(D.$O,D.QO);break}}break;case 35666:for(var vt=0;vt<D.QO.length;++vt){var lt=D.qO+N+vt;if(M[lt]!==D.QO[vt]){for(var dt=vt,gt=lt;dt<D.QO.length;++dt,++gt)D.QO[dt]=M[gt];a.uniform4fv(D.$O,D.QO);break}}break;case 35674:for(var wt=0;wt<D.QO.length;++wt){var _t=D.qO+N+wt;if(M[_t]!==D.QO[wt]){for(var mt=wt,pt=_t;mt<D.QO.length;++mt,++pt)D.QO[mt]=M[pt];a.uniformMatrix2fv(D.$O,!1,D.QO);break}}break;case 35675:for(var yt=0;yt<D.QO.length;++yt){var bt=D.qO+N+yt;if(M[bt]!==D.QO[yt]){for(var At=yt,Et=bt;At<D.QO.length;++At,++Et)D.QO[At]=M[Et];a.uniformMatrix3fv(D.$O,!1,D.QO);break}}break;case 35676:for(var kt=0;kt<D.QO.length;++kt){var Tt=D.qO+N+kt;if(M[Tt]!==D.QO[kt]){for(var St=kt,Ot=Tt;St<D.QO.length;++St,++Ot)D.QO[St]=M[Ot];a.uniformMatrix4fv(D.$O,!1,D.QO);break}}}}}for(var Rt=l.tR.length,It=0;It<Rt;It++)for(var Mt=l.tR[It],Nt=e[Mt.XO],Ct=Nt&&Nt.$S[Mt.HO],Lt=Ct>=0&&Nt.zS[Ct],Ft=Mt.iR.length,Pt=0;Pt<Ft;Pt++){var Bt=Mt.iR[Pt];if(Lt&&Lt.qS){if(Lt.KS&&Lt.KS.iO>0){var Dt=Lt.KS,Ut=c.pO[Bt];Ut.mO!==Dt.mO&&(c.yO!==Bt&&(a.activeTexture(33984+Bt),c.yO=Bt),Dt.mO?a.bindTexture(Dt.JS,Dt.mO):a.bindTexture(Dt.JS,t.nullTex2D.gpuTexture.mO),Ut.mO=Dt.mO);var xt=Lt.qS;Dt.AO?(h=xt.EO,u=xt.kO):(h=33071,u=33071),o=Dt.AO?Dt.bO<=1&&(9985===xt.TO||9987===xt.TO)?9729:xt.TO:9729===xt.TO||9985===xt.TO||9987===xt.TO?9729:9728,Dt.EO!==h&&(c.yO!==Bt&&(a.activeTexture(33984+Bt),c.yO=Bt),a.texParameteri(Dt.JS,10242,h),Dt.EO=h),Dt.kO!==u&&(c.yO!==Bt&&(a.activeTexture(33984+Bt),c.yO=Bt),a.texParameteri(Dt.JS,10243,u),Dt.kO=u),Dt.TO!==o&&(c.yO!==Bt&&(a.activeTexture(33984+Bt),c.yO=Bt),a.texParameteri(Dt.JS,10241,o),Dt.TO=o),Dt.SO!==xt.SO&&(c.yO!==Bt&&(a.activeTexture(33984+Bt),c.yO=Bt),a.texParameteri(Dt.JS,10240,xt.SO),Dt.SO=xt.SO)}Lt=Nt.zS[++Ct]}}}if(n&&l&&(d||x1.gpuInputAssembler!==n)){x1.gpuInputAssembler=n;var Gt=t.extensions.SR;if(t.extensions.nO){var jt=t.extensions.rO,Ht=n.lR.get(l.UO);if(!Ht){var Vt;Ht=jt.createVertexArrayOES(),n.lR.set(l.UO,Ht),jt.bindVertexArrayOES(Ht),a.bindBuffer(34962,null),a.bindBuffer(34963,null),c.sO=null,c.hO=null;for(var $t=l.jO.length,Wt=0;Wt<$t;Wt++){var zt=l.jO[Wt];Vt=null;for(var Xt=n.uR.length,Yt=0;Yt<Xt;Yt++){var Kt=n.uR[Yt];if(Kt.DO===zt.DO){Vt=Kt;break}}if(Vt){c.sO!==Vt.tO&&(a.bindBuffer(34962,Vt.tO),c.sO=Vt.tO);for(var qt=0;qt<Vt.cR;++qt){var Qt=zt.$O+qt,Zt=Vt.qO+Vt.iO*qt;a.enableVertexAttribArray(Qt),c.OR[Qt]=!0,a.vertexAttribPointer(Qt,Vt.Hw,Vt.dO,Vt.fR,Vt.VO,Zt),Gt&&Gt.vertexAttribDivisorANGLE(Qt,Vt.vR?1:0)}}}var Jt=n.RR;Jt&&a.bindBuffer(34963,Jt.tO),jt.bindVertexArrayOES(null),a.bindBuffer(34962,null),a.bindBuffer(34963,null),c.sO=null,c.hO=null}c.eO!==Ht&&(jt.bindVertexArrayOES(Ht),c.eO=Ht)}else{for(var ti=0;ti<t.capabilities.maxVertexAttributes;++ti)c.OR[ti]=!1;for(var ii=l.jO.length,ni=0;ni<ii;ni++){for(var ei=l.jO[ni],ri=null,si=n.uR.length,hi=0;hi<si;hi++){var ui=n.uR[hi];if(ui.DO===ei.DO){ri=ui;break}}if(ri){c.sO!==ri.tO&&(a.bindBuffer(34962,ri.tO),c.sO=ri.tO);for(var oi=0;oi<ri.cR;++oi){var ai=ei.$O+oi,ci=ri.qO+ri.iO*oi;!c.IR[ai]&&ai>=0&&(a.enableVertexAttribArray(ai),c.IR[ai]=!0),c.OR[ai]=!0,a.vertexAttribPointer(ai,ri.Hw,ri.dO,ri.fR,ri.VO,ci),Gt&&Gt.vertexAttribDivisorANGLE(ai,ri.vR?1:0)}}}var fi=n.RR;fi&&c.hO!==fi.tO&&(a.bindBuffer(34963,fi.tO),c.hO=fi.tO);for(var vi=0;vi<t.capabilities.maxVertexAttributes;++vi)c.IR[vi]!==c.OR[vi]&&(a.disableVertexAttribArray(vi),c.IR[vi]=!1)}}if(i&&i.MR.length)for(var li=i.MR.length,di=0;di<li;di++)switch(i.MR[di]){case 1:c.ER.lineWidth!==s.lineWidth&&(a.lineWidth(s.lineWidth),c.ER.lineWidth=s.lineWidth);break;case 2:c.ER.depthBias===s.depthBiasConstant&&c.ER.depthBiasSlop===s.depthBiasSlope||(a.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),c.ER.depthBias=s.depthBiasConstant,c.ER.depthBiasSlop=s.depthBiasSlope);break;case 4:var gi=s.blendConstant;v.blendColor.x===gi.x&&v.blendColor.y===gi.y&&v.blendColor.z===gi.z&&v.blendColor.w===gi.w||(a.blendColor(gi.x,gi.y,gi.z,gi.w),v.blendColor.copy(gi));break;case 16:var wi=s.stencilStatesFront,_i=s.stencilStatesBack;f.stencilWriteMaskFront!==wi.writeMask&&(a.stencilMaskSeparate(1028,wi.writeMask),f.stencilWriteMaskFront=wi.writeMask),f.stencilWriteMaskBack!==_i.writeMask&&(a.stencilMaskSeparate(1029,_i.writeMask),f.stencilWriteMaskBack=_i.writeMask);break;case 32:var mi=s.stencilStatesFront,pi=s.stencilStatesBack;f.stencilRefFront===mi.reference&&f.stencilReadMaskFront===mi.compareMask||(a.stencilFuncSeparate(1028,k1[f.stencilFuncFront],mi.reference,mi.compareMask),f.stencilRefFront=mi.reference,f.stencilReadMaskFront=mi.compareMask),f.stencilRefBack===pi.reference&&f.stencilReadMaskBack===pi.compareMask||(a.stencilFuncSeparate(1029,k1[f.stencilFuncBack],pi.reference,pi.compareMask),f.stencilRefBack=pi.reference,f.stencilReadMaskBack=pi.compareMask)}}function V1(t,i){var n=t.gl,e=t.extensions,r=e.SR,s=e.NR,h=x1.gpuInputAssembler,u=x1.glPrimitive;if(h){var o=h.RR;if(h.CR){var a=h.CR.aO;if(a.LR){for(var c=0;c<a.FR;c++)a.PR[c]=a.BR[c]*o.VO;if(s)a.DR?s.multiDrawElementsInstancedWEBGL(u,a.UR,0,h.xR,a.PR,0,a.GR,0,a.FR):s.multiDrawElementsWEBGL(u,a.UR,0,h.xR,a.PR,0,a.FR);else for(var f=0;f<a.FR;f++)a.GR[f]&&r?r.drawElementsInstancedANGLE(u,a.UR[f],h.xR,a.PR[f],a.GR[f]):n.drawElements(u,a.UR[f],h.xR,a.PR[f])}else if(s)a.DR?s.multiDrawArraysInstancedWEBGL(u,a.BR,0,a.UR,0,a.GR,0,a.FR):s.multiDrawArraysWEBGL(u,a.BR,0,a.UR,0,a.FR);else for(var v=0;v<a.FR;v++)a.GR[v]&&r?r.drawArraysInstancedANGLE(u,a.BR[v],a.UR[v],a.GR[v]):n.drawArrays(u,a.BR[v],a.UR[v])}else if(i.instanceCount&&r)if(o){if(i.indexCount>0){var l=i.firstIndex*o.VO;r.drawElementsInstancedANGLE(u,i.indexCount,h.xR,l,i.instanceCount)}}else i.vertexCount>0&&r.drawArraysInstancedANGLE(u,i.firstVertex,i.vertexCount,i.instanceCount);else if(o){if(i.indexCount>0){var d=i.firstIndex*o.VO;n.drawElements(u,i.indexCount,h.xR,d)}}else i.vertexCount>0&&n.drawArrays(u,i.firstVertex,i.vertexCount)}}function $1(t,i,n,e){var r=t.gl,s=t.stateCache,h=s.pO[s.yO];h.mO!==n.mO&&(r.bindTexture(n.JS,n.mO),h.mO=n.mO);var u=0,o=0;switch(n.JS){case 3553:for(var a=0;a<e.length;a++){var c=e[a];r.texSubImage2D(3553,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,n.fO,n.dO,i[u++])}break;case 34067:for(var f=0;f<e.length;f++){var v=e[f],l=v.texOffset,d=v.texSubres,g=d.baseArrayLayer+d.layerCount;for(o=d.baseArrayLayer;o<g;++o)r.texSubImage2D(34069+o,d.mipLevel,l.x,l.y,n.fO,n.dO,i[u++])}break;default:ut(16327)}1&n.jR&&n.AO&&r.generateMipmap(n.JS)}var W1=new Uint8Array(1);function z1(t,i,n,e,r){var s=cg(i).height,h=sg(i,r.width,r.height,r.depth),u=sg(i,e.width,1,1),o=sg(i,e.width,e.height,1),a=sg(i,r.width,1,1),c=ag(tg[i]);W1.byteLength<h&&(W1=new Uint8Array(h));for(var f=0,v=n,l=0;l<r.depth;l++){v=n+o*l;for(var d=0;d<r.height;d+=s)W1.subarray(f,f+a).set(new Uint8Array(t.buffer,t.byteOffset+v,a)),f+=a,v+=u}var g=h/c.BYTES_PER_ELEMENT;return at(Number.isInteger(g),9101),new c(W1.buffer,0,g)}function X1(t,i,n,e){var r=t.gl,s=t.stateCache,h=s.pO[s.yO];h.mO!==n.mO&&(r.bindTexture(n.JS,n.mO),h.mO=n.mO);var u=0,o=0,a=tg[n.lO],c=ag(a),f=a.isCompressed,v=cg(n.lO),l=new Kl,d=new Xl,g=new Kl;switch(n.JS){case 3553:for(var w=0;w<e.length;w++){var _=e[w],m=_.texSubres.mipLevel,p=_.texOffset,y=_.texExtent,b=y.width,A=y.height,E=v.width,k=v.height,T=_.buffStride;d.x=0===p.x?0:fg(p.x,E),d.y=0===p.y?0:fg(p.y,k),l.width=b<E?b:fg(b,E),l.height=A<k?b:fg(A,k),g.width=T>0?T:l.width,g.height=_.buffTexHeight>0?_.buffTexHeight:l.height;var S=b+d.x===n.gO>>m?b:l.width,O=A+d.y===n.wO>>m?A:l.height,R=void 0,I=i[u++];if(g.width===l.width&&g.height===l.height){var M=sg(n.lO,S,O,1)/c.BYTES_PER_ELEMENT;at(Number.isInteger(M),9101),R=new c(I.buffer,I.byteOffset+_.buffOffset,M)}else R=z1(I,n.lO,_.buffOffset,g,l);f?36196===n.vO||t.extensions.HR?r.compressedTexImage2D(3553,m,n.vO,S,O,0,R):r.compressedTexSubImage2D(3553,m,d.x,d.y,S,O,n.fO,R):r.texSubImage2D(3553,m,d.x,d.y,S,O,n.fO,n.dO,R)}break;case 34067:for(var N=0;N<e.length;N++){var C=e[N],L=C.texSubres.mipLevel,F=C.texOffset,P=C.texExtent,B=C.texSubres,D=P.width,U=P.height,x=v.width,G=v.height;d.x=0===F.x?0:fg(F.x,x),d.y=0===F.y?0:fg(F.y,G),l.width=D<x?D:fg(D,x),l.height=U<G?D:fg(U,G),g.width=C.buffStride>0?C.buffStride:l.width,g.height=C.buffTexHeight>0?C.buffTexHeight:l.height;var j=D+d.x===n.gO>>L?D:l.width,H=U+d.y===n.wO>>L?U:l.height,V=B.baseArrayLayer+B.layerCount;for(o=B.baseArrayLayer;o<V;++o){var $=void 0,W=i[u++];if(g.width===l.width&&g.height===l.height){var z=sg(n.lO,j,H,1)/c.BYTES_PER_ELEMENT;at(Number.isInteger(z),9101),$=new c(W.buffer,W.byteOffset+C.buffOffset,z)}else $=z1(W,n.lO,C.buffOffset,g,l);f?36196===n.vO||t.extensions.HR?r.compressedTexImage2D(34069+o,L,n.vO,j,H,0,$):r.compressedTexSubImage2D(34069+o,L,d.x,d.y,j,H,n.fO,$):r.texSubImage2D(34069+o,L,d.x,d.y,j,H,n.fO,n.dO,$)}}break;default:ut(16327)}1&n.jR&&r.generateMipmap(n.JS)}function Y1(t,i,n,e){var r=t.gl,s=t.stateCache,h=r.createFramebuffer();r.bindFramebuffer(36160,h);var u=0,o=0,a=1,c=1;if(3553===i.JS)for(var f=0;f<e.length;f++){var v=e[f];r.framebufferTexture2D(36160,36064,i.JS,i.mO,v.texSubres.mipLevel),u=v.texOffset.x,o=v.texOffset.y,a=v.texExtent.width,c=v.texExtent.height,r.readPixels(u,o,a,c,i.fO,i.dO,n[f])}else ut(16399);r.bindFramebuffer(36160,null),s.NO=null,r.deleteFramebuffer(h)}function K1(t,i,n,e,r){t.blitManager.VR(i,n,e,r)}var q1=function(){function t(){}return t.$R=function(i){t.Mr=i},e(t,null,[{key:"instance",get:function(){return t.Mr}}]),t}();function Q1(t){return new Int32Array(t)}q1.Mr=null;var Z1=function(){function t(){this.FR=0,this.LR=!1,this.DR=!1,this.WR=4,this.UR=Q1(this.WR),this.BR=Q1(this.WR),this.GR=Q1(this.WR),this.PR=Q1(this.WR)}var i=t.prototype;return i.oO=function(){this.FR=0,this.LR=!1,this.DR=!1},i.cO=function(t,i){this.zR(t),this.LR=i.indexCount>0,this.DR=!!i.instanceCount,this.FR=Math.max(t+1,this.FR),this.LR?(this.UR[t]=i.indexCount,this.BR[t]=i.firstIndex):(this.UR[t]=i.vertexCount,this.BR[t]=i.firstVertex),this.GR[t]=Math.max(1,i.instanceCount)},i.zR=function(t){if(!(this.WR>t)){this.WR=F(t);var i=Q1(this.WR),n=Q1(this.WR),e=Q1(this.WR);this.PR=Q1(this.WR),i.set(this.UR),n.set(this.BR),e.set(this.GR),this.UR=i,this.BR=n,this.GR=e}},t}(),J1=function(){function t(){this.YR=null,this.KR=null,this.qR=null,this.QR=null,this.ZR=null,this.JR=null,this.tI=null,this.iI=null,this.HS=null,this.nI=null,this.zn=null,this.eI=null,this.rI=null;var t=q1.instance.bindingMappingInfo.maxBlockCounts[0];this.YR={DO:"Blit Pass",WO:[new wd(0,0,"BlitParams",[new gd("tilingOffsetSrc",16,1),new gd("tilingOffsetDst",16,1)],1)],JO:[new _d(0,t,"textureSrc",28,1)],ZO:[],FO:[{XS:1,BO:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 tilingOffsetSrc;\nuniform vec4 tilingOffsetDst;\nvarying vec2 v_texCoord;\nvoid main() {\n    v_texCoord = a_texCoord * tilingOffsetSrc.xy + tilingOffsetSrc.zw;\n    gl_Position = vec4((a_position + 1.0) * tilingOffsetDst.xy - 1.0 + tilingOffsetDst.zw * 2.0, 0, 1);\n}",PO:null},{XS:16,BO:"\nprecision mediump float;\nuniform sampler2D textureSrc;\nvarying vec2 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(textureSrc, v_texCoord);\n}",PO:null}],UO:null,jO:[],YO:[],zO:[],tR:[]},P1(q1.instance,this.YR),this.KR={VS:[new Dd(0,1,1,1),new Dd(t,16,1,16)],sI:[],$S:[],WS:t+1};for(var i=0;i<t;i++)this.KR.$S[i]=0;this.KR.$S.push(1),this.qR={hI:[this.KR],uI:0,oI:[0],TR:[[]]},this.QR={AR:5,bR:this.YR,kR:this.qR,ER:null,_R:new kg(!1,!1),pR:null,MR:[],aI:null},this.ZR={ZS:8,QS:1,iO:64,VO:16,uO:null,vf32:null,aO:new Z1,JS:0,tO:null},R1(q1.instance,this.ZR),q1.instance.memoryStatus.bufferSize+=this.ZR.iO;var n=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);M1(q1.instance,this.ZR,n,0,n.length),this.JR={oR:[new kd("a_position",21),new kd("a_texCoord",21)],aR:[this.ZR],RR:null,CR:null,uR:[],xR:0,lR:new Map},D1(q1.instance,this.JR),this.tI={TO:9728,SO:9728,EO:10497,kO:10497,cI:10497},this.iI={TO:9729,SO:9729,EO:10497,kO:10497,cI:10497},this.rI=new Float32Array(8),this.nI={ZS:16,QS:1,iO:32,VO:32,uO:this.rI,vf32:null,aO:new Z1,JS:0,tO:null},R1(q1.instance,this.nI),q1.instance.memoryStatus.bufferSize+=this.nI.iO,this.HS={zS:[{XS:1,YS:this.nI,KS:null,qS:null},{XS:16,YS:null,KS:null,qS:null}],$S:this.KR.$S},this.zn=new ad(4,0,0,0,0,0,0),this.eI=q1.instance.gl.createFramebuffer()}var i=t.prototype;return i.kg=function(){this.eI&&(q1.instance.gl.deleteFramebuffer(this.eI),this.eI=null),this.ZR&&(q1.instance.memoryStatus.bufferSize-=this.ZR.iO,I1(q1.instance,this.ZR)),this.nI&&(q1.instance.memoryStatus.bufferSize-=this.nI.iO,I1(q1.instance,this.nI)),this.YR&&B1(q1.instance,this.YR),this.JR&&U1(q1.instance,this.JR)},i.VR=function(t,i,n,e){var r=q1.instance,s=r.gl,h=r.stateCache,u=h.NO;if(s.viewport(0,0,i.gO,i.wO),s.scissor(0,0,i.gO,i.wO),this.rI&&this.nI&&this.QR&&this.JR&&this.HS&&this.zn){var o=this.HS.zS[1];o.KS=t,o.qS=1===e?this.tI:this.iI;var a=tg[i.lO],c=36064;a.hasStencil?c=33306:a.hasDepth&&(c=36096);var f=n.map((function(t,i){return i}));f.sort((function(t,i){return n[t].srcSubres.mipLevel-n[i].srcSubres.mipLevel})),h.NO!==this.eI&&(s.bindFramebuffer(36160,this.eI),h.NO=this.eI);var v=n[0].dstSubres.mipLevel;i.mO?s.framebufferTexture2D(36160,c,i.JS,i.mO,v):s.framebufferRenderbuffer(36160,c,36161,i.OO);for(var l=0;l<f.length;++l){var d=n[f[l]];t.mO&&v!==d.srcSubres.mipLevel&&(v=d.srcSubres.mipLevel,s.framebufferTexture2D(36160,c,i.JS,i.mO,v));var g=t.gO,w=t.wO,_=i.gO,m=i.wO;this.rI[0]=d.srcExtent.width/g,this.rI[1]=d.srcExtent.height/w,this.rI[2]=d.srcOffset.x/g,this.rI[3]=d.srcOffset.y/w,this.rI[4]=d.dstExtent.width/_,this.rI[5]=d.dstExtent.height/m,this.rI[6]=d.dstOffset.x/_,this.rI[7]=d.dstOffset.y/m,M1(r,this.nI,this.rI,0,4*this.rI.length),H1(r,this.QR,this.JR,[this.HS],[],null),V1(r,this.zn)}h.NO!==u&&(s.bindFramebuffer(36160,u),h.NO=u);var p=h.gR;s.viewport(p.left,p.top,p.width,p.height);var y=h.wR;s.scissor(y.x,y.y,y.width,y.height)}},t}(),t2=function(t){function i(){var i;return(i=t.call(this)||this).fI=null,i.vI=null,i.rI=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){if("buffer"in t){this.un=!0;var i=t.buffer;this.en=i.usage,this.rn=i.memUsage,this.sn=this.hn=t.range,this.$=1,this.Gt=i.flags,this.vI={YS:i.gpuBuffer,qO:t.offset,lI:t.range}}else this.en=t.usage,this.rn=t.memUsage,this.sn=t.size,this.hn=Math.max(t.stride||this.sn,1),this.$=this.sn/this.hn,this.Gt=t.flags,16&this.en&&this.sn>0&&(this.rI=new Uint8Array(this.sn)),this.fI={ZS:this.en,QS:this.rn,iO:this.sn,VO:this.hn,uO:null,vf32:null,aO:new Z1,JS:0,tO:null},16&this.en&&(this.fI.uO=this.rI),R1(q1.instance,this.fI),q1.instance.memoryStatus.bufferSize+=this.sn},n.destroy=function(){this.fI&&(I1(q1.instance,this.fI),q1.instance.memoryStatus.bufferSize-=this.sn,this.fI=null),this.vI&&(this.vI=null)},n.resize=function(t){if(this.un)st(16379);else{var i,n,e,r,s,h=this.sn;h!==t&&(this.sn=t,this.$=this.sn/this.hn,this.rI&&(this.rI=new Uint8Array(t)),this.fI&&(this.rI&&(this.fI.uO=this.rI),this.fI.iO=t,t>0&&(i=q1.instance,n=this.fI,e=i.gl,r=i.stateCache,s=2&n.QS?35048:35044,8&n.ZS?(i.extensions.nO&&r.eO&&(i.extensions.rO.bindVertexArrayOES(null),r.eO=null),x1.gpuInputAssembler=null,r.sO!==n.tO&&e.bindBuffer(34962,n.tO),n.uO?e.bufferData(34962,n.uO,s):e.bufferData(34962,n.iO,s),e.bindBuffer(34962,null),r.sO=null):4&n.ZS?(i.extensions.nO&&r.eO&&(i.extensions.rO.bindVertexArrayOES(null),r.eO=null),x1.gpuInputAssembler=null,r.hO!==n.tO&&e.bindBuffer(34963,n.tO),n.uO?e.bufferData(34963,n.uO,s):e.bufferData(34963,n.iO,s),e.bindBuffer(34963,null),r.hO=null):16&n.ZS?n.uO&&(n.vf32=new Float32Array(n.uO.buffer)):(64&n.ZS||2&n.ZS||1&n.ZS||ut(16315),n.JS=0),q1.instance.memoryStatus.bufferSize-=h,q1.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,i){var n;this.un?st(16380):(n=void 0!==i?i:64&this.en?0:t.byteLength,M1(q1.instance,this.fI,t,0,n))},e(i,[{key:"gpuBuffer",get:function(){return this.fI}},{key:"gpuBufferView",get:function(){return this.vI}}]),i}(lg),i2=function(t){function i(){var i;return(i=t.call(this)||this).dI=!1,i.gI=null,i.wI=null,i._I=[],i.mI=Array(8).fill(0),i.pI=new Yd,i.yI=!1,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.M=t.type,this.an=t.queue;for(var i=q1.instance.bindingMappings.bI.length,n=0;n<i;n++)this._I.push(null)},n.destroy=function(){},n.begin=function(){this.gI=null,this.wI=null,this._I.length=0,this.cn=0,this.vn=0,this.ln=0},n.end=function(){this.yI&&this.AI(),this.dI=!1},n.beginRenderPass=function(){ut(16401),this.dI=!0},n.endRenderPass=function(){this.dI=!1},n.bindPipelineState=function(t){var i=t.gpuPipelineState;i!==this.gI&&(this.gI=i,this.yI=!0)},n.bindDescriptorSet=function(t,i,n){var e=i.gpuDescriptorSet;if(e!==this._I[t]&&(this._I[t]=e,this.yI=!0),n){var r,s=null==(r=this.gI)?void 0:r.kR;if(s){for(var h=this.mI,u=s.oI[t],o=0;o<n.length;o++)h[u+o]=n[o];this.yI=!0}}},n.bindInputAssembler=function(t){var i=t.EI();this.wI=i,this.yI=!0},n.setViewport=function(t){var i=this.pI.viewport;i.left===t.left&&i.top===t.top&&i.width===t.width&&i.height===t.height&&i.minDepth===t.minDepth&&i.maxDepth===t.maxDepth||(i.left=t.left,i.top=t.top,i.width=t.width,i.height=t.height,i.minDepth=t.minDepth,i.maxDepth=t.maxDepth,this.yI=!0)},n.setScissor=function(t){var i=this.pI.scissor;i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height||(i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.yI=!0)},n.setLineWidth=function(t){this.pI.lineWidth!==t&&(this.pI.lineWidth=t,this.yI=!0)},n.setDepthBias=function(t,i,n){var e=this.pI;e.depthBiasConstant===t&&e.depthBiasClamp===i&&e.depthBiasSlope===n||(e.depthBiasConstant=t,e.depthBiasClamp=i,e.depthBiasSlope=n,this.yI=!0)},n.setBlendConstants=function(t){var i=this.pI.blendConstant;i.x===t.x&&i.y===t.y&&i.z===t.z&&i.w===t.w||(i.copy(t),this.yI=!0)},n.setDepthBound=function(t,i){var n=this.pI;n.depthMinBounds===t&&n.depthMaxBounds===i||(n.depthMinBounds=t,n.depthMaxBounds=i,this.yI=!0)},n.setStencilWriteMask=function(t,i){var n=this.pI.stencilStatesFront,e=this.pI.stencilStatesBack;1&t&&n.writeMask!==i&&(n.writeMask=i,this.yI=!0),2&t&&e.writeMask!==i&&(e.writeMask=i,this.yI=!0)},n.setStencilCompareMask=function(t,i,n){var e=this.pI.stencilStatesFront,r=this.pI.stencilStatesBack;1&t&&(e.compareMask===n&&e.reference===i||(e.reference=i,e.compareMask=n,this.yI=!0)),2&t&&(r.compareMask===n&&r.reference===i||(r.reference=i,r.compareMask=n,this.yI=!0))},n.draw=function(){ut(16328)},n.updateBuffer=function(){ut(16329)},n.copyBuffersToTexture=function(){ut(16330)},n.execute=function(){ut(16402)},n.pipelineBarrier=function(){},n.AI=function(){ut(16401)},n.blitTexture=function(){ut(16401)},i}(dg),n2=function(t){s(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).kI=null,i.TI=[],i.SI=void 0,i}return i.OI=function(){return this.kI},i.initialize=function(t){var i,n=this;this.Dn=t.renderPass,this.Un=t.colorTextures||[];for(var e=this.Bn=t.depthStencilTexture||null,r=0,s=[],h=0;h<t.colorTextures.length;++h){var u=t.colorTextures[h];u&&(s.push(u.gpuTexture),r=u.lodLevel)}var o=null;e&&(o=e.gpuTexture,r=e.lodLevel);var a=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER;this.kI={aI:t.renderPass.gpuRenderPass,RO:s,CO:o,NO:null,MO:!0,get width(){return this.RO.length>0?this.RO[0].gO:this.CO?this.CO.gO:a},set width(t){a=t},get height(){return this.RO.length>0?this.RO[0].wO:this.CO?this.CO.wO:c},set height(t){c=t},dR:r},F1(q1.instance,this.kI),this.kI.RO.forEach((function(t){return n.TI.push(t.mO)})),this.SI=null==(i=this.kI.CO)?void 0:i.mO,this.xn=this.kI.gO,this.Gn=this.kI.wO},i.destroy=function(){var t,i,n,e;this.kI&&(t=q1.instance,i=this.kI,n=t.gl,e=t.stateCache,i.NO&&(n.deleteFramebuffer(i.NO),e.NO===i.NO&&(n.bindFramebuffer(36160,null),e.NO=null),i.NO=null),this.kI=null,this.TI.length=0,this.SI=null)},e(n,[{key:"needRebuild",get:function(){var t=this.kI;if(t){for(var i,n=0;n<t.RO.length;n++)if(t.RO[n].mO!==this.TI[n])return!0;if((null==(i=t.CO)?void 0:i.mO)!==this.SI)return!0}return!1}}]),n}(mg),e2=function(t){s(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).JR=null,i}return i.EI=function(){return this.JR},i.initialize=function(t){if(0!==t.vertexBuffers.length){if(this.jn=t.attributes,this.Hn=this.computeAttributesHash(),this.Vn=t.vertexBuffers,t.indexBuffer)this.$n=t.indexBuffer,this.zn.indexCount=this.$n.size/this.$n.stride,this.zn.firstIndex=0;else{var i=this.Vn[0];this.zn.vertexCount=i.size/i.stride,this.zn.firstVertex=0,this.zn.vertexOffset=0}this.zn.instanceCount=0,this.zn.firstInstance=0,this.Wn=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),e=0;e<t.vertexBuffers.length;++e){var r=t.vertexBuffers[e];r.gpuBuffer&&(n[e]=r.gpuBuffer)}var s=null,h=0;if(t.indexBuffer&&(s=t.indexBuffer.gpuBuffer))switch(s.VO){case 1:h=5121;break;case 2:h=5123;break;case 4:h=5125;break;default:ut(16332)}var u=null;t.indirectBuffer&&(u=t.indirectBuffer.gpuBuffer),this.JR={oR:t.attributes,aR:n,RR:s,CR:u,uR:[],xR:h,lR:new Map},D1(q1.instance,this.JR)}else ut(16331)},i.destroy=function(){var t=q1.instance;this.JR&&t.extensions.nO&&U1(t,this.JR),this.JR=null},n}(pg),r2=function(t){function i(){var i;return(i=t.call(this)||this).KR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){Array.prototype.push.apply(this.Qn,t.bindings);for(var i=0,n=-1,e=[],r=0;r<this.Qn.length;r++){var s=this.Qn[r];e.push(i),i+=s.count,s.binding>n&&(n=s.binding)}this.Zn=Array(n+1).fill(-1);for(var h=this.Jn=Array(n+1).fill(-1),u=0;u<this.Qn.length;u++){var o=this.Qn[u];this.Zn[o.binding]=u,h[o.binding]=e[u]}for(var a=[],c=0;c<this.Qn.length;c++){var f=this.Qn[c];if(10&f.descriptorType)for(var v=0;v<f.count;v++)a.push(f.binding)}this.KR={VS:this.Qn,sI:a,$S:h,WS:i}},n.destroy=function(){this.Qn.length=0},e(i,[{key:"gpuDescriptorSetLayout",get:function(){return this.KR}}]),i}(bg),s2=function(t){function i(){var i;return(i=t.call(this)||this).qR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){Array.prototype.push.apply(this.te,t.setLayouts);for(var i=[],n=[],e=0,r=[],s=0;s<this.te.length;s++){for(var h=this.te[s],u=h.gpuDescriptorSetLayout.sI,o=Array(h.bindingIndices.length).fill(-1),a=0;a<u.length;a++){var c=u[a];o[c]<0&&(o[c]=e+a)}n.push(h.gpuDescriptorSetLayout),i.push(o),r.push(e),e+=u.length}this.qR={hI:n,TR:i,uI:e,oI:r}},n.destroy=function(){this.te.length=0},e(i,[{key:"gpuPipelineLayout",get:function(){return this.qR}}]),i}(Ag),h2=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],u2=function(t){function i(){var i;return(i=t.call(this)||this).QR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.ee=t.primitive,this.ie=t.shader,this.ne=t.pipelineLayout;var i=this.ue;if(t.blendState){var n=t.blendState,e=n.targets;e&&e.forEach((function(t,n){i.setTarget(n,t)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}Object.assign(this.se,t.rasterizerState),Object.assign(this.he,t.depthStencilState),this.re=t.inputState,this.Dn=t.renderPass,this.oe=t.dynamicStates;for(var r=[],s=0;s<31;s++)this.oe&1<<s&&r.push(1<<s);this.QR={AR:h2[t.primitive],bR:t.shader.gpuShader,kR:t.pipelineLayout.gpuPipelineLayout,ER:t.rasterizerState,_R:t.depthStencilState,pR:t.blendState,aI:t.renderPass.gpuRenderPass,MR:r}},n.destroy=function(){this.QR=null},e(i,[{key:"gpuPipelineState",get:function(){return this.QR}}]),i}(Rg),o2=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.beginRenderPass=function(t,i,n,e,r,s){j1(q1.instance,t.gpuRenderPass,i.OI(),n,e,r,s),this.dI=!0},n.draw=function(t){if(this.dI){this.yI&&this.AI();var i="drawInfo"in t?t.drawInfo:t;V1(q1.instance,i),++this.cn,this.vn+=i.instanceCount;var n=i.indexCount||i.vertexCount;if(this.gI)switch(this.gI.AR){case 4:this.ln+=n/3*Math.max(i.instanceCount,1);break;case 5:case 6:this.ln+=(n-2)*Math.max(i.instanceCount,1)}}else ut(16328)},n.setViewport=function(t){var i=q1.instance,n=i.stateCache,e=i.gl;n.gR.left===t.left&&n.gR.top===t.top&&n.gR.width===t.width&&n.gR.height===t.height||(e.viewport(t.left,t.top,t.width,t.height),n.gR.left=t.left,n.gR.top=t.top,n.gR.width=t.width,n.gR.height=t.height)},n.setScissor=function(t){var i=q1.instance,n=i.stateCache,e=i.gl;n.wR.x===t.x&&n.wR.y===t.y&&n.wR.width===t.width&&n.wR.height===t.height||(e.scissor(t.x,t.y,t.width,t.height),n.wR.x=t.x,n.wR.y=t.y,n.wR.width=t.width,n.wR.height=t.height)},n.updateBuffer=function(t,i,n){if(this.dI)ut(16329);else{var e,r=t.gpuBuffer;r&&(e=void 0!==n?n:64&t.usage?0:i.byteLength,M1(q1.instance,r,i,0,e))}},n.copyBuffersToTexture=function(t,i,n){if(this.dI)ut(16330);else{var e=i.gpuTexture;e&&X1(q1.instance,t,e,n)}},n.execute=function(){ut(16402)},n.AI=function(){H1(q1.instance,this.gI,this.wI,this._I,this.mI,this.pI),this.yI=!1},n.blitTexture=function(t,i,n,e){var r=t.gpuTexture,s=i.gpuTexture;K1(q1.instance,r,s,n,e)},i}(i2),a2=function(t){function i(){var i;return(i=t.call(this)||this).RI=0,i.II=0,i.MI=0,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.M=t.type},n.destroy=function(){},n.submit=function(t){for(var i=t.length,n=0;n<i;n++){var e=t[n];this.RI+=e.numDrawCalls,this.II+=e.numInstances,this.MI+=e.numTris}},n.V_=function(){this.RI=0,this.II=0,this.MI=0},i}(Ig),c2=function(t){function i(){var i;return(i=t.call(this)||this).NI=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.ae=t.colorAttachments,this.ce=t.depthStencilAttachment,this.fe=t.subpasses,this.NI={mR:this.ae,yR:this.ce},this.ve=this.computeHash()},n.destroy=function(){this.NI=null},e(i,[{key:"gpuRenderPass",get:function(){return this.NI}}]),i}(Mg),f2=[10497,33648,33071,33071],v2=function(t){function i(i,n){var e;(e=t.call(this,i,n)||this).CI=null;var r,s,h=e.le.minFilter,u=e.le.magFilter,o=e.le.mipFilter;r=2===h||3===h?2===o||3===o?9987:1===o?9985:9729:2===o||3===o?9986:1===o?9984:9728,s=2===u||3===u?9729:9728;var a=f2[e.le.addressU],c=f2[e.le.addressV],f=f2[e.le.addressW];return e.CI={TO:r,SO:s,EO:a,kO:c,cI:f},e}return s(i,t),e(i,[{key:"gpuSampler",get:function(){return this.CI}}]),i}(Ng),l2=function(t){function i(){var i;return(i=t.call(this)||this).YR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.de=t.name,this.ge=t.stages,this.jn=t.attributes,this.we=t.blocks,this.En=t.samplers,this.YR={DO:t.name,WO:t.blocks.slice(),JO:t.samplerTextures.slice(),ZO:t.subpassInputs.slice(),FO:new Array(t.stages.length),UO:null,jO:[],YO:[],zO:[],tR:[]};for(var i=0;i<t.stages.length;++i){var n=t.stages[i];this.YR.FO[i]={XS:n.stage,BO:n.source,PO:null}}},n.destroy=function(){this.YR&&(B1(q1.instance,this.YR),this.YR=null)},e(i,[{key:"gpuShader",get:function(){return null===this.YR.UO&&P1(q1.instance,this.YR),this.YR}}]),i}(Cg),d2=function(){function t(){this.sO=null,this.hO=null,this.eO=null,this.yO=0,this.pO=[],this.OO=null,this.NO=null,this.gR=new id,this.wR=new Yl(0,0,0,0),this.ER=new Eg,this._R=new kg,this.pR=new Sg,this.UO=null,this.IR=[],this.OR=[],this.rR={}}return t.prototype.Jr=function(t,i){for(var n=0;n<t;++n)this.pO.push({mO:null});this.IR.length=i,this.IR.fill(!1),this.OR.length=i,this.OR.fill(!1)},t}(),g2=function(t){function i(){var i;return(i=t.call(this)||this).LI=null,i.FI=0,i}s(i,t);var n=i.prototype;return n.initialize=function(t,i){var n=this,e=q1.instance,r=t,s=t;"texture"in t&&(r=s.texture.info,n.pe=!0);var h=n.le;h.copy(r);var u=n._e;n.me=eg(h.width)&&eg(h.height),n.sn=hg(h.format,n.width,n.height,n.depth,h.levelCount)*h.layerCount,n.pe?(u.copy(s),n.FI=s.baseLevel,n.LI=s.texture.LI):(n.LI={XS:r.type,lO:r.format,ZS:r.usage,gO:r.width,wO:r.height,BI:r.depth,iO:n.sn,DI:r.layerCount,bO:r.levelCount,xI:r.samples,jR:r.flags,AO:n.me,JS:0,vO:0,fO:0,dO:0,GI:0,mO:null,OO:null,EO:0,kO:0,TO:0,SO:0,IO:i||!1},n.LI.IO||(N1(e,n.LI),e.memoryStatus.textureSize+=n.sn),u.texture=n,u.type=t.type,u.format=t.format,u.baseLevel=0,u.levelCount=t.levelCount,u.baseLayer=0,u.layerCount=t.layerCount)},n.destroy=function(){var t=this,i=q1.instance;!t.pe&&t.LI&&(C1(i,t.LI),i.memoryStatus.textureSize-=t.sn,t.LI=null)},n.getTextureHandle=function(){var t=this.LI;return t?t.mO?t.mO:t.OO?t.OO:0:0},n.resize=function(t,n){var e=this,r=q1.instance,s=e.le;if(s.width!==t||s.height!==n){s.levelCount===i.getLevelCount(s.width,s.height)?s.levelCount=i.getLevelCount(t,n):s.levelCount>1&&(s.levelCount=Math.min(s.levelCount,i.getLevelCount(t,n)));var h=e.sn;s.width=t,s.height=n,e.sn=hg(s.format,e.width,e.height,e.depth,s.levelCount)*s.layerCount;var u=e.LI;!e.pe&&u&&(u.gO=t,u.wO=n,u.iO=e.sn,u.IO||(L1(r,u),r.memoryStatus.textureSize-=h,r.memoryStatus.textureSize+=e.sn))}},n.initAsSwapchainTexture=function(t){var i=new vd;i.format=t.format,i.usage=tg[t.format].hasDepth?32:16,i.width=t.width,i.height=t.height,this.initialize(i,!0)},e(i,[{key:"gpuTexture",get:function(){return this.LI}},{key:"lodLevel",get:function(){return this.FI}}]),i}(Lg),w2="webglcontextlost";function _2(t){t.activeTexture(33984),t.pixelStorei(3333,1),t.pixelStorei(3317,1),t.pixelStorei(37440,!1),t.bindFramebuffer(36160,null),t.enable(3089),t.enable(2884),t.cullFace(1029),t.frontFace(2305),t.disable(32823),t.polygonOffset(0,0),t.enable(2929),t.depthMask(!0),t.depthFunc(513),t.depthRange(0,1),t.stencilFuncSeparate(1028,519,1,65535),t.stencilOpSeparate(1028,7680,7680,7680),t.stencilMaskSeparate(1028,65535),t.stencilFuncSeparate(1029,519,1,65535),t.stencilOpSeparate(1029,7680,7680,7680),t.stencilMaskSeparate(1029,65535),t.disable(2960),t.disable(32926),t.disable(3042),t.blendEquationSeparate(32774,32774),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}function m2(t,i){for(var n=["","WEBKIT_","MOZ_"],e=0;e<n.length;++e){var r=t.getExtension(n[e]+i);if(r)return r}return null}function p2(t){var i={jI:m2(t,"EXT_texture_filter_anisotropic"),HI:m2(t,"EXT_blend_minmax"),VI:m2(t,"EXT_frag_depth"),$I:m2(t,"EXT_shader_texture_lod"),WI:m2(t,"EXT_sRGB"),rO:m2(t,"OES_vertex_array_object"),zI:m2(t,"EXT_color_buffer_half_float"),XI:m2(t,"WEBGL_color_buffer_float"),YI:m2(t,"WEBGL_compressed_texture_etc1"),KI:m2(t,"WEBGL_compressed_texture_etc"),qI:m2(t,"WEBGL_compressed_texture_pvrtc"),QI:m2(t,"WEBGL_compressed_texture_s3tc"),ZI:m2(t,"WEBGL_compressed_texture_s3tc_srgb"),JI:m2(t,"WEBGL_debug_shaders"),LO:m2(t,"WEBGL_draw_buffers"),tM:m2(t,"WEBGL_lose_context"),_O:m2(t,"WEBGL_depth_texture"),iM:m2(t,"OES_texture_half_float"),nM:m2(t,"OES_texture_half_float_linear"),eM:m2(t,"OES_texture_float"),rM:m2(t,"OES_texture_float_linear"),sM:m2(t,"OES_standard_derivatives"),hM:m2(t,"OES_element_index_uint"),SR:m2(t,"ANGLE_instanced_arrays"),uM:m2(t,"WEBGL_debug_renderer_info"),NR:null,oM:null,xO:!0,HR:!1,eR:function(t){return!!t},nO:!1};return Bu.os===Nu.IOS&&14===Bu.osMainVersion&&Bu.isBrowser||(i.oM=m2(t,"WEBGL_compressed_texture_astc")),Bu.os!==Nu.ANDROID&&Bu.os!==Nu.IOS&&(i.NR=m2(t,"WEBGL_multi_draw")),Bu.browserType===Ru.UC&&(i.SR=null),Bu.os===Nu.IOS&&Bu.osMainVersion<=10&&(i.xO=!1),i.rO&&(i.nO=!0),i}function y2(t){var i=null;try{var n={alpha:Gi.ENABLE_TRANSPARENT_CANVAS,antialias:Gi.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};i=t.getContext("webgl",n)}catch(t){return null}return i}var b2=function(t){function i(){var i;return(i=t.call(this)||this).aM=new d2,i.cM=null,i.fM=null,i.Ae=null,i.vM=null,i.lM=null,i.dM=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){var i=this;i.Ae=t.windowHandle,i.vM=i.gM.bind(i),i.Ae.addEventListener(w2,i.vM);var n=q1.instance,e=n.gl,r=n.capabilities;i.aM.Jr(r.maxTextureUnits,r.maxVertexAttributes),i.lM=p2(e),_2(e);var s=55,h=e.getParameter(3414),u=e.getParameter(3415);h&&u?s=55:h&&(s=54),i.Pn=new g2,i.Pn.initAsSwapchainTexture({swapchain:i,format:35,width:t.width,height:t.height}),i.Bn=new g2,i.Bn.initAsSwapchainTexture({swapchain:i,format:s,width:t.width,height:t.height}),i.cM=n.createTexture(new vd(1,4,35,2,2,1)),i.fM=n.createTexture(new vd(3,4,35,2,2,1,6));var o=new td;o.texExtent.width=2,o.texExtent.height=2;var a=new Uint8Array(i.cM.size);a.fill(0),n.copyBuffersToTexture([a],i.cM,[o]),o.texSubres.layerCount=6,n.copyBuffersToTexture([a,a,a,a,a,a],i.fM,[o]),i.dM=new J1},n.destroy=function(){var t=this;t.Ae&&t.vM&&(t.Ae.removeEventListener(w2,t.vM),t.vM=null),t.cM&&(t.cM.destroy(),t.cM=null),t.fM&&(t.fM.destroy(),t.fM=null),t.dM&&(t.dM.kg(),t.dM=null),t.lM=null,t.Ae=null},n.resize=function(t,i){var n=this;n.Pn.width===t&&n.Pn.height===i||(q("Resizing swapchain: "+t+"x"+i),n.Ae.width=t,n.Ae.height=i,n.Pn.resize(t,i),n.Bn.resize(t,i))},n.gM=function(t){st(11e3),X(t)},e(i,[{key:"extensions",get:function(){return this.lM}},{key:"blitManager",get:function(){return this.dM}}]),i}(_g);function A2(t,i,n){for(var e=0;e<i.length;++e)t[i[e]]=n}function E2(t,i,n){for(var e=0;e<i.length;++e)t[i[e]]|=n}function k2(t,i,n){for(var e=0;e<i.length;++e)t[i[e]]=n}var T2=t("WebGLDevice",function(t){function i(){var i;return(i=t.call(this)||this).Ee=null,i.gr=null,i.wM=null,i._M=new Array(117),i}s(i,t);var n=i.prototype;return n.initialize=function(t){q1.$R(this),this.dn=6;var i=this.An=t.bindingMappingInfo,n=[],e=[],r=i.setIndices[0];n[r]=0,e[r]=0;for(var s=1;s<i.setIndices.length;++s){var h=i.setIndices[s],u=i.setIndices[s-1];n[h]=i.maxBlockCounts[u]+n[u],e[h]=i.maxSamplerTextureCounts[u]+e[u]}for(var o=0;o<i.setIndices.length;++o){var a=i.setIndices[o];e[a]-=i.maxBlockCounts[a]}this.wM={bI:n,hR:e,sR:i.setIndices[i.setIndices.length-1]};var c=this.gr=y2(gg.Rn);if(!c)return ut(16333),!1;this.an=this.createQueue(new Vd(0)),this.pn=this.createCommandBuffer(new Hd(this.an));var f=c.getParameter.bind(c),v=this.bn;v.maxVertexAttributes=f(34921),v.maxVertexUniformVectors=f(36347),v.maxFragmentUniformVectors=f(36349),v.maxTextureUnits=f(34930),v.maxVertexTextureUnits=f(35660),v.maxTextureSize=f(3379),v.maxCubeMapTextureSize=f(34076),v.maxArrayTextureLayers=0,v.max3DTextureSize=0,v.maxUniformBufferBindings=16;var l=c.getSupportedExtensions(),d="";l&&l.forEach((function(t){d+=t+" "}));var g=p2(c);g.uM?(this.gn=f(g.uM.UNMASKED_RENDERER_WEBGL),this.wn=f(g.uM.UNMASKED_VENDOR_WEBGL)):(this.gn=f(7937),this.wn=f(7936));var w=f(7938),_=this._n;_.fill(!1),this.mM(g),g.HI&&(_[3]=!0),g.hM&&(_[0]=!0),g.SR&&(_[1]=!0),g.LO&&(_[2]=!0);var m="";return this.getFormatFeatures(72)&&(m+="etc1 "),this.getFormatFeatures(73)&&(m+="etc2 "),this.getFormatFeatures(56)&&(m+="dxt "),this.getFormatFeatures(83)&&(m+="pvrtc "),this.getFormatFeatures(89)&&(m+="astc "),q("WebGL device initialized."),q("RENDERER: "+this.gn),q("VENDOR: "+this.wn),q("VERSION: "+w),q("COMPRESSED_FORMAT: "+m),q("EXTENSIONS: "+d),!0},n.destroy=function(){this.an&&(this.an.destroy(),this.an=null),this.pn&&(this.pn.destroy(),this.pn=null),this.Ee=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this.an;this.cn=t.RI,this.vn=t.II,this.ln=t.MI,t.V_()},n.mM=function(t){var i=this.mn;i.fill(0);var n=this._M;n.fill(!0),A2(i,[24,47,35,50,49],7),A2(i,[54,55],1),k2(n,[47,50,49,54,55],!1),E2(i,[7,17,28,40,6,16,27,39,7,17,28,40,6,16,27,39,11,21,32,44],16),t.WI&&(i[25]=7,i[37]=7,n[37]=!1),t._O&&(i[54]|=7,i[55]|=7),t.XI&&(i[32]|=1,i[44]|=1,n[32]=!1,n[44]=!1),t.zI&&(i[29]|=1,i[41]|=1,n[29]=!1,n[41]=!1),t.eM&&(i[32]|=3,i[44]|=3),t.iM&&(i[29]|=3,i[41]|=3),t.rM&&(i[32]|=4,i[44]|=4),t.nM&&(i[29]|=4,i[41]|=4),t.YI&&(i[72]=6),t.KI&&A2(i,[73,77,74,78,75,76],6),t.QI&&A2(i,[56,57,58,59,60,61,62,63],6),t.qI&&E2(i,[83,84,85,86],6),t.oM&&E2(i,[89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116],6)},n.createCommandBuffer=function(t){var i=new(0===t.type?o2:i2);return i.initialize(t),i},n.createSwapchain=function(t){var i=new b2;return this.Ee=i,i.initialize(t),i},n.createBuffer=function(t){var i=new t2;return i.initialize(t),i},n.createTexture=function(t){var i=new g2;return i.initialize(t),i},n.createDescriptorSet=function(t){var i=new l1;return i.initialize(t),i},n.createShader=function(t){var i=new l2;return i.initialize(t),i},n.createInputAssembler=function(t){var i=new e2;return i.initialize(t),i},n.createRenderPass=function(t){var i=new c2;return i.initialize(t),i},n.createFramebuffer=function(t){var i=new n2;return i.initialize(t),i},n.createDescriptorSetLayout=function(t){var i=new r2;return i.initialize(t),i},n.createPipelineLayout=function(t){var i=new s2;return i.initialize(t),i},n.createPipelineState=function(t){var i=new u2;return i.initialize(t),i},n.createQueue=function(t){var i=new a2;return i.initialize(t),i},n.getSampler=function(t){var i=Ng.computeHash(t);return this.En.has(i)||this.En.set(i,new v2(t,i)),this.En.get(i)},n.getSwapchains=function(){return[this.Ee]},n.getGeneralBarrier=function(t){var i=Fg.computeHash(t);return this.kn.has(i)||this.kn.set(i,new Fg(t,i)),this.kn.get(i)},n.getTextureBarrier=function(t){var i=Pg.computeHash(t);return this.Tn.has(i)||this.Tn.set(i,new Pg(t,i)),this.Tn.get(i)},n.getBufferBarrier=function(t){var i=Bg.computeHash(t);return this.Sn.has(i)||this.Sn.set(i,new Bg(t,i)),this.Sn.get(i)},n.copyBuffersToTexture=function(t,i,n){X1(this,t,i.gpuTexture,n)},n.copyTextureToBuffers=function(t,i,n){Y1(this,t.gpuTexture,i,n)},n.copyTexImagesToTexture=function(t,i,n){$1(this,t,i.gpuTexture,n)},e(i,[{key:"gl",get:function(){return this.gr}},{key:"extensions",get:function(){return this.Ee.extensions}},{key:"stateCache",get:function(){return this.Ee.aM}},{key:"nullTex2D",get:function(){return this.Ee.cM}},{key:"nullTexCube",get:function(){return this.Ee.fM}},{key:"textureExclusive",get:function(){return this._M}},{key:"bindingMappings",get:function(){return this.wM}},{key:"blitManager",get:function(){return this.Ee.blitManager}}]),i}(gg));T.WebGLDevice=T2;var S2=function(t){function i(){var i;return(i=t.call(this)||this).HS=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.Xn=t.layout;var i=t.layout.pM(),n=i.VS,e=i.$S,r=i.WS;this.Yn=Array(r).fill(null),this.Kn=Array(r).fill(null),this.En=Array(r).fill(null);var s=[];this.HS={zS:s,$S:e};for(var h=0;h<n.length;++h)for(var u=n[h],o=0;o<u.count;o++){var a={XS:u.descriptorType,YS:null,yM:null,qS:null};s.push(a)}},n.destroy=function(){this.Xn=null,this.HS=null},n.update=function(){if(this.qn&&this.HS){for(var t=this.HS.zS,i=0;i<t.length;++i)t[i].XS&ig?this.Yn[i]&&(t[i].YS=this.Yn[i].bM()):t[i].XS&ng&&(this.Kn[i]&&(t[i].yM=this.Kn[i].gpuTextureView),this.En[i]&&(t[i].qS=this.En[i].gpuSampler));this.qn=!1}},e(i,[{key:"gpuDescriptorSet",get:function(){return this.HS}}]),i}(yg),O2=[10497,33648,33071,33071],R2=new Float32Array(4),I2=Math.max,M2=Math.min;function N2(t){switch(t){case 4:case 6:case 14:case 16:case 24:case 25:case 27:case 36:case 35:case 37:case 39:case 56:case 58:case 60:case 61:case 62:case 63:case 64:case 66:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 79:case 81:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:default:return 5121;case 5:case 7:case 15:case 17:case 26:case 28:case 38:case 40:case 65:case 67:case 80:case 82:return 5120;case 8:case 18:case 29:case 41:return 5131;case 9:case 19:case 30:case 42:return 5123;case 10:case 20:case 31:case 43:return 5122;case 11:case 21:case 32:case 44:case 53:case 54:case 69:case 68:return 5126;case 12:case 22:case 33:case 45:return 5125;case 13:case 23:case 34:case 46:return 5124;case 47:return 33635;case 48:return 35899;case 49:return 32820;case 50:return 32819;case 51:case 52:return 33640;case 55:return 34042}}function C2(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 4:return 33321;case 5:return 36756;case 6:return 33330;case 7:return 33329;case 14:return 33323;case 15:return 36757;case 16:return 33336;case 17:return 33335;case 24:return 32849;case 26:return 36758;case 27:return 36221;case 28:return 36239;case 36:case 35:return 32856;case 38:return 36759;case 39:return 36220;case 40:return 36238;case 10:return 33331;case 9:return 33332;case 8:return 33325;case 20:return 33337;case 19:return 33338;case 18:return 33327;case 31:return 36233;case 30:return 36215;case 29:return 34843;case 43:return 36232;case 42:return 36214;case 41:return 34842;case 13:return 33333;case 12:return 33334;case 11:return 33326;case 23:return 33339;case 22:return 33340;case 21:return 33328;case 34:return 36227;case 33:return 36209;case 32:return 34837;case 46:return 36226;case 45:return 36208;case 44:return 34836;case 47:return 36194;case 49:return 32855;case 50:return 32854;case 25:return 35905;case 37:return 35907;case 51:return 32857;case 52:return 36975;case 48:return 35898;case 54:return 36012;case 55:return 35056;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ut(16309),6408}}function L2(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 4:case 5:case 6:case 7:case 9:case 10:case 8:case 12:case 13:case 11:return 6403;case 14:case 15:case 16:case 17:case 19:case 20:case 18:case 22:case 23:case 21:return 33319;case 24:case 26:case 27:case 28:case 30:case 31:case 29:case 33:case 34:case 32:case 48:case 47:case 25:return 6407;case 36:case 35:case 38:case 39:case 40:case 42:case 43:case 41:case 45:case 46:case 44:case 51:case 49:case 50:case 37:return 6408;case 54:return 6402;case 55:return 34041;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ut(16310),6408}}function F2(t){switch(t){case 1:return 35670;case 2:return 35671;case 3:return 35672;case 4:return 35673;case 5:return 5124;case 6:return 35667;case 7:return 35668;case 8:return 35669;case 9:return 5125;case 13:return 5126;case 14:return 35664;case 15:return 35665;case 16:return 35666;case 17:return 35674;case 18:return 35685;case 19:return 35686;case 20:return 35687;case 21:return 35675;case 22:return 35688;case 23:return 35689;case 24:return 35690;case 25:return 35676;case 28:return 35678;case 29:return 36289;case 30:return 35679;case 31:return 35680;default:return ut(16311),0}}function P2(t){switch(t){case 35670:return 1;case 35671:return 2;case 35672:return 3;case 35673:return 4;case 5124:return 5;case 35667:return 6;case 35668:return 7;case 35669:return 8;case 5125:return 9;case 36294:return 10;case 36295:return 11;case 36296:return 12;case 5126:return 13;case 35664:return 14;case 35665:return 15;case 35666:return 16;case 35674:return 17;case 35685:return 18;case 35686:return 19;case 35687:return 20;case 35675:return 21;case 35688:return 22;case 35689:return 23;case 35690:return 24;case 35676:return 25;case 35678:return 28;case 36289:return 29;case 35679:return 30;case 35680:return 31;default:return ut(16313),0}}function B2(t){switch(t){case 35670:case 5124:case 5125:case 5126:case 35678:case 36289:case 36292:case 35679:case 35680:case 36298:case 36303:case 36299:case 36300:case 36306:case 36311:case 36307:case 36308:return 4;case 35671:case 35667:case 36294:case 35664:return 8;case 35672:case 35668:case 36295:case 35665:return 12;case 35673:case 35669:case 36296:case 35666:case 35674:return 16;case 35685:case 35687:return 24;case 35686:case 35689:return 32;case 35675:return 36;case 35688:case 35690:return 48;case 35676:return 64;default:return ut(16314),0}}function D2(t){switch(t){case 35674:case 35685:case 35686:return 2;case 35687:case 35675:case 35688:return 3;case 35689:case 35690:case 35676:return 4;default:return 1}}var U2=[512,513,514,515,516,517,518,519],x2=[0,7680,7681,7682,7683,5386,34055,34056],G2=[32774,32778,32779,32775,32776],j2=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];function H2(t,i){var n=t.gl,e=t.AM(),r=2&i.QS?35048:35044;if(8&i.ZS){i.JS=34962;var s=n.createBuffer();s&&(i.tO=s,i.iO>0&&(t.extensions.nO&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,e.sO!==i.tO&&(n.bindBuffer(34962,i.tO),e.sO=i.tO),n.bufferData(34962,i.iO,r),n.bindBuffer(34962,null),e.sO=null))}else if(4&i.ZS){i.JS=34963;var h=n.createBuffer();h&&(i.tO=h,i.iO>0&&(t.extensions.nO&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,e.hO!==i.tO&&(n.bindBuffer(34963,i.tO),e.hO=i.tO),n.bufferData(34963,i.iO,r),n.bindBuffer(34963,null),e.hO=null))}else if(16&i.ZS){i.JS=35345;var u=n.createBuffer();u&&i.iO>0&&(i.tO=u,e.kM!==i.tO&&(n.bindBuffer(35345,i.tO),e.kM=i.tO),n.bufferData(35345,i.iO,r),n.bindBuffer(35345,null),e.kM=null)}else 64&i.ZS||2&i.ZS||1&i.ZS||ut(16315),i.JS=0}function V2(t,i){var n=t.gl,e=t.AM(),r=t.extensions.nO;if(i.tO){switch(i.JS){case 34962:r&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,n.bindBuffer(34962,null),e.sO=null;break;case 34963:r&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,n.bindBuffer(34963,null),e.hO=null;break;case 35345:n.bindBuffer(35345,null),e.kM=null}n.deleteBuffer(i.tO),i.tO=null}}function $2(t,i){var n=t.gl,e=t.AM(),r=2&i.QS?35048:35044;8&i.ZS?(t.extensions.nO&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,e.sO!==i.tO&&n.bindBuffer(34962,i.tO),i.uO?n.bufferData(34962,i.uO,r):n.bufferData(34962,i.iO,r),n.bindBuffer(34962,null),e.sO=null):4&i.ZS?(t.extensions.nO&&e.eO&&(n.bindVertexArray(null),e.eO=null),n3.EM=null,e.hO!==i.tO&&n.bindBuffer(34963,i.tO),i.uO?n.bufferData(34963,i.uO,r):n.bufferData(34963,i.iO,r),n.bindBuffer(34963,null),e.hO=null):16&i.ZS?(e.kM!==i.tO&&n.bindBuffer(35345,i.tO),n.bufferData(35345,i.iO,r),n.bindBuffer(35345,null),e.kM=null):(64&i.ZS||2&i.ZS||1&i.ZS||ut(16315),i.JS=0)}function W2(t,i,n,e,r){if(64&i.ZS){i.aO.oO();for(var s=n.drawInfos,h=0;h<s.length;++h)i.aO.cO(e+h,s[h])}else{var u=n,o=t.gl,a=t.AM();switch(i.JS){case 34962:t.extensions.nO&&a.eO&&(o.bindVertexArray(null),a.eO=null),n3.EM=null,a.sO!==i.tO&&(o.bindBuffer(34962,i.tO),a.sO=i.tO),Bu.os===Nu.IOS&&2&i.QS&&0===e&&r===u.byteLength?o.bufferData(i.JS,u,o.DYNAMIC_DRAW):r===u.byteLength?o.bufferSubData(i.JS,e,u):o.bufferSubData(i.JS,e,u.slice(0,r));break;case 34963:t.extensions.nO&&a.eO&&(o.bindVertexArray(null),a.eO=null),n3.EM=null,a.hO!==i.tO&&(o.bindBuffer(34963,i.tO),a.hO=i.tO),Bu.os===Nu.IOS&&2&i.QS&&0===e&&r===u.byteLength?o.bufferData(i.JS,u,o.DYNAMIC_DRAW):r===u.byteLength?o.bufferSubData(i.JS,e,u):o.bufferSubData(i.JS,e,u.slice(0,r));break;case 35345:a.kM!==i.tO&&(o.bindBuffer(35345,i.tO),a.kM=i.tO),Bu.os===Nu.IOS&&2&i.QS&&0===e&&r===u.byteLength?o.bufferData(i.JS,u,o.DYNAMIC_DRAW):r===u.byteLength?o.bufferSubData(i.JS,e,u):o.bufferSubData(i.JS,e,new Float32Array(u,0,r/4));break;default:ut(16316)}}}function z2(t,i){var n=t.gl,e=t.AM(),r=t.capabilities;i.vO=C2(i.lO),i.fO=L2(i.lO),i.dO=N2(i.lO);var s=i.gO,h=i.wO,u=i.BI,o=i.DI;switch(i.XS){case 1:i.JS=3553;var a=I2(s,h);if(a>r.maxTextureSize&&ut(9100,a,r.maxTextureSize),1===i.xI){if(i.mO=n.createTexture(),i.iO>0){var c=e.pO[e.yO];if(c.mO!==i.mO&&(n.bindTexture(3553,i.mO),c.mO=i.mO),tg[i.lO].isCompressed)for(var f=0;f<i.bO;++f){var v=sg(i.lO,s,h,1),l=new Uint8Array(v);n.compressedTexImage2D(3553,f,i.vO,s,h,0,l),s=I2(1,s>>1),h=I2(1,h>>1)}else 128&i.jR?n.texImage2D(3553,0,i.vO,s,h,0,i.fO,i.dO,null):n.texStorage2D(3553,i.bO,i.vO,s,h)}}else i.OO=n.createRenderbuffer(),i.iO>0&&(e.OO!==i.OO&&(n.bindRenderbuffer(36161,i.OO),e.OO=i.OO),n.renderbufferStorageMultisample(36161,i.xI,i.vO,i.gO,i.wO));break;case 5:i.JS=35866;var d=I2(s,h);if(d>r.maxTextureSize&&ut(9100,d,r.maxTextureSize),o>r.maxArrayTextureLayers&&ut(9100,o,r.maxArrayTextureLayers),i.mO=n.createTexture(),i.iO>0){var g=e.pO[e.yO];if(g.mO!==i.mO&&(n.bindTexture(35866,i.mO),g.mO=i.mO),tg[i.lO].isCompressed)for(var w=0;w<i.bO;++w){var _=sg(i.lO,s,h,o),m=new Uint8Array(_);n.compressedTexImage3D(35866,w,i.vO,s,h,o,0,m),s=I2(1,s>>1),h=I2(1,h>>1)}else n.texStorage3D(35866,i.bO,i.vO,s,h,o)}break;case 2:i.JS=32879;var p=I2(I2(s,h),u);if(p>r.max3DTextureSize&&ut(9100,p,r.max3DTextureSize),i.mO=n.createTexture(),i.iO>0){var y=e.pO[e.yO];if(y.mO!==i.mO&&(n.bindTexture(32879,i.mO),y.mO=i.mO),tg[i.lO].isCompressed)for(var b=0;b<i.bO;++b){var A=sg(i.lO,s,h,u),E=new Uint8Array(A);n.compressedTexImage3D(32879,b,i.vO,s,h,u,0,E),s=I2(1,s>>1),h=I2(1,h>>1)}else n.texStorage3D(32879,i.bO,i.vO,s,h,u)}break;case 3:i.JS=34067;var k=I2(s,h);if(k>r.maxCubeMapTextureSize&&ut(9100,k,r.maxTextureSize),i.mO=n.createTexture(),i.iO>0){var T=e.pO[e.yO];if(T.mO!==i.mO&&(n.bindTexture(34067,i.mO),T.mO=i.mO),tg[i.lO].isCompressed)for(var S=0;S<i.bO;++S){for(var O=sg(i.lO,s,h,1),R=new Uint8Array(O),I=0;I<6;++I)n.compressedTexImage2D(34069+I,S,i.vO,s,h,0,R);s=I2(1,s>>1),h=I2(1,h>>1)}else n.texStorage2D(34067,i.bO,i.vO,s,h)}break;default:ut(16317),i.XS=1,i.JS=3553}}function X2(t,i){var n=t.gl,e=t.AM();if(i.mO){var r=e.pO,s=e.yO;n.deleteTexture(i.mO);for(var h=0;h<r.length;++h)r[h].mO===i.mO&&(n.activeTexture(33984+h),s=h,n.bindTexture(i.JS,null),r[h].mO=null);e.yO=s,i.mO=null}if(i.OO){var u=e.OO;n.deleteRenderbuffer(i.OO),u===i.OO&&(n.bindRenderbuffer(36161,null),e.OO=null),i.OO=null}}function Y2(t,i){if(i.iO){var n=t.gl,e=t.AM(),r=t.capabilities,s=i.gO,h=i.wO,u=i.BI,o=i.DI;switch(i.XS){case 1:i.JS=3553;var a=I2(s,h);if(a>r.maxTextureSize&&ut(9100,a,r.maxTextureSize),1===i.xI){var c=e.pO[e.yO];if(c.mO!==i.mO&&(n.bindTexture(3553,i.mO),c.mO=i.mO),tg[i.lO].isCompressed)for(var f=0;f<i.bO;++f){var v=sg(i.lO,s,h,1),l=new Uint8Array(v);n.compressedTexImage2D(3553,f,i.vO,s,h,0,l),s=I2(1,s>>1),h=I2(1,h>>1)}else X2(t,i),z2(t,i)}else i.OO&&(e.OO!==i.OO&&(n.bindRenderbuffer(36161,i.OO),e.OO=i.OO),n.renderbufferStorageMultisample(36161,i.xI,i.vO,i.gO,i.wO));break;case 5:i.JS=35866;var d=I2(s,h);if(d>r.maxTextureSize&&ut(9100,d,r.maxTextureSize),o>r.maxArrayTextureLayers&&ut(9100,o,r.maxArrayTextureLayers),i.mO=n.createTexture(),i.iO>0){var g=e.pO[e.yO];if(g.mO!==i.mO&&(n.bindTexture(35866,i.mO),g.mO=i.mO),tg[i.lO].isCompressed)for(var w=0;w<i.bO;++w){var _=sg(i.lO,s,h,o),m=new Uint8Array(_);n.compressedTexImage3D(35866,w,i.vO,s,h,o,0,m),s=I2(1,s>>1),h=I2(1,h>>1)}else n.texStorage3D(35866,i.bO,i.vO,s,h,o)}break;case 2:i.JS=32879;var p=I2(I2(s,h),u);if(p>r.max3DTextureSize&&ut(9100,p,r.max3DTextureSize),i.mO=n.createTexture(),i.iO>0){var y=e.pO[e.yO];if(y.mO!==i.mO&&(n.bindTexture(32879,i.mO),y.mO=i.mO),tg[i.lO].isCompressed)for(var b=0;b<i.bO;++b){var A=sg(i.lO,s,h,u),E=new Uint8Array(A);n.compressedTexImage3D(32879,b,i.vO,s,h,u,0,E),s=I2(1,s>>1),h=I2(1,h>>1)}else n.texStorage3D(32879,i.bO,i.vO,s,h,u)}break;case 3:i.XS=3,i.JS=34067;var k=I2(s,h);k>r.maxCubeMapTextureSize&&ut(9100,k,r.maxTextureSize);var T=e.pO[e.yO];if(T.mO!==i.mO&&(n.bindTexture(34067,i.mO),T.mO=i.mO),tg[i.lO].isCompressed)for(var S=0;S<6;++S){s=i.gO,h=i.wO;for(var O=0;O<i.bO;++O){var R=sg(i.lO,s,h,1),I=new Uint8Array(R);n.compressedTexImage2D(34069+S,O,i.vO,s,h,0,I),s=I2(1,s>>1),h=I2(1,h>>1)}}else X2(t,i),z2(t,i);break;default:ut(16317),i.XS=1,i.JS=3553}}}function K2(t,i){for(var n=t.gl,e=i.TM.values().next();!e.done;){n.deleteSampler(e.value);for(var r=t.AM().SM,s=0;s<r.length;++s)r[s]===e.value&&(n.bindSampler(s,null),r[s]=null)}i.TM.clear()}function q2(t,i){for(var n=t.AM(),e=0;e<i.OM.length;++e)if(i.OM[e].KS.IO)return void(i.MO=!1);var r=t.gl,s=[],h=r.createFramebuffer();if(h){i.NO=h,n.NO!==i.NO&&r.bindFramebuffer(36160,i.NO);for(var u=0;u<i.OM.length;++u){var o=i.OM[u],a=o.KS;a&&(a.mO?r.framebufferTexture2D(36160,36064+u,a.JS,a.mO,o.RM):r.framebufferRenderbuffer(36160,36064+u,36161,a.OO),s.push(36064+u),i.gO=M2(i.gO,a.gO>>o.RM),i.wO=M2(i.wO,a.wO>>o.RM))}var c=i.IM;if(c){var f=c.KS,v=tg[f.lO].hasStencil?33306:36096;f.mO?r.framebufferTexture2D(36160,v,f.JS,f.mO,i.IM.RM):r.framebufferRenderbuffer(36160,v,36161,f.OO),i.gO=M2(i.gO,f.gO>>c.RM),i.wO=M2(i.wO,f.wO>>c.RM)}r.drawBuffers(s);var l=r.checkFramebufferStatus(36160);if(36053!==l)switch(l){case 36054:ut(16318);break;case 36055:ut(16319);break;case 36057:ut(16320);break;case 36061:ut(16321)}n.NO!==i.NO&&r.bindFramebuffer(36160,n.NO)}}function Q2(t,i){var n=t.gl,e=t.AM();i.NO&&(n.deleteFramebuffer(i.NO),e.NO===i.NO&&(n.bindFramebuffer(36160,null),e.NO=null),i.NO=null)}function Z2(t,i){for(var n,e=t.gl,r=t.AM(),s=t.capabilities,h=function(){var t=i.FO[u],n=0,r="",s=1;switch(t.XS){case 1:r="VertexShader",n=35633;break;case 16:r="FragmentShader",n=35632;break;default:return ut(16322),{v:void 0}}var h=e.createShader(n);if(h&&(t.PO=h,e.shaderSource(t.PO,"#version 300 es\n"+t.BO),e.compileShader(t.PO),!e.getShaderParameter(t.PO,35713))){ut(16323,r,i.DO),ut(16324,t.BO.replace(/^|\n/g,(function(){return"\n"+s+++" "}))),Y(e.getShaderInfoLog(t.PO));for(var o=0;o<i.FO.length;o++){var a=i.FO[u];a.PO&&(e.deleteShader(a.PO),a.PO=null)}return{v:void 0}}},u=0;u<i.FO.length;u++)if(n=h())return n.v;var o=e.createProgram();if(o){i.UO=o;for(var a=!(!k.rendering||!k.rendering.enableEffectImport),c=0;c<i.FO.length;c++){var f=i.FO[c];e.attachShader(i.UO,f.PO)}e.linkProgram(i.UO);for(var v=0;v<i.FO.length;v++){var l=i.FO[v];l.PO&&(e.detachShader(i.UO,l.PO),e.deleteShader(l.PO),l.PO=null)}if(!e.getProgramParameter(i.UO,35714))return ut(16326,i.DO),void Y(e.getProgramInfoLog(i.UO));et(16325,i.DO);var d=e.getProgramParameter(i.UO,35721);i.jO=new Array(d);for(var g=0;g<d;++g){var w=e.getActiveAttrib(i.UO,g);if(w){var _,m=w.name.indexOf("[");_=-1!==m?w.name.substring(0,m):w.name;var p=e.getAttribLocation(i.UO,_),y=P2(w.type),b=B2(w.type);i.jO[g]={DO:_,XS:y,VO:b,Hw:w.size,iO:b*w.size,dO:w.type,$O:p}}}var A,E,T,S,O=e.getProgramParameter(i.UO,35382);if(O){i.zO=new Array(O);for(var R=0;R<O;++R){var I=(A=e.getActiveUniformBlockName(i.UO,R)).indexOf("[");-1!==I&&(A=A.substring(0,I)),S=null;for(var M=0;M<i.WO.length;M++)if(i.WO[M].name===A){S=i.WO[M];break}if(S){E=R,T=e.getActiveUniformBlockParameter(i.UO,E,35392);var N=a?S.flattened:S.binding+(t.bindingMappings.bI[S.set]||0);e.uniformBlockBinding(i.UO,E,N),i.zO[R]={XO:S.set,HO:S.binding,MM:E,DO:A,iO:T,NM:N}}else ut(16404,A)}}for(var C=0;C<i.ZO.length;++C){var L=i.ZO[C];i.JO.push(new _d(L.set,L.binding,L.name,28,L.count))}if(i.JO.length>0){i.tR=new Array(i.JO.length);for(var F=0;F<i.JO.length;++F){var P=i.JO[F];i.tR[F]={XO:P.set,HO:P.binding,DO:P.name,XS:P.type,Hw:P.count,iR:[],nR:null,dO:F2(P.type),$O:null}}}var B=[],D=[],U=r.rR;if(a)for(var x=0;x<i.JO.length;++x){var G=i.JO[x],j=e.getUniformLocation(i.UO,G.name);j&&-1!==j.id&&(B.push(i.tR[x]),D.push(j)),void 0===U[G.name]&&(U[G.name]=G.flattened%s.maxTextureUnits)}else{for(var H=0,V=0;V<i.WO.length;++V)i.WO[V].set===t.bindingMappings.sR&&H++;for(var $=0,W=0;W<i.JO.length;++W){var z=i.JO[W],X=e.getUniformLocation(i.UO,z.name);if(X&&-1!==X.id&&(B.push(i.tR[W]),D.push(X)),void 0===U[z.name]){var K=z.binding+t.bindingMappings.hR[z.set]+$;z.set===t.bindingMappings.sR&&(K-=H),U[z.name]=K%s.maxTextureUnits,$+=z.count-1}}}if(B.length){for(var q=[],Q=0;Q<B.length;++Q){var Z=B[Q],J=U[Z.DO];if(void 0!==J){Z.$O=D[Q];for(var tt=0;tt<Z.Hw;++tt){for(;q[J];)J=(J+1)%s.maxTextureUnits;Z.iR.push(J),q[J]=!0}}}for(var it=0,nt=0;nt<B.length;++nt){var rt=B[nt];if(!rt.$O){for(rt.$O=D[nt];q[it];)it++;for(var st=0;st<rt.Hw;++st){for(;q[it];)it=(it+1)%s.maxTextureUnits;void 0===U[rt.DO]&&(U[rt.DO]=it),rt.iR.push(it),q[it]=!0}}}r.UO!==i.UO&&e.useProgram(i.UO);for(var ht=0;ht<B.length;ht++){var ot=B[ht];ot.nR=new Int32Array(ot.iR),e.uniform1iv(ot.$O,ot.nR)}r.UO!==i.UO&&e.useProgram(r.UO)}i.tR=B}}function J2(t,i){var n=t.gl,e=t.AM();i.UO&&(n.deleteProgram(i.UO),e.UO===i.UO&&(n.useProgram(null),e.UO=null),i.UO=null)}function t3(t,i){t.gl,i.uR=new Array(i.oR.length);for(var n=[0,0,0,0,0,0,0,0],e=0;e<i.oR.length;++e){var r=i.oR[e],s=void 0!==r.stream?r.stream:0,h=i.aR[s],u=N2(r.format),o=tg[r.format].size;i.uR[e]={DO:r.name,tO:h.tO,dO:u,iO:o,Hw:tg[r.format].count,VO:h.VO,cR:D2(u),fR:void 0!==r.isNormalized&&r.isNormalized,vR:void 0!==r.isInstanced&&r.isInstanced,qO:n[s]},n[s]+=o}}function i3(t,i){for(var n=t.gl,e=t.AM(),r=i.lR.values(),s=r.next(),h=e.eO;!s.done;)n.deleteVertexArray(s.value),h===s.value&&(n.bindVertexArray(null),h=null),s=r.next();e.eO=h,i.lR.clear()}var n3={CM:null,EM:null,AR:0,LM:[]};function e3(t,i,n,e,r,s,h){var u=t.gl,o=t.AM(),a=0;if(n&&i){o.NO!==n.NO&&(u.bindFramebuffer(36160,n.NO),o.NO=n.NO),o.gR.left===e.x&&o.gR.top===e.y&&o.gR.width===e.width&&o.gR.height===e.height||(u.viewport(e.x,e.y,e.width,e.height),o.gR.left=e.x,o.gR.top=e.y,o.gR.width=e.width,o.gR.height=e.height),o.wR.x===e.x&&o.wR.y===e.y&&o.wR.width===e.width&&o.wR.height===e.height||(u.scissor(e.x,e.y,e.width,e.height),o.wR.x=e.x,o.wR.y=e.y,o.wR.width=e.width,o.wR.height=e.height),n3.LM.length=0;for(var c=0;c<r.length;++c){var f=i.mR[c];if(0!==f.format)switch(f.loadOp){case 0:break;case 1:if(15!==o.pR.targets[0].blendColorMask&&u.colorMask(!0,!0,!0,!0),1===i.mR.length){var v=r[0];u.clearColor(v.x,v.y,v.z,v.w),a|=16384}else R2[0]=r[c].x,R2[1]=r[c].y,R2[2]=r[c].z,R2[3]=r[c].w,u.clearBufferfv(6144,c,R2);break;case 2:n3.LM.push(36064+c)}}if(i.yR&&0!==i.yR.format){switch(i.yR.depthLoadOp){case 0:break;case 1:o._R.depthWrite||u.depthMask(!0),u.clearDepth(s),a|=256;break;case 2:n3.LM.push(36096)}if(tg[i.yR.format].hasStencil)switch(i.yR.stencilLoadOp){case 0:break;case 1:o._R.stencilWriteMaskFront||u.stencilMaskSeparate(1028,65535),o._R.stencilWriteMaskBack||u.stencilMaskSeparate(1029,65535),u.clearStencil(h),a|=1024;break;case 2:n3.LM.push(36128)}}if(n.NO&&n3.LM.length&&u.invalidateFramebuffer(36160,n3.LM),a&&u.clear(a),16384&a){var l=o.pR.targets[0].blendColorMask;if(15!==l){var d=!!(1&l),g=!!(2&l),w=!!(4&l),_=!!(8&l);u.colorMask(d,g,w,_)}}256&a&&!o._R.depthWrite&&u.depthMask(!1),1024&a&&(o._R.stencilWriteMaskFront||u.stencilMaskSeparate(1028,0),o._R.stencilWriteMaskBack||u.stencilMaskSeparate(1029,0))}}function r3(t,i,n,e,r,s){var h=t.gl,u=t.capabilities,o=t.AM(),a=o.ER,c=o._R,f=o.pR,v=f.blendColor,l=i&&i.bR,d=!1;if(i&&n3.CM!==i){if(n3.CM=i,n3.AR=i.AR,l){var g=l.UO;o.UO!==g&&(h.useProgram(g),o.UO=g,d=!0)}var w=i.ER;if(w){if(a.cullMode!==w.cullMode){switch(w.cullMode){case 0:h.disable(2884);break;case 1:h.enable(2884),h.cullFace(1028);break;case 2:h.enable(2884),h.cullFace(1029)}a.cullMode=w.cullMode}var _=w.isFrontFaceCCW;a.isFrontFaceCCW!==_&&(h.frontFace(_?2305:2304),a.isFrontFaceCCW=_),a.depthBias===w.depthBias&&a.depthBiasSlop===w.depthBiasSlop||(h.polygonOffset(w.depthBias,w.depthBiasSlop),a.depthBias=w.depthBias,a.depthBiasSlop=w.depthBiasSlop),a.lineWidth!==w.lineWidth&&(h.lineWidth(w.lineWidth),a.lineWidth=w.lineWidth)}var m=i._R;m&&(c.depthTest!==m.depthTest&&(m.depthTest?h.enable(2929):h.disable(2929),c.depthTest=m.depthTest),c.depthWrite!==m.depthWrite&&(h.depthMask(m.depthWrite),c.depthWrite=m.depthWrite),c.depthFunc!==m.depthFunc&&(h.depthFunc(U2[m.depthFunc]),c.depthFunc=m.depthFunc),c.stencilTestFront===m.stencilTestFront&&c.stencilTestBack===m.stencilTestBack||(m.stencilTestFront||m.stencilTestBack?h.enable(2960):h.disable(2960),c.stencilTestFront=m.stencilTestFront,c.stencilTestBack=m.stencilTestBack),c.stencilFuncFront===m.stencilFuncFront&&c.stencilRefFront===m.stencilRefFront&&c.stencilReadMaskFront===m.stencilReadMaskFront||(h.stencilFuncSeparate(1028,U2[m.stencilFuncFront],m.stencilRefFront,m.stencilReadMaskFront),c.stencilFuncFront=m.stencilFuncFront,c.stencilRefFront=m.stencilRefFront,c.stencilReadMaskFront=m.stencilReadMaskFront),c.stencilFailOpFront===m.stencilFailOpFront&&c.stencilZFailOpFront===m.stencilZFailOpFront&&c.stencilPassOpFront===m.stencilPassOpFront||(h.stencilOpSeparate(1028,x2[m.stencilFailOpFront],x2[m.stencilZFailOpFront],x2[m.stencilPassOpFront]),c.stencilFailOpFront=m.stencilFailOpFront,c.stencilZFailOpFront=m.stencilZFailOpFront,c.stencilPassOpFront=m.stencilPassOpFront),c.stencilWriteMaskFront!==m.stencilWriteMaskFront&&(h.stencilMaskSeparate(1028,m.stencilWriteMaskFront),c.stencilWriteMaskFront=m.stencilWriteMaskFront),c.stencilFuncBack===m.stencilFuncBack&&c.stencilRefBack===m.stencilRefBack&&c.stencilReadMaskBack===m.stencilReadMaskBack||(h.stencilFuncSeparate(1029,U2[m.stencilFuncBack],m.stencilRefBack,m.stencilReadMaskBack),c.stencilFuncBack=m.stencilFuncBack,c.stencilRefBack=m.stencilRefBack,c.stencilReadMaskBack=m.stencilReadMaskBack),c.stencilFailOpBack===m.stencilFailOpBack&&c.stencilZFailOpBack===m.stencilZFailOpBack&&c.stencilPassOpBack===m.stencilPassOpBack||(h.stencilOpSeparate(1029,x2[m.stencilFailOpBack],x2[m.stencilZFailOpBack],x2[m.stencilPassOpBack]),c.stencilFailOpBack=m.stencilFailOpBack,c.stencilZFailOpBack=m.stencilZFailOpBack,c.stencilPassOpBack=m.stencilPassOpBack),c.stencilWriteMaskBack!==m.stencilWriteMaskBack&&(h.stencilMaskSeparate(1029,m.stencilWriteMaskBack),c.stencilWriteMaskBack=m.stencilWriteMaskBack));var p=i.pR;if(p){f.isA2C!==p.isA2C&&(p.isA2C?h.enable(32926):h.disable(32926),f.isA2C=p.isA2C);var y=p.blendColor;v.x===y.x&&v.y===y.y&&v.z===y.z&&v.w===y.w||(h.blendColor(y.x,y.y,y.z,y.w),v.x=y.x,v.y=y.y,v.z=y.z,v.w=y.w);var b=p.targets[0],A=o.pR.targets[0];A.blend!==b.blend&&(b.blend?h.enable(3042):h.disable(3042),A.blend=b.blend),A.blendEq===b.blendEq&&A.blendAlphaEq===b.blendAlphaEq||(h.blendEquationSeparate(G2[b.blendEq],G2[b.blendAlphaEq]),A.blendEq=b.blendEq,A.blendAlphaEq=b.blendAlphaEq),A.blendSrc===b.blendSrc&&A.blendDst===b.blendDst&&A.blendSrcAlpha===b.blendSrcAlpha&&A.blendDstAlpha===b.blendDstAlpha||(h.blendFuncSeparate(j2[b.blendSrc],j2[b.blendDst],j2[b.blendSrcAlpha],j2[b.blendDstAlpha]),A.blendSrc=b.blendSrc,A.blendDst=b.blendDst,A.blendSrcAlpha=b.blendSrcAlpha,A.blendDstAlpha=b.blendDstAlpha),A.blendColorMask!==b.blendColorMask&&(h.colorMask(!!(1&b.blendColorMask),!!(2&b.blendColorMask),!!(4&b.blendColorMask),!!(8&b.blendColorMask)),A.blendColorMask=b.blendColorMask)}}if(i&&i.kR&&l){for(var E=l.zO.length,k=i.kR.TR,T=0;T<E;T++){var S=l.zO[T],O=e[S.XO],R=O&&O.$S[S.HO],I=R>=0&&O.zS[R];if(I&&I.YS){var M=k[S.XO],N=M&&M[S.HO],C=I.YS.FM;N>=0&&(C+=r[N]),o.PM[S.NM]===I.YS.tO&&o.BM[S.NM]===C||(C?h.bindBufferRange(35345,S.NM,I.YS.tO,C,I.YS.iO):h.bindBufferBase(35345,S.NM,I.YS.tO),o.kM=o.PM[S.NM]=I.YS.tO,o.BM[S.NM]=C)}}for(var L=l.tR.length,F=0;F<L;F++)for(var P=l.tR[F],B=e[P.XO],D=B&&B.$S[P.HO],U=D>=0&&B.zS[D],x=0;x<P.iR.length;x++){var G=P.iR[x],j=o.pO[G];if(U&&U.yM&&U.yM.KS&&U.qS){var H=U.yM,V=H.KS,$=H.RM,W=$+H.DM;if(V.iO>0){j.mO!==V.mO&&(o.yO!==G&&(h.activeTexture(33984+G),o.yO=G),V.mO?h.bindTexture(V.JS,V.mO):h.bindTexture(V.JS,t.nullTex2D.gpuTexture.mO),j.mO=V.mO);var z=U.qS.UM(t,$,W);o.SM[G]!==z&&(h.bindSampler(G,z),o.SM[G]=z)}U=B.zS[++D]}}}if(n&&l&&(d||n3.EM!==n))if(n3.EM=n,t.extensions.nO){var X=n.lR.get(l.UO);if(!X){var Y;X=h.createVertexArray(),n.lR.set(l.UO,X),h.bindVertexArray(X),h.bindBuffer(34962,null),h.bindBuffer(34963,null),o.sO=null,o.hO=null;for(var K=0;K<l.jO.length;K++){var q=l.jO[K];Y=null;for(var Q=0;Q<n.uR.length;Q++){var Z=n.uR[Q];if(Z.DO===q.DO){Y=Z;break}}if(Y){o.sO!==Y.tO&&(h.bindBuffer(34962,Y.tO),o.sO=Y.tO);for(var J=0;J<Y.cR;++J){var tt=q.$O+J,it=Y.qO+Y.iO*J;h.enableVertexAttribArray(tt),o.OR[tt]=!0,h.vertexAttribPointer(tt,Y.Hw,Y.dO,Y.fR,Y.VO,it),h.vertexAttribDivisor(tt,Y.vR?1:0)}}}var nt=n.RR;nt&&h.bindBuffer(34963,nt.tO),h.bindVertexArray(null),h.bindBuffer(34962,null),h.bindBuffer(34963,null),o.sO=null,o.hO=null}o.eO!==X&&(h.bindVertexArray(X),o.eO=X)}else{for(var et=0;et<u.maxVertexAttributes;++et)o.OR[et]=!1;for(var rt=0;rt<l.jO.length;rt++){for(var st=l.jO[rt],ht=null,ut=0;ut<n.uR.length;ut++){var ot=n.uR[ut];if(ot.DO===st.DO){ht=ot;break}}if(ht){o.sO!==ht.tO&&(h.bindBuffer(34962,ht.tO),o.sO=ht.tO);for(var at=0;at<ht.cR;++at){var ct=st.$O+at,ft=ht.qO+ht.iO*at;!o.IR[ct]&&ct>=0&&(h.enableVertexAttribArray(ct),o.IR[ct]=!0),o.OR[ct]=!0,h.vertexAttribPointer(ct,ht.Hw,ht.dO,ht.fR,ht.VO,ft),h.vertexAttribDivisor(ct,ht.vR?1:0)}}}var vt=n.RR;vt&&o.hO!==vt.tO&&(h.bindBuffer(34963,vt.tO),o.hO=vt.tO);for(var lt=0;lt<u.maxVertexAttributes;++lt)o.IR[lt]!==o.OR[lt]&&(h.disableVertexAttribArray(lt),o.IR[lt]=!1)}if(i&&i.MR.length)for(var dt=i.MR.length,gt=0;gt<dt;gt++)switch(i.MR[gt]){case 1:a.lineWidth!==s.lineWidth&&(h.lineWidth(s.lineWidth),a.lineWidth=s.lineWidth);break;case 2:a.depthBias===s.depthBiasConstant&&o.ER.depthBiasSlop===s.depthBiasSlope||(h.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),a.depthBias=s.depthBiasConstant,a.depthBiasSlop=s.depthBiasSlope);break;case 4:var wt=s.blendConstant;v.x===wt.x&&v.y===wt.y&&v.z===wt.z&&v.w===wt.w||(h.blendColor(wt.x,wt.y,wt.z,wt.w),v.copy(wt));break;case 16:var _t=s.stencilStatesFront,mt=s.stencilStatesBack;c.stencilWriteMaskFront!==_t.writeMask&&(h.stencilMaskSeparate(1028,_t.writeMask),c.stencilWriteMaskFront=_t.writeMask),c.stencilWriteMaskBack!==mt.writeMask&&(h.stencilMaskSeparate(1029,mt.writeMask),c.stencilWriteMaskBack=mt.writeMask);break;case 32:var pt=s.stencilStatesFront,yt=s.stencilStatesBack;c.stencilRefFront===pt.reference&&c.stencilReadMaskFront===pt.compareMask||(h.stencilFuncSeparate(1028,U2[c.stencilFuncFront],pt.reference,pt.compareMask),c.stencilRefFront=pt.reference,c.stencilReadMaskFront=pt.compareMask),c.stencilRefBack===yt.reference&&c.stencilReadMaskBack===yt.compareMask||(h.stencilFuncSeparate(1029,U2[c.stencilFuncBack],yt.reference,yt.compareMask),c.stencilRefBack=yt.reference,c.stencilReadMaskBack=yt.compareMask)}}function s3(t,i){var n=t.gl,e=n3.EM,r=n3.AR,s=t.extensions.NR;if(e){var h=e.RR;if(e.CR){var u=e.CR.aO;if(u.LR){for(var o=0;o<u.FR;o++)u.PR[o]=u.BR[o]*h.VO;if(s)u.DR?s.multiDrawElementsInstancedWEBGL(r,u.UR,0,e.xR,u.PR,0,u.GR,0,u.FR):s.multiDrawElementsWEBGL(r,u.UR,0,e.xR,u.PR,0,u.FR);else for(var a=0;a<u.FR;a++)u.GR[a]?n.drawElementsInstanced(r,u.UR[a],e.xR,u.PR[a],u.GR[a]):n.drawElements(r,u.UR[a],e.xR,u.PR[a])}else if(s)u.DR?s.multiDrawArraysInstancedWEBGL(r,u.BR,0,u.UR,0,u.GR,0,u.FR):s.multiDrawArraysWEBGL(r,u.BR,0,u.UR,0,u.FR);else for(var c=0;c<u.FR;c++)u.GR[c]?n.drawArraysInstanced(r,u.BR[c],u.UR[c],u.GR[c]):n.drawArrays(r,u.BR[c],u.UR[c])}else if(i.instanceCount)if(h){if(i.indexCount>0){var f=i.firstIndex*h.VO;n.drawElementsInstanced(r,i.indexCount,e.xR,f,i.instanceCount)}}else i.vertexCount>0&&n.drawArraysInstanced(r,i.firstVertex,i.vertexCount,i.instanceCount);else if(h){if(i.indexCount>0){var v=i.firstIndex*h.VO;n.drawElements(r,i.indexCount,e.xR,v)}}else i.vertexCount>0&&n.drawArrays(r,i.firstVertex,i.vertexCount)}}function h3(t,i){if(t.length>1||i.length>1)return!1;if(t[0]instanceof HTMLVideoElement){var n=t[0];return 0===i[0].texOffset.x&&0===i[0].texOffset.y&&i[0].texExtent.width===n.videoWidth&&i[0].texExtent.height===n.videoHeight}return!1}function u3(t,i,n,e){var r=t.gl,s=t.AM(),h=s.pO[s.yO];h.mO!==n.mO&&(r.bindTexture(n.JS,n.mO),h.mO=n.mO);var u=0,o=0;switch(n.JS){case 3553:if(128&n.jR||h3(i,e))r.texImage2D(3553,e[0].texSubres.mipLevel,n.vO,e[0].texExtent.width,e[0].texExtent.height,0,n.fO,n.dO,i[0]);else for(var a=0;a<e.length;a++){var c=e[a];r.texSubImage2D(3553,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,n.fO,n.dO,i[u++])}break;case 34067:for(var f=0;f<e.length;f++){var v=e[f],l=v.texSubres,d=v.texOffset,g=l.baseArrayLayer+l.layerCount;for(o=l.baseArrayLayer;o<g;++o)r.texSubImage2D(34069+o,l.mipLevel,d.x,d.y,n.fO,n.dO,i[u++])}break;default:ut(16327)}1&n.jR&&r.generateMipmap(n.JS)}var o3=new Uint8Array(1);function a3(t,i,n,e,r){var s=cg(i).height,h=sg(i,r.width,r.height,r.depth),u=sg(i,e.width,1,1),o=sg(i,e.width,e.height,1),a=sg(i,r.width,1,1),c=ag(tg[i]);o3.byteLength<h&&(o3=new Uint8Array(h));for(var f=0,v=n,l=0;l<r.depth;l++){v=n+o*l;for(var d=0;d<r.height;d+=s)o3.subarray(f,f+a).set(new Uint8Array(t.buffer,t.byteOffset+v,a)),f+=a,v+=u}var g=h/c.BYTES_PER_ELEMENT;return at(Number.isInteger(g),9101),new c(o3.buffer,0,g)}function c3(t,i,n,e){var r=t.gl,s=t.AM(),h=s.pO[s.yO];h.mO!==n.mO&&(r.bindTexture(n.JS,n.mO),h.mO=n.mO);var u=0,o=0,a=tg[n.lO],c=ag(a),f=a.isCompressed,v=cg(n.lO),l=new Kl,d=new Xl,g=new Kl;switch(n.JS){case 3553:for(var w=0;w<e.length;w++){var _=e[w],m=_.texSubres.mipLevel,p=_.texOffset,y=_.texExtent,b=y.width,A=y.height,E=v.width,k=v.height,T=_.buffStride;d.x=0===p.x?0:fg(p.x,E),d.y=0===p.y?0:fg(p.y,k),l.width=b<E?b:fg(b,E),l.height=A<k?b:fg(A,k),g.width=T>0?T:l.width,g.height=_.buffTexHeight>0?_.buffTexHeight:l.height;var S=b+d.x===n.gO>>m?b:l.width,O=A+d.y===n.wO>>m?A:l.height,R=void 0,I=i[u++];if(g.width===l.width&&g.height===l.height){var M=sg(n.lO,S,O,1)/c.BYTES_PER_ELEMENT;at(Number.isInteger(M),9101),R=new c(I.buffer,I.byteOffset+_.buffOffset,M)}else R=a3(I,n.lO,_.buffOffset,g,l);f?36196!==n.vO?r.compressedTexSubImage2D(3553,m,d.x,d.y,S,O,n.fO,R):r.compressedTexImage2D(3553,m,n.vO,S,O,0,R):r.texSubImage2D(3553,m,d.x,d.y,S,O,n.fO,n.dO,R)}break;case 35866:for(var N=0;N<e.length;N++){var C=e[N],L=C.texSubres.mipLevel,F=C.texOffset,P=C.texExtent,B=P.width,D=P.height,U=v.width,x=v.height,G=C.buffStride,j=C.texSubres;d.x=0===F.x?0:fg(F.x,U),d.y=0===F.y?0:fg(F.y,x),l.width=B<U?B:fg(B,U),l.height=D<x?B:fg(D,x),l.depth=1,g.width=G>0?G:l.width,g.height=C.buffTexHeight>0?C.buffTexHeight:l.height;var H=B+d.x===n.gO>>L?B:l.width,V=D+d.y===n.wO>>L?D:l.height,$=j.baseArrayLayer+j.layerCount;for(o=j.baseArrayLayer;o<$;++o){d.z=o;var W=void 0,z=i[u++];if(g.width===l.width&&g.height===l.height){var X=sg(n.lO,H,V,1)/c.BYTES_PER_ELEMENT;at(Number.isInteger(X),9101),W=new c(z.buffer,z.byteOffset+C.buffOffset,X)}else W=a3(z,n.lO,C.buffOffset,g,l);f?36196!==n.vO?r.compressedTexSubImage3D(35866,L,d.x,d.y,d.z,H,V,l.depth,n.fO,W):r.compressedTexImage3D(35866,L,n.vO,H,V,l.depth,0,W):r.texSubImage3D(35866,L,d.x,d.y,d.z,H,V,l.depth,n.fO,n.dO,W)}}break;case 32879:for(var Y=0;Y<e.length;Y++){var K=e[Y],q=K.texSubres.mipLevel,Q=K.texOffset,Z=K.texExtent,J=Z.width,tt=Z.height,it=v.width,nt=v.height,et=K.buffStride;d.x=0===Q.x?0:fg(Q.x,it),d.y=0===Q.y?0:fg(Q.y,nt),d.z=Q.z,l.width=J<it?J:fg(J,it),l.height=tt<nt?J:fg(tt,nt),l.depth=Z.depth,g.width=et>0?et:l.width,g.height=K.buffTexHeight>0?K.buffTexHeight:l.height;var rt=J+d.x===n.gO>>q?J:l.width,st=tt+d.y===n.wO>>q?tt:l.height,ht=void 0,ot=i[u++];if(g.width===l.width&&g.height===l.height){var ct=sg(n.lO,rt,st,l.depth)/c.BYTES_PER_ELEMENT;at(Number.isInteger(ct),9101),ht=new c(ot.buffer,ot.byteOffset+K.buffOffset,ct)}else ht=a3(ot,n.lO,K.buffOffset,g,l);f?36196!==n.vO?r.compressedTexSubImage3D(35866,q,d.x,d.y,d.z,rt,st,l.depth,n.fO,ht):r.compressedTexImage3D(35866,q,n.vO,rt,st,l.depth,0,ht):r.texSubImage3D(35866,q,d.x,d.y,d.z,rt,st,l.depth,n.fO,n.dO,ht)}break;case 34067:for(var ft=0;ft<e.length;ft++){var vt=e[ft],lt=vt.texSubres.mipLevel,dt=vt.texOffset,gt=vt.texExtent,wt=gt.width,_t=gt.height,mt=v.width,pt=v.height,yt=vt.buffStride,bt=vt.texSubres;d.x=0===dt.x?0:fg(dt.x,mt),d.y=0===dt.y?0:fg(dt.y,pt),l.width=wt<mt?wt:fg(wt,mt),l.height=_t<pt?wt:fg(_t,pt),g.width=yt>0?yt:l.width,g.height=vt.buffTexHeight>0?vt.buffTexHeight:l.height;var At=wt+d.x===n.gO>>lt?wt:l.width,Et=_t+d.y===n.wO>>lt?_t:l.height,kt=bt.baseArrayLayer+bt.layerCount;for(o=bt.baseArrayLayer;o<kt;++o){var Tt=void 0,St=i[u++];if(g.width===l.width&&g.height===l.height){var Ot=sg(n.lO,At,Et,1)/c.BYTES_PER_ELEMENT;at(Number.isInteger(Ot),9101),Tt=new c(St.buffer,St.byteOffset+vt.buffOffset,Ot)}else Tt=a3(St,n.lO,vt.buffOffset,g,l);f?36196!==n.vO?r.compressedTexSubImage2D(34069+o,lt,d.x,d.y,At,Et,n.fO,Tt):r.compressedTexImage2D(34069+o,lt,n.vO,At,Et,0,Tt):r.texSubImage2D(34069+o,lt,d.x,d.y,At,Et,n.fO,n.dO,Tt)}}break;default:ut(16327)}1&n.jR&&r.generateMipmap(n.JS)}function f3(t,i,n,e){var r=t.gl,s=t.AM(),h=r.createFramebuffer();r.bindFramebuffer(36160,h);var u=0,o=0,a=1,c=1;if(3553===i.JS)for(var f=0;f<e.length;f++){var v=e[f];r.framebufferTexture2D(36160,36064,i.JS,i.mO,v.texSubres.mipLevel),u=v.texOffset.x,o=v.texOffset.y,a=v.texExtent.width,c=v.texExtent.height,r.readPixels(u,o,a,c,i.fO,i.dO,n[f])}else ut(16399);r.bindFramebuffer(36160,null),s.NO=null,r.deleteFramebuffer(h)}function v3(t,i,n,e,r){var s=t.gl,h=t.AM(),u=t.blitManager;if(u){var o=2===r||3===r?9729:9728,a=u.srcFramebuffer,c=u.dstFramebuffer,f=h.xM,v=h.NO,l=e[0].srcSubres.mipLevel,d=e[0].dstSubres.mipLevel,g=function(t){var i=0,n=36064;return t.hasStencil?n=33306:t.hasDepth&&(n=36096),t.hasDepth||t.hasStencil?(t.hasDepth&&(i|=256),t.hasStencil&&(i|=1024)):i|=16384,{mask:i,attachment:n}},w=e.map((function(t,i){return i}));w.sort((function(t,i){return e[t].srcSubres.mipLevel-e[i].srcSubres.mipLevel}));var _=g(tg[i.format]),m=_.mask,p=_.attachment,y=g(tg[n.lO]).attachment;h.xM!==a&&(s.bindFramebuffer(36008,a),h.xM=a),h.NO!==c&&(s.bindFramebuffer(36009,c),h.NO=c),i.glTexture?s.framebufferTexture2D(36008,p,i.glTarget,i.glTexture,l):s.framebufferRenderbuffer(36008,p,36161,i.glRenderbuffer),n.mO?s.framebufferTexture2D(36009,y,n.JS,n.mO,d):s.framebufferRenderbuffer(36009,y,36161,n.OO);for(var b=0;b<w.length;b++){var A=e[w[b]];i.glTexture&&l!==A.srcSubres.mipLevel&&(l=A.srcSubres.mipLevel,s.framebufferTexture2D(36008,p,i.glTarget,i.glTexture,l)),n.mO&&d!==A.dstSubres.mipLevel&&(d=A.dstSubres.mipLevel,s.framebufferTexture2D(36009,y,n.JS,n.mO,d)),s.blitFramebuffer(A.srcOffset.x,A.srcOffset.y,A.srcOffset.x+A.srcExtent.width,A.srcOffset.y+A.srcExtent.height,A.dstOffset.x,A.dstOffset.y,A.dstOffset.x+A.dstExtent.width,A.dstOffset.y+A.dstExtent.height,m,o)}h.xM!==f&&(s.bindFramebuffer(36008,f),h.xM=f),h.NO!==v&&(s.bindFramebuffer(36009,v),h.NO=v)}}var l3=function(){function t(){}return t.$R=function(i){t.Mr=i},e(t,null,[{key:"instance",get:function(){return t.Mr}}]),t}();l3.Mr=null;var d3=function(){function t(){this.UR=void 0,this.BR=void 0,this.GR=void 0,this.FR=0,this.LR=!1,this.DR=!1,this.PR=void 0,this.WR=4,this.UR=new Int32Array(4),this.BR=new Int32Array(4),this.GR=new Int32Array(4),this.PR=new Int32Array(4)}var i=t.prototype;return i.oO=function(){this.FR=0,this.LR=!1,this.DR=!1},i.cO=function(t,i){this.zR(t),this.LR=i.indexCount>0,this.DR=!!i.instanceCount,this.FR=Math.max(t+1,this.FR),this.LR?(this.UR[t]=i.indexCount,this.BR[t]=i.firstIndex):(this.UR[t]=i.vertexCount,this.BR[t]=i.firstVertex),this.GR[t]=Math.max(1,i.instanceCount)},i.zR=function(t){if(!(this.WR>t)){this.WR=fe(t);var i=new Int32Array(this.WR),n=new Int32Array(this.WR),e=new Int32Array(this.WR);this.PR=new Int32Array(this.WR),i.set(this.UR),n.set(this.BR),e.set(this.GR),this.UR=i,this.BR=n,this.GR=e}},t}(),g3=function(){function t(){this.GM=void 0,this.jM=void 0;var t=l3.instance.gl;this.GM=t.createFramebuffer(),this.jM=t.createFramebuffer()}return t.prototype.kg=function(){var t=l3.instance.gl;t.deleteFramebuffer(this.GM),t.deleteFramebuffer(this.jM)},e(t,[{key:"srcFramebuffer",get:function(){return this.GM}},{key:"dstFramebuffer",get:function(){return this.jM}}]),t}(),w3=function(t){function i(){var i;return(i=t.call(this)||this).fI=null,i}s(i,t);var n=i.prototype;return n.bM=function(){return this.fI},n.initialize=function(t){if("buffer"in t){this.un=!0;var i=t.buffer;this.en=i.usage,this.rn=i.memUsage,this.sn=this.hn=t.range,this.$=1,this.Gt=i.flags,this.fI={ZS:this.en,QS:this.rn,iO:this.sn,VO:this.hn,uO:null,aO:i.bM().aO,JS:i.bM().JS,tO:i.bM().tO,FM:t.offset}}else this.en=t.usage,this.rn=t.memUsage,this.sn=t.size,this.hn=Math.max(t.stride||this.sn,1),this.$=this.sn/this.hn,this.Gt=t.flags,this.fI={ZS:this.en,QS:this.rn,iO:this.sn,VO:this.hn,uO:null,aO:new d3,JS:0,tO:null,FM:0},H2(l3.instance,this.fI),l3.instance.memoryStatus.bufferSize+=this.sn},n.destroy=function(){this.fI&&(this.un||(V2(l3.instance,this.fI),l3.instance.memoryStatus.bufferSize-=this.sn),this.fI=null)},n.resize=function(t){if(this.un)st(16379);else{var i=this.sn;i!==t&&(this.sn=t,this.$=this.sn/this.hn,this.fI&&(this.fI.iO=t,t>0&&($2(l3.instance,this.fI),l3.instance.memoryStatus.bufferSize-=i,l3.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,i){var n;this.un?st(16380):(n=void 0!==i?i:64&this.en?0:t.byteLength,W2(l3.instance,this.fI,t,0,n))},i}(lg),_3=function(t){function i(){var i;return(i=t.call(this)||this).dI=!1,i.gI=null,i._I=[],i.wI=null,i.mI=Array(8).fill(0),i.pI=new Yd,i.HM=!1,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.M=t.type,this.an=t.queue;for(var i=l3.instance.bindingMappings.bI.length,n=0;n<i;n++)this._I.push(null)},n.destroy=function(){},n.begin=function(){this.gI=null,this.wI=null,this._I.length=0,this.cn=0,this.vn=0,this.ln=0},n.end=function(){this.HM&&this.AI(),this.dI=!1},n.beginRenderPass=function(){ut(16401),this.dI=!0},n.endRenderPass=function(){this.dI=!1},n.bindPipelineState=function(t){var i=t.gpuPipelineState;i!==this.gI&&(this.gI=i,this.HM=!0)},n.bindDescriptorSet=function(t,i,n){var e=i.gpuDescriptorSet;if(e!==this._I[t]&&(this._I[t]=e,this.HM=!0),n){var r,s=null==(r=this.gI)?void 0:r.kR;if(s){for(var h=this.mI,u=s.oI[t],o=0;o<n.length;o++)h[u+o]=n[o];this.HM=!0}}},n.bindInputAssembler=function(t){var i=t.gpuInputAssembler;this.wI=i,this.HM=!0},n.setViewport=function(t){var i=this.pI.viewport;i.left===t.left&&i.top===t.top&&i.width===t.width&&i.height===t.height&&i.minDepth===t.minDepth&&i.maxDepth===t.maxDepth||(i.left=t.left,i.top=t.top,i.width=t.width,i.height=t.height,i.minDepth=t.minDepth,i.maxDepth=t.maxDepth,this.HM=!0)},n.setScissor=function(t){var i=this.pI.scissor;i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height||(i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.HM=!0)},n.setLineWidth=function(t){this.pI.lineWidth!==t&&(this.pI.lineWidth=t,this.HM=!0)},n.setDepthBias=function(t,i,n){var e=this.pI;e.depthBiasConstant===t&&e.depthBiasClamp===i&&e.depthBiasSlope===n||(e.depthBiasConstant=t,e.depthBiasClamp=i,e.depthBiasSlope=n,this.HM=!0)},n.setBlendConstants=function(t){var i=this.pI.blendConstant;i.x===t.x&&i.y===t.y&&i.z===t.z&&i.w===t.w||(i.copy(t),this.HM=!0)},n.setDepthBound=function(t,i){var n=this.pI;n.depthMinBounds===t&&n.depthMaxBounds===i||(n.depthMinBounds=t,n.depthMaxBounds=i,this.HM=!0)},n.setStencilWriteMask=function(t,i){var n=this.pI.stencilStatesFront,e=this.pI.stencilStatesBack;1&t&&n.writeMask!==i&&(n.writeMask=i,this.HM=!0),2&t&&e.writeMask!==i&&(e.writeMask=i,this.HM=!0)},n.setStencilCompareMask=function(t,i,n){var e=this.pI.stencilStatesFront,r=this.pI.stencilStatesBack;1&t&&(e.compareMask===n&&e.reference===i||(e.reference=i,e.compareMask=n,this.HM=!0)),2&t&&(r.compareMask===n&&r.reference===i||(r.reference=i,r.compareMask=n,this.HM=!0))},n.draw=function(){ut(16328)},n.updateBuffer=function(){ut(16329)},n.copyBuffersToTexture=function(){ut(16330)},n.execute=function(){ut(16402)},n.pipelineBarrier=function(){},n.AI=function(){ut(16401),this.HM=!1},n.blitTexture=function(){ut(16401)},i}(dg),m3=function(t){function i(){var i;return(i=t.call(this)||this).kI=null,i.VM=[],i.$M=void 0,i}s(i,t);var n=i.prototype;return n.OI=function(){return this.kI},n.initialize=function(t){var i,n=this;this.Dn=t.renderPass,this.Un=t.colorTextures||[],this.Bn=t.depthStencilTexture||null;for(var e=[],r=0;r<t.colorTextures.length;r++){var s=t.colorTextures[r];s&&e.push(s.gpuTextureView)}var h=null;t.depthStencilTexture&&(h=t.depthStencilTexture.gpuTextureView);var u=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;this.kI={aI:t.renderPass.WM(),OM:e,IM:h,NO:null,MO:!0,get width(){return this.OM.length>0?this.OM[0].KS.gO:this.IM?this.IM.KS.gO:u},set width(t){u=t},get height(){return this.OM.length>0?this.OM[0].KS.wO:this.IM?this.IM.KS.wO:o},set height(t){o=t}},q2(l3.instance,this.kI),this.kI.OM.forEach((function(t){return n.VM.push(t.KS.mO)})),this.$M=null==(i=this.kI.IM)?void 0:i.KS.mO,this.xn=this.kI.gO,this.Gn=this.kI.wO},n.destroy=function(){this.kI&&(Q2(l3.instance,this.kI),this.kI=null,this.VM.length=0,this.$M=null)},e(i,[{key:"needRebuild",get:function(){var t=this.OI();if(t){for(var i,n=0;n<t.OM.length;n++)if(t.OM[n].KS.mO!==this.VM[n])return!0;if((null==(i=t.IM)?void 0:i.KS.mO)!==this.$M)return!0}return!1}}]),i}(mg),p3=function(t){function i(){var i;return(i=t.call(this)||this).JR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this.jn=t.attributes,this.Hn=this.computeAttributesHash(),this.Vn=t.vertexBuffers,t.indexBuffer)this.$n=t.indexBuffer,this.zn.indexCount=this.$n.size/this.$n.stride,this.zn.firstIndex=0;else{var i=this.Vn[0];this.zn.vertexCount=i.size/i.stride,this.zn.firstVertex=0,this.zn.vertexOffset=0}this.zn.instanceCount=0,this.zn.firstInstance=0,this.Wn=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),e=0;e<t.vertexBuffers.length;++e){var r=t.vertexBuffers[e];r.bM()&&(n[e]=r.bM())}var s=null,h=0;if(t.indexBuffer&&(s=t.indexBuffer.bM()))switch(s.VO){case 1:h=5121;break;case 2:h=5123;break;case 4:h=5125;break;default:ut(16332)}var u=null;t.indirectBuffer&&(u=t.indirectBuffer.bM()),this.JR={oR:t.attributes,aR:n,RR:s,CR:u,uR:[],xR:h,lR:new Map},t3(l3.instance,this.JR)}else ut(16331)},n.destroy=function(){var t=l3.instance;this.JR&&t.extensions.nO&&i3(t,this.JR),this.JR=null},e(i,[{key:"gpuInputAssembler",get:function(){return this.JR}}]),i}(pg),y3=function(t){s(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).KR=null,i}return i.pM=function(){return this.KR},i.initialize=function(t){Array.prototype.push.apply(this.Qn,t.bindings);for(var i=0,n=-1,e=[],r=0;r<this.Qn.length;r++){var s=this.Qn[r];e.push(i),i+=s.count,s.binding>n&&(n=s.binding)}this.Zn=Array(n+1).fill(-1);for(var h=this.Jn=Array(n+1).fill(-1),u=0;u<this.Qn.length;u++){var o=this.Qn[u];this.Zn[o.binding]=u,h[o.binding]=e[u]}for(var a=[],c=0;c<this.Qn.length;c++){var f=this.Qn[c];if(10&f.descriptorType)for(var v=0;v<f.count;v++)a.push(f.binding)}this.KR={VS:this.Qn,sI:a,$S:h,WS:i}},i.destroy=function(){this.Qn.length=0},n}(bg),b3=function(t){function i(){var i;return(i=t.call(this)||this).qR=null,i}s(i,t);var n=i.prototype;return n.zM=function(){return this.qR},n.initialize=function(t){Array.prototype.push.apply(this.te,t.setLayouts);for(var i=[],n=[],e=0,r=[],s=0;s<this.te.length;s++){for(var h=this.te[s],u=h.pM(),o=u.sI,a=Array(h.bindingIndices.length).fill(-1),c=0;c<o.length;c++){var f=o[c];a[f]<0&&(a[f]=e+c)}n.push(u),i.push(a),r.push(e),e+=o.length}this.qR={hI:n,TR:i,uI:e,oI:r}},n.destroy=function(){this.te.length=0},i}(Ag),A3=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],E3=function(t){function i(){var i;return(i=t.call(this)||this).QR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.ee=t.primitive,this.ie=t.shader,this.ne=t.pipelineLayout;var i=this.ue;if(t.blendState){var n=t.blendState,e=n.targets;e&&e.forEach((function(t,n){i.setTarget(n,t)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}Object.assign(this.se,t.rasterizerState),Object.assign(this.he,t.depthStencilState),this.re=t.inputState,this.Dn=t.renderPass,this.oe=t.dynamicStates;for(var r=[],s=0;s<31;s++)this.oe&1<<s&&r.push(1<<s);this.QR={AR:A3[t.primitive],bR:t.shader.gpuShader,kR:t.pipelineLayout.zM(),ER:t.rasterizerState,_R:t.depthStencilState,pR:t.blendState,aI:t.renderPass.WM(),MR:r}},n.destroy=function(){this.QR=null},e(i,[{key:"gpuPipelineState",get:function(){return this.QR}}]),i}(Rg),k3=function(t){function i(){return t.call(this)||this}s(i,t);var n=i.prototype;return n.beginRenderPass=function(t,i,n,e,r,s){e3(l3.instance,t.WM(),i.OI(),n,e,r,s),this.dI=!0},n.draw=function(t){if(this.dI){this.HM&&this.AI();var i="drawInfo"in t?t.drawInfo:t;s3(l3.instance,i),++this.cn,this.vn+=i.instanceCount;var n=i.indexCount||i.vertexCount;if(this.gI)switch(this.gI.AR){case 4:this.ln+=n/3*Math.max(i.instanceCount,1);break;case 5:case 6:this.ln+=(n-2)*Math.max(i.instanceCount,1)}}else ut(16328)},n.setViewport=function(t){var i=l3.instance.gl,n=l3.instance.AM();n.gR.left===t.left&&n.gR.top===t.top&&n.gR.width===t.width&&n.gR.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.gR.left=t.left,n.gR.top=t.top,n.gR.width=t.width,n.gR.height=t.height)},n.setScissor=function(t){var i=l3.instance.gl,n=l3.instance.AM();n.wR.x===t.x&&n.wR.y===t.y&&n.wR.width===t.width&&n.wR.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.wR.x=t.x,n.wR.y=t.y,n.wR.width=t.width,n.wR.height=t.height)},n.updateBuffer=function(t,i,n){if(this.dI)ut(16329);else{var e,r=t.bM();r&&(e=void 0!==n?n:64&t.usage?0:i.byteLength,W2(l3.instance,r,i,0,e))}},n.copyBuffersToTexture=function(t,i,n){if(this.dI)ut(16330);else{var e=i.gpuTexture;e&&c3(l3.instance,t,e,n)}},n.execute=function(){ut(16402)},n.AI=function(){r3(l3.instance,this.gI,this.wI,this._I,this.mI,this.pI),this.HM=!1},n.blitTexture=function(t,i,n,e){var r=t.gpuTexture,s=i.gpuTexture;v3(l3.instance,r,s,n,e)},i}(_3),T3=function(t){function i(){var i;return(i=t.call(this)||this).RI=0,i.II=0,i.MI=0,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.M=t.type},n.destroy=function(){},n.submit=function(t){for(var i=0;i<t.length;i++){var n=t[i];this.RI+=n.numDrawCalls,this.II+=n.numInstances,this.MI+=n.numTris}},n.V_=function(){this.RI=0,this.II=0,this.MI=0},i}(Ig),S3=function(t){function i(){var i;return(i=t.call(this)||this).NI=null,i}s(i,t);var n=i.prototype;return n.WM=function(){return this.NI},n.initialize=function(t){this.ae=t.colorAttachments,this.ce=t.depthStencilAttachment,this.fe=t.subpasses,this.NI={mR:this.ae,yR:this.ce},this.ve=this.computeHash()},n.destroy=function(){this.NI=null},i}(Mg),O3=function(t){function i(i,n){var e,r,s;return(e=t.call(this,i,n)||this).CI=null,e.CI={TM:new Map,XM:e.le.minFilter,YM:e.le.magFilter,KM:e.le.mipFilter,qM:e.le.addressU,QM:e.le.addressV,ZM:e.le.addressW,TO:0,SO:0,EO:0,kO:0,cI:0,UM:function(t,i,n){var e=t.gl,r=i<<16|n;if(!this.TM.has(r)){var s=e.createSampler();if(s){this.TM.set(r,s);var h=e.samplerParameteri.bind(e),u=e.samplerParameterf.bind(e);h(s,10241,this.TO),h(s,10240,this.SO),h(s,10242,this.EO),h(s,10243,this.kO),h(s,32882,this.cI),u(s,33082,i),u(s,33083,n)}}return this.TM.get(r)}},r=l3.instance,s=e.CI,r.gl,2===s.XM||3===s.XM?2===s.KM||3===s.KM?s.TO=9987:1===s.KM?s.TO=9985:s.TO=9729:2===s.KM||3===s.KM?s.TO=9986:1===s.KM?s.TO=9984:s.TO=9728,2===s.YM||3===s.YM?s.SO=9729:s.SO=9728,s.EO=O2[s.qM],s.kO=O2[s.QM],s.cI=O2[s.ZM],e}return s(i,t),i.prototype.destroy=function(){this.CI&&(K2(l3.instance,this.CI),this.CI=null)},e(i,[{key:"gpuSampler",get:function(){return this.CI}}]),i}(Ng),R3=function(t){function i(){var i;return(i=t.call(this)||this).YR=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){this.de=t.name,this.ge=t.stages,this.jn=t.attributes,this.we=t.blocks,this.En=t.samplers,this.YR={DO:t.name,WO:t.blocks.slice(),JO:t.samplerTextures.slice(),ZO:t.subpassInputs.slice(),FO:new Array(t.stages.length),UO:null,jO:[],YO:[],zO:[],tR:[]};for(var i=0;i<t.stages.length;++i){var n=t.stages[i];this.YR.FO[i]={XS:n.stage,BO:n.source,PO:null}}},n.destroy=function(){this.YR&&(J2(l3.instance,this.YR),this.YR=null)},e(i,[{key:"gpuShader",get:function(){return null===this.YR.UO&&Z2(l3.instance,this.YR),this.YR}}]),i}(Cg),I3=function(){function t(){this.sO=null,this.hO=null,this.kM=null,this.PM=[],this.BM=[],this.eO=null,this.yO=0,this.pO=[],this.SM=[],this.OO=null,this.NO=null,this.xM=null,this.gR=new id,this.wR=new Yl(0,0,0,0),this.ER=new Eg,this._R=new kg,this.pR=new Sg,this.UO=null,this.IR=[],this.OR=[],this.rR={}}return t.prototype.Jr=function(t,i,n){for(var e=0;e<t;++e)this.pO.push({mO:null});this.SM.length=t,this.SM.fill(null),this.PM.length=i,this.PM.fill(null),this.BM.length=i,this.BM.fill(0),this.IR.length=n,this.IR.fill(!1),this.OR.length=n,this.OR.fill(!1)},t}(),M3=function(t){function i(){var i;return(i=t.call(this)||this).LI=null,i.JM=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t,i){var n=this,e=l3.instance,r=n.le,s=n._e,h=t,u=t;if("texture"in t&&(h=u.texture.info,n.pe=!0),r.copy(h),n.me=eg(r.width)&&eg(r.height),n.sn=hg(r.format,n.width,n.height,n.depth,r.levelCount)*r.layerCount,n.pe){var o;if(s.copy(u),n.LI=u.texture.LI,(null==(o=n.LI)?void 0:o.lO)!==h.format)return void it(16403);n.JM={KS:n.LI,XS:u.type,lO:u.format,RM:u.baseLevel,DM:u.levelCount}}else n.LI={XS:h.type,lO:h.format,ZS:h.usage,gO:h.width,wO:h.height,BI:h.depth,iO:n.sn,DI:h.layerCount,bO:h.levelCount,xI:h.samples,jR:h.flags,AO:n.me,JS:0,vO:0,fO:0,dO:0,GI:0,mO:null,OO:null,EO:0,kO:0,TO:0,SO:0,IO:i||!1},n.LI.IO||(z2(e,n.LI),e.memoryStatus.textureSize+=n.sn),s.texture=n,s.type=t.type,s.format=t.format,s.baseLevel=0,s.levelCount=t.levelCount,s.baseLayer=0,s.layerCount=t.layerCount,n.JM={KS:n.LI,XS:s.type,lO:s.format,RM:s.baseLevel,DM:s.levelCount}},n.destroy=function(){var t=this,i=l3.instance;!t.pe&&t.LI&&(X2(i,t.LI),i.memoryStatus.textureSize-=t.sn,t.LI=null)},n.getTextureHandle=function(){var t=this.LI;return t?t.mO?t.mO:t.OO?t.OO:0:0},n.resize=function(t,n){var e=this,r=l3.instance,s=e.le;if(s.width!==t||s.height!==n){s.levelCount===i.getLevelCount(s.width,s.height)?s.levelCount=i.getLevelCount(t,n):s.levelCount>1&&(s.levelCount=Math.min(s.levelCount,i.getLevelCount(t,n)));var h=e.sn;s.width=t,s.height=n,e.sn=hg(s.format,e.width,e.height,e.depth,s.levelCount)*s.layerCount;var u=e.LI;!e.pe&&u&&(u.gO=t,u.wO=n,u.iO=e.sn,u.IO||(Y2(r,u),r.memoryStatus.textureSize-=h,r.memoryStatus.textureSize+=e.sn))}},n.initAsSwapchainTexture=function(t){var i=new vd;i.format=t.format,i.usage=tg[t.format].hasDepth?32:16,i.width=t.width,i.height=t.height,this.initialize(i,!0)},e(i,[{key:"gpuTexture",get:function(){return this.LI}},{key:"gpuTextureView",get:function(){return this.JM}}]),i}(Lg),N3="webglcontextlost";function C3(t){t.activeTexture(33984),t.pixelStorei(3333,1),t.pixelStorei(3317,1),t.pixelStorei(37440,!1),t.bindFramebuffer(36160,null),t.enable(3089),t.enable(2884),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.enable(2929),t.depthMask(!0),t.depthFunc(513),t.stencilFuncSeparate(1028,519,1,65535),t.stencilOpSeparate(1028,7680,7680,7680),t.stencilMaskSeparate(1028,65535),t.stencilFuncSeparate(1029,519,1,65535),t.stencilOpSeparate(1029,7680,7680,7680),t.stencilMaskSeparate(1029,65535),t.disable(2960),t.disable(32926),t.disable(3042),t.blendEquationSeparate(32774,32774),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}function L3(t,i){for(var n=["","WEBKIT_","MOZ_"],e=0;e<n.length;++e){var r=t.getExtension(n[e]+i);if(r)return r}return null}function F3(t){var i={jI:L3(t,"EXT_texture_filter_anisotropic"),zI:L3(t,"EXT_color_buffer_half_float"),tN:L3(t,"EXT_color_buffer_float"),YI:L3(t,"WEBGL_compressed_texture_etc1"),KI:L3(t,"WEBGL_compressed_texture_etc"),qI:L3(t,"WEBGL_compressed_texture_pvrtc"),oM:L3(t,"WEBGL_compressed_texture_astc"),QI:L3(t,"WEBGL_compressed_texture_s3tc"),ZI:L3(t,"WEBGL_compressed_texture_s3tc_srgb"),JI:L3(t,"WEBGL_debug_shaders"),tM:L3(t,"WEBGL_lose_context"),uM:L3(t,"WEBGL_debug_renderer_info"),nM:L3(t,"OES_texture_half_float_linear"),rM:L3(t,"OES_texture_float_linear"),NR:null,nO:!0};return Bu.os!==Nu.ANDROID&&Bu.os!==Nu.IOS&&(i.NR=L3(t,"WEBGL_multi_draw")),i}function P3(t){var i=null;try{var n={alpha:Gi.ENABLE_TRANSPARENT_CANVAS,antialias:Gi.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};i=t.getContext("webgl2",n)}catch(t){return null}return i}var B3=function(t){function i(){var i;return(i=t.call(this)||this).aM=new I3,i.cM=null,i.fM=null,i.Ae=null,i.iN=null,i.lM=null,i.dM=null,i}s(i,t);var n=i.prototype;return n.initialize=function(t){var i=this;i.Ae=t.windowHandle,i.iN=i.gM.bind(i),i.Ae.addEventListener(N3,i.gM);var n=l3.instance,e=n.gl,r=n.capabilities;i.aM.Jr(r.maxTextureUnits,r.maxUniformBufferBindings,r.maxVertexAttributes),i.lM=F3(e),C3(e);var s=55,h=e.getParameter(3414),u=e.getParameter(3415);h&&u?s=55:h&&(s=54),i.Pn=new M3,i.Pn.initAsSwapchainTexture({swapchain:i,format:35,width:t.width,height:t.height}),i.Bn=new M3,i.Bn.initAsSwapchainTexture({swapchain:i,format:s,width:t.width,height:t.height}),i.cM=n.createTexture(new vd(1,4,35,2,2,0)),i.fM=n.createTexture(new vd(3,4,35,2,2,0,6));var o=new td;o.texExtent.width=2,o.texExtent.height=2;var a=new Uint8Array(i.cM.size);a.fill(0),n.copyBuffersToTexture([a],i.cM,[o]),o.texSubres.layerCount=6,n.copyBuffersToTexture([a,a,a,a,a,a],i.fM,[o]),i.dM=new g3},n.destroy=function(){var t=this;t.Ae&&t.iN&&(t.Ae.removeEventListener(N3,t.iN),t.iN=null),t.cM&&(t.cM.destroy(),t.cM=null),t.fM&&(t.fM.destroy(),t.fM=null),t.dM&&(t.dM.kg(),t.dM=null),t.lM=null,t.Ae=null},n.resize=function(t,i){var n=this;n.Pn.width===t&&n.Pn.height===i||(q("Resizing swapchain: "+t+"x"+i),n.Ae.width=t,n.Ae.height=i,n.Pn.resize(t,i),n.Bn.resize(t,i))},n.gM=function(t){st(11e3),X(t)},e(i,[{key:"extensions",get:function(){return this.lM}},{key:"blitManager",get:function(){return this.dM}}]),i}(_g);function D3(t,i,n){for(var e=0;e<i.length;++e)t[i[e]]=n}function U3(t,i,n){for(var e=0;e<i.length;++e)t[i[e]]=n}var x3,G3,j3,H3,V3,$3,W3,z3,X3,Y3,K3=t("WebGL2Device",function(t){function i(){var i;return(i=t.call(this)||this).Ee=null,i.gr=null,i.wM=null,i._M=new Array(117),i}s(i,t);var n=i.prototype;return n.AM=function(){return this.Ee.aM},n.initialize=function(t){l3.$R(this),this.dn=7;var i=this.An=t.bindingMappingInfo,n=[],e=[],r=i.setIndices[0];n[r]=0,e[r]=0;for(var s=1;s<i.setIndices.length;++s){var h=i.setIndices[s],u=i.setIndices[s-1];n[h]=i.maxBlockCounts[u]+n[u],e[h]=i.maxSamplerTextureCounts[u]+e[u]}for(var o=0;o<i.setIndices.length;++o){var a=i.setIndices[o];e[a]-=i.maxBlockCounts[a]}this.wM={bI:n,hR:e,sR:i.setIndices[i.setIndices.length-1]};var c=this.gr=P3(gg.Rn);if(!c)return ut(16405),!1;this.an=this.createQueue(new Vd(0)),this.pn=this.createCommandBuffer(new Hd(this.an));var f=c.getParameter.bind(c),v=this.bn;if(v.maxVertexAttributes=f(34921),v.maxVertexUniformVectors=f(36347),Bu.os===Nu.IOS){var l=v.maxVertexUniformVectors;ho.browserType===Ru.WECHAT?v.maxVertexUniformVectors=l<256?l:256:ho.browserType===Ru.SAFARI&&(v.maxVertexUniformVectors=l<512?l:512)}v.maxFragmentUniformVectors=f(36349),v.maxTextureUnits=f(34930),v.maxVertexTextureUnits=f(35660),v.maxUniformBufferBindings=f(35375),v.maxUniformBlockSize=f(35376),v.maxTextureSize=f(3379),v.maxCubeMapTextureSize=f(34076),v.maxArrayTextureLayers=f(35071),v.max3DTextureSize=f(32883),v.uboOffsetAlignment=f(35380);var d=c.getSupportedExtensions(),g="";d&&d.forEach((function(t){g+=t+" "}));var w=F3(c);w.uM?(this.gn=f(w.uM.UNMASKED_RENDERER_WEBGL),this.wn=f(w.uM.UNMASKED_VENDOR_WEBGL)):(this.gn=f(7937),this.wn=f(7936));var _=f(7938),m=this._n;m.fill(!1),this.mM(w),m[0]=!0,m[1]=!0,m[2]=!0,m[3]=!0;var p="";return this.getFormatFeatures(72)&&(p+="etc1 "),this.getFormatFeatures(73)&&(p+="etc2 "),this.getFormatFeatures(56)&&(p+="dxt "),this.getFormatFeatures(83)&&(p+="pvrtc "),this.getFormatFeatures(89)&&(p+="astc "),q("WebGL2 device initialized."),q("RENDERER: "+this.gn),q("VENDOR: "+this.wn),q("VERSION: "+_),q("COMPRESSED_FORMAT: "+p),q("EXTENSIONS: "+g),!0},n.destroy=function(){this.an&&(this.an.destroy(),this.an=null),this.pn&&(this.pn.destroy(),this.pn=null);for(var t=this.En.values(),i=t.next();!i.done;)i.value.destroy(),i=t.next();this.Ee=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this.an;this.cn=t.RI,this.vn=t.II,this.ln=t.MI,t.V_()},n.mM=function(t){var i=this.mn,n=this._M;i.fill(0),n.fill(!0);var e=31;D3(i,[4,14,24,35],e),D3(i,[5,15,26,38,47,50,49,51,25,37,48,53,54,55],e=15),i[52]=15,D3(i,[8,18,29,41],e=27),D3(i,[11,21,32,44],e=26),i[52]=15,D3(i,[7,6,10,9,13,12,17,16,20,19,23,22,28,27,31,30,34,33,40,39,43,42,46,45],e=31),U3(n,[4,14,24,47,50,49,35,51,52,37,7,6,10,9,13,12,17,16,20,19,23,22,40,39,43,42,46,45,54,55],!1),t.tN&&(i[11]|=1,i[21]|=1,i[44]|=1,U3(n,[11,21,44],!1)),t.zI&&U3(n,[8,18,41],!1),t.rM&&(i[32]|=4,i[44]|=4,i[11]|=4,i[21]|=4),t.nM&&(i[29]|=4,i[41]|=4,i[8]|=4,i[18]|=4),t.YI&&(i[72]=6),t.KI&&D3(i,[73,77,74,78,75,76],6),t.QI&&D3(i,[56,57,58,59,60,61,62,63],6),t.qI&&D3(i,[83,84,85,86],6),t.oM&&D3(i,[89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116],6)},n.createCommandBuffer=function(t){var i=new(0===t.type?k3:_3);return i.initialize(t),i},n.createSwapchain=function(t){var i=new B3;return this.Ee=i,i.initialize(t),i},n.createBuffer=function(t){var i=new w3;return i.initialize(t),i},n.createTexture=function(t){var i=new M3;return i.initialize(t),i},n.createDescriptorSet=function(t){var i=new S2;return i.initialize(t),i},n.createShader=function(t){var i=new R3;return i.initialize(t),i},n.createInputAssembler=function(t){var i=new p3;return i.initialize(t),i},n.createRenderPass=function(t){var i=new S3;return i.initialize(t),i},n.createFramebuffer=function(t){var i=new m3;return i.initialize(t),i},n.createDescriptorSetLayout=function(t){var i=new y3;return i.initialize(t),i},n.createPipelineLayout=function(t){var i=new b3;return i.initialize(t),i},n.createPipelineState=function(t){var i=new E3;return i.initialize(t),i},n.createQueue=function(t){var i=new T3;return i.initialize(t),i},n.getSampler=function(t){var i=Ng.computeHash(t);return this.En.has(i)||this.En.set(i,new O3(t,i)),this.En.get(i)},n.getSwapchains=function(){return[this.Ee]},n.getGeneralBarrier=function(t){var i=Fg.computeHash(t);return this.kn.has(i)||this.kn.set(i,new Fg(t,i)),this.kn.get(i)},n.getTextureBarrier=function(t){var i=Pg.computeHash(t);return this.Tn.has(i)||this.Tn.set(i,new Pg(t,i)),this.Tn.get(i)},n.getBufferBarrier=function(t){var i=Bg.computeHash(t);return this.Sn.has(i)||this.Sn.set(i,new Bg(t,i)),this.Sn.get(i)},n.copyBuffersToTexture=function(t,i,n){c3(this,t,i.gpuTexture,n)},n.copyTextureToBuffers=function(t,i,n){f3(this,t.gpuTexture,i,n)},n.copyTexImagesToTexture=function(t,i,n){u3(this,t,i.gpuTexture,n)},e(i,[{key:"gl",get:function(){return this.gr}},{key:"extensions",get:function(){return this.Ee.extensions}},{key:"nullTex2D",get:function(){return this.Ee.cM}},{key:"nullTexCube",get:function(){return this.Ee.fM}},{key:"textureExclusive",get:function(){return this._M}},{key:"bindingMappings",get:function(){return this.wM}},{key:"blitManager",get:function(){return this.Ee.blitManager}}]),i}(gg));T.WebGL2Device=K3;var q3=(x3=Ko("cc.Billboard"),G3=Ca(Mm),j3=Ca(Mm),x3((V3=function(t){s(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this)._texture=$3&&$3(),i._height=W3&&W3(),i._width=z3&&z3(),i._rotation=X3&&X3(),i._techIndex=Y3&&Y3(),i.P_=null,i.dw=null,i.C_=null,i.nN=new De(1,1,0,0),i}return i.eN=function(){this.C_&&this.C_.setProperty("mainTexture",this._texture)},i.rN=function(){this.C_&&(this.nN.y=this._height,this.C_.setProperty("cc_size_rotation",this.nN))},i.sN=function(){this.C_&&(this.nN.x=this._width,this.C_.setProperty("cc_size_rotation",this.nN))},i.hN=function(){this.C_&&(this.nN.z=this._rotation,this.C_.setProperty("cc_size_rotation",this.nN))},i.uN=function(){this.P_&&this.dw&&this.C_&&this.C_.technique!==this._techIndex&&(this.tv(),this.P_.destroy(),this.P_=null,this.C_.destroy(),this.C_=null,this.dw.destroy(),this.dw=null,this.oN(),this.sN(),this.rN(),this.hN(),this.eN(),this.enabled?(this.Jf(),this.P_.enabled=!0):this.P_.enabled=!1)},i.onLoad=function(){this.oN()},i.onEnable=function(){this.Jf(),this.P_.enabled=!0,this.sN(),this.rN(),this.hN(),this.eN(),this.uN()},i.onDisable=function(){this.tv()},i.Jf=function(){this.P_&&this.node&&this.node.scene&&(this.P_.scene&&this.tv(),this._getRenderScene().addModel(this.P_))},i.tv=function(){this.P_&&this.P_.scene&&this.P_.scene.removeModel(this.P_)},i.oN=function(){this.dw=NF({primitiveMode:7,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[cr.WHITE.r,cr.WHITE.g,cr.WHITE.b,cr.WHITE.a,cr.WHITE.r,cr.WHITE.g,cr.WHITE.b,cr.WHITE.a,cr.WHITE.r,cr.WHITE.g,cr.WHITE.b,cr.WHITE.a,cr.WHITE.r,cr.WHITE.g,cr.WHITE.b,cr.WHITE.a],attributes:[new kd("a_position",32),new kd("a_texCoord",21),new kd("a_color",39,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this.P_=k.director.root.createModel(jM);t.node=t.transform=this.node,null==this.C_&&(this.C_=new Lk,this.C_.copy(uk.get("default-billboard-material"),{technique:this._techIndex})),t.initSubModel(0,this.dw.renderingSubMeshes[0],this.C_)},e(n,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this.eN()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this.rN()}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this.sN()}},{key:"rotation",get:function(){return Math.round(100*ee(this._rotation))/100},set:function(t){this._rotation=ne(t),this.hN()}},{key:"technique",get:function(){return this._techIndex},set:function(t){var i,n;t=Math.floor(t);var e=null==(i=this.C_)||null==(n=i.effectAsset)?void 0:n.techniques;e&&t>=e.length&&(t=e.length-1),t<0&&(t=0),this._techIndex=t,this.uN()}}]),n}(w_),$3=xo(V3.prototype,"_texture",[G3],(function(){return null})),m(V3.prototype,"texture",[j3],Object.getOwnPropertyDescriptor(V3.prototype,"texture"),V3.prototype),W3=xo(V3.prototype,"_height",[oa],(function(){return 0})),z3=xo(V3.prototype,"_width",[oa],(function(){return 0})),X3=xo(V3.prototype,"_rotation",[oa],(function(){return 0})),Y3=xo(V3.prototype,"_techIndex",[oa],(function(){return 0})),H3=V3))||H3);t({Billboard:q3,BillboardComponent:q3});var Q3,Z3,J3,t5,i5,n5,e5,r5,s5,h5,u5,o5,a5,c5,f5,v5,l5,d5,g5=[new kd("a_position",32),new kd("a_texCoord",44),new kd("a_texCoord1",32),new kd("a_color",35,!0)],w5=new ir,_5=new ir,m5=function(t){function i(){var i;return(i=t.call(this)||this).WR=void 0,i.aN=0,i.cN=null,i.fN=0,i.vN=null,i.lN=null,i.dN=null,i.gN=0,i.wN=0,i.C_=null,i._N=0,i.mN=0,i.type=5,i.WR=100,i}s(i,t);var n=i.prototype;return n.setCapacity=function(t){this.WR=t,this.createBuffer()},n.createBuffer=function(){this.aN=0;for(var t=0,i=g5;t<i.length;t++){var n=i[t];n.offset=this.aN,this.aN+=tg[n.format].size}this.fN=this.aN/4,this.cN=this.pN(),this.vN=new Float32Array(this.cN),this.lN=new Uint32Array(this.cN)},n.updateMaterial=function(i){this.C_=i,t.prototype.setSubModelMaterial.call(this,0,i)},n.pN=function(){this.dN&&this.yN(),this.gN=2,this.wN=6;var t=this._device.createBuffer(new ud(10,1,this.aN*this.WR*this.gN,this.aN)),i=new ArrayBuffer(this.aN*this.WR*this.gN);t.update(i);for(var n=new Uint16Array((this.WR-1)*this.wN),e=0,r=0;r<this.WR-1;++r){var s=2*r;n[e++]=s,n[e++]=s+1,n[e++]=s+2,n[e++]=s+3,n[e++]=s+2,n[e++]=s+1}var h=this._device.createBuffer(new ud(6,1,(this.WR-1)*this.wN*2,2));return h.update(n),this._N=this.WR*this.gN,this.mN=(this.WR-1)*this.wN,this.dN=new qC([t],g5,7,h),this.initSubModel(0,this.dN,this.C_),i},n.addLineVertexData=function(t,i,n){if(t.length>1){var e=0;ir.subtract(w5,t[1],t[0]),this.vN[e++]=t[0].x,this.vN[e++]=t[0].y,this.vN[e++]=t[0].z,this.vN[e++]=0,this.vN[e++]=i.evaluate(0,1),this.vN[e++]=0,this.vN[e++]=0,this.vN[e++]=w5.x,this.vN[e++]=w5.y,this.vN[e++]=w5.z,this.lN[e++]=cr.toUint32(n.evaluate(0,1)),this.vN[e++]=t[0].x,this.vN[e++]=t[0].y,this.vN[e++]=t[0].z,this.vN[e++]=1,this.vN[e++]=i.evaluate(0,1),this.vN[e++]=0,this.vN[e++]=1,this.vN[e++]=w5.x,this.vN[e++]=w5.y,this.vN[e++]=w5.z,this.lN[e++]=cr.toUint32(n.evaluate(0,1));for(var r=1;r<t.length-1;r++){ir.subtract(w5,t[r-1],t[r]),ir.subtract(_5,t[r+1],t[r]),ir.subtract(_5,_5,w5);var s=r/t.length;this.vN[e++]=t[r].x,this.vN[e++]=t[r].y,this.vN[e++]=t[r].z,this.vN[e++]=0,this.vN[e++]=i.evaluate(s,1),this.vN[e++]=s,this.vN[e++]=0,this.vN[e++]=_5.x,this.vN[e++]=_5.y,this.vN[e++]=_5.z,this.lN[e++]=cr.toUint32(n.evaluate(s,1)),this.vN[e++]=t[r].x,this.vN[e++]=t[r].y,this.vN[e++]=t[r].z,this.vN[e++]=1,this.vN[e++]=i.evaluate(s,1),this.vN[e++]=s,this.vN[e++]=1,this.vN[e++]=_5.x,this.vN[e++]=_5.y,this.vN[e++]=_5.z,this.lN[e++]=cr.toUint32(n.evaluate(s,1))}ir.subtract(w5,t[t.length-1],t[t.length-2]),this.vN[e++]=t[t.length-1].x,this.vN[e++]=t[t.length-1].y,this.vN[e++]=t[t.length-1].z,this.vN[e++]=0,this.vN[e++]=i.evaluate(1,1),this.vN[e++]=1,this.vN[e++]=0,this.vN[e++]=w5.x,this.vN[e++]=w5.y,this.vN[e++]=w5.z,this.lN[e++]=cr.toUint32(n.evaluate(1,1)),this.vN[e++]=t[t.length-1].x,this.vN[e++]=t[t.length-1].y,this.vN[e++]=t[t.length-1].z,this.vN[e++]=1,this.vN[e++]=i.evaluate(1,1),this.vN[e++]=1,this.vN[e++]=1,this.vN[e++]=w5.x,this.vN[e++]=w5.y,this.vN[e++]=w5.z,this.lN[e++]=cr.toUint32(n.evaluate(1,1))}this.updateIA(Math.max(0,t.length-1))},n.updateIA=function(t){var i=this._subModels[0].inputAssembler;i.vertexBuffers[0].update(this.vN),i.firstIndex=0,i.indexCount=this.wN*t,i.vertexCount=this._N},n.yN=function(){this.dN&&(this.dN.destroy(),this.dN=null)},i}(jM),p5=Un.Attr.setClassAttr,y5=[["mode","constant","multiplier"],["mode","spline","multiplier"],["mode","splineMin","splineMax","multiplier"],["mode","constantMin","constantMax","multiplier"]],b5=Ni({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),A5=t("CurveRange",Ko("cc.CurveRange")((Z3=function(){function t(){this.constant=0,this.constantMin=0,this.constantMax=0,this.multiplier=1,this.Xt=b5.Constant}var i=t.prototype;return i.evaluate=function(t,i){switch(this.Xt){default:case b5.Constant:return this.constant;case b5.Curve:return this.spline.evaluate(t)*this.multiplier;case b5.TwoCurves:return ie(this.splineMin.evaluate(t),this.splineMax.evaluate(t),i)*this.multiplier;case b5.TwoConstants:return ie(this.constantMin,this.constantMax,i)}},i.getMax=function(){switch(this.Xt){default:case b5.Constant:return this.constant;case b5.Curve:return this.multiplier;case b5.TwoConstants:return this.constantMax;case b5.TwoCurves:return this.multiplier}},i.isZero=function(){switch(this.Xt){default:case b5.Constant:return Zn(this.constant,0,qn);case b5.Curve:return Zn(this.multiplier,0,qn);case b5.TwoConstants:return Zn(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,qn);case b5.TwoCurves:return Zn(this.multiplier,0,qn)}},i._onBeforeSerialize=function(){return y5[this.Xt]},e(t,[{key:"mode",get:function(){return this.Xt},set:function(t){switch(this.Xt=t,t){case b5.Constant:case b5.TwoConstants:break;case b5.Curve:this.spline||(this.spline=gv());break;case b5.TwoCurves:this.splineMax||(this.splineMax=gv()),this.splineMin||(this.splineMin=gv())}}},{key:"curve",get:function(){var t;return null!==(t=this.dT)&&void 0!==t?t:this.dT=new vv(this.spline)},set:function(t){this.dT=t,this.spline=t._internalCurve}},{key:"curveMin",get:function(){var t;return null!==(t=this.bN)&&void 0!==t?t:this.bN=new vv(this.splineMin)},set:function(t){this.bN=t,this.splineMin=t._internalCurve}},{key:"curveMax",get:function(){var t;return null!==(t=this.AN)&&void 0!==t?t:this.AN=new vv(this.splineMax)},set:function(t){this.AN=t,this.splineMax=t._internalCurve}}]),t}(),Z3.Mode=b5,Q3=Z3))||Q3);function E5(t,i,n){switch(t.mode){case b5.Constant:return t.constant;case b5.Curve:return t.spline.evaluate(i)*t.multiplier;case b5.TwoCurves:return 0===n?t.splineMin.evaluate(i)*t.multiplier:t.splineMax.evaluate(i)*t.multiplier;case b5.TwoConstants:return 0===n?t.constantMin:t.constantMax;default:return 0}}function k5(t){switch(t.mode){case b5.TwoConstants:case b5.TwoCurves:return 2;default:return 1}}function T5(t,i,n){var e=new jw({width:i,height:n,_data:t,_compressed:!1,format:44}),r=new Mm;return r.setFilters(1,1),r.setMipFilter(0),r.setWrapMode(2,2,2),r.image=e,r}function S5(t,i,n,e){return null===t||n!==t.width||e!==t.height?(t&&t.destroy(),t=T5(i,n,e)):t.uploadData(i),t}function O5(t,i,n,e){var r=k5(e),s=n*r*4;null!==i&&i.length===s||(i=new Float32Array(n*r*4));for(var h=1/(n-1),u=0,o=0;o<r;o++)for(var a=0;a<n;a++){var c=E5(e,h*a,o);i[u+2]=c,u+=4}return{texture:S5(t,i,n,r),texdata:i}}function R5(t,i,n,e){var r=k5(e),s=n*r*4;null!==i&&i.length===s||(i=new Float32Array(n*r*4));for(var h=1/(n-1),u=0,o=0,a=0;a<r;a++)for(var c=0;c<n;c++)u=E5(e,h*c,a),i[o]=u,i[o+1]=u,i[o+2]=u,o+=4;return{texture:S5(t,i,n,r),texdata:i}}function I5(t,i,n,e,r){var s=Math.max(k5(e),k5(r)),h=n*s*4;null!==i&&i.length===h||(i=new Float32Array(n*s*4));for(var u=[e,r],o=1/(n-1),a=0;a<s;a++)for(var c=0;c<2;c++)for(var f=u[c],v=0,l=0;l<n;l++)v=E5(f,o*l,a),i[4*(a*n+l)+c]=v;return{texture:S5(t,i,n,s),texdata:i}}function M5(t,i,n,e,r,s,h){var u=Math.max(k5(e),k5(r),k5(s)),o=n*u*4;null!==i&&i.length===o||(i=new Float32Array(n*u*4));for(var a=[e,r,s],c=1/(n-1),f=0;f<u;f++)for(var v=0;v<3;v++)for(var l=a[v],d=0,g=0,w=0;w<n;w++){var _=E5(l,c*w,f);g=h?_:(d+=_)/(w+1),i[4*(f*n+w)+v]=g}return{texture:S5(t,i,n,u),texdata:i}}function N5(t,i,n,e,r,s,h){var u=Math.max(k5(e),k5(r),k5(s),k5(h)),o=n*u*4;null!==i&&i.length===o||(i=new Float32Array(n*u*4));for(var a=[e,r,s,h],c=1/(n-1),f=0;f<u;f++)for(var v=0;v<4;v++)for(var l=a[v],d=0,g=0,w=0;w<n;w++)g=(d+=E5(l,c*w,f))/(w+1),i[4*(f*n+w)+v]=g;return{texture:S5(t,i,n,u),texdata:i}}Un.fastDefine("cc.CurveRange",A5,{multiplier:1,constantMax:0,constantMin:0,constant:0,mode:b5.Constant,splineMax:Object.freeze(gv()),splineMin:Object.freeze(gv()),spline:Object.freeze(gv())}),p5(A5,"multiplier","visible",!0),p5(A5,"constantMax","visible",!0),p5(A5,"constantMin","visible",!0),p5(A5,"constant","visible",!0),kn(A5,"mode",b5),p5(A5,"mode","visible",!0),p5(A5,"splineMax","type","Object"),p5(A5,"splineMax","ctor",Qc),p5(A5,"splineMax","visible",!0),p5(A5,"splineMin","type","Object"),p5(A5,"splineMin","ctor",Qc),p5(A5,"splineMin","visible",!0),p5(A5,"spline","type","Object"),p5(A5,"spline","ctor",Qc),p5(A5,"spline","visible",!0);var C5,L5,F5,P5,B5,D5,U5,x5,G5,j5,H5,V5,$5,W5,z5,X5,Y5,K5,q5,Q5,Z5=Ni({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),J5=new cr,t6=new cr,i6=t("GradientRange",(J3=Ko("cc.GradientRange"),t5=Ca(Z5),i5=Ca(ov),n5=Ca(ov),e5=Ca(ov),r5=Ca(Z5),J3((d5=function(){function t(){this.color=u5&&u5(),this.colorMin=o5&&o5(),this.colorMax=a5&&a5(),this.gradient=c5&&c5(),this.gradientMin=f5&&f5(),this.gradientMax=v5&&v5(),this._mode=l5&&l5(),this.Bm=cr.WHITE.clone()}var i=t.prototype;return i.evaluate=function(t,i){switch(this._mode){case Z5.Color:return this.color;case Z5.TwoColors:return cr.lerp(this.Bm,this.colorMin,this.colorMax,i),this.Bm;case Z5.RandomColor:return this.gradient.getRandomColor(this.Bm);case Z5.Gradient:return this.gradient.evaluateFast(this.Bm,t);case Z5.TwoGradients:return cr.lerp(this.Bm,this.gradientMin.evaluateFast(J5,t),this.gradientMax.evaluateFast(t6,t),i),this.Bm;default:return this.color}},i._onBeforeSerialize=function(){return(!1)[this._mode]},e(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),d5.Mode=Z5,m((h5=d5).prototype,"mode",[t5],Object.getOwnPropertyDescriptor(h5.prototype,"mode"),h5.prototype),u5=xo(h5.prototype,"color",[oa],(function(){return cr.WHITE.clone()})),o5=xo(h5.prototype,"colorMin",[oa],(function(){return cr.WHITE.clone()})),a5=xo(h5.prototype,"colorMax",[oa],(function(){return cr.WHITE.clone()})),c5=xo(h5.prototype,"gradient",[i5],(function(){return new ov})),f5=xo(h5.prototype,"gradientMin",[n5],(function(){return new ov})),v5=xo(h5.prototype,"gradientMax",[e5],(function(){return new ov})),l5=xo(h5.prototype,"_mode",[r5],(function(){return Z5.Color})),s5=h5))||s5));function n6(t,i,n){switch(t.mode){case Z5.Color:return t.color;case Z5.TwoColors:return 0===n?t.colorMin:t.colorMax;case Z5.RandomColor:return t.gradient.getRandomColor(J5);case Z5.Gradient:return t.gradient.evaluateFast(J5,i);case Z5.TwoGradients:return 0===n?t.gradientMin.evaluateFast(J5,i):t.gradientMax.evaluateFast(J5,i);default:return t.color}}function e6(t){switch(t.mode){case Z5.TwoColors:case Z5.TwoGradients:return 2;default:return 1}}function r6(t,i,n,e){var r=e6(e),s=n*r*4;null!==i&&i.length===s||(i=new Uint8Array(n*r*4));for(var h=1/(n-1),u=0,o=0;o<r;o++)for(var a=0;a<n;a++){var c=n6(e,h*a,o);i[u]=c.r,i[u+1]=c.g,i[u+2]=c.b,i[u+3]=c.a,u+=4}return null!==t&&n===t.width&&r===t.height||(t&&t.destroy(),(t=new Mm).create(n,r,35),t.setFilters(2,2),t.setWrapMode(2,2)),t.uploadData(i),{texture:t,texdata:i}}var s6="CC_USE_WORLD_SPACE",h6={CC_USE_WORLD_SPACE:!1,CC_USE_WORLD_SCALE:!0},u6=(C5=Ko("cc.Line"),L5=Ca(Mm),F5=Ca(Mm),P5=Ca(Lk),B5=Ca([ir]),D5=Ca([ir]),U5=Ca(A5),x5=Ca(i6),G5=Ca(ls),j5=Ca(ls),C5((V5=function(t){function i(){var i;return(i=t.call(this)||this)._texture=$5&&$5(),i._material=W5&&W5(),i._worldSpace=z5&&z5(),i._positions=X5&&X5(),i._width=Y5&&Y5(),i._color=K5&&K5(),i._tile=q5&&q5(),i.EN=new De,i._offset=Q5&&Q5(),i}s(i,t);var n=i.prototype;return n.onLoad=function(){var t=k.director.root.createModel(m5);if(0===this._models.length?this._models.push(t):this._models[0]=t,t.node=t.transform=this.node,this._material&&(this.lineMaterial=this._material,this._material=null),null===this.lineMaterial){var i=uk.get("default-trail-material");this.material=i}var n=this.getMaterialInstance(0);n&&(h6[s6]=this.worldSpace,n.recompileShaders(h6),t.updateMaterial(n)),t.setCapacity(100)},n.onEnable=function(){t.prototype.onEnable.call(this),0!==this._models.length&&this._models[0]&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._models[0].addLineVertexData(this._positions,this.width,this.color))},n.onDisable=function(){this._models.length>0&&this._models[0]&&this._detachFromScene()},n._attachToScene=function(){if(t.prototype._attachToScene.call(this),this._models.length>0&&this._models[0]&&this.node&&this.node.scene){var i=this._models[0];i.scene&&this._detachFromScene(),this._getRenderScene().addModel(i)}},n._detachFromScene=function(){if(t.prototype._detachFromScene.call(this),this._models.length>0&&this._models[0]){var i=this._models[0];i.scene&&i.scene.removeModel(i)}},n._onMaterialModified=function(i,n){t.prototype._onMaterialModified.call(this,i,n);var e=this.getMaterialInstance(0);e&&(h6[s6]=this.worldSpace,e.recompileShaders(h6),this._models[0]&&this._models[0].updateMaterial(e))},e(i,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this.material&&this.material.setProperty("mainTexture",t)}},{key:"lineMaterial",get:function(){return this.getSharedMaterial(0)},set:function(t){this.setSharedMaterial(t,0)}},{key:"sharedMaterials",get:function(){return t.prototype.sharedMaterials},set:function(t){this.sharedMaterials=t}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t;var i=this.getMaterialInstance(0);i&&(h6[s6]=this.worldSpace,i.recompileShaders(h6),this._models[0]&&this._models[0].setSubModelMaterial(0,i))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this.width,this.color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this._width,this._color)}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this.material&&(this.EN.x=this._tile.x,this.EN.y=this._tile.y,this.material.setProperty("mainTiling_Offset",this.EN))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this.material&&(this.EN.z=this._offset.x,this.EN.w=this._offset.y,this.material.setProperty("mainTiling_Offset",this.EN))}}]),i}(yj),$5=xo(V5.prototype,"_texture",[L5],(function(){return null})),m(V5.prototype,"texture",[F5],Object.getOwnPropertyDescriptor(V5.prototype,"texture"),V5.prototype),W5=xo(V5.prototype,"_material",[oa],(function(){return null})),m(V5.prototype,"lineMaterial",[P5],Object.getOwnPropertyDescriptor(V5.prototype,"lineMaterial"),V5.prototype),m(V5.prototype,"sharedMaterials",[ja,oa],Object.getOwnPropertyDescriptor(V5.prototype,"sharedMaterials"),V5.prototype),z5=xo(V5.prototype,"_worldSpace",[oa],(function(){return!1})),X5=xo(V5.prototype,"_positions",[B5],(function(){return[]})),m(V5.prototype,"positions",[D5],Object.getOwnPropertyDescriptor(V5.prototype,"positions"),V5.prototype),m(V5.prototype,"width",[U5],Object.getOwnPropertyDescriptor(V5.prototype,"width"),V5.prototype),Y5=xo(V5.prototype,"_width",[oa],(function(){return new A5})),m(V5.prototype,"color",[x5],Object.getOwnPropertyDescriptor(V5.prototype,"color"),V5.prototype),K5=xo(V5.prototype,"_color",[oa],(function(){return new i6})),q5=xo(V5.prototype,"_tile",[oa],(function(){return new ls(1,1)})),m(V5.prototype,"tile",[G5],Object.getOwnPropertyDescriptor(V5.prototype,"tile"),V5.prototype),Q5=xo(V5.prototype,"_offset",[oa],(function(){return new ls(0,0)})),m(V5.prototype,"offset",[j5],Object.getOwnPropertyDescriptor(V5.prototype,"offset"),V5.prototype),H5=V5))||H5);t({Line:u6,LineComponent:u6});var o6=function(){function t(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startEuler=void 0,this.startRotation=void 0,this.startRotated=void 0,this.deltaQuat=void 0,this.deltaMat=void 0,this.localMat=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.loopCount=void 0,this.lastLoop=void 0,this.trailDelay=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new ir(0,0,0),this.velocity=new ir(0,0,0),this.animatedVelocity=new ir(0,0,0),this.ultimateVelocity=new ir(0,0,0),this.angularVelocity=new ir(0,0,0),this.axisOfRotation=new ir(0,0,0),this.rotation=new ir(0,0,0),this.startEuler=new ir(0,0,0),this.startRotation=new Cr,this.startRotated=!1,this.deltaQuat=new Cr,this.deltaMat=new Kr,this.localMat=new Kr,this.startSize=new ir(0,0,0),this.size=new ir(0,0,0),this.startColor=cr.WHITE.clone(),this.color=cr.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.loopCount=0,this.lastLoop=0,this.trailDelay=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0}return t.prototype.reset=function(){this.rotation.set(0,0,0),this.startEuler.set(0,0,0),this.startRotation.set(0,0,0,1),this.startRotated=!1,this.deltaQuat.set(0,0,0,1),this.deltaMat.identity(),this.localMat.identity()},t}();o6.INDENTIFY_NEG_QUAT=10,o6.R2D=180/Math.PI;var a6,c6,f6,v6,l6,d6,g6="noiseModule",w6=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule","noiseModule"],_6=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_noiseModule","_trailModule"],m6=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var i=t.prototype;return i.bindTarget=function(t){this.target=t},i.update=function(){},t}(),p6=new ir(0,0,-1);function y6(t,i,n,e){return i!==t?(0===t||Kr.invert(n,n),Kr.getRotation(e,n),!0):(Cr.set(e,0,0,0,1),!1)}function b6(t,i){ls.set(t,Math.cos(i),Math.sin(i))}function A6(t){var i=he(-1,1),n=he(0,2*Math.PI),e=Math.sqrt(1-i*i),r=e*Math.cos(n),s=e*Math.sin(n);ir.set(t,r,s,i)}function E6(t,i,n){A6(t),ir.multiplyScalar(t,t,i+(n-i)*re())}function k6(t,i,n,e){b6(t,e),t.z=0,ir.multiplyScalar(t,t,i+(n-i)*re())}function T6(t){for(var i=0;i<t.length;i++){var n=i+ue(0,t.length-i),e=t[n];t[n]=t[i],t[i]=e}}function S6(){var t=he(-1,1);return 0===t&&t++,I(t)}function O6(t){var i=A5.Mode;switch(t.mode){case i.TwoCurves:case i.TwoConstants:return!0;default:return!1}}function R6(t){var i=i6.Mode;switch(t.mode){case i.TwoGradients:case i.TwoColors:return!0;default:return!1}}var I6=(a6=Ko("cc.ColorOvertimeModule"),c6=Ca(i6),a6((v6=function(t){function i(){var i;return(i=t.call(this)||this)._enable=l6&&l6(),i.color=d6&&d6(),i.name="colorModule",i}return s(i,t),i.prototype.animate=function(t){t.color.set(t.startColor);var i=R6(this.color)?oe(t.randomSeed+91041):0;t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,i))},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),i}(m6),l6=xo(v6.prototype,"_enable",[oa],(function(){return!1})),d6=xo(v6.prototype,"color",[c6,oa],(function(){return new i6})),f6=v6))||f6),M6={World:0,Local:1,Custom:2};Ni(M6);var N6={Pause:0,PauseAndCatchup:1,AlwaysSimulate:2};Ni(N6);var C6={World:0,Local:1,View:2};Ni(C6);var L6={Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4};Ni(L6);var F6={Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4};Ni(F6);var P6={Base:0,Edge:1,Shell:2,Volume:3};Ni(P6);var B6={Random:0,Loop:1,PingPong:2};Ni(B6);var D6={Particles:0};Ni(D6);var U6,x6,G6,j6,H6,V6,$6,W6,z6,X6,Y6,K6,q6={Stretch:0};Ni(q6);var Q6,Z6,J6,t4,i4,n4,e4,r4,s4,h4,u4,o4,a4,c4,f4,v4,l4,d4,g4,w4,_4,m4,p4,y4,b4,A4,E4,k4=212165,T4=new ir,S4=(U6=Ko("cc.ForceOvertimeModule"),x6=Ca(A5),G6=Ca(A5),j6=Ca(A5),H6=Ca(M6),U6(($6=function(t){function i(){var i;return(i=t.call(this)||this)._enable=W6&&W6(),i.x=z6&&z6(),i.y=X6&&X6(),i.z=Y6&&Y6(),i.space=K6&&K6(),i.randomized=!1,i.kN=void 0,i.TN=void 0,i.name="forceModule",i.kN=new Cr,i.TN=!1,i.needUpdate=!0,i}s(i,t);var n=i.prototype;return n.update=function(t,i){this.TN=y6(t,this.space,i,this.kN)},n.animate=function(t,i){var n=1-t.remainingLifetime/t.startLifetime,e=O6(this.x)?oe(t.randomSeed+k4):0,r=O6(this.y)?oe(t.randomSeed+k4):0,s=O6(this.z)?oe(t.randomSeed+k4):0,h=ir.set(T4,this.x.evaluate(n,e),this.y.evaluate(n,r),this.z.evaluate(n,s));this.TN&&ir.transformQuat(h,h,this.kN),ir.scaleAndAdd(t.velocity,t.velocity,h,i),ir.copy(t.ultimateVelocity,t.velocity)},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),i}(m6),W6=xo($6.prototype,"_enable",[oa],(function(){return!1})),z6=xo($6.prototype,"x",[x6,oa],(function(){return new A5})),X6=xo($6.prototype,"y",[G6,oa],(function(){return new A5})),Y6=xo($6.prototype,"z",[j6,oa],(function(){return new A5})),K6=xo($6.prototype,"space",[H6,oa],(function(){return 1})),V6=$6))||V6),O4=23541,R4=new ir,I4=new ir,M4=(Q6=Ko("cc.LimitVelocityOvertimeModule"),Z6=Ca(A5),J6=Ca(A5),t4=Ca(A5),i4=Ca(A5),n4=Ca(M6),Q6((r4=function(t){function i(){var i;return(i=t.call(this)||this)._enable=s4&&s4(),i.limitX=h4&&h4(),i.limitY=u4&&u4(),i.limitZ=o4&&o4(),i.limit=a4&&a4(),i.dampen=c4&&c4(),i.separateAxes=f4&&f4(),i.space=v4&&v4(),i.drag=null,i.multiplyDragByParticleSize=!1,i.multiplyDragByParticleVelocity=!1,i.name="limitModule",i.kN=void 0,i.TN=void 0,i.kN=new Cr,i.TN=!1,i.needUpdate=!0,i}s(i,t);var n=i.prototype;return n.update=function(t,i){this.TN=y6(t,this.space,i,this.kN)},n.animate=function(t){var i=1-t.remainingLifetime/t.startLifetime,n=R4;if(this.separateAxes){var e=O6(this.limitX)?oe(t.randomSeed+O4):0,r=O6(this.limitY)?oe(t.randomSeed+O4):0,s=O6(this.limitZ)?oe(t.randomSeed+O4):0;ir.set(I4,this.limitX.evaluate(i,e),this.limitY.evaluate(i,r),this.limitZ.evaluate(i,s)),this.TN&&ir.transformQuat(I4,I4,this.kN),ir.set(n,N4(t.ultimateVelocity.x,I4.x,this.dampen),N4(t.ultimateVelocity.y,I4.y,this.dampen),N4(t.ultimateVelocity.z,I4.z,this.dampen))}else{ir.normalize(n,t.ultimateVelocity);var h=O6(this.limit)?oe(t.randomSeed+O4):0;ir.multiplyScalar(n,n,N4(t.ultimateVelocity.length(),this.limit.evaluate(i,h),this.dampen))}ir.copy(t.ultimateVelocity,n),ir.copy(t.velocity,t.ultimateVelocity)},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),i}(m6),s4=xo(r4.prototype,"_enable",[oa],(function(){return!1})),h4=xo(r4.prototype,"limitX",[Z6,oa],(function(){return new A5})),u4=xo(r4.prototype,"limitY",[J6,oa],(function(){return new A5})),o4=xo(r4.prototype,"limitZ",[t4,oa],(function(){return new A5})),a4=xo(r4.prototype,"limit",[i4,oa],(function(){return new A5})),c4=xo(r4.prototype,"dampen",[oa],(function(){return 3})),f4=xo(r4.prototype,"separateAxes",[oa],(function(){return!1})),v4=xo(r4.prototype,"space",[n4,oa],(function(){return 1})),e4=r4))||e4);function N4(t,i,n){var e=Math.sign(t),r=Math.abs(t);if(r>i){var s=r-r*n;r=s>i?s:i}return r*e}var C4,L4,F4,P4,B4,D4,U4,x4,G4,j4,H4,V4,$4,W4,z4,X4,Y4,K4,q4,Q4,Z4,J4,t8,i8,n8,e8,r8,s8,h8,u8,o8,a8,c8,f8,v8,l8,d8,g8,w8,_8,m8,p8,y8,b8,A8,E8,k8,T8,S8,O8,R8,I8,M8,N8,C8,L8,F8,P8,B8,D8,U8,x8,G8,j8,H8,V8,$8,W8,z8,X8,Y8,K8,q8,Q8,Z8,J8,t7,i7,n7,e7,r7,s7,h7,u7,o7,a7,c7=125292,f7=(l4=Ko("cc.RotationOvertimeModule"),d4=Ca(A5),g4=Ca(A5),w4=Ca(A5),l4((m4=function(t){function i(){var i;return(i=t.call(this)||this)._enable=p4&&p4(),i._separateAxes=y4&&y4(),i.x=b4&&b4(),i.y=A4&&A4(),i.z=E4&&E4(),i.name="rotationModule",i.SN=new Kr,i.RN=new Kr,i.IN=new Cr,i.MN=new ir,i}s(i,t);var n=i.prototype;return n.NN=function(t){var i=t.particleSystem.processor.getInfo().renderMode;4!==i&&1===i&&this.IN.set(0,0,0,1),Cr.normalize(this.IN,this.IN),this.IN.w<0&&(this.IN.x+=o6.INDENTIFY_NEG_QUAT)},n.animate=function(t,i){var n=1-t.remainingLifetime/t.startLifetime,e=O6(this.z)?oe(t.randomSeed+c7):0,r=t.particleSystem.processor.getInfo().renderMode;if(this._separateAxes&&3!==r&&2!==r){var s=O6(this.x)?oe(t.randomSeed+c7):0,h=O6(this.y)?oe(t.randomSeed+c7):0;Cr.fromEuler(t.deltaQuat,this.x.evaluate(n,s)*i*o6.R2D,this.y.evaluate(n,h)*i*o6.R2D,this.z.evaluate(n,e)*i*o6.R2D)}else Cr.fromEuler(t.deltaQuat,0,0,this.z.evaluate(n,e)*i*o6.R2D);t.deltaMat=Kr.fromQuat(t.deltaMat,t.deltaQuat),t.localMat=t.localMat.multiply(t.deltaMat),t.startRotated||(4!==r&&(1===r?t.startEuler.set(0,0,0):0!==r&&t.startEuler.set(0,0,t.startEuler.z)),Cr.fromEuler(t.startRotation,t.startEuler.x*o6.R2D,t.startEuler.y*o6.R2D,t.startEuler.z*o6.R2D),t.startRotated=!0),this.SN=Kr.fromQuat(this.SN,t.startRotation),this.RN=this.SN.multiply(t.localMat),Kr.getRotation(this.IN,this.RN),this.NN(t,o6.R2D),t.rotation.set(this.IN.x,this.IN.y,this.IN.z)},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),i}(m6),p4=xo(m4.prototype,"_enable",[oa],(function(){return!1})),y4=xo(m4.prototype,"_separateAxes",[oa],(function(){return!1})),b4=xo(m4.prototype,"x",[d4,oa],(function(){return new A5})),A4=xo(m4.prototype,"y",[g4,oa],(function(){return new A5})),E4=xo(m4.prototype,"z",[w4,oa],(function(){return new A5})),_4=m4))||_4),v7=39825,l7=(C4=Ko("cc.SizeOvertimeModule"),L4=Ca(A5),F4=Ca(A5),P4=Ca(A5),B4=Ca(A5),C4((U4=function(t){function i(){var i;return(i=t.call(this)||this)._enable=x4&&x4(),i.separateAxes=G4&&G4(),i.size=j4&&j4(),i.x=H4&&H4(),i.y=V4&&V4(),i.z=$4&&$4(),i.name="sizeModule",i}return s(i,t),i.prototype.animate=function(t){if(this.separateAxes){var i=1-t.remainingLifetime/t.startLifetime,n=O6(this.x)?oe(t.randomSeed+v7):0,e=O6(this.y)?oe(t.randomSeed+v7):0,r=O6(this.z)?oe(t.randomSeed+v7):0;t.size.x=t.startSize.x*this.x.evaluate(i,n),t.size.y=t.startSize.y*this.y.evaluate(i,e),t.size.z=t.startSize.z*this.z.evaluate(i,r)}else{var s=O6(this.size)?oe(t.randomSeed+v7):0;ir.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,s))}},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),i}(m6),x4=xo(U4.prototype,"_enable",[oa],(function(){return!1})),G4=xo(U4.prototype,"separateAxes",[oa],(function(){return!1})),j4=xo(U4.prototype,"size",[L4,oa],(function(){return new A5})),H4=xo(U4.prototype,"x",[F4,oa],(function(){return new A5})),V4=xo(U4.prototype,"y",[P4,oa],(function(){return new A5})),$4=xo(U4.prototype,"z",[B4,oa],(function(){return new A5})),D4=U4))||D4),d7=Ni({Grid:0}),g7=Ni({WholeSheet:0,SingleRow:1}),w7=(W4=Ko("cc.TextureAnimationModule"),z4=aa("numTilesX"),X4=aa("numTilesY"),Y4=Ca(d7),K4=Ca(d7),q4=Ca(g7),Q4=Ca(A5),Z4=Ca(A5),W4((t8=function(t){function i(){var i;return(i=t.call(this)||this)._enable=i8&&i8(),i._numTilesX=n8&&n8(),i._numTilesY=e8&&e8(),i._mode=r8&&r8(),i.animation=s8&&s8(),i.frameOverTime=h8&&h8(),i.startFrame=u8&&u8(),i.cycleCount=o8&&o8(),i._flipU=a8&&a8(),i._flipV=c8&&c8(),i._uvChannelMask=f8&&f8(),i.randomRow=v8&&v8(),i.rowIndex=l8&&l8(),i.name="textureModule",i}s(i,t);var n=i.prototype;return n.init=function(t){t.startRow=Math.floor(re()*this.numTilesY)},n.animate=function(t){var i=1-t.remainingLifetime/t.startLifetime,n=O6(this.startFrame)?oe(t.randomSeed+90794):0,e=O6(this.frameOverTime)?oe(t.randomSeed+90794):0,r=this.startFrame.evaluate(i,n)/(this.numTilesX*this.numTilesY);if(this.animation===g7.WholeSheet)t.frameIndex=ve(this.cycleCount*(this.frameOverTime.evaluate(i,e)+r),1);else if(this.animation===g7.SingleRow){var s=1/this.numTilesY;if(this.randomRow){var h=ve(this.cycleCount*(this.frameOverTime.evaluate(i,e)+r),1),u=t.startRow*s,o=u+s;t.frameIndex=ie(u,o,h)}else{var a=this.rowIndex*s,c=a+s;t.frameIndex=ie(a,c,ve(this.cycleCount*(this.frameOverTime.evaluate(i,e)+r),1))}}},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t!==d7.Grid&&Y("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){Y("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){Y("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){Y("particle texture animation's uvChannelMask is not supported!")}}]),i}(m6),i8=xo(t8.prototype,"_enable",[oa],(function(){return!1})),n8=xo(t8.prototype,"_numTilesX",[z4],(function(){return 0})),e8=xo(t8.prototype,"_numTilesY",[X4],(function(){return 0})),r8=xo(t8.prototype,"_mode",[Y4],(function(){return d7.Grid})),m(t8.prototype,"mode",[K4],Object.getOwnPropertyDescriptor(t8.prototype,"mode"),t8.prototype),s8=xo(t8.prototype,"animation",[q4,oa],(function(){return g7.WholeSheet})),h8=xo(t8.prototype,"frameOverTime",[Q4,oa],(function(){return new A5})),u8=xo(t8.prototype,"startFrame",[Z4,oa],(function(){return new A5})),o8=xo(t8.prototype,"cycleCount",[oa],(function(){return 0})),a8=xo(t8.prototype,"_flipU",[oa],(function(){return 0})),c8=xo(t8.prototype,"_flipV",[oa],(function(){return 0})),f8=xo(t8.prototype,"_uvChannelMask",[oa],(function(){return-1})),v8=xo(t8.prototype,"randomRow",[oa],(function(){return!1})),l8=xo(t8.prototype,"rowIndex",[oa],(function(){return 0})),J4=t8))||J4),_7=197866,m7=new ir,p7=(d8=Ko("cc.VelocityOvertimeModule"),g8=Ca(A5),w8=Ca(A5),_8=Ca(A5),m8=Ca(A5),p8=Ca(M6),d8((b8=function(t){function i(){var i;return(i=t.call(this)||this)._enable=A8&&A8(),i.x=E8&&E8(),i.y=k8&&k8(),i.z=T8&&T8(),i.speedModifier=S8&&S8(),i.space=O8&&O8(),i.kN=void 0,i.TN=void 0,i.name="velocityModule",i.kN=new Cr,i.speedModifier.constant=1,i.TN=!1,i.needUpdate=!0,i}s(i,t);var n=i.prototype;return n.update=function(t,i){this.TN=y6(t,this.space,i,this.kN)},n.animate=function(t){var i=1-t.remainingLifetime/t.startLifetime,n=O6(this.x)?oe(t.randomSeed^_7):0,e=O6(this.y)?oe(156497^t.randomSeed):0,r=O6(this.z)?oe(984136^t.randomSeed):0,s=O6(this.speedModifier)?oe(t.randomSeed+_7):0,h=ir.set(m7,this.x.evaluate(i,n),this.y.evaluate(i,e),this.z.evaluate(i,r));this.TN&&ir.transformQuat(h,h,this.kN),ir.add(t.animatedVelocity,t.animatedVelocity,h),ir.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),ir.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,s))},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),i}(m6),A8=xo(b8.prototype,"_enable",[oa],(function(){return!1})),E8=xo(b8.prototype,"x",[g8,oa],(function(){return new A5})),k8=xo(b8.prototype,"y",[w8,oa],(function(){return new A5})),T8=xo(b8.prototype,"z",[_8,oa],(function(){return new A5})),S8=xo(b8.prototype,"speedModifier",[m8,oa],(function(){return new A5})),O8=xo(b8.prototype,"space",[p8,oa],(function(){return 1})),y8=b8))||y8),y7=t("Burst",(R8=Ko("cc.Burst"),I8=Ca(A5),R8((N8=function(){function t(){this._time=C8&&C8(),this._repeatCount=L8&&L8(),this.repeatInterval=F8&&F8(),this.count=P8&&P8(),this.CN=0,this.Id=0}var i=t.prototype;return i.update=function(t,i){if(0===this.CN&&(this.CN=this._repeatCount,this.Id=this._time),this.CN>0){var n=ve(t.time-t.startDelay.evaluate(0,1),t.duration)-i;n=n>0?n:0;var e=ve(t.time-t.startDelay.evaluate(0,1),t.duration);this.Id>=n&&this.Id<e&&(t.emit(this.count.evaluate(this.Id/t.duration,1),i-(e-this.Id)),this.Id+=this.repeatInterval,--this.CN)}},i.reset=function(){this.CN=0,this.Id=0},i.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},e(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this.Id=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this.CN=t}}]),t}(),C8=xo(N8.prototype,"_time",[oa],(function(){return 0})),L8=xo(N8.prototype,"_repeatCount",[oa],(function(){return 1})),F8=xo(N8.prototype,"repeatInterval",[oa],(function(){return 1})),P8=xo(N8.prototype,"count",[I8,oa],(function(){return new A5})),M8=N8))||M8)),b7=new ir(0,0,0),A7=[0,0,0],E7=new ir(.5,.5,.5),k7=(B8=Ko("cc.ShapeModule"),D8=Ca(F6),U8=aa("shapeType"),x8=Ca(F6),G8=Ca(P6),j8=Ca(B6),H8=Ca(A5),B8(($8=function(){function t(){this._enable=W8&&W8(),this._shapeType=z8&&z8(),this.emitFrom=X8&&X8(),this.alignToDirection=Y8&&Y8(),this.randomDirectionAmount=K8&&K8(),this.sphericalDirectionAmount=q8&&q8(),this.randomPositionAmount=Q8&&Q8(),this.radius=Z8&&Z8(),this.radiusThickness=J8&&J8(),this.arcMode=t7&&t7(),this.arcSpread=i7&&i7(),this.arcSpeed=n7&&n7(),this.length=e7&&e7(),this.boxThickness=r7&&r7(),this._position=s7&&s7(),this._rotation=h7&&h7(),this._scale=u7&&u7(),this._arc=o7&&o7(),this._angle=a7&&a7(),this.LN=new Kr,this.FN=new Cr,this.PN=null,this.BN=0,this.DN=0}var i=t.prototype;return i.onInit=function(t){this.PN=t,this.UN(),this.BN=this.PN.time},i.emit=function(t){switch(this.shapeType){case 0:R7(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case 1:I7(this.radius,this.radiusThickness,this.xN(),t.position,t.velocity);break;case 2:O7(this.emitFrom,this.radius,this.radiusThickness,this.xN(),this._angle,this.length,t.position,t.velocity);break;case 3:T7(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case 4:S7(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:X(this.shapeType+" shapeType is not supported by ShapeModule.")}if(this.randomPositionAmount>0&&(t.position.x+=he(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=he(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=he(-this.randomPositionAmount,this.randomPositionAmount)),ir.transformQuat(t.velocity,t.velocity,this.FN),ir.transformMat4(t.position,t.position,this.LN),this.sphericalDirectionAmount>0){var i=ir.normalize(b7,t.position);ir.lerp(t.velocity,t.velocity,i,this.sphericalDirectionAmount)}this.BN=this.PN.time},i.UN=function(){Cr.fromEuler(this.FN,this._rotation.x,this._rotation.y,this._rotation.z),Kr.fromRTS(this.LN,this.FN,this._position,this._scale)},i.xN=function(){if(0===this.arcMode)return he(0,this._arc);var t=this.DN+2*Math.PI*this.arcSpeed.evaluate(this.PN.time,1)*(this.PN.time-this.BN);switch(this.DN=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case 1:default:return ve(t,this._arc);case 2:return le(t,this._arc)}},e(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.UN()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.UN()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.UN()}},{key:"arc",get:function(){return ee(this._arc)},set:function(t){this._arc=ne(t)}},{key:"angle",get:function(){return Math.round(100*ee(this._angle))/100},set:function(t){this._angle=ne(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case 0:0===this.emitFrom&&(this.emitFrom=3);break;case 2:1===this.emitFrom&&(this.emitFrom=0);break;case 3:case 4:0!==this.emitFrom&&1!==this.emitFrom||(this.emitFrom=3)}}}]),t}(),W8=xo($8.prototype,"_enable",[oa],(function(){return!1})),z8=xo($8.prototype,"_shapeType",[D8,U8],(function(){return 2})),m($8.prototype,"shapeType",[x8],Object.getOwnPropertyDescriptor($8.prototype,"shapeType"),$8.prototype),X8=xo($8.prototype,"emitFrom",[G8,oa],(function(){return 3})),Y8=xo($8.prototype,"alignToDirection",[oa],(function(){return!1})),K8=xo($8.prototype,"randomDirectionAmount",[oa],(function(){return 0})),q8=xo($8.prototype,"sphericalDirectionAmount",[oa],(function(){return 0})),Q8=xo($8.prototype,"randomPositionAmount",[oa],(function(){return 0})),Z8=xo($8.prototype,"radius",[oa],(function(){return 1})),J8=xo($8.prototype,"radiusThickness",[oa],(function(){return 1})),t7=xo($8.prototype,"arcMode",[j8,oa],(function(){return 0})),i7=xo($8.prototype,"arcSpread",[oa],(function(){return 0})),n7=xo($8.prototype,"arcSpeed",[H8,oa],(function(){return new A5})),e7=xo($8.prototype,"length",[oa],(function(){return 5})),r7=xo($8.prototype,"boxThickness",[oa],(function(){return new ir(0,0,0)})),s7=xo($8.prototype,"_position",[oa],(function(){return new ir(0,0,0)})),h7=xo($8.prototype,"_rotation",[oa],(function(){return new ir(0,0,0)})),u7=xo($8.prototype,"_scale",[oa],(function(){return new ir(1,1,1)})),o7=xo($8.prototype,"_arc",[oa],(function(){return ne(360)})),a7=xo($8.prototype,"_angle",[oa],(function(){return ne(25)})),V8=$8))||V8);function T7(t,i,n,e,r){switch(t){case 3:E6(e,i*(1-n),i),ir.normalize(r,e);break;case 2:A6(e),ir.multiplyScalar(e,e,i),ir.normalize(r,e);break;default:X(t+" is not supported for sphere emitter.")}}function S7(t,i,n,e,r){switch(t){case 3:E6(e,i*(1-n),i),e.z>0&&(e.z*=-1),ir.normalize(r,e);break;case 2:A6(e),ir.multiplyScalar(e,e,i),e.z>0&&(e.z*=-1),ir.normalize(r,e);break;default:X(t+" is not supported for hemisphere emitter.")}}function O7(t,i,n,e,r,s,h,u){switch(t){case 0:k6(h,i*(1-n),i,e),ls.multiplyScalar(u,h,Math.sin(r)),u.z=-Math.cos(r)*i,ir.normalize(u,u),h.z=0;break;case 2:b6(h,e),ls.multiplyScalar(u,h,Math.sin(r)),u.z=-Math.cos(r),ir.normalize(u,u),ls.multiplyScalar(h,h,i),h.z=0;break;case 3:k6(h,i*(1-n),i,e),ls.multiplyScalar(u,h,Math.sin(r)),u.z=-Math.cos(r)*i,ir.normalize(u,u),h.z=0,ir.add(h,h,ir.multiplyScalar(b7,u,s*re()/-u.z));break;default:X(t+" is not supported for cone emitter.")}}function R7(t,i,n,e){switch(t){case 3:r=n,s=E7,ir.set(r,he(-s.x,s.x),he(-s.y,s.y),he(-s.z,s.z));break;case 2:A7[0]=he(-.5,.5),A7[1]=he(-.5,.5),A7[2]=.5*S6(),T6(A7),M7(A7,i),ir.set(n,A7[0],A7[1],A7[2]);break;case 1:A7[0]=he(-.5,.5),A7[1]=.5*S6(),A7[2]=.5*S6(),T6(A7),M7(A7,i),ir.set(n,A7[0],A7[1],A7[2]);break;default:X(t+" is not supported for box emitter.")}var r,s;ir.copy(e,p6)}function I7(t,i,n,e,r){k6(e,t*(1-i),t,n),ir.normalize(r,e)}function M7(t,i){i.x>0&&(t[0]+=.5*he(-i.x,i.x),t[0]=Jn(t[0],-.5,.5)),i.y>0&&(t[1]+=.5*he(-i.y,i.y),t[1]=Jn(t[1],-.5,.5)),i.z>0&&(t[2]+=.5*he(-i.z,i.z),t[2]=Jn(t[2],-.5,.5))}var N7=[0,0,1,0,0,1,1,1],C7=[0,0,0,1,0,0,0,1,0,1,1,0],L7=function(t){function i(){var i;return(i=t.call(this)||this).WR=void 0,i.GN=void 0,i.jN=void 0,i.HN=void 0,i.cN=void 0,i.fN=void 0,i.vN=void 0,i.lN=void 0,i.dN=void 0,i.dw=void 0,i.gN=0,i.wN=0,i.VN=0,i.$N=0,i.C_=null,i.WN=void 0,i.zN=void 0,i.XN=void 0,i.YN=void 0,i.KN=void 0,i._N=0,i.mN=0,i.type=4,i.WR=0,i.GN=16,i.jN=null,i.HN=0,i.cN=null,i.fN=0,i.vN=null,i.lN=null,i.WN=0,i.zN=0,i.XN=[],i.YN=null,Hg.gfxDevice.hasFeature(1)?i.KN=!0:i.KN=!1,i.dN=null,i.dw=null,i}s(i,t);var n=i.prototype;return n.setCapacity=function(t){var i=this.WR!==t;this.WR=t,this.GN=Math.max(this.WR,16),this.dN&&i&&this.qN()},n.setVertexAttributes=function(t,i){if(this.KN)this.QN(t,i);else{if(this.dw===t&&this.jN===i)return;this.dw=t,this.jN=i,this.HN=0;for(var n,e=d(this.jN);!(n=e()).done;){var r=n.value;r.offset=this.HN,this.HN+=tg[r.format].size}this.fN=this.HN/4,this.qN()}},n.QN=function(t,i){if(this.dw!==t||this.jN!==i){this.dw=t,this.jN=i,this.HN=0,this.WN=0;for(var n,e=d(this.jN);!(n=e()).done;){var r=n.value;0===r.stream?(r.offset=this.HN,this.HN+=tg[r.format].size):1===r.stream&&(r.offset=this.WN,this.WN+=tg[r.format].size)}this.fN=this.HN/4,this.zN=this.WN/4,this.qN()}},n.pN=function(){this.yN(),this.gN=4,this.wN=6,this.dw&&(this.gN=this.dw.struct.vertexBundles[this.dw.struct.primitives[0].vertexBundelIndices[0]].view.count,this.wN=this.dw.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new ud(10,3,this.HN*this.GN*this.gN,this.HN)),i=new ArrayBuffer(this.HN*this.GN*this.gN);if(this.dw&&this.WR>0){var n=this.jN[this.jN.findIndex((function(t){return"a_texCoord"===t.name}))].offset;this.dw.copyAttribute(0,"a_texCoord",i,this.HN,n);var e=this.jN.findIndex((function(t){return"a_texCoord3"===t.name}));if(n=this.jN[e++].offset,this.dw.copyAttribute(0,"a_position",i,this.HN,n),n=this.jN[e++].offset,this.dw.copyAttribute(0,"a_normal",i,this.HN,n),n=this.jN[e++].offset,!this.dw.copyAttribute(0,"a_color",i,this.HN,n))for(var r=new Uint32Array(i),s=0;s<this.gN;++s)r[s*this.fN+n/4]=cr.toUint32(cr.WHITE);for(var h=new Float32Array(i),u=1;u<this.WR;u++)h.copyWithin(u*this.HN*this.gN/4,0,this.HN*this.gN/4)}t.update(i);var o=new Uint16Array(this.GN*this.wN);if(this.dw&&this.WR>0){this.dw.copyIndices(0,o);for(var a=1;a<this.WR;a++)for(var c=0;c<this.wN;c++)o[a*this.wN+c]=o[c]+a*this.gN}else for(var f=0,v=0;v<this.WR;++v){var l=4*v;o[f++]=l,o[f++]=l+1,o[f++]=l+2,o[f++]=l+3,o[f++]=l+2,o[f++]=l+1}var d=this._device.createBuffer(new ud(6,1,this.GN*this.wN*2,2));return d.update(o),this._N=this.WR*this.gN,this.mN=this.WR*this.wN,this.dN=new qC([t],this.jN,7,d),this.initSubModel(0,this.dN,this.C_),i},n.ZN=function(){this.XN.length=0,this.yN();var t=this._device.createBuffer(new ud(10,3,this.HN*this.GN,this.HN)),i=new ArrayBuffer(this.HN*this.GN);return t.update(i),this.XN.push(t),i},n.JN=function(){this.gN=4,this.wN=6,this.dw&&(this.gN=this.dw.struct.vertexBundles[this.dw.struct.primitives[0].vertexBundelIndices[0]].view.count,this.wN=this.dw.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new ud(10,3,this.WN*this.gN,this.WN)),i=new ArrayBuffer(this.WN*this.gN);if(this.dw){var n=this.jN.findIndex((function(t){return"a_texCoord"===t.name})),e=this.jN[n].offset;if(this.dw.copyAttribute(0,"a_texCoord",i,this.WN,e),n=this.jN.findIndex((function(t){return"a_texCoord3"===t.name})),e=this.jN[n++].offset,this.dw.copyAttribute(0,"a_position",i,this.WN,e),e=this.jN[n++].offset,this.dw.copyAttribute(0,"a_normal",i,this.WN,e),e=this.jN[n++].offset,!this.dw.copyAttribute(0,"a_color",i,this.WN,e))for(var r=new Uint32Array(i),s=0;s<this.gN;++s)r[s*this.zN+e/4]=cr.toUint32(cr.WHITE)}else for(var h=new Float32Array(i),u=0;u<C7.length;++u)h[u]=C7[u];t.update(i);var o=new Uint16Array(this.wN);this.dw?this.dw.copyIndices(0,o):(o[0]=0,o[1]=1,o[2]=2,o[3]=3,o[4]=2,o[5]=1);var a=this._device.createBuffer(new ud(6,1,2*this.wN,2));a.update(o),this.YN=a,this._N=this.gN,this.mN=this.wN,this.XN.push(t)},n.tC=function(){this.dN=new qC(this.XN,this.jN,7,this.YN),this.initSubModel(0,this.dN,this.C_)},n.updateMaterial=function(t){this.C_=t,this.setSubModelMaterial(0,t)},n.addParticleVertexData=function(t,i){if(this.KN)this.iC(t,i);else if(this.dw)for(var n=0;n<this.gN;n++){var e=(t*this.gN+n)*this.fN;this.vN[e++]=i.position.x,this.vN[e++]=i.position.y,this.vN[e++]=i.position.z,e+=2,this.vN[e++]=i.texcoord.z,this.vN[e++]=i.size.x,this.vN[e++]=i.size.y,this.vN[e++]=i.size.z,this.vN[e++]=i.rotation.x,this.vN[e++]=i.rotation.y,this.vN[e++]=i.rotation.z,this.lN[e++]=i.color}else{var r=t*this.fN;this.vN[r++]=i.position.x,this.vN[r++]=i.position.y,this.vN[r++]=i.position.z,this.vN[r++]=i.texcoord.x,this.vN[r++]=i.texcoord.y,this.vN[r++]=i.texcoord.z,this.vN[r++]=i.size.x,this.vN[r++]=i.size.y,this.vN[r++]=i.size.z,this.vN[r++]=i.rotation.x,this.vN[r++]=i.rotation.y,this.vN[r++]=i.rotation.z,this.lN[r++]=i.color,i.velocity&&(this.vN[r++]=i.velocity.x,this.vN[r++]=i.velocity.y,this.vN[r++]=i.velocity.z)}},n.iC=function(t,i){var n=t*this.fN;this.dw?(this.vN[n++]=i.position.x,this.vN[n++]=i.position.y,this.vN[n++]=i.position.z,this.vN[n++]=i.texcoord.z,this.vN[n++]=i.size.x,this.vN[n++]=i.size.y,this.vN[n++]=i.size.z,this.vN[n++]=i.rotation.x,this.vN[n++]=i.rotation.y,this.vN[n++]=i.rotation.z,this.lN[n++]=i.color):(this.vN[n++]=i.position.x,this.vN[n++]=i.position.y,this.vN[n++]=i.position.z,this.vN[n++]=i.texcoord.z,this.vN[n++]=i.size.x,this.vN[n++]=i.size.y,this.vN[n++]=i.size.z,this.vN[n++]=i.rotation.x,this.vN[n++]=i.rotation.y,this.vN[n++]=i.rotation.z,this.lN[n++]=i.color,i.velocity&&(this.vN[n++]=i.velocity.x,this.vN[n++]=i.velocity.y,this.vN[n++]=i.velocity.z))},n.addGPUParticleVertexData=function(t,i,n){if(this.KN)this.nC(t,i,n);else for(var e=i*this.fN*this.gN,r=0;r<this.gN;r++){var s=e;this.vN[s++]=t.position.x,this.vN[s++]=t.position.y,this.vN[s++]=t.position.z,this.vN[s++]=n,this.vN[s++]=t.startSize.x,this.vN[s++]=t.startSize.y,this.vN[s++]=t.startSize.z,this.vN[s++]=N7[2*r],this.vN[s++]=t.rotation.x,this.vN[s++]=t.rotation.y,this.vN[s++]=t.rotation.z,this.vN[s++]=N7[2*r+1],this.vN[s++]=t.startColor.r/255,this.vN[s++]=t.startColor.g/255,this.vN[s++]=t.startColor.b/255,this.vN[s++]=t.startColor.a/255,this.vN[s++]=t.velocity.x,this.vN[s++]=t.velocity.y,this.vN[s++]=t.velocity.z,this.vN[s++]=t.startLifetime,this.vN[s++]=t.randomSeed,e+=this.fN}},n.nC=function(t,i,n){var e=i*this.fN,r=e;this.vN[r++]=t.position.x,this.vN[r++]=t.position.y,this.vN[r++]=t.position.z,this.vN[r++]=n,this.vN[r++]=t.startSize.x,this.vN[r++]=t.startSize.y,this.vN[r++]=t.startSize.z,this.vN[r++]=t.frameIndex,this.vN[r++]=t.rotation.x,this.vN[r++]=t.rotation.y,this.vN[r++]=t.rotation.z,this.vN[r++]=t.startColor.r/255,this.vN[r++]=t.startColor.g/255,this.vN[r++]=t.startColor.b/255,this.vN[r++]=t.startColor.a/255,this.vN[r++]=t.velocity.x,this.vN[r++]=t.velocity.y,this.vN[r++]=t.velocity.z,this.vN[r++]=t.startLifetime,this.vN[r++]=t.randomSeed,e+=this.fN},n.updateGPUParticles=function(t,i,n){if(this.KN)return this.eC(t,i,n);for(var e=this.fN*this.gN,r=0,s=0,h=0,u=0;u<t;++u)r=u*e,s=this.vN[r+this.VN],this.vN[r+this.$N]-(i-s)<n&&(h=--t*e,this.vN.copyWithin(r,h,h+e),u--);return t},n.eC=function(t,i,n){for(var e=this.fN,r=0,s=0,h=0,u=0;u<t;++u)r=u*e,s=this.vN[r+this.VN],this.vN[r+this.$N]-(i-s)<n&&(h=--t*e,this.vN.copyWithin(r,h,h+e),u--);return t},n.constructAttributeIndex=function(){if(this.jN){var t=this.jN.findIndex((function(t){return"a_position_starttime"===t.name})),i=this.jN[t].offset;this.VN=i/4+3,t=this.jN.findIndex((function(t){return"a_dir_life"===t.name})),i=this.jN[t].offset,this.$N=i/4+3}},n.updateIA=function(t){if(this.KN)this.rC(t);else{if(t<=0)return;var i=this._subModels[0].inputAssembler;i.vertexBuffers[0].update(this.vN),i.firstIndex=0,i.indexCount=this.wN*t,i.vertexCount=this._N}},n.rC=function(t){if(!(t<=0)){var i=this._subModels[0].inputAssembler;i.vertexBuffers[0].update(this.vN),i.instanceCount=t,i.firstIndex=0,i.indexCount=this.wN,i.instanceCount=t,i.vertexCount=this._N}},n.clear=function(){this.KN?this.sC():this._subModels[0].inputAssembler.indexCount=0},n.sC=function(){this._subModels[0].inputAssembler.instanceCount=0},n.destroy=function(){t.prototype.destroy.call(this),this.doDestroy()},n.doDestroy=function(){this.cN=null,this.vN=null,this.lN=null,this.XN=[],this.YN=null,this.jN=null,this.C_=null,this.dw=null,this.yN()},n.qN=function(){this.KN?this.hC():(this.cN=this.pN(),this.vN=new Float32Array(this.cN),this.lN=new Uint32Array(this.cN))},n.hC=function(){this.cN=this.ZN(),this.vN=new Float32Array(this.cN),this.lN=new Uint32Array(this.cN),this.JN(),this.tC()},n.yN=function(){this.dN&&(this.dN.destroy(),this.dN=null)},e(i,[{key:"useInstance",get:function(){return this.KN},set:function(t){this.KN!==t&&(this.KN=t)}}]),i}(jM),F7=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._useInstance=void 0,this._renderInfo=t,Hg.gfxDevice.hasFeature(1)?this._useInstance=!0:this._useInstance=!1}var i=t.prototype;return i.getUseInstance=function(){return this._useInstance},i.getInfo=function(){return this._renderInfo},i.onInit=function(t){this._particleSystem=t},i.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node)}},i.onDisable=function(){this.detachFromScene()},i.onDestroy=function(){this._model&&(k.director.root.destroyModel(this._model),this._model=null)},i.attachToScene=function(){var t;this._model&&(this._model.scene&&this.detachFromScene(),null==(t=this._particleSystem)||t._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.setVertexAttributes=function(){this._model&&(this.updateVertexAttrib(),this._model.setVertexAttributes(4===this._renderInfo.renderMode?this._renderInfo.mesh:null,this._vertAttrs))},i.clear=function(){this._model&&(this._model.enabled=!1)},i.getModel=function(){return this._model},i._initModel=function(){!this._model&&this._particleSystem&&(this._model=k.director.root.createModel(L7),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},i.updateTrailMaterial=function(){},i.getDefaultTrailMaterial=function(){return null},e(t,[{key:"model",get:function(){return this._model}}]),t}(),P7=function(){function t(t){this.uC=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.oC=new ir,this.aC=new ir,this.cC=0,this.fC=new ir,this.vC=new ir,this.lC=new ir,this.dC=0,this.gC=new ir,this.wC=new ir,this._C=new ls,t&&(this.uC=t)}var i=t.prototype;return i.noise=function(t,i,n,e,r){void 0===e&&(e=0),void 0===r&&(r=1);for(var s=new Array(512),h=0;h<256;h++)s[256+h]=s[h]=this.uC[h];var u=255&Math.floor(t),o=255&Math.floor(i),a=255&Math.floor(n);t-=Math.floor(t),i-=Math.floor(i),n-=Math.floor(n);var c=this.mC(t),f=this.mC(i),v=this.mC(n),l=s[u]+o,d=s[l]+a,g=s[l+1]+a,w=s[u+1]+o,_=s[w]+a,m=s[w+1]+a;return e+this.pC(this.yC(v,this.yC(f,this.yC(c,this.bC(s[d],t,i,n),this.bC(s[_],t-1,i,n)),this.yC(c,this.bC(s[g],t,i-1,n),this.bC(s[m],t-1,i-1,n))),this.yC(f,this.yC(c,this.bC(s[d+1],t,i,n-1),this.bC(s[_+1],t-1,i,n-1)),this.yC(c,this.bC(s[g+1],t,i-1,n-1),this.bC(s[m+1],t-1,i-1,n-1)))))*(r-e)},i.mC=function(t){return t*t*t*(t*(6*t-15)+10)},i.yC=function(t,i,n){return i+t*(n-i)},i.bC=function(t,i,n,e){var r=15&t,s=r<8?i:n,h=r<4?n:12===r||14===r?i:e;return(1&r?-s:s)+(2&r?-h:h)},i.pC=function(t){return(1+t)/2},i.setSpeed=function(t,i,n){this.aC.set(t,i,n)},i.setFrequency=function(t){this.cC=t},i.setAbs=function(t,i,n){this.fC.set(t,i,n)},i.setAmplititude=function(t,i,n){this.vC.set(t,i,n)},i.setOctaves=function(t,i,n){this.lC.set(t,i,n)},i.setTime=function(t){this.dC=t},i.setSamplePoint=function(t){this.gC.set(t)},i.getResult=function(){return this.wC},i.AC=function(t,i,n,e,r,s,h){var u=s,o=0;if(o+=this.noise(t*u,i*u,n*u,-1,1),1===h.x)return o;for(var a=1,c=1,f=1;f<h.x;++f)a*=h.y,u*=h.z,c+=a,o+=this.noise(t*u,i*u,n*u,-1,1)*a;return o/c},i.EC=function(t,i,n,e,r,s){t.x=this.AC(i.x,i.y,i.z,n,e,r,s),t.y=this.AC(i.y,i.z,i.x,n,e,r,s)},i.getNoiseParticle=function(){this.oC.set(this.aC.x*this.dC,this.aC.y*this.dC,this.aC.z*this.dC);var t=this.AC(this.gC.z+this.oC.x,this.gC.y,this.gC.x,this.dC,this.oC,this.cC,this.lC),i=this.AC(this.gC.x+1e3,this.gC.z+this.oC.y,this.gC.y,this.dC,this.oC,this.cC,this.lC),n=this.AC(this.gC.y,this.gC.x+1e3,this.gC.z+this.oC.z,this.dC,this.oC,this.cC,this.lC);this.wC.set(t*this.vC.x,i*this.vC.y,n*this.vC.z)},i.getPreview=function(t,i,n){for(var e=0;e<n;++e)for(var r=0;r<i;++r){var s=(r-.5*i)/i+this.aC.x*this.dC,h=(e-.5*n)/n+this.aC.y*this.dC,u=this.AC(s,h,0,this.dC,this.oC,this.cC,this.lC);t[e*i+r]=.5*(u+1)}},t}(),B7=new De,D7=nr(),U7=new Kr,x7=new Kr,G7=new Cr,j7=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_noiseModule"],H7=[0,0,1,0,0,1,1,1],V7="CC_USE_WORLD_SPACE",$7="CC_RENDER_MODE",W7="a_position",z7="a_normal",X7="a_color",Y7="a_color1",K7="a_texCoord",q7="a_texCoord1",Q7="a_texCoord2",Z7="a_texCoord3",J7="a_texCoord4";function t9(t,i,n,e,r,s){return void 0===n&&(n=!1),void 0===e&&(e=0),void 0===r&&(r=!1),void 0===s&&(s=0),new kd(t,i,n,e,r,s)}var i9=[t9(W7,32),t9(K7,32),t9(q7,32),t9(Q7,32),t9(X7,35,!0)],n9=[t9(W7,32),t9(K7,32),t9(q7,32),t9(Q7,32),t9(X7,35,!0),t9(Y7,32)],e9=[t9(W7,32),t9(K7,32),t9(q7,32),t9(Q7,32),t9(X7,35,!0),t9(Z7,32),t9(z7,32),t9(Y7,35,!0)],r9=[t9(J7,44,!1,0,!0),t9(q7,32,!1,0,!0),t9(Q7,32,!1,0,!0),t9(X7,35,!0,0,!0),t9(K7,32,!1,1)],s9=[t9(J7,44,!1,0,!0),t9(q7,32,!1,0,!0),t9(Q7,32,!1,0,!0),t9(X7,35,!0,0,!0),t9(Y7,32,!1,0,!0),t9(K7,32,!1,1)],h9=[t9(J7,44,!1,0,!0),t9(q7,32,!1,0,!0),t9(Q7,32,!1,0,!0),t9(X7,35,!0,0,!0),t9(K7,32,!1,1),t9(Z7,32,!1,1),t9(z7,32,!1,1),t9(Y7,35,!0,1)],u9={parent:null,owner:null,subModelIdx:0},o9=function(){this.position=void 0,this.texcoord=void 0,this.size=void 0,this.rotation=void 0,this.color=void 0,this.velocity=void 0,this.position=nr(),this.texcoord=nr(),this.size=nr(),this.rotation=nr(),this.color=0,this.velocity=null},a9=function(t){function i(i){var n;return(n=t.call(this,i)||this).kC=void 0,n.TC=void 0,n.SC=void 0,n.OC=void 0,n.RC=null,n.IC=void 0,n.MC=void 0,n.NC=null,n.CC=null,n.LC=new Map,n.FC=new Map,n.PC=[],n.BC=null,n.DC=0,n.xC=0,n.GC=0,n.jC=2,n.Sg=!1,n.HC=new Kr,n.VC=new De,n.$C=new P7,n._model=null,n.SC=new De(1,1,0,0),n.OC=n.SC.clone(),n.IC=nr(),n.MC=new o9,n.kC={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},n.TC={CC_USE_WORLD_SPACE:!0},n}s(i,t);var n=i.prototype;return n.onInit=function(i){var n=this;t.prototype.onInit.call(this,i),this.NC=new ou((function(){return new o6(n)}),16),this.WC(),this.zC(),this.XC(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this.Sg=!0},n.clear=function(){t.prototype.clear.call(this),this.NC.reset(),this._particleSystem&&this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1},n.updateRenderMode=function(){this.WC(),this.zC(),this.updateMaterialParams(),this.setVertexAttributes()},n.onDestroy=function(){var i;null==(i=this.NC)||i.destroy(),t.prototype.onDestroy.call(this)},n.getFreeParticle=function(){return this._particleSystem&&this.NC.length>=this._particleSystem.capacity?null:this.NC.add()},n.getDefaultTrailMaterial=function(){return this.CC},n.setNewParticle=function(){},n.XC=function(){var t=this;j7.forEach((function(i){if(t._particleSystem){var n=t._particleSystem[i];n&&n.enable&&(n.needUpdate&&t.LC.set(n.name,n),n.needAnimate&&t.FC.set(n.name,n))}})),this.PC.length=0;for(var i=0,n=w6.length;i<n;i++){var e=this.FC.get(w6[i]);e&&this.PC.push(e)}},n.enableModule=function(t,i,n){i?(n.needUpdate&&this.LC.set(n.name,n),n.needAnimate&&this.FC.set(n.name,n)):(this.FC.delete(t),this.LC.delete(t)),this.PC.length=0;for(var e=0,r=w6.length;e<r;e++){var s=this.FC.get(w6[e]);s&&this.PC.push(s)}this.updateMaterialParams()},n.updateAlignSpace=function(t){this.jC=t},n.getDefaultMaterial=function(){return this.RC},n.updateRotation=function(t){t&&this.YC(t)},n.YC=function(t){if(4===this._renderInfo.renderMode||2!==this.jC){var i;if(1===this.jC)null==(i=this._particleSystem)||i.node.getRotation(G7);else if(0===this.jC){var n;null==(n=this._particleSystem)||n.node.getWorldRotation(G7)}else if(2===this.jC){var e,r;G7.set(0,0,0,1);var s=null==(e=this._particleSystem)||null==(r=e.node.scene.renderScene)?void 0:r.cameras;if(void 0!==s)for(var h=0;h<(null==s?void 0:s.length);++h){var u=s[h];if((u.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){Cr.fromViewUp(G7,u.forward);break}}}else G7.set(0,0,0,1);t.setUniform(this.GC,G7)}},n.updateScale=function(t){t&&this.KC(t)},n.KC=function(t){var i,n,e,r=this.IC;switch(null==(i=this._particleSystem)?void 0:i.scaleSpace){case 1:null==(n=this._particleSystem)||n.node.getScale(r);break;case 0:null==(e=this._particleSystem)||e.node.getWorldScale(r)}t.setUniform(this.DC,B7.set(r.x,r.y,r.z))},n.updateParticles=function(t){var i=this,n=this._particleSystem;if(!n)return this.NC.length;n.node.getWorldMatrix(U7);var e=(n.getMaterialInstance(0)||this.RC).passes[0];this.KC(e),this.YC(e),this.LC.forEach((function(){}));var r=n._trailModule,s=r&&r.enable;s&&r.update();var h=!n.gravityModifier.isZero();if(h){if(1===n.simulationSpace){var u=n.node.getRotation();Kr.fromQuat(this.HC,u),this.HC.transpose()}if(n.node.parent){var o=n.node.parent.worldRotation;Kr.fromQuat(x7,o),x7.transpose()}}for(var a=function(e){var u=i.NC.data[e];if(u.remainingLifetime-=t,ir.set(u.animatedVelocity,0,0,0),u.remainingLifetime<0)return s&&r.removeParticle(u),i.NC.removeAt(e),--e,c=e,1;if(h){var o=O6(n.gravityModifier)?oe(u.randomSeed):0;if(1===n.simulationSpace){var a=1-u.remainingLifetime/u.startLifetime,f=9.8*-n.gravityModifier.evaluate(a,o)*t;i.VC.x=0,i.VC.y=f,i.VC.z=0,i.VC.w=1,Zn(f,0,qn)||(n.node.parent&&(i.VC=i.VC.transformMat4(x7)),i.VC=i.VC.transformMat4(i.HC),u.velocity.x+=i.VC.x,u.velocity.y+=i.VC.y,u.velocity.z+=i.VC.z)}else u.velocity.y-=9.8*n.gravityModifier.evaluate(1-u.remainingLifetime/u.startLifetime,o)*t}ir.copy(u.ultimateVelocity,u.velocity),i.PC.forEach((function(i){i.animate(u,t)})),ir.scaleAndAdd(u.position,u.position,u.ultimateVelocity,t),s&&r.animate(u,t),c=e},c=0;c<this.NC.length;++c)a(c);return this._model.enabled=this.NC.length>0,this.NC.length},n.getNoisePreview=function(t,i,n){var e=this;this.PC.forEach((function(r){r.name===g6&&r.getNoisePreview(t,e._particleSystem,i,n)}))},n.updateRenderData=function(){for(var t=0,i=0;i<this.NC.length;++i){var n=this.NC.data[i],e=0,r=this._particleSystem._textureAnimationModule;r&&r.enable&&(e=n.frameIndex),t=4*i,this.BC(n,t,e)}},n.beforeRender=function(){this._model.updateIA(this.NC.length)},n.getParticleCount=function(){return this.NC.length},n.onMaterialModified=function(t){this.Sg&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},n.onRebuildPSO=function(t,i){this._model&&0===t&&this._model.setSubModelMaterial(0,i);var n=this._particleSystem._trailModule,e=null==n?void 0:n.getModel();e&&1===t&&e.setSubModelMaterial(0,i)},n.zC=function(){4===this._renderInfo.renderMode?this.BC=this.qC:1===this._renderInfo.renderMode?this.BC=this.QC:this.BC=this.ZC},n.qC=function(t,i,n){var e=this.MC,r=i/4;ir.copy(e.position,t.position),D7.z=n,ir.copy(e.texcoord,D7),ir.copy(e.size,t.size),ir.copy(e.rotation,t.rotation),e.color=cr.toUint32(t.color),this._model.addParticleVertexData(r,e)},n.QC=function(t,i,n){var e=this.MC;if(this._useInstance)this.JC(t,i,n);else for(var r=0;r<4;++r)ir.copy(e.position,t.position),D7.x=H7[2*r],D7.y=H7[2*r+1],D7.z=n,ir.copy(e.texcoord,D7),ir.copy(e.size,t.size),ir.copy(e.rotation,t.rotation),e.color=cr.toUint32(t.color),e.velocity=t.ultimateVelocity,this._model.addParticleVertexData(i++,e)},n.JC=function(t,i,n){var e=this.MC,r=i/4;ir.copy(e.position,t.position),D7.z=n,ir.copy(e.texcoord,D7),ir.copy(e.size,t.size),ir.copy(e.rotation,t.rotation),e.color=cr.toUint32(t.color),e.velocity=t.ultimateVelocity,this._model.addParticleVertexData(r,e)},n.ZC=function(t,i,n){var e=this.MC;if(this._useInstance)this.tL(t,i,n);else for(var r=0;r<4;++r)ir.copy(e.position,t.position),D7.x=H7[2*r],D7.y=H7[2*r+1],D7.z=n,ir.copy(e.texcoord,D7),ir.copy(e.size,t.size),ir.copy(e.rotation,t.rotation),this.MC.color=cr.toUint32(t.color),this._model.addParticleVertexData(i++,e)},n.tL=function(t,i,n){var e=this.MC,r=i/4;ir.copy(e.position,t.position),D7.z=n,ir.copy(e.texcoord,D7),ir.copy(e.size,t.size),ir.copy(e.rotation,t.rotation),this.MC.color=cr.toUint32(t.color),this._model.addParticleVertexData(r,e)},n.updateVertexAttrib=function(){if(4===this._renderInfo.renderMode&&this._renderInfo.mesh){var t=this._renderInfo.mesh.readAttributeFormat(0,"a_color");if(t){for(var i=35,n=0;n<tg.length;++n)if(tg[n].name===t.name){i=n;break}this._vertAttrs[7]=t9(Y7,i,!0,this._useInstance?1:0)}else this._vertAttrs[7]=t9(Y7,35,!0,this._useInstance?1:0)}},n.WC=function(){if(this._useInstance)this.iL();else switch(this._renderInfo.renderMode){case 1:this._vertAttrs=n9.slice();break;case 4:this._vertAttrs=e9.slice();break;default:this._vertAttrs=i9.slice()}},n.iL=function(){switch(this._renderInfo.renderMode){case 1:this._vertAttrs=s9.slice();break;case 4:this._vertAttrs=h9.slice();break;default:this._vertAttrs=r9.slice()}},n.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,i=t.sharedMaterial;null!=i&&(this._renderInfo.mainTexture=i.getProperty("mainTexture",0)),null==t.sharedMaterial&&null==this.RC&&(u9.parent=uk.get("default-particle-material"),u9.owner=this._particleSystem,u9.subModelIdx=0,this.RC=new Hk(u9),u9.parent=null,u9.owner=null,u9.subModelIdx=0,null!==this._renderInfo.mainTexture&&this.RC.setProperty("mainTexture",this._renderInfo.mainTexture));var n=t.getMaterialInstance(0)||this.RC;0===t.simulationSpace?this.kC[V7]=!0:this.kC[V7]=!1;var e=n.passes[0];this.DC=e.getHandle("scale"),this.xC=e.getHandle("frameTile_velLenScale"),this.GC=e.getHandle("nodeRotation");var r=this._renderInfo.renderMode,s=this.SC;0===r?this.kC[$7]=0:1===r?(this.kC[$7]=1,s.z=this._renderInfo.velocityScale,s.w=this._renderInfo.lengthScale):2===r?this.kC[$7]=2:3===r?this.kC[$7]=3:4===r?this.kC[$7]=4:X("particle system renderMode "+r+" not support.");var h=t._textureAnimationModule;h&&h.enable?(De.copy(this.OC,s),ls.set(this.OC,h.numTilesX,h.numTilesY),e.setUniform(this.xC,this.OC)):e.setUniform(this.xC,s);var u,o=this._particleSystem._rotationOvertimeModule;u=!!o&&o.enable,this.kC.ROTATION_OVER_TIME_MODULE_ENABLE=u,this.kC.CC_INSTANCE_PARTICLE=this._useInstance,n.recompileShaders(this.kC),this._model&&this._model.updateMaterial(n)}},n.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,i=t._trailModule;if(i&&i.enable){0===t.simulationSpace||0===i.space?this.TC[V7]=!0:this.TC[V7]=!1;var n=t.getMaterialInstance(1);null===n&&null===this.CC&&(u9.parent=uk.get("default-trail-material"),u9.owner=this._particleSystem,u9.subModelIdx=1,this.CC=new Hk(u9),u9.parent=null,u9.owner=null,u9.subModelIdx=0),(n=n||this.CC).recompileShaders(this.TC),i.updateMaterial()}}},n.setUseInstance=function(t){this._useInstance!==t&&(this._useInstance=t,this._model&&(this._model.useInstance=t,this._model.doDestroy()),this.updateRenderMode())},i}(F7),c9=new De,f9=new Kr,v9=new De,l9=new Cr,d9=new Cr;new ir;var g9,w9,_9,m9,p9,y9,b9,A9,E9,k9,T9,S9,O9,R9,I9,M9,N9,C9,L9,F9,P9,B9=32,D9="CC_USE_WORLD_SPACE",U9="CC_RENDER_MODE",x9="a_position_starttime",G9="a_size_uv",j9="a_rotation_uv",H9="a_color",V9="a_dir_life",$9="a_rndSeed",W9="a_size_fid",z9="a_rotation",X9=[new kd(x9,44),new kd(G9,44),new kd(j9,44),new kd(H9,44),new kd(V9,44),new kd($9,11)],Y9=[new kd(x9,44),new kd(G9,44),new kd(j9,44),new kd(H9,44),new kd(V9,44),new kd($9,11),new kd("a_texCoord",32),new kd("a_texCoord3",32),new kd("a_normal",32),new kd("a_color1",35,!0)],K9=[new kd(x9,44,!1,0,!0),new kd(W9,44,!1,0,!0),new kd(z9,32,!1,0,!0),new kd(H9,44,!1,0,!0),new kd(V9,44,!1,0,!0),new kd($9,11,!1,0,!0),new kd("a_uv",32,!1,1)],q9=[new kd(x9,44,!1,0,!0),new kd(W9,44,!1,0,!0),new kd(z9,32,!1,0,!0),new kd(H9,44,!1,0,!0),new kd(V9,44,!1,0,!0),new kd($9,11,!1,0,!0),new kd("a_texCoord",32,!1,1),new kd("a_texCoord3",32,!1,1),new kd("a_normal",32,!1,1),new kd("a_color1",35,!0,1)],Q9={parent:null,owner:null,subModelIdx:0},Z9=function(t){function i(i){var n;return(n=t.call(this,i)||this).kC=void 0,n.SC=void 0,n.nL=void 0,n.OC=void 0,n.IC=void 0,n._vertAttrs=[],n._defaultMat=null,n.eL=0,n.rL=null,n.Pn=null,n.sL=null,n.hL=null,n.uL=null,n.oL=null,n.aL=null,n.cL=null,n.fL=null,n.vL=null,n.lL=null,n.dL=null,n.gL=null,n.wL=0,n._L=0,n.GC=0,n.jC=2,n.Sg=!1,n.SC=new De(1,1,0,0),n.nL=n.SC.clone(),n.OC=n.SC.clone(),n.IC=new ir,n.kC={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},n.rL=new o6(null),n.eL=0,n}s(i,t);var n=i.prototype;return n.onInit=function(i){t.prototype.onInit.call(this,i),this.WC(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this.Sg=!0},n.updateRenderMode=function(){this.WC(),this.updateMaterialParams(),this.setVertexAttributes()},n.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},n.clear=function(){t.prototype.clear.call(this),this.eL=0,this.updateRenderData()},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.sL&&this.sL.destroy(),this.hL&&this.hL.destroy(),this.Pn&&this.Pn.destroy(),this.oL&&this.oL.destroy(),this.uL&&this.uL.destroy(),this.aL&&this.aL.destroy(),this.fL=null,this.vL=null,this.cL=null,this.dL=null,this.lL=null,this.gL=null},n.enableModule=function(){var t,i=(null==(t=this._particleSystem)?void 0:t.getMaterialInstance(0))||this._defaultMat;i&&(this.initShaderUniform(i),i.recompileShaders(this.kC),this._model&&this._model.setSubModelMaterial(0,i))},n.getFreeParticle=function(){var t;return this._particleSystem&&this.eL>=(null==(t=this._particleSystem)?void 0:t.capacity)?null:this.rL},n.setNewParticle=function(t){this._particleSystem&&(this._model.addGPUParticleVertexData(t,this.eL,this._particleSystem.time),this.eL++)},n.getDefaultMaterial=function(){return this._defaultMat},n.updateRotation=function(t){t&&this.YC(t)},n.YC=function(t){if(4===this._renderInfo.renderMode||2!==this.jC){var i;if(1===this.jC)null==(i=this._particleSystem)||i.node.getRotation(d9);else if(0===this.jC){var n;null==(n=this._particleSystem)||n.node.getWorldRotation(d9)}else if(2===this.jC){var e,r;d9.set(0,0,0,1);var s=null==(e=this._particleSystem)||null==(r=e.node.scene.renderScene)?void 0:r.cameras;if(void 0!==s&&this._particleSystem)for(var h=0;h<(null==s?void 0:s.length);++h){var u=s[h];if((u.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){Cr.fromViewUp(d9,u.forward);break}}}else d9.set(0,0,0,1);t.setUniform(this.GC,d9)}},n.updateScale=function(t){t&&this.KC(t)},n.KC=function(t){var i,n=this.IC;switch(null==(i=this._particleSystem)?void 0:i.scaleSpace){case 1:this._particleSystem.node.getScale(n);break;case 0:this._particleSystem.node.getWorldScale(n)}t.setUniform(t.getHandle("scale"),c9.set(n.x,n.y,n.z))},n.updateParticles=function(t){return this._particleSystem?(this.eL=this._model.updateGPUParticles(this.eL,this._particleSystem.time,t),this.updateShaderUniform(t),this._model.enabled=this.eL>0,this.eL):this.eL},n.updateRenderData=function(){},n.beforeRender=function(){this._model.updateIA(this.eL)},n.updateAlignSpace=function(t){this.jC=t},n.updateShaderUniform=function(t){if(this._particleSystem){var i=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(i){var n=i.passes[0];v9.x=this._particleSystem.time,v9.y=t,n.setUniform(this.wL,v9),this._particleSystem.node.getWorldRotation(l9),n.setUniform(this._L,l9),this.YC(n)}}},n.initShaderUniform=function(t){var i,n,e,r,s,h,u=t.passes[0];this.wL=u.getHandle("u_timeDelta"),this._L=u.getHandle("u_worldRot"),this.GC=u.getHandle("nodeRotation"),this.KC(u),u.setUniform(u.getHandle("frameTile_velLenScale"),this.nL),v9.x=B9,v9.y=.03125,u.setUniform(u.getHandle("u_sampleInfo"),v9);var o=!1,a=null==(i=this._particleSystem)?void 0:i._forceOvertimeModule;if(o=!!a&&a.enable,this.kC.FORCE_OVER_TIME_MODULE_ENABLE=o,o){var c=M5(this.sL,this.fL,B9,a.x,a.y,a.z);this.sL=c.texture,this.fL=c.texdata;var f=u.getHandle("force_over_time_tex0"),v=$b(f);u.bindSampler(v,this.sL.getGFXSampler()),u.bindTexture(v,this.sL.getGFXTexture());var l=u.getHandle("u_force_space");u.setUniform(l,a.space);var d=u.getHandle("u_force_mode");u.setUniform(d,this.sL.height)}var g=null==(n=this._particleSystem)?void 0:n._velocityOvertimeModule;if(o=!!g&&g.enable,this.kC.VELOCITY_OVER_TIME_MODULE_ENABLE=o,o){var w=N5(this.hL,this.vL,B9,g.x,g.y,g.z,g.speedModifier);this.hL=w.texture,this.vL=w.texdata;var _=u.getHandle("velocity_over_time_tex0"),m=$b(_);u.bindSampler(m,this.hL.getGFXSampler()),u.bindTexture(m,this.hL.getGFXTexture());var p=u.getHandle("u_velocity_space");u.setUniform(p,g.space);var y=u.getHandle("u_velocity_mode");u.setUniform(y,this.hL.height)}var b=null==(e=this._particleSystem)?void 0:e._colorOverLifetimeModule;if(o=!!b&&b.enable,this.kC.COLOR_OVER_TIME_MODULE_ENABLE=o,o){var A=r6(this.Pn,this.cL,B9,b.color);this.Pn=A.texture,this.cL=A.texdata;var E=u.getHandle("color_over_time_tex0"),k=$b(E);u.bindSampler(k,this.Pn.getGFXSampler()),u.bindTexture(k,this.Pn.getGFXTexture());var T=u.getHandle("u_color_mode");u.setUniform(T,this.Pn.height)}var S,O=null==(r=this._particleSystem)?void 0:r._rotationOvertimeModule;if(o=!!O&&O.enable,this.kC.ROTATION_OVER_TIME_MODULE_ENABLE=o,o&&(S=O.separateAxes?M5(this.uL,this.lL,B9,O.x,O.y,O.z):O5(this.uL,this.lL,B9,O.z),this.uL=S.texture,this.lL=S.texdata,this.uL)){var R=u.getHandle("rotation_over_time_tex0"),I=$b(R);u.bindSampler(I,this.uL.getGFXSampler()),u.bindTexture(I,this.uL.getGFXTexture());var M=u.getHandle("u_rotation_mode");u.setUniform(M,this.uL.height)}var N,C=null==(s=this._particleSystem)?void 0:s._sizeOvertimeModule;if(o=!!C&&C.enable,this.kC.SIZE_OVER_TIME_MODULE_ENABLE=o,o&&(N=C.separateAxes?M5(this.oL,this.dL,B9,C.x,C.y,C.z,!0):R5(this.oL,this.dL,B9,C.size),this.oL=N.texture,this.dL=N.texdata,this.oL)){var L=u.getHandle("size_over_time_tex0"),F=$b(L);u.bindSampler(F,this.oL.getGFXSampler()),u.bindTexture(F,this.oL.getGFXTexture());var P=u.getHandle("u_size_mode");u.setUniform(P,this.oL.height)}var B=null==(h=this._particleSystem)?void 0:h._textureAnimationModule;if(o=!!B&&B.enable,this.kC.TEXTURE_ANIMATION_MODULE_ENABLE=o,o){var D=I5(this.aL,this.gL,B9,B.startFrame,B.frameOverTime);this.aL=D.texture,this.gL=D.texdata;var U=u.getHandle("texture_animation_tex0"),x=$b(U);u.bindSampler(x,this.aL.getGFXSampler()),u.bindTexture(x,this.aL.getGFXTexture());var G=u.getHandle("u_anim_info");v9.x=this.aL.height,v9.y=B.numTilesX*B.numTilesY,v9.z=B.cycleCount,u.setUniform(G,v9)}this.kC.USE_VK_SHADER=4===Hg.gfxDevice.gfxAPI,this.kC.CC_INSTANCE_PARTICLE=this._useInstance},n.getParticleCount=function(){return this.eL},n.onMaterialModified=function(){this.Sg&&this.updateMaterialParams()},n.onRebuildPSO=function(t,i){this._model&&0===t&&this._model.setSubModelMaterial(0,i)},n.updateVertexAttrib=function(){if(4===this._renderInfo.renderMode&&this._renderInfo.mesh){var t=this._renderInfo.mesh.readAttributeFormat(0,"a_color");if(t){for(var i=35,n=0;n<tg.length;++n)if(tg[n].name===t.name){i=n;break}this._vertAttrs[9]=new kd("a_color1",i,!0,this._useInstance?1:0)}else this._vertAttrs[9]=new kd("a_color1",35,!0,this._useInstance?1:0)}},n.WC=function(){if(this._useInstance)this.iL();else switch(this._renderInfo.renderMode){case 1:default:this._vertAttrs=X9.slice();break;case 4:this._vertAttrs=Y9.slice()}},n.iL=function(){switch(this._renderInfo.renderMode){case 1:default:this._vertAttrs=K9.slice();break;case 4:this._vertAttrs=q9.slice()}},n.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,i=t.sharedMaterial;null!==i&&(this._renderInfo.mainTexture=i.getProperty("mainTexture",0)),null==t.sharedMaterial&&null==this._defaultMat&&(Q9.parent=uk.get("default-particle-gpu-material"),Q9.owner=t,Q9.subModelIdx=0,this._defaultMat=new Hk(Q9),Q9.parent=null,Q9.owner=null,Q9.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var n=t.getMaterialInstance(0)||this._defaultMat;t.node.getWorldMatrix(f9),0===t.simulationSpace?this.kC[D9]=!0:this.kC[D9]=!1;var e=this._renderInfo.renderMode;0===e?this.kC[U9]=0:1===e?(this.kC[U9]=1,this.SC.z=this._renderInfo.velocityScale,this.SC.w=this._renderInfo.lengthScale):2===e?this.kC[U9]=2:3===e?this.kC[U9]=3:4===e?this.kC[U9]=4:X("particle system renderMode "+e+" not support.");var r=t._textureAnimationModule;r&&r.enable?(ls.set(this.SC,r.numTilesX,r.numTilesY),De.copy(this.nL,this.SC)):(this.OC.z=this.SC.z,this.OC.w=this.SC.w,De.copy(this.nL,this.OC)),this.initShaderUniform(n),n.recompileShaders(this.kC),this._model&&this._model.updateMaterial(n)}},n.setUseInstance=function(t){this._useInstance!==t&&(this._useInstance=t,this._model&&(this._model.useInstance=t,this._model.doDestroy()),this.updateRenderMode())},n.getNoisePreview=function(){},i}(F7);function J9(){var t=xC.root.device;return!!(t.capabilities.maxVertexTextureUnits>=8&&3&t.getFormatFeatures(44))||(k.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var ttt,itt,ntt,ett,rtt,stt,htt,utt,ott,att,ctt,ftt,vtt,ltt,dtt,gtt,wtt,_tt,mtt,ptt,ytt,btt,Att,Ett,ktt,Ttt,Stt,Ott,Rtt,Itt,Mtt,Ntt,Ctt,Ltt,Ftt,Ptt,Btt,Dtt,Utt,xtt,Gtt,jtt,Htt,Vtt,$tt,Wtt,ztt,Xtt,Ytt,Ktt,qtt,Qtt,Ztt,Jtt,tit,iit,nit,eit,rit,sit,hit,uit,oit,ait,cit,fit,vit,lit,dit,git,wit,_it,mit,pit,yit,bit,Ait,Eit,kit,Tit,Sit,Oit,Rit,Iit,Mit,Nit,Cit,Lit,Fit,Pit,Bit,Dit,Uit,xit,Git,jit,Hit,Vit,$it,Wit,zit,Xit,Yit,Kit,qit,Qit,Zit,Jit,tnt,int,nnt,ent,rnt,snt,hnt,unt,ont,ant,cnt,fnt,vnt,lnt,dnt,gnt,wnt,_nt,mnt,pnt,ynt,bnt,Ant,Ent,knt,Tnt,Snt,Ont,Rnt,Int,Mnt,Nnt,Cnt,Lnt,Fnt,Pnt,Bnt,Dnt=(g9=Ko("cc.ParticleSystemRenderer"),w9=Ca(L6),_9=Ca(L6),m9=Ca(yF),p9=Ca(Lk),y9=Ca(Lk),b9=Ca(Lk),A9=Ca(Lk),E9=Ca(C6),g9((P9=function(){function t(){this._renderMode=S9&&S9(),this._velocityScale=O9&&O9(),this._lengthScale=R9&&R9(),this._mesh=I9&&I9(),this._cpuMaterial=M9&&M9(),this._gpuMaterial=N9&&N9(),this._mainTexture=C9&&C9(),this._useGPU=L9&&L9(),this._alignSpace=F9&&F9(),this.vT=null}var i=t.prototype;return i.create=function(t){null===this.vT?this.vT=t:this.vT!==t&&ut(6033)},i.onInit=function(t){this.create(t);var i=this._useGPU&&J9();this.vT.processor?ut(6034):(this.vT.processor=i?new Z9(this):new a9(this),this.vT.processor.updateAlignSpace(this.alignSpace),this.vT.processor.onInit(t)),i?this.gpuMaterial=this.particleMaterial:(this.particleMaterial&&-1!==this.particleMaterial.effectName.indexOf("particle-gpu")&&(this.particleMaterial=null,st(6035)),this.cpuMaterial=this.particleMaterial)},i.mL=function(){if(this.vT){this.vT.processor&&(this.vT.processor.detachFromScene(),this.vT.processor.clear(),this.vT.processor=null);var t=this._useGPU&&J9();this.particleMaterial=t?this.gpuMaterial:this.cpuMaterial,this.vT.processor=t?new Z9(this):new a9(this),this.vT.processor.updateAlignSpace(this.alignSpace),this.vT.processor.onInit(this.vT),this.vT.processor.onEnable(),this.vT.bindModule()}},e(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this.vT&&this.vT.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this.vT&&this.vT.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this.vT&&this.vT.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this.vT&&this.vT.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this.vT?this.vT.getSharedMaterial(0):null},set:function(t){this.vT&&this.vT.setSharedMaterial(t,0)}},{key:"cpuMaterial",get:function(){return this._cpuMaterial},set:function(t){if(t){var i=t.effectName;if(-1===i.indexOf("particle")||-1!==i.indexOf("particle-gpu"))return void st(6035)}this._cpuMaterial=t,this.particleMaterial=this._cpuMaterial}},{key:"gpuMaterial",get:function(){return this._gpuMaterial},set:function(t){t&&-1===t.effectName.indexOf("particle-gpu")?st(6035):(this._gpuMaterial=t,this.particleMaterial=this._gpuMaterial)}},{key:"trailMaterial",get:function(){return this.vT?this.vT.getSharedMaterial(1):null},set:function(t){this.vT&&this.vT.setSharedMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(J9()?this._useGPU=t:this._useGPU=!1,this.mL())}},{key:"alignSpace",get:function(){return this._alignSpace},set:function(t){this._alignSpace=t,this.vT.processor.updateAlignSpace(this._alignSpace)}}]),t}(),P9.AlignmentSpace=C6,m((T9=P9).prototype,"renderMode",[w9],Object.getOwnPropertyDescriptor(T9.prototype,"renderMode"),T9.prototype),S9=xo(T9.prototype,"_renderMode",[_9,oa],(function(){return 0})),O9=xo(T9.prototype,"_velocityScale",[oa],(function(){return 1})),R9=xo(T9.prototype,"_lengthScale",[oa],(function(){return 1})),I9=xo(T9.prototype,"_mesh",[oa],(function(){return null})),m(T9.prototype,"mesh",[m9],Object.getOwnPropertyDescriptor(T9.prototype,"mesh"),T9.prototype),m(T9.prototype,"particleMaterial",[p9],Object.getOwnPropertyDescriptor(T9.prototype,"particleMaterial"),T9.prototype),m(T9.prototype,"cpuMaterial",[y9],Object.getOwnPropertyDescriptor(T9.prototype,"cpuMaterial"),T9.prototype),M9=xo(T9.prototype,"_cpuMaterial",[oa],(function(){return null})),m(T9.prototype,"gpuMaterial",[b9],Object.getOwnPropertyDescriptor(T9.prototype,"gpuMaterial"),T9.prototype),N9=xo(T9.prototype,"_gpuMaterial",[oa],(function(){return null})),m(T9.prototype,"trailMaterial",[A9],Object.getOwnPropertyDescriptor(T9.prototype,"trailMaterial"),T9.prototype),C9=xo(T9.prototype,"_mainTexture",[oa],(function(){return null})),L9=xo(T9.prototype,"_useGPU",[oa],(function(){return!1})),m(T9.prototype,"alignSpace",[E9],Object.getOwnPropertyDescriptor(T9.prototype,"alignSpace"),T9.prototype),F9=xo(T9.prototype,"_alignSpace",[oa],(function(){return 2})),k9=T9))||k9),Unt=Math.cos(ne(100)),xnt={position:new ir,velocity:new ir},Gnt=new Cr,jnt=new ir,Hnt=new ir,Vnt=new cr,$nt=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new ir,lifetime:0,width:0,velocity:new ir,direction:0,color:new cr})}var i=t.prototype;return i.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},i.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new ir,lifetime:0,width:0,velocity:new ir,direction:0,color:new cr}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},i.iterateElement=function(t,i,n,e){for(var r=this.start>=this.end?this.end+this.trailElements.length:this.end,s=this.start;s<r;s++)i(t,this.trailElements[s%this.trailElements.length],n,e)&&(this.start++,this.start%=this.trailElements.length);this.start===r&&(this.start=-1,this.end=-1)},i.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},i.clear=function(){this.start=-1,this.end=-1},t}(),Wnt=(ttt=Ko("cc.TrailModule"),itt=Ca(D6),ntt=Ca(A5),ett=Ca(M6),rtt=Ca(q6),stt=Ca(A5),htt=Ca(i6),utt=Ca(i6),ott=Ca(M6),ttt((ctt=function(){var t=i.prototype;function i(){this._enable=ftt&&ftt(),this.mode=vtt&&vtt(),this.lifeTime=ltt&&ltt(),this._minParticleDistance=dtt&&dtt(),this.existWithParticles=gtt&&gtt(),this.textureMode=wtt&&wtt(),this.widthFromParticle=_tt&&_tt(),this.widthRatio=mtt&&mtt(),this.colorFromParticle=ptt&&ptt(),this.colorOverTrail=ytt&&ytt(),this.colorOvertime=btt&&btt(),this._space=Att&&Att(),this._particleSystem=Ett&&Ett(),this.pL=0,this.aN=void 0,this.yL=0,this.bL=0,this.AL=0,this.EL=0,this.kL=null,this.TL=void 0,this.SL=null,this.dN=null,this.jN=void 0,this.OL=null,this.RL=null,this.IL=null,this.ML=!1,this.C_=null,this.NL=new Kr,this._N=0,this.mN=0,this.jN=[new kd("a_position",32),new kd("a_texCoord",44),new kd("a_texCoord1",32),new kd("a_color",35,!0)],this.aN=this.jN.reduce((function(t,i){return t+tg[i.format].size}),0),this.TL=new Map,this.Sg=!1}return t.getModel=function(){return this.SL},t.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var i=0,n=t.startLifetime.getMax(),e=t.rateOverTime.getMax(),r=t.duration,s=0,h=t.bursts.length;s<h;s++)i+=t.bursts[s].getMaxCount(t)*Math.ceil(n/r);this.lifeTime.getMax()<1&&st(6036),this.yL=Math.ceil(n*Math.ceil(this.lifeTime.getMax())*60*(e*r+i)),this.kL=new uu((function(){return new $nt(10)}),Math.ceil(e*r),(function(t){t.trailElements.length=0})),this._enable&&(this.enable=this._enable),this.Sg=!0},t.onEnable=function(){this._attachToScene()},t.onDisable=function(){this.TL.clear(),this._detachFromScene()},t._attachToScene=function(){this.SL&&(this.SL.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this.SL))},t._detachFromScene=function(){this.SL&&this.SL.scene&&this.SL.scene.removeModel(this.SL)},t.destroy=function(){this.yN(),this.SL&&(xC.root.destroyModel(this.SL),this.SL=null),this.kL&&(this.kL.destroy(),this.kL=null)},t.play=function(){this.SL&&this._enable&&(this.SL.enabled=!0)},t.clear=function(){if(this.enable){for(var t=this.TL.values(),i=t.next();!i.done;)i.value.clear(),i=t.next();this.TL.clear(),this.updateRenderData(),this.SL&&(this.SL.enabled=!1)}},t.updateMaterial=function(){this._particleSystem&&(this.C_=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor.getDefaultTrailMaterial(),this.SL&&this.SL.setSubModelMaterial(0,this.C_))},t.update=function(){this.bL=this.lifeTime.evaluate(this._particleSystem.time,1),0===this.space&&1===this._particleSystem.simulationSpace?(this.ML=!0,this._particleSystem.node.getWorldMatrix(this.NL),this._particleSystem.node.getWorldRotation(Gnt)):this.ML=!1},t.animate=function(t,i){if(this.kL)if(t.loopCount>t.lastLoop)t.trailDelay>1?(t.lastLoop=t.loopCount,t.trailDelay=0):t.trailDelay++;else{var n=this.TL.get(t);if(!n)return n=this.kL.alloc(),void this.TL.set(t,n);var e=n.getElement(n.end-1);if(this.ML?ir.transformMat4(jnt,t.position,this.NL):ir.copy(jnt,t.position),!(e&&(n.iterateElement(this,this.CL,t,i),ir.squaredDistance(e.position,jnt)<this.pL))&&(e=n.addElement())){ir.copy(e.position,jnt),e.lifetime=0,this.widthFromParticle?e.width=t.size.x*this.widthRatio.evaluate(0,1):e.width=this.widthRatio.evaluate(0,1);var r=n.count();if(2===r){var s=n.getElement(n.end-2);ir.subtract(s.velocity,e.position,s.position)}else if(r>2){var h=n.getElement(n.end-2),u=n.getElement(n.end-3);ir.subtract(jnt,u.position,h.position),ir.subtract(Hnt,e.position,h.position),ir.subtract(h.velocity,Hnt,jnt),ir.equals(ir.ZERO,h.velocity)&&ir.copy(h.velocity,jnt),ir.normalize(h.velocity,h.velocity),this.LL(h,u)}this.colorFromParticle?e.color.set(t.color):e.color.set(this.colorOvertime.evaluate(0,1))}}},t.removeParticle=function(t){var i=this.TL.get(t);i&&this.kL&&(i.clear(),this.kL.free(i),this.TL.delete(t))},t.updateRenderData=function(){this.AL=0,this.EL=0;for(var t,i=d(this.TL.keys());!(t=i()).done;){var n=t.value,e=this.TL.get(n);if(-1!==e.start){var r=4*this.AL/this.aN,s=e.start>=e.end?e.end+e.trailElements.length:e.end,h=s-e.start,u=1/h,o=e.trailElements[e.start];this.FL(o,this.colorOverTrail.evaluate(1,1),r,1,0,4);for(var a=e.start+1;a<s;a++){var c=e.trailElements[a%e.trailElements.length],f=a-e.start;this.FL(c,this.colorOverTrail.evaluate(1-f/h,1),r,1-f*u,f,5)}this.ML?ir.transformMat4(xnt.position,n.position,this.NL):ir.copy(xnt.position,n.position);var v=this.SL;if(v&&v.node.invalidateChildren(1),1===h||2===h){var l=e.getElement(e.end-1);ir.subtract(l.velocity,xnt.position,l.position);var g=this.OL,w=this.AL,_=this.aN/4,m=l.velocity;g[w-_-4]=m.x,g[w-_-3]=m.y,g[w-_-2]=m.z,g[w-4]=m.x,g[w-3]=m.y,g[w-2]=m.z,ir.subtract(xnt.velocity,xnt.position,l.position),this.LL(xnt,l)}else if(h>2){var p=e.getElement(e.end-1),y=e.getElement(e.end-2);ir.subtract(jnt,y.position,p.position),ir.subtract(Hnt,xnt.position,p.position),ir.normalize(jnt,jnt),ir.normalize(Hnt,Hnt),ir.subtract(p.velocity,Hnt,jnt),ir.normalize(p.velocity,p.velocity),this.LL(p,y),this.AL-=this.aN/4*2,this.EL-=6,this.FL(p,this.colorOverTrail.evaluate(u,1),r,u,h-1,5),ir.subtract(xnt.velocity,xnt.position,p.position),ir.normalize(xnt.velocity,xnt.velocity),this.LL(xnt,p)}this.widthFromParticle?xnt.width=n.size.x*this.widthRatio.evaluate(0,1):xnt.width=this.widthRatio.evaluate(0,1),xnt.color=n.color,ir.equals(xnt.velocity,ir.ZERO)?this.EL-=3:this.FL(xnt,this.colorOverTrail.evaluate(0,1),r,0,h,1)}}this.SL&&(this.SL.enabled=this.EL>0)},t.updateIA=function(t){var i=this.SL&&this.SL.subModels;if(i&&i.length>0){var n=i[0];n.inputAssembler.vertexBuffers[0].update(this.OL),n.inputAssembler.indexBuffer.update(this.IL),n.inputAssembler.firstIndex=0,n.inputAssembler.indexCount=t,n.inputAssembler.vertexCount=this._N}},t.beforeRender=function(){this.updateIA(this.EL)},t.PL=function(){this.SL||(this.SL=k.director.root.createModel(jM))},t.qN=function(){var t=this,i=xC.root.device,n=i.createBuffer(new ud(10,3,t.aN*(t.yL+1)*2,t.aN)),e=new ArrayBuffer(t.aN*(t.yL+1)*2);t.OL=new Float32Array(e),t.RL=new Uint32Array(e),n.update(e);var r=i.createBuffer(new ud(6,3,12*Math.max(1,t.yL),2));t.IL=new Uint16Array(6*Math.max(1,t.yL)),r.update(t.IL),t._N=2*(t.yL+1),t.mN=6*t.yL,t.dN=new qC([n],t.jN,7,r);var s=t.SL;s&&t.C_&&(s.node=s.transform=t._particleSystem.node,s.visFlags=t._particleSystem.visibility,s.initSubModel(0,t.dN,t.C_),s.enabled=!0)},t.CL=function(t,i,n,e){return i.lifetime+=e,t.colorFromParticle?(i.color.set(n.color),i.color.multiply(t.colorOvertime.evaluate(1-n.remainingLifetime/n.startLifetime,1))):i.color.set(t.colorOvertime.evaluate(1-n.remainingLifetime/n.startLifetime,1)),t.widthFromParticle?i.width=n.size.x*t.widthRatio.evaluate(i.lifetime/t.bL,1):i.width=t.widthRatio.evaluate(i.lifetime/t.bL,1),i.lifetime>t.bL},t.FL=function(t,i,n,e,r,s){this.OL[this.AL++]=t.position.x,this.OL[this.AL++]=t.position.y,this.OL[this.AL++]=t.position.z,this.OL[this.AL++]=t.direction,this.OL[this.AL++]=t.width,this.OL[this.AL++]=e,this.OL[this.AL++]=0,this.OL[this.AL++]=t.velocity.x,this.OL[this.AL++]=t.velocity.y,this.OL[this.AL++]=t.velocity.z,Vnt.set(t.color),Vnt.multiply(i),this.RL[this.AL++]=cr.toUint32(Vnt),this.OL[this.AL++]=t.position.x,this.OL[this.AL++]=t.position.y,this.OL[this.AL++]=t.position.z,this.OL[this.AL++]=1-t.direction,this.OL[this.AL++]=t.width,this.OL[this.AL++]=e,this.OL[this.AL++]=1,this.OL[this.AL++]=t.velocity.x,this.OL[this.AL++]=t.velocity.y,this.OL[this.AL++]=t.velocity.z,this.RL[this.AL++]=cr.toUint32(Vnt),1&s&&(this.IL[this.EL++]=n+2*r,this.IL[this.EL++]=n+2*r-1,this.IL[this.EL++]=n+2*r+1),4&s&&(this.IL[this.EL++]=n+2*r,this.IL[this.EL++]=n+2*r+1,this.IL[this.EL++]=n+2*r+2)},t.LL=function(t,i){ir.dot(t.velocity,i.velocity)<Unt?t.direction=1-i.direction:t.direction=i.direction},t.yN=function(){this.dN&&(this.dN.destroy(),this.dN=null)},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this.SL||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this.SL&&(this.PL(),this.qN()),this._enable=t,this.SL&&(this.SL.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this.pL=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t;var i=this._particleSystem;i&&i.processor&&i.processor.updateTrailMaterial()}},{key:"inited",get:function(){return this.Sg}}]),i}(),ftt=xo(ctt.prototype,"_enable",[oa],(function(){return!1})),vtt=xo(ctt.prototype,"mode",[itt,oa],(function(){return 0})),ltt=xo(ctt.prototype,"lifeTime",[ntt,oa],(function(){return new A5})),dtt=xo(ctt.prototype,"_minParticleDistance",[oa],(function(){return.1})),m(ctt.prototype,"space",[ett],Object.getOwnPropertyDescriptor(ctt.prototype,"space"),ctt.prototype),gtt=xo(ctt.prototype,"existWithParticles",[oa],(function(){return!0})),wtt=xo(ctt.prototype,"textureMode",[rtt,oa],(function(){return 0})),_tt=xo(ctt.prototype,"widthFromParticle",[oa],(function(){return!0})),mtt=xo(ctt.prototype,"widthRatio",[stt,oa],(function(){return new A5})),ptt=xo(ctt.prototype,"colorFromParticle",[oa],(function(){return!1})),ytt=xo(ctt.prototype,"colorOverTrail",[htt,oa],(function(){return new i6})),btt=xo(ctt.prototype,"colorOvertime",[utt,oa],(function(){return new i6})),Att=xo(ctt.prototype,"_space",[ott],(function(){return 0})),Ett=xo(ctt.prototype,"_particleSystem",[oa],(function(){return null})),att=ctt))||att),znt=new Kr,Xnt=new Kr,Ynt=new Cr,Knt=new ir,qnt=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],Qnt=function(){function t(t){this.vT=void 0,this.BL=void 0,this.ds=void 0,this.DL=void 0,this.LC=new Map,this.FC=new Map,this.PC=[],this.HC=new Kr,this.VC=new De,this.minPos=new ir,this.maxPos=new ir,this.UL=new ir,this.xL=new ir,this.vT=t,this.BL=this.vT.processor,this.ds=t.node,this.DL=[],this.XC()}var i=t.prototype;return i.GL=function(){this.xL.set(this.maxPos.x-this.minPos.x,this.maxPos.y-this.minPos.y,this.maxPos.z-this.minPos.z),this.UL.set(this.minPos.x+.5*this.xL.x,this.minPos.y+.5*this.xL.y,this.minPos.z+.5*this.xL.z)},i.setBoundingBoxSize=function(t){this.maxPos.x=this.UL.x+t.x,this.maxPos.y=this.UL.y+t.y,this.maxPos.z=this.UL.z+t.z,this.minPos.x=this.UL.x-t.x,this.minPos.y=this.UL.y-t.y,this.minPos.z=this.UL.z-t.z,this.GL()},i.setBoundingBoxCenter=function(t,i,n){this.maxPos.x=t+.5*this.xL.x,this.maxPos.y=i+.5*this.xL.y,this.maxPos.z=n+.5*this.xL.z,this.minPos.x=t-.5*this.xL.x,this.minPos.y=i-.5*this.xL.y,this.minPos.z=n-.5*this.xL.z,this.GL()},i.XC=function(){var t=this;qnt.forEach((function(i){var n=t.vT[i];n&&n.enable&&(n.needUpdate&&t.LC.set(n.name,n),n.needAnimate&&t.FC.set(n.name,n))})),this.PC.length=0;for(var i=0,n=w6.length;i<n;i++){var e=this.FC.get(w6[i]);e&&this.PC.push(e)}},i.tT=function(t,i,n){var e=this.vT,r=this.ds,s=e.time%e.duration/e.duration;r.invalidateChildren(1),0===e.simulationSpace&&(r.getWorldMatrix(znt),r.getWorldRotation(Ynt));for(var h=0;h<t;++h){var u=new o6(e);u.particleSystem=e,u.reset();var o=oe(ue(0,R));e._shapeModule&&e._shapeModule.enable?e._shapeModule.emit(u):(ir.set(u.position,0,0,0),ir.copy(u.velocity,p6)),e._textureAnimationModule&&e._textureAnimationModule.enable&&e._textureAnimationModule.init(u);var a=e.startSpeed.evaluate(s,o);ir.multiplyScalar(u.velocity,u.velocity,a),0===e.simulationSpace&&(ir.transformMat4(u.position,u.position,znt),ir.transformQuat(u.velocity,u.velocity,Ynt)),ir.copy(u.ultimateVelocity,u.velocity),ir.set(u.rotation,0,0,0),e.startSize3D?ir.set(u.startSize,e.startSizeX.evaluate(s,o),e.startSizeY.evaluate(s,o),e.startSizeZ.evaluate(s,o)):(ir.set(u.startSize,e.startSizeX.evaluate(s,o),1,1),u.startSize.y=u.startSize.x),ir.copy(u.size,u.startSize),u.startLifetime=e.startLifetime.evaluate(s,o)+i,u.remainingLifetime=u.startLifetime,n.push(u)}},i.jL=function(t,i){var n=this,e=this.vT;switch(e.node.getWorldMatrix(znt),e.scaleSpace){case 1:e.node.getScale(Knt);break;case 0:e.node.getWorldScale(Knt)}if(this.LC.forEach((function(){})),1===e.simulationSpace){var r=e.node.getRotation();Kr.fromQuat(this.HC,r),this.HC.transpose()}e.node.parent&&(e.node.parent.getWorldMatrix(Xnt),Xnt.invert());for(var s=function(){var r=i[h];if(r.remainingLifetime-=t,ir.set(r.animatedVelocity,0,0,0),e.gravityModifier.mode!==b5.Constant||0!==e.gravityModifier.constant){var s=O6(e.gravityModifier)?oe(r.randomSeed):0;if(1===e.simulationSpace){var u=9.8*-e.gravityModifier.evaluate(1-r.remainingLifetime/r.startLifetime,s)*t;n.VC.x=0,n.VC.y=u,n.VC.z=0,n.VC.w=1,Zn(u,0,qn)||(e.node.parent&&(n.VC=n.VC.transformMat4(Xnt)),n.VC=n.VC.transformMat4(n.HC),r.velocity.x+=n.VC.x,r.velocity.y+=n.VC.y,r.velocity.z+=n.VC.z)}else r.velocity.y-=9.8*e.gravityModifier.evaluate(1-r.remainingLifetime/r.startLifetime,s)*t}ir.copy(r.ultimateVelocity,r.velocity),n.PC.forEach((function(i){i.animate(r,t)})),ir.scaleAndAdd(r.position,r.position,r.ultimateVelocity,t)},h=0;h<i.length;++h)s()},i.HL=function(t){var i=new ir,n=new ir,e=new ir,r=new ir,s=new ir(1,1,1);if(4===this.BL.getInfo().renderMode){var h=this.BL.getInfo().mesh;if(h&&h.struct.minPosition&&h.struct.maxPosition){var u=new wo;wo.fromPoints(u,h.struct.minPosition,h.struct.maxPosition);var o=Math.max(u.halfExtents.x,u.halfExtents.y,u.halfExtents.z);s.set(o,o,o)}}for(var a=this.vT.node.worldMatrix,c=0;c<this.DL.length;++c){var f=this.DL[c];ir.multiply(i,Knt,f.size),ir.multiply(i,i,s),n.set(f.position),0!==this.vT.simulationSpace&&ir.transformMat4(n,n,a),t&&0===c?(ir.subtract(this.minPos,n,i),ir.add(this.maxPos,n,i)):(ir.subtract(e,n,i),ir.add(r,n,i),ir.min(this.minPos,this.minPos,e),ir.max(this.maxPos,this.maxPos,r))}},i.calculatePositions=function(){this.tT(this.vT.capacity,0,this.DL);var t=O6(this.vT.startLifetime)?oe(ue(0,R)):0;this.jL(0,this.DL),this.HL(!0),this.jL(this.vT.startLifetime.evaluate(0,t),this.DL),this.HL(!1),this.GL()},i.clear=function(){this.DL.length=0},i.destroy=function(){},t}(),Znt=oa,Jnt=Ca,tet=(ktt=Ko("cc.NoiseModule"),Ttt=Jnt(fn),Stt=Jnt(fn),Ott=Jnt(fn),Rtt=Jnt(fn),Itt=Jnt(fn),Mtt=Jnt(fn),Ntt=Jnt(fn),Ctt=Jnt(fn),Ltt=Jnt(fn),Ftt=Jnt(fn),Ptt=Jnt(cn),Btt=Jnt(fn),Dtt=Jnt(fn),ktt((xtt=function(t){function i(){var i;return(i=t.call(this)||this)._enable=Gtt&&Gtt(),i._strengthX=jtt&&jtt(),i._strengthY=Htt&&Htt(),i._strengthZ=Vtt&&Vtt(),i._noiseSpeedX=$tt&&$tt(),i._noiseSpeedY=Wtt&&Wtt(),i._noiseSpeedZ=ztt&&ztt(),i._noiseFrequency=Xtt&&Xtt(),i._remapX=Ytt&&Ytt(),i._remapY=Ktt&&Ktt(),i._remapZ=qtt&&qtt(),i._octaves=Qtt&&Qtt(),i._octaveMultiplier=Ztt&&Ztt(),i._octaveScale=Jtt&&Jtt(),i.name=g6,i.$C=new P7,i.VL=new ir,i}s(i,t);var n=i.prototype;return n.animate=function(t,i){this.$C.setTime(t.particleSystem.time),this.$C.setSpeed(this.noiseSpeedX,this.noiseSpeedY,this.noiseSpeedZ),this.$C.setFrequency(this.noiseFrequency),this.$C.setAbs(this.remapX,this.remapY,this.remapZ),this.$C.setAmplititude(this.strengthX,this.strengthY,this.strengthZ),this.$C.setOctaves(this.octaves,this.octaveMultiplier,this.octaveScale),this.VL.set(t.position),this.VL.add3f(1*re(),1*re(),1*re()),this.$C.setSamplePoint(this.VL),this.$C.getNoiseParticle();var n=this.$C.getResult();n.multiply3f(re(),re(),re()),ir.add(t.position,t.position,n.multiplyScalar(i))},n.getNoisePreview=function(t,i,n,e){this.$C.setTime(i.time),this.$C.setSpeed(this.noiseSpeedX,this.noiseSpeedY,this.noiseSpeedZ),this.$C.setFrequency(this.noiseFrequency),this.$C.setAbs(this.remapX,this.remapY,this.remapZ),this.$C.setAmplititude(this.strengthX,this.strengthY,this.strengthZ),this.$C.setOctaves(this.octaves,this.octaveMultiplier,this.octaveScale),this.$C.getNoiseParticle(),this.$C.getPreview(t,n,e)},e(i,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"strengthX",get:function(){return this._strengthX},set:function(t){this._strengthX=t}},{key:"strengthY",get:function(){return this._strengthY},set:function(t){this._strengthY=t}},{key:"strengthZ",get:function(){return this._strengthZ},set:function(t){this._strengthZ=t}},{key:"noiseSpeedX",get:function(){return this._noiseSpeedX},set:function(t){this._noiseSpeedX=t}},{key:"noiseSpeedY",get:function(){return this._noiseSpeedY},set:function(t){this._noiseSpeedY=t}},{key:"noiseSpeedZ",get:function(){return this._noiseSpeedZ},set:function(t){this._noiseSpeedZ=t}},{key:"noiseFrequency",get:function(){return this._noiseFrequency},set:function(t){this._noiseFrequency=t}},{key:"remapX",get:function(){return this._remapX},set:function(t){this._remapX=t}},{key:"remapY",get:function(){return this._remapY},set:function(t){this._remapY=t}},{key:"remapZ",get:function(){return this._remapZ},set:function(t){this._remapZ=t}},{key:"octaves",get:function(){return this._octaves},set:function(t){this._octaves=t}},{key:"octaveMultiplier",get:function(){return this._octaveMultiplier},set:function(t){this._octaveMultiplier=t}},{key:"octaveScale",get:function(){return this._octaveScale},set:function(t){this._octaveScale=t}}]),i}(m6),Gtt=xo(xtt.prototype,"_enable",[Znt],(function(){return!1})),m(xtt.prototype,"strengthX",[Ttt],Object.getOwnPropertyDescriptor(xtt.prototype,"strengthX"),xtt.prototype),jtt=xo(xtt.prototype,"_strengthX",[Znt],(function(){return 10})),m(xtt.prototype,"strengthY",[Stt],Object.getOwnPropertyDescriptor(xtt.prototype,"strengthY"),xtt.prototype),Htt=xo(xtt.prototype,"_strengthY",[Znt],(function(){return 10})),m(xtt.prototype,"strengthZ",[Ott],Object.getOwnPropertyDescriptor(xtt.prototype,"strengthZ"),xtt.prototype),Vtt=xo(xtt.prototype,"_strengthZ",[Znt],(function(){return 10})),m(xtt.prototype,"noiseSpeedX",[Rtt],Object.getOwnPropertyDescriptor(xtt.prototype,"noiseSpeedX"),xtt.prototype),$tt=xo(xtt.prototype,"_noiseSpeedX",[Znt],(function(){return 0})),m(xtt.prototype,"noiseSpeedY",[Itt],Object.getOwnPropertyDescriptor(xtt.prototype,"noiseSpeedY"),xtt.prototype),Wtt=xo(xtt.prototype,"_noiseSpeedY",[Znt],(function(){return 0})),m(xtt.prototype,"noiseSpeedZ",[Mtt],Object.getOwnPropertyDescriptor(xtt.prototype,"noiseSpeedZ"),xtt.prototype),ztt=xo(xtt.prototype,"_noiseSpeedZ",[Znt],(function(){return 0})),m(xtt.prototype,"noiseFrequency",[Ntt],Object.getOwnPropertyDescriptor(xtt.prototype,"noiseFrequency"),xtt.prototype),Xtt=xo(xtt.prototype,"_noiseFrequency",[Znt],(function(){return 1})),m(xtt.prototype,"remapX",[Ctt],Object.getOwnPropertyDescriptor(xtt.prototype,"remapX"),xtt.prototype),Ytt=xo(xtt.prototype,"_remapX",[Znt],(function(){return 0})),m(xtt.prototype,"remapY",[Ltt],Object.getOwnPropertyDescriptor(xtt.prototype,"remapY"),xtt.prototype),Ktt=xo(xtt.prototype,"_remapY",[Znt],(function(){return 0})),m(xtt.prototype,"remapZ",[Ftt],Object.getOwnPropertyDescriptor(xtt.prototype,"remapZ"),xtt.prototype),qtt=xo(xtt.prototype,"_remapZ",[Znt],(function(){return 0})),m(xtt.prototype,"octaves",[Ptt],Object.getOwnPropertyDescriptor(xtt.prototype,"octaves"),xtt.prototype),Qtt=xo(xtt.prototype,"_octaves",[Znt],(function(){return 1})),m(xtt.prototype,"octaveMultiplier",[Btt],Object.getOwnPropertyDescriptor(xtt.prototype,"octaveMultiplier"),xtt.prototype),Ztt=xo(xtt.prototype,"_octaveMultiplier",[Znt],(function(){return.5})),m(xtt.prototype,"octaveScale",[Dtt],Object.getOwnPropertyDescriptor(xtt.prototype,"octaveScale"),xtt.prototype),Jtt=xo(xtt.prototype,"_octaveScale",[Znt],(function(){return 2})),Utt=xtt))||Utt),iet=new Kr,net=new Cr,eet=Object.getOwnPropertyDescriptor(dD.prototype,"sharedMaterials"),ret=(tit=Ko("cc.ParticleSystem"),iit=Qo(99),nit=Ca(i6),eit=Ca(M6),rit=aa("startSize"),sit=Ca(A5),hit=Ca(A5),uit=Ca(A5),oit=Ca(A5),ait=Ca(A5),cit=Ca(A5),fit=Ca(A5),vit=aa("startRotation"),lit=Ca(A5),dit=Ca(A5),git=Ca(M6),wit=Ca(A5),_it=Ca(A5),mit=Ca(A5),pit=Ca([y7]),yit=Ca(vn),bit=Ca(N6),Ait=Ca(fn),Eit=Ca(fn),kit=Ca(fn),Tit=aa("enableCulling"),Sit=Ca(I6),Oit=Ca(I6),Rit=Ca(k7),Iit=Ca(k7),Mit=Ca(l7),Nit=Ca(l7),Cit=Ca(p7),Lit=Ca(p7),Fit=Ca(S4),Pit=Ca(S4),Bit=Ca(M4),Dit=Ca(M4),Uit=Ca(f7),xit=Ca(f7),Git=Ca(w7),jit=Ca(w7),Hit=Ca(tet),Vit=Ca(tet),$it=Ca(Wnt),Wit=Ca(Wnt),zit=Ca(Dnt),tit(Xit=iit((Bnt=function(t){function i(){var i;(i=t.call(this)||this).startColor=Kit&&Kit(),i.scaleSpace=qit&&qit(),i.startSize3D=Qit&&Qit(),i.startSizeX=Zit&&Zit(),i.startSizeY=Jit&&Jit(),i.startSizeZ=tnt&&tnt(),i.startSpeed=int&&int(),i.startRotation3D=nnt&&nnt(),i.startRotationX=ent&&ent(),i.startRotationY=rnt&&rnt(),i.startRotationZ=snt&&snt(),i.startDelay=hnt&&hnt(),i.startLifetime=unt&&unt(),i.duration=ont&&ont(),i.loop=ant&&ant(),i.simulationSpeed=cnt&&cnt(),i.playOnAwake=fnt&&fnt(),i.gravityModifier=vnt&&vnt(),i.rateOverTime=lnt&&lnt(),i.rateOverDistance=dnt&&dnt(),i.bursts=gnt&&gnt(),i._renderCulling=wnt&&wnt(),i._cullingMode=_nt&&_nt(),i._aabbHalfX=mnt&&mnt(),i._aabbHalfY=pnt&&pnt(),i._aabbHalfZ=ynt&&ynt(),i._dataCulling=bnt&&bnt(),i._colorOverLifetimeModule=Ant&&Ant(),i._shapeModule=Ent&&Ent(),i._sizeOvertimeModule=knt&&knt(),i._velocityOvertimeModule=Tnt&&Tnt(),i._forceOvertimeModule=Snt&&Snt(),i._limitVelocityOvertimeModule=Ont&&Ont(),i._rotationOvertimeModule=Rnt&&Rnt(),i._textureAnimationModule=Int&&Int(),i._noiseModule=Mnt&&Mnt(),i._trailModule=Nnt&&Nnt(),i.renderer=Cnt&&Cnt(),i._prewarm=Lnt&&Lnt(),i._capacity=Fnt&&Fnt(),i._simulationSpace=Pnt&&Pnt(),i.processor=null;var n=f(i);return n.rateOverTime.constant=10,n.startLifetime.constant=5,n.startSizeX.constant=1,n.startSpeed.constant=5,n.Ul=!1,n.Mk=!1,n.$L=!0,n.WL=!1,n.zL=!1,n.Of=!0,n.XL=!1,n.YL=0,n.KL=0,n.qL=0,n.QL=new ir,n.ZL=new ir,n.Mf=null,n.JL=null,n.tF=null,n.iF=null,n.nF=!1,n.eF=!0,n.rF=new ls,n.sF=new ls,n.hF=[],i}s(i,t);var n=i.prototype;return n.onFocusInEditor=function(){this.renderer.create(this)},n.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&!this.renderer.useGPU&&this._trailModule.enable&&this._trailModule.onInit(this),this.uF(),this.oF()},n._onMaterialModified=function(t,i){null!==this.processor&&this.processor.onMaterialModified(t,i)},n.Pu=function(t,i){this.processor.onRebuildPSO(t,i)},n._collectModels=function(){return this._models.length=0,this._models.push(this.processor.model),this._trailModule&&this._trailModule.enable&&this._trailModule.getModel()&&this._models.push(this._trailModule.getModel()),this._models},n._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},n._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene(),this.Mf&&(this.Mf=null),this.JL&&(this.JL.clear(),this.JL.destroy(),this.JL=null)},n.uF=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor),this._noiseModule&&this._noiseModule.bindTarget(this.processor)},n.play=function(){if(this.zL&&(this.QA(),this.zL=!1),this.Mk&&(this.Mk=!1),this.$L&&(this.$L=!1),this.Ul=!0,this.WL=!0,this.oF(),this._prewarm&&this.aF(),this._trailModule&&this._trailModule.play(),this.processor){var t=this.processor.getModel();t&&(t.enabled=this.enabledInHierarchy)}},n.pause=function(){this.$L?X("pause(): particle system is already stopped."):(this.Ul&&(this.Ul=!1),this.Mk=!0)},n.stopEmitting=function(){this.WL=!1,this.zL=!0},n.stop=function(){(this.Ul||this.Mk)&&this.clear(),this.Ul&&(this.Ul=!1),this.Mk&&(this.Mk=!1),this.WL&&(this.WL=!1),this.$L=!0,this.Of=!0,this.QA()},n.QA=function(){this.YL=0,this.KL=0,this.qL=0,this.oF(),this.bursts.forEach((function(t){t.reset()}))},n.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear()),this.HL(!1)},n.getParticleCount=function(){return this.processor?this.processor.getParticleCount():0},n.setCustomData1=function(t,i){ls.set(this.rF,t,i)},n.setCustomData2=function(t,i){ls.set(this.sF,t,i)},n.onDestroy=function(){var t;this.stop(),null!=(t=this.processor.getModel())&&t.scene&&(this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()),xC.off("director_before_commit",this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy(),this.JL&&(this.JL.clear(),this.JL.destroy(),this.JL=null)},n.onEnable=function(){t.prototype.onEnable.call(this),xC.on("director_before_commit",this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},n.onDisable=function(){xC.off("director_before_commit",this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable(),this.Mf&&(this.Mf=null),this.tF=null,this.JL&&(this.JL.clear(),this.JL.destroy(),this.JL=null)},n.HL=function(t){var i=this;i.Mf&&(i.JL||(i.JL=new Qnt(i)),i.JL.calculatePositions(),wo.fromPoints(i.Mf,i.JL.minPos,i.JL.maxPos),t?(i.aabbHalfX=i.Mf.halfExtents.x,i.aabbHalfY=i.Mf.halfExtents.y,i.aabbHalfZ=i.Mf.halfExtents.z):(i.aabbHalfX?i.cF(i.aabbHalfX):i.aabbHalfX=i.Mf.halfExtents.x,i.aabbHalfY?i.fF(i.aabbHalfY):i.aabbHalfY=i.Mf.halfExtents.y,i.aabbHalfZ?i.vF(i.aabbHalfZ):i.aabbHalfZ=i.Mf.halfExtents.z),i.JL.clear())},n.update=function(t){var i,n,e=this,r=e.processor,s=e.trailModule,h=t*e.simulationSpeed;if(e.renderCulling){e.Mf||(e.Mf=new wo,e.HL(!1)),e.iF||(e.iF=new ir),e.node.getWorldPosition(e.iF),e.tF||(e.tF=new ir,e.tF.set(e.iF));var u=e.iF,o=e.tF;if(!u.equals(o)&&e.Mf&&e.JL){var a=u.x-o.x,c=u.y-o.y,f=u.z-o.z,v=e.Mf.center;v.x+=a,v.y+=c,v.z+=f,e.JL.setBoundingBoxCenter(v.x,v.y,v.z),o.set(u)}var l=e.node.scene.renderScene,d=l?l.cameras:void 0,g=!0;if(void 0!==d&&e.Mf)for(var w=0;w<d.length;++w){var _=d[w];if((_.visibility&e.node.layer)===e.node.layer&&Qh.aabbFrustum(e.Mf,_.frustum)){g=!1;break}}if(g){if(2!==e._cullingMode&&(e.eF=!1),e.nF||(r.detachFromScene(),e.nF=!0),s&&s.enable&&s._detachFromScene(),1===e._cullingMode&&(e.YL+=h),2!==e._cullingMode)return}else e.nF&&(e._attachToScene(),e.nF=!1),e.eF||(e.eF=!0);if(!e.eF)return}else e.Mf&&(e.Mf=null),e.JL&&(e.JL.clear(),e.JL.destroy(),e.JL=null),e.eF=!0;if(e.Ul)e.YL+=h,e.tT(h),0!==r.updateParticles(h)||e.WL||e.stop();else{var m=(e.getMaterialInstance(0)||r.getDefaultMaterial()).passes[0];r.updateRotation(m),r.updateScale(m)}e.XL&&e.getParticleCount()>0&&!e.nF&&(null!=(i=r.getModel())&&i.scene||r.attachToScene(),s&&s.enable&&(null!=(n=s.getModel())&&n.scene||s._attachToScene()),e.XL=!1);!e.renderer.useGPU&&s&&s.enable&&(s.inited||(s.clear(),s.destroy(),s.onInit(this),s.enable=!1,s.enable=!0))},n.beforeRender=function(){var t,i,n=this,e=n.processor,r=n.trailModule;n.getParticleCount()<=0?null!=(i=e.getModel())&&i.scene&&(e.detachFromScene(),r&&r.enable&&r._detachFromScene(),n.XL=!1):null!=(t=e.getModel())&&t.scene||(n.XL=!0),n.Ul&&(e.updateRenderData(),e.beforeRender(),r&&r.enable&&(r.updateRenderData(),r.beforeRender()))},n._onVisibilityChange=function(t){this.processor.model&&(this.processor.model.visFlags=t)},n.emit=function(t,i){var n=this,e=n.node,r=n.YL%n.duration/n.duration;n.Of&&(e.invalidateChildren(1),n.Of=!1),0===n._simulationSpace&&(e.getWorldMatrix(iet),e.getWorldRotation(net));for(var s=0;s<t;++s){var h=n.processor.getFreeParticle();if(null===h)return;h.particleSystem=n,h.reset();var u=oe(ue(0,R));n._shapeModule&&n._shapeModule.enable?n._shapeModule.emit(h):(ir.set(h.position,0,0,0),ir.copy(h.velocity,p6)),n._textureAnimationModule&&n._textureAnimationModule.enable&&n._textureAnimationModule.init(h);var o=n.startSpeed.evaluate(r,u);ir.multiplyScalar(h.velocity,h.velocity,o),0===n._simulationSpace&&(ir.transformMat4(h.position,h.position,iet),ir.transformQuat(h.velocity,h.velocity,net)),ir.copy(h.ultimateVelocity,h.velocity),n.startRotation3D?h.startEuler.set(n.startRotationX.evaluate(r,u),n.startRotationY.evaluate(r,u),n.startRotationZ.evaluate(r,u)):h.startEuler.set(0,0,n.startRotationZ.evaluate(r,u)),h.rotation.set(h.startEuler),n.startSize3D?ir.set(h.startSize,n.startSizeX.evaluate(r,u),n.startSizeY.evaluate(r,u),n.startSizeZ.evaluate(r,u)):(ir.set(h.startSize,n.startSizeX.evaluate(r,u),1,1),h.startSize.y=h.startSize.x),ir.copy(h.size,h.startSize),h.startColor.set(n.startColor.evaluate(r,u)),h.color.set(h.startColor),h.startLifetime=n.startLifetime.evaluate(r,u)+i,h.remainingLifetime=h.startLifetime,h.randomSeed=ue(0,233280),h.loopCount++,n.processor.setNewParticle(h)}},n.aF=function(){this.startDelay.mode=b5.Constant,this.startDelay.constant=0;for(var t=this.duration/1,i=0;i<t;++i)this.YL+=1,this.tT(1),this.processor.updateParticles(1)},n.tT=function(t){var i=this,n=i.startDelay.evaluate(0,1);if(i.YL>n){if(i.YL>i.duration+n&&(i.loop||(i.WL=!1)),!i.WL)return;if(i.KL+=i.rateOverTime.evaluate(i.YL/i.duration,1)*t,i.KL>1){var e=Math.floor(i.KL);i.KL-=e,i.emit(e,t)}var r=i.rateOverDistance.evaluate(i.YL/i.duration,1);if(r>0){ir.copy(i.QL,i.ZL),i.node.getWorldPosition(i.ZL);var s=ir.distance(i.ZL,i.QL);i.qL+=s*r}if(i.qL>1){var h=Math.floor(i.qL);i.qL-=h,i.emit(h,t)}for(var u,o=d(i.bursts);!(u=o()).done;)u.value.update(i,t)}},n.oF=function(){this.node.getWorldPosition(this.QL),ir.copy(this.ZL,this.QL)},n.lF=function(t){this.hF.push(t)},n.dF=function(t){this.hF.splice(this.hF.indexOf(t),1)},n.gF=function(t){this.bursts.push(t)},n.wF=function(t){var i=this.bursts.indexOf(t);i>-1&&this.bursts.splice(i,1)},n._F=function(){return this._aabbHalfX},n.mF=function(){return this._aabbHalfY},n.pF=function(){return this._aabbHalfZ},n.cF=function(t){this.Mf&&this.JL&&(this.Mf.halfExtents.x=t,this.JL.setBoundingBoxSize(this.Mf.halfExtents),this._aabbHalfX=t)},n.fF=function(t){this.Mf&&this.JL&&(this.Mf.halfExtents.y=t,this.JL.setBoundingBoxSize(this.Mf.halfExtents),this._aabbHalfY=t)},n.vF=function(t){this.Mf&&this.JL&&(this.Mf.halfExtents.z=t,this.JL.setBoundingBoxSize(this.Mf.halfExtents),this._aabbHalfZ=t)},n._onBeforeSerialize=function(t){var i=this;return this.dataCulling?t.filter((function(t){return!_6.includes(t)||i[t]&&i[t].enable})):t},n.getNoisePreview=function(t,i){var n=[];return this.processor&&this.processor.getNoisePreview(n,t,i),n},e(i,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t>0?t:0),this.processor&&this.processor.model&&this.processor.model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"renderCulling",get:function(){return this._renderCulling},set:function(t){this._renderCulling=t,t&&(this.Mf||(this.Mf=new wo,this.HL(!1)))}},{key:"cullingMode",get:function(){return this._cullingMode},set:function(t){this._cullingMode=t}},{key:"aabbHalfX",get:function(){return this._F()||0},set:function(t){this.cF(t)}},{key:"aabbHalfY",get:function(){return this.mF()||0},set:function(t){this.fF(t)}},{key:"aabbHalfZ",get:function(){return this.pF()||0},set:function(t){this.vF(t)}},{key:"dataCulling",get:function(){return this._dataCulling},set:function(t){this._dataCulling=t}},{key:"sharedMaterials",get:function(){return eet.get.call(this)},set:function(t){eet.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"noiseModule",get:function(){return this._noiseModule},set:function(t){t&&(this._noiseModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}},{key:"isPlaying",get:function(){return this.Ul}},{key:"isPaused",get:function(){return this.Mk}},{key:"isStopped",get:function(){return this.$L}},{key:"isEmitting",get:function(){return this.WL}},{key:"time",get:function(){return this.YL}}]),i}(yj),Bnt.CullingMode=N6,Kit=xo((Yit=Bnt).prototype,"startColor",[nit,oa],(function(){return new i6})),qit=xo(Yit.prototype,"scaleSpace",[eit,oa],(function(){return 1})),Qit=xo(Yit.prototype,"startSize3D",[oa],(function(){return!1})),Zit=xo(Yit.prototype,"startSizeX",[rit,sit],(function(){return new A5})),Jit=xo(Yit.prototype,"startSizeY",[hit,oa],(function(){return new A5})),tnt=xo(Yit.prototype,"startSizeZ",[uit,oa],(function(){return new A5})),int=xo(Yit.prototype,"startSpeed",[oit,oa],(function(){return new A5})),nnt=xo(Yit.prototype,"startRotation3D",[oa],(function(){return!1})),ent=xo(Yit.prototype,"startRotationX",[ait,oa],(function(){return new A5})),rnt=xo(Yit.prototype,"startRotationY",[cit,oa],(function(){return new A5})),snt=xo(Yit.prototype,"startRotationZ",[fit,vit],(function(){return new A5})),hnt=xo(Yit.prototype,"startDelay",[lit,oa],(function(){return new A5})),unt=xo(Yit.prototype,"startLifetime",[dit,oa],(function(){return new A5})),ont=xo(Yit.prototype,"duration",[oa],(function(){return 5})),ant=xo(Yit.prototype,"loop",[oa],(function(){return!0})),m(Yit.prototype,"simulationSpace",[git,oa],Object.getOwnPropertyDescriptor(Yit.prototype,"simulationSpace"),Yit.prototype),cnt=xo(Yit.prototype,"simulationSpeed",[oa],(function(){return 1})),fnt=xo(Yit.prototype,"playOnAwake",[oa],(function(){return!0})),vnt=xo(Yit.prototype,"gravityModifier",[wit,oa],(function(){return new A5})),lnt=xo(Yit.prototype,"rateOverTime",[_it,oa],(function(){return new A5})),dnt=xo(Yit.prototype,"rateOverDistance",[mit,oa],(function(){return new A5})),gnt=xo(Yit.prototype,"bursts",[pit,oa],(function(){return[]})),m(Yit.prototype,"renderCulling",[yit],Object.getOwnPropertyDescriptor(Yit.prototype,"renderCulling"),Yit.prototype),wnt=xo(Yit.prototype,"_renderCulling",[oa],(function(){return!1})),m(Yit.prototype,"cullingMode",[bit],Object.getOwnPropertyDescriptor(Yit.prototype,"cullingMode"),Yit.prototype),_nt=xo(Yit.prototype,"_cullingMode",[oa],(function(){return 0})),m(Yit.prototype,"aabbHalfX",[Ait],Object.getOwnPropertyDescriptor(Yit.prototype,"aabbHalfX"),Yit.prototype),mnt=xo(Yit.prototype,"_aabbHalfX",[oa],(function(){return 0})),m(Yit.prototype,"aabbHalfY",[Eit],Object.getOwnPropertyDescriptor(Yit.prototype,"aabbHalfY"),Yit.prototype),pnt=xo(Yit.prototype,"_aabbHalfY",[oa],(function(){return 0})),m(Yit.prototype,"aabbHalfZ",[kit],Object.getOwnPropertyDescriptor(Yit.prototype,"aabbHalfZ"),Yit.prototype),ynt=xo(Yit.prototype,"_aabbHalfZ",[oa],(function(){return 0})),bnt=xo(Yit.prototype,"_dataCulling",[oa,Tit],(function(){return!1})),m(Yit.prototype,"sharedMaterials",[ja,oa],Object.getOwnPropertyDescriptor(Yit.prototype,"sharedMaterials"),Yit.prototype),Ant=xo(Yit.prototype,"_colorOverLifetimeModule",[Sit],(function(){return null})),m(Yit.prototype,"colorOverLifetimeModule",[Oit],Object.getOwnPropertyDescriptor(Yit.prototype,"colorOverLifetimeModule"),Yit.prototype),Ent=xo(Yit.prototype,"_shapeModule",[Rit],(function(){return null})),m(Yit.prototype,"shapeModule",[Iit],Object.getOwnPropertyDescriptor(Yit.prototype,"shapeModule"),Yit.prototype),knt=xo(Yit.prototype,"_sizeOvertimeModule",[Mit],(function(){return null})),m(Yit.prototype,"sizeOvertimeModule",[Nit],Object.getOwnPropertyDescriptor(Yit.prototype,"sizeOvertimeModule"),Yit.prototype),Tnt=xo(Yit.prototype,"_velocityOvertimeModule",[Cit],(function(){return null})),m(Yit.prototype,"velocityOvertimeModule",[Lit],Object.getOwnPropertyDescriptor(Yit.prototype,"velocityOvertimeModule"),Yit.prototype),Snt=xo(Yit.prototype,"_forceOvertimeModule",[Fit],(function(){return null})),m(Yit.prototype,"forceOvertimeModule",[Pit],Object.getOwnPropertyDescriptor(Yit.prototype,"forceOvertimeModule"),Yit.prototype),Ont=xo(Yit.prototype,"_limitVelocityOvertimeModule",[Bit],(function(){return null})),m(Yit.prototype,"limitVelocityOvertimeModule",[Dit],Object.getOwnPropertyDescriptor(Yit.prototype,"limitVelocityOvertimeModule"),Yit.prototype),Rnt=xo(Yit.prototype,"_rotationOvertimeModule",[Uit],(function(){return null})),m(Yit.prototype,"rotationOvertimeModule",[xit],Object.getOwnPropertyDescriptor(Yit.prototype,"rotationOvertimeModule"),Yit.prototype),Int=xo(Yit.prototype,"_textureAnimationModule",[Git],(function(){return null})),m(Yit.prototype,"textureAnimationModule",[jit],Object.getOwnPropertyDescriptor(Yit.prototype,"textureAnimationModule"),Yit.prototype),Mnt=xo(Yit.prototype,"_noiseModule",[Hit],(function(){return null})),m(Yit.prototype,"noiseModule",[Vit],Object.getOwnPropertyDescriptor(Yit.prototype,"noiseModule"),Yit.prototype),Nnt=xo(Yit.prototype,"_trailModule",[$it],(function(){return null})),m(Yit.prototype,"trailModule",[Wit],Object.getOwnPropertyDescriptor(Yit.prototype,"trailModule"),Yit.prototype),Cnt=xo(Yit.prototype,"renderer",[zit,oa],(function(){return new Dnt})),Lnt=xo(Yit.prototype,"_prewarm",[oa],(function(){return!1})),Fnt=xo(Yit.prototype,"_capacity",[oa],(function(){return 100})),Pnt=xo(Yit.prototype,"_simulationSpace",[oa],(function(){return 1})),Xit=Yit))||Xit)||Xit);t({ParticleSystem:ret,ParticleSystemComponent:ret});var set=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){this.yF||(xC.on("director_before_scene_launch",this.bF,this),this.yF=!0);var i=t._uuid;if(!this.AF.has(i)){var n=new uu((function(){return r1(t)||new Xp}),1,(function(t){return t.destroy()}));this.AF.set(i,n)}return this.AF.get(i).alloc()},t.destroy=function(t){var i,n,e=null==(i=t.prefab)||null==(n=i.asset)?void 0:n.uuid;e&&this.AF.has(e)&&(this.stop(t),this.AF.get(e).free(t))},t.play=function(t){for(var i,n=d(t.getComponentsInChildren(ret));!(i=n()).done;)i.value.play()},t.stop=function(t){for(var i,n=d(t.getComponentsInChildren(ret));!(i=n()).done;)i.value.stop()},t.bF=function(){this.AF.forEach((function(t){return t.destroy()})),this.AF.clear()},t}());set.AF=new Map,set.yF=!1,gt(y7.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),dt(ret.prototype,"ParticleSystem.prototype",[{name:"enableCulling",newName:"dataCulling"}]),k.ParticleSystemComponent=ret,ai(ret,"cc.ParticleSystemComponent"),k.BillboardComponent=q3,ai(q3,"cc.BillboardComponent"),k.LineComponent=u6,ai(u6,"cc.LineComponent"),k.ParticleUtils=set;var het,uet=function(){function t(t,i,n){this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=i,this._accumStart=n}var i=t.prototype;return i.sample=function(t){this._average(this._value,t)},i.human=function(){var t=this._opts,i=t.average,n=t.isInteger,e=i?this._averageValue:this._value;return n?Math.round(e):Math.round(100*e)/100},i.alarm=function(){return void 0!==this._opts.below&&this._value<this._opts.below||void 0!==this._opts.over&&this._value>this._opts.over},i._average=function(t,i){if(void 0===i&&(i=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var n=i;n-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=n,this._accumSamples=0)}},e(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),oet=Ko("cc.PerfCounter")(het=function(t){function i(i,n,e){var r;return(r=t.call(this,i,n,e)||this).YL=e,r}s(i,t);var n=i.prototype;return n.start=function(t){void 0===t&&(t=0),this.YL=t},n.end=function(t){void 0===t&&(t=0),this._value=t-this.YL,this._average(this._value)},n.tick=function(){this.end(),this.start()},n.frame=function(t){var i=t,n=i-this.YL;this._total++,n>(this._opts.average||1e3)&&(this._value=1e3*this._total/n,this._total=0,this.YL=i,this._average(this._value))},i}(uet))||het,aet="0123456789. ",cet=500,fet={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},vet={fps:{desc:"Framerate (FPS)",below:30,average:cet,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:cet},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:cet,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:cet},render:{desc:"Renderer (ms)",min:0,max:50,average:cet,color:"#f90"},present:{desc:"Present (ms)",min:0,max:50,average:cet,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},det=t("Profiler",function(t){function i(){var i;return(i=t.call(this)||this).EF=null,i.kF=!1,i.TF=null,i.gu=null,i.Ee=null,i.SF=null,i.Ae=null,i.OF=null,i.es=null,i.RF=new td,i.IF=[],i.MF=[i.RF],i.NF=null,i.CF=null,i.LF=null,i.FF=!1,i.PF=!1,i.Sg=!1,i.BF=280/(Object.keys(vet).length+1),i.DF=0,i.UF=0,i.xF=0,i.BN=0,i.Ae=O.document.createElement("canvas"),i.OF=i.Ae.getContext("2d"),i.IF.push(i.Ae),i}s(i,t);var n=i.prototype;return n.init=function(){xi.querySettings("profiling","showFPS")?this.showStats():this.hideStats()},n.isShowingStats=function(){return this.kF},n.hideStats=function(){this.kF&&(this.TF&&(this.TF.active=!1),xC.off("director_before_update",this.beforeUpdate,this),xC.off("director_after_update",this.afterUpdate,this),xC.off("director_before_physics",this.beforePhysics,this),xC.off("director_after_physics",this.afterPhysics,this),xC.off("director_before_draw",this.beforeDraw,this),xC.off("director_after_render",this.afterRender,this),xC.off("director_after_draw",this.afterPresent,this),this.kF=!1,xC.root.pipeline.profiler=null,k.game.config.showFPS=!1)},n.showStats=function(){if(!this.kF){if(!this.gu){var t=k.director.root;this.gu=Hg.gfxDevice,this.Ee=t.mainWindow.swapchain}this.generateCanvas(),this.generateStats(),k.game.once(k.Game.EVENT_ENGINE_INITED,this.generateNode,this),k.game.on(k.Game.EVENT_RESTART,this.generateNode,this),this.TF&&(this.TF.active=!0),xC.on("director_before_update",this.beforeUpdate,this),xC.on("director_after_update",this.afterUpdate,this),xC.on("director_before_physics",this.beforePhysics,this),xC.on("director_after_physics",this.afterPhysics,this),xC.on("director_before_draw",this.beforeDraw,this),xC.on("director_after_render",this.afterRender,this),xC.on("director_after_draw",this.afterPresent,this),this.kF=!0,this.FF=!0,this.PF=!0,k.game.config.showFPS=!0}},n.generateCanvas=function(){if(!this.FF){var t=this.Ae,i=this.OF;if(i&&t){t.width=280,t.height=280,t.style.width=""+t.width,t.style.height=""+t.height,i.font="23px Arial",i.textBaseline="top",i.fillStyle="#fff",this.es=this.gu.createTexture(new vd(1,6,35,280,280));var n=this.RF.texExtent;n.width=280,n.height=280}}},n.generateStats=function(){if(!this.PF&&this.OF&&this.Ae){this.EF=null;var t=performance.now();this.OF.textAlign="left";var i=0;for(var n in vet){var e=vet[n];this.OF.fillText(e.desc,0,i*this.BF),e.counter=new oet(n,e,t),i++}this.xF=i,this.DF=this.xF*this.BF/this.Ae.height;for(var r=0;r<12;++r){var s=this.OF.measureText(aet[r]).width;this.UF=Math.max(this.UF,s)}for(var h=0;h<12;++h)this.OF.fillText(aet[h],h*this.UF,this.xF*this.BF);this.UF/=this.Ae.width,this.EF=vet,this.IF[0]=this.Ae,this.gu.copyTexImagesToTexture(this.IF,this.es,this.MF)}},n.generateNode=function(){if(!this.TF||!this.TF.isValid){this.TF=new Xp("PROFILER_NODE"),this.TF._objFlags=1032,UL.addPersistRootNode(this.TF);var t=new Xp("Profiler_Root");t.parent=this.TF;for(var i=.4,n=i/this.xF,e=i/this.DF,r=n/23,s=this.UF*this.Ae.width*r,h=[0,i,0,e,i,0,e,0,0,0,0,0],u=[0,2,1,0,3,2],o=[0,0,-1,0,1,0,-1,0,1,this.DF,-1,0,0,this.DF,-1,0],a=0,c=0;c<this.xF;c++)for(var f=0;f<8;f++){h.push(e+f*s,i-c*n,0),h.push(e+(f+1)*s,i-c*n,0),h.push(e+(f+1)*s,i-(c+1)*n,0),h.push(e+f*s,i-(c+1)*n,0),a=4*(8*c+f+1),u.push(0+a,2+a,1+a,0+a,3+a,2+a);var v=8*c+f,l=Math.floor(v/4),d=v-4*l;o.push(0,this.DF,l,d),o.push(this.UF,this.DF,l,d),o.push(this.UF,1,l,d),o.push(0,1,l,d)}this.SF=t.addComponent(rW),this.SF.mesh=NF({positions:h,indices:u,colors:o});var g=new Lk;g.initialize({effectName:"util/profiler"});var w=this.LF=g.passes[0],_=w.getBinding("mainTexture"),m=w.getBinding("digits"),p=w.getBinding("offset");w.bindTexture(_,this.es),this.NF=w.blocks[m],this.CF=w.blocks[p],this.CF[3]=-1,this.SF.material=g,this.SF.node.layer=Pm.Enum.PROFILER,this.Sg=!0}},n.beforeUpdate=function(){if(this.EF){var t=performance.now();this.EF.frame.counter.start(t),this.EF.logic.counter.start(t)}},n.afterUpdate=function(){if(this.EF){var t=performance.now();xC.isPaused()?this.EF.frame.counter.start(t):this.EF.logic.counter.end(t)}},n.beforePhysics=function(){if(this.EF){var t=performance.now();this.EF.physics.counter.start(t)}},n.afterPhysics=function(){if(this.EF){var t=performance.now();this.EF.physics.counter.end(t)}},n.beforeDraw=function(){if(this.EF&&this.Sg){var t=this.Ee.surfaceTransform,i=this.gu.capabilities.clipSpaceSignY;if(t!==this.CF[3]){var n=Hr[t],e=-.9*i;this.CF[0]=-.9*n[0]+e*n[2],this.CF[1]=-.9*n[1]+e*n[3],this.CF[2]=this.UF,this.CF[3]=t}this.LF.bu(!0),this.SF.model?xC.root.pipeline.profiler=this.SF.model:xC.root.pipeline.profiler=null;var r=performance.now();this.EF.render.counter.start(r)}},n.afterRender=function(){if(this.EF&&this.Sg){var t=performance.now();this.EF.render.counter.end(t),this.EF.present.counter.start(t)}},n.afterPresent=function(){if(this.EF&&this.Sg){var t=performance.now();if(this.EF.frame.counter.end(t),this.EF.fps.counter.frame(t),this.EF.present.counter.end(t),!(t-this.BN<cet)){this.BN=t;var i=this.gu;this.EF.draws.counter.value=i.numDrawCalls,this.EF.instances.counter.value=i.numInstances,this.EF.bufferMemory.counter.value=i.memoryStatus.bufferSize/1048576,this.EF.textureMemory.counter.value=i.memoryStatus.textureSize/1048576,this.EF.tricount.counter.value=i.numTris;var n=0,e=this.NF;for(var r in this.EF){var s=this.EF[r];s.counter.sample(t);for(var h=s.counter.human().toString(),u=7;u>=0;u--){var o=8*n+u,a=h[h.length-(8-u)],c=fet[a];void 0===c&&(c=11),e[o]=c}n++}}}},e(i,[{key:"_stats",get:function(){return st(16381),this.EF}},{key:"stats",get:function(){return this.EF}}]),i}(Pv)),get=t("profiler",new det);xC.registerSystem("profiler",get,0),k.profiler=get;var wet=new ir,_et=new ir;function met(t,i){var n=null;return{value:i.length>0?i[i.length-1]:ir.ZERO,progress:function(t,i,e,r){return n.getPoint(r)},clone:function(t){return ir.clone(t)},add:function(t,i){return t.clone().add(i)},sub:function(t,i){return t.clone().subtract(i)},onStart:function(e){var r=e.start,s=e.end,h=e.relative,u=e.reversed;(n=Ev.create(t)).addKnot(r);var o=null;h&&u&&(o=_et,ir.subtract(o,r,i[i.length-1]));for(var a=0,c=i.length;a<c;++a){var f=u?i[c-1-a]:i[a];h?u?a>0&&n.addKnot(ir.copy(wet,o).add(f)):n.addKnot(ir.copy(wet,r).add(f)):n.addKnot(f)}h&&u&&n.addKnot(s)},onComplete:function(){n=null},onStop:function(){n=null},legacyProgress:!1}}var pet=Object.freeze({__proto__:null,bezier:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return met(1,i)},catmullRom:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return met(2,i)}});t("tweenProgress",pet);var yet=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},bet=function(){function t(){this.GF=new Map,this.jF=[],this.ji=void 0,this.HF=[]}var i=t.prototype;return i.VF=function(t,i){var n=this.HF.pop();return n||(n=new yet),n.target=t,n.paused=!!i,n},i.$F=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this.HF.push(t)},i.WF=function(t,i){i?this.resumeTarget(t):this.pauseTarget(t)},i.zF=function(t){this.XF(t,!1)},i.YF=function(t){t.isValid&&(t.on("active-changed",this.WF,this),t.on("node-destroyed",this.zF,this))},i.KF=function(t){t.isValid&&(t.off("active-changed",this.WF,this),t.off("node-destroyed",this.zF,this))},i.addAction=function(t,i,n){if(t&&i){var e=this.GF.get(i);e?e.actions||(e.actions=[]):(e=this.VF(i,n),this.GF.set(i,e),this.jF.push(e)),0===e.actions.length&&i instanceof Xp&&this.YF(i),e.target=i,e.actions.push(t),t.startWithTarget(i)}else ut(1e3)},i.removeAllActions=function(){for(var t=this.jF,i=0;i<t.length;i++){var n=t[i];n&&(n.target instanceof Xp&&this.KF(n.target),this.$F(n))}this.jF.length=0,this.GF=new Map},i.removeAllActionsFromTarget=function(t){this.XF(t,!0)},i.XF=function(t,i){if(null!=t){var n=this.GF.get(t);n&&(i&&t instanceof Xp&&this.KF(t),n.actions.length=0,this.qF(n))}},i.removeAction=function(t){if(null!=t){var i=t.getOriginalTarget(),n=this.GF.get(i);if(n)for(var e=0;e<n.actions.length;e++)if(n.actions[e]===t){n.actions.splice(e,1),n.actionIndex>=e&&n.actionIndex--;break}}},i._removeActionByTag=function(t,i,n){for(var e=0,r=i.actions.length;e<r;++e){var s=i.actions[e];if(s&&s.getTag()===t){if(n&&s.getOriginalTarget()!==n)continue;this.QF(e,i);break}}},i._removeAllActionsByTag=function(t,i,n){for(var e=i.actions.length-1;e>=0;--e){var r=i.actions[e];if(r&&r.getTag()===t){if(n&&r.getOriginalTarget()!==n)continue;this.QF(e,i)}}},i.removeActionByTag=function(t,i){var n=this;-1===t&&it(1002);var e=this.GF;if(i){var r=e.get(i);r&&this._removeActionByTag(t,r,i)}else e.forEach((function(i){n._removeActionByTag(t,i)}))},i.removeAllActionsByTag=function(t,i){var n=this;-1===t&&it(1002);var e=this.GF;if(i){var r=e.get(i);r&&this._removeAllActionsByTag(t,r,i)}else e.forEach((function(i){n._removeAllActionsByTag(t,i)}))},i.getActionByTag=function(t,i){-1===t&&it(1004);var n=this.GF.get(i);if(n){if(null!=n.actions)for(var e=0;e<n.actions.length;++e){var r=n.actions[e];if(r&&r.getTag()===t)return r}it(1005,t)}return null},i.getNumberOfRunningActionsInTarget=function(t){var i=this.GF.get(t);return i&&i.actions?i.actions.length:0},i.pauseTarget=function(t){var i=this.GF.get(t);i&&(i.paused=!0)},i.resumeTarget=function(t){var i=this.GF.get(t);i&&(i.paused=!1)},i.pauseAllRunningActions=function(){for(var t=[],i=this.jF,n=0;n<i.length;n++){var e=i[n];e&&!e.paused&&(e.paused=!0,e.target&&t.push(e.target))}return t},i.resumeTargets=function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.resumeTarget(t[i])},i.pauseTargets=function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.pauseTarget(t[i])},i.isActionRunning=function(t){var i=this.GF.get(t.getOriginalTarget()),n=-1;return i&&(n=i.actions.indexOf(t)),-1!==n},i.QF=function(t,i){i.actions.splice(t,1),i.actionIndex>=t&&i.actionIndex--,0===i.actions.length&&(i.target instanceof Xp&&this.KF(i.target),this.qF(i))},i.qF=function(t){var i=!1;if(t&&!t.lock&&this.GF.get(t.target)){this.GF.delete(t.target);for(var n=this.jF,e=0,r=n.length;e<r;e++)if(n[e]===t){n.splice(e,1);break}this.$F(t),i=!0}return i},i.update=function(t){for(var i,n=this.jF,e=0;e<n.length;e++){this.ji=n[e];var r=(i=this.ji).target;if(!_u(r)||r.isValid){if(!i.paused&&i.actions){for(i.lock=!0,i.actionIndex=0;i.actionIndex<i.actions.length;i.actionIndex++)if(i.currentAction=i.actions[i.actionIndex],i.currentAction){if(i.currentAction.step(t),i.currentAction&&i.currentAction.isDone()){i.currentAction.stop();var s=i.currentAction;i.currentAction=null,this.removeAction(s)}i.currentAction=null}i.lock=!1}0===i.actions.length&&(r instanceof Xp&&this.KF(r),this.qF(i)&&e--)}else this.removeAllActionsFromTarget(r),e--}},t}(),Aet=t("TweenSystem",function(t){function i(){var i;return(i=t.call(this)||this).ZF=new bet,i}return s(i,t),i.prototype.update=function(t){this.ZF.update(t)},e(i,[{key:"ActionManager",get:function(){return this.ZF}}]),i}(Pv));Aet.ID="TWEEN",Aet.instance=void 0,xC.on("director_init",(function(){var t=new Aet;Aet.instance=t,xC.registerSystem(Aet.ID,t,100)}));var Eet=function(t){function i(){var i;return(i=t.call(this)||this)._duration=0,i}s(i,t);var n=i.prototype;return n.getDurationScaled=function(){return this._duration},n.getDuration=function(){return this._duration},n.setDuration=function(t){this._duration=t},i}(function(){function t(){this.originalTarget=null,this.target=null,this.Lu=null,this.tag=-1,this._id=void 0,this._paused=!1}var i=t.prototype;return i.isDone=function(){return!0},i.startWithTarget=function(t){this.originalTarget=t,this.target=t},i.stop=function(){this.target=null},i.getTarget=function(){return this.target},i.setTarget=function(t){this.target=t},i.getOriginalTarget=function(){return this.originalTarget},i.setOriginalTarget=function(t){this.originalTarget=t},i.JF=function(){var t,i=null==(t=this.Lu)?void 0:t.getTarget();return null!=i?i:this.target},i.getTag=function(){return this.tag},i.setTag=function(t){this.tag=t},i.setId=function(t){this._id=t},i.getId=function(){return this._id},i.setPaused=function(t){this._paused=t},t}()),ket=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.isUnknownDuration=function(){return!1},i}(Eet),Tet=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.update=function(){var t=this.JF();if(t)for(var i=t.getComponentsInChildren(dD),n=0;n<i.length;++n)i[n].enabled=!0},n.reverse=function(){return new Oet},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<Show>"},i}(ket),Oet=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.update=function(){var t=this.JF();if(t)for(var i=t.getComponentsInChildren(dD),n=0;n<i.length;++n)i[n].enabled=!1},n.reverse=function(){return new Tet},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<Hide>"},i}(ket);!function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;n.update=function(){var t=this.JF();if(t)for(var i=t.getComponentsInChildren(dD),n=0;n<i.length;++n){var e=i[n];e.enabled=!e.enabled}},n.reverse=function(){return new i},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<ToggleVisibility>"}}(ket);var Ret=function(t){function i(i){var n;return(n=t.call(this)||this)._isNeedCleanUp=!0,void 0!==i&&n.init(i),n}s(i,t);var n=i.prototype;return n.update=function(){var t=this.JF();t&&(t.removeFromParent(),this._isNeedCleanUp&&t.destroy())},n.init=function(t){return this._isNeedCleanUp=t,!0},n.reverse=function(){return new i(this._isNeedCleanUp)},n.clone=function(){var t=new i(this._isNeedCleanUp);return t._id=this._id,t},n.toString=function(){return"<RemoveSelf>"},i}(ket);function Iet(t){return new Ret(t)}var Met=function(t){function i(i,n,e){var r;return(r=t.call(this)||this).tP=void 0,r.Ti=void 0,r.I=void 0,r.initWithFunction(i,n,e),r}s(i,t);var n=i.prototype;return n.initWithFunction=function(t,i,n){return t&&(this.Ti=t),i&&(this.tP=i),void 0!==n&&(this.I=n),!0},n.execute=function(){if(this.Ti){var t=this.JF();this.Ti.call(this.tP,t,this.I)}},n.update=function(){this.execute()},n.getTargetCallback=function(){return this.tP},n.setTargetCallback=function(t){t!==this.tP&&(this.tP=t)},n.clone=function(){var t=new i;return t._id=this._id,this.Ti&&t.initWithFunction(this.Ti,this.tP,this.I),t},n.toString=function(){return"<CallFunc>"},i}(ket);function Net(t,i,n){return new Met(t,i,n)}var Cet=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.clone=function(){return new i},n.reverse=function(){return this.clone()},n.update=function(){},n.step=function(){},n.isUnknownDuration=function(){return!1},n.toString=function(){return"DummyAction"},i}(Eet),Let=function(t){function i(i){var n;return(n=t.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._startTime=0,n._firstTick=!1,n._speed=1,void 0===i||Number.isNaN(i)||n.initWithDuration(i),n}s(i,t);var n=i.prototype;return n.setStartTime=function(t){t=t<0?0:t>this._duration?this._duration:t,this._startTime=t},n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(t){return this._duration=0===t?Gi.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration&&!this.isUnknownDuration()},n.iP=function(t){t._speed=this._speed},n.step=function(t){if(!this._paused&&0!==this._speed){t*=this._speed,this._firstTick?this._elapsed=this._startTime:this._elapsed+=t;var i=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);i=i<1?i:1,this.update(i>0?i:0),this.isUnknownDuration()&&!this._firstTick&&(i<1?this._elapsed-=t:this._elapsed=this._startTime+this._duration),this._firstTick&&(this._firstTick=!1,this._startTime>0&&(this._startTime=0))}},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this._elapsed=0,this._firstTick=!0},n.getSpeed=function(){return this._speed},n.setSpeed=function(t){this._speed=t},n.getDurationScaled=function(){return this._duration/this._speed},i}(Eet);function Fet(t,i){var n=new Pet;return n.initWithTwoActions(t,i),n}var Pet=function(t){function i(i){var n;if((n=t.call(this)||this).nP=[],n.eP=0,n.rP=0,n.sP=!1,!i||0===i.length)return f(n);1===i.length&&i.push(new Cet);var e=i.length-1;if(e>=0&&null==i[e]&&it(1015),e>=0){for(var r=i[0],s=1;s<e;s++)i[s]&&(r=Fet(r,i[s]));n.initWithTwoActions(r,i[e])}return n}s(i,t);var n=i.prototype;return n.initWithTwoActions=function(t,i){if(!t||!i)return ut(1025),!1;var n=t.getDurationScaled()+i.getDurationScaled();return this.initWithDuration(n),this.nP[0]=t,this.nP[1]=i,!0},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),t.initWithTwoActions(this.nP[0].clone(),this.nP[1].clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),0!==this.nP.length&&(this.eP=this.nP[0].getDurationScaled()/this._duration,this.rP=-1)},n.stop=function(){0!==this.nP.length&&(-1!==this.rP&&this.nP[this.rP].stop(),t.prototype.stop.call(this))},n.update=function(t){var i=this.nP;if(0!==i.length){var n=0,e=0,r=this.eP,s=this.rP;if(t<r){if(n=0!==r?t/r:1,0===e&&1===s&&this.sP){var h=i[1];if(h.update(0),h.isUnknownDuration())return;h.stop()}}else{var u=i[0];if(e=1,n=1===r?1:(t-r)/(1-r),-1===s){if(u.startWithTarget(this.target),u.update(1),u.isUnknownDuration())return;u.stop()}if(0===s){if(u.update(1),u.isUnknownDuration())return;u.stop()}}var o=i[e];s===e&&o.isDone()||(s!==e&&o.startWithTarget(this.target),o.update(n>1?n%1:n),this.rP=e)}},n.reverse=function(){var t=Fet(this.nP[1].reverse(),this.nP[0].reverse());return this.iP(t),t.sP=!0,t},n.hP=function(t){if(!(this.nP.length<2)){var n=this.nP[0],e=this.nP[1];e.Lu||(e.Lu=t),n instanceof i||n instanceof Het?n.hP(t):n.Lu||(n.Lu=t)}},n.uP=function(t){for(var n=0,e=this.nP.length;n<e;++n){var r=this.nP[n];if(r.getId()===t)return r;if((r instanceof i||r instanceof Het)&&(r=r.uP(t))&&r.getId()===t)return r}return null},n.isUnknownDuration=function(){if(0===this.nP.length)return!1;var t=this.nP[0],i=this.nP[1];return this.rP<1?t.isUnknownDuration():i.isUnknownDuration()},n.toString=function(){return"<Sequence>"},i}(Let);function Bet(t){return new Pet(t)}var Det=function(t){function i(i,n){var e;return(e=t.call(this)||this).NT=0,e.oP=0,e.aP=0,e.cP=!1,e.fP=null,e.initWithAction(i,n),e}s(i,t);var n=i.prototype;return n.initWithAction=function(t,i){if(!t||void 0===i)return!1;var n=t.getDurationScaled()*i;return!!this.initWithDuration(n)&&(this.NT=i,this.fP=t,t instanceof ket&&(this.cP=!0,this.NT-=1),this.oP=0,!0)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),this.fP&&t.initWithAction(this.fP.clone(),this.NT),t},n.startWithTarget=function(i){this.oP=0,this.aP=(this.fP?this.fP.getDurationScaled():0)/this._duration,t.prototype.startWithTarget.call(this,i),this.fP&&this.fP.startWithTarget(i)},n.stop=function(){this.fP&&this.fP.stop(),t.prototype.stop.call(this)},n.update=function(t){var i=this.fP,n=this._duration,e=this.NT,r=this.aP;if(i)if(t>=r){for(;t>r&&this.oP<e;){if(i.update(1),i.isUnknownDuration())return;this.oP++,i.stop(),i.startWithTarget(this.target),r+=i.getDurationScaled()/n,this.aP=r>1?1:r}if(t>=1&&this.oP<e){if(i.update(1),i.isUnknownDuration())return;this.oP++}this.cP||(this.oP===e?i.stop():i.update(t-(r-i.getDurationScaled()/n)))}else i.update(t*e%1)},n.isDone=function(){return this.oP===this.NT},n.reverse=function(){var t=new i(this.fP?this.fP.reverse():void 0,this.NT);return this.iP(t),t},n.setInnerAction=function(t){this.fP!==t&&(this.fP=t)},n.getInnerAction=function(){return this.fP},n.isUnknownDuration=function(){return!!this.fP&&this.fP.isUnknownDuration()},n.toString=function(){return"<Repeat>"},i}(Let);function Uet(t,i){return new Det(t,i)}var xet=function(t){function i(i){var n;return(n=t.call(this)||this).fP=null,i&&n.initWithAction(i),n}s(i,t);var n=i.prototype;return n.initWithAction=function(t){return t?(this.fP=t,this._duration=1/0,!0):(ut(1026),!1)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),this.fP&&t.initWithAction(this.fP.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.fP&&this.fP.startWithTarget(i)},n.stop=function(){this.fP&&this.fP.stop(),t.prototype.stop.call(this)},n.step=function(t){if(!this._paused&&0!==this._speed){var i=this.fP;i&&(t*=this._speed,i.step(t),i.isDone()&&(i.startWithTarget(this.target),i.step(i.getElapsed()-i.getDurationScaled())))}},n.update=function(){it(1007)},n.isDone=function(){return!1},n.reverse=function(){if(this.fP){var t=new i(this.fP.reverse());return this.iP(t),t}return this},n.setInnerAction=function(t){this.fP!==t&&(this.fP=t)},n.getInnerAction=function(){return this.fP},n.isUnknownDuration=function(){return!!this.fP&&this.fP.isUnknownDuration()},n.toString=function(){return"<RepeatForever>"},i}(Let);function Get(t){return new xet(t)}function jet(t,i){var n=new Het;return n.initWithTwoActions(t,i),n}var Het=function(t){function i(i){var n;if((n=t.call(this)||this).vP=null,n.lP=null,n.dP=!1,!i||0===i.length)return f(n);1===i.length&&i.push(new Cet);var e=i.length-1;if(e>=0&&null==i[e]&&it(1015),e>=0){for(var r=i[0],s=1;s<e;s++)i[s]&&(r=jet(r,i[s]));n.initWithTwoActions(r,i[e])}return n}s(i,t);var n=i.prototype;return n.initWithTwoActions=function(t,i){if(!t||!i)return ut(1027),!1;var n=!1,e=t.getDurationScaled(),r=i.getDurationScaled();return this.initWithDuration(Math.max(e,r))&&(this.vP=t,this.lP=i,e>r?this.lP=Fet(i,$et(e-r)):e<r&&(this.vP=Fet(t,$et(r-e))),n=!0),n},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),this.vP&&this.lP&&t.initWithTwoActions(this.vP.clone(),this.lP.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.vP&&this.vP.startWithTarget(i),this.lP&&this.lP.startWithTarget(i)},n.stop=function(){this.vP&&this.vP.stop(),this.lP&&this.lP.stop(),t.prototype.stop.call(this)},n.update=function(t){this.vP&&(this.dP&&!this.vP.isUnknownDuration()||this.vP.update(t)),this.lP&&(this.dP&&!this.lP.isUnknownDuration()||this.lP.update(t)),this.dP=1===t},n.reverse=function(){if(this.vP&&this.lP){var t=jet(this.vP.reverse(),this.lP.reverse());return this.iP(t),t}return this},n.hP=function(t){if(this.vP&&this.lP){this.lP.Lu||(this.lP.Lu=t);var n=this.vP;n instanceof i||n instanceof Pet?n.hP(t):n.Lu||(n.Lu=t)}},n.uP=function(t){var n=this.vP,e=this.lP,r=null,s=function(n){if(n.getId()===t)return n;if(n instanceof Pet||n instanceof i){var e=n.uP(t);if(e)return e}return null};return n&&(r=s(n))||e&&(r=s(e))?r:null},n.isUnknownDuration=function(){var t=this.vP,i=this.lP;if(null==t||null==i)return!1;var n=t.isUnknownDuration(),e=i.isUnknownDuration();if(n||e){if(n&&e)return!0;if(this.dP)return!0}return!1},n.toString=function(){return"<Spawn>"},i}(Let),Vet=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.update=function(){},n.reverse=function(){var t=new i(this._duration);return this.iP(t),t},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),t.initWithDuration(this._duration),t},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<DelayTime>"},i}(Let);function $et(t){return new Vet(t)}var Wet=function(t){function i(i){var n;return(n=t.call(this)||this).gP=null,i&&n.initWithAction(i),n}s(i,t);var n=i.prototype;return n.initWithAction=function(i){return i?i===this.gP?(ut(1029),!1):!!t.prototype.initWithDuration.call(this,i.getDurationScaled())&&(this.gP=i,!0):(ut(1028),!1)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.iP(t),this.gP&&t.initWithAction(this.gP.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.gP&&this.gP.startWithTarget(i)},n.update=function(t){this.gP&&this.gP.update(1-t)},n.reverse=function(){return this.gP?this.gP.clone():this},n.stop=function(){this.gP&&this.gP.stop(),t.prototype.stop.call(this)},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<ReverseTime>"},i}(Let);function zet(t){return new Wet(t)}var Xet=function(t){function i(i,n,e){var r;return(r=t.call(this,i)||this).wP=n,r._P=e,r}s(i,t);var n=i.prototype;return n.clone=function(){return new i(this._duration,this.wP,this._P)},n.update=function(t){this.wP.apply(this,[this.target,t].concat(this._P))},n.reverse=function(){return this.clone()},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<ActionCustomUpdate>"},i}(Let),Yet=function(t){function i(i,n){var e;return(e=t.call(this)||this).dP=!1,e.wP=i,e._P=n,e}s(i,t);var n=i.prototype;return n.clone=function(){return new i(this.wP,this._P)},n.reverse=function(){return this.clone()},n.step=function(){throw new Error("should never go here")},n.update=function(){var t=k.game.deltaTime;this.dP=this.wP.apply(this,[this.target,t].concat(this._P))},n.isDone=function(){return this.dP},n.isUnknownDuration=function(){return!this.isDone()},n.toString=function(){return"<ActionUnknownDuration>"},i}(Eet);function Ket(t){var i=t.charAt(0);if(/[A-Z]/.test(i)){var n=(t=t.replace(i,i.toLowerCase())).split("-");if(2===n.length){var e=n[0];if("linear"===e)t="linear";else{var r=n[1];switch(e){case"quadratic":t="quad"+r;break;case"quartic":t="quart"+r;break;case"quintic":t="quint"+r;break;case"sinusoidal":t="sine"+r;break;case"exponential":t="expo"+r;break;case"circular":t="circ"+r;break;default:t=e+r}}}}return t}function qet(t){var i=" [Tween:] ",n=" option is not support in v + "+S,e=t;e.delay&&X(i+"delay"+n),e.repeat&&X(i+"repeat"+n),e.repeatDelay&&X(i+"repeatDelay"+n),e.interpolation&&X(i+"interpolation"+n),e.onStop&&X(i+"onStop"+n)}var Qet=t("TweenAction",function(t){function i(i,n,e){var r;if((r=t.call(this)||this).sP=!1,null==e)e=Object.create(null);else if(qet(e),e.easing&&"string"==typeof e.easing&&(e.easing=Ket(e.easing)),e.progress||(e.progress=r.progress),e.easing&&"string"==typeof e.easing){var s=e.easing;e.easing=Hc[s],e.easing||st(1031,s)}for(var h in r.mP=e,r.pP=Object.create(null),n){var u;if(n.hasOwnProperty(h)){var o=n[h];if("function"==typeof o)o=o();else if(null==o)continue;var a=void 0,c=void 0,f=void 0;void 0!==o.value?("function"==typeof(f=o.value)&&(f=f()),void 0!==o.easing&&("string"==typeof o.easing?(a=Hc[o.easing])||st(1031,o.easing):a=o.easing),void 0!==o.progress&&(c=o.progress)):f=o;var v=Object.create(null);v.start=v.current=v.end=null,v.keys=null,v.value=f,v.easing=a,v.progress=c,v.convert=o.convert,v.clone=o.clone,v.add=o.add,v.sub=o.sub,v.legacyProgress=null===(u=o.legacyProgress)||void 0===u||u,v.toFixed=o.toFixed,v.onStart=o.onStart,v.onStop=o.onStop,v.onComplete=o.onComplete,v.valid=!0,r.pP[h]=v}}return r.yP=n,r.initWithDuration(i),r}s(i,t);var n=i.prototype;return n.clone=function(){var t=new i(this._duration,this.yP,this.mP);return t.sP=this.sP,t.Lu=this.Lu,t._id=this._id,this.iP(t),t},n.reverse=function(){if(!this.mP.relative)return st(16382),new i(0,{});var t=new i(this._duration,this.yP,this.mP);return this.iP(t),t.sP=!this.sP,t.Lu=this.Lu,t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i);var n=this.JF();if(n){var e=!!this.mP.relative,r=this.pP,s=this.sP,h=function(){var t=n[u];if(void 0===t)return 0;var i=r[u],h=i.value;if("number"==typeof t)i.start=t,i.current=t,i.end=e?s?t-h:t+h:h;else if("object"==typeof t)if(i.legacyProgress){if(null==i.start){var o=t.constructor;i.start=new o,i.current=new o,i.end=new o}var a;a=h.getModifiableProperties?h.getModifiableProperties():Object.keys(h),i.keys=a;for(var c=0,f=a.length;c<f;++c){var v=a[c];isNaN(t[v])||(i.start[v]=t[v],i.current[v]=t[v],i.end[v]=e?s?t[v]-h[v]:t[v]+h[v]:h[v])}}else{var l=i.clone;if(!l)return st(16383,u),i.valid=!1,0;var d=i.add,g=i.sub;if(e&&(d||(st(16384,u),i.valid=!1),s&&!g&&(st(16385,u),i.valid=!1),!i.valid))return 0;i.start=l(t),i.current=l(t),i.end=e?s?g(t,h):d(t,h):l(h)}else if("string"==typeof t){var w=i.convert,_=function(t){if("number"==typeof t)return t;var i=t;return w&&(i=w(t)),"number"!=typeof i&&(i=Number(i),Number.isNaN(i))?(st(16386,""+t),null):i},m=_(h),p=_(t);if(null==m||null==p)return i.valid=!1,0;i.start=p,i.current=t,i.end=e?s?p-m:p+m:m}i.onStart&&i.onStart({relative:e,reversed:s,start:i.start,end:i.end})};for(var u in r)h();this.mP.onStart&&this.mP.onStart(n)}},n.stop=function(){var i=this.pP;for(var n in i){var e=i[n];e.valid&&e.onStop&&e.onStop()}t.prototype.stop.call(this)},n.update=function(t){var i=this.JF();if(i&&this.mP){var n=this.pP,e=this.mP,r=t;"function"==typeof e.easing&&(r=e.easing(t));var s=e.progress;for(var h in n){var u=n[h];if(u.valid){var o=u.easing?u.easing(t):r,a=u.progress?u.progress:s,c=u.start,f=u.end,v=u.current;if("number"==typeof v)u.current=a(c,f,u.current,o);else if("object"==typeof c)if(u.legacyProgress)for(var l=u.keys,d=0,g=l.length;d<g;++d){var w=l[d];u.current[w]=a(c[w],f[w],u.current[w],o)}else u.current=a(c,f,u.current,o);else if("string"==typeof v){var _,m=a(c,f,u.current,o);if("number"==typeof m)m=m.toFixed(null!==(_=u.toFixed)&&void 0!==_?_:0);else if("string"!=typeof m){st(16387);continue}u.current=m}i[h]=u.current,1===t&&u.onComplete&&u.onComplete()}}e.onUpdate&&e.onUpdate(i,t),1===t&&e.onComplete&&e.onComplete(i)}},n.progress=function(t,i,n,e){return t+(i-t)*e},n.isUnknownDuration=function(){return!1},e(i,[{key:"relative",get:function(){return!!this.mP.relative}}]),i}(Let)),Zet=function(t){function i(i){var n;return(n=t.call(this)||this).pP=void 0,n.pP={},i&&n.init(i),n}s(i,t);var n=i.prototype;return n.init=function(t){for(var i in t)this.pP[i]=t[i];return!0},n.update=function(){var t=this.pP,i=this.JF();for(var n in t)i[n]=t[n]},n.clone=function(){var t=new i;return t._id=this._id,t.init(this.pP),t},n.isUnknownDuration=function(){return!1},i}(ket);function Jet(){return Aet.instance.ActionManager}var trt,irt,nrt,ert,rrt,srt,hrt,urt,ort,art,crt,frt,vrt,lrt,drt,grt,wrt,_rt,mrt,prt,yrt,brt,Art,Ert,krt,Trt,Srt,Ort=t("Tween",function(){function t(t){this.nP=[],this.bP=null,this.ki=null,this.AP=-1,this.Pi=1,this.ki=void 0===t?null:t}var i=t.prototype;return i.tag=function(t){return this.AP=t,this},i.id=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){return this.nP.length>0&&this.nP[this.nP.length-1].setId(t),this})),i.then=function(t){var i=t.EP(!0);return i&&(i.setSpeed(t.Pi),this.nP.push(i)),this},i.reverse=function(i,n){if(null==i&&null==n)return this.kP();var e,r;if(i instanceof t?(e=i,void 0!==n&&(r=n)):"number"==typeof i&&(e=this,r=i),e){var s=t.TP(e,r);s&&this.nP.push(s)}return this},i.kP=function(){if(0===this.nP.length)return st(16388),this.clone(this.ki);var t=this.EP(!1),i=Rrt(this.ki);return i.Pi=this.Pi,t&&i.SP(t.reverse()),i},t.TP=function(t,i){var n=t.nP;if(0===n.length)return null;var e=null,r=null;return"number"==typeof i?e=t.uP(i,n):t&&(e=t.EP(!1)),e?(r=e.reverse()).Lu=t:st(16391,""+i),r},i.uP=function(t,i){for(var n=null,e=0,r=i.length;e<r;++e){if((n=i[e]).getId()===t)return n;if((n instanceof Pet||n instanceof Het)&&(n=n.uP(t)))return n}return null},i.SP=function(t){var i=t.clone();return this.OP(i),this.nP.push(i),this},i.OP=function(t){t&&(t instanceof Pet||t instanceof Het?t.hP(this):t.Lu||(t.Lu=this))},i.target=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){return this.ki=t,this})),i.getTarget=function(){return this.ki},i.start=function(t){if(void 0===t&&(t=0),!this.ki)return st(16392),this;this.bP&&Jet().removeAction(this.bP);var i=this.RP();return this.bP=i,i?(i.setTag(this.AP),i.setSpeed(this.Pi),i.setStartTime(t),i.setPaused(!1),Jet().addAction(i,this.ki,!1)):st(16393),this},i.stop=function(){return this.bP&&(this.bP.stop(),Jet().removeAction(this.bP),this.bP=null),this},i.pause=function(){return this.bP?this.bP.setPaused(!0):st(16389),this},i.resume=function(){return this.bP?this.bP.setPaused(!1):st(16390),this},i.clone=function(t){var i=this.EP(!1),n=Rrt(null!=t?t:this.ki);return n.Pi=this.Pi,i?n.SP(i):n},i.union=function(t){var i,n=this;if(void 0===t)return i=n.EP(!1),n.nP.length=0,i&&n.nP.push(i),this;var e=this.nP,r=e.findIndex((function(i){return i.getId()===t}));if(e.length>1){var s=e.splice(r);1===s.length?e.push(s[0]):e.push(Bet(s))}return this},i.to=function(t,i,n){var e=n||Object.create(null);e.relative=!1;var r=new Qet(t,i,e);return this.nP.push(r),this},i.by=function(t,i,n){var e=n||Object.create(null);e.relative=!0;var r=new Qet(t,i,e);return this.nP.push(r),this},i.update=function(t,i){for(var n=arguments.length,e=new Array(n>2?n-2:0),r=2;r<n;r++)e[r-2]=arguments[r];var s=new Xet(t,i,e);return this.nP.push(s),this},i.updateUntil=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];var r=new Yet(t,n);return this.nP.push(r),this},i.set=function(t){var i=new Zet(t);return this.nP.push(i),this},i.delay=function(t){var i=$et(t);return this.nP.push(i),this},i.call=function(t,i,n){var e=Net(t,i,n);return this.nP.push(e),this},i.sequence=function(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];var r=t.IP(n);return r&&this.nP.push(r),this},i.parallel=function(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];var r=t.MP(n);return r&&this.nP.push(r),this},i.timeScale=function(t){return this.Pi=t,this.bP&&this.bP.setSpeed(t),this},i.getTimeScale=function(){return this.Pi},i.repeat=function(i,n){if(i===1/0)return this.repeatForever(n);var e,r=this.nP;return(e=n instanceof t?n.EP(!1):r.pop())&&r.push(Uet(e,i)),this},i.repeatForever=function(i){var n,e=this.nP;return(n=i instanceof t?i.EP(!1):e.pop())&&0!==e.length?e.push(Uet(n,Number.MAX_SAFE_INTEGER)):n instanceof Let?e.push(Get(n)):st(16394),this},i.reverseTime=function(i){var n,e=this.nP;return(n=i instanceof t?i.EP(!1):e.pop())instanceof Let?e.push(zet(n)):st(16395),this},i.hide=function(){if(this.ki instanceof Xp){var t=new Oet;this.nP.push(t)}return this},i.show=function(){if(this.ki instanceof Xp){var t=new Tet;this.nP.push(t)}return this},i.removeSelf=function(){if(this.ki instanceof Xp){var t=Iet(!1);this.nP.push(t)}return this},i.destroySelf=function(){if(this.ki instanceof Xp){var t=Iet(!0);this.nP.push(t)}return this},t.getRunningCount=function(t){return Jet().getNumberOfRunningActionsInTarget(t)},t.stopAll=function(){Jet().removeAllActions()},t.stopAllByTag=function(t,i){Jet().removeAllActionsByTag(t,i)},t.stopAllByTarget=function(t){Jet().removeAllActionsFromTarget(t)},t.pauseAllByTarget=function(t){Jet().pauseTarget(t)},t.resumeAllByTarget=function(t){Jet().resumeTarget(t)},i.EP=function(t){var i=this.nP;if(0===i.length)return null;var n=Bet(i);return t&&this.OP(n),n},i.RP=function(){var t=this.nP;return 0===t.length?null:1===t.length&&t[0]instanceof xet?t[0]:Bet(t)},t.NP=function(i){var n=t.CP;n.length=0;for(var e=i.length,r=0;r<e;r++){var s=i[r],h=s.EP(!0);h&&(h.setSpeed(s.Pi),n.push(h))}},t.IP=function(i){t.NP(i);var n=Bet(t.CP);return this.CP.length=0,n},t.MP=function(i){t.NP(i);var n,e=(n=t.CP,new Het(n));return this.CP.length=0,e},e(t,[{key:"running",get:function(){return!!this.bP&&Jet().isActionRunning(this.bP)}},{key:"duration",get:function(){return this.bP?this.bP.getDuration():0}}]),t}());function Rrt(t){return new Ort(t)}function Irt(t){return st(16396),new Ort(t)}Ort.CP=[],T.Tween=Ort,T.tween=Rrt,T.tweenUtil=Irt;var Mrt=new cr,Nrt={NONE:0,COLOR:1,SPRITE:2,SCALE:3};Fi(Nrt);var Crt={CLICK:"click"},Lrt=(trt=Ko("cc.Button"),irt=Qo(110),nrt=qo(ZB),ert=Ca(Xp),rrt=Ca(Nrt),srt=Ca(zF),hrt=Ca(zF),urt=Ca(zF),ort=Ca(zF),art=Ca([d_]),trt(crt=irt(crt=nrt((Srt=function(t){function i(){var i;return(i=t.call(this)||this).clickEvents=vrt&&vrt(),i._interactable=lrt&&lrt(),i._transition=drt&&drt(),i._normalColor=grt&&grt(),i._hoverColor=wrt&&wrt(),i._pressedColor=_rt&&_rt(),i._disabledColor=mrt&&mrt(),i._normalSprite=prt&&prt(),i._hoverSprite=yrt&&yrt(),i._pressedSprite=brt&&brt(),i._disabledSprite=Art&&Art(),i._duration=Ert&&Ert(),i._zoomScale=krt&&krt(),i._target=Trt&&Trt(),i.LP=!1,i.FP=!1,i.PP=new cr,i.BP=new cr,i.YL=0,i.DP=!0,i.xP=nr(),i.GP=nr(),i.jP=null,i.HP=null,i.VP=nr(),i}s(i,t);var n=i.prototype;return n.__preload=function(){this.target||(this.target=this.node),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},n.update=function(t){var i=this.target;if(!this.DP&&i&&(1===this._transition||3===this._transition)){this.YL+=t;var n=1;if(this._duration>0&&(n=this.YL/this._duration),n>=1&&(n=1),1===this._transition){var e=i._uiProps.uiComp;cr.lerp(Mrt,this.PP,this.BP,n),e&&(e.color=Mrt)}else 3===this.transition&&(i.getScale(this.VP),this.VP.x=ie(this.xP.x,this.GP.x,n),this.VP.y=ie(this.xP.y,this.GP.y,n),i.setScale(this.VP));1===n&&(this.DP=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target.Zs()},n._resetState=function(){this.LP=!1,this.FP=!1;var t=this.target;if(t){var i=this._transition;if(1===i&&this._interactable){var n=t.getComponent(wD);n&&(n.color=this._normalColor)}else 3===i&&this.jP&&t.setScale(this.jP);this.DP=!0}},n._registerNodeEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t),i.on("touch-move",t._onTouchMove,t),i.on("touch-end",t._onTouchEnded,t),i.on("touch-cancel",t._onTouchCancel,t),i.on("mouse-enter",t._onMouseMoveIn,t),i.on("mouse-leave",t._onMouseMoveOut,t)},n._registerTargetEvent=function(t){t.on("transform-changed",this.$P,this)},n._unregisterNodeEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t),i.off("touch-move",t._onTouchMove,t),i.off("touch-end",t._onTouchEnded,t),i.off("touch-cancel",t._onTouchCancel,t),i.off("mouse-enter",t._onMouseMoveIn,t),i.off("mouse-leave",t._onMouseMoveOut,t)},n._unregisterTargetEvent=function(t){t.off("transform-changed")},n._getTargetSprite=function(t){var i=null;return t&&(i=t.getComponent(MU)),i},n._applyTarget=function(){this.target&&(this.HP=this._getTargetSprite(this.target),this.jP||(this.jP=new ir),ir.copy(this.jP,this.target.scale),this._registerTargetEvent(this.target))},n.WP=function(t){2===this._transition&&this.zP(t.spriteFrame)},n.zP=function(t){if(t)switch(this._getButtonState()){case 0:this._normalSprite=t;break;case 1:this._hoverSprite=t;break;case 2:this._pressedSprite=t;break;case 3:this._disabledSprite=t}},n.XP=function(t){1===this._transition&&this.YP(t)},n.YP=function(t){switch(this._getButtonState()){case 0:this._normalColor=t;break;case 1:this._hoverColor=t;break;case 2:this._pressedColor=t;break;case 3:this._disabledColor=t}},n.$P=function(t){4&t&&this.jP&&3===this._transition&&this.DP&&ir.copy(this.jP,this.target.scale)},n._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this.LP=!0,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this.LP&&t){var i=t.touch;if(i){var n,e=this.node.Zs().hitTest(i.getLocation(),t.windowId);3===this._transition&&this.target&&this.jP?e?(ir.copy(this.xP,this.jP),ir.multiplyScalar(this.GP,this.jP,this._zoomScale),this.DP=!1):(this.YL=0,this.DP=!0,this.target.setScale(this.jP)):(n=e?2:0,this._applyTransition(n)),t&&(t.propagationStopped=!0)}}},n._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this.LP&&(d_.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this.LP=!1,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this.LP=!1,this._updateState())},n._onMouseMoveIn=function(){!this.LP&&this.interactable&&this.enabledInHierarchy&&(2!==this._transition||this._hoverSprite)&&(this.FP||(this.FP=!0,this._updateState()))},n._onMouseMoveOut=function(){this.FP&&(this.FP=!1,this._updateState())},n._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},n._getButtonState=function(){var t=0;return this._interactable?this.LP?t=2:this.FP&&(t=1):t=3,t},n._updateColorTransition=function(t){var i,n=this.KP(t),e=null==(i=this.target)?void 0:i.getComponent(wD);e&&(3===t?(e.color=n,this.DP=!0):(this.PP=e.color.clone(),this.BP=n,this.YL=0,this.DP=!1))},n._updateSpriteTransition=function(t){var i=this.qP(t);this.HP&&i&&(this.HP.spriteFrame=i)},n._updateScaleTransition=function(t){this._interactable&&(2===t?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this.jP&&(ir.copy(this.xP,this.jP),ir.multiplyScalar(this.GP,this.jP,this._zoomScale),this.YL=0,this.DP=!1)},n._zoomBack=function(){this.target&&this.jP&&(ir.copy(this.xP,this.target.scale),ir.copy(this.GP,this.jP),this.YL=0,this.DP=!1)},n._applyTransition=function(t){var i=this._transition;1===i?this._updateColorTransition(t):2===i?this._updateSpriteTransition(t):3===i&&this._updateScaleTransition(t)},n.qP=function(t){switch(t){case 0:return this._normalSprite;case 3:return this._disabledSprite;case 1:return this.hoverSprite;case 2:return this._pressedSprite;default:return null}},n.KP=function(t){switch(t){case 0:return this._normalColor;case 3:return this._disabledColor;case 1:return this._hoverColor;case 2:return this._pressedColor;default:return new cr}},n.QP=function(){},n.ZP=function(){},n.JP=function(){},n.tB=function(){},e(i,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(1===this._transition?this._updateColorTransition(0):2===this._transition&&this._updateSpriteTransition(0),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var i=this.node.getComponent(MU);i&&(i.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),i}(w_),Srt.Transition=Nrt,Srt.EventType=Crt,m((frt=Srt).prototype,"target",[ert],Object.getOwnPropertyDescriptor(frt.prototype,"target"),frt.prototype),m(frt.prototype,"transition",[rrt],Object.getOwnPropertyDescriptor(frt.prototype,"transition"),frt.prototype),m(frt.prototype,"normalSprite",[srt],Object.getOwnPropertyDescriptor(frt.prototype,"normalSprite"),frt.prototype),m(frt.prototype,"pressedSprite",[hrt],Object.getOwnPropertyDescriptor(frt.prototype,"pressedSprite"),frt.prototype),m(frt.prototype,"hoverSprite",[urt],Object.getOwnPropertyDescriptor(frt.prototype,"hoverSprite"),frt.prototype),m(frt.prototype,"disabledSprite",[ort],Object.getOwnPropertyDescriptor(frt.prototype,"disabledSprite"),frt.prototype),vrt=xo(frt.prototype,"clickEvents",[art,oa],(function(){return[]})),lrt=xo(frt.prototype,"_interactable",[oa],(function(){return!0})),drt=xo(frt.prototype,"_transition",[oa],(function(){return 0})),grt=xo(frt.prototype,"_normalColor",[oa],(function(){return cr.WHITE.clone()})),wrt=xo(frt.prototype,"_hoverColor",[oa],(function(){return new cr(211,211,211,255)})),_rt=xo(frt.prototype,"_pressedColor",[oa],(function(){return cr.WHITE.clone()})),mrt=xo(frt.prototype,"_disabledColor",[oa],(function(){return new cr(124,124,124,255)})),prt=xo(frt.prototype,"_normalSprite",[oa],(function(){return null})),yrt=xo(frt.prototype,"_hoverSprite",[oa],(function(){return null})),brt=xo(frt.prototype,"_pressedSprite",[oa],(function(){return null})),Art=xo(frt.prototype,"_disabledSprite",[oa],(function(){return null})),Ert=xo(frt.prototype,"_duration",[oa],(function(){return.1})),krt=xo(frt.prototype,"_zoomScale",[oa],(function(){return 1.2})),Trt=xo(frt.prototype,"_target",[oa],(function(){return null})),crt=frt))||crt)||crt)||crt);t({Button:Lrt,ButtonComponent:Lrt}),T.Button=Lrt;var Frt=function(){function t(){}return t.add=function(t){var i=this._tabIndexList;-1===i.indexOf(t)&&i.push(t)},t.remove=function(t){var i=this._tabIndexList,n=i.indexOf(t);-1!==n&&i.splice(n,1)},t.resort=function(){this._tabIndexList.sort((function(t,i){return t._delegate.tabIndex-i._delegate.tabIndex}))},t.next=function(t){var i=this._tabIndexList,n=i.indexOf(t);if(t.setFocus(!1),-1!==n){var e=i[n+1];e&&e._delegate.tabIndex>=0&&e.setFocus(!0)}},t}();Frt._tabIndexList=[];var Prt=function(){function t(){this._editing=!1,this._delegate=null}var i=t.prototype;return i.init=function(){},i.onEnable=function(){},i.beforeDraw=function(){},i.onDisable=function(){this._editing&&this.endEditing()},i.clear=function(){this._delegate=null},i.setTabIndex=function(){},i.setSize=function(){},i.setFocus=function(t){t?this.beginEditing():this.endEditing()},i.isFocused=function(){return this._editing},i.beginEditing=function(){},i.endEditing=function(){},t}(),Brt=O.document,Drt=new Kr,Urt=new Kr,xrt=new ir,Grt=null,jrt=0,Hrt=function(t){function i(){var i;return(i=t.call(this)||this)._delegate=null,i._inputMode=-1,i._inputFlag=-1,i._returnType=-1,i.__eventListeners={},i.__autoResize=!1,i.__orientationChanged=void 0,i._edTxt=null,i.iB=!1,i.nB=null,i.eB=null,i.rB=null,i.sB=null,i.hB=null,i.uB=null,i.oB=null,i.aB=null,i.cB=null,i.fB=null,i.vB="EditBoxId_"+ ++jrt,i.lB=!1,i}s(i,t);var n=i.prototype;return n.init=function(t){t&&(this._delegate=t,0===t.inputMode?this.dB():this.gB(),Frt.add(this),this.setTabIndex(t.tabIndex),this.wB(),this._B(),this.mB(),yL.instance.on("canvas-resize",this.pB,this),eo.on("window-resize",this.pB,this))},n.clear=function(){yL.instance.off("canvas-resize",this.pB,this),eo.off("window-resize",this.pB,this),this.yB(),this.bB(),Frt.remove(this),Grt===this&&(Grt=null),this._delegate=null},n.pB=function(){this.lB=!0},n.beforeDraw=function(){(this._delegate.node.hasChangedFlags||this.lB)&&(this.lB=!1,this.AB())},n.setTabIndex=function(t){this._edTxt.tabIndex=t,Frt.resort()},n.setSize=function(t,i){var n=this._edTxt;n&&(n.style.width=t+"px",n.style.height=i+"px")},n.beginEditing=function(){Grt&&Grt!==this&&Grt.setFocus(!1),this._editing=!0,Grt=this,this._delegate._editBoxEditingDidBegan(),this.EB(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n.gB=function(){this.iB=!1,this._edTxt=Brt.createElement("input")},n.dB=function(){this.iB=!0,this._edTxt=Brt.createElement("textarea")},n.mB=function(){UL.container&&this._edTxt&&(UL.container.appendChild(this._edTxt),Brt.head.appendChild(this.fB))},n.bB=function(){Ki(UL.container,this._edTxt)&&this._edTxt&&UL.container.removeChild(this._edTxt),Ki(Brt.head,this.fB)&&Brt.head.removeChild(this.fB),this._edTxt=null,this.fB=null},n.EB=function(){this.kB(),this.TB(),this.SB(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),ho.isMobile&&this.OB()},n.RB=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),ho.isMobile&&this.IB()},n.OB=function(){ho.os!==Nu.ANDROID&&ho.os!==Nu.OHOS||(eo.handleResizeEvent=!1,this.MB())},n.IB=function(){ho.os!==Nu.ANDROID&&ho.os!==Nu.OHOS||(eo.handleResizeEvent=!0),this.NB()},n.CB=function(){if(this._edTxt){var t=this._edTxt.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(O.innerHeight||Brt.documentElement.clientHeight)&&t.right<=(O.innerWidth||Brt.documentElement.clientWidth)}return!1},n.MB=function(){var t=this;setTimeout((function(){O.scrollY<40&&!t.CB()&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n.NB=function(){setTimeout((function(){ho.browserType!==Ru.WECHAT||ho.os!==Nu.IOS?O.scrollTo(0,0):O.top&&O.top.scrollTo(0,0)}),400)},n.AB=function(){if(this._edTxt){var t=this._delegate.node,i=NL.getScaleX(),n=NL.getScaleY(),e=NL.getViewportRect(),r=eo.devicePixelRatio;t.getWorldMatrix(Drt);var s=t.Zs();if(s&&(ir.set(xrt,-s.anchorX*s.width,-s.anchorY*s.height,xrt.z),Kr.transform(Drt,Drt,xrt)),t.Zs()){var h=xC.root.batcher2D.getFirstRenderCamera(t);if(h){h.node.getWorldRT(Urt);var u=Urt.m12,o=Urt.m13,a=uo.center;Urt.m12=a.x-(Urt.m00*u+Urt.m04*o),Urt.m13=a.y-(Urt.m01*u+Urt.m05*o),i/=r,n/=r,ir.set(xrt,i,n,1),Kr.scale(Urt,Urt,xrt);var c=UL.container,f=parseInt(c&&c.style.paddingLeft||"0");f+=e.x/r;var v=parseInt(c&&c.style.paddingBottom||"0");v+=e.y/r,Urt.m12+=f,Urt.m13+=v,Kr.multiply(Urt,Urt,Drt);var l="matrix("+Urt.m00+","+-Urt.m01+","+-Urt.m04+","+Urt.m05+","+Urt.m12+","+-Urt.m13+")";this._edTxt.style.transform=l,this._edTxt.style["-webkit-transform"]=l,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n.TB=function(){var t=this._delegate,i=t.inputMode,n=t.inputFlag,e=t.returnType,r=this._edTxt;if(this._inputMode!==i||this._inputFlag!==n||this._returnType!==e){if(this._inputMode=i,this._inputFlag=n,this._returnType=e,this.iB){var s="none";return 4===n?s="uppercase":2===n&&(s="capitalize"),void(r.style.textTransform=s)}if(0===n)return r.type="password",void(r.style.textTransform="none");var h=r.type;1===i?h="email":2===i?h="number":5===i?h="digit":3===i?(h="tel",r.addEventListener("wheel",(function(){return!1}))):4===i?h="url":(h="text",3===e&&(h="search")),r.type=h;var u="none";4===n?u="uppercase":2===n&&(u="capitalize"),r.style.textTransform=u}},n.kB=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n.wB=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this.vB,this.iB?(t.style.resize="none",t.style.overflowY="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this.fB=Brt.createElement("style")}},n.SB=function(){var t=this._delegate,i=this._edTxt;i&&t&&(i.value=t.string,this.LB(t.textLabel))},n.LB=function(t){if(t){var i=t.font;i=!i||i instanceof tB?t.fontFamily:i._fontFamily;var n=t.fontSize*t.node.scale.y;if((this.nB!==i||this.eB!==n||this.rB!==t.fontColor||this.sB!==t.horizontalAlign)&&(this.nB=i,this.eB=n,this.rB=t.fontColor,this.sB=t.horizontalAlign,this._edTxt)){var e=this._edTxt;switch(e.style.fontSize=n+"px",e.style.color=t.color.toCSS(),e.style.fontFamily=i,t.horizontalAlign){case TU.HorizontalAlign.LEFT:e.style.textAlign="left";break;case TU.HorizontalAlign.CENTER:e.style.textAlign="center";break;case TU.HorizontalAlign.RIGHT:e.style.textAlign="right"}}}},n.FB=function(t){if(t){var i=t.font;i=!i||i instanceof tB?t.fontFamily:t.font._fontFamily;var n=t.fontSize*t.node.scale.y;if(this.hB!==i||this.uB!==n||this.oB!==t.fontColor||this.aB!==t.horizontalAlign||this.cB!==t.fontSize){this.hB=i,this.uB=n,this.oB=t.fontColor,this.aB=t.horizontalAlign,this.cB=t.fontSize;var e=this.fB,r=t.color.toCSS(),s=t.fontSize,h="";switch(t.horizontalAlign){case TU.HorizontalAlign.LEFT:h="left";break;case TU.HorizontalAlign.CENTER:h="center";break;case TU.HorizontalAlign.RIGHT:h="right"}e.innerHTML="#"+this.vB+"::-webkit-input-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+r+";line-height: "+s+"px;text-align: "+h+";}#"+this.vB+"::-moz-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+r+";line-height: "+s+"px;text-align: "+h+";}#"+this.vB+"::-ms-input-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+r+";line-height: "+s+"px;text-align: "+h+";}",ho.browserType===Ru.EDGE&&(e.innerHTML+="#"+this.vB+"::-ms-clear{display: none;}")}}},n._B=function(){var t=this;if(this._edTxt){var i=this._edTxt,n=!1,e=this.__eventListeners;e.compositionStart=function(){n=!0},e.compositionEnd=function(){n=!1,t._delegate._editBoxTextChanged(i.value)},e.onInput=function(){if(!n){var e=t._delegate,r=e.maxLength;r>=0&&"number"!==i.type&&(i.value=i.value.slice(0,r)),e._editBoxTextChanged(i.value)}},e.onClick=function(){t._editing&&ho.isMobile&&t.MB()},e.onKeydown=function(n){13===n.keyCode?(n.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t.iB||i.blur()):9===n.keyCode&&(n.propagationStopped=!0,n.preventDefault(),Frt.next(t))},e.onBlur=function(){ho.isMobile&&n&&e.compositionEnd(),t._editing=!1,Grt=null,t.RB(),t._delegate._editBoxEditingDidEnded()},i.addEventListener("compositionstart",e.compositionStart),i.addEventListener("compositionend",e.compositionEnd),i.addEventListener("input",e.onInput),i.addEventListener("keydown",e.onKeydown),i.addEventListener("blur",e.onBlur),i.addEventListener("touchstart",e.onClick)}},n.yB=function(){if(this._edTxt){var t=this._edTxt,i=this.__eventListeners;t.removeEventListener("compositionstart",i.compositionStart),t.removeEventListener("compositionend",i.compositionEnd),t.removeEventListener("input",i.onInput),t.removeEventListener("keydown",i.onKeydown),t.removeEventListener("blur",i.onBlur),t.removeEventListener("touchstart",i.onClick),i.compositionStart=null,i.compositionEnd=null,i.onInput=null,i.onKeydown=null,i.onBlur=null,i.onClick=null}},i}(Prt),Vrt={DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5};Ni(Vrt);var $rt={ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6};Ni($rt);var Wrt,zrt,Xrt,Yrt,Krt,qrt,Qrt,Zrt,Jrt,tst,ist,nst,est,rst,sst,hst,ust,ost,ast,cst,fst,vst,lst,dst,gst,wst,_st,mst,pst,yst={PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5};Ni(yst);var bst,Ast,Est,kst,Tst,Sst,Ost,Rst,Ist,Mst,Nst,Cst,Lst,Fst,Pst,Bst,Dst,Ust,xst,Gst,jst,Hst,Vst,$st,Wst,zst,Xst,Yst,Kst=(Wrt=Ko("cc.EditBox"),zrt=Qo(110),Xrt=qo(ZB),Yrt=Ca(TU),Krt=Ca(TU),qrt=Ca(zF),Qrt=Ca(yst),Zrt=Ca($rt),Jrt=Ca(Vrt),tst=Ca([d_]),ist=Ca([d_]),nst=Ca([d_]),est=Ca([d_]),Wrt(rst=zrt(rst=Xrt((pst=function(t){function i(){var i;return(i=t.call(this)||this).editingDidBegan=hst&&hst(),i.textChanged=ust&&ust(),i.editingDidEnded=ost&&ost(),i.editingReturn=ast&&ast(),i._impl=null,i._background=null,i._textLabel=cst&&cst(),i._placeholderLabel=fst&&fst(),i._returnType=vst&&vst(),i._string=lst&&lst(),i._tabIndex=dst&&dst(),i._backgroundImage=gst&&gst(),i._inputFlag=wst&&wst(),i._inputMode=_st&&_st(),i._maxLength=mst&&mst(),i.PB=!1,i}s(i,t);var n=i.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n.BB=function(){this._impl&&this._impl.beforeDraw()},n.onDisable=function(){this._unregisterEvent(),this.DB(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){xC.off("director_before_draw",this.BB,this),this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){d_.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},n._editBoxEditingDidEnded=function(t){d_.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this,t)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,d_.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)},n._editBoxEditingReturn=function(t){d_.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this,t)},n._showLabels=function(){this.PB=!0,this._updateLabels()},n._hideLabels=function(){this.PB=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this.PB=!0,this.node.on("size-changed",this._resizeChildNodes,this),xC.on("director_before_draw",this.BB,this),(this._impl=new i._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(MU);t||(t=this.node.addComponent(MU)),t!==this._background&&(t.type=MU.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this.UB())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var i=this.node.getChildByName("TEXT_LABEL");i||((i=new Xp("TEXT_LABEL")).layer=this.node.layer),(t=i.getComponent(TU))||(t=i.addComponent(TU)),i.parent=this.node,this._textLabel=t}0===this._inputMode?(t.verticalAlign=0,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var i=this.node.getChildByName("PLACEHOLDER_LABEL");i||((i=new Xp("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=i.getComponent(TU))||(t=i.addComponent(TU)),i.parent=this.node,this._placeholderLabel=t}0===this._inputMode?t.enableWrapText=!0:t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node.Zs(),i=t.contentSize;if(this._background){var n=this._background.node.Zs();n.anchorPoint=t.anchorPoint,n.setContentSize(i)}this._updateLabelPosition(i),this._impl&&this._impl.setSize(i.width,i.height)},n._updateLabels=function(){if(this.PB){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var i=this._textLabel;if(i){var n=t;n&&(n=this._updateLabelStringStyle(n)),i.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(t,i){void 0===i&&(i=!1);var n,e=this._inputFlag;if(i||0!==e)4===e?t=t.toUpperCase():2===e?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):3===e&&(t=(n=t).charAt(0).toUpperCase()+n.slice(1));else{for(var r="",s=t.length,h=0;h<s;++h)r+="";t=r}return t},n._registerEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t),i.on("touch-end",t._onTouchEnded,t)},n._unregisterEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t),i.off("touch-end",t._onTouchEnded,t)},n.xB=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n.UB=function(){var t=this._background&&this._background.node;null==t||t.on("spriteframe-changed",this.xB,this)},n.DB=function(){var t=this._background&&this._background.node;null==t||t.off("spriteframe-changed",this.xB,this)},n._updateLabelPosition=function(t){var i=this.node.Zs(),n=-i.anchorX*i.width,e=-i.anchorY*i.height,r=this._placeholderLabel,s=this._textLabel;s&&(s.node.Zs().setContentSize(t.width-2,t.height),s.node.setPosition(n+2,e+t.height,s.node.position.z),0===this._inputMode&&(s.verticalAlign=0),s.enableWrapText=0===this._inputMode),r&&(r.node.Zs().setContentSize(t.width-2,t.height),r.node.setPosition(n+2,e+t.height,r.node.position.z),r.enableWrapText=0===this._inputMode)},n._resizeChildNodes=function(){var t=this.node.Zs(),i=this._textLabel&&this._textLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i.Zs().setContentSize(t.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-t.width/2,t.height/2,n.position.z),n.Zs().setContentSize(t.contentSize));var e=this._background&&this._background.node;e&&e.Zs().setContentSize(t.contentSize),this._syncSize()},n._xrUnClick=function(){},n._xrKeyBoardInput=function(){},e(i,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),i}(w_),pst._EditBoxImpl=Prt,pst.KeyboardReturnType=Vrt,pst.InputFlag=yst,pst.InputMode=$rt,pst.EventType={EDITING_DID_BEGAN:"editing-did-began",EDITING_DID_ENDED:"editing-did-ended",TEXT_CHANGED:"text-changed",EDITING_RETURN:"editing-return",XR_EDITING_DID_BEGAN:"xr-editing-did-began",XR_EDITING_DID_ENDED:"xr-editing-did-ended"},m((sst=pst).prototype,"textLabel",[Yrt],Object.getOwnPropertyDescriptor(sst.prototype,"textLabel"),sst.prototype),m(sst.prototype,"placeholderLabel",[Krt],Object.getOwnPropertyDescriptor(sst.prototype,"placeholderLabel"),sst.prototype),m(sst.prototype,"backgroundImage",[qrt],Object.getOwnPropertyDescriptor(sst.prototype,"backgroundImage"),sst.prototype),m(sst.prototype,"inputFlag",[Qrt],Object.getOwnPropertyDescriptor(sst.prototype,"inputFlag"),sst.prototype),m(sst.prototype,"inputMode",[Zrt],Object.getOwnPropertyDescriptor(sst.prototype,"inputMode"),sst.prototype),m(sst.prototype,"returnType",[Jrt],Object.getOwnPropertyDescriptor(sst.prototype,"returnType"),sst.prototype),hst=xo(sst.prototype,"editingDidBegan",[tst,oa],(function(){return[]})),ust=xo(sst.prototype,"textChanged",[ist,oa],(function(){return[]})),ost=xo(sst.prototype,"editingDidEnded",[nst,oa],(function(){return[]})),ast=xo(sst.prototype,"editingReturn",[est,oa],(function(){return[]})),cst=xo(sst.prototype,"_textLabel",[oa],(function(){return null})),fst=xo(sst.prototype,"_placeholderLabel",[oa],(function(){return null})),vst=xo(sst.prototype,"_returnType",[oa],(function(){return 0})),lst=xo(sst.prototype,"_string",[oa],(function(){return""})),dst=xo(sst.prototype,"_tabIndex",[oa],(function(){return 0})),gst=xo(sst.prototype,"_backgroundImage",[oa],(function(){return null})),wst=xo(sst.prototype,"_inputFlag",[oa],(function(){return 5})),_st=xo(sst.prototype,"_inputMode",[oa],(function(){return 0})),mst=xo(sst.prototype,"_maxLength",[oa],(function(){return 20})),rst=sst))||rst)||rst)||rst);t({EditBox:Kst,EditBoxComponent:Kst}),"object"==typeof window&&"object"==typeof document&&(Kst._EditBoxImpl=Hrt),T.internal.EditBox=Kst;var qst={NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3};Fi(qst);var Qst={NONE:0,CONTAINER:1,CHILDREN:2};Fi(Qst);var Zst={HORIZONTAL:0,VERTICAL:1};Fi(Zst);var Jst={BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1};Fi(Jst);var tht={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};Fi(tht);var iht={NONE:0,FIXED_ROW:1,FIXED_COL:2};Fi(iht);var nht,eht,rht,sht,hht,uht,oht,aht,cht,fht,vht,lht,dht,ght=new ir,wht=(bst=Ko("cc.Layout"),Ast=Qo(110),Est=qo(ZB),kst=Ca(qst),Tst=Ca(Qst),Sst=Ca(Zst),Ost=Ca(Jst),Rst=Ca(tht),Ist=Ca(iht),bst(Mst=Ast(Mst=Est((Yst=function(t){function i(){var i;return(i=t.call(this)||this)._resizeMode=Cst&&Cst(),i._layoutType=Lst&&Lst(),i._cellSize=Fst&&Fst(),i._startAxis=Pst&&Pst(),i._paddingLeft=Bst&&Bst(),i._paddingRight=Dst&&Dst(),i._paddingTop=Ust&&Ust(),i._paddingBottom=xst&&xst(),i._spacingX=Gst&&Gst(),i._spacingY=jst&&jst(),i._verticalDirection=Hst&&Hst(),i._horizontalDirection=Vst&&Vst(),i._constraint=$st&&$st(),i._constraintNum=Wst&&Wst(),i._affectedByScale=zst&&zst(),i._isAlign=Xst&&Xst(),i._layoutSize=new gs(300,200),i._layoutDirty=!0,i._childrenDirty=!1,i._usefulLayoutObj=[],i._init=!1,i}s(i,t);var n=i.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node.Zs();t.contentSize.equals(gs.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i],e=n.Zs();n.activeInHierarchy&&e&&this._usefulLayoutObj.push(e)}},n._addEventListeners=function(){xC.on("director_after_update",this.updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("sibling-order-changed",this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){xC.off("director_after_update",this.updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("sibling-order-changed",this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i];n.on("size-changed",this._doLayoutDirty,this),n.on("transform-changed",this._transformDirty,this),n.on("anchor-changed",this._doLayoutDirty,this),n.on("active-in-hierarchy-changed",this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i];n.off("size-changed",this._doLayoutDirty,this),n.off("transform-changed",this._transformDirty,this),n.off("anchor-changed",this._doLayoutDirty,this),n.off("active-in-hierarchy-changed",this._childrenChanged,this)}},n._childAdded=function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("transform-changed",this._transformDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off("size-changed",this._doLayoutDirty,this),t.off("transform-changed",this._transformDirty,this),t.off("anchor-changed",this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node.Zs().contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,i,n,e){var r=this.node.Zs().anchorPoint,s=this._getFixedBreakingNum(),h=1,u=this._paddingLeft;1===this._horizontalDirection&&(h=-1,u=this._paddingRight);var o=(this._horizontalDirection-r.x)*t+h*u,a=o-h*this._spacingX,c=0,f=0,v=0,l=0,d=!1,g=this._usefulLayoutObj.length,w=this._cellSize.width,_=this._getPaddingH();3!==this._layoutType&&2===this._resizeMode&&(w=(t-_-(g-1)*this._spacingX)/g);for(var m=this._usefulLayoutObj,p=0;p<m.length;++p){var y=m[p],b=y.node,A=b.scale,E=this._getUsedScaleValue(A.x),k=this._getUsedScaleValue(A.y);2===this._resizeMode&&(y.width=w/E,3===this._layoutType&&(y.height=this._cellSize.height/k));var T=Math.abs(this._horizontalDirection-y.anchorX),S=y.width*E,O=y.height*k;O>v&&(l=Math.max(v,l),f=v||O,v=O),a+=h*(T*S+this._spacingX);var R=h*(1-T)*S;if(i){if(s>0)(d=p/s>0&&p%s==0)&&(f=v>O?v:f);else if(S>t-_)a>o+h*T*S&&(d=!0);else{var I=(1-this._horizontalDirection-r.x)*t,M=a+R+h*(h>0?this._paddingRight:this._paddingLeft);d=Math.abs(M)>Math.abs(I)}d&&(a=o+h*T*S,O!==v&&(f=v),c+=f+this._spacingY,f=v=O)}var N=n(b,y,c);e&&b.setPosition(a,N),a+=R}return f=Math.max(f,v),Math.max(l,c+f)+this._getPaddingV()},n._doLayoutVertically=function(t,i,n,e){var r=this.node.Zs().anchorPoint,s=this._getFixedBreakingNum(),h=1,u=this._paddingBottom;1===this._verticalDirection&&(h=-1,u=this._paddingTop);var o=(this._verticalDirection-r.y)*t+h*u,a=o-h*this._spacingY,c=0,f=0,v=0,l=0,d=!1,g=this._usefulLayoutObj.length,w=this._cellSize.height,_=this._getPaddingV();3!==this._layoutType&&2===this._resizeMode&&(w=(t-_-(g-1)*this._spacingY)/g);for(var m=this._usefulLayoutObj,p=0;p<m.length;++p){var y=m[p],b=y.node,A=b.scale,E=this._getUsedScaleValue(A.x),k=this._getUsedScaleValue(A.y);2===this._resizeMode&&(y.height=w/k,3===this._layoutType&&(y.width=this._cellSize.width/E));var T=Math.abs(this._verticalDirection-y.anchorY),S=y.width*E,O=y.height*k;S>c&&(f=Math.max(c,f),v=c||S,c=S),a+=h*(T*O+this._spacingY);var R=h*(1-T)*O;if(i){if(s>0)(d=p/s>0&&p%s==0)&&(v=c>O?c:v);else if(O>t-_)a>o+h*T*O&&(d=!0);else{var I=(1-this._verticalDirection-r.y)*t,M=a+R+h*(h>0?this._paddingTop:this._paddingBottom);d=Math.abs(M)>Math.abs(I)}d&&(a=o+h*T*O,S!==c&&(v=c),l+=v+this._spacingX,v=c=S)}var N=n(b,y,l);e&&(b.getPosition(ght),b.setPosition(N,a,ght.z)),a+=R}return v=Math.max(v,c),Math.max(f,l+v)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,i){var n=this,e=i.width,r=1,s=-t.y*i.height,h=this._paddingBottom;1===this._verticalDirection&&(r=-1,s=(1-t.y)*i.height,h=this._paddingTop);var u=function(t,i,e){return s+r*(e+(1-i.anchorY)*i.height*n._getUsedScaleValue(t.scale.y)+h)},o=0;1===this._resizeMode&&(o=this._doLayoutHorizontally(e,!0,u,!1),s=-t.y*o,1===this._verticalDirection&&(r=-1,s=(1-t.y)*o)),this._doLayoutHorizontally(e,!0,u,!0),1===this._resizeMode&&this.node.Zs().setContentSize(e,o)},n._doLayoutGridAxisVertical=function(t,i){var n=this,e=i.height,r=1,s=-t.x*i.width,h=this._paddingLeft;1===this._horizontalDirection&&(r=-1,s=(1-t.x)*i.width,h=this._paddingRight);var u=function(t,i,e){return s+r*(e+(1-i.anchorX)*i.width*n._getUsedScaleValue(t.scale.x)+h)},o=0;1===this._resizeMode&&(o=this._doLayoutVertically(e,!0,u,!1),s=-t.x*o,1===this._horizontalDirection&&(r=-1,s=(1-t.x)*o)),this._doLayoutVertically(e,!0,u,!0),1===this._resizeMode&&this.node.Zs().setContentSize(o,e)},n._doLayoutGrid=function(){var t=this.node.Zs(),i=t.anchorPoint,n=t.contentSize;0===this.startAxis?this._doLayoutGridAxisHorizontal(i,n):1===this.startAxis&&this._doLayoutGridAxisVertical(i,n)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,i=0,n=t.length;if(1===this._resizeMode){for(var e=0;e<t.length;++e){var r=t[e],s=r.node.scale;i+=r.width*this._getUsedScaleValue(s.x)}i+=(n-1)*this._spacingX+this._getPaddingH()}else i=this.node.Zs().width;return i},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,i=0,n=t.length;if(1===this._resizeMode){for(var e=0;e<t.length;++e){var r=t[e],s=r.node.scale;i+=r.height*this._getUsedScaleValue(s.y)}i+=(n-1)*this._spacingY+this._getPaddingV()}else i=this.node.Zs().height;return i},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),1===this._layoutType){var i=this._getHorizontalBaseWidth();this._doLayoutHorizontally(i,!1,(function(i){return(t._isAlign?ir.ZERO:i.position).y}),!0),this.node.Zs().width=i}else if(2===this._layoutType){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(i){return(t._isAlign?ir.ZERO:i.position).x}),!0),this.node.Zs().height=n}else 3===this._layoutType&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){4&t&&1&t&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(3!==this._layoutType||0===this._constraint||this._constraintNum<=0)return 0;var t=1===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return 1===this._startAxis&&(t=2===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},e(i,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){1===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){2===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){0!==this._layoutType&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){0!==this._layoutType&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){0!==this._constraint&&this._constraintNum!==t&&(t<=0&&st(16400),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),i}(w_),Yst.Type=qst,Yst.VerticalDirection=Jst,Yst.HorizontalDirection=tht,Yst.ResizeMode=Qst,Yst.AxisDirection=Zst,Yst.Constraint=iht,m((Nst=Yst).prototype,"type",[kst],Object.getOwnPropertyDescriptor(Nst.prototype,"type"),Nst.prototype),m(Nst.prototype,"resizeMode",[Tst],Object.getOwnPropertyDescriptor(Nst.prototype,"resizeMode"),Nst.prototype),m(Nst.prototype,"startAxis",[Sst],Object.getOwnPropertyDescriptor(Nst.prototype,"startAxis"),Nst.prototype),m(Nst.prototype,"verticalDirection",[Ost],Object.getOwnPropertyDescriptor(Nst.prototype,"verticalDirection"),Nst.prototype),m(Nst.prototype,"horizontalDirection",[Rst],Object.getOwnPropertyDescriptor(Nst.prototype,"horizontalDirection"),Nst.prototype),m(Nst.prototype,"constraint",[Ist],Object.getOwnPropertyDescriptor(Nst.prototype,"constraint"),Nst.prototype),Cst=xo(Nst.prototype,"_resizeMode",[oa],(function(){return 0})),Lst=xo(Nst.prototype,"_layoutType",[oa],(function(){return 0})),Fst=xo(Nst.prototype,"_cellSize",[oa],(function(){return new gs(40,40)})),Pst=xo(Nst.prototype,"_startAxis",[oa],(function(){return 0})),Bst=xo(Nst.prototype,"_paddingLeft",[oa],(function(){return 0})),Dst=xo(Nst.prototype,"_paddingRight",[oa],(function(){return 0})),Ust=xo(Nst.prototype,"_paddingTop",[oa],(function(){return 0})),xst=xo(Nst.prototype,"_paddingBottom",[oa],(function(){return 0})),Gst=xo(Nst.prototype,"_spacingX",[oa],(function(){return 0})),jst=xo(Nst.prototype,"_spacingY",[oa],(function(){return 0})),Hst=xo(Nst.prototype,"_verticalDirection",[oa],(function(){return 1})),Vst=xo(Nst.prototype,"_horizontalDirection",[oa],(function(){return 0})),$st=xo(Nst.prototype,"_constraint",[oa],(function(){return 0})),Wst=xo(Nst.prototype,"_constraintNum",[oa],(function(){return 2})),zst=xo(Nst.prototype,"_affectedByScale",[oa],(function(){return!1})),Xst=xo(Nst.prototype,"_isAlign",[oa],(function(){return!1})),Mst=Nst))||Mst)||Mst)||Mst);t({Layout:wht,LayoutComponent:wht}),T.Layout=wht;var _ht={HORIZONTAL:0,VERTICAL:1,FILLED:2};Ni(_ht);var mht,pht,yht,bht,Aht,Eht,kht,Tht,Sht,Oht,Rht,Iht,Mht,Nht=(nht=Ko("cc.ProgressBar"),eht=Qo(110),rht=qo(ZB),sht=Ca(MU),hht=Ca(_ht),nht(uht=eht(uht=rht((dht=function(t){function i(){var i;return(i=t.call(this)||this)._barSprite=aht&&aht(),i._mode=cht&&cht(),i._totalLength=fht&&fht(),i._progress=vht&&vht(),i._reverse=lht&&lht(),i}s(i,t);var n=i.prototype;return n.onLoad=function(){this._updateBarStatus()},n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var i=this.node.Zs(),n=i.contentSize,e=i.anchorPoint,r=t.Zs().contentSize;if(2===this._barSprite.fillType&&(this._mode=2),0===this._mode?this.totalLength=r.width:1===this._mode?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var s=-n.width*e.x;t.setPosition(s,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var i=t.Zs(),n=i.anchorPoint,e=i.contentSize,r=new ls(0,.5),s=te(this._progress),h=this._totalLength*s,u=e,o=0,a=0;switch(this._mode){case 0:this._reverse&&(r=new ls(1,.5)),u=new gs(h,e.height),o=this._totalLength,a=e.height;break;case 1:r=this._reverse?new ls(.5,1):new ls(.5,0),u=new gs(e.width,h),o=e.width,a=this._totalLength}if(2===this._mode)this._barSprite.type!==MU.Type.FILLED?st(16397):(this._reverse&&(h*=-1),this._barSprite.fillRange=h);else if(this._barSprite.type!==MU.Type.FILLED){var c=r.x-n.x,f=r.y-n.y,v=new ir(t.position);v.add3f(o*c,a*f,0),t.setPosition(v),i.setAnchorPoint(r),i.setContentSize(u)}else st(16398)}},e(i,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var i=this._barSprite.node;if(!i)return;var n=i.Zs().contentSize;0===this._mode?this.totalLength=n.width:1===this._mode?this.totalLength=n.height:2===this._mode&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){2===this._mode&&(t=te(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),i}(w_),dht.Mode=_ht,m((oht=dht).prototype,"barSprite",[sht],Object.getOwnPropertyDescriptor(oht.prototype,"barSprite"),oht.prototype),m(oht.prototype,"mode",[hht],Object.getOwnPropertyDescriptor(oht.prototype,"mode"),oht.prototype),aht=xo(oht.prototype,"_barSprite",[oa],(function(){return null})),cht=xo(oht.prototype,"_mode",[oa],(function(){return 0})),fht=xo(oht.prototype,"_totalLength",[oa],(function(){return 1})),vht=xo(oht.prototype,"_progress",[oa],(function(){return.1})),lht=xo(oht.prototype,"_reverse",[oa],(function(){return!1})),uht=oht))||uht)||uht)||uht);t({ProgressBar:Nht,ProgressBarComponent:Nht}),T.ProgressBar=Nht;var Cht=new ir,Lht=new ir,Fht=new ir,Pht=new ls,Bht=new cr,Dht=new ls,Uht={HORIZONTAL:0,VERTICAL:1};Fi(Uht);var xht,Ght=(mht=Ko("cc.ScrollBar"),pht=Qo(110),yht=qo(ZB),bht=Ca(MU),Aht=Ca(Uht),mht(Eht=pht(Eht=yht((Mht=function(t){function i(){var i;return(i=t.call(this)||this)._scrollView=Tht&&Tht(),i._handle=Sht&&Sht(),i._direction=Oht&&Oht(),i._enableAutoHide=Rht&&Rht(),i._autoHideTime=Iht&&Iht(),i._touching=!1,i._opacity=255,i._autoHideRemainingTime=0,i}s(i,t);var n=i.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._opacity=255,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var i=this._scrollView.content;if(i){var n=i.Zs().contentSize,e=this._scrollView.node.Zs().contentSize,r=this.node.Zs().contentSize;if(!this._conditionalDisableScrollBar(n,e)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var s=0,h=0,u=0,o=0,a=0,c=Dht;c.set(0,0),0===this._direction?(s=n.width,h=e.width,a=r.width,u=t.x,this._convertToScrollViewSpace(c,i),o=-c.x):1===this._direction&&(s=n.height,h=e.height,a=r.height,u=t.y,this._convertToScrollViewSpace(c,i),o=-c.y);var f=this._calculateLength(s,h,a,u),v=Dht;this._calculatePosition(v,s,h,a,o,u,f),this._updateLength(f),this._updateHandlerPosition(v)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var i=t.Zs().contentSize,n=this._scrollView.node.Zs().contentSize;if(this._conditionalDisableScrollBar(i,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(MU);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,i){var n=this._scrollView&&this._scrollView.node.Zs(),e=i.Zs();if(n&&e){Cht.set(-e.anchorX*e.width,-e.anchorY*e.height,0),e.convertToWorldSpaceAR(Cht,Lht);var r=n.convertToNodeSpaceAR(Lht);r.x+=n.anchorX*n.width,r.y+=n.anchorY*n.height,t.set(r.x,r.y)}else t.set(ls.ZERO)},n._setOpacity=function(t){if(this._handle){var i=this.node.getComponent(MU);i&&(Bht.set(i.color),Bht.a=t,i.color=Bht),(i=this._handle.getComponent(MU))&&(Bht.set(i.color),Bht.a=t,i.color=Bht)}},n._updateHandlerPosition=function(t){if(this._handle){var i=Fht;this._fixupHandlerPosition(i),this._handle.node.setPosition(t.x+i.x,t.y+i.y,i.z)}},n._fixupHandlerPosition=function(t){var i=this.node.Zs(),n=i.contentSize,e=i.anchorPoint,r=this.handle.node.Zs().contentSize,s=this.handle.node.parent;ir.set(Cht,-n.width*e.x,-n.height*e.y,0);var h=this.node.Zs().convertToWorldSpaceAR(Cht,Lht),u=t;u.set(0,0,0),s.Zs().convertToNodeSpaceAR(h,u),0===this.direction?u.set(u.x,u.y+(n.height-r.height)/2,u.z):1===this.direction&&u.set(u.x+(n.width-r.width)/2,u.y,u.z),this.handle.node.setPosition(u)},n._conditionalDisableScrollBar=function(t,i){return t.width<=i.width&&0===this._direction||t.height<=i.height&&1===this._direction},n._calculateLength=function(t,i,n,e){var r=t;return e&&(r+=20*(e>0?e:-e)),n*(i/r)},n._calculatePosition=function(t,i,n,e,r,s,h){var u=i-n;s&&(u+=Math.abs(s));var o=0;u&&(o=te(o=r/u));var a=(e-h)*o;1===this._direction?t.set(0,a):t.set(a,0)},n._updateLength=function(t){if(this._handle){var i=this._handle.node.Zs(),n=i.contentSize,e=i.anchorPoint;e.x===Pht.x&&e.y===Pht.y||i.setAnchorPoint(Pht),0===this._direction?i.setContentSize(t,n.height):i.setContentSize(n.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var i=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(i)}},e(i,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(ls.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(ls.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),i}(w_),Mht.Direction=Uht,m((kht=Mht).prototype,"handle",[bht],Object.getOwnPropertyDescriptor(kht.prototype,"handle"),kht.prototype),m(kht.prototype,"direction",[Aht],Object.getOwnPropertyDescriptor(kht.prototype,"direction"),kht.prototype),Tht=xo(kht.prototype,"_scrollView",[oa],(function(){return null})),Sht=xo(kht.prototype,"_handle",[oa],(function(){return null})),Oht=xo(kht.prototype,"_direction",[oa],(function(){return 0})),Rht=xo(kht.prototype,"_enableAutoHide",[oa],(function(){return!1})),Iht=xo(kht.prototype,"_autoHideTime",[oa],(function(){return 1})),Eht=kht))||Eht)||Eht)||Eht);t({ScrollBar:Ght,ScrollBarComponent:Ght}),T.ScrollBar=Ght;var jht,Hht,Vht,$ht,Wht,zht,Xht,Yht,Kht,qht,Qht,Zht,Jht,tut,iut,nut,eut,rut,sut,hut,uut,out=t("ViewGroup",Ko("cc.ViewGroup")(xht=Qo(110)(xht=function(t){function i(){return t.apply(this,arguments)||this}return s(i,t),i}(w_))||xht)||xht);T.ViewGroup=out;var aut,cut,fut,vut,lut,dut,gut,wut,_ut,mut,put,yut,but,Aut=1e-4,Eut=nr(),kut=nr(),Tut=ds(),Sut=ds(),Out=function(){return(new Date).getMilliseconds()},Rut={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12},Iut={anchor:ds(),applyToHorizontal:!1,applyToVertical:!1},Mut=function(t,i,n,e){Iut.anchor.set(t,i),Iut.applyToHorizontal=n,Iut.applyToVertical=e},Nut={NONE:"",SCROLL_TO_TOP:"scroll-to-top",SCROLL_TO_BOTTOM:"scroll-to-bottom",SCROLL_TO_LEFT:"scroll-to-left",SCROLL_TO_RIGHT:"scroll-to-right",SCROLL_BEGAN:"scroll-began",SCROLL_ENDED:"scroll-ended",BOUNCE_TOP:"bounce-top",BOUNCE_BOTTOM:"bounce-bottom",BOUNCE_LEFT:"bounce-left",BOUNCE_RIGHT:"bounce-right",SCROLLING:"scrolling",SCROLL_ENG_WITH_THRESHOLD:"scroll-ended-with-threshold",TOUCH_UP:"touch-up"},Cut=(jht=Ko("cc.ScrollView"),Hht=Qo(110),Vht=qo(ZB),$ht=Ca(Xp),Wht=Ca(Ght),zht=Ca(Ght),Xht=Ca([d_]),jht(Yht=Hht(Yht=Vht((uut=function(t){function i(){var i;return(i=t.call(this)||this).bounceDuration=qht&&qht(),i.brake=Qht&&Qht(),i.elastic=Zht&&Zht(),i.inertia=Jht&&Jht(),i.horizontal=tut&&tut(),i.vertical=iut&&iut(),i.cancelInnerEvents=nut&&nut(),i.scrollEvents=eut&&eut(),i._autoScrolling=!1,i._scrolling=!1,i._content=rut&&rut(),i._horizontalScrollBar=sut&&sut(),i._verticalScrollBar=hut&&hut(),i._topBoundary=0,i._bottomBoundary=0,i._leftBoundary=0,i._rightBoundary=0,i._touchMoveDisplacements=[],i._touchMoveTimeDeltas=[],i._touchMovePreviousTimestamp=0,i._touchMoved=!1,i._autoScrollAttenuate=!1,i._autoScrollStartPosition=new ir,i._autoScrollTargetDelta=new ir,i._autoScrollTotalTime=0,i._autoScrollAccumulatedTime=0,i._autoScrollCurrentlyOutOfBoundary=!1,i._autoScrollBraking=!1,i._autoScrollBrakingStartPosition=new ir,i._outOfBoundaryAmount=new ir,i._outOfBoundaryAmountDirty=!0,i._stopMouseWheel=!1,i._mouseWheelEventElapsedTime=0,i._isScrollEndedWithThresholdEventFired=!1,i._scrollEventEmitMask=0,i._isBouncing=!1,i._contentPos=new ir,i._deltaPos=new ir,i._deltaAmount=new ir,i._hoverIn=0,i}s(i,t);var n=i.prototype;return n.scrollToBottom=function(t,i){void 0===i&&(i=!0),this.GB(0,0,!1,!0,t,i)},n.scrollToTop=function(t,i){void 0===i&&(i=!0),this.GB(0,1,!1,!0,t,i)},n.scrollToLeft=function(t,i){void 0===i&&(i=!0),this.GB(0,0,!0,!1,t,i)},n.scrollToRight=function(t,i){void 0===i&&(i=!0),this.GB(1,0,!0,!1,t,i)},n.scrollToTopLeft=function(t,i){void 0===i&&(i=!0),this.GB(0,1,!0,!0,t,i)},n.scrollToTopRight=function(t,i){void 0===i&&(i=!0),this.GB(1,1,!0,!0,t,i)},n.scrollToBottomLeft=function(t,i){void 0===i&&(i=!0),this.GB(0,0,!0,!0,t,i)},n.scrollToBottomRight=function(t,i){void 0===i&&(i=!0),this.GB(1,0,!0,!0,t,i)},n.scrollToOffset=function(t,i,n){void 0===n&&(n=!0);var e=this.getMaxScrollOffset(),r=ds();0===e.x?r.x=0:r.x=t.x/e.x,0===e.y?r.y=1:r.y=(e.y-t.y)/e.y,this.scrollTo(r,i,n)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,i=this._getContentLeftBoundary()-this._leftBoundary;return new ls(i,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return ls.ZERO;var t=this._content.Zs().contentSize,i=t.width-this.view.width,n=t.height-this.view.height;return new ls(i=i>=0?i:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(t,i,n){this.GB(t,0,!0,!1,i,n)},n.scrollTo=function(t,i,n){this.GB(t.x,t.y,!0,!0,i,n)},n.scrollToPercentVertical=function(t,i,n){this.GB(0,t,!1,!0,i,n)},n.GB=function(t,i,n,e,r,s){void 0===s&&(s=!0),Mut(t,i,n,e);var h=this._calculateMovePercentDelta(Iut);r?this._startAutoScroll(h,r,s):this._moveContent(h)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this.jB(t)},n.jB=function(t){if(this._content){var i=this.HB();Math.abs(t.x-i.x)<Aut&&Math.abs(t.y-i.y)<Aut||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this.HB()},n.HB=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):ir.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return Aut},n.start=function(){this._calculateBoundary(),this._content&&xC.once("director_before_draw",this._adjustContentOutOfBoundary,this)},n.onEnable=function(){var t=this;t._registerEvent();var i=this._content;if(i){i.on("size-changed",t._calculateBoundary,t),i.on("transform-changed",t._scaleChanged,t);var n=t.view;n&&(n.node.on("transform-changed",t._scaleChanged,t),n.node.on("size-changed",t._calculateBoundary,t))}t._calculateBoundary(),t._updateScrollBarState()},n.update=function(t){var i=this._deltaAmount;this._autoScrolling?(this._processAutoScrolling(t),i.x=0,i.y=0):0===i.x&&0===i.y||(this._processDeltaMove(i),i.x=0,i.y=0)},n.onDisable=function(){var t=this;t._unregisterEvent();var i=t.content;if(i){i.off("size-changed",t._calculateBoundary,t),i.off("transform-changed",t._scaleChanged,t);var n=t.view;n&&(n.node.off("transform-changed",t._scaleChanged,t),n.node.off("size-changed",t._calculateBoundary,t))}t._deltaAmount.set(0,0),t._hideScrollBar(),t.stopAutoScroll()},n._registerEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t,!0),i.on("touch-move",t._onTouchMoved,t,!0),i.on("touch-end",t._onTouchEnded,t,!0),i.on("touch-cancel",t._onTouchCancelled,t,!0),i.on("mouse-wheel",t._onMouseWheel,t,!0),lM.on("handle-input",t.VB,t),lM.on("gamepad-input",t.VB,t)},n._unregisterEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t,!0),i.off("touch-move",t._onTouchMoved,t,!0),i.off("touch-end",t._onTouchEnded,t,!0),i.off("touch-cancel",t._onTouchCancelled,t,!0),i.off("mouse-wheel",t._onMouseWheel,t,!0),lM.off("handle-input",t.VB,t),lM.off("gamepad-input",t.VB,t)},n._onMouseWheel=function(t,i){var n=this;if(n.enabledInHierarchy&&!n._hasNestedViewGroup(t,i)){var e=t.getScrollY(),r=Eut;n.vertical?r.set(0,-.1*e,0):n.horizontal&&r.set(-.1*e,0,0),n._mouseWheelEventElapsedTime=0,n._deltaAmount.add(r),n._stopMouseWheel||(n._handlePressLogic(),n.schedule(this._checkMouseWheel,1/60),n._stopMouseWheel=!0),n._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,i){var n=this;n.enabledInHierarchy&&n._content&&(n._hasNestedViewGroup(t,i)||(n._handlePressLogic(),n._touchMoved=!1,n._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,i){var n=this;if(n.enabledInHierarchy&&n._content&&!n._hasNestedViewGroup(t,i)){var e=t.touch;if(n._handleMoveLogic(e),n.cancelInnerEvents){var r=e.getUILocation(Tut);if(r.subtract(e.getUIStartLocation(Sut)),r.length()>7&&!n._touchMoved&&t.target!==n.node){var s=new zm(t.getTouches(),t.bubbles,"touch-cancel");s.touch=t.touch,s.simulate=!0,t.target.dispatchEvent(s),n._touchMoved=!0}n._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,i){var n=this;if(n.enabledInHierarchy&&n._content&&t&&!n._hasNestedViewGroup(t,i)){n._dispatchEvent("touch-up");var e=t.touch;n._handleReleaseLogic(e),n._touchMoved?t.propagationStopped=!0:n._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,i){var n=this;n.enabledInHierarchy&&n._content&&(n._hasNestedViewGroup(t,i)||(t&&!t.simulate&&n._handleReleaseLogic(t.touch),n._stopPropagationIfTargetIsMe(t)))},n._calculateBoundary=function(){var t=this;if(t._content&&t.view){var i=t._content.getComponent(wht);i&&i.enabledInHierarchy&&i.updateLayout();var n=t.view,e=n.width*n.anchorX,r=n.height*n.anchorY;t._leftBoundary=-e,t._bottomBoundary=-r,t._rightBoundary=t._leftBoundary+n.width,t._topBoundary=t._bottomBoundary+n.height,t._moveContentToTopLeft(n.contentSize)}},n._hasNestedViewGroup=function(t,i){if(!t||t.eventPhase!==jm.CAPTURING_PHASE)return!1;if(i)for(var n=0;n<i.length;n++){var e=i[n];if(this.node===e)return!(!t.target||!t.target.getComponent(out));if(e.getComponent(out))return!0}return!1},n._startInertiaScroll=function(t){Eut.set(t),Eut.multiplyScalar(.7),this._startAttenuatingAutoScroll(Eut,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,i){var n=t.clone();if(n.normalize(),this._content&&this.view){var e=this._content.Zs().contentSize,r=this.view.contentSize,s=e.width-r.width,h=e.height-r.height,u=this._calculateAttenuatedFactor(s),o=this._calculateAttenuatedFactor(h);n.x=n.x*s*(1-this.brake)*u,n.y=n.y*h*o*(1-this.brake),n.z=0}var a=t.length(),c=n.length()/a;this.brake>0&&c>7?(c=Math.sqrt(c),n.set(t),n.multiplyScalar(c+1)):n.add(t);var f=this._calculateAutoScrollTimeByInitialSpeed(i.length());this.brake>0&&c>3&&(f*=c=3),0===this.brake&&c>1&&(f*=c),this._startAutoScroll(n,f,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,i,n){void 0===n&&(n=!1);var e=this,r=e._flattenVectorByDirection(t);e._autoScrolling=!0,e._autoScrollTargetDelta=r,e._autoScrollAttenuate=n,ir.copy(e._autoScrollStartPosition,e.HB()),e._autoScrollTotalTime=i,e._autoScrollAccumulatedTime=0,e._autoScrollBraking=!1,e._isScrollEndedWithThresholdEventFired=!1,e._autoScrollBrakingStartPosition.set(0,0,0),e._getHowMuchOutOfBoundary().equals(ir.ZERO,Aut)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new ir,i=0;if((i=this._touchMoveTimeDeltas.reduce((function(t,i){return t+i}),i))<=0||i>=.5)t.set(ir.ZERO);else{var n=Eut;n.set(0,0,0),n=this._touchMoveDisplacements.reduce((function(t,i){return t.add(i),t}),n),t.set(n.x*(1-this.brake)/i,n.y*(1-this.brake)/i,n.z)}return t},n._flattenVectorByDirection=function(t){return this.horizontal||(t.x=0),this.vertical||(t.y=0),t},n._moveContent=function(t,i){var n=this._flattenVectorByDirection(t);Eut.set(this.HB()),Eut.add(n),Eut.set(Math.round(1e4*Eut.x)*Aut,Math.round(1e4*Eut.y)*Aut,Eut.z),this.jB(Eut);var e=this._getHowMuchOutOfBoundary();Tut.set(e.x,e.y),this._updateScrollBar(Tut),this.elastic&&i&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this.HB(),i=this._content.Zs();return t.x-i.anchorX*i.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content.Zs();return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content.Zs();return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this.HB(),i=this._content.Zs();return t.y-i.anchorY*i.height},n._getHowMuchOutOfBoundary=function(t){if(t||(t=ir.ZERO),t.equals(ir.ZERO,Aut)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var i=new ir,n=this._getContentLeftBoundary(),e=this._getContentRightBoundary();n+t.x>this._leftBoundary?i.x=this._leftBoundary-(n+t.x):e+t.x<this._rightBoundary&&(i.x=this._rightBoundary-(e+t.x));var r=this._getContentTopBoundary(),s=this._getContentBottomBoundary();return r+t.y<this._topBoundary?i.y=this._topBoundary-(r+t.y):s+t.y>this._bottomBoundary&&(i.y=this._bottomBoundary-(s+t.y)),t.equals(ir.ZERO,Aut)&&(this._outOfBoundaryAmount=i,this._outOfBoundaryAmountDirty=!1),this._clampDelta(i),i},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onScroll(t),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchBegan(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchEnded(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var i=1<<Rut[t];if(this._scrollEventEmitMask&i)return;this._scrollEventEmitMask|=i}d_.emitEvents(this.scrollEvents,this,Rut[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content){this._outOfBoundaryAmountDirty=!0;var t=this._getHowMuchOutOfBoundary();!t.equals(ir.ZERO,Aut)&&(Eut.set(this.HB()),Eut.add(t),this.jB(Eut),this._updateScrollBar(ls.ZERO))}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){var t=this;if(t._content&&t.view){var i=t.view,n=t._content.Zs(),e=t._verticalScrollBar;e&&e.isValid&&(n.height<i.height||Zn(n.height,i.height)?e.hide():e.show());var r=t._horizontalScrollBar;r&&r.isValid&&(n.width<i.width||Zn(n.width,i.width)?r.hide():r.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===jm.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._deltaAmount.add(this._deltaPos)},n._handleReleaseLogic=function(t){var i=this;i._getLocalAxisAlignDelta(i._deltaPos,t),i._gatherTouchMove(i._deltaPos),i._processInertiaScroll(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended"))},n._getLocalAxisAlignDelta=function(t,i){var n=this.node.Zs();n&&(i.getUILocation(Tut),i.getUIPreviousLocation(Sut),Eut.set(Tut.x,Tut.y,0),kut.set(Sut.x,Sut.y,0),n.convertToNodeSpaceAR(Eut,Eut),n.convertToNodeSpaceAR(kut,kut),ir.subtract(t,Eut,kut))},n._scrollChildren=function(t){var i=this;i._clampDelta(t);var n,e=t;i.elastic&&(n=i._getHowMuchOutOfBoundary(),e.x*=0===n.x?1:.5,e.y*=0===n.y?1:.5),i.elastic||(n=i._getHowMuchOutOfBoundary(e),e.add(n));var r="",s="";if(i._content){var h=i._content.Zs(),u=h.anchorX,o=h.anchorY,a=h.width,c=h.height,f=i._content.position||ir.ZERO;i.vertical&&(e.y>0?f.y-o*c+e.y>=i._bottomBoundary&&(r="scroll-to-bottom"):e.y<0&&f.y-o*c+c+e.y<=i._topBoundary&&(r="scroll-to-top")),i.horizontal&&(e.x<0?f.x-u*a+a+e.x<=i._rightBoundary&&(s="scroll-to-right"):e.x>0&&f.x-u*a+e.x>=i._leftBoundary&&(s="scroll-to-left"))}i._moveContent(e,!1),(i.horizontal&&0!==e.x||i.vertical&&0!==e.y)&&(i._scrolling||(i._scrolling=!0,i._dispatchEvent("scroll-began")),i._dispatchEvent("scrolling")),""!==r&&i._dispatchEvent(r),""!==s&&i._dispatchEvent(s)},n._handlePressLogic=function(){var t=this;t._autoScrolling&&t._dispatchEvent("scroll-ended"),t._autoScrolling=!1,t._isBouncing=!1,t._touchMovePreviousTimestamp=Out(),t._touchMoveDisplacements.length=0,t._touchMoveTimeDeltas.length=0,t._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var i=this.view.contentSize,n=this._content.Zs();n.width<i.width&&(t.x=0),n.height<i.height&&(t.y=0)}},n._gatherTouchMove=function(t){var i=this,n=t.clone();for(i._clampDelta(n);i._touchMoveDisplacements.length>=5;)i._touchMoveDisplacements.shift(),i._touchMoveTimeDeltas.shift();i._touchMoveDisplacements.push(n);var e=Out();i._touchMoveTimeDeltas.push((e-i._touchMovePreviousTimestamp)/1e3),i._touchMovePreviousTimestamp=e},n._startBounceBackIfNeeded=function(){var t=this;if(!t.elastic)return!1;var i=t._getHowMuchOutOfBoundary();if(t._clampDelta(i),i.equals(ir.ZERO,Aut))return!1;var n=Math.max(t.bounceDuration,0);return t._startAutoScroll(i,n,!0),t._isBouncing||(i.y>0&&t._dispatchEvent("bounce-top"),i.y<0&&t._dispatchEvent("bounce-bottom"),i.x>0&&t._dispatchEvent("bounce-right"),i.x<0&&t._dispatchEvent("bounce-left"),t._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(ir.ZERO,Aut)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(ir.ZERO,Aut)},n._isNecessaryAutoScrollBrake=function(){var t=this;if(t._autoScrollBraking)return!0;if(t._isOutOfBoundary()){if(!t._autoScrollCurrentlyOutOfBoundary)return t._autoScrollCurrentlyOutOfBoundary=!0,t._autoScrollBraking=!0,ir.copy(t._autoScrollBrakingStartPosition,t.HB()),!0}else t._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var i=this,n=i._isNecessaryAutoScrollBrake(),e=n?.05:1;i._autoScrollAccumulatedTime+=t*(1/e);var r,s=Math.min(1,i._autoScrollAccumulatedTime/i._autoScrollTotalTime);i._autoScrollAttenuate&&(r=s,s=(r-=1)*r*r*r*r+1);var h=i._autoScrollTargetDelta.clone();h.multiplyScalar(s);var u=i._autoScrollStartPosition.clone();u.add(h);var o=Math.abs(s-1)<=Aut;if(Math.abs(s-1)<=i.getScrollEndedEventTiming()&&!i._isScrollEndedWithThresholdEventFired&&(i._dispatchEvent("scroll-ended-with-threshold"),i._isScrollEndedWithThresholdEventFired=!0),i.elastic){var a=u.clone();a.subtract(i._autoScrollBrakingStartPosition),n&&a.multiplyScalar(e),u.set(i._autoScrollBrakingStartPosition),u.add(a)}else{var c=u.clone();c.subtract(i.getContentPosition());var f=i._getHowMuchOutOfBoundary(c);f.equals(ir.ZERO,Aut)||(u.add(f),o=!0)}o&&(i._autoScrolling=!1);var v=u.clone();v.subtract(i.HB()),i._clampDelta(v),i._moveContent(v,o),i._dispatchEvent("scrolling"),i._autoScrolling||(i._isBouncing=!1,i._scrolling=!1,i._dispatchEvent("scroll-ended"))},n._checkMouseWheel=function(t){var i=this;if(!i._getHowMuchOutOfBoundary().equals(ir.ZERO,Aut))return i._processInertiaScroll(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended")),i.unschedule(i._checkMouseWheel),void(i._stopMouseWheel=!1);i._mouseWheelEventElapsedTime+=t,i._mouseWheelEventElapsedTime>.1&&(i._onScrollBarTouchEnded(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended")),i.unschedule(i._checkMouseWheel),i._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var i=t.anchor,n=t.applyToHorizontal,e=t.applyToVertical,r=this;r._calculateBoundary(),i.clampf(ls.ZERO,ls.ONE);var s=r._getContentBottomBoundary()-r._bottomBoundary;s=-s;var h=r._getContentLeftBoundary()-r._leftBoundary;h=-h;var u=new ir;if(r._content&&r.view){var o=0,a=r._content.Zs().contentSize,c=r.view.contentSize;n&&(o=a.width-c.width,u.x=h-o*i.x),e&&(o=a.height-c.height,u.y=s-o*i.y)}return u},n._moveContentToTopLeft=function(t){var i=this,n=i._getContentBottomBoundary()-i._bottomBoundary;n=-n;var e=new ir,r=0,s=i._getContentLeftBoundary()-i._leftBoundary;if(s=-s,i._content){var h=i._content.Zs().contentSize;h.height<t.height&&(r=h.height-t.height,e.y=n-r),h.width<t.width&&(r=h.width-t.width,e.x=s)}i._updateScrollBarState(),i._moveContent(e),i._adjustContentOutOfBoundary()},n._scaleChanged=function(t){4===t&&this._calculateBoundary()},n._xrHoverEnter=function(){},n._xrHoverExit=function(){},n.VB=function(t){t instanceof Xm?t.gamepad:t instanceof Ym&&t.handleInputDevice,this.enabledInHierarchy},n._xrThumbStickMove=function(t){var i=this;if(i.enabledInHierarchy){var n=t.y,e=Eut;i.vertical?e.set(0,-62.5*n,0):i.horizontal&&e.set(-62.5*n,0,0),i._mouseWheelEventElapsedTime=0,i._deltaAmount.add(e),i._stopMouseWheel||(i._handlePressLogic(),i.schedule(i._checkMouseWheel,1/60,NaN,0),i._stopMouseWheel=!0)}},e(i,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var i=t&&t.parent&&t.parent.Zs();!t||t&&i?(this._content=t,this._calculateBoundary()):it(4302)}}},{key:"horizontalScrollBar",get:function(){var t=this._horizontalScrollBar;return t&&!t.isValid&&ut(4303,"horizontal",this.node.name),t},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(ls.ZERO)))}},{key:"verticalScrollBar",get:function(){var t=this._verticalScrollBar;return t&&!t.isValid&&ut(4303,"vertical",this.node.name),t},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(ls.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t.Zs():null}}]),i}(out),uut.EventType=Nut,qht=xo((Kht=uut).prototype,"bounceDuration",[oa],(function(){return 1})),Qht=xo(Kht.prototype,"brake",[oa],(function(){return.5})),Zht=xo(Kht.prototype,"elastic",[oa],(function(){return!0})),Jht=xo(Kht.prototype,"inertia",[oa],(function(){return!0})),m(Kht.prototype,"content",[$ht],Object.getOwnPropertyDescriptor(Kht.prototype,"content"),Kht.prototype),tut=xo(Kht.prototype,"horizontal",[oa],(function(){return!0})),m(Kht.prototype,"horizontalScrollBar",[Wht],Object.getOwnPropertyDescriptor(Kht.prototype,"horizontalScrollBar"),Kht.prototype),iut=xo(Kht.prototype,"vertical",[oa],(function(){return!0})),m(Kht.prototype,"verticalScrollBar",[zht],Object.getOwnPropertyDescriptor(Kht.prototype,"verticalScrollBar"),Kht.prototype),nut=xo(Kht.prototype,"cancelInnerEvents",[oa],(function(){return!0})),eut=xo(Kht.prototype,"scrollEvents",[Xht,oa],(function(){return[]})),rut=xo(Kht.prototype,"_content",[oa],(function(){return null})),sut=xo(Kht.prototype,"_horizontalScrollBar",[oa],(function(){return null})),hut=xo(Kht.prototype,"_verticalScrollBar",[oa],(function(){return null})),Yht=Kht))||Yht)||Yht)||Yht);t({ScrollView:Cut,ScrollViewComponent:Cut}),T.ScrollView=Cut;var Lut=new ir,Fut={Horizontal:0,Vertical:1};Fi(Fut);var Put,But,Dut,Uut,xut,Gut,jut,Hut,Vut,$ut,Wut,zut=(aut=Ko("cc.Slider"),cut=Qo(110),fut=qo(ZB),vut=Ca(MU),lut=Ca(Fut),dut=Ca([d_]),aut(gut=cut(gut=fut((but=function(t){function i(){var i;return(i=t.call(this)||this).slideEvents=_ut&&_ut(),i._handle=mut&&mut(),i._direction=put&&put(),i._progress=yut&&yut(),i.$B=new ir,i.WB=!1,i.zB=!1,i.XB=new ir,i.YB=new ir,i}s(i,t);var n=i.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){var t=this,i=t.node,n=t._handle;if(t._updateHandlePosition(),i.on("touch-start",t._onTouchBegan,t),i.on("touch-move",t._onTouchMoved,t),i.on("touch-end",t._onTouchEnded,t),i.on("touch-cancel",t._onTouchCancelled,t),n&&n.isValid){var e=n.node;e.on("touch-start",t._onHandleDragStart,t),e.on("touch-move",t._onTouchMoved,t),e.on("touch-end",t._onTouchEnded,t)}},n.onDisable=function(){var t=this,i=t.node,n=t._handle;if(i.off("touch-start",t._onTouchBegan,t),i.off("touch-move",t._onTouchMoved,t),i.off("touch-end",t._onTouchEnded,t),i.off("touch-cancel",t._onTouchCancelled,t),n&&n.isValid){var e=n.node;e.off("touch-start",t._onHandleDragStart,t),e.off("touch-move",t._onTouchMoved,t),e.off("touch-end",t._onTouchEnded,t)}},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node.Zs()){this.WB=!0,this.zB=!0;var i=t.touch.getUILocation();ir.set(this.YB,i.x,i.y,0),this._handle.node.Zs().convertToNodeSpaceAR(this.YB,this.$B),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this.WB=!0,this.zB||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this.WB&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this.WB=!1,this.zB=!1,this.$B=new ir,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this.WB=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){d_.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var i=t.getUILocation();ir.set(this.YB,i.x,i.y,0);var n=this.node.Zs(),e=n.convertToNodeSpaceAR(this.YB,Lut);0===this.direction?this.progress=te(.5+(e.x-this.$B.x)/n.width):this.progress=te(.5+(e.y-this.$B.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this.XB.set(this._handle.node.position);var t=this.node.Zs();0===this._direction?this.XB.x=-t.width*t.anchorX+this.progress*t.width:this.XB.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this.XB)}},n.KB=function(){var t=this.node.Zs(),i=t.contentSize;if(t.setContentSize(i.height,i.width),this._handle){var n=this._handle.node.position;0===this._direction?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},n._xrHandleProgress=function(){},n._xrClick=function(){},n._xrUnClick=function(){},n._xrHoverStay=function(){},e(i,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.KB())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),i}(w_),but.Direction=Fut,m((wut=but).prototype,"handle",[vut],Object.getOwnPropertyDescriptor(wut.prototype,"handle"),wut.prototype),m(wut.prototype,"direction",[lut],Object.getOwnPropertyDescriptor(wut.prototype,"direction"),wut.prototype),_ut=xo(wut.prototype,"slideEvents",[dut,oa],(function(){return[]})),mut=xo(wut.prototype,"_handle",[oa],(function(){return null})),put=xo(wut.prototype,"_direction",[oa],(function(){return 0})),yut=xo(wut.prototype,"_progress",[oa],(function(){return.1})),gut=wut))||gut)||gut)||gut);function Xut(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(i))}t({Slider:zut,SliderComponent:zut}),T.Slider=zut;var Yut,Kut,qut,Qut,Zut,Jut,tot,iot=(Put=Ko("cc.Toggle"),But=Qo(110),Dut=qo(ZB),Uut=Ca(MU),xut=Ca([d_]),Put(Gut=But(Gut=Dut((Wut=function(t){function i(){var i;return(i=t.call(this)||this).checkEvents=Hut&&Hut(),i._isChecked=Vut&&Vut(),i._checkMark=$ut&&$ut(),i}s(i,t);var n=i.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,i){if(void 0===i&&(i=!0),this._isChecked!=t){this._isChecked=t;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(t||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,i)),this.playEffect(),i&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(i.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(i.EventType.CLICK,this._internalToggle,this)},n._emitToggleEvents=function(){this.node.emit(i.EventType.TOGGLE,this),this.checkEvents&&d_.emitEvents(this.checkEvents,this)},e(i,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return T.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),i}(Lrt),Wut.EventType=Xut({TOGGLE:"toggle"},Crt),m((jut=Wut).prototype,"checkMark",[Uut],Object.getOwnPropertyDescriptor(jut.prototype,"checkMark"),jut.prototype),Hut=xo(jut.prototype,"checkEvents",[xut,oa],(function(){return[]})),Vut=xo(jut.prototype,"_isChecked",[oa],(function(){return!0})),$ut=xo(jut.prototype,"_checkMark",[oa],(function(){return null})),Gut=jut))||Gut)||Gut)||Gut);t({Toggle:iot,ToggleComponent:iot}),T.Toggle=iot;var not,eot,rot,sot,hot,uot,oot,aot,cot,fot,vot,lot,dot,got,wot,_ot,mot,pot,yot,bot,Aot,Eot,kot,Tot,Sot,Oot,Rot=(Yut=Ko("cc.ToggleContainer"),Kut=Qo(110),qut=Ca([d_]),Yut(Qut=Kut((Zut=function(t){function i(){var i;return(i=t.call(this)||this)._allowSwitchOff=Jut&&Jut(),i.checkEvents=tot&&tot(),i}s(i,t);var n=i.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on("child-added",this.ensureValidState,this),this.node.on("child-removed",this.ensureValidState,this)},n.onDisable=function(){this.node.off("child-added",this.ensureValidState,this),this.node.off("child-removed",this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,i){if(void 0===i&&(i=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var e=this.toggleItems[n];e!==t&&(i?e.isChecked=!1:e.setIsCheckedWithoutNotify(!1))}this.checkEvents&&T.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var i=t[0];i.isChecked=!0,this.notifyToggleCheck(i)}var n=this.activeToggles();if(n.length>1)for(var e=n[0],r=0;r<n.length;++r){var s=n[r];s!==e&&(s.isChecked=!1)}},e(i,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var i=t.getComponent("cc.Toggle");return i&&i.enabled?i:null})).filter(Boolean)}}]),i}(w_),Jut=xo(Zut.prototype,"_allowSwitchOff",[oa],(function(){return!1})),tot=xo(Zut.prototype,"checkEvents",[qut,oa],(function(){return[]})),Qut=Zut))||Qut)||Qut);t({ToggleContainer:Rot,ToggleContainerComponent:Rot}),T.ToggleContainer=Rot;var Iot=new ls;function Mot(t){var i=t.Zs();return t instanceof SI?uo:i?i.contentSize:gs.ZERO}function Not(t,i,n,e){t.parent?Iot.set(t.parent.scale.x,t.parent.scale.y):Iot.set(0,0);for(var r=Iot.x,s=Iot.y,h=0,u=0,o=t.parent;;){if(!o)return n.x=n.y=0,void(e.x=e.y=1);var a=o.position;if(h+=a.x,u+=a.y,(o=o.parent)===i)break;o?Iot.set(o.scale.x,o.scale.y):Iot.set(0,0);var c=Iot.x,f=Iot.y;h*=c,u*=f,r*=c,s*=f}e.x=0!==r?1/r:1,e.y=0!==s?1/s:1,n.x=-h,n.y=-u}var Cot={ONCE:0,ALWAYS:1,ON_WINDOW_RESIZE:2};Fi(Cot);var Lot,Fot,Pot,Bot,Dot,Uot,xot,Got,jot,Hot,Vot,$ot,Wot={TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32,HORIZONTAL:56,VERTICAL:7},zot=(not=Ko("cc.Widget"),eot=Qo(110),rot=qo(ZB),sot=Ca(Xp),hot=Ca(Cot),not(uot=eot(uot=rot((Oot=function(t){function i(){var i;return(i=t.call(this)||this)._lastPos=new ir,i._lastSize=new gs,i._dirty=!0,i._hadAlignOnce=!1,i._alignFlags=aot&&aot(),i._target=cot&&cot(),i._left=fot&&fot(),i._right=vot&&vot(),i._top=lot&&lot(),i._bottom=dot&&dot(),i._horizontalCenter=got&&got(),i._verticalCenter=wot&&wot(),i._isAbsLeft=_ot&&_ot(),i._isAbsRight=mot&&mot(),i._isAbsTop=pot&&pot(),i._isAbsBottom=yot&&yot(),i._isAbsHorizontalCenter=bot&&bot(),i._isAbsVerticalCenter=Aot&&Aot(),i._originalWidth=Eot&&Eot(),i._originalHeight=kot&&kot(),i._alignMode=Tot&&Tot(),i._lockFlags=Sot&&Sot(),i}s(i,t);var n=i.prototype;return n.updateAlignment=function(){k._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this.qB()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node.Zs().contentSize),k._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){k._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on("transform-changed",this._setDirtyByMode,this),this.node.on("size-changed",this._setDirtyByMode,this),this.node.on("anchor-changed",this._adjustWidgetToAnchorChanged,this),this.node.on("parent-changed",this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off("transform-changed",this._setDirtyByMode,this),this.node.off("size-changed",this._setDirtyByMode,this),this.node.off("anchor-changed",this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off("parent-changed",this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,i){if((this._alignFlags&t)>0){var n=this.node.parent&&this.node.parent._uiProps,e=n&&n.uiTransformComp,r=e?e.contentSize:uo;this.isAlignLeft&&8===t?this._left=i?this._left*r.width:this._left/r.width:this.isAlignRight&&32===t?this._right=i?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&16===t?this._horizontalCenter=i?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&1===t?this._top=i?this._top*r.height:this._top/r.height:this.isAlignBottom&&4===t?this._bottom=i?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&2===t&&(this._verticalCenter=this._verticalCenter/r.height),this.qB()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(ZB)&&(t.on("transform-changed",this._setDirtyByMode,this),t.on("size-changed",this._setDirtyByMode,this),t.on("anchor-changed",this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off("transform-changed",this._setDirtyByMode,this),t.off("size-changed",this._setDirtyByMode,this),t.off("anchor-changed",this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var i=this._target||t;i&&(i.off("transform-changed",this._setDirtyByMode,this),i.off("size-changed",this._setDirtyByMode,this))},n._setDirtyByMode=function(){1===this.alignMode&&this.qB()},n.QB=function(t,i){if(i!==(this._alignFlags&t)>0){var n=(40&t)>0,e=this.node.Zs();i?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=e.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=e.height))):(n?this.isStretchWidth&&(e.width=this._originalWidth):this.isStretchHeight&&(e.height=this._originalHeight),this._alignFlags&=~t)}},n.qB=function(){this._dirty||(this._dirty=!0)},e(i,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this.qB())}},{key:"isAlignTop",get:function(){return(1&this._alignFlags)>0},set:function(t){this.QB(1,t),this.qB()}},{key:"isAlignBottom",get:function(){return(4&this._alignFlags)>0},set:function(t){this.QB(4,t),this.qB()}},{key:"isAlignLeft",get:function(){return(8&this._alignFlags)>0},set:function(t){this.QB(8,t),this.qB()}},{key:"isAlignRight",get:function(){return(32&this._alignFlags)>0},set:function(t){this.QB(32,t),this.qB()}},{key:"isAlignVerticalCenter",get:function(){return(2&this._alignFlags)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=2):this._alignFlags&=-3,this.qB()}},{key:"isAlignHorizontalCenter",get:function(){return(16&this._alignFlags)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=16):this._alignFlags&=-17,this.qB()}},{key:"isStretchWidth",get:function(){return!(40&~this._alignFlags)}},{key:"isStretchHeight",get:function(){return!(5&~this._alignFlags)}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this.qB()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this.qB()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this.qB()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this.qB()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this.qB()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this.qB()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this.qB()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this.qB()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this.qB()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this.qB()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this.qB()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this.qB()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(1,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(4,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(8,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(32,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(16,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(2,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this.qB()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this.qB())}}]),i}(w_),Oot.AlignMode=Cot,m((oot=Oot).prototype,"target",[sot],Object.getOwnPropertyDescriptor(oot.prototype,"target"),oot.prototype),m(oot.prototype,"alignMode",[hot],Object.getOwnPropertyDescriptor(oot.prototype,"alignMode"),oot.prototype),aot=xo(oot.prototype,"_alignFlags",[oa],(function(){return 0})),cot=xo(oot.prototype,"_target",[oa],(function(){return null})),fot=xo(oot.prototype,"_left",[oa],(function(){return 0})),vot=xo(oot.prototype,"_right",[oa],(function(){return 0})),lot=xo(oot.prototype,"_top",[oa],(function(){return 0})),dot=xo(oot.prototype,"_bottom",[oa],(function(){return 0})),got=xo(oot.prototype,"_horizontalCenter",[oa],(function(){return 0})),wot=xo(oot.prototype,"_verticalCenter",[oa],(function(){return 0})),_ot=xo(oot.prototype,"_isAbsLeft",[oa],(function(){return!0})),mot=xo(oot.prototype,"_isAbsRight",[oa],(function(){return!0})),pot=xo(oot.prototype,"_isAbsTop",[oa],(function(){return!0})),yot=xo(oot.prototype,"_isAbsBottom",[oa],(function(){return!0})),bot=xo(oot.prototype,"_isAbsHorizontalCenter",[oa],(function(){return!0})),Aot=xo(oot.prototype,"_isAbsVerticalCenter",[oa],(function(){return!0})),Eot=xo(oot.prototype,"_originalWidth",[oa],(function(){return 0})),kot=xo(oot.prototype,"_originalHeight",[oa],(function(){return 0})),Tot=xo(oot.prototype,"_alignMode",[oa],(function(){return 2})),Sot=xo(oot.prototype,"_lockFlags",[oa,ca],(function(){return 0})),uot=oot))||uot)||uot)||uot);t({Widget:zot,WidgetComponent:zot}),k.internal.computeInverseTransForTarget=Not,k.internal.getReadonlyNodeSize=Mot,k.Widget=zot;var Xot=new cr,Yot={HORIZONTAL:0,VERTICAL:1};Fi(Yot);var Kot,qot,Qot,Zot,Jot,tat,iat,nat,eat,rat,sat,hat,uat,oat,aat,cat,fat,vat,lat,dat,gat,wat,_at,mat,pat=(Lot=Ko("cc.PageViewIndicator"),Fot=Qo(110),Pot=Ca(zF),Bot=Ca(Yot),Dot=Ca(gs),Lot(Uot=Fot(($ot=function(t){function i(){var i;return(i=t.call(this)||this).spacing=Got&&Got(),i._spriteFrame=jot&&jot(),i._direction=Hot&&Hot(),i._cellSize=Vot&&Vot(),i._layout=null,i._pageView=null,i._indicators=[],i}s(i,t);var n=i.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(wht),this._layout||(this._layout=this.addComponent(wht));var t=this._layout;0===this.direction?(t.type=1,t.spacingX=this.spacing):1===this.direction&&(t.type=2,t.spacingY=this.spacing),t.resizeMode=1},n._createIndicator=function(){var t=new Xp;t.layer=this.node.layer;var i=t.addComponent(MU);return i.spriteFrame=this.spriteFrame,i.sizeMode=0,t.parent=this.node,t.Zs().setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var i=this._pageView.curPageIdx;if(!(i>=t.length)){for(var n=0;n<t.length;++n){var e=t[n];if(e._uiProps.uiComp){var r=e._uiProps.uiComp;Xot.set(r.color),Xot.a=127.5,r.color=Xot}}if(t[i]._uiProps.uiComp){var s=t[i]._uiProps.uiComp;Xot.set(s.color),Xot.a=255,s.color=Xot}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,i=this._pageView.getPages();if(i.length!==t.length){var n=0;if(i.length>t.length)for(n=0;n<i.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-i.length;n>0;--n){var e=t[n-1];this.node.removeChild(e),t.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},e(i,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),i}(w_),$ot.Direction=Yot,m((xot=$ot).prototype,"spriteFrame",[Pot],Object.getOwnPropertyDescriptor(xot.prototype,"spriteFrame"),xot.prototype),m(xot.prototype,"direction",[Bot],Object.getOwnPropertyDescriptor(xot.prototype,"direction"),xot.prototype),m(xot.prototype,"cellSize",[Dot],Object.getOwnPropertyDescriptor(xot.prototype,"cellSize"),xot.prototype),Got=xo(xot.prototype,"spacing",[oa],(function(){return 0})),jot=xo(xot.prototype,"_spriteFrame",[oa],(function(){return null})),Hot=xo(xot.prototype,"_direction",[oa],(function(){return 0})),Vot=xo(xot.prototype,"_cellSize",[oa],(function(){return new gs(20,20)})),Uot=xot))||Uot)||Uot);t({PageViewIndicator:pat,PageViewIndicatorComponent:pat}),T.PageViewIndicator=pat;var yat=new ls,bat={Unified:0,Free:1};Fi(bat);var Aat={HORIZONTAL:0,VERTICAL:1};Fi(Aat);var Eat=(Kot=Ko("cc.PageView"),qot=Qo(110),Qot=Ca(bat),Zot=Ca(Aat),Jot=Ca(pat),tat=Ca(Ght),iat=Ca(Ght),nat=Ca([d_]),eat=Ca([d_]),Kot(rat=qot((mat=function(t){function i(){var i;return(i=t.call(this)||this).autoPageTurningThreshold=hat&&hat(),i.horizontal=uat&&uat(),i.vertical=oat&&oat(),i.cancelInnerEvents=aat&&aat(),i.scrollEvents=cat&&cat(),i.pageTurningSpeed=fat&&fat(),i.pageEvents=vat&&vat(),i._sizeMode=lat&&lat(),i._direction=dat&&dat(),i._scrollThreshold=gat&&gat(),i._pageTurningEventTiming=wat&&wat(),i._indicator=_at&&_at(),i._curPageIdx=0,i._lastPageIdx=0,i._pages=[],i._initContentPos=nr(),i._scrollCenterOffsetX=[],i._scrollCenterOffsetY=[],i._touchBeganPosition=ds(),i._touchEndPosition=ds(),i}s(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on("size-changed",this._updateAllPagesSize,this),this.node.on(i.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off("size-changed",this._updateAllPagesSize,this),this.node.off(i.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t.Zs()?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):it(4301))},n.insertPage=function(t,i){if(!(i<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(i>=this._pages.length)this.addPage(t);else{if(!t.Zs())return void it(4301);this._pages.splice(i,0,t),this.content.insertChild(t,i),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var i=this._pages.indexOf(t);-1!==i?this.removePageAtIndex(i):st(4300,t.name)}},n.removePageAtIndex=function(t){var i=this._pages;if(!(t<0||t>=i.length)){var n=i[t];n&&this.content&&(this.content.removeChild(n),i.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,i=0,n=t.length;i<n;i++)this.content.removeChild(t[i]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,i){void 0===i&&(i=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),i,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(wht);t&&t.enabled&&t.updateLayout();var i=this._pages.length;this._curPageIdx>=i&&(this._curPageIdx=0===i?0:i-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,e=0;e<i;++e){var r=this._pages[e].position;0===this.direction?this._scrollCenterOffsetX[e]=Math.abs(n.x+r.x):this._scrollCenterOffsetY[e]=Math.abs(n.y+r.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&0===this._sizeMode)for(var i=this._pages,n=t.contentSize,e=0,r=i.length;e<r;e++)i[e].Zs().setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(i.EventType.SCROLL_ENDED))},n._onTouchBegan=function(i,n){i.touch.getUILocation(yat),ls.set(this._touchBeganPosition,yat.x,yat.y),t.prototype._onTouchBegan.call(this,i,n)},n._onTouchMoved=function(i,n){t.prototype._onTouchMoved.call(this,i,n)},n._onTouchEnded=function(i,n){i.touch.getUILocation(yat),ls.set(this._touchEndPosition,yat.x,yat.y),t.prototype._onTouchEnded.call(this,i,n)},n._onTouchCancelled=function(i,n){i.touch.getUILocation(yat),ls.set(this._touchEndPosition,yat.x,yat.y),t.prototype._onTouchCancelled.call(this,i,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=0===this.direction,this.vertical=1===this.direction},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var i=this.content.getComponent(wht);if(i){if(1===this._sizeMode&&this._pages.length>0){var n=this._pages[0].Zs(),e=this._pages[this._pages.length-1].Zs();0===this.direction?(i.paddingLeft=(t.width-n.width)/2,i.paddingRight=(t.width-e.width)/2):1===this.direction&&(i.paddingTop=(t.height-n.height)/2,i.paddingBottom=(t.height-e.height)/2)}i.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,i=0;i<t.length;++i){var n=t[i];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,d_.emitEvents(this.pageEvents,this,"page-turning"),this.node.emit("page-turning",this))},n._isQuicklyScrollable=function(t){if(0===this.direction){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(1===this.direction&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var i=new ls;if(1===this._sizeMode)0===this.direction?i.x=this._scrollCenterOffsetX[t]:1===this.direction&&(i.y=this._scrollCenterOffsetY[t]);else{var n=this.view;if(!n)return i;0===this.direction?i.x=t*n.width:1===this.direction&&(i.y=t*n.height)}return i},n._getDragDirection=function(t){return 0===this._direction?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,i,n){if(1===this._sizeMode){var e=0,r=0;if(0===this.direction)return e=this._scrollCenterOffsetX[i],r=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(e-r)*this.scrollThreshold;if(1===this.direction)return e=this._scrollCenterOffsetY[i],r=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(e-r)*this.scrollThreshold}else{var s=this.view;if(!s)return!1;if(0===this.direction)return Math.abs(t.x)>=s.width*this.scrollThreshold;if(1===this.direction)return Math.abs(t.y)>=s.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var i=new ls;ls.subtract(i,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,e=n+this._getDragDirection(i),r=this.pageTurningSpeed*Math.abs(n-e);if(e<this._pages.length){if(this._isScrollable(i,n,e))return void this.scrollToPage(e,r);var s=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(s))return void this.scrollToPage(e,r)}this.scrollToPage(n,r)}},e(i,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),i}(Cut),mat.SizeMode=bat,mat.Direction=Aat,mat.EventType=Xut({PAGE_TURNING:"page-turning"},Nut),m((sat=mat).prototype,"sizeMode",[Qot],Object.getOwnPropertyDescriptor(sat.prototype,"sizeMode"),sat.prototype),m(sat.prototype,"direction",[Zot],Object.getOwnPropertyDescriptor(sat.prototype,"direction"),sat.prototype),m(sat.prototype,"indicator",[Jot],Object.getOwnPropertyDescriptor(sat.prototype,"indicator"),sat.prototype),hat=xo(sat.prototype,"autoPageTurningThreshold",[oa],(function(){return 100})),m(sat.prototype,"verticalScrollBar",[tat,ja],Object.getOwnPropertyDescriptor(sat.prototype,"verticalScrollBar"),sat.prototype),m(sat.prototype,"horizontalScrollBar",[iat,ja],Object.getOwnPropertyDescriptor(sat.prototype,"horizontalScrollBar"),sat.prototype),uat=xo(sat.prototype,"horizontal",[ja,oa],(function(){return!0})),oat=xo(sat.prototype,"vertical",[ja,oa],(function(){return!0})),aat=xo(sat.prototype,"cancelInnerEvents",[ja,oa],(function(){return!0})),cat=xo(sat.prototype,"scrollEvents",[nat,oa,ja],(function(){return[]})),fat=xo(sat.prototype,"pageTurningSpeed",[oa],(function(){return.3})),vat=xo(sat.prototype,"pageEvents",[eat,oa],(function(){return[]})),lat=xo(sat.prototype,"_sizeMode",[oa],(function(){return 0})),dat=xo(sat.prototype,"_direction",[oa],(function(){return 0})),gat=xo(sat.prototype,"_scrollThreshold",[oa],(function(){return.5})),wat=xo(sat.prototype,"_pageTurningEventTiming",[oa],(function(){return.1})),_at=xo(sat.prototype,"_indicator",[oa],(function(){return null})),rat=sat))||rat)||rat);t({PageView:Eat,PageViewComponent:Eat}),T.PageView=Eat;var kat=new ir,Tat=new ls,Sat=new ls,Oat=new ls(1,1),Rat=new ls,Iat=new ls;function Mat(t,i){if(!i._hadAlignOnce){0===i.alignMode&&(i._hadAlignOnce=!0);var n,e=i.target,r=Sat,s=Oat;e?Not(t,n=e,r,s):n=t.parent;var h=Mot(n),u=n instanceof SI||!n.getComponent(ZB),o=u?Tat:n.getComponent(ZB).anchorPoint,a=u;t.getPosition(kat);var c=t.Zs(),f=kat.x,v=kat.y,l=c.anchorPoint,d=t.scale;if(56&i.alignFlags){var g=0,w=0,_=h.width;a?(g=uo.left.x,w=uo.right.x):w=(g=-o.x*_)+_,g+=i.isAbsoluteLeft?i.left:i.left*_,w-=i.isAbsoluteRight?i.right:i.right*_,e&&(g+=r.x,g*=s.x,w+=r.x,w*=s.x);var m=0,p=l.x,y=d.x;if(y<0&&(p=1-p,y=-y),i.isStretchWidth)m=w-g,0!==y&&(c.width=m/y),f=g+p*m;else{if(m=c.width*y,i.isAlignHorizontalCenter){var b=i.isAbsoluteHorizontalCenter?i.horizontalCenter:i.horizontalCenter*_,A=(.5-o.x)*h.width;e&&(b*=s.x,A+=r.x,A*=s.x),f=A+(p-.5)*m+b}else f=i.isAlignLeft?g+p*m:w+(p-1)*m;Zn(y,0,qn)?m=c.width:m/=y}i._lastSize.width=m}if(7&i.alignFlags){var E=0,k=0,T=h.height;a?(k=uo.bottom.y,E=uo.top.y):E=(k=-o.y*T)+T,k+=i.isAbsoluteBottom?i.bottom:i.bottom*T,E-=i.isAbsoluteTop?i.top:i.top*T,e&&(k+=r.y,k*=s.y,E+=r.y,E*=s.y);var S=0,O=l.y,R=d.y;if(R<0&&(O=1-O,R=-R),i.isStretchHeight)S=E-k,0!==R&&(c.height=S/R),v=k+O*S;else{if(S=c.height*R,i.isAlignVerticalCenter){var I=i.isAbsoluteVerticalCenter?i.verticalCenter:i.verticalCenter*T,M=(.5-o.y)*h.height;e&&(I*=s.y,M+=r.y,M*=s.y),v=M+(O-.5)*S+I}else v=i.isAlignBottom?k+O*S:E+(O-1)*S;Zn(R,0,qn)?S=c.height:S/=R}i._lastSize.height=S}t.setPosition(f,v,kat.z),ir.set(i._lastPos,f,v,kat.z)}}function Nat(t){var i=t.getComponent(zot);if(i&&i.enabled){if(!k.isValid(t,!0))return;Bat.push(i)}for(var n,e=d(t.children);!(n=e()).done;){var r=n.value;r.active&&Nat(r)}}function Cat(){var t=xC.getScene();if(t){Dat.isAligning=!0,Dat._nodesOrderDirty&&(Bat.length=0,Nat(t),Dat._nodesOrderDirty=!1);var i=null,n=Dat._activeWidgetsIterator;for(n.i=0;n.i<Bat.length;++n.i)(i=Bat[n.i])._dirty&&(Mat(i.node,i),i._dirty=!1);Dat.isAligning=!1}}var Lat,Fat,Pat,Bat=[],Dat=t("widgetManager",k._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new _i(Bat),animationState:null,init:function(){xC.on("director_after_scene_launch",Cat),xC.on("director_after_update",Cat),yL.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);yL.instance.on("canvas-resize",t),eo.on("window-resize",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=xC.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var i=Xp.isNode(t)&&t.getComponent(zot);i&&i.enabled&&(2===i.alignMode||1===i.alignMode)&&i.setDirty();for(var n,e=d(t.children);!(n=e()).done;){var r=n.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,i){function n(t,i){return Math.abs(t-i)>1e-10?i:t}var e=t.node,r=e.parent;if(r){var s=Rat;s.set(0,0);var h=Iat;if(h.set(1,1),t.target&&Not(e,r=t.target,s,h),!i)return;var u=r._uiProps&&r.Zs(),o=u?u.anchorPoint:Tat,a=e.Zs(),c=Mot(r),f=a.anchorPoint,v=e.position,l=Wot,d=e.scale,g=0;if(i&l.LEFT){var w=-o.x*c.width;w+=s.x,w*=h.x,g=v.x-f.x*a.width*Math.abs(d.x)-w,t.isAbsoluteLeft||(g/=c.width),g/=h.x,t.left=n(t.left,g)}if(i&l.RIGHT){var _=(1-o.x)*c.width;_+=s.x,g=(_*=h.x)-(v.x+(1-f.x)*a.width*Math.abs(d.x)),t.isAbsoluteRight||(g/=c.width),g/=h.x,t.right=n(t.right,g)}if(i&l.TOP){var m=(1-o.y)*c.height;m+=s.y,g=(m*=h.y)-(v.y+(1-f.y)*a.height*Math.abs(d.y)),t.isAbsoluteTop||(g/=c.height),g/=h.y,t.top=n(t.top,g)}if(i&l.BOT){var p=-o.y*c.height;p+=s.y,p*=h.y,g=v.y-f.y*a.height*Math.abs(d.y)-p,t.isAbsoluteBottom||(g/=c.height),g/=h.y,t.bottom=n(t.bottom,g)}}},updateAlignment:function t(i){var n=i.parent;n&&Xp.isNode(n)&&t(n);var e=i.getComponent(zot);e&&n&&Mat(i,e)},AlignMode:Cot,AlignFlags:Wot});xC.on("director_init",(function(){Dat.init()}));var Uat,xat,Gat,jat,Hat,Vat,$at,Wat,zat,Xat,Yat,Kat,qat=Ko("cc.SafeArea")(Lat=Qo(110)(Lat=qo(zot)((Fat=function(t){function i(){var i;return(i=t.call(this)||this)._symmetric=Pat&&Pat(),i}s(i,t);var n=i.prototype;return n.onEnable=function(){this.updateArea(),eo.on("window-resize",this.updateArea,this),eo.on("orientation-change",this.updateArea,this)},n.onDisable=function(){eo.off("window-resize",this.updateArea,this),eo.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(zot),i=this.node.getComponent(ZB);if(t&&i){t.updateAlignment();var n=this.node.position.clone(),e=i.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var r=NL.getVisibleSize(),s=r.width,h=r.height,u=ho.getSafeAreaRect(this._symmetric);t.top=h-u.y-u.height,t.bottom=u.y,t.left=u.x,t.right=s-u.x-u.width,t.updateAlignment();var o=this.node.position.clone(),a=e.x-(o.x-n.x)/i.width,c=e.y-(o.y-n.y)/i.height;i.setAnchorPoint(a,c),Dat.add(t)}},e(i,[{key:"symmetric",get:function(){return this._symmetric},set:function(t){this._symmetric=t}}]),i}(w_),Pat=xo(Fat.prototype,"_symmetric",[oa],(function(){return!0})),Lat=Fat))||Lat)||Lat)||Lat;t({SafeArea:qat,SafeAreaComponent:qat}),T.SafeArea=qat;var Qat,Zat=(Uat=Ko("cc.UICoordinateTracker"),xat=Qo(110),Gat=Ca(Xp),jat=Ca($G),Hat=Ca([d_]),Uat(Vat=xat(($at=function(t){function i(){var i;return(i=t.call(this)||this).syncEvents=Wat&&Wat(),i._target=zat&&zat(),i._camera=Xat&&Xat(),i._useScale=Yat&&Yat(),i._distance=Kat&&Kat(),i._transformPos=nr(),i._viewPos=nr(),i._canMove=!0,i._lastWPos=nr(),i._lastCameraPos=nr(),i}s(i,t);var n=i.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,i=this._camera;if(this._canMove&&i&&i.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(i.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(i.node.worldPosition),i.camera.update(),i.convertToUINode(t,this._target,this._transformPos),this._useScale&&ir.transformMat4(this._viewPos,this.node.worldPosition,i.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);d_.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},e(i,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),i}(w_),m($at.prototype,"target",[Gat],Object.getOwnPropertyDescriptor($at.prototype,"target"),$at.prototype),m($at.prototype,"camera",[jat],Object.getOwnPropertyDescriptor($at.prototype,"camera"),$at.prototype),Wat=xo($at.prototype,"syncEvents",[Hat,oa],(function(){return[]})),zat=xo($at.prototype,"_target",[oa],(function(){return null})),Xat=xo($at.prototype,"_camera",[oa],(function(){return null})),Yat=xo($at.prototype,"_useScale",[oa],(function(){return!0})),Kat=xo($at.prototype,"_distance",[oa],(function(){return 1})),Vat=$at))||Vat)||Vat);t({UICoordinateTracker:Zat,UICoordinateTrackerComponent:Zat});var Jat=["touch-start","touch-end","touch-move","mouse-down","mouse-move","mouse-up","mouse-enter","mouse-leave","mouse-wheel"];function tct(t){t.propagationStopped=!0}var ict,nct,ect,rct,sct=Ko("cc.BlockInputEvents")(Qat=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.onEnable=function(){for(var t=0;t<Jat.length;t++)this.node.on(Jat[t],tct,this)},n.onDisable=function(){for(var t=0;t<Jat.length;t++)this.node.off(Jat[t],tct,this)},i}(w_))||Qat;t({BlockInputEvents:sct,BlockInputEventsComponent:sct});var hct,uct=t("SubContextView",Ko("cc.SubContextView")(ict=Qo(110)(ict=qo(ZB)((nct=function(t){function i(){var i;return(i=t.call(this)||this)._fps=ect&&ect(),i.HP=null,i.ZB=new jw,i.es=new Mm,i.JB=0,i.tD=0,i.iD=null,i.nD=new Xp("content"),i._designResolutionSize=rct&&rct(),i.nD.hideFlags|=1032,i.JB=performance.now(),i}s(i,t);var n=i.prototype;return n.onLoad=function(){tP.getOpenDataContext?(this.tD=1e3/this._fps,this.iD=tP.getOpenDataContext(),this.eD(),this.rD(),this.sD(),this.hD()):this.enabled=!1},n.onEnable=function(){this.YF()},n.onDisable=function(){this.KF()},n.eD=function(){if(this.iD){var t=this.iD.canvas,i=this._designResolutionSize.width,n=this._designResolutionSize.height;t.width=i,t.height=n}},n.rD=function(){if(this.iD){var t=this.iD.canvas,i=this.ZB;if(i.reset(t),this.es.image=i,this.es.create(t.width,t.height),this.HP=this.nD.getComponent(MU),this.HP||(this.HP=this.nD.addComponent(MU)),this.HP.spriteFrame)this.HP.spriteFrame.texture=this.es;else{var n=new zF;n.texture=this.es,this.HP.spriteFrame=n}this.nD.parent=this.node}},n.sD=function(){if(this.iD){var t=this.node.getComponent(ZB),i=this.nD.getComponent(ZB),n=t.width/i.width,e=t.height/i.height,r=n>e?e:n;i.width*=r,i.height*=r;var s=NL.getViewportRect(),h=i.getBoundingBoxToWorld(),u=NL.getVisibleSize(),o=eo.devicePixelRatio,a=(s.width*(h.x/u.width)+s.x)/o,c=(s.height*(h.y/u.height)+s.y)/o,f=s.width*(h.width/u.width)/o,v=s.height*(h.height/u.height)/o;this.iD.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:a,y:c,width:f,height:v})}},n.uD=function(){var t=this.ZB;if(t&&this.iD&&!(t.width<=0||t.height<=0)){var i=this.iD.canvas;t.reset(i),(i.width>t.width||i.height>t.height)&&this.es.create(i.width,i.height),this.es.uploadData(i)}},n.YF=function(){this.node.on("transform-changed",this.sD,this),this.node.on("size-changed",this.sD,this),this.node.on("layer-changed",this.hD,this)},n.KF=function(){this.node.off("transform-changed",this.sD,this),this.node.off("size-changed",this.sD,this),this.node.off("layer-changed",this.hD,this)},n.hD=function(){this.nD.layer=this.node.layer},n.update=function(t){void 0===t?this.uD():performance.now()-this.JB>=this.tD&&(this.JB+=this.tD,this.uD())},n.onDestroy=function(){this.nD.destroy(),this.es.destroy(),this.HP&&this.HP.destroy(),this.ZB.destroy(),this.iD=null},e(i,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this.tD=1e3/t)}}]),i}(w_),ect=xo(nct.prototype,"_fps",[oa],(function(){return 60})),rct=xo(nct.prototype,"_designResolutionSize",[oa],(function(){return new gs(640,960)})),ict=nct))||ict)||ict)||ict);T.SubContextView=uct,St({ButtonComponent:{newName:"Button",since:"1.2.0",removed:!1},EditBoxComponent:{newName:"EditBox",since:"1.2.0",removed:!1},LayoutComponent:{newName:"Layout",since:"1.2.0",removed:!1},ProgressBarComponent:{newName:"ProgressBar",since:"1.2.0",removed:!1},ScrollViewComponent:{newName:"ScrollView",since:"1.2.0",removed:!1},ScrollBarComponent:{newName:"ScrollBar",since:"1.2.0",removed:!1},SliderComponent:{newName:"Slider",since:"1.2.0",removed:!1},ToggleComponent:{newName:"Toggle",since:"1.2.0",removed:!1},ToggleContainerComponent:{newName:"ToggleContainer",since:"1.2.0",removed:!1},WidgetComponent:{newName:"Widget",since:"1.2.0",removed:!1},PageViewComponent:{newName:"PageView",since:"1.2.0",removed:!1},PageViewIndicatorComponent:{newName:"PageViewIndicator",since:"1.2.0",removed:!1},SafeAreaComponent:{newName:"SafeArea",since:"1.2.0",removed:!1},UICoordinateTrackerComponent:{newName:"UICoordinateTracker",since:"1.2.0",removed:!1},BlockInputEventsComponent:{newName:"BlockInputEvents",since:"1.2.0",removed:!1}});var oct=t("UIReorderComponent",Ko("cc.UIReorderComponent")(hct=function(){st(1408,"UIReorderComponent")})||hct);T.UIReorderComponent=oct,T.ButtonComponent=Lrt,ai(Lrt,"cc.ButtonComponent"),T.EditBoxComponent=Kst,ai(Kst,"cc.EditBoxComponent"),T.LayoutComponent=wht,ai(wht,"cc.LayoutComponent"),T.ProgressBarComponent=Nht,ai(Nht,"cc.ProgressBarComponent"),T.ScrollViewComponent=Cut,ai(Cut,"cc.ScrollViewComponent"),T.ScrollBarComponent=Ght,ai(Ght,"cc.ScrollBarComponent"),T.SliderComponent=zut,ai(zut,"cc.SliderComponent"),T.ToggleComponent=iot,ai(iot,"cc.ToggleComponent"),T.ToggleContainerComponent=Rot,ai(Rot,"cc.ToggleContainerComponent"),T.WidgetComponent=zot,ai(zot,"cc.WidgetComponent"),T.PageViewComponent=Eat,ai(Eat,"cc.PageViewComponent"),T.PageViewIndicatorComponent=pat,ai(pat,"cc.PageViewIndicatorComponent"),T.SafeAreaComponent=qat,ai(qat,"cc.SafeAreaComponent"),ai(Zat,"cc.UICoordinateTrackerComponent"),T.BlockInputEventsComponent=sct,ai(sct,"cc.BlockInputEventsComponent"),gt(yL.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),wt(yL.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"},{name:"setRealPixelResolution"}]);var act=new ir,cct=Ys.create(0,0,0,1),fct=new wo(0,0,0,.5,.5,.5),vct=new wo,lct=new uu((function(){return{model:null,depth:0}}),128);function dct(t,i){var n=0;t.node&&(ir.subtract(act,t.worldBounds?t.worldBounds.center:t.node.worldPosition,i.position),n=ir.dot(act,i.forward));var e=lct.alloc();return e.model=t,e.depth=n,e}function gct(t,i){var n=t.validPunctualLights;n.length=0;for(var e=i.scene.spotLights,r=i.node.scene.globals.disableLightmap,s=0;s<e.length;s++){var h=e[s];h.baked&&!r||(Ys.set(cct,h.position.x,h.position.y,h.position.z,h.range),Qh.sphereFrustum(cct,i.frustum)&&n.push(h))}for(var u=i.scene.sphereLights,o=0;o<u.length;o++){var a=u[o];a.baked&&!r||(Ys.set(cct,a.position.x,a.position.y,a.position.z,a.range),Qh.sphereFrustum(cct,i.frustum)&&n.push(a))}for(var c=i.scene.pointLights,f=0;f<c.length;f++){var v=c[f];v.baked||(Ys.set(cct,v.position.x,v.position.y,v.position.z,v.range),Qh.sphereFrustum(cct,i.frustum)&&n.push(v))}for(var l=i.scene.rangedDirLights,d=0;d<l.length;d++){var g=l[d];wo.transform(vct,fct,g.node.getWorldMatrix()),Qh.aabbFrustum(vct,i.frustum)&&n.push(g)}t.validPunctualLights=n}function wct(t,i,n){var e=t.scene.mainLight,r=i.csmLayers.layerObjects,s=n.validFrustum,h=n.shadowObjects;h.length=0;for(var u=t.visibility,o=r.length-1;o>=0;o--){var a=r.array[o];if(a){var c=a.model;c&&c.enabled&&c.node&&((u&c.node.layer)===c.node.layer||u&c.visFlags)&&c.worldBounds&&c.castShadow?Qh.aabbFrustum(c.worldBounds,s)&&(h.push(a),n.level<e.csmLevel&&e.csmOptimizationMode===Uk.RemoveDuplicates&&Qh.aabbFrustumCompletelyInside(c.worldBounds,s)&&r.fastRemove(o)):r.fastRemove(o)}else r.fastRemove(o)}}function _ct(t,i,n){var e=n.scene,r=e.mainLight,s=t.shadows,h=t.skybox,u=t.csmLayers,o=t.renderObjects;lct.freeArray(o),o.length=0;var a=u.castShadowObjects;a.length=0;var c=u.layerObjects;c.clear(),s.enabled&&(i.updateShadowUBORange(56,s.shadowColor),s.type===Pk.ShadowMap&&r&&r.node&&u.update(t,n)),8&n.clearFlag&&(h.enabled&&h.model?o.push(dct(h.model,n)):0!==n.cameraUsage&&2!==n.cameraUsage&&st(15100,n.name));var f=e.models,v=n.visibility;function l(t){if(t.enabled){if(e.isCulledByLod(n,t))return;if(t.castShadow&&(a.push(dct(t,n)),c.push(dct(t,n))),t.node&&(v&t.node.layer)===t.node.layer||v&t.visFlags){if(t.worldBounds&&!Qh.aabbFrustum(t.worldBounds,n.frustum))return;o.push(dct(t,n))}}}for(var d=0;d<f.length;d++)l(f[d])}var mct,pct,yct,bct,Act,Ect=new dd(2,2,0,2,2,2),kct=new dd(1,1,0,2,2,2),Tct=function(){function t(t){this.oD=new Map,this.gu=t,this.aD=this.gu.getSampler(Ect),this.cD=this.gu.getSampler(kct);var i=new Ud(wy.bindings);this.fD=this.gu.createDescriptorSetLayout(i),this.vD=this.gu.createDescriptorSet(new xd(this.fD))}var i=t.prototype;return i.regenLayout=function(){var t=new Ud(wy.bindings);this.fD=this.gu.createDescriptorSetLayout(t),this.vD=this.gu.createDescriptorSet(new xd(this.fD))},i.bindBuffer=function(t,i){this.vD.bindBuffer(t,i);for(var n=this.oD.values(),e=n.next();!e.done;)e.value.bindBuffer(t,i),e=n.next()},i.bindSampler=function(t,i){this.vD.bindSampler(t,i);for(var n=this.oD.values(),e=n.next();!e.done;)e.value.bindSampler(t,i),e=n.next()},i.bindTexture=function(t,i){this.vD.bindTexture(t,i);for(var n=this.oD.values(),e=n.next();!e.done;)e.value.bindTexture(t,i),e=n.next()},i.update=function(){this.vD.update();for(var t=this.oD.values(),i=t.next();!i.done;)i.value.update(),i=t.next()},i.getOrCreateDescriptorSet=function(t){var i=this.gu;if(!this.oD.has(t)){var n=this.vD,e=i.createDescriptorSet(new xd(this.fD));this.oD.set(t,e);for(var r=0;r<8;r++)e.bindBuffer(r,n.getBuffer(r)),e.bindSampler(r,n.getSampler(r)),e.bindTexture(r,n.getTexture(r));var s=i.createBuffer(new ud(18,3,256,256));e.bindBuffer(by.BINDING,s),e.update()}return this.oD.get(t)},i.destroy=function(){this.fD.destroy()},e(t,[{key:"descriptorSetMap",get:function(){return this.oD}},{key:"linearSampler",get:function(){return this.aD}},{key:"pointSampler",get:function(){return this.cD}},{key:"descriptorSetLayout",get:function(){return this.fD}},{key:"globalDescriptorSet",get:function(){return this.vD},set:function(t){this.vD=t}}]),t}(),Sct=new Kr,Oct=new Kr,Rct=new Kr,Ict=new De,Mct=new De(0,0,1,0),Nct=new ir,Cct=Kr.toArray,Lct=De.toArray,Fct=cr.toArray,Pct=function(){function t(){this._globalUBO=new Float32Array(20),this._cameraUBO=new Float32Array(148),this._shadowUBO=new Float32Array(64),this._csmUBO=new Float32Array(164)}t.updateGlobalUBOView=function(t,i){var n=k.director,e=n.root,r=i,s=Math.floor(t.width),h=Math.floor(t.height);r[0]=e.cumulativeTime,r[1]=e.frameTime,r[2]=n.getTotalFrames(),r[3]=e.cumulativeTime-Math.floor(e.frameTime),r[4]=s,r[5]=h,r[6]=1/s,r[7]=1/h,r[8]=s,r[9]=h,r[10]=1/r[8],r[11]=1/r[9],k.internal.reflectionProbeManager&&(r[12]=k.internal.reflectionProbeManager.getMaxProbeId()+1);for(var u=e.debugView,o=0;o<=3;o++)r[16+o]=0;if(u.isEnabled()){r[16]=u.singleMode;for(var a=0;a<17;a++){var c=a%8;r[17+(a>>3)]+=(u.isCompositeModeEnabled(a)?1:0)*Math.pow(10,c)}r[19]+=(u.lightingWithAlbedo?1:0)*Math.pow(10,6),r[19]+=(u.csmLayerColoration?1:0)*Math.pow(10,7)}},t.updateCameraUBOView=function(t,i,n){var e,r=(n.scene?n.scene:k.director.getScene().renderScene).mainLight,s=t.pipelineSceneData,h=s.ambient,u=s.skybox,o=s.fog,a=s.shadows,c=i,f=n.exposure,v=s.isHDR;if(c[104]=s.shadingScale,c[105]=s.shadingScale,c[106]=1/c[104],c[107]=1/c[105],c[108]=f,c[109]=1/f,c[110]=v?1:0,c[111]=1/MM.standardExposureValue,r){var l=r.shadowEnabled&&a.type===Pk.ShadowMap?1:0,d=r.direction;if(Mct.set(d.x,d.y,d.z,l),Lct(c,Mct,112),ir.toArray(c,r.color,116),r.useColorTemperature){var g=r.colorTemperatureRGB;c[116]*=g.x,c[117]*=g.y,c[118]*=g.z}c[119]=v?r.illuminance*f:r.illuminance}else Mct.set(0,0,1,0),Lct(c,Mct,112),Lct(c,De.ZERO,116);var w=h.skyColor;w.w=v?h.skyIllum*f:h.skyIllum,c[120]=w.x,c[121]=w.y,c[122]=w.z,c[123]=w.w,c[124]=h.groundAlbedo.x,c[125]=h.groundAlbedo.y,c[126]=h.groundAlbedo.z,c[127]=u.envmap?null==(e=u.envmap)?void 0:e.mipmapLevel:1,Cct(c,n.matView,0),Cct(c,n.node.worldMatrix,16),ir.toArray(c,n.position,96),Cct(c,n.matProj,32),Cct(c,n.matProjInv,48),Cct(c,n.matViewProj,64),Cct(c,n.matViewProjInv,80),c[99]=this.getCombineSignY(),c[100]=n.surfaceTransform,c[101]=n.cameraUsage,c[102]=Math.cos(ne(s.skybox.getRotationAngle())),c[103]=Math.sin(ne(s.skybox.getRotationAngle()));var _=o.colorArray;c[128]=_.x,c[129]=_.y,c[130]=_.z,c[131]=_.z,c[132]=o.fogStart,c[133]=o.fogEnd,c[134]=o.fogDensity,c[136]=o.fogTop,c[137]=o.fogRange,c[138]=o.fogAtten,c[140]=n.nearClip,c[141]=n.farClip,c[142]=n.getClipSpaceMinz(),c[144]=s.shadingScale*n.window.width*n.viewport.x,c[145]=s.shadingScale*n.window.height*n.viewport.y,c[146]=s.shadingScale*n.window.width*n.viewport.z,c[147]=s.shadingScale*n.window.height*n.viewport.w},t.getPCFRadius=function(t,i){var n=t.size.x;switch(i.shadowPcf){case Bk.HARD:return 0;case Bk.SOFT:return 1/(.5*n);case Bk.SOFT_2X:return 2/(.5*n);case Bk.SOFT_4X:return 3/(.5*n)}return 0},t.updatePlanarNormalAndDistance=function(t,i){ir.normalize(Nct,t.normal),i[60]=Nct.x,i[61]=Nct.y,i[62]=Nct.z,i[63]=-t.distance},t.updateShadowUBOView=function(i,n,e,r){var s=i.device,h=r.scene.mainLight,u=i.pipelineSceneData,o=u.shadows,a=u.csmLayers,c=n,f=e,v=u.csmSupported,l=Db(s)?0:1;if(h&&o.enabled){if(o.type===Pk.ShadowMap){if(h.shadowEnabled){if(h.shadowFixedArea||h.csmLevel===Dk.LEVEL_1||!v){var d=a.specialLayer.matShadowView,g=a.specialLayer.matShadowProj,w=a.specialLayer.matShadowViewProj,_=.1,m=0,p=0;h.shadowFixedArea?(_=h.shadowNear,m=h.shadowFar,p=0):(m=a.specialLayer.shadowCameraFar,p=1),Cct(c,d,0),c[36]=g.m10,c[37]=g.m14,c[38]=g.m11,c[39]=g.m15,c[40]=g.m00,c[41]=g.m05,c[42]=1/g.m00,c[43]=1/g.m05,Cct(c,w,16),Ict.set(_,m,0,1-h.shadowSaturation),Lct(c,Ict,44),Ict.set(0,l,h.shadowNormalBias,p),Lct(c,Ict,52)}else{for(var y=this.getPCFRadius(o,h),b=0;b<h.csmLevel;b++){var A=a.layers[b],E=A.matShadowView;Ict.set(E.m00,E.m04,E.m08,y),Lct(f,Ict,0+4*b),Ict.set(E.m01,E.m05,E.m09,A.splitCameraNear),Lct(f,Ict,16+4*b),Ict.set(E.m02,E.m06,E.m10,A.splitCameraFar),Lct(f,Ict,32+4*b);var k=A.csmAtlas;Lct(f,k,48+4*b);var T=A.matShadowViewProj;Cct(f,T,64+16*b);var S=A.matShadowProj;f[128+4*b]=S.m10,f[129+4*b]=S.m14,f[130+4*b]=S.m11,f[131+4*b]=S.m15,f[144+4*b]=S.m00,f[145+4*b]=S.m05,f[146+4*b]=1/S.m00,f[147+4*b]=1/S.m05}Ict.set(h.csmTransitionRange,0,0,0),Lct(f,Ict,160),Ict.set(.1,h.shadowDistance,0,1-h.shadowSaturation),Lct(c,Ict,44),Ict.set(0,l,h.shadowNormalBias,h.csmLevel),Lct(c,Ict,52)}Ict.set(o.size.x,o.size.y,h.shadowPcf,h.shadowBias),Lct(c,Ict,48)}}else t.updatePlanarNormalAndDistance(o,c),Ict.set(0,0,0,o.planeBias),Lct(c,Ict,48);Fct(c,o.shadowColor,56)}},t.updateShadowUBOLightView=function(t,i,n,e){var r=t.device,s=t.pipelineSceneData,h=s.shadows,u=s.csmLayers,o=i,a=Db(r)?0:1,c=t.device.capabilities,f=s.csmSupported;switch(n.type){case 0:var v=n;if(h.enabled&&v&&v.shadowEnabled&&h.type===Pk.ShadowMap){var l,d,g,w=.1,_=0,m=0;if(v.shadowFixedArea||v.csmLevel===Dk.LEVEL_1||!f)l=u.specialLayer.matShadowView,d=u.specialLayer.matShadowProj,g=u.specialLayer.matShadowViewProj,v.shadowFixedArea?(w=v.shadowNear,_=v.shadowFar,m=0):(w=.1,_=u.specialLayer.shadowCameraFar,m=1),Ict.set(0,a,v.shadowNormalBias,0),Lct(o,Ict,52);else{var p=u.layers[e];l=p.matShadowView,d=p.matShadowProj,g=p.matShadowViewProj,w=p.splitCameraNear,_=p.splitCameraFar,m=v.csmLevel}Cct(o,l,0),o[36]=d.m10,o[37]=d.m14,o[38]=d.m11,o[39]=d.m15,o[40]=d.m00,o[41]=d.m05,o[42]=1/d.m00,o[43]=1/d.m05,Cct(o,g,16),Ict.set(w,_,0,1-v.shadowSaturation),Lct(o,Ict,44),Ict.set(0,a,v.shadowNormalBias,m),Lct(o,Ict,52),Ict.set(h.size.x,h.size.y,v.shadowPcf,v.shadowBias),Lct(o,Ict,48)}break;case 2:var y=n;h.enabled&&y&&y.shadowEnabled&&(Kr.invert(Sct,n.node.getWorldMatrix()),Cct(o,Sct,0),Kr.perspective(Oct,y.angle,1,.001,y.range,!0,c.clipSpaceMinZ,c.clipSpaceSignY,0),Kr.multiply(Rct,Oct,Sct),Cct(o,Rct,16),Ict.set(.01,n.range,0,0),Lct(o,Ict,44),Ict.set(h.size.x,h.size.y,y.shadowPcf,y.shadowBias),Lct(o,Ict,48),Ict.set(2,a,y.shadowNormalBias,0),Lct(o,Ict,52))}Fct(o,h.shadowColor,56)},t.getCombineSignY=function(){return t._combineSignY};var i=t.prototype;return i.lD=function(){var i=this._device;t._combineSignY=.5*i.capabilities.screenSpaceSignY+.5<<1|.5*i.capabilities.clipSpaceSignY+.5},i.activate=function(t,i){this._device=t,this._pipeline=i;var n=this._pipeline.descriptorSet;if(!Ub()){this.lD();var e=t.createBuffer(new ud(18,3,80,80));n.bindBuffer(py.BINDING,e);var r=t.createBuffer(new ud(18,3,592,592));n.bindBuffer(yy.BINDING,r);var s=t.createBuffer(new ud(18,3,256,256));n.bindBuffer(by.BINDING,s);var h=t.createBuffer(new ud(18,3,656,656));n.bindBuffer(Ay.BINDING,h)}},i.updateGlobalUBO=function(i){var n=this._pipeline.globalDSManager,e=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;e.update(),t.updateGlobalUBOView(i,this._globalUBO),r[0].updateBuffer(e.getBuffer(py.BINDING),this._globalUBO),n.bindBuffer(py.BINDING,e.getBuffer(py.BINDING)),n.update()},i.updateCameraUBO=function(i){var n=this._pipeline.globalDSManager,e=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;t.updateCameraUBOView(this._pipeline,this._cameraUBO,i),r[0].updateBuffer(e.getBuffer(yy.BINDING),this._cameraUBO),n.bindBuffer(yy.BINDING,e.getBuffer(yy.BINDING)),n.update()},i.updateShadowUBO=function(i){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var e=this._pipeline.globalDSManager,r=this._pipeline.descriptorSet,s=this._pipeline.commandBuffers,h=n.shadowFrameBufferMap,u=i.scene.mainLight;u&&h.has(u)&&e.bindTexture(4,h.get(u).colorTextures[0]),t.updateShadowUBOView(this._pipeline,this._shadowUBO,this._csmUBO,i),e.update(),s[0].updateBuffer(r.getBuffer(by.BINDING),this._shadowUBO),s[0].updateBuffer(r.getBuffer(Ay.BINDING),this._csmUBO)}},i.updateShadowUBOLight=function(i,n,e){void 0===e&&(e=0),t.updateShadowUBOLightView(this._pipeline,this._shadowUBO,n,e),i.bindTexture(4,Bb(this._pipeline.device)),i.bindTexture(6,Bb(this._pipeline.device)),i.update(),this._pipeline.commandBuffers[0].updateBuffer(i.getBuffer(by.BINDING),this._shadowUBO)},i.updateShadowUBORange=function(t,i){i instanceof Kr?Cct(this._shadowUBO,i,t):i instanceof cr&&Fct(this._shadowUBO,i,t)},i.destroy=function(){},t}();Pct._combineSignY=0;var Bct,Dct,Uct,xct,Gct,jct,Hct,Vct,$ct=t("RenderStage",Ko("RenderStage")((pct=function(){function t(){this._name=yct&&yct(),this._priority=bct&&bct(),this._enabled=!0,this._tag=Act&&Act(),this._pipeline=void 0,this._flow=void 0}var i=t.prototype;return i.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},i.activate=function(t,i){this._pipeline=t,this._flow=i},e(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}(),yct=xo(pct.prototype,"_name",[oa],(function(){return""})),bct=xo(pct.prototype,"_priority",[oa],(function(){return 0})),Act=xo(pct.prototype,"_tag",[oa],(function(){return 0})),mct=pct))||mct);k.RenderStage=$ct;var Wct,zct,Xct,Yct,Kct,qct,Qct=t("RenderFlow",(Bct=Ko("RenderFlow"),Dct=Ca([$ct]),Bct((xct=function(){function t(){this._name=Gct&&Gct(),this._priority=jct&&jct(),this._tag=Hct&&Hct(),this._stages=Vct&&Vct(),this._pipeline=void 0}var i=t.prototype;return i.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},i.activate=function(t){this._pipeline=t,this._stages.sort((function(t,i){return t.priority-i.priority}));for(var i=0,n=this._stages.length;i<n;i++)this._stages[i].activate(t,this)},i.render=function(t){for(var i=0,n=this._stages.length;i<n;i++)this._stages[i].enabled&&this._stages[i].render(t)},i.destroy=function(){for(var t=0,i=this._stages.length;t<i;t++)this._stages[t].destroy();this._stages.length=0},e(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),t}(),Gct=xo(xct.prototype,"_name",[oa],(function(){return""})),jct=xo(xct.prototype,"_priority",[oa],(function(){return 0})),Hct=xo(xct.prototype,"_tag",[oa],(function(){return 0})),Vct=xo(xct.prototype,"_stages",[Dct,oa],(function(){return[]})),Uct=xct))||Uct));k.RenderFlow=Qct;var Zct=new Yl,Jct=new id,tft=function(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null};function ift(t){for(var i,n=666,e=d(t.colorTextures);!(i=e()).done;){var r=i.value,s=null==r?void 0:r.info;n=Wv(s.type+"_"+s.usage+"_"+s.format+"_"+s.width+"_"+s.height+"_"+s.flags+"_\n            "+s.layerCount+"_"+s.levelCount+"_"+s.samples+"_"+s.depth+"_"+s.externalRes,n)}if(t.depthStencilTexture){var h=t.depthStencilTexture.info;n=Wv(h.type+"_"+h.usage+"_"+h.format+"_"+h.width+"_"+h.height+"_"+h.flags+"_\n            "+h.layerCount+"_"+h.levelCount+"_"+h.samples+"_"+h.depth+"_"+h.externalRes,n)}return n}var nft=t("RenderPipeline",(Wct=Ko("cc.RenderPipeline"),zct=Ca([Qct]),Wct((Yct=function(t){function i(i){var n;return(n=t.call(this,i)||this)._tag=Kct&&Kct(),n._flows=qct&&qct(),n._quadIB=null,n._quadVBOnscreen=null,n._quadVBOffscreen=null,n._quadIAOnscreen=null,n._quadIAOffscreen=null,n._eventProcessor=new MN,n._device=void 0,n._globalDSManager=void 0,n._descriptorSet=void 0,n._commandBuffers=[],n._pipelineUBO=new Pct,n._macros={},n._constantMacros="",n._profiler=null,n._geometryRenderer=null,n._pipelineRenderData=null,n._renderPasses=new Map,n._width=0,n._height=0,n._lastUsedRenderArea=new Yl,n._clusterEnabled=!1,n._bloomEnabled=!1,n}s(i,t);var n=i.prototype;return n.getPipelineRenderData=function(){return this._pipelineRenderData},n.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},n.createRenderPass=function(t,i,n){var e=this._device,r=new Od,s=new Rd;r.format=i,s.format=n,s.stencilStoreOp=1,s.depthStoreOp=1,1&t||(8&t?r.loadOp=1:(r.loadOp=0,r.barrier=e.getGeneralBarrier(new Ld(2097152,2097152)))),6&~t&&(2&t||(s.depthLoadOp=0),4&t||(s.stencilLoadOp=0)),s.barrier=e.getGeneralBarrier(new Ld(4194304,4194304));var h=new Nd([r],s);return e.createRenderPass(h)},n.getRenderPass=function(t,i){var n=Wv(ift(i)+"_"+t,666),e=this._renderPasses.get(n);return e||(e=this.createRenderPass(t,i.colorTextures[0].format,i.depthStencilTexture.format),this._renderPasses.set(n,e),e)},n.newFramebufferByRatio=function(t){for(var i=this.pipelineSceneData,n=this._width*i.shadingScale,e=this._height*i.shadingScale,r=t.colorTextures,s=0;s<r.length;s++)r[s].resize(n,e);t.depthStencilTexture&&t.depthStencilTexture.resize(n,e);var h=this._device.createFramebuffer(new Bd(t.renderPass,r,t.depthStencilTexture));return t.destroy(),h},n.generateRenderArea=function(t,i){var n=t.viewport,e=t.window.width,r=t.window.height;i.x=n.x*e,i.y=n.y*r,i.width=n.width*e,i.height=n.height*r},n.generateViewport=function(t,i){this.generateRenderArea(t,Zct),i||(i=Jct);var n=this.pipelineSceneData.shadingScale;return i.left=Zct.x*n,i.top=Zct.y*n,i.width=Zct.width*n,i.height=Zct.height*n,i},n.generateScissor=function(t,i){i||(i=Zct),this.generateRenderArea(t,i);var n=this.pipelineSceneData.shadingScale;return i.x*=n,i.y*=n,i.width*=n,i.height*=n,i},n.getMacroString=function(t){var i=this._macros[t];return void 0===i?"":i},n.getMacroInt=function(t){var i=this._macros[t];return void 0===i?0:i},n.getMacroBool=function(t){var i=this._macros[t];return void 0!==i&&i},n.setMacroString=function(t,i){this._macros[t]=i},n.setMacroInt=function(t,i){this._macros[t]=i},n.setMacroBool=function(t,i){this._macros[t]=i},n.activate=function(){this._device=Hg.gfxDevice,this._generateConstantMacros(),this._globalDSManager=new Tct(this._device),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._macros.CC_USE_DEBUG_VIEW=0,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device);for(var t=0;t<this._flows.length;t++)this._flows[t].activate(this);return!0},n._ensureEnoughSize=function(){},n.render=function(t){if(0!==t.length){this.updateGeometryRenderer(t),this._commandBuffers[0].begin(),this.emit("render-frame-begin",t),this._ensureEnoughSize(t),Mk(t);for(var i=0;i<t.length;i++){var n=t[i];if(n.scene){this.emit("render-camera-begin",n),gct(this.pipelineSceneData,n),_ct(this.pipelineSceneData,this.pipelineUBO,n),this._pipelineUBO.updateGlobalUBO(n.window),this._pipelineUBO.updateCameraUBO(n);for(var e=0;e<this._flows.length;e++)this._flows[e].render(n);this.emit("render-camera-end",n)}}this.emit("render-frame-end",t),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n._destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._destroyBloomData=function(){var t,i=this._pipelineRenderData.bloom;if(null!==i){i.prefiterTex&&i.prefiterTex.destroy(),i.prefilterFramebuffer&&i.prefilterFramebuffer.destroy();for(var n=0;n<i.downsampleTexs.length;++n)i.downsampleTexs[n].destroy(),i.downsampleFramebuffers[n].destroy();i.downsampleTexs.length=0,i.downsampleFramebuffers.length=0;for(var e=0;e<i.upsampleTexs.length;++e)i.upsampleTexs[e].destroy(),i.upsampleFramebuffers[e].destroy();i.upsampleTexs.length=0,i.upsampleFramebuffers.length=0,i.combineTex&&i.combineTex.destroy(),i.combineFramebuffer&&i.combineFramebuffer.destroy(),null==(t=i.renderPass)||t.destroy(),this._pipelineRenderData.bloom=null}},n.dD=function(t,i){var n=new Float32Array(16),e=i.x/this._width,r=(i.x+i.width)/this._width,s=i.y/this._height,h=(i.y+i.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){var u=h;h=s,s=u}var o=0;switch(t){case 0:o=0,n[o++]=-1,n[o++]=-1,n[o++]=e,n[o++]=h,n[o++]=1,n[o++]=-1,n[o++]=r,n[o++]=h,n[o++]=-1,n[o++]=1,n[o++]=e,n[o++]=s,n[o++]=1,n[o++]=1,n[o++]=r,n[o++]=s;break;case 1:o=0,n[o++]=-1,n[o++]=-1,n[o++]=r,n[o++]=h,n[o++]=1,n[o++]=-1,n[o++]=r,n[o++]=s,n[o++]=-1,n[o++]=1,n[o++]=e,n[o++]=h,n[o++]=1,n[o++]=1,n[o++]=e,n[o++]=s;break;case 2:o=0,n[o++]=-1,n[o++]=-1,n[o++]=e,n[o++]=s,n[o++]=1,n[o++]=-1,n[o++]=r,n[o++]=s,n[o++]=-1,n[o++]=1,n[o++]=e,n[o++]=h,n[o++]=1,n[o++]=1,n[o++]=r,n[o++]=h;break;case 3:o=0,n[o++]=-1,n[o++]=-1,n[o++]=e,n[o++]=s,n[o++]=1,n[o++]=-1,n[o++]=e,n[o++]=h,n[o++]=-1,n[o++]=1,n[o++]=r,n[o++]=s,n[o++]=1,n[o++]=1,n[o++]=r,n[o++]=h}return n},n._createQuadInputAssembler=function(){var t=new HC,i=this._device.createBuffer(new ud(10,3,64,16));if(!i)return t;var n=this._device.createBuffer(new ud(6,1,6,1));if(!n)return t;var e=new Uint8Array(6);e[0]=0,e[1]=1,e[2]=2,e[3]=1,e[4]=3,e[5]=2,n.update(e);var r=new Array(2);r[0]=new kd("a_position",21),r[1]=new kd("a_texCoord",21);var s=this._device.createInputAssembler(new Sd(r,[i],n));return t.quadIB=n,t.quadVB=i,t.quadIA=s,t},n.updateQuadVertexData=function(t,i){var n=this._lastUsedRenderArea;if(n.x!==t.x||n.y!==t.y||n.width!==t.width||n.height!==t.height){var e=this.dD(0,t);this._quadVBOffscreen.update(e);var r=this.dD(i.swapchain&&i.swapchain.surfaceTransform||0,t);this._quadVBOnscreen.update(r),n.copy(t)}},n.destroy=function(){for(var i,n,e=0;e<this._flows.length;e++)this._flows[e].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null==(i=this._globalDSManager)||i.destroy();for(var r=0;r<this._commandBuffers.length;r++)this._commandBuffers[r].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null==(n=this._pipelineSceneData)||n.destroy(),t.prototype.destroy.call(this)},n.onGlobalPipelineStateChanged=function(){},n._generateConstantMacros=function(){var t="";t+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(3&this.device.getFormatFeatures(44)?1:0)+"\n",t+="#define CC_ENABLE_CLUSTERED_LIGHT_CULLING "+(this._clusterEnabled?1:0)+"\n",t+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",t+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",t+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.device.hasFeature(5)?1:0)+"\n",t+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(Bu.os===Nu.ANDROID&&Bu.isBrowser?1:0)+"\n",t+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+(Gi.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",t+="#define CC_JOINT_UNIFORM_CAPACITY "+Wy.JOINT_UNIFORM_CAPACITY+"\n",this._constantMacros=t},n.updateGeometryRenderer=function(t){if(!this._geometryRenderer)for(var i=0;i<t.length;i++){var n=t[i];if(n&&n.window&&n.window.swapchain)return n.initGeometryRenderer(),void(this._geometryRenderer=n.geometryRenderer)}},n.generateBloomRenderData=function(){if(null==this._pipelineRenderData.bloom){var t=this._pipelineRenderData.bloom=new tft,i=this.device,n=new Od;n.format=35,n.loadOp=1,n.storeOp=0,n.barrier=i.getGeneralBarrier(new Ld(0,2097152)),t.renderPass=i.createRenderPass(new Nd([n]));var e=this._width,r=this._height;t.prefiterTex=i.createTexture(new vd(1,20,35,e>>1,r>>1)),t.prefilterFramebuffer=i.createFramebuffer(new Bd(t.renderPass,[t.prefiterTex])),e>>=1,r>>=1;for(var s=0;s<6;++s)t.downsampleTexs.push(i.createTexture(new vd(1,20,35,e>>1,r>>1))),t.downsampleFramebuffers[s]=i.createFramebuffer(new Bd(t.renderPass,[t.downsampleTexs[s]])),t.upsampleTexs.push(i.createTexture(new vd(1,20,35,e,r))),t.upsampleFramebuffers[s]=i.createFramebuffer(new Bd(t.renderPass,[t.upsampleTexs[s]])),e>>=1,r>>=1;t.combineTex=i.createTexture(new vd(1,20,35,this._width,this._height)),t.combineFramebuffer=i.createFramebuffer(new Bd(t.renderPass,[t.combineTex])),t.sampler=this.globalDSManager.linearSampler}},n.on=function(t,i,n,e){return this._eventProcessor.on(t,i,n,e)},n.once=function(t,i,n){return this._eventProcessor.once(t,i,n)},n.off=function(t,i,n){this._eventProcessor.off(t,i,n)},n.emit=function(t,i,n,e,r,s){this._eventProcessor.emit(t,i,n,e,r,s)},n.targetOff=function(t){this._eventProcessor.targetOff(t)},n.removeAll=function(t){this._eventProcessor.removeAll(t)},n.hasEventListener=function(t,i,n){return this._eventProcessor.hasEventListener(t,i,n)},e(i,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}},{key:"profiler",get:function(){return this._profiler},set:function(t){this._profiler=t}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"clusterEnabled",get:function(){return this._clusterEnabled},set:function(t){this._clusterEnabled=t}},{key:"bloomEnabled",get:function(){return this._bloomEnabled},set:function(t){this._bloomEnabled=t}},{key:"shadingScale",get:function(){return this._pipelineSceneData.shadingScale},set:function(t){this._pipelineSceneData.shadingScale!==t&&(this._pipelineSceneData.shadingScale=t,this.emit("attachment-scale-changed",t))}}]),i}(kw),Kct=xo(Yct.prototype,"_tag",[oa],(function(){return 0})),qct=xo(Yct.prototype,"_flows",[zct,oa],(function(){return[]})),Xct=Yct))||Xct));function eft(t,i){return t.hash-i.hash||t.depth-i.depth||t.shaderId-i.shaderId}function rft(t,i){return t.priority-i.priority||t.hash-i.hash||i.depth-t.depth||t.shaderId-i.shaderId}k.RenderPipeline=nft,wt(nft.prototype,"RenderPipeline.prototype",[{name:"geometryRenderer",suggest:"please use camera.geometryRenderer instead."}]);var sft=function(){function t(t){this.gD=t,this.wD=new ou((function(){return{priority:0,hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new au(64,this.gD.sortFunc)}var i=t.prototype;return i.clear=function(){this.queue.clear(),this.wD.reset()},i.insertRenderPass=function(t,i,n){var e=t.model.subModels[i],r=e.passes[n],s=e.shaders[n];if(r.blendState.targets[0].blend!==this.gD.isTransparent||!(r.phase&this.gD.phases))return!1;var h=r.priority<<16|e.priority<<8|n,u=this.wD.add();return u.priority=t.model.priority,u.hash=h,u.depth=t.depth||0,u.shaderId=s.typedID,u.subModel=e,u.passIdx=n,this.queue.push(u),!0},i.sort=function(){this.queue.sort()},i.recordCommandBuffer=function(t,i,n){for(var e=0;e<this.queue.length;++e){var r=this.queue.array[e],s=r.subModel,h=r.passIdx,u=s.inputAssembler,o=s.passes[h],a=s.shaders[h],c=wk.getOrCreatePipelineState(t,o,a,i,u);n.bindPipelineState(c),n.bindDescriptorSet(1,o.descriptorSet),n.bindDescriptorSet(2,s.descriptorSet),n.bindInputAssembler(u),n.draw(u)}},t}();function hft(t){for(var i=0,n=0;n<t.stages.length;n++)i|=ok(t.stages[n]);var e=eft;switch(t.sortMode){case 1:e=rft;break;case 0:e=eft}return new sft({isTransparent:t.isTransparent,phases:i,sortFunc:e})}function uft(t){t.clear()}function oft(t){t.sort()}var aft=function(){function t(){this.queue=new Set,this._D=[]}var i=t.prototype;return i.clear=function(){for(var t=this.queue.values(),i=t.next();!i.done;)i.value.clear(),i=t.next();this._D.length=0,this.queue.clear()},i.sort=function(){for(var t=this.queue.values(),i=t.next();!i.done;)i.value.pass.blendState.targets[0].blend||this._D.push(i.value),i=t.next();for(i=(t=this.queue.values()).next();!i.done;)i.value.pass.blendState.targets[0].blend&&this._D.push(i.value),i=t.next()},i.uploadBuffers=function(t){for(var i=this.queue.values(),n=i.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(t),n=i.next()},i.recordCommandBuffer=function(t,i,n,e,r){void 0===e&&(e=null);for(var s=0===this._D.length?this.queue.values():this._D[Symbol.iterator](),h=s.next();!h.done;){var u=h.value,o=u.instances,a=u.pass;if(u.hasPendingModels){n.bindDescriptorSet(1,a.descriptorSet);for(var c=null,f=0;f<o.length;++f){var v=o[f];if(v.count){var l=v.shader,d=wk.getOrCreatePipelineState(t,a,l,i,v.ia);c!==d&&(n.bindPipelineState(d),c=d),e&&n.bindDescriptorSet(0,e),r?n.bindDescriptorSet(2,v.descriptorSet,r):n.bindDescriptorSet(2,v.descriptorSet,h.value.dynamicOffsets),n.bindInputAssembler(v.ia),n.draw(v.ia)}}}h=s.next()}},t}(),cft=new uu((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),fft=new ir,vft=new Float32Array(4),lft=[],dft=[],gft=new Kr,wft=new Kr,_ft=new wo(0,0,0,.5,.5,.5),mft=new wo;function pft(t,i){return!(!i.worldBounds||Qh.aabbWithAABB(i.worldBounds,t.aabb))}function yft(t,i){return!(!i.worldBounds||Qh.aabbWithAABB(i.worldBounds,t.aabb)&&Qh.aabbFrustum(i.worldBounds,t.frustum))}function bft(t,i){return!(!i.worldBounds||Qh.aabbWithAABB(i.worldBounds,t.aabb))}function Aft(t,i){return wo.transform(mft,_ft,t.node.getWorldMatrix()),!(!i.worldBounds||Qh.aabbWithAABB(i.worldBounds,mft))}var Eft="forward-add",kft=ok(Eft),Tft=[];function Sft(t,i,n){void 0===n&&(n="default");var e=k.rendering;Ub()&&(kft=e.getPhaseID(e.getPassID(n),Eft)),i.length=0;for(var r=!1,s=0;s<t.length;s++){for(var h=t[s].passes,u=-1,o=0;o<h.length;o++)if((!e||!e.enableEffectImport)&&h[o].phase===kft||Ub()&&h[o].phaseID===kft){u=o,r=!0;break}i.push(u)}return r}var Oft,Rft,Ift,Mft,Nft,Cft,Lft,Fft,Pft,Bft,Dft,Uft,xft,Gft,jft,Hft,Vft,$ft,Wft,zft,Xft,Yft,Kft,qft,Qft,Zft,Jft,tvt,ivt,nvt,evt,rvt,svt,hvt,uvt,ovt,avt,cvt,fvt,vvt,lvt,dvt,gvt,wvt,_vt,mvt,pvt,yvt,bvt,Avt,Evt,kvt,Tvt,Svt,Ovt,Rvt,Ivt,Mvt,Nvt,Cvt,Lvt,Fvt,Pvt,Bvt,Dvt,Uvt,xvt,Gvt,jvt,Hvt,Vvt,$vt,Wvt,zvt,Xvt,Yvt,Kvt,qvt,Qvt=function(){function t(t){this.mD=[],this.pD=cft.alloc(),this.yD=new Float32Array(64),this.bD=16,this.AD=[],this.ED=1e4,this.xv=t,this.gu=t.device;var i=this.gu.capabilities.uboOffsetAlignment;this.kD=Math.ceil(80/i)*i,this.TD=this.kD/4,this.SD=this.gu.createBuffer(new ud(18,3,this.kD*this.bD,this.kD)),this.OD=this.gu.createBuffer(new od(this.SD,0,80)),this.RD=new Float32Array(this.TD*this.bD)}var i=t.prototype;return i.clear=function(){this.AD.forEach((function(t){t.clear()})),this.AD.length=0;for(var t=0;t<this.mD.length;t++){var i=this.mD[t];i.dynamicOffsets.length=0,i.lights.length=0}cft.freeArray(this.mD),this.mD.length=0,this.pD.dynamicOffsets.length=0,this.pD.lights.length=0},i.destroy=function(){for(var t=this.xv.globalDSManager.descriptorSetMap,i=t.keys,n=0;n<i.length;n++){var e=i[n],r=t.get(e);r&&(r.getBuffer(by.BINDING).destroy(),r.getTexture(4).destroy(),r.getTexture(6).destroy(),r.destroy()),t.delete(e)}},i.MD=function(t,i){void 0===i&&(i="default");for(var n=this.xv.pipelineSceneData.renderObjects,e=0;e<n.length;e++){var r=n[e].model,s=r.subModels;if(Sft(s,Tft,i)&&(dft.length=0,this._lightCulling(r,t),dft.length||!(t.length>0)))for(var h=0;h<s.length;h++){var u=Tft[h];if(!(u<0)){var o=s[h],a=o.passes[u];o.passes[0].blendState.targets[0].blend||(o.descriptorSet.bindBuffer(Gy.BINDING,this.OD),o.descriptorSet.update(),this._addRenderQueue(a,o,r,u))}}}},i.gatherLightPasses=function(t,i,n){void 0===n&&(n="default"),this.clear();var e=this.xv.pipelineSceneData.validPunctualLights;if(e.length){this._updateUBOs(t,i),this._updateLightDescriptorSet(t,i),this.MD(e,n);for(var r=0;r<e.length;r++){var s=e[r];this.pD.lights.push(s),this.pD.dynamicOffsets.push(this.kD*r)}this.AD.forEach((function(t){t.uploadBuffers(i)}))}else this.MD(e,n)},i.recordCommandBuffer=function(t,i,n){for(var e=this.xv.globalDSManager,r=0;r<this.AD.length;++r){var s=this.pD.lights[r];lft[0]=this.pD.dynamicOffsets[r];var h=e.getOrCreateDescriptorSet(s);this.AD[r].recordCommandBuffer(t,i,n,h,lft)}for(var u=0;u<this.mD.length;u++){var o=this.mD[u],a=o.subModel,c=o.passIdx,f=o.dynamicOffsets,v=o.lights,l=a.passes[c],d=a.shaders[c],g=a.inputAssembler,w=wk.getOrCreatePipelineState(t,l,d,i,g),_=l.descriptorSet,m=a.descriptorSet;n.bindPipelineState(w),n.bindDescriptorSet(1,_),n.bindInputAssembler(g);for(var p=0;p<f.length;++p){var y=v[p],b=e.getOrCreateDescriptorSet(y);lft[0]=f[p],n.bindDescriptorSet(0,b),n.bindDescriptorSet(2,m,lft),n.draw(g)}}},i._lightCulling=function(t,i){for(var n=!1,e=0;e<i.length;e++){var r=i[e];switch(r.type){case 1:n=pft(r,t);break;case 2:n=yft(r,t);break;case 3:n=bft(r,t);break;case 4:n=Aft(r,t)}n||dft.push(e)}},i._addRenderQueue=function(t,i,n,e){var r=this.xv.pipelineSceneData.validPunctualLights,s=t.batchingScheme,h=null;0===s&&((h=cft.alloc()).subModel=i,h.passIdx=e);for(var u=0;u<dft.length;u++){var o=dft[u],a=r[o];if((a.visibility&n.node.layer)===n.node.layer)if(1===s){var c=t.getInstancedBuffer(u);c.merge(i,e),c.dynamicOffsets[0]=this.kD,this.AD[u]||(this.AD[u]=new aft),this.AD[u].queue.add(c)}else h.lights.push(a),h.dynamicOffsets.push(this.kD*o)}0===s&&this.mD.push(h)},i._updateLightDescriptorSet=function(t,i){for(var n=this.xv.device,e=this.xv.pipelineSceneData,r=e.shadows,s=e.shadowFrameBufferMap,h=t.scene.mainLight,u=Db(n)?0:1,o=this.xv.globalDSManager,a=e.validPunctualLights,c=this.xv.device.capabilities,f=0;f<a.length;f++){var v=a[f],l=o.getOrCreateDescriptorSet(v);if(l){var d=void 0,g=void 0;switch(v.type){case 1:h&&Pct.updatePlanarNormalAndDistance(r,this.yD),this.yD[48]=r.size.x,this.yD[49]=r.size.y,this.yD[50]=1,this.yD[51]=0,this.yD[52]=1,this.yD[53]=u,this.yD[54]=0,this.yD[55]=0,cr.toArray(this.yD,r.shadowColor,56);break;case 2:var w=v;if(h&&Pct.updatePlanarNormalAndDistance(r,this.yD),Kr.invert(gft,v.node.getWorldMatrix()),Kr.perspective(wft,v.angle,1,.001,v.range,!0,c.clipSpaceMinZ,c.clipSpaceSignY,0),d=wft.clone(),g=wft.clone().invert(),Kr.multiply(wft,wft,gft),Kr.toArray(this.yD,gft,0),Kr.toArray(this.yD,wft,16),this.yD[44]=.01,this.yD[45]=v.range,this.yD[46]=0,this.yD[47]=0,this.yD[48]=r.size.x,this.yD[49]=r.size.y,this.yD[50]=w.shadowPcf,this.yD[51]=w.shadowBias,this.yD[52]=2,this.yD[53]=u,this.yD[54]=w.shadowNormalBias,this.yD[55]=0,this.yD[36]=d.m10,this.yD[37]=d.m14,this.yD[38]=d.m11,this.yD[39]=d.m15,this.yD[32]=g.m10,this.yD[33]=g.m14,this.yD[34]=g.m11,this.yD[35]=g.m15,this.yD[40]=d.m00,this.yD[41]=d.m05,this.yD[42]=1/d.m00,this.yD[43]=1/d.m05,cr.toArray(this.yD,r.shadowColor,56),s.has(v)){var _,m=null==(_=s.get(v))?void 0:_.colorTextures[0];m&&o.bindTexture(6,m)}break;case 3:h&&Pct.updatePlanarNormalAndDistance(r,this.yD),this.yD[48]=r.size.x,this.yD[49]=r.size.y,this.yD[50]=1,this.yD[51]=0,this.yD[52]=3,this.yD[53]=u,this.yD[54]=0,this.yD[55]=0,cr.toArray(this.yD,r.shadowColor,56)}o.update(),i.updateBuffer(l.getBuffer(by.BINDING),this.yD)}}},i._updateUBOs=function(t,i){var n=t.exposure,e=this.xv.pipelineSceneData,r=e.isHDR,s=e.shadows,h=e.validPunctualLights;h.length>this.bD&&(this.OD.destroy(),this.bD=fe(h.length),this.SD.resize(this.kD*this.bD),this.RD=new Float32Array(this.TD*this.bD),this.OD=Hg.gfxDevice.createBuffer(new od(this.SD,0,80)));for(var u=0,o=0;u<h.length;u++,o+=this.TD){var a=h[u];switch(a.type){case 1:if(ir.toArray(vft,a.position),vft[3]=1,this.RD.set(vft,o+0),vft[0]=a.size,vft[1]=a.range,vft[2]=0,vft[3]=0,this.RD.set(vft,o+8),ir.toArray(vft,a.color),a.useColorTemperature){var c=a.finalColor;vft[0]=c.x,vft[1]=c.y,vft[2]=c.z}vft[3]=r?a.luminance*n*this.ED:a.luminance,this.RD.set(vft,o+4);break;case 2:if(ir.toArray(vft,a.position),vft[3]=2,this.RD.set(vft,o+0),vft[0]=a.size,vft[1]=a.range,vft[2]=a.spotAngle,vft[3]=s.enabled&&a.shadowEnabled&&s.type===Pk.ShadowMap?1:0,this.RD.set(vft,o+8),ir.toArray(vft,a.direction),this.RD.set(vft,o+12),ir.toArray(vft,a.color),a.useColorTemperature){var f=a.finalColor;vft[0]=f.x,vft[1]=f.y,vft[2]=f.z}vft[3]=r?a.luminance*n*this.ED:a.luminance,this.RD.set(vft,o+4),vft[0]=0,vft[1]=0,vft[2]=0,vft[3]=a.angleAttenuationStrength,this.RD.set(vft,o+16);break;case 3:if(ir.toArray(vft,a.position),vft[3]=3,this.RD.set(vft,o+0),vft[0]=0,vft[1]=a.range,vft[2]=0,vft[3]=0,this.RD.set(vft,o+8),ir.toArray(vft,a.color),a.useColorTemperature){var v=a.finalColor;vft[0]=v.x,vft[1]=v.y,vft[2]=v.z}vft[3]=r?a.luminance*n*this.ED:a.luminance,this.RD.set(vft,o+4);break;case 4:ir.toArray(vft,a.position),vft[3]=4,this.RD.set(vft,o+0),ir.toArray(vft,a.right),vft[3]=0,this.RD.set(vft,o+8),ir.toArray(vft,a.direction),vft[3]=0,this.RD.set(vft,o+12);var l=a.scale;if(fft.set(.5*l.x,.5*l.y,.5*l.z),ir.toArray(vft,fft),vft[3]=0,this.RD.set(vft,o+16),ir.toArray(vft,a.color),a.useColorTemperature){var d=a.finalColor;vft[0]=d.x,vft[1]=d.y,vft[2]=d.z}vft[3]=r?a.illuminance*n:a.illuminance,this.RD.set(vft,o+4)}}i.updateBuffer(this.SD,this.RD)},t}();Fi(fl),Fi(ll),Fi(Ol),Fi(Sl),Fi(Rl),Fi(el),Fi({SCENE:0,POSTPROCESS:1,UI:2}),Oft=Ko("RenderTextureDesc"),Rft=Ca(fl),Ift=Ca(ll),Mft=Ca(el),Oft((Nft=function(){this.name=Cft&&Cft(),this.type=Lft&&Lft(),this.usage=Fft&&Fft(),this.format=Pft&&Pft(),this.width=Bft&&Bft(),this.height=Dft&&Dft()},Cft=xo(Nft.prototype,"name",[oa],(function(){return""})),Lft=xo(Nft.prototype,"type",[Rft],(function(){return 1})),Fft=xo(Nft.prototype,"usage",[Ift],(function(){return 16})),Pft=xo(Nft.prototype,"format",[Mft],(function(){return 0})),Bft=xo(Nft.prototype,"width",[oa],(function(){return-1})),Dft=xo(Nft.prototype,"height",[oa],(function(){return-1})),Nft));var Zvt=(Uft=Ko("RenderTextureConfig"),xft=Ca(lN),Uft((jft=function(){this.name=Hft&&Hft(),this.texture=Vft&&Vft()},Hft=xo(jft.prototype,"name",[oa],(function(){return""})),Vft=xo(jft.prototype,"texture",[xft],(function(){return null})),Gft=jft))||Gft);$ft=Ko("MaterialConfig"),Wft=Ca(Lk),$ft((zft=function(){this.name=Xft&&Xft(),this.material=Yft&&Yft()},Xft=xo(zft.prototype,"name",[oa],(function(){return""})),Yft=xo(zft.prototype,"material",[Wft],(function(){return null})),zft)),Kft=Ko("FrameBufferDesc"),qft=Ca([ln]),Qft=Ca(lN),Kft((Zft=function(){this.name=Jft&&Jft(),this.renderPass=tvt&&tvt(),this.colorTextures=ivt&&ivt(),this.depthStencilTexture=nvt&&nvt(),this.texture=evt&&evt()},Jft=xo(Zft.prototype,"name",[oa],(function(){return""})),tvt=xo(Zft.prototype,"renderPass",[oa],(function(){return 0})),ivt=xo(Zft.prototype,"colorTextures",[qft],(function(){return[]})),nvt=xo(Zft.prototype,"depthStencilTexture",[oa],(function(){return""})),evt=xo(Zft.prototype,"texture",[Qft],(function(){return null})),Zft));var Jvt=(rvt=Ko("ColorDesc"),svt=Ca(el),hvt=Ca(Sl),uvt=Ca(Ol),ovt=Ca(Rl),avt=Ca(Rl),rvt((fvt=function(){this.format=vvt&&vvt(),this.loadOp=lvt&&lvt(),this.storeOp=dvt&&dvt(),this.sampleCount=gvt&&gvt(),this.beginAccesses=wvt&&wvt(),this.endAccesses=_vt&&_vt()},vvt=xo(fvt.prototype,"format",[svt],(function(){return 0})),lvt=xo(fvt.prototype,"loadOp",[hvt],(function(){return 1})),dvt=xo(fvt.prototype,"storeOp",[uvt],(function(){return 0})),gvt=xo(fvt.prototype,"sampleCount",[oa],(function(){return 1})),wvt=xo(fvt.prototype,"beginAccesses",[ovt],(function(){return 0})),_vt=xo(fvt.prototype,"endAccesses",[avt],(function(){return 2097152})),cvt=fvt))||cvt),tlt=(mvt=Ko("DepthStencilDesc"),pvt=Ca(el),yvt=Ca(Sl),bvt=Ca(Ol),Avt=Ca(Sl),Evt=Ca(Ol),kvt=Ca(Rl),Tvt=Ca(Rl),mvt((Ovt=function(){this.format=Rvt&&Rvt(),this.depthLoadOp=Ivt&&Ivt(),this.depthStoreOp=Mvt&&Mvt(),this.stencilLoadOp=Nvt&&Nvt(),this.stencilStoreOp=Cvt&&Cvt(),this.sampleCount=Lvt&&Lvt(),this.beginAccesses=Fvt&&Fvt(),this.endAccesses=Pvt&&Pvt()},Rvt=xo(Ovt.prototype,"format",[pvt],(function(){return 0})),Ivt=xo(Ovt.prototype,"depthLoadOp",[yvt],(function(){return 1})),Mvt=xo(Ovt.prototype,"depthStoreOp",[bvt],(function(){return 0})),Nvt=xo(Ovt.prototype,"stencilLoadOp",[Avt],(function(){return 1})),Cvt=xo(Ovt.prototype,"stencilStoreOp",[Evt],(function(){return 0})),Lvt=xo(Ovt.prototype,"sampleCount",[oa],(function(){return 1})),Fvt=xo(Ovt.prototype,"beginAccesses",[kvt],(function(){return 0})),Pvt=xo(Ovt.prototype,"endAccesses",[Tvt],(function(){return 4194304})),Svt=Ovt))||Svt);Bvt=Ko("RenderPassDesc"),Dvt=Ca([Jvt]),Uvt=Ca(tlt),Bvt((xvt=function(){this.index=Gvt&&Gvt(),this.colorAttachments=jvt&&jvt(),this.depthStencilAttachment=Hvt&&Hvt()},Gvt=xo(xvt.prototype,"index",[oa],(function(){return-1})),jvt=xo(xvt.prototype,"colorAttachments",[Dvt],(function(){return[]})),Hvt=xo(xvt.prototype,"depthStencilAttachment",[Uvt],(function(){return new tlt})),xvt));var ilt={FRONT_TO_BACK:0,BACK_TO_FRONT:1};Fi(ilt);var nlt=(Vvt=Ko("RenderQueueDesc"),$vt=Ca(ilt),Wvt=Ca([ln]),Vvt((Xvt=function(){this.isTransparent=Yvt&&Yvt(),this.sortMode=Kvt&&Kvt(),this.stages=qvt&&qvt()},Yvt=xo(Xvt.prototype,"isTransparent",[oa],(function(){return!1})),Kvt=xo(Xvt.prototype,"sortMode",[$vt],(function(){return 0})),qvt=xo(Xvt.prototype,"stages",[Wvt],(function(){return[]})),zvt=Xvt))||zvt),elt=new wo,rlt=ok("planar-shadow");function slt(t){var i=t.passes,n=k.rendering;Ub()&&(rlt=n.getPhaseID(n.getPassID("default"),"planar-shadow"));for(var e=0;e<i.length;e++)if((!n||!n.enableEffectImport)&&i[e].phase===rlt||Ub()&&i[e].phaseID===rlt)return e;return-1}var hlt,ult,olt,alt,clt,flt,vlt,llt,dlt=function(){function t(t){this.ND=[],this.CD=[],this.LD=[],this.FD=[],this.PD=new aft,this.xv=void 0,this.xv=t}var i=t.prototype;return i.clear=function(){this.ND.length=0,this.CD.length=0,this.LD.length=0,this.PD.clear(),this.FD.length=0},i.gatherShadowPasses=function(t,i){this.clear();var n=this.xv.pipelineSceneData.shadows;if(n.enabled&&n.type===Pk.Planar&&!(n.normal.length()<1e-6)){var e=t.scene,r=t.frustum,s=!!(t.visibility&Pm.BitMask.DEFAULT);if(e.mainLight&&s){for(var h=e.models,u=t.visibility,o=0;o<h.length;o++){var a=h[o];e.isCulledByLod(t,a)||a.enabled&&a.node&&a.castShadow&&a.node&&(u&a.node.layer)===a.node.layer&&this.FD.push(a)}for(var c=0;c<this.FD.length;c++){var f=this.FD[c];if(!f.worldBounds||(wo.transform(elt,f.worldBounds,n.matLight),Qh.aabbFrustum(elt,r)))for(var v=f.subModels,l=0;l<v.length;l++){var d=v[l],g=slt(d);if(g<0){this.ND.push(d);var w=n.getPlanarShader(d.patches);if(!w)continue;this.CD.push(w),this.LD.push(n.material.passes[0])}else{var _=d.passes[g];if(1===_.batchingScheme){var m=_.getInstancedBuffer();m.merge(d,g),this.PD.queue.add(m)}else{var p=d.shaders[g];this.ND.push(d),p&&this.CD.push(p),this.LD.push(_)}}}}this.PD.uploadBuffers(i)}}},i.recordCommandBuffer=function(t,i,n){var e=this.xv.pipelineSceneData.shadows;if(e.enabled&&e.type===Pk.Planar){this.PD.recordCommandBuffer(t,i,n);for(var r=0;r<this.ND.length;++r){var s=this.ND[r],h=this.CD[r],u=this.LD[r],o=s.inputAssembler,a=wk.getOrCreatePipelineState(t,u,h,i,o),c=u.descriptorSet;n.bindPipelineState(a),n.bindDescriptorSet(1,c),n.bindDescriptorSet(2,s.descriptorSet),n.bindInputAssembler(o),n.draw(o)}}},t}(),glt=function(){function t(){this.BD=ok("default");var t=k.rendering;Ub()&&(this.BD=t.getPhaseID(t.getPassID("default"),"default"))}var i=t.prototype;return i.activate=function(t){this.xv=t},i.render=function(t,i){for(var n=this.xv,e=n.device,r=n.commandBuffers[0],s=t.scene.batches,h=0;h<s.length;h++){var u=s[h],o=!1;if(t.visibility&u.mp&&(o=!0),o)for(var a=u.shaders.length,c=0;c<a;c++){var f=u.passes[c];if(f.phase===this.BD){var v=u.shaders[c],l=u.pp,d=wk.getOrCreatePipelineState(e,f,v,i,l);r.bindPipelineState(d),r.bindDescriptorSet(1,f.descriptorSet);var g=u.yp;r.bindDescriptorSet(2,g),r.bindInputAssembler(l),r.draw(l)}}}},t}(),wlt=[new nd(0,0,0,1)],_lt=t("ForwardStage",(hlt=Ko("ForwardStage"),ult=Ca([nlt]),hlt((flt=function(t){function i(){var i;return(i=t.call(this)||this).renderQueues=clt&&clt(),i._renderQueues=[],i.DD=new Yl,i.PD=new aft,i.BD=ok("default"),i.Gc=4294967295,i.UD=new glt,i.additiveInstanceQueues=[],i}s(i,t);var n=i.prototype;return n.addRenderInstancedQueue=function(t){this.additiveInstanceQueues.includes(t)||this.additiveInstanceQueues.push(t)},n.removeRenderInstancedQueue=function(t){var i=this.additiveInstanceQueues.indexOf(t);i>-1&&this.additiveInstanceQueues.splice(i,1)},n.initialize=function(i){return t.prototype.initialize.call(this,i),i.renderQueues&&(this.renderQueues=i.renderQueues),!0},n.activate=function(i,n){t.prototype.activate.call(this,i,n);for(var e=0;e<this.renderQueues.length;e++)this._renderQueues[e]=hft(this.renderQueues[e]);this.xD=new Qvt(this._pipeline),this.GD=new dlt(this._pipeline),this.UD.activate(i)},n.destroy=function(){},n.render=function(t){var i,n=this._pipeline,e=n.device;this.PD.clear(),this._renderQueues.forEach(uft);for(var r=n.pipelineSceneData.renderObjects,s=0,h=0,u=0,o=0;o<r.length;++o){var a=r[o],c=a.model.subModels;for(s=0;s<c.length;++s){var f=c[s],v=f.passes;for(h=0;h<v.length;++h){var l=v[h];if(l.phase===this.BD&&4294967295===l.passID)if(1===l.batchingScheme){var d=l.getInstancedBuffer();d.merge(f,h),this.PD.queue.add(d)}else for(u=0;u<this._renderQueues.length;u++)this._renderQueues[u].insertRenderPass(a,s,h)}}}this.PD.sort(),this._renderQueues.forEach(oft);var g=n.commandBuffers[0];n.pipelineUBO.updateShadowUBO(t);for(var w=0;w<this.additiveInstanceQueues.length;w++)this.additiveInstanceQueues[w].uploadBuffers(g);this.PD.uploadBuffers(g),this.xD.gatherLightPasses(t,g),this.GD.gatherShadowPasses(t,g),1&t.clearFlag&&(wlt[0].x=t.clearColor.x,wlt[0].y=t.clearColor.y,wlt[0].z=t.clearColor.z,wlt[0].w=t.clearColor.w),n.generateRenderArea(t,this.DD);var _=t.window.framebuffer,m=n.getRenderPass(t.clearFlag&this.Gc,_);g.beginRenderPass(m,_,this.DD,wlt,t.clearDepth,t.clearStencil),g.bindDescriptorSet(0,n.descriptorSet),this._renderQueues[0].recordCommandBuffer(e,m,g);for(var p=0;p<this.additiveInstanceQueues.length;p++)this.additiveInstanceQueues[p].recordCommandBuffer(e,m,g);this.PD.recordCommandBuffer(e,m,g),this.xD.recordCommandBuffer(e,m,g),g.bindDescriptorSet(0,n.descriptorSet),this.GD.recordCommandBuffer(e,m,g),this._renderQueues[1].recordCommandBuffer(e,m,g),null==(i=t.geometryRenderer)||i.render(m,g,n.pipelineSceneData),this.UD.render(t,m),Nk(e,m,g,n.profiler,t),g.endRenderPass()},i}($ct),flt.initInfo={name:"ForwardStage",priority:10,tag:0,renderQueues:[{isTransparent:!1,sortMode:0,stages:["default"]},{isTransparent:!0,sortMode:1,stages:["default","planarShadow"]}]},clt=xo((alt=flt).prototype,"renderQueues",[ult,oa],(function(){return[]})),olt=alt))||olt)),mlt=t("ForwardFlow",Ko("ForwardFlow")((llt=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._stages.length){var n=new _lt;n.initialize(_lt.initInfo),this._stages.push(n)}return!0},n.activate=function(i){t.prototype.activate.call(this,i)},n.render=function(i){t.prototype.render.call(this,i)},n.destroy=function(){t.prototype.destroy.call(this)},i}(Qct),llt.initInfo={name:ly,priority:1,stages:[]},vlt=llt))||vlt),plt=ok("shadow-caster");function ylt(t){var i=t.passes,n=k.rendering;Ub()&&(plt=n.getPhaseID(n.getPassID("default"),"shadow-caster"));for(var e=0;e<i.length;e++)if((!n||!n.enableEffectImport)&&i[e].phase===plt||Ub()&&i[e].phaseID===plt)return e;return-1}var blt,Alt,Elt,klt,Tlt=function(){function t(t){this.jD=[],this.LD=[],this.CD=[],this.PD=new aft,this.xv=t}var i=t.prototype;return i.gatherLightPasses=function(t,i,n,e){void 0===e&&(e=0),this.clear();var r=this.xv.pipelineSceneData,s=r.shadows;if(i&&s.enabled&&s.type===Pk.ShadowMap){switch(i.type){case 0:var h=i;if(h.shadowEnabled){var u,o=r.csmLayers;wct(t,r,u=h.shadowFixedArea?o.specialLayer:o.layers[e]);for(var a=u.shadowObjects,c=0;c<a.length;c++){var f=a[c].model;this.add(f,e)}}break;case 2:var v=i;if(v.shadowEnabled)for(var l=v.visibility,d=r.csmLayers.castShadowObjects,g=0;g<d.length;g++){var w=d[g].model;(!w.worldBounds||(l&w.node.layer)===w.node.layer&&Qh.aabbFrustum(w.worldBounds,v.frustum))&&this.add(w,e)}}this.PD.uploadBuffers(n)}},i.clear=function(){this.jD.length=0,this.CD.length=0,this.LD.length=0,this.PD.clear()},i.add=function(t,i){for(var n=t.subModels,e=0;e<n.length;e++){var r=n[e],s=ylt(r);if(!(s<0)){var h=r.passes[s];if(1===h.batchingScheme){var u=h.getInstancedBuffer(i);u.merge(r,s),this.PD.queue.add(u)}else{var o=r.shaders[s];this.jD.push(r),o&&this.CD.push(o),this.LD.push(h)}}}},i.recordCommandBuffer=function(t,i,n){this.PD.recordCommandBuffer(t,i,n);for(var e=0;e<this.jD.length;++e){var r=this.jD[e],s=this.CD[e],h=this.LD[e],u=r.inputAssembler,o=wk.getOrCreatePipelineState(t,h,s,i,u),a=h.descriptorSet;n.bindPipelineState(o),n.bindDescriptorSet(1,a),n.bindDescriptorSet(2,r.descriptorSet),n.bindInputAssembler(u),n.draw(u)}},t}(),Slt=[new nd(1,1,1,1)],Olt=t("ShadowStage",Ko("ShadowStage")((Alt=function(t){function i(){var i;return(i=t.call(this)||this).HD=void 0,i.VD=null,i.DD=new Yl,i.$D=null,i.WD=null,i.zD=0,i.XD=!1,i}s(i,t);var n=i.prototype;return n.setUsage=function(t,i,n,e){void 0===e&&(e=0),this.WD=t,this.$D=i,this.VD=n,this.zD=e},n.destroy=function(){var t;this.VD=null,this.WD=null,this.$D=null,null==(t=this.HD)||t.clear()},n.clearFramebuffer=function(t){if(this.$D&&this.VD&&!this.XD){Slt[0].w=t.clearColor.w;var i=this._pipeline,n=i.pipelineSceneData,e=n.shadingScale,r=n.shadows,s=t.viewport,h=r.size;this.DD.x=s.x*h.x,this.DD.y=s.y*h.y,this.DD.width=s.width*h.x*e,this.DD.height=s.height*h.y*e;var u=i.commandBuffers[0],o=this.VD.renderPass;u.beginRenderPass(o,this.VD,this.DD,Slt,t.clearDepth,t.clearStencil),u.endRenderPass(),this.XD=!0}},n.render=function(t){var i=this._pipeline,n=i.pipelineSceneData,e=n.shadows,r=this.WD,s=i.commandBuffers[0],h=this.zD,u=i.device;if(this.$D&&this.VD){this._pipeline.pipelineUBO.updateShadowUBOLight(r,this.$D,h),this.HD.gatherLightPasses(t,this.$D,s,h);var o=e.size;switch(this.$D.type){case 0:var a=this.$D;if(a.shadowFixedArea||a.csmLevel===Dk.LEVEL_1||!n.csmSupported)this.DD.x=0,this.DD.y=0,this.DD.width=o.x,this.DD.height=o.y;else{var c=u.capabilities.screenSpaceSignY;this.DD.x=h%2*.5*o.x,this.DD.y=c>0?.5*(1-Math.floor(h/2))*o.y:.5*Math.floor(h/2)*o.y,this.DD.width=.5*o.x,this.DD.height=.5*o.y}break;case 2:this.DD.x=0,this.DD.y=0,this.DD.width=o.x,this.DD.height=o.y}var f=this.VD.renderPass;s.beginRenderPass(f,this.VD,this.DD,Slt,t.clearDepth,t.clearStencil),s.bindDescriptorSet(0,r),this.HD.recordCommandBuffer(u,f,s),s.endRenderPass(),this.XD=!1}},n.activate=function(i,n){t.prototype.activate.call(this,i,n),this.HD=new Tlt(i),this.XD=!1},i}($ct),Alt.initInfo={name:"ShadowStage",priority:10,tag:0},blt=Alt))||blt),Rlt=[],Ilt=t("ShadowFlow",Ko("ShadowFlow")((klt=function(t){function i(){var i;return(i=t.call(this)||this).YD=null,i}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._stages.length){var n=new Olt;n.initialize(Olt.initInfo),this._stages.push(n)}return!0},n.activate=function(i){t.prototype.activate.call(this,i);var n=Db(i.device)?0:1;i.macros.CC_SHADOWMAP_FORMAT=n;var e=6===i.device.gfxAPI?1:0;i.macros.CC_SHADOWMAP_USE_LINEAR_DEPTH=e,i.pipelineSceneData.csmSupported=i.device.capabilities.maxFragmentUniformVectors>=99,i.macros.CC_SUPPORT_CASCADED_SHADOW_MAP=i.pipelineSceneData.csmSupported,i.macros.CC_SHADOW_TYPE=0,i.macros.CC_DIR_SHADOW_PCF_TYPE=Bk.HARD,i.macros.CC_DIR_LIGHT_SHADOW_TYPE=0,i.macros.CC_CASCADED_LAYERS_TRANSITION=0,i.onGlobalPipelineStateChanged()},n.render=function(t){var i=this._pipeline,n=i.pipelineSceneData.shadows,e=i.pipelineSceneData.csmLayers,r=i.pipelineSceneData.shadowFrameBufferMap,s=e.castShadowObjects,h=this._pipeline.pipelineSceneData.validPunctualLights;if(n.enabled&&n.type===Pk.ShadowMap){for(var u=0,o=0;u<n.maxReceived&&o<h.length;){var a=h[o];2===a.type&&a.shadowEnabled&&(Rlt.push(a),u++),o++}if(0!==s.length){n.shadowMapDirty&&this.KD();var c=t.scene.mainLight;if(c&&c.shadowEnabled){var f=i.descriptorSet;r.has(c)||this._initShadowFrameBuffer(i,c,t.window.swapchain);var v=r.get(c);if(c.shadowFixedArea)this.qD(t,c,v,f);else for(var l=i.pipelineSceneData.csmSupported?c.csmLevel:1,d=0;d<l;d++)this.qD(t,c,v,f,d)}for(var g=0;g<Rlt.length;g++){var w=Rlt[g],_=i.globalDSManager.getOrCreateDescriptorSet(w);r.has(w)||this._initShadowFrameBuffer(i,w,t.window.swapchain);var m=r.get(w);this.qD(t,w,m,_)}Rlt.length=0}else this.QD(Rlt,t)}},n.destroy=function(){if(t.prototype.destroy.call(this),this._pipeline){for(var i=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(i.values()),e=0;e<n.length;e++){var r=n[e];if(r){for(var s=r.colorTextures,h=0;h<s.length;h++){var u=s[h];u&&u.destroy()}s.length=0;var o=r.depthStencilTexture;o&&o.destroy(),r.destroy()}}i.clear()}this.YD&&this.YD.destroy()},n._initShadowFrameBuffer=function(t,i){var n=t.device,e=t.pipelineSceneData.shadows.size,r=t.pipelineSceneData.shadowFrameBufferMap,s=Db(n)?11:35;if(!this.YD){var h=new Od;h.format=s,h.loadOp=1,h.storeOp=0,h.sampleCount=1;var u=new Rd;u.format=55,u.depthLoadOp=1,u.depthStoreOp=1,u.stencilLoadOp=1,u.stencilStoreOp=1,u.sampleCount=1;var o=new Nd([h],u);this.YD=n.createRenderPass(o)}var a=[];a.push(n.createTexture(new vd(1,20,s,e.x,e.y)));var c=n.createTexture(new vd(1,32,55,e.x,e.y)),f=n.createFramebuffer(new Bd(this.YD,a,c));r.set(i,f)},n.qD=function(t,i,n,e,r){void 0===r&&(r=0);for(var s=0;s<this._stages.length;s++){var h=this._stages[s];h.setUsage(e,i,n,r),h.render(t)}},n.QD=function(t,i){var n=this._pipeline,e=n.pipelineSceneData,r=i.scene.mainLight;if(r){var s=this._pipeline.descriptorSet;e.shadowFrameBufferMap.has(r)||this._initShadowFrameBuffer(this._pipeline,r,i.window.swapchain);for(var h=e.shadowFrameBufferMap.get(r),u=0;u<this._stages.length;u++){var o=this._stages[u];o.setUsage(s,r,h),o.clearFramebuffer(i)}}for(var a=0;a<t.length;a++){var c=t[a],f=n.globalDSManager.getOrCreateDescriptorSet(c);e.shadowFrameBufferMap.has(c)||this._initShadowFrameBuffer(this._pipeline,c,i.window.swapchain);for(var v=e.shadowFrameBufferMap.get(c),l=0;l<this._stages.length;l++){var d=this._stages[l];d.setUsage(f,c,v),d.clearFramebuffer(i)}}},n.KD=function(){for(var t,i=this._pipeline.pipelineSceneData.shadows,n=i.size,e=this._pipeline,r=e.device,s=e.pipelineSceneData.shadowFrameBufferMap,h=Db(r)?11:35,u=d(s.keys());!(t=u()).done;){var o=t.value,a=s.get(o);if(a){var c=[];c.push(e.device.createTexture(new vd(1,20,h,n.x,n.y)));var f=a.depthStencilTexture;f&&f.resize(n.x,n.y);var v=a.renderPass;a.destroy();var l=r.createFramebuffer(new Bd(v,c,f));s.set(o,l)}}i.shadowMapDirty=!1},i}(Qct),klt.initInfo={name:dy,priority:0,tag:0,stages:[]},Elt=klt))||Elt),Mlt="CC_USE_RGBE_OUTPUT",Nlt=ok("default"),Clt=ok("reflect-map");function Llt(t){var i=t.passes,n=k.rendering;Ub()&&(Nlt=n.getPhaseID(n.getPassID("default"),"default"));for(var e=0;e<i.length;e++)if((!n||!n.enableEffectImport)&&i[e].phase===Nlt||Ub()&&i[e].phaseID===Nlt)return e;return-1}function Flt(t){var i=t.passes,n=k.rendering;Ub()&&(Clt=n.getPhaseID(n.getPassID("default"),"reflect-map"));for(var e=0;e<i.length;e++)if((!n||!n.enableEffectImport)&&i[e].phase===Clt||Ub()&&i[e].phaseID===Clt)return e;return-1}var Plt,Blt,Dlt,Ult,xlt,Glt,jlt,Hlt,Vlt,$lt=function(){function t(t){this.jD=[],this.LD=[],this.CD=[],this.ZD=[],this.PD=new aft,this.JD=[],this.xv=t}var i=t.prototype;return i.gatherRenderObjects=function(t,i,n){this.clear();var e=i.scene,r=this.xv.pipelineSceneData.skybox;r.enabled&&r.model&&8&t.camera.clearFlag&&this.add(r.model);for(var s=e.models,h=t.visibility,u=0;u<s.length;u++){var o=s[u];o.node&&!e.isCulledByLod(i,o)&&((h&o.node.layer)===o.node.layer||h&o.visFlags)&&o.enabled&&o.worldBounds&&o.bakeToReflectionProbe&&(0===t.probeType?Qh.aabbWithAABB(o.worldBounds,t.boundingBox)&&this.add(o):Qh.aabbFrustum(o.worldBounds,t.camera.frustum)&&this.add(o))}this.PD.uploadBuffers(n)},i.clear=function(){this.jD.length=0,this.CD.length=0,this.LD.length=0,this.PD.clear(),this.ZD.length=0},i.add=function(t){for(var i=t.subModels,n=0;n<i.length;n++){var e=i[n];if(!e.passes[0].blendState.targets[0].blend){var r=Flt(e),s=!0;if(r<0&&(r=Llt(e),s=!1),!(r<0)){var h=e.passes[r],u=h.batchingScheme;if(!s){this.JD=[],this.JD=this.JD.concat(e.patches);var o=[{name:Mlt,value:!0}];this.JD=this.JD.concat(o),e.onMacroPatchesStateChanged(this.JD),this.ZD.push(e)}if(1===u){var a=h.getInstancedBuffer();a.merge(e,r),this.PD.queue.add(a)}else{var c=e.shaders[r];this.jD.push(e),c&&this.CD.push(c),this.LD.push(h)}}}}},i.recordCommandBuffer=function(t,i,n){this.PD.recordCommandBuffer(t,i,n);for(var e=0;e<this.jD.length;++e){var r=this.jD[e],s=this.CD[e],h=this.LD[e],u=r.inputAssembler,o=wk.getOrCreatePipelineState(t,h,s,i,u),a=h.descriptorSet;n.bindPipelineState(o),n.bindDescriptorSet(1,a),n.bindDescriptorSet(2,r.descriptorSet),n.bindInputAssembler(u),n.draw(u)}this.resetRGBEMacro(),this.PD.clear()},i.resetRGBEMacro=function(){for(var t=0;t<this.ZD.length;t++){this.JD=[];var i=this.ZD[t];if(this.JD=this.JD.concat(i.patches),this.JD){for(var n=0;n<this.JD.length;n++)if(this.JD[n].name===Mlt){this.JD.splice(n,1);break}i.onMacroPatchesStateChanged(this.JD)}}},t}(),Wlt=[new nd(1,1,1,1)],zlt=t("ReflectionProbeStage",Ko("ReflectionProbeStage")((Blt=function(t){function i(){var i;return(i=t.call(this)||this).tU=null,i.DD=new Yl,i.iU=null,i.nU=void 0,i.eU=new ir,i}s(i,t);var n=i.prototype;return n.setUsageInfo=function(t,i){this.iU=t,this.tU=i},n.destroy=function(){var t;this.tU=null,null==(t=this.nU)||t.clear()},n.clearFramebuffer=function(t){if(this.tU){Wlt[0].w=t.clearColor.w;var i=this._pipeline,n=i.pipelineSceneData.shadingScale,e=t.viewport,r=this.iU.resolution;this.DD.x=e.x*r,this.DD.y=e.y*r,this.DD.width=e.width*r*n,this.DD.height=e.height*r*n;var s=i.commandBuffers[0],h=this.tU.renderPass;s.beginRenderPass(h,this.tU,this.DD,Wlt,t.clearDepth,t.clearStencil),s.endRenderPass()}},n.render=function(t){var i=this._pipeline,n=i.commandBuffers[0];this.nU.gatherRenderObjects(this.iU,t,n),i.pipelineUBO.updateCameraUBO(this.iU.camera),this.DD.x=0,this.DD.y=0,this.DD.width=this.iU.renderArea().x,this.DD.height=this.iU.renderArea().y;var e=this.tU.renderPass;if(1&this.iU.camera.clearFlag){this.eU.x=this.iU.camera.clearColor.x,this.eU.y=this.iU.camera.clearColor.y,this.eU.z=this.iU.camera.clearColor.z;var r=dr(this.eU);Wlt[0].x=r.x,Wlt[0].y=r.y,Wlt[0].z=r.z,Wlt[0].w=r.w}var s=i.device;n.beginRenderPass(e,this.tU,this.DD,Wlt,this.iU.camera.clearDepth,this.iU.camera.clearStencil),n.bindDescriptorSet(0,i.descriptorSet),this.nU.recordCommandBuffer(s,e,n),n.endRenderPass(),i.pipelineUBO.updateCameraUBO(t)},n.activate=function(i,n){t.prototype.activate.call(this,i,n),this.nU=new $lt(i)},i}($ct),Blt.initInfo={name:"ReflectionProbeStage",priority:10,tag:0},Plt=Blt))||Plt),Xlt=t("ReflectionProbeFlow",Ko("ReflectionProbeFlow")((Ult=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._stages.length){var n=new zlt;n.initialize(zlt.initInfo),this._stages.push(n)}return!0},n.activate=function(i){t.prototype.activate.call(this,i)},n.render=function(t){if(k.internal.reflectionProbeManager)for(var i=k.internal.reflectionProbeManager.getProbes(),n=0;n<i.length;n++)i[n].needRender&&1===i[n].probeType&&this.qD(t,i[n])},n.destroy=function(){t.prototype.destroy.call(this)},n.qD=function(t,i){for(var n=0;n<this._stages.length;n++){var e=this._stages[n];if(1===i.probeType)k.internal.reflectionProbeManager.updatePlanarMap(i,null),e.setUsageInfo(i,i.realtimePlanarTexture.window.framebuffer),e.render(t),k.internal.reflectionProbeManager.updatePlanarMap(i,i.realtimePlanarTexture.getGFXTexture());else{for(var r=0;r<6;r++){var s=i.bakedCubeTextures[r];if(!s)return;i.updateCameraDir(r),e.setUsageInfo(i,s.window.framebuffer),e.render(t)}i.needRender=!1}}},i}(Qct),Ult.initInfo={name:"PIPELINE_FLOW_RELECTION_PROBE",priority:0,tag:0,stages:[]},Dlt=Ult))||Dlt);function Ylt(){var t=new kdt;return t.initialize({flows:[]}),t}var Klt,qlt,Qlt,Zlt,Jlt,tdt,idt,ndt,edt,rdt,sdt,hdt,udt,odt,adt,cdt,fdt,vdt,ldt,ddt,gdt,wdt,_dt,mdt,pdt,ydt,bdt,Adt,Edt,kdt=t("ForwardPipeline",(xlt=Ko("ForwardPipeline"),Glt=Ca([Zvt]),xlt((Hlt=function(t){function i(){var i;return(i=t.call(this)||this).renderTextures=Vlt&&Vlt(),i._postRenderPass=null,i}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._flows.length){var n=new Ilt;n.initialize(Ilt.initInfo),this._flows.push(n);var e=new Xlt;e.initialize(Xlt.initInfo),this._flows.push(e);var r=new mlt;r.initialize(mlt.initInfo),this._flows.push(r)}return!0},n.activate=function(i){return this._macros={CC_PIPELINE_TYPE:0},this._pipelineSceneData=new _L,!(!t.prototype.activate.call(this,i)||!this.rU(i)&&(ut(2402),1))},n._ensureEnoughSize=function(t){for(var i=this._width,n=this._height,e=0;e<t.length;++e){var r=t[e].window;i=Math.max(r.width,i),n=Math.max(r.height,n)}i===this._width&&n===this._height||(this._width=i,this._height=n)},n.destroy=function(){this.sU(),this._destroyQuadInputAssembler();for(var i=this._renderPasses.values(),n=i.next();!n.done;)n.value.destroy(),n=i.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n.rU=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var i=this._descriptorSet,n=this.globalDSManager.pointSampler;return i.bindSampler(4,n),i.bindTexture(4,Bb(this.device)),i.bindSampler(6,n),i.bindTexture(6,Bb(this.device)),i.update(),!0},n.sU=function(){var t=this._descriptorSet;t&&(t.getBuffer(py.BINDING).destroy(),t.getBuffer(by.BINDING).destroy(),t.getBuffer(yy.BINDING).destroy(),t.getTexture(4).destroy(),t.getTexture(6).destroy())},e(i,[{key:"postRenderPass",get:function(){return this._postRenderPass}}]),i}(nft),Vlt=xo(Hlt.prototype,"renderTextures",[Glt,oa],(function(){return[]})),jlt=Hlt))||jlt)),Tdt=[new nd(0,0,0,0),new nd(0,0,0,0),new nd(0,0,0,0)],Sdt=t("GbufferStage",(Klt=Ko("GbufferStage"),qlt=Ca([nlt]),Klt((tdt=function(t){function i(){var i;return(i=t.call(this)||this).renderQueues=Jlt&&Jlt(),i._renderQueues=[],i.DD=new Yl,i.PD=new aft,i.BD=ok("default"),i}s(i,t);var n=i.prototype;return n.initialize=function(i){return t.prototype.initialize.call(this,i),i.renderQueues&&(this.renderQueues=i.renderQueues),!0},n.activate=function(i,n){t.prototype.activate.call(this,i,n);for(var e=0;e<this.renderQueues.length;e++)this._renderQueues[e]=hft(this.renderQueues[e])},n.destroy=function(){},n.render=function(t){this.PD.clear();var i=this._pipeline,n=i.device;this._renderQueues.forEach(uft),i.generateRenderArea(t,this.DD),i.updateQuadVertexData(this.DD,t.window);for(var e=i.pipelineSceneData.renderObjects,r=0,s=0,h=0,u=0;u<e.length;++u){var o=e[u],a=o.model.subModels;for(r=0;r<a.length;++r){var c=a[r],f=c.passes;for(s=0;s<f.length;++s){var v=f[s];if(v.phase===this.BD)if(1===v.batchingScheme){var l=v.getInstancedBuffer();l.merge(c,s),this.PD.queue.add(l)}else for(h=0;h<this._renderQueues.length;h++)this._renderQueues[h].insertRenderPass(o,r,s)}}}this._renderQueues.forEach(oft);var d=i.commandBuffers[0];this.PD.uploadBuffers(d),1&t.clearFlag&&(i.pipelineSceneData.isHDR?pk(Tdt[0],t.clearColor):(Tdt[0].x=t.clearColor.x,Tdt[0].y=t.clearColor.y,Tdt[0].z=t.clearColor.z)),Tdt[0].w=t.clearColor.w;var g=i.getPipelineRenderData().gbufferFrameBuffer,w=g.renderPass;d.beginRenderPass(w,g,this.DD,Tdt,t.clearDepth,t.clearStencil),d.setScissor(i.generateScissor(t)),d.setViewport(i.generateViewport(t)),d.bindDescriptorSet(0,i.descriptorSet);for(var _=0;_<this.renderQueues.length;_++)this._renderQueues[_].recordCommandBuffer(n,w,d);this.PD.recordCommandBuffer(n,w,d),d.endRenderPass()},i}($ct),tdt.initInfo={name:"GbufferStage",priority:10,tag:0,renderQueues:[{isTransparent:!1,sortMode:0,stages:["default"]},{isTransparent:!0,sortMode:1,stages:["default"]}]},Jlt=xo((Zlt=tdt).prototype,"renderQueues",[qlt,oa],(function(){return[]})),Qlt=Zlt))||Qlt)),Odt=new ir,Rdt=new wo(0,0,0,.5,.5,.5),Idt=new wo,Mdt=[new nd(0,0,0,1)],Ndt=t("LightingStage",(idt=Ko("LightingStage"),ndt=Ca(Lk),edt=Ca([nlt]),idt((odt=function(t){function i(){var i;return(i=t.call(this)||this).hU=null,i.uU=jy.LIGHTS_PER_PASS,i.RD=null,i.ED=1e4,i.$A=null,i.DD=new Yl,i.GD=null,i.UD=new glt,i._deferredMaterial=hdt&&hdt(),i.renderQueues=udt&&udt(),i.BD=ok("default"),i.oU=[],i}s(i,t);var n=i.prototype;return n.initialize=function(i){return t.prototype.initialize.call(this,i),!0},n.gatherLights=function(t){for(var i=this._pipeline,n=i.pipelineSceneData.isHDR,e=i.commandBuffers[0],r=t.scene.sphereLights,s=t.scene.spotLights,h=t.scene.pointLights,u=t.scene.rangedDirLights,o=Ys.create(0,0,0,1),a=new Float32Array(4),c=t.exposure,f=0,v=De.length,l=v*this.uU,d=0;d<r.length&&f<this.uU;d++,++f){var g=r[d];if(Ys.set(o,g.position.x,g.position.y,g.position.z,g.range),Qh.sphereFrustum(o,t.frustum)){if(ir.toArray(a,g.position),a[3]=1,this.RD.set(a,f*v),ir.toArray(a,g.color),g.useColorTemperature){var w=g.finalColor;a[0]=w.x,a[1]=w.y,a[2]=w.z}a[3]=n?g.luminance*c*this.ED:g.luminance,this.RD.set(a,f*v+1*l),a[0]=g.size,a[1]=g.range,a[2]=0,this.RD.set(a,f*v+2*l)}}for(var _=0;_<s.length&&f<this.uU;_++,++f){var m=s[_];if(Ys.set(o,m.position.x,m.position.y,m.position.z,m.range),Qh.sphereFrustum(o,t.frustum)){if(ir.toArray(a,m.position),a[3]=2,this.RD.set(a,f*v+0*l),ir.toArray(a,m.color),m.useColorTemperature){var p=m.finalColor;a[0]=p.x,a[1]=p.y,a[2]=p.z}a[3]=n?m.luminance*c*this.ED:m.luminance,this.RD.set(a,f*v+1*l),a[0]=m.size,a[1]=m.range,a[2]=m.spotAngle,this.RD.set(a,f*v+2*l),ir.toArray(a,m.direction),this.RD.set(a,f*v+3*l)}}for(var y=0;y<h.length&&f<this.uU;y++,++f){var b=h[y];if(Ys.set(o,b.position.x,b.position.y,b.position.z,b.range),Qh.sphereFrustum(o,t.frustum)){if(ir.toArray(a,b.position),a[3]=3,this.RD.set(a,f*v),ir.toArray(a,b.color),b.useColorTemperature){var A=b.finalColor;a[0]=A.x,a[1]=A.y,a[2]=A.z}a[3]=n?b.luminance*c*this.ED:b.luminance,this.RD.set(a,f*v+1*l),a[0]=0,a[1]=b.range,a[2]=0,this.RD.set(a,f*v+2*l)}}for(var E=0;E<u.length&&f<this.uU;E++,++f){var k=u[E];if(wo.transform(Idt,Rdt,k.node.getWorldMatrix()),Qh.aabbFrustum(Idt,t.frustum)){if(ir.toArray(a,k.position),a[3]=4,this.RD.set(a,f*v),ir.toArray(a,k.color),k.useColorTemperature){var T=k.finalColor;a[0]=T.x,a[1]=T.y,a[2]=T.z}a[3]=n?k.illuminance*c:k.illuminance,this.RD.set(a,f*v+1*l),ir.toArray(a,k.right),a[3]=0,this.RD.set(a,f*v+2*l),ir.toArray(a,k.direction),a[3]=0,this.RD.set(a,f*v+3*l);var S=k.scale;Odt.set(.5*S.x,.5*S.y,.5*S.z),ir.toArray(a,Odt),a[3]=0,this.RD.set(a,f*v+4*l)}}var O=3*l+3;this.RD.set([f],O),e.updateBuffer(this.hU,this.RD)},n._createStageDescriptor=function(t){var i=this._pipeline.device,n=64*this.uU;n=Math.ceil(n/i.capabilities.uboOffsetAlignment)*i.capabilities.uboOffsetAlignment,this.hU=i.createBuffer(new ud(18,3,n,i.capabilities.uboOffsetAlignment));var e=i.createBuffer(new od(this.hU,0,n));this.RD=new Float32Array(n/4),this.$A=i.createDescriptorSet(new xd(t.localSetLayout)),this.$A.bindBuffer(Gy.BINDING,e);var r=i.createBuffer(new ud(18,1,224,224));this.$A.bindBuffer(0,r)},n.activate=function(i,n){t.prototype.activate.call(this,i,n),this.UD.activate(i);for(var e=0;e<this.renderQueues.length;e++)this.oU[e]=hft(this.renderQueues[e]);this.GD=new dlt(this._pipeline),this._deferredMaterial&&(i.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial)},n.destroy=function(){var t;null==(t=this.hU)||t.destroy(),this.hU=null,this.$A=null},n.render=function(t){var i,n=this._pipeline,e=n.device,r=n.commandBuffers[0],s=n.pipelineSceneData,h=s.renderObjects;this.GD.gatherShadowPasses(t,r),n.generateRenderArea(t,this.DD);for(var u=n.getPipelineRenderData(),o=s.deferredLightingMaterial.passes[0],a=o.getShaderVariant(),c=0;c<3;++c)o.descriptorSet.bindTexture(c,u.gbufferRenderTargets[c]),o.descriptorSet.bindSampler(c,u.sampler);o.descriptorSet.bindTexture(3,u.outputDepth),o.descriptorSet.bindSampler(3,u.sampler),o.descriptorSet.update(),this.$A||this._createStageDescriptor(o),this.gatherLights(t),1&t.clearFlag&&(Mdt[0].x=t.clearColor.x,Mdt[0].y=t.clearColor.y,Mdt[0].z=t.clearColor.z),Mdt[0].w=0;var f=u.outputFrameBuffer,v=f.renderPass;n.pipelineUBO.updateShadowUBO(t),r.beginRenderPass(v,f,this.DD,Mdt,t.clearDepth,t.clearStencil),r.setScissor(n.generateScissor(t)),r.setViewport(n.generateViewport(t)),r.bindDescriptorSet(0,n.descriptorSet);var l=n.quadIAOffscreen,d=null;null!=o&&null!=a&&null!=l&&(d=wk.getOrCreatePipelineState(e,o,a,v,l)),null!=d&&(this.$A.update(),r.bindPipelineState(d),r.bindDescriptorSet(1,o.descriptorSet),r.bindDescriptorSet(2,this.$A),r.bindInputAssembler(l),r.draw(l)),this.oU.forEach(uft);for(var g=0,w=0,_=0,m=0;m<h.length;++m){var p=h[m],y=p.model.subModels;for(g=0;g<y.length;++g){var b=y[g].passes;for(w=0;w<b.length;++w)if(b[w].phase===this.BD)for(_=0;_<this.oU.length;_++)this.oU[_].insertRenderPass(p,g,w)}}if(h.length>0){this.oU.forEach(oft);for(var A=0;A<this.oU.length;A++)this.oU[A].recordCommandBuffer(e,v,r);this.GD.recordCommandBuffer(e,v,r)}null==(i=t.geometryRenderer)||i.render(v,r,n.pipelineSceneData),this.UD.render(t,v),r.endRenderPass()},i}($ct),odt.initInfo={name:"LightingStage",priority:15,tag:0},hdt=xo((sdt=odt).prototype,"_deferredMaterial",[ndt,oa],(function(){return null})),udt=xo(sdt.prototype,"renderQueues",[edt,oa],(function(){return[]})),rdt=sdt))||rdt)),Cdt=[new nd(0,0,0,1)],Ldt=t("PostProcessStage",(adt=Ko("PostProcessStage"),cdt=Ca(Lk),fdt=Ca([nlt]),adt((wdt=function(t){function i(){var i;return(i=t.call(this)||this)._postProcessMaterial=ddt&&ddt(),i.renderQueues=gdt&&gdt(),i.DD=new Yl,i.aU=null,i.cU=null,i.UD=new glt,i}s(i,t);var n=i.prototype;return n.initialize=function(i){return t.prototype.initialize.call(this,i),!0},n.activate=function(i,n){t.prototype.activate.call(this,i,n),this._postProcessMaterial&&(i.pipelineSceneData.postprocessMaterial=this._postProcessMaterial),this.UD.activate(i)},n.destroy=function(){},n.render=function(t){var i=this._pipeline,n=i.device,e=i.pipelineSceneData,r=i.commandBuffers[0];i.pipelineUBO.updateCameraUBO(t);var s=t.viewport;this.DD.x=s.x*t.window.width,this.DD.y=s.y*t.window.height,this.DD.width=s.width*t.window.width,this.DD.height=s.height*t.window.height;var h=i.getPipelineRenderData(),u=t.window.framebuffer,o=i.getRenderPass(t.clearFlag,u);1&t.clearFlag&&(Cdt[0].x=t.clearColor.x,Cdt[0].y=t.clearColor.y,Cdt[0].z=t.clearColor.z),Cdt[0].w=t.clearColor.w,r.beginRenderPass(o,u,this.DD,Cdt,t.clearDepth,t.clearStencil),r.bindDescriptorSet(0,i.descriptorSet);var a=e.postprocessMaterial.passes[0],c=a.getShaderVariant();i.bloomEnabled?a.descriptorSet.bindTexture(0,h.bloom.combineTex):a.descriptorSet.bindTexture(0,h.outputRenderTargets[0]),a.descriptorSet.bindSampler(0,h.sampler),a.descriptorSet.update();var f=t.window.swapchain?i.quadIAOnscreen:i.quadIAOffscreen,v=null;null!=a&&null!=c&&null!=f&&(v=wk.getOrCreatePipelineState(n,a,c,o,f));var l=i.pipelineSceneData.renderObjects;null!=v&&l.length>0&&(this.aU||(this.aU=n.createDescriptorSet(new xd(a.localSetLayout)),this.cU=n.createBuffer(new ud(18,1,224,224)),this.aU.bindBuffer(0,this.cU)),this.aU.update(),r.bindPipelineState(v),r.bindDescriptorSet(1,a.descriptorSet),r.bindDescriptorSet(2,this.aU),r.bindInputAssembler(f),r.draw(f)),this.UD.render(t,o),Nk(n,o,r,i.profiler,t),r.endRenderPass()},i}($ct),wdt.initInfo={name:"PostProcessStage",priority:19,tag:0},ddt=xo((ldt=wdt).prototype,"_postProcessMaterial",[cdt,oa],(function(){return null})),gdt=xo(ldt.prototype,"renderQueues",[fdt,oa],(function(){return[]})),vdt=ldt))||vdt)),Fdt=function(t){function i(){var i;return(i=t.call(this)||this)._antiAliasing=0,i}s(i,t);var n=i.prototype;return n.updatePipelineSceneData=function(){this.updatePipelinePassInfo()},n.fU=function(){if(this._bloomMaterial){var t=this._bloomMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently();for(var i=0;i<6;++i){var n=this._bloomMaterial.passes[1+i];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently();var e=this._bloomMaterial.passes[7+i];e.beginChangeStatesSilently(),e.tryCompile(),e.endChangeStatesSilently()}var r=this._bloomMaterial.passes[13];r.beginChangeStatesSilently(),r.tryCompile(),r.endChangeStatesSilently()}},n.vU=function(){if(this.postprocessMaterial){var t=this.postprocessMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},n.initPipelinePassInfo=function(){var t=new Lk;t._uuid="builtin-deferred-material",t.initialize({effectName:"pipeline/deferred-lighting"});for(var i=0;i<t.passes.length;++i)t.passes[i].tryCompile();this._deferredLightingMaterial=t;var n=new Lk;n._uuid="builtin-bloom-material",n.initialize({effectName:"pipeline/bloom"});for(var e=0;e<n.passes.length;++e)n.passes[e].tryCompile();this._bloomMaterial=n;var r=new Lk;r._uuid="builtin-post-process-material",r.initialize({effectName:"pipeline/post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(var s=0;s<r.passes.length;++s)r.passes[s].tryCompile();this._postprocessMaterial=r,this.updatePipelinePassInfo()},n.updatePipelinePassInfo=function(){this.fU(),this.vU(),this.lU()},n.activate=function(i){return t.prototype.activate.call(this,i),this.initPipelinePassInfo(),!0},n.lU=function(){this.dU()},n.dU=function(){if(this._deferredLightingMaterial){T.director.root.pipeline.macros.CC_RECEIVE_SHADOW=1;var t=this._deferredLightingMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},e(i,[{key:"antiAliasing",get:function(){return this._antiAliasing},set:function(t){if(this._antiAliasing=t,this._postprocessMaterial){var i=this._postprocessMaterial.passes[0].defines;Object.assign(i,{ANTIALIAS_TYPE:t});var n=new Lk;n.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:i});for(var e=0;e<n.passes.length;++e)n.passes[e].tryCompile();this._postprocessMaterial=n}}},{key:"bloomMaterial",get:function(){return this._bloomMaterial},set:function(t){this._bloomMaterial!==t&&t&&(this._bloomMaterial=t,this.updatePipelinePassInfo())}},{key:"postprocessMaterial",get:function(){return this._postprocessMaterial},set:function(t){this._postprocessMaterial!==t&&t&&(this._postprocessMaterial=t,this.updatePipelinePassInfo())}},{key:"deferredLightingMaterial",get:function(){return this._deferredLightingMaterial},set:function(t){this._deferredLightingMaterial!==t&&t&&(this._deferredLightingMaterial=t,this.updatePipelinePassInfo())}}]),i}(_L),Pdt=[new nd(0,0,0,1)],Bdt=function(){};_dt=Bdt,Bdt.TEXTURE_SIZE_OFFSET=0,Bdt.COUNT=_dt.TEXTURE_SIZE_OFFSET+4,Bdt.SIZE=4*_dt.COUNT;var Ddt,Udt,xdt,Gdt,jdt,Hdt,Vdt,$dt=t("BloomStage",(mdt=Ko("BloomStage"),pdt=Ca(Lk),mdt((Edt=function(t){function i(){var i;return(i=t.call(this)||this).threshold=1,i.intensity=.8,i.iterations=2,i._bloomMaterial=Adt&&Adt(),i.DD=new Yl,i.gU=[],i}s(i,t);var n=i.prototype;return n.initialize=function(i){return t.prototype.initialize.call(this,i),!0},n.activate=function(i,n){t.prototype.activate.call(this,i,n),this._bloomMaterial&&(i.pipelineSceneData.bloomMaterial=this._bloomMaterial)},n.destroy=function(){},n.render=function(t){var i,n=this._pipeline;if(n.generateBloomRenderData(),(null!=(i=t.window)&&i.swapchain||n.macros.CC_PIPELINE_TYPE)&&n.bloomEnabled&&0!==n.pipelineSceneData.renderObjects.length){if(0===this.gU.length)for(var e=0;e<14;++e)this.gU[e]=n.device.createBuffer(new ud(18,3,Bdt.SIZE,Bdt.SIZE));1&t.clearFlag&&(Pdt[0].x=t.clearColor.x,Pdt[0].y=t.clearColor.y,Pdt[0].z=t.clearColor.z),Pdt[0].w=t.clearColor.w,this.wU(t,n),this._U(t,n),this.mU(t,n),this.pU(t,n)}},n.wU=function(t,i){i.generateRenderArea(t,this.DD),this.DD.width>>=1,this.DD.height>>=1;var n=i.commandBuffers[0],e=i.pipelineSceneData.bloomMaterial.passes[0],r=i.getPipelineRenderData(),s=r.bloom,h=new Float32Array(Bdt.COUNT);h[Bdt.TEXTURE_SIZE_OFFSET+2]=this.threshold,n.updateBuffer(this.gU[0],h),n.beginRenderPass(s.renderPass,s.prefilterFramebuffer,this.DD,Pdt,0,0),n.bindDescriptorSet(0,i.descriptorSet),e.descriptorSet.bindBuffer(0,this.gU[0]),e.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),e.descriptorSet.bindSampler(1,s.sampler),e.descriptorSet.update(),n.bindDescriptorSet(1,e.descriptorSet);var u=t.window.swapchain?i.quadIAOffscreen:i.quadIAOnscreen,o=null,a=e.getShaderVariant();null!=e&&null!=a&&null!=u&&(o=wk.getOrCreatePipelineState(i.device,e,a,s.renderPass,u)),null!=o&&(n.bindPipelineState(o),n.bindInputAssembler(u),n.draw(u)),n.endRenderPass()},n._U=function(t,i){i.generateRenderArea(t,this.DD),this.DD.width>>=1,this.DD.height>>=1;for(var n=i.commandBuffers[0],e=i.pipelineSceneData.bloomMaterial,r=i.getPipelineRenderData().bloom,s=new Float32Array(Bdt.COUNT),h=0;h<this.iterations;++h){s[Bdt.TEXTURE_SIZE_OFFSET+0]=this.DD.width,s[Bdt.TEXTURE_SIZE_OFFSET+1]=this.DD.height,n.updateBuffer(this.gU[h+1],s),this.DD.width>>=1,this.DD.height>>=1,n.beginRenderPass(r.renderPass,r.downsampleFramebuffers[h],this.DD,Pdt,0,0);var u=e.passes[1+h],o=u.getShaderVariant();u.descriptorSet.bindBuffer(0,this.gU[h+1]),0===h?u.descriptorSet.bindTexture(1,r.prefiterTex):u.descriptorSet.bindTexture(1,r.downsampleTexs[h-1]),u.descriptorSet.bindSampler(1,r.sampler),u.descriptorSet.update(),n.bindDescriptorSet(1,u.descriptorSet);var a=t.window.swapchain?i.quadIAOffscreen:i.quadIAOnscreen,c=null;null!=u&&null!=o&&null!=a&&(c=wk.getOrCreatePipelineState(i.device,u,o,r.renderPass,a)),null!=c&&(n.bindPipelineState(c),n.bindInputAssembler(a),n.draw(a)),n.endRenderPass()}},n.mU=function(t,i){var n=i.getPipelineRenderData().bloom;i.generateRenderArea(t,this.DD),this.DD.width>>=this.iterations+1,this.DD.height>>=this.iterations+1;for(var e=i.commandBuffers[0],r=i.pipelineSceneData.bloomMaterial,s=new Float32Array(Bdt.COUNT),h=0;h<this.iterations;++h){var u=h+6+1;s[Bdt.TEXTURE_SIZE_OFFSET+0]=this.DD.width,s[Bdt.TEXTURE_SIZE_OFFSET+1]=this.DD.height,e.updateBuffer(this.gU[u],s),this.DD.width<<=1,this.DD.height<<=1,e.beginRenderPass(n.renderPass,n.upsampleFramebuffers[this.iterations-1-h],this.DD,Pdt,0,0);var o=r.passes[7+h],a=o.getShaderVariant();o.descriptorSet.bindBuffer(0,this.gU[u]),0===h?o.descriptorSet.bindTexture(1,n.downsampleTexs[this.iterations-1]):o.descriptorSet.bindTexture(1,n.upsampleTexs[this.iterations-h]),o.descriptorSet.bindSampler(1,n.sampler),o.descriptorSet.update(),e.bindDescriptorSet(1,o.descriptorSet);var c=t.window.swapchain?i.quadIAOffscreen:i.quadIAOnscreen,f=null;null!=o&&null!=a&&null!=c&&(f=wk.getOrCreatePipelineState(i.device,o,a,n.renderPass,c)),null!=f&&(e.bindPipelineState(f),e.bindInputAssembler(c),e.draw(c)),e.endRenderPass()}},n.pU=function(t,i){i.generateRenderArea(t,this.DD);var n=i.commandBuffers[0],e=i.pipelineSceneData.bloomMaterial,r=i.getPipelineRenderData(),s=r.bloom,h=new Float32Array(Bdt.COUNT);h[Bdt.TEXTURE_SIZE_OFFSET+3]=this.intensity,n.updateBuffer(this.gU[13],h),n.beginRenderPass(s.renderPass,s.combineFramebuffer,this.DD,Pdt,0,0),n.bindDescriptorSet(0,i.descriptorSet);var u=e.passes[13];u.descriptorSet.bindBuffer(0,this.gU[13]),u.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),u.descriptorSet.bindTexture(2,s.upsampleTexs[0]),u.descriptorSet.bindSampler(1,s.sampler),u.descriptorSet.bindSampler(2,s.sampler),u.descriptorSet.update(),n.bindDescriptorSet(1,u.descriptorSet);var o=t.window.swapchain?i.quadIAOffscreen:i.quadIAOnscreen,a=null,c=u.getShaderVariant();null!=u&&null!=c&&null!=o&&(a=wk.getOrCreatePipelineState(i.device,u,c,s.renderPass,o)),null!=a&&(n.bindPipelineState(a),n.bindInputAssembler(o),n.draw(o)),n.endRenderPass()},i}($ct),Edt.initInfo={name:"BloomStage",priority:18,tag:0},Adt=xo((bdt=Edt).prototype,"_bloomMaterial",[pdt,oa],(function(){return null})),ydt=bdt))||ydt)),Wdt=t("MainFlow",Ko("MainFlow")((Udt=function(t){function i(){return t.apply(this,arguments)||this}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._stages.length){var n=new Sdt;n.initialize(Sdt.initInfo),this._stages.push(n);var e=new Ndt;e.initialize(Ndt.initInfo),this._stages.push(e);var r=new $dt;r.initialize($dt.initInfo),this._stages.push(r);var s=new Ldt;s.initialize(Ldt.initInfo),this._stages.push(s)}return!0},n.activate=function(i){t.prototype.activate.call(this,i)},n.render=function(i){t.prototype.render.call(this,i)},n.destroy=function(){t.prototype.destroy.call(this)},i}(Qct),Udt.initInfo={name:vy,priority:1,stages:[]},Ddt=Udt))||Ddt),zdt=function(t){function i(){var i;return(i=t.call(this)||this).gbufferFrameBuffer=null,i.gbufferRenderTargets=[],i}return s(i,t),i}((function(){this.outputFrameBuffer=null,this.outputRenderTargets=[],this.outputDepth=null,this.sampler=null,this.bloom=null})),Xdt=t("DeferredPipeline",(xdt=Ko("DeferredPipeline"),Gdt=Ca([Zvt]),xdt((Hdt=function(t){function i(){var i;return(i=t.call(this)||this).yU=null,i.bU=null,i.renderTextures=Vdt&&Vdt(),i}s(i,t);var n=i.prototype;return n.initialize=function(i){if(t.prototype.initialize.call(this,i),0===this._flows.length){var n=new Ilt;n.initialize(Ilt.initInfo),this._flows.push(n);var e=new Wdt;e.initialize(Wdt.initInfo),this._flows.push(e)}return!0},n.activate=function(i){return this._macros={CC_PIPELINE_TYPE:1},this._pipelineSceneData=new Fdt,!(!t.prototype.activate.call(this,i)||!this.rU(i)&&(ut(2402),1))},n.destroy=function(){this.sU(),this._destroyQuadInputAssembler(),this.AU();for(var i=this._renderPasses.values(),n=i.next();!n.done;)n.value.destroy(),n=i.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n.onGlobalPipelineStateChanged=function(){this.pipelineSceneData.updatePipelineSceneData()},n.getPipelineRenderData=function(){return this._pipelineRenderData||this.EU(),this._pipelineRenderData},n.rU=function(t){var i=this.device;this._commandBuffers.push(i.commandBuffer);var n=this.globalDSManager.pointSampler;this._descriptorSet.bindSampler(4,n),this._descriptorSet.bindTexture(4,uk.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(6,n),this._descriptorSet.bindTexture(6,uk.get("default-texture").getGFXTexture()),this._descriptorSet.update();var e=new HC;if(!(e=this._createQuadInputAssembler()).quadIB||!e.quadVB||!e.quadIA)return!1;this._quadIB=e.quadIB,this._quadVBOffscreen=e.quadVB,this._quadIAOffscreen=e.quadIA;var r=this._createQuadInputAssembler();if(!r.quadIB||!r.quadVB||!r.quadIA)return!1;if(this._quadVBOnscreen=r.quadVB,this._quadIAOnscreen=r.quadIA,!this.yU){var s=new Od;s.format=41,s.loadOp=1,s.storeOp=0;var h=new Od;h.format=41,h.loadOp=1,h.storeOp=0;var u=new Od;u.format=41,u.loadOp=1,u.storeOp=0;var o=new Rd;o.format=55,o.depthLoadOp=1,o.depthStoreOp=0,o.stencilLoadOp=1,o.stencilStoreOp=0;var a=new Nd([s,h,u],o);this.yU=i.createRenderPass(a)}if(!this.bU){var c=new Od;c.format=35,c.loadOp=1,c.storeOp=0,c.barrier=i.getGeneralBarrier(new Ld(0,2097152));var f=new Rd;f.format=55,f.depthLoadOp=0,f.depthStoreOp=1,f.stencilLoadOp=0,f.stencilStoreOp=1,c.barrier=i.getGeneralBarrier(new Ld(4194304,4194304));var v=new Nd([c],f);this.bU=i.createRenderPass(v)}return this._width=t.width,this._height=t.height,this.EU(),!0},n.sU=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(py.BINDING).destroy(),this._descriptorSet.getBuffer(by.BINDING).destroy(),this._descriptorSet.getBuffer(yy.BINDING).destroy(),this._descriptorSet.getTexture(4).destroy(),this._descriptorSet.getTexture(6).destroy())},n.AU=function(){var t=this._pipelineRenderData;if(t){t.gbufferFrameBuffer&&t.gbufferFrameBuffer.destroy(),t.outputFrameBuffer&&t.outputFrameBuffer.destroy(),t.outputDepth&&t.outputDepth.destroy();for(var i=0;i<t.gbufferRenderTargets.length;i++)t.gbufferRenderTargets[i].destroy();t.gbufferRenderTargets.length=0;for(var n=0;n<t.outputRenderTargets.length;n++)t.outputRenderTargets[n].destroy();t.outputRenderTargets.length=0,this._destroyBloomData()}this._pipelineRenderData=null},n._ensureEnoughSize=function(t){for(var i=this._width,n=this._height,e=0;e<t.length;++e){var r=t[e].window;i=Math.max(r.width,i),n=Math.max(r.height,n)}i===this._width&&n===this._height||(this._width=i,this._height=n,this.AU(),this.EU())},n.EU=function(){for(var t=this,i=this.device,n=this._pipelineRenderData=new zdt,e=this.pipelineSceneData,r=0;r<3;++r)n.gbufferRenderTargets.push(i.createTexture(new vd(1,20,41,this._width*e.shadingScale,this._height*e.shadingScale)));n.outputDepth=i.createTexture(new vd(1,36,55,this._width*e.shadingScale,this._height*e.shadingScale)),n.gbufferFrameBuffer=i.createFramebuffer(new Bd(this.yU,n.gbufferRenderTargets,n.outputDepth)),n.outputRenderTargets.push(i.createTexture(new vd(1,20,41,this._width*e.shadingScale,this._height*e.shadingScale))),n.outputFrameBuffer=i.createFramebuffer(new Bd(this.bU,n.outputRenderTargets,null)),n.sampler=this.globalDSManager.pointSampler,this.on("attachment-scale-changed",(function(i){n.sampler=i<1?t.globalDSManager.pointSampler:t.globalDSManager.linearSampler,n.gbufferFrameBuffer=t.newFramebufferByRatio(n.gbufferFrameBuffer),n.gbufferFrameBuffer=t.newFramebufferByRatio(n.outputFrameBuffer)}))},i}(nft),Vdt=xo(Hdt.prototype,"renderTextures",[Gdt,oa],(function(){return[]})),jdt=Hdt))||jdt)),Ydt=Object.freeze({__proto__:null,BloomStage:$dt,DeferredPipeline:Xdt,ForwardFlow:mlt,ForwardPipeline:kdt,ForwardStage:_lt,GbufferStage:Sdt,LightingStage:Ndt,MainFlow:Wdt,PostProcessStage:Ldt,ReflectionProbeFlow:Xlt,ReflectionProbeStage:zlt,RenderFlow:Qct,RenderPipeline:nft,RenderStage:$ct,ShadowFlow:Ilt,ShadowStage:Olt,createDefaultPipeline:Ylt});T.legacy_rendering=Ydt}}}));
